window.__require=function t(e,i,a){function n(r,s){if(!i[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+r+"'")}}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){return n(e[r][1][t]||t)},u,u.exports,t,e,i,a)}return i[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<a.length;r++)n(a[r]);return n}({" PromoteCharacterDetailStatusExceedLimitView":[function(t,e,i){"use strict";cc._RF.push(e,"b5efbqaXelJdJQEU8xh8kRl"," PromoteCharacterDetailStatusExceedLimitView");t("CommonButton");var a=t("CommonUtils"),n=(t("CharacterUtils"),t("CharacterConst")),o=t("PromoteCharacterDetailStatusParamViewBase"),r=t("CharacterExceedLimitMaterialTabView");cc.Class({extends:o,properties:{characterExceedLimitMaterialTabView:r},initPromoteCharacterDetailStatusView:function(t,e,i){this._super(t,e),this.characterExceedLimitMaterialTabView.initCharacterExceedLimitMaterialTabView(t,i,this._drawProgress.bind(this),this._callbackToResetBtn.bind(this)),this._drawProgress(this.characterExceedLimitMaterialTabView.getAddExceedLimit())},_drawProgress:function(t){this._drawLevelProgress(t),this._drawExceedLimitProgress(t)},_drawLevelProgress:function(t){var e=t||0,i=this._characterModel.getLevel(),a=this._characterModel.getMaxLevel(),o=this._root.getCurrentCharacterModel().getMaxLevelByExceedLimit(this._root.getCurrentCharacterModel().getExceedLimit()+e);if(a<o){this._characterLevelProgressView.node.active=!0;var r=this._characterModel.getExpRateForNextLevel(),s=this._characterModel.getNeedExpForNextLevel();this._characterLevelProgressView.initCharacterLevelProgressView(n.PROMOTE_TYPE.EXCEED_LIMIT,i,0,a,o,s,r)}else this._super()},_drawExceedLimitProgress:function(t){var e=t||0;this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(this._root.getCurrentCharacterModel().getExceedLimit(),this._root.getCurrentCharacterModel().getExceedLimit()+e,this._root.getCurrentCharacterModel().getExceedLimitMaxCount())},_drawCharacterAddParameter:function(){if(this.equipmentTotalPowerLabel){this.characterParameterView.node.active=!0;var t,e=this._characterModel.getEquipmentStatus(),i=this._characterModel.getEquipmentEffect(this._characterModel.getHp()+e.hp,this._characterModel.getAtk()+e.atk,this._characterModel.getDef()+e.def),n=e.hp+i.hp,o=e.atk+i.atk,r=e.def+i.def;t=n+o+r,this.equipmentTotalPowerLabel.string="(+"+a.convertToCommaDelimited(t)+")",this.characterEquipmentParameterView.initBattleParameterView(n,o,r),this.characterEquipmentParameterView.setPrefix("(+"),this.characterEquipmentParameterView.setSuffix(")")}},_callbackToResetBtn:function(){this._root.resetSelectMaterials(),this._drawCharacterAddParameter(),this.characterExceedLimitMaterialTabView.initCharacterExceedLimitMaterialTabView(this._root,this.characterExceedLimitMaterialTabView.getCurrentTab(),this._drawProgress.bind(this),this._callbackToResetBtn.bind(this)),this._drawProgress(this.characterExceedLimitMaterialTabView.getAddExceedLimit())}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterExceedLimitMaterialTabView:"CharacterExceedLimitMaterialTabView",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",PromoteCharacterDetailStatusParamViewBase:"PromoteCharacterDetailStatusParamViewBase"}],1:[function(t,e,i){(function(t){(function(a){var n="object"==typeof i&&i&&!i.nodeType&&i,o="object"==typeof e&&e&&!e.nodeType&&e,r="object"==typeof t&&t;r.global!==r&&r.window!==r&&r.self!==r||(a=r);var s,c,l=2147483647,u=36,h=1,d=26,p=38,m=700,_=72,g=128,C="-",f=/^xn--/,E=/[^\x20-\x7E]/,T=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},R=u-h,A=Math.floor,b=String.fromCharCode;function M(t){throw new RangeError(S[t])}function v(t,e){for(var i=t.length,a=[];i--;)a[i]=e(t[i]);return a}function P(t,e){var i=t.split("@"),a="";return i.length>1&&(a=i[0]+"@",t=i[1]),a+v((t=t.replace(T,".")).split("."),e).join(".")}function I(t){for(var e,i,a=[],n=0,o=t.length;n<o;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<o?56320==(64512&(i=t.charCodeAt(n++)))?a.push(((1023&e)<<10)+(1023&i)+65536):(a.push(e),n--):a.push(e);return a}function y(t){return v(t,function(t){var e="";return t>65535&&(e+=b((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=b(t)}).join("")}function N(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:u}function B(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function L(t,e,i){var a=0;for(t=i?A(t/m):t>>1,t+=A(t/e);t>R*d>>1;a+=u)t=A(t/R);return A(a+(R+1)*t/(t+p))}function w(t){var e,i,a,n,o,r,s,c,p,m,f=[],E=t.length,T=0,S=g,R=_;for((i=t.lastIndexOf(C))<0&&(i=0),a=0;a<i;++a)t.charCodeAt(a)>=128&&M("not-basic"),f.push(t.charCodeAt(a));for(n=i>0?i+1:0;n<E;){for(o=T,r=1,s=u;n>=E&&M("invalid-input"),((c=N(t.charCodeAt(n++)))>=u||c>A((l-T)/r))&&M("overflow"),T+=c*r,!(c<(p=s<=R?h:s>=R+d?d:s-R));s+=u)r>A(l/(m=u-p))&&M("overflow"),r*=m;R=L(T-o,e=f.length+1,0==o),A(T/e)>l-S&&M("overflow"),S+=A(T/e),T%=e,f.splice(T++,0,S)}return y(f)}function D(t){var e,i,a,n,o,r,s,c,p,m,f,E,T,S,R,v=[];for(E=(t=I(t)).length,e=g,i=0,o=_,r=0;r<E;++r)(f=t[r])<128&&v.push(b(f));for(a=n=v.length,n&&v.push(C);a<E;){for(s=l,r=0;r<E;++r)(f=t[r])>=e&&f<s&&(s=f);for(s-e>A((l-i)/(T=a+1))&&M("overflow"),i+=(s-e)*T,e=s,r=0;r<E;++r)if((f=t[r])<e&&++i>l&&M("overflow"),f==e){for(c=i,p=u;!(c<(m=p<=o?h:p>=o+d?d:p-o));p+=u)R=c-m,S=u-m,v.push(b(B(m+R%S,0))),c=A(R/S);v.push(b(B(c,0))),o=L(i,T,a==n),i=0,++a}++i,++e}return v.join("")}if(s={version:"1.4.1",ucs2:{decode:I,encode:y},decode:w,encode:D,toASCII:function(t){return P(t,function(t){return E.test(t)?"xn--"+D(t):t})},toUnicode:function(t){return P(t,function(t){return f.test(t)?w(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return s});else if(n&&o)if(e.exports==n)o.exports=s;else for(c in s)s.hasOwnProperty(c)&&(n[c]=s[c]);else a.punycode=s})(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";function a(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,i,o){e=e||"&",i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var s=/\+/g;t=t.split(e);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var l=t.length;c>0&&l>c&&(l=c);for(var u=0;u<l;++u){var h,d,p,m,_=t[u].replace(s,"%20"),g=_.indexOf(i);g>=0?(h=_.substr(0,g),d=_.substr(g+1)):(h=_,d=""),p=decodeURIComponent(h),m=decodeURIComponent(d),a(r,p)?n(r[p])?r[p].push(m):r[p]=[r[p],m]:r[p]=m}return r};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],3:[function(t,e,i){"use strict";var a=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,i,s){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?o(r(t),function(r){var s=encodeURIComponent(a(r))+i;return n(t[r])?o(t[r],function(t){return s+encodeURIComponent(a(t))}).join(e):s+encodeURIComponent(a(t[r]))}).join(e):s?encodeURIComponent(a(s))+i+encodeURIComponent(a(t)):""};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var i=[],a=0;a<t.length;a++)i.push(e(t[a],a));return i}var r=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},{}],4:[function(t,e,i){"use strict";i.decode=i.parse=t("./decode"),i.encode=i.stringify=t("./encode")},{"./decode":2,"./encode":3}],5:[function(t,e,i){"use strict";var a=t("punycode"),n=t("./util");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}i.parse=E,i.resolve=function(t,e){return E(t,!1,!0).resolve(e)},i.resolveObject=function(t,e){return t?E(t,!1,!0).resolveObject(e):e},i.format=function(t){n.isString(t)&&(t=E(t));return t instanceof o?t.format():o.prototype.format.call(t)},i.Url=o;var r=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(l),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,_={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},C={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},f=t("querystring");function E(t,e,i){if(t&&n.isObject(t)&&t instanceof o)return t;var a=new o;return a.parse(t,e,i),a}o.prototype.parse=function(t,e,i){if(!n.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),s=-1!==o&&o<t.indexOf("#")?"?":"#",l=t.split(s);l[0]=l[0].replace(/\\/g,"/");var E=t=l.join(s);if(E=E.trim(),!i&&1===t.split("#").length){var T=c.exec(E);if(T)return this.path=E,this.href=E,this.pathname=T[1],T[2]?(this.search=T[2],this.query=e?f.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var S=r.exec(E);if(S){var R=(S=S[0]).toLowerCase();this.protocol=R,E=E.substr(S.length)}if(i||S||E.match(/^\/\/[^@\/]+@[^@\/]+/)){var A="//"===E.substr(0,2);!A||S&&g[S]||(E=E.substr(2),this.slashes=!0)}if(!g[S]&&(A||S&&!C[S])){for(var b,M,v=-1,P=0;P<d.length;P++){-1!==(I=E.indexOf(d[P]))&&(-1===v||I<v)&&(v=I)}-1!==(M=-1===v?E.lastIndexOf("@"):E.lastIndexOf("@",v))&&(b=E.slice(0,M),E=E.slice(M+1),this.auth=decodeURIComponent(b)),v=-1;for(P=0;P<h.length;P++){var I;-1!==(I=E.indexOf(h[P]))&&(-1===v||I<v)&&(v=I)}-1===v&&(v=E.length),this.host=E.slice(0,v),E=E.slice(v),this.parseHost(),this.hostname=this.hostname||"";var y="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!y)for(var N=this.hostname.split(/\./),B=(P=0,N.length);P<B;P++){var L=N[P];if(L&&!L.match(p)){for(var w="",D=0,U=L.length;D<U;D++)L.charCodeAt(D)>127?w+="x":w+=L[D];if(!w.match(p)){var F=N.slice(0,P),O=N.slice(P+1),k=L.match(m);k&&(F.push(k[1]),O.unshift(k[2])),O.length&&(E="/"+O.join(".")+E),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=a.toASCII(this.hostname));var x=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+x,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==E[0]&&(E="/"+E))}if(!_[R])for(P=0,B=u.length;P<B;P++){var G=u[P];if(-1!==E.indexOf(G)){var q=encodeURIComponent(G);q===G&&(q=escape(G)),E=E.split(G).join(q)}}var H=E.indexOf("#");-1!==H&&(this.hash=E.substr(H),E=E.slice(0,H));var W=E.indexOf("?");if(-1!==W?(this.search=E.substr(W),this.query=E.substr(W+1),e&&(this.query=f.parse(this.query)),E=E.slice(0,W)):e&&(this.search="",this.query={}),E&&(this.pathname=E),C[R]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){x=this.pathname||"";var Y=this.search||"";this.path=x+Y}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",a=this.hash||"",o=!1,r="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&n.isObject(this.query)&&Object.keys(this.query).length&&(r=f.stringify(this.query));var s=this.search||r&&"?"+r||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||C[e])&&!1!==o?(o="//"+(o||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):o||(o=""),a&&"#"!==a.charAt(0)&&(a="#"+a),s&&"?"!==s.charAt(0)&&(s="?"+s),e+o+(i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+a},o.prototype.resolve=function(t){return this.resolveObject(E(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(n.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var i=new o,a=Object.keys(this),r=0;r<a.length;r++){var s=a[r];i[s]=this[s]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var c=Object.keys(t),l=0;l<c.length;l++){var u=c[l];"protocol"!==u&&(i[u]=t[u])}return C[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!C[t.protocol]){for(var h=Object.keys(t),d=0;d<h.length;d++){var p=h[d];i[p]=t[p]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||g[t.protocol])i.pathname=t.pathname;else{for(var m=(t.pathname||"").split("/");m.length&&!(t.host=m.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),i.pathname=m.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var _=i.pathname||"",f=i.search||"";i.path=_+f}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var E=i.pathname&&"/"===i.pathname.charAt(0),T=t.host||t.pathname&&"/"===t.pathname.charAt(0),S=T||E||i.host&&t.pathname,R=S,A=i.pathname&&i.pathname.split("/")||[],b=(m=t.pathname&&t.pathname.split("/")||[],i.protocol&&!C[i.protocol]);if(b&&(i.hostname="",i.port=null,i.host&&(""===A[0]?A[0]=i.host:A.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host=null),S=S&&(""===m[0]||""===A[0])),T)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,A=m;else if(m.length)A||(A=[]),A.pop(),A=A.concat(m),i.search=t.search,i.query=t.query;else if(!n.isNullOrUndefined(t.search)){if(b)i.hostname=i.host=A.shift(),(y=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=y.shift(),i.host=i.hostname=y.shift());return i.search=t.search,i.query=t.query,n.isNull(i.pathname)&&n.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!A.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var M=A.slice(-1)[0],v=(i.host||t.host||A.length>1)&&("."===M||".."===M)||""===M,P=0,I=A.length;I>=0;I--)"."===(M=A[I])?A.splice(I,1):".."===M?(A.splice(I,1),P++):P&&(A.splice(I,1),P--);if(!S&&!R)for(;P--;P)A.unshift("..");!S||""===A[0]||A[0]&&"/"===A[0].charAt(0)||A.unshift(""),v&&"/"!==A.join("/").substr(-1)&&A.push("");var y,N=""===A[0]||A[0]&&"/"===A[0].charAt(0);b&&(i.hostname=i.host=N?"":A.length?A.shift():"",(y=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=y.shift(),i.host=i.hostname=y.shift()));return(S=S||i.host&&A.length)&&!N&&A.unshift(""),A.length?i.pathname=A.join("/"):(i.pathname=null,i.path=null),n.isNull(i.pathname)&&n.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},o.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":6,punycode:1,querystring:4}],6:[function(t,e,i){"use strict";e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],AbilityController:[function(t,e,i){"use strict";cc._RF.push(e,"cc252T0MgVEeKRzIy7vXVjx","AbilityController");var a=t("BattleData"),n=t("EnumTypes"),o=t("GameEffectQueue").GameEffectQueue,r=t("GameEffectQueue").EffectQuery,s=t("GameEffectQueue").EffectData,c=t("BattleFunction"),l=t("Buff"),u=(t("BattleConstants"),cc.Class({checkAbility_inAction:function(t,e,i,a){return void 0===a&&(a=null),!!e&&!!this.checkTiming(e,i,t,a)},excuteAbility:function(t,e,i,u){var h=a.GM.actionController,d=new r("show_ability"),p=!1,m=new o;if(null===e||void 0===e)return!1;var _=e.actionList;if(void 0===_)return!1;cc.log("excuteAbility");for(var g=0;g<_.length;g++){var C=_[g];if(h.checkInvoke(C)){p=!0;var f=c.getUnitList(t.isEnemy),E=c.getUnitList(!t.isEnemy),T=c.getTargetList(C.getTargetType(),C,t,f,E,e),S=new r;if(C.getActionType()===n.ActionType.ATTACK){var R=new o,A=h.setAbilityAttack(C,t,T);a.curActionData=A,t.doAbilityAttack(R,A),(v={}).effectQueue=R,S.addAction(new s(v,h.playEffectqueue.bind(h)))}else for(var b in T){var M=null;T.hasOwnProperty(b)&&(M=T[b]);var v={},P=(R=new o,100*e.getAbilityId()+C.getIndex());h.excuteSubAction(R,C,t,M,P,n.BuffClass.ABILITY),(v={}).effectQueue=R,S.addAction(new s(v,h.playEffectqueue.bind(h)))}m.addQuery(S)}}if(p){t.createQueryAbilityCutin(e,i,d);var I={};I.effectQueue=m,d.addAction(new s(I,h.playEffectqueue.bind(h))),a.GM.effectQueue.addQuery(d);var y=e.getTriggerConditionType();if(y&&y===n.TriggerConditionType.LIMIT_INVOKE_TIMES){var N=e.getAbilityId(),B=new l(t,N,n.BuffType.INVOKED_ABILITY,0,0,n.BuffClass.ABILITY,n.BuffEndType.NO_END,0);t.addBuff(B)}}return p},checkTiming:function(t,e,i,o){var r=t.getTriggerType(),s=t.getTriggerValue(),c=Number(s),l=t.getTriggerConditionType();if(void 0===i&&(i=null),void 0===o&&(o=null),r!==e)return!1;if(l&&l===n.TriggerConditionType.LIMIT_INVOKE_TIMES){var u=i.buffList;if(i.isEnemy)for(var h=0;h<u.length;h++){var d=u[h];if(d.type===n.BuffType.INVOKED_ABILITY&&d.buffId===t.getAbilityId())return!1}else{var p=Number(t.getTriggerConditionValue());if(p=0===p?1:p,_.filter(u,function(e){return e.type===n.BuffType.INVOKED_ABILITY&&e.buffId===t.getAbilityId()}).length>=p)return!1}}if(e!==n.TriggerType.WAVE_START){if(e===n.TriggerType.ON_ATTACK_BY_ELEMENT){if(!o)return!1;for(var m in o){if(o.hasOwnProperty(m))if(c===o[m].getAttribute())return!0}return!1}if(e===n.TriggerType.BE_ATTACKED_BY_ELEMENT){if(!o)return!1;for(var g in o){if(o.hasOwnProperty(g))if(c===o[g].getAttribute())return!0}return!1}if(e===n.TriggerType.BE_ATTACKED_COUNTER_IN_TURN)return c===i.beAttackCounterInTurn;if(e===n.TriggerType.ON_ATTACK_MORE_THAN_HP||e===n.TriggerType.ON_ATTACK_LESS_THAN_HP||e===n.TriggerType.BE_ATTACKED_MORE_THAN_HP||e===n.TriggerType.BE_ATTACKED_LESS_THAN_HP||e===n.TriggerType.ON_LESS_THAN_HP){var C=i.getCurHp()/i.getMaxHp()*100;return e===n.TriggerType.ON_ATTACK_MORE_THAN_HP||e===n.TriggerType.BE_ATTACKED_MORE_THAN_HP?C>=c:C<=c}if(e===n.TriggerType.ON_ATTACK_BAD_CONDITION){if(!o)return!1;for(var f in o){if(o.hasOwnProperty(f))if(o[f].hasBuff(c))return!0}return!1}return!0}return 0===c||c===a.cur_waveCount+1}}));e.exports={AbilityController:u},cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",Buff:"Buff",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue"}],AbilityCutinMessageView:[function(t,e,i){"use strict";cc._RF.push(e,"659c2/cRbpGBLK8YW2GwsYa","AbilityCutinMessageView");cc.Class({extends:cc.Component,properties:{inGameLabel:cc.Prefab},addMessage:function(t){var e=cc.fadeIn(0);this.node.runAction(e);for(var i=0;i<this.node._children.length;i++)this.node._children[i].color=cc.color(128,128,128);var a=cc.instantiate(this.inGameLabel);a.getComponent(cc.Label).string=t,this.node.addChild(a)},fadeOutAllMessage:function(){var t=cc.fadeOut(.2),e=cc.callFunc(function(){this.node.destroyAllChildren()}.bind(this)),i=cc.sequence(t,e);this.node.runAction(i)}});cc._RF.pop()},{}],AbilityCutinView:[function(t,e,i){"use strict";cc._RF.push(e,"5ab01HOGMVCiZkaKxbatEpQ","AbilityCutinView");cc.Class({extends:cc.Component,properties:{animation:cc.Animation,balloonMain:cc.Node,playerLabel:cc.Label,balloonEnemy:cc.Node,enemyLabel:cc.Label,MAX_WIDTH:210},setPlayerLabelText:function(t){this.playerLabel.string=t,this.playerLabel._forceUpdateRenderData(!0),this.playerLabel.node.width>this.MAX_WIDTH?(this.playerLabel.overflow=cc.Label.Overflow.RESIZE_HEIGHT,this.playerLabel.node.width=this.MAX_WIDTH,this.playerLabel._forceUpdateRenderData(!0),this.balloonMain.height=this.playerLabel.node.height+20):(this.balloonMain.width=this.playerLabel.node.width+20,this.balloonMain.x=-this.balloonMain.width*(.5-this.balloonMain.anchorX))},setEnemyLabelText:function(t){this.enemyLabel.string=t,this.enemyLabel._forceUpdateRenderData(!0),this.enemyLabel.node.width>this.MAX_WIDTH?(this.enemyLabel.overflow=cc.Label.Overflow.RESIZE_HEIGHT,this.enemyLabel.node.width=this.MAX_WIDTH,this.enemyLabel._forceUpdateRenderData(!0),this.balloonEnemy.height=this.enemyLabel.node.height+20):(this.balloonEnemy.width=this.enemyLabel.node.width+20,this.balloonEnemy.x=-this.balloonEnemy.width*(.5-this.balloonEnemy.anchorX))}});cc._RF.pop()},{}],ActionController:[function(t,e,i){"use strict";cc._RF.push(e,"132dfoYwuJJmbh2yMi/qUUK","ActionController");var a=t("BattleData"),n=t("CommonFunction"),o=t("EnumTypes"),r=t("BattleFunction"),s=t("GameEffectQueue").GameEffectQueue,c=t("GameEffectQueue").EffectQuery,l=t("GameEffectQueue").EffectData,u=t("Buff"),h=t("BattleConstants"),d=(t("GameConst"),t("DeckConst")),p=t("EquipmentConst"),m=cc.Class({commandType:null,actionType:o.ActionType.NO_DATA,attacker:null,target:null,power:0,isCriti:!1,damageType:o.DamageType.NONE,damageArr:null,useDesignatedElement:!1,designatedElement:null,badConditionInvoked:!1,badConditionBuff:null,isHitList:null,deadUnitList:null,addedBadConditionUnitList:null,effectConditionList:null,effectConditionType:o.EffectConditionType.NO_CONDITION,effectConditionPowerUpRate:0,ctor:function(){this.commandType=o.CommandType.ATTACK,this.actionType=o.ActionType.NO_DATA,this.attacker=null,this.target=[],this.power=0,this.isCriti=!1,this.damageArr=[],this.useDesignatedElement=!1,this.designatedElement=[],this.badConditionInvoked=!1,this.badConditionBuff=null,this.isHitList=[],this.deadUnitList=[],this.addedBadConditionUnitList=[],this.effectConditionList=[],this.effectConditionType=o.EffectConditionType.NO_CONDITION,this.effectConditionPowerUpRate=1}}),_=cc.Class({effectQueryList:null,ctor:function(){this.effectQueryList=[]},createActionData:function(){var t,e,i,n,s=a.GM.getWaitRageUnit();if(s)t=r.getUnitList(!0),e=r.getUnitList(!1),(i=s).isRageMode=!0,n=!0,a.GM.playRageAnimation(i,this.checkUseSkill(i,n));else if(t=r.getUnitList(!a.isNowPlayerTurn),e=r.getUnitList(a.isNowPlayerTurn),(i=t[a.curUnitIdx]).unitType==o.UnitType.MONSTER){var c=this._selectEnemyAI(i);n=c.useSkillMode,c.actionContinue==o.EnemyActionContinue.END&&(a.curEnemyActionCount=0,a.curUnitIdx=a.curUnitIdx+1)}else n=i.useSkillMode,a.curUnitIdx=a.curUnitIdx+1;var l=null;l=this.checkUseSkill(i,n)?this.setSkill(i,t,e):this.setAttack(i,t,e);for(var u=[],h=0;h<l.target.length;h++)u.push(!0);return l.isHitList=u,l},_selectEnemyAI:function(t){var e=t.getEnemyAIList(),i=t.getCurHp()/t.getMaxHp()*100,s=r.getUnitList(!1),c=0,l=0,u=0,d=new Array;for(var p in s)c+=s[p].getCurHp(),l+=s[p].getAtk(),u+=s[p].getDef(),d.push(s[p].getAttribute());var m=new Array;t.buffList.forEach(function(t){t.isBadConditionBuff()&&m.push(t.type)}),a.curEnemyActionCount+=1;for(var _=0;_<e.length;_++){var g=e[_],C=!0,f=n.getRandomInt(0,h.ENEMY_ACTION_OCCURRENCERATE_MAX);if((i<g.conditionHpFrom||i>g.conditionHpTo)&&(C=!1),c<g.conditionPlayerHpTotal&&(C=!1),l<g.conditionPlayerAtkTotal&&(C=!1),u<g.conditionPlayerDefTotal&&(C=!1),g.conditionPlayerAttribute&&!this._isDupulicateArrays(d,g.conditionPlayerAttribute)&&(C=!1),g.conditionEnemyAbnormal&&!this._isDupulicateArrays(m,g.conditionEnemyAbnormal)&&(C=!1),g.actionCount>a.curEnemyActionCount&&(C=!1),(0==g.rate||g.rate<f)&&(C=!1),g.actionType!=o.EnemyActionType.SKILL||this.checkUseSkill(t,!0)||(C=!1),C){var E;if(g.actionType==o.EnemyActionType.SKILL){var T=t.battleSkillList.filter(function(t){if(g.index==t.getSkillGroupIndex())return t}).shift();T&&(t.mySkill=T),E=!0}else E=!1;var S={};return S.useSkillMode=E,S.actionContinue=g.actionContinue,S}}},_isDupulicateArrays:function(t,e){return t.filter(function(t){for(var e in this)if(this[e]==t)return t},e).length>0},checkUseSkill:function(t,e){return!t.isDead&&(null!==t.mySkill&&(!t.hasBuff(o.BuffType.SEAL_SKILL)&&!!t.canUseSkill(e)))},setAttack:function(t,e,i){var a=new m,n=i,s=!1,c=Array.from(t.buffList);for(var l in c){if(!r.checkAliveOtherUnitExist(t))break;var u=null;if(c.hasOwnProperty(l)&&(u=c[l]),u.type===o.BuffType.CONFUSE&&u.checkInvoke()){cc.log("confuse checkInvoke   success   !!!!!"),cc.log(u),s=!0,a.badConditionInvoked=!0,a.badConditionBuff=u,n=e;break}}if(!t.isDead&&this.aliveUnitExist(n)){var h=[];for(var d in n){var p=null;n.hasOwnProperty(d)&&(p=n[d]),p.isDead||p===t||h.push(p)}a.commandType=o.CommandType.ATTACK,a.actionType=o.ActionType.ATTACK,a.attacker=t,t.isEnemy||s?a.target=r.getTargetListUsingChance(h,!0,1):a.target=r.getTargetListUsingChanceByAtk(h,!0,1,t.getAttribute());var _=t.getAtk();a.power=parseInt(_),this.checkCritical(t)?a.isCriti=!0:a.isCriti=!1}else a.commandType=o.CommandType.IDLE,a.attacker=t,a.target=[];return a},setSkill:function(t,e,i){var a=t.mySkill.actionList[0],n=new m;n.attacker=t,n.commandType=o.CommandType.USE_SKILL,n.actionType=a.getActionType();var s=r.getTargetList(a.getTargetType(),a,t,e,i);if(n.target=s,n.actionType=a.getActionType(),a.getActionType()===o.ActionType.ATTACK){var c=t.get_SkillDamageUpEffect(o.PowerType.PER_BY_DEF)/100,l=t.get_SkillDamageUpEffect(o.PowerType.FIX);switch(a.getEffectType()){case o.PowerType.FIX:var u=(a.getEffectValue()+l)*(1+c);n.power=parseInt(u);break;case o.PowerType.PER_BY_ATK:case o.PowerType.PER_BY_DEF:var h=(t.getAtk()+l)*(1+c)*a.getEffectValue()/100;n.power=parseInt(h);break;case o.PowerType.CONDITION_BURN:n.power=parseInt(t.getAtk()+l),n.effectConditionType=parseInt(a.getEffectConditionType()),n.effectConditionList=a.getEffectConditionValue().split(","),n.effectConditionPowerUpRate=(1+c)*a.getEffectValue()/100;break;default:n.power=parseInt(t.getAtk()+l)}}return n},setAbilityAttack:function(t,e,i){var a=t,n=new m;if(n.attacker=e,n.commandType=o.CommandType.ABILITY_ATTACK,n.actionType=a.getActionType(),n.target=i,a.getEffectType()===o.PowerType.FIX){var r=a.getEffectValue();n.power=parseInt(r)}else if(a.getEffectType()===o.PowerType.PER_BY_ATK||a.getEffectType()===o.PowerType.PER_BY_DEF){var s=e.getAtk()*a.getEffectValue()/100;n.power=parseInt(s)}else a.getEffectType()===o.PowerType.CONDITION_BURN?(n.power=parseInt(e.getAtk()),n.effectConditionType=parseInt(a.getEffectConditionType()),n.effectConditionList=a.getEffectConditionValue().split(","),n.effectConditionPowerUpRate=a.getEffectValue()/100):n.power=parseInt(e.getAtk());for(var c=[],l=0;l<i.length;l++)c.push(!0);return n.isHitList=c,n},aliveUnitExist:function(t){var e=!1;return t.forEach(function(t){t.isDead||(e=!0)},this),e},addDamageRecord:function(t,e){t.damageArr.push(e),t.attacker.isEnemy?a.playerTotalDamageTaken+=e:a.playerTotalDamageGiven+=e},addBuffDamageRecord:function(t,e){t?a.playerTotalDamageGiven+=e:a.playerTotalDamageTaken+=e},getNormalAttackPower:function(t){var e=n.getRandomArbitrary(1-h.BASE_DAMAGE_RANGE,1+h.BASE_DAMAGE_RANGE);return t.getAtk()*e},calculateBaseDamage:function(t,e,i){var a=parseInt(t*e);return a-=i.getDef(),a=n.clamp(a,1,a)},getCounterActionQuery:function(t,e,i,n,o){cc.log("\u30ab\u30a6\u30f3\u30bf\u30fc\u30c0\u30e1\u30fc\u30b8 = "+n);var r=a.UI_M,u=a.GM.gameRoot.poolManager,h=t.attacker,d=t.damageType,p=new c,m=new s,_=new c,g=new Map;return h.decreaseHp(n),h.processDamageShow(_,h.curHp,n,d,!1,!1),(g={}).targetNode=e.get_EffectShowNode(),g.parentNode=r.buffEffectNode,g.buffType=i.type,_.addAction(new l(g,u.playBuffInvokeEffect_Instant.bind(u))),m.addQuery(_),h.processAfterAttack(m,!1,!1),(g={}).effectQueue=m,p.addAction(new l(g,h.playLocalEffectqueue.bind(h))),p},checkCritical:function(t){return n.getRandomArbitrary(0,100)<=100*h.BASE_CRITICAL_CHANCE_RATE+t.get_CriticalChanceRate()},checkCriticalByUnison:function(t){var e=n.getRandomArbitrary(0,100),i=100*h.BASE_CRITICAL_CHANCE_RATE,a=0,r=t.deckUnit.supportChara.myEquipmentList;for(var s in r){var c=r[s];if(c.getTriggerType()===o.TriggerType.IN_BATTLE_ALL_TIMES){var l=c.getBattleActionList();for(var u in l){var d=l[u];d.getActionType()===o.BuffType.CRITICAL_CHANCE_UP&&(a+=d.getEffectValue())}}}return e<=i+a},checkInvoke:function(t){var e=t.getOccurrenceRate();if(void 0!==e&&e>0&&e<100&&n.getRandomArbitrary(0,100)>e)return!1;return!0},checkSuccess:function(t,e,i,a){var r=t.getActionType(),s=t.getSuccessRate(),c=n.getRandomArbitrary(0,100);0!==s&&void 0!==s||(s=100);var l=0,u=0;return r>=o.BadConditionBuffRange.MIN&&r<=o.BadConditionBuffRange.MAX&&(l=e.get_CastBadConditionChance(a),u=i.get_PreventBadConditionChance()),c<=s+l-u},checkPlaySubQueue:function(t,e){var i=e.curSubAction,a=e.attacker,n=e.curTarget,o=e.isSupportEquipment;this.checkSuccess(i,a,n,o)?e.effectQueue.play(t):t()},excuteSubAction:function(t,e,i,n,r,u){var d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=a.GM.gameRoot.poolManager,m=new c,_={},g=a.UI_M,C=e.getActionType();if((_={}).attackerUnit=i,_.targetUnit=n,_.parentNode=g.effectCenter,_.waitTime=h.BUFF_EFFECT_SHOW_WAITTIME/a.cur_GameSpeed,_.actionType=C,_.power=e.getEffectValue(),(m=new c).addAction(new l(_,p.playActionInvoke1Effect.bind(p))),t.addQuery(m),(m=new c).addAction(new l(_,p.playActionInvoke3Effect.bind(p))),t.addQuery(m),m=new c,this.isBuffAction(C)&&this.isSuccessBuff(e,n,C)){var f=new s;return this.addBuff(f,e,i,n,r,u,p,m,_,g,C),m=new c,(_={}).effectQueue=f,_.curSubAction=e,_.attacker=i,_.curTarget=n,_.isSupportEquipment=d,m.addAction(new l(_,this.checkPlaySubQueue.bind(this))),void t.addQuery(m)}if(this.checkSuccess(e,i,n,d))switch(C){case o.ActionType.HEAL:this.executeSubActionHeal(t,e,i,n,r,u,p,m,_,g,C);break;case o.ActionType.HP_DRAIN:this.executeSubActionHpDrain(t,e,i,n,r,u,p,m,_,g,C);break;case o.ActionType.CANCEL_BUFF:case o.ActionType.CANCEL_DEBUFF:this.executeSubActionCancelBuff(t,e,i,n,r,u,p,m,_,g,C);break;case o.ActionType.RESURRECTION:this.executeSubActionResurrection(t,e,i,n,r,u,p,m,_,g,C);break;case o.ActionType.INCREASE_SKILL_RATE:this.executeSubActionIncreseSkillRate(t,e,i,n,r,u,p,m,_,g,C)}},isBuffAction:function(t){var e=!1;return t>o.ActionType.BUFF_MIN_VALUE&&t<o.ActionType.BUFF_MAX_VALUE&&(e=!0),e},isSuccessBuff:function(t,e,i){var a=!0;if(e.unitType==o.UnitType.PLAYER_UNIT)return a;var r=i,s=this.getBuffNameFromBuffType(r);if("statusDebuff"==s&&t.getEffectValue()>=0)return a;var c=e.getResistData()[s];void 0!==c&&c>0&&(n.getRandomArbitrary(0,100)<c&&(a=!1));return a},getBuffNameFromBuffType:function(t){switch(t){case o.BuffType.ATK_CHANGE:case o.BuffType.DEF_CHANGE:case o.BuffType.ATK_CHANGE_STOCKABEL:case o.BuffType.DEF_CHANGE_STOCKABLE:return"statusDebuff";case o.BuffType.POISON:return"poison";case o.BuffType.PARALYSIS:return"paralysis";case o.BuffType.STUN:return"stun";case o.BuffType.SLEEP:return"sleep";case o.BuffType.CONFUSE:return"confuse";case o.BuffType.DARKNESS_ON_NORMAL_ATTK:case o.BuffType.DARKNESS_ON_ALL:return"darkness";case o.BuffType.ADD_DEBUFF_TURN:return"addDebuffTurn";case o.BuffType.ZOMBIE:return"zombie";case o.BuffType.CURSE:return"curse";case o.BuffType.DEATH_SENTENCE:return"deathSentence";case o.BuffType.SEAL_SKILL:return"sealSkill";case o.BuffType.SEAL_PLUS_SKILL_RATE:return"sealPlusSkillRate"}},addBuff:function(t,e,i,n,o,r,s,u,d,p,m){var _=this.createBuffFromSubAction(e,i,m,o,r);(d={}).targetNode=n.get_EffectShowNode(),d.parentNode=p.effectCenter,d.waitTime=h.BUFF_EFFECT_SHOW_WAITTIME/a.cur_GameSpeed,d.actionType=_.type,d.power=_.power,u.addAction(new l(d,s.playActionHitEffect.bind(s))),t.addQuery(u),u=new c,_.spriteFrameIcon=s.getSpriteFrameIcon(_),(d={}).buff=_,u.addAction(new l(d,n.action_addBuff.bind(n))),_.isBadConditionBuff()&&a.curActionData&&((d={}).curTarget=n,d.curActionData=a.curActionData,u.addAction(new l(d,this.addBadConditionUnitList.bind(this)))),t.addQuery(u)},addBadConditionUnitList:function(t,e){var i=e.curTarget;e.curActionData.addedBadConditionUnitList.push(i),t()},executeSubActionHeal:function(t,e,i,a,r,u,h,d,p,m,_){if(!a.isDead){var g=0;g=e.getEffectType()===o.PowerType.PER_BY_DEF?a.getMaxHp()*e.getEffectValue()/100:e.getEffectValue(),g*=1+a.get_RecoveryPowerOnHeal();var C=e.getEffectLimit();if(void 0!==C&&C>0)C+=a.get_RecoveryLimitOnHeal(),g=n.clamp(g,1,C);if(g=n.clamp(g,1,a.getMaxHp()),a.hasBuff(o.BuffType.ZOMBIE)){cc.log("zombie buff has  ");var f=new s;d=new c,g=a.checkImmortal(g),a.decreaseHp(g),a.processDamageShow(d,a.curHp,o.DamageType.NONE,g,!1,!1),a.processAfterAttack(f,!1,!1),d=new c,(p={}).effectQueue=f,d.addAction(new l(p,a.playLocalEffectqueue.bind(a))),t.addQuery(d)}else a.hasBuff(o.BuffType.CURSE)||(a.beHealed(d,g),t.addQuery(d))}},executeSubActionHpDrain:function(t,e,i,o,r,s,c,l,u,h,d){var p=0,m=a.curActionData;for(var _ in m.damageArr)m.damageArr.hasOwnProperty(_)&&(p+=m.damageArr[_]);var g=parseInt(p*e.getEffectValue()/100);g=n.clamp(g,1,o.getMaxHp()),o.beHealed(l,g),t.addQuery(l)},executeSubActionCancelBuff:function(t,e,i,n,r,s,c,u,d,p,m){var _=Array.from(n.buffList),g=[];for(var C in _){var f=null;_.hasOwnProperty(C)&&((f=_[C]).endType===o.BuffEndType.NO_END&&f.endType===o.BuffEndType.STATIC_BUFF||(m===o.ActionType.CANCEL_BUFF&&f.isGoodBuff()?g.push(f):m===o.ActionType.CANCEL_DEBUFF&&!1===f.isGoodBuff()&&g.push(f)))}var E=e.getEffectConditionType();if(0===E&&(E=o.EffectConditionType.BUFF_TARGET_TYPE_ALL),E===o.EffectConditionType.BUFF_TARGET_TYPE_ALL)for(var T in g){var S=g[T];(d={}).buff=S,u.addAction(new l(d,n.action_removeBuff.bind(n)))}else if(E===o.EffectConditionType.BUFF_TARGET_TYPE_ONE_BY_FROM_RECENT){var R=e.getEffectConditionValue(),A=g.reverse();if(void 0!==R&&R>0)for(var b in A){if(R<=0)break;var M=null;A.hasOwnProperty(b)&&(M=A[b]),(d={}).buff=M,u.addAction(new l(d,n.action_removeBuff.bind(n))),R--}}else if(E===o.EffectConditionType.BUFF_TARGET_TYPE_PARTICULAR){var v=e.getEffectConditionValue();if(void 0!==v&&v>0)for(var P in g){var I=null;g.hasOwnProperty(P)&&(I=g[P]),I.type===v&&((d={}).buff=I,u.addAction(new l(d,n.action_removeBuff.bind(n))))}}(d={}).targetNode=n.get_EffectShowNode(),d.parentNode=p.effectCenter,d.actionType=o.ActionType.CANCEL_BUFF,d.waitTime=h.CANCEL_BUFF_EFFECT_WAITTIME/a.cur_GameSpeed,d.power=0,u.addAction(new l(d,c.playActionHitEffect.bind(c))),t.addQuery(u)},executeSubActionResurrection:function(t,e,i,a,r,s,c,l,u,h,d){var p;p=e.getEffectType()===o.PowerType.PER_BY_DEF?a.getMaxHp()*e.getEffectValue()/100:e.getEffectValue(),p=n.clamp(p,1,a.getMaxHp()),a.beRevive(l,p),t.addQuery(l)},executeSubActionIncreseSkillRate:function(t,e,i,a,o,r,s,c,u,h,d){var p=e.getEffectValue();a.curSkillRate+=p,a.curSkillRate=n.clamp(a.curSkillRate,0,100);var m={};m.skillRate=a.curSkillRate,c.addAction(new l(m,a.unitController.playSetSkillRate.bind(a.unitController))),t.addQuery(c)},createBuffFromSubAction:function(t,e,i,a,n){var r=i,s=e.getAtk(),c=0,l=t.getEffectType(),h=a;switch(l){case o.PowerType.PER_BY_ATK:case o.PowerType.FIX:case o.PowerType.PER_BY_DEF:case o.PowerType.PER_BY_DAMAGE:case o.PowerType.CHANGE_TO:case o.PowerType.MIN_MAX_LIMIT_RANDOM:c=t.getEffectValue(),l=t.getEffectType();break;case o.PowerType.CONDITION_BURN:c=s*t.getEffectValue()/100}var d=String(t.getEndValue()).split("."),p=Number(d[0]),m=new u(e,h,r,l,c,n,t.getEndType(),p);r!==o.BuffType.ATK_CHANGE_BY_ELEMENT&&r!==o.BuffType.DAMAGE_CHANGE_BY_ELEMENT||(m.elementType=t.getEffectConditionValue(),void 0===m.elementType&&(m.elementType=0));var _=t.getEffectConditionType(),g=t.getEffectConditionValue();_&&(m.invokeType=_,m.invokeVal=g),d.length>1&&(m.endValSub=Number(d[1]));var C=t.getEffectLimit();return C&&(m.powerValSub=C),m},addBuffFromSubAction:function(t,e,i,a,n){var r=t.getActionType();if(r>o.ActionType.BUFF_MIN_VALUE&&r<o.ActionType.BUFF_MAX_VALUE||r===p.EFFECT_TYPE.HP_RATE||r===p.EFFECT_TYPE.ATK_RATE||r===p.EFFECT_TYPE.DEF_RATE){var s=this.createBuffFromSubAction(t,e,r,a,n);i.addBuff(s)}},checkTriggerInGameLoop:function(t){var e=a.GM,i=a.curActionData,n=[];if(!1===this.checkPassSituation(t))return!1;if(t===o.TriggerType.WAVE_START||t===o.TriggerType.BOSS_WAVE_START||t===o.TriggerType.GENERAL_TURN_START||t===o.TriggerType.GENERAL_TURN_END||t===o.TriggerType.ON_LESS_THAN_HP)n=(n=n.concat(Array.from(r.getUnitList(!a.isNowPlayerTurn)))).concat(Array.from(r.getUnitList(a.isNowPlayerTurn)));else if(t===o.TriggerType.MY_TURN_START||t===o.TriggerType.MY_TURN_END)n=n.concat(Array.from(r.getUnitList(!a.isNowPlayerTurn)));else if(t===o.TriggerType.ENEMY_TURN_START||t===o.TriggerType.ENEMY_TURN_END)n=n.concat(Array.from(r.getUnitList(a.isNowPlayerTurn)));else if(t===o.TriggerType.ON_ATTACK_OUR_UNIT){var s=i.attacker,c=r.getUnitList(s.isEnemy);for(var l in c){s!==(L=c[l])&&(n=n.concat(L))}}else if(t===o.TriggerType.BE_ATTACKED_OUR_UNIT){s=i.attacker,c=r.getUnitList(s.isEnemy);var u=i.target;for(var l in c){var h=c[l];for(var p in u){var m=u[p];for(var _ in c){h!==(f=c[_])&&(f===m&&-1===n.indexOf(h)&&(n=n.concat(h)))}}}}else if(t===o.TriggerType.ON_KILL_ENEMY){s=i.attacker;var g=i.deadUnitList;for(var l in g){(C=g[l]).isDead&&C.isEnemy!==s.isEnemy&&-1===n.indexOf(s)&&(n=n.concat(s))}}else if(t===o.TriggerType.BE_KILLED_OUR_UNIT){s=i.attacker,c=r.getUnitList(!s.isEnemy),g=i.deadUnitList;for(var l in g){var C=g[l];for(var p in c){(h=c[p])!==C&&(C.isEnemy===h.isEnemy&&-1===n.indexOf(h)&&(n=n.concat(h)))}}}else if(t===o.TriggerType.ON_SKILL_OUR_UNIT){s=i.attacker,c=r.getUnitList(s.isEnemy);for(var l in c){(f=c[l])!==s&&(-1===n.indexOf(f)&&(n=n.concat(f)))}}else if(t===o.TriggerType.ON_SKILL_ENEMY_UNIT||t===o.TriggerType.BE_ATTACKED_BY_ALL_TARGET_ATTACK){s=i.attacker,c=r.getUnitList(!s.isEnemy);for(var l in c){var f=c[l];-1===n.indexOf(f)&&(n=n.concat(f))}}else if(t===o.TriggerType.BE_ATTACKED_COUNTER_IN_TURN){s=i.attacker,c=r.getUnitList(!s.isEnemy),u=i.target;for(var l in c){h=c[l];for(var p in u){h===u[p]&&-1===n.indexOf(h)&&(n=n.concat(h))}}}else if(t===o.TriggerType.BE_CATCH_BAD_CONDITION){var E=i.addedBadConditionUnitList;for(var p in E){(R=E[p]).isDead||-1!==n.indexOf(R)||(n=n.concat(R))}}else if(t===o.TriggerType.ON_CATCH_BAD_CONDITION_ENEMY){var T=i.addedBadConditionUnitList;for(var l in T=(T=T.concat(Array.from(r.getUnitList(!a.isNowPlayerTurn)))).concat(Array.from(r.getUnitList(a.isNowPlayerTurn)))){var S=T[l];E=i.addedBadConditionUnitList;for(var p in E){var R=E[p];S.isDead||S.isEnemy===R.isEnemy||-1!==n.indexOf(S)||(n=n.concat(S))}}}for(var A=e.abilityController,b=0;b<n.length;b++){if(!(L=n[b]).isDead){var M=L.battleAbilityMainList;if(M)for(var v=0;v<M.length;v++){var P=M[v];A.checkTiming(P,t,L)&&A.excuteAbility(L,P,d.ROLE_TYPE.MAIN,!0)}if(L.battleAbilitySupportList&&L.deckUnit.supportChara){var I=L.battleAbilitySupportList;if(I)for(var y=0;y<I.length;y++){var N=I[y];A.checkTiming(N,t,L)&&(cc.log("support Ability"),A.excuteAbility(L,N,d.ROLE_TYPE.SUPPORT,!0))}}}}var B=e.equipmentController;for(b=0;b<n.length;b++){var L;if(!(L=n[b]).isDead&&L.unitType===o.UnitType.PLAYER_UNIT){var w=new Array;for(var p in w.concat(L.deckUnit.mainChara.myEquipmentList),w){var D=w[p];B.checkTiming(D,t,L)&&(B.excuteEquipmentEffect(L,D,p,!1)&&!0)}}}},checkPassSituation:function(t){var e,i,n,s,c;return t===o.TriggerType.ON_ATTACK_OUR_UNIT||t===o.TriggerType.BE_ATTACKED_OUR_UNIT||t===o.TriggerType.BE_ATTACKED_COUNTER_IN_TURN||t===o.TriggerType.BE_KILLED_OUR_UNIT||t===o.TriggerType.ON_KILL_ENEMY?!!(e=a.curActionData)&&(!!(i=e.attacker)&&(e.commandType===o.CommandType.ATTACK||e.commandType===o.CommandType.USE_SKILL&&(!!(n=i.mySkill)&&(!!(s=n.actionList[0])&&(!!(c=s.getActionType())&&c===o.ActionType.ATTACK))))):t===o.TriggerType.BOSS_WAVE_START?r.chackBossWave():t===o.TriggerType.ON_SKILL_OUR_UNIT||t===o.TriggerType.ON_SKILL_ENEMY_UNIT?!!(e=a.curActionData)&&e.commandType===o.CommandType.USE_SKILL:t!==o.TriggerType.BE_ATTACKED_BY_ALL_TARGET_ATTACK||!!(e=a.curActionData)&&(e.commandType===o.CommandType.USE_SKILL&&(!!(i=e.attacker)&&(!!(n=i.mySkill)&&(!!(s=n.actionList[0])&&(!!(c=s.getActionType())&&(c===o.ActionType.ATTACK&&s.getTargetType()===o.TargetRange.ENEMY_ALL))))))},playEffectqueue:function(t,e){e.effectQueue.play(t)},addQueryToWaitQueryList:function(t){this.effectQueryList.push(t)},executeQueryListToMainQueue:function(){var t=a.GM.effectQueue,e=this.effectQueryList;for(var i in e){var n=null;e.hasOwnProperty(i)&&(n=e[i]),t.addQuery(n)}this.effectQueryList=[]}});e.exports={ActionData:m,ActionController:_},cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",Buff:"Buff",CommonFunction:"CommonFunction",DeckConst:"DeckConst",EnumTypes:"EnumTypes",EquipmentConst:"EquipmentConst",GameConst:"GameConst",GameEffectQueue:"GameEffectQueue"}],AdvCommandTypeList:[function(t,e,i){"use strict";cc._RF.push(e,"c071duVhexMoo748EGs/YvA","AdvCommandTypeList");var a=t("CommandMessage"),n=t("CommandFadeInBlack"),o=t("CommandFadeOutBlack"),r=t("CommandFadeInWhite"),s=t("CommandFadeOutWhite"),c=t("CommandSlideInBlack"),l=t("CommandSlideOutBlack"),u=t("CommandBg"),h=t("CommandBgOff"),d=t("CommandSpine"),p=t("CommandSpineOff"),m=t("CommandSprite"),_=t("CommandSpriteAtlas"),g=t("CommandSpriteOff"),C=t("CommandShake"),f=t("CommandFlash"),E=t("CommandName"),T=t("CommandCharacter"),S=t("CommandCharacterOff"),R=t("CommandPlayBgm"),A=t("CommandStopBgm"),b=t("CommandPlaySe"),M=t("CommandStopSe"),v=t("CommandPlayVoice"),P=t("CommandStopVoice"),I=t("CommandPlayMovie"),y=t("CommandPlayMovieOff"),N=t("CommandAnimation"),B=t("CommandClickWait"),L=t("CommandWait"),w=t("CommandEndWait"),D=t("CommandSelect"),U=t("CommandIf"),F=t("CommandElseIf"),O=t("CommandEndIf"),k=t("CommandVal"),x=t("CommandImageConfig"),V=t("CommandMask"),G=t("CommandWindowUI");e.exports={msg:a,fadeinblack:n,fadeoutblack:o,fadeinwhite:r,fadeoutwhite:s,slideinblack:c,slideoutblack:l,bg:u,bgoff:h,spine:d,spineoff:p,sprite:m,spriteatlas:_,spriteoff:g,shake:C,flash:f,name:E,character:T,characteroff:S,playbgm:R,stopbgm:A,playse:b,stopse:M,playvoice:v,stopvoice:P,movie:I,movieoff:y,anm:N,clickwait:B,wait:L,endwait:w,select:D,if:U,elseif:F,endif:O,val:k,imgconf:x,mask:V,msgwin:G},cc._RF.pop()},{CommandAnimation:"CommandAnimation",CommandBg:"CommandBg",CommandBgOff:"CommandBgOff",CommandCharacter:"CommandCharacter",CommandCharacterOff:"CommandCharacterOff",CommandClickWait:"CommandClickWait",CommandElseIf:"CommandElseIf",CommandEndIf:"CommandEndIf",CommandEndWait:"CommandEndWait",CommandFadeInBlack:"CommandFadeInBlack",CommandFadeInWhite:"CommandFadeInWhite",CommandFadeOutBlack:"CommandFadeOutBlack",CommandFadeOutWhite:"CommandFadeOutWhite",CommandFlash:"CommandFlash",CommandIf:"CommandIf",CommandImageConfig:"CommandImageConfig",CommandMask:"CommandMask",CommandMessage:"CommandMessage",CommandName:"CommandName",CommandPlayBgm:"CommandPlayBgm",CommandPlayMovie:"CommandPlayMovie",CommandPlayMovieOff:"CommandPlayMovieOff",CommandPlaySe:"CommandPlaySe",CommandPlayVoice:"CommandPlayVoice",CommandSelect:"CommandSelect",CommandShake:"CommandShake",CommandSlideInBlack:"CommandSlideInBlack",CommandSlideOutBlack:"CommandSlideOutBlack",CommandSpine:"CommandSpine",CommandSpineOff:"CommandSpineOff",CommandSprite:"CommandSprite",CommandSpriteAtlas:"CommandSpriteAtlas",CommandSpriteOff:"CommandSpriteOff",CommandStopBgm:"CommandStopBgm",CommandStopSe:"CommandStopSe",CommandStopVoice:"CommandStopVoice",CommandVal:"CommandVal",CommandWait:"CommandWait",CommandWindowUI:"CommandWindowUI"}],AdvCommandTypeResourceList:[function(t,e,i){"use strict";function a(t,e){}function n(t,e){return 0!==t[1].indexOf("color_")?e(t[1],cc.SpriteFrame):void 0}function o(t,e){return e(t[1],cc.AudioClip)}cc._RF.push(e,"f21e3/h7v5MPqLfrvjbfHYo","AdvCommandTypeResourceList"),e.exports={msg:a,fadeinblack:a,fadeoutblack:a,fadeinwhite:a,fadeoutwhite:a,slideinblack:a,slideoutblack:a,bg:n,bgoff:a,spine:function(t,e){return e(t[1],sp.SkeletonData)},spineoff:a,sprite:n,spriteatlas:function(t,e){return e(t[1],cc.SpriteAtlas)},spriteoff:a,shake:a,flash:a,name:a,character:n,characteroff:a,playbgm:o,stopbgm:a,playse:o,stopse:a,playvoice:function(t,e){return e(t[2],cc.AudioClip)},movie:function(t,e){var i=t[1].split(":");return _.forEach(i,function(t){e(t,cc.VideoPlayer)})},stopvoice:a,anm:a,clickwait:a,wait:a,endwait:a,select:a,if:a,elseif:a,endif:a,val:a,imgconf:a,mask:a},cc._RF.pop()},{}],AdvCommonButton:[function(t,e,i){"use strict";cc._RF.push(e,"20561+aA/xGYavW8kgVKrc2","AdvCommonButton");var a=cc.Enum({TAP:0,OVER:1,LEAVE:2});cc.Class({extends:cc.Button,properties:{bPropagationStopped:!0,activeImageNode:cc.Node,inactiveImageNode:cc.Node,tapAnimation:cc.Animation},_overEventFunc:null,_leaveEventFunc:null,_tapEventFunc:null,_touchStartEventFunc:null,_touchMoveEventFunc:null,_touchMoveEndEventFunc:null,_longTapEventFunc:null,_longTapEndEventFunc:null,_touchCancelEventFunc:null,_isTouching:!1,_isLongTapEnable:!1,_isMoved:!1,_moveStartDistance:!1,onLoad:function(){this._initCommonButton()},_initCommonButton:function(){this._moveStartDistance=this._moveStartDistance?this._moveStartDistance:0},switchBtnImage:function(t){this.activeImageNode&&(this.activeImageNode.active=t),this.inactiveImageNode&&(this.inactiveImageNode.active=!t)},getBtnImageSwitchState:function(){return this.activeImageNode?this.activeImageNode.active:this.inactiveImageNode?!this.inactiveImageNode.active:this.node.active},showDevelopmentText:function(t,e,i){},setOverEvent:function(t,e){this._overEventFunc=t,this._leaveEventFunc=e,this._setOverEventListener()},setTapEvent:function(t){this._tapEventFunc=t,this._setTouchEventListener(),this.tapAnimation&&this.tapAnimation.on("finished",function(t,e){e.name===this.tapAnimation.getClips()[a.TAP].name&&this._tapEventFunc()},this)},setTouchStartEvent:function(t){this._touchStartEventFunc=t,this._setTouchStartEventListener()},setTouchMoveEvent:function(t,e){this._touchMoveEventFunc=t,this._moveStartDistance=e||0,this._setTouchMoveEventListener()},setTouchMoveEndEvent:function(t){this._touchMoveEndEventFunc=t,this._setTouchMoveEndEventListener()},setLongTapEvent:function(t){this._longTapEventFunc=t,this._setLongTapEventListener()},setLongTapEndEvent:function(t){this._longTapEndEventFunc=t,this._setLongTapEventListener()},setTouchCancelEvent:function(t){this._touchCancelEventFunc=t,this._setTouchCancelEventListener()},setTouchEnable:function(t){t?this._setAllListener():(this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseOver,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this),this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoveNow,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this))},_setAllListener:function(){this._tapEventFunc&&this._setTouchEventListener(),this._longTapEventFunc&&this._setLongTapEventListener(),this._longTapEndEventFunc&&this._setLongTapEndEventListener(),this._touchStartEventFunc&&this._setTouchStartEventListener(),this._touchMoveEventFunc&&this._setTouchMoveEventListener(),this._touchMoveEndEventFunc&&this._setTouchMoveEndEventListener(),this._touchCancelEventFunc&&this._setTouchCancelEventListener(),this._overEventFunc&&this._leaveEventFunc&&this._setOverEventListener()},_setOverEventListener:function(){this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseOver,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this)},_setTouchEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this)},_setTouchStartEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this)},_setLongTapEventListener:function(){this._isLongTapEnable=!0,this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this)},_setLongTapEndEventListener:function(){this._isLongTapEnable=!0,this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this)},_setTouchMoveEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoveNow,this)},_setTouchMoveEndEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoveNow,this)},_setTouchCancelEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},_onMouseOver:function(t){cc.log("mouse over"),this.tapAnimation&&this.tapAnimation.getClips()[a.OVER]&&(this.tapAnimation.playAdditive(this.tapAnimation.getClips()[a.OVER].name).wrapMode=cc.WrapMode.Normal),this._overEventFunc&&this._overEventFunc(t)},_onMouseLeave:function(t){cc.log("mouse leave"),this.tapAnimation&&(this.tapAnimation.getClips()[a.LEAVE]?this.tapAnimation.playAdditive(this.tapAnimation.getClips()[a.LEAVE].name):this.tapAnimation.getClips()[a.OVER]&&(this.tapAnimation.playAdditive(this.tapAnimation.getClips()[a.OVER].name).wrapMode=cc.WrapMode.Reverse)),this._endTouchProcess(),this._leaveEventFunc&&this._leaveEventFunc(t)},_onTouchStart:function(t){cc.log("touch start");var e=cc.sequence(cc.delayTime(1),cc.callFunc(function(){this._isTouching&&this._onLongTap(t)},this));e.setTag(99),this.node.runAction(e),this._isTouching=!0,this._isMoved=!1,this._touchStartEventFunc&&this._touchStartEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onTouchMoveNow:function(t){cc.log("touch move"),this._touchMoveEventFunc&&this._isMoveStarted(t)&&this._touchMoveEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onTouchMoveEnd:function(t){cc.log("touch move end"),this._touchMoveEndEventFunc&&this._touchMoveEndEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onTouchEnd:function(t){!this._isLongTapEnable||this._isTouching?(cc.log("touch end"),this._endTouchProcess(),this._isMoved?this._onTouchMoveEnd(t):(this.tapAnimation&&!cc.director.isPaused()?this.tapAnimation.playAdditive(this.tapAnimation.getClips()[a.TAP].name):this._tapEventFunc&&this._tapEventFunc(t),this.bPropagationStopped&&t.stopPropagation())):this._onLongTapEnd(t)},_onLongTap:function(t){cc.log("long tap"),this._endTouchProcess(),this._longTapEventFunc&&this._longTapEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onLongTapEnd:function(t){cc.log("long tap end"),this._endTouchProcess(),this._longTapEndEventFunc&&this._longTapEndEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onTouchCancel:function(t){cc.log("touch cancel"),this._endTouchProcess(),this._touchCancelEventFunc&&this._touchCancelEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_endTouchProcess:function(){this._isTouching=!1,this.node.stopActionByTag(99)},_isMoveStarted:function(t){return!this._isMoved&&this._isOverForMoveStartDistance(t)&&(this._isMoved=!0),this._isMoved},_isOverForMoveStartDistance:function(t){var e=t.getStartLocation(),i=t.getLocation(),a=Math.abs(e.x-i.x),n=Math.abs(e.y-i.y);return Math.max(a,n)>this._moveStartDistance}});cc._RF.pop()},{}],AdvCommonScrollView:[function(t,e,i){"use strict";cc._RF.push(e,"dadbbYv1cBFQLoA8zCe7IaD","AdvCommonScrollView");var a=t("AdvCommonButton");cc.Class({extends:cc.ScrollView,properties:{scrollHorizontalHandleBtn:a,scrollVerticalHandleBtn:a},_recentOffsetPos:null,_recentContentSize:null,onLoad:function(){this._init()},_init:function(){this._recentOffsetPos=cc.v2(0,0),this._recentContentSize=cc.v2(0,0),this.scrollHorizontalHandleBtn&&this.scrollHorizontalHandleBtn.setTouchMoveEvent(this._horizontalHandleEvent.bind(this)),this.scrollVerticalHandleBtn&&(this.scrollVerticalHandleBtn.setTouchMoveEvent(this._verticalHandleEvent.bind(this)),this._setVerticalHandleBtnPos(1)),this.elastic=!1},_horizontalHandleEvent:function(t){cc.log("horizontalHandleEvent"),cc.log(t)},_verticalHandleEvent:function(t){var e=this.scrollVerticalHandleBtn.node.parent,i=e.convertToNodeSpace(t.getLocation());i.y-=.5*e.getContentSize().height;var a=.5*e.getContentSize().height+-.5*this.scrollVerticalHandleBtn.node.getContentSize().height,n=-.5*e.getContentSize().height+.5*this.scrollVerticalHandleBtn.node.getContentSize().height;i.y>a?i.y=a:i.y<n&&(i.y=n);var o=this.scrollVerticalHandleBtn.node.getPosition();this.scrollVerticalHandleBtn.node.setPosition(cc.v2(o.x,i.y));var r=e.getContentSize().height-this.scrollVerticalHandleBtn.node.getContentSize().height,s=(i.y+.5*r)/r;this.scrollToPercentVertical(s,0,!0)},update:function(t){this._super(t),this._updateCommonScrollView(t)},_updateCommonScrollView:function(t){0===this.content.childrenCount&&(this.content.height=0),this._updateScrollBar(t)},_updateScrollBar:function(t){this._redrawVerticalHandleBtn(),this._recentOffsetPos=this.getScrollOffset()},_redrawVerticalHandleBtn:function(){if(this.getMaxScrollOffset().y<=0)return this._setVerticalHandleBtnPos(1),void(this.scrollVerticalHandleBtn.node.parent.active=!1);if(this.scrollVerticalHandleBtn.node.parent.active=!0,this._recentContentSize.height===this.content.height){if(this._recentOffsetPos.y!==this.getScrollOffset().y){a=this._getVerticalHandleBtnPosPercentage();this._setVerticalHandleBtnPos(a)}}else{this._recentContentSize=this.content.getContentSize();var t=.1*this.scrollVerticalHandleBtn.node.parent.getContentSize().height,e=this.scrollVerticalHandleBtn.node.parent.getContentSize().height,i=e*(e/this.content.height);i=Math.max(t,i),this.scrollVerticalHandleBtn.node.height=i;var a=this._getVerticalHandleBtnPosPercentage();this._setVerticalHandleBtnPos(a)}},_getVerticalHandleBtnPosPercentage:function(){var t=.5;return this.getMaxScrollOffset().y>0&&(this.scrollVerticalHandleBtn.node.active=!0,(t=this.getScrollOffset().y/this.getMaxScrollOffset().y)>1?t=1:t<0&&(t=0),t-=.5),t/=-.5},_setVerticalHandleBtnPos:function(t){var e=(.5*this.scrollVerticalHandleBtn.node.parent.getContentSize().height-.5*this.scrollVerticalHandleBtn.node.getContentSize().height)*t;this.scrollVerticalHandleBtn.node.setPosition(cc.v2(this.scrollVerticalHandleBtn.node.getPosition().x,e))},getCurrentVerticalScrollPercentage:function(){var t=this._getVerticalHandleBtnPosPercentage();return t=t-t/2+.5}});cc._RF.pop()},{AdvCommonButton:"AdvCommonButton"}],AdvConfigPopup:[function(t,e,i){"use strict";cc._RF.push(e,"d9f8b29kqxAeYtPZQjKklCK","AdvConfigPopup");var a=t("AdvSingleton"),n=t("AdvPopupBase"),o=t("AdvRichText"),r=t("AdvCommonButton"),s=t("AdvSoundSettingView");cc.Class({extends:n,properties:{soundSettingView:s,synopsisText:o,endBtn:r,closeBtnArray:[r]},_callbackToEndAdv:null,onLoad:function(){this._initButtons()},openAdvConfigPopup:function(t,e,i){this.setCloseCallBack(i),this.initAdvConfigPopup(t,e),this.synopsisText.node.active=!0,this.open()},initAdvConfigPopup:function(t,e){this._callbackToEndAdv=e,this.synopsisText.string=t},_initButtons:function(){this.endBtn.setTapEvent(this._endBtnEvent.bind(this));for(var t=0;t<this.closeBtnArray.length;t++)this.closeBtnArray[t].setTapEvent(this.close.bind(this))},_endBtnEvent:function(){this._callbackToEndAdv(a.soundManager.getSoundConfig()),this.close()}});cc._RF.pop()},{AdvCommonButton:"AdvCommonButton",AdvPopupBase:"AdvPopupBase",AdvRichText:"AdvRichText",AdvSingleton:"AdvSingleton",AdvSoundSettingView:"AdvSoundSettingView"}],AdvConstants:[function(t,e,i){"use strict";cc._RF.push(e,"7a50d4T5hRBQZvgO2CC8Dg7","AdvConstants"),e.exports={ADV_SUB_ROOT_PATH:"adv/prefab/window/AdvSubRoot",ADV_STORY_FILE_PATH:"adv/textfiles/story/",ADV_SYNOPSIS_FILE_PATH:"adv/textfiles/synopsis/",ADV_POPUP_OPEN_ANIM_CLIP_PATH:"animation/outGame/common/PopupWindow_Open_Anim",ADV_POPUP_CLOSE_ANIM_CLIP_PATH:"animation/outGame/common/PopupWindow_Close_Anim",ADV_COMMAND_STATE:cc.Enum({INIT:0,UPDATE:1,END:2}),ADV_PLAY_STATE:cc.Enum({INIT:0,PLAY:1,AUTO:2,SKIP:3,END:4}),ADV_PROCESS_STATE:cc.Enum({NONE:0,TRUE:1,FALSE:2,FALSE_NEST:3}),ADV_COMMAND_NAME:cc.Enum({IF:"if",ELSE_IF:"elseif",END_IF:"endif",WAIT:"wait",END_WAIT:"endwait",MESSAGE:"msg",CLICK_WAIT:"clickwait",SELECT:"select",DISP_BG:"bg",DISP_SPINE:"spine",DISP_SPRITE:"sprite",DISP_SPRITE_ATLAS:"spriteatlas",DISP_CHARACTER:"character",PLAY_BGM:"playbgm",PLAY_SE:"playse",PLAY_VOICE:"playvoice",PLAY_MOVIE:"playmovie"}),ADV_LOG_TAG:cc.Enum({PLAIN:"0",VOICE:"1",SELECT:"2"}),SELECT_KEY:"select",ADV_TEXT_LENGTH_MAX:99,ADV_MESSAGE_SPEED:.04,ADV_AUTO_SPEED:1.5,ADV_SKIP_RATE:.05},cc._RF.pop()},{}],AdvCustomConstants:[function(t,e,i){"use strict";cc._RF.push(e,"261fdw09sVBq5DoyXzTo3hz","AdvCustomConstants"),e.exports={ADV_COMMAND_NAME:cc.Enum({DISP_ROOM_BG:"roombg",DISP_TUTORIAL:"tutorial"}),DEBUG_ROOM_BG_FILE_NAME:"download/bg/bg0016"},cc._RF.pop()},{}],AdvData:[function(t,e,i){"use strict";cc._RF.push(e,"03961sVxJpMs6Ju6xV+XA8S","AdvData");var a=t("AdvConstants");cc.Class({advTextInfoArray:null,playerName:null,callbackEndAdv:null,callbackVisibleAdvSubRoot:null,callbackLoadingRes:null,loadResFunc:null,initialized:!1,commandList:null,messageCommandList:null,messageLogList:null,voiceLogMap:null,valueMap:null,requestResList:null,synopsisText:null,currentName:null,currentScenarioIndex:0,currentResourceCount:0,maxResourceCount:0,startCnt:0,cnt:0,falseNestCount:0,playState:0,processState:0,ctor:function(){this.advTextInfoArray=arguments[0],this.playerName=arguments[1],this.callbackEndAdv=arguments[2],this.callbackVisibleAdvSubRoot=arguments[3],this.callbackLoadingRes=arguments[4],this.loadResFunc=arguments[5],this.initialized=!1,this.commandList=[],this.messageCommandList=[],this.messageLogList=[],this.voiceLogMap={},this.movieLogMap={},this.valueMap={},this.requestResList={},this.synopsisText="",this.currentName="",this.currentScenarioIndex=0,this.currentResourceCount=0,this.maxResourceCount=0,this.startCnt=0,this.cnt=0,this.falseNestCount=0,this.playState=a.ADV_PLAY_STATE.INIT,this.processState=a.ADV_PROCESS_STATE.NONE}});cc._RF.pop()},{AdvConstants:"AdvConstants"}],AdvGameConst:[function(t,e,i){"use strict";cc._RF.push(e,"58a25JL/uhLlpDBPnfMcDwn","AdvGameConst"),cc.Class({statics:{Z_ORDER:cc.Enum({BG:-255,BACK_PARTICLE:-254,UI_HEADER:246,UI:247,UI_BACK_BUTTON:248,GRAY_BACK:252,POPUP:253,FRONT_PARTICLE:254,LOADING:255,SYSTEM_POPUP:256,BAND:257})}}),cc._RF.pop()},{}],AdvGameRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"d8dd5TIKURJSKvgxQKiTDxS","AdvGameRootBase");var a=t("AdvSingleton"),n=t("AdvSingletonConst"),o=t("AdvStaticResourceConst"),r=t("AdvUtils"),s=(t("AdvGameConst"),t("AdvSceneConst"),t("AdvLocalDataConst")),c=cc.Enum({INIT_DATA:0,LOOP_DATA:1,INIT_RESOURCE:2,LOOP_RESOURCE:3,INIT_SCENE:4,LOOP_SCENE:5});cc.Class({extends:cc.Component,_sceneState:0,_isCompleteData:!1,_requestResList:null,_requestStaticResList:null,requestURLCount:0,sceneTarget:null,sceneParam:void 0,_viewFunc:null,_viewParam:null,tapEffectManager:null,_loadView:null,_loadCountMax:0,_recentRemainLoadCount:0,ctor:function(){this._sceneState=c.INIT_DATA,this._requestResList={},this._requestStaticResList={},this.requestURLCount=0,this._resourceRemainLoadCount=0,this._loadCountMax=0,this._recentRemainLoadCount=0,this._isCompleteData=!1,Array.isArray(a.localData[s.SCENE_TRANSITION_TARGETS])||(a.localData[s.SCENE_TRANSITION_TARGETS]=[])},onLoad:function(){this._setErrorHandling(),this._setTapEffect()},initData:function(){},initResource:function(){},initialize:function(){},update:function(t){switch(this._sceneState){case c.INIT_DATA:cc.log("INIT_DATA"),this._initData(),this._initLoading(this.requestURLCount),this._sceneState=c.LOOP_DATA;break;case c.LOOP_DATA:this.requestURLCount!==this._recentRemainLoadCount&&(this._recentRemainLoadCount=this.requestURLCount,this._setLoadProgress(this._calcLoadProgress(this.requestURLCount))),this.requestURLCount<=0&&(this._sceneState=c.INIT_RESOURCE);break;case c.INIT_RESOURCE:cc.log("INIT_RESOURCE"),this.initResource(),this._initLoading(this._resourceRemainLoadCount),this._sceneState=c.LOOP_RESOURCE;break;case c.LOOP_RESOURCE:cc.log("LOOP_RESOURCE : "+this._resourceRemainLoadCount),this._resourceRemainLoadCount!==this._recentRemainLoadCount&&(this._recentRemainLoadCount=this._resourceRemainLoadCount,this._setLoadProgress(this._calcLoadProgress(this._resourceRemainLoadCount))),this._resourceRemainLoadCount<=0&&(this._sceneState=c.INIT_SCENE);break;case c.INIT_SCENE:cc.log("INIT_SCENE"),this._initScene(),this._sceneState=c.LOOP_SCENE;break;case c.LOOP_SCENE:this.callViewFunc(),this.updateChild(t)}},_initData:function(){this.initData(),this._initSceneTargetListener()},_addMask:function(){this.node.addComponent(cc.Mask)},_initLoading:function(t){},_addLoading:function(){},_activeLoading:function(){},_hideLoading:function(){},_initLoadProgress:function(){},_setLoadProgress:function(t){},_calcLoadProgress:function(t){return 1},callViewFunc:function(){if(null!==this._viewFunc){cc.log("_viewFunc = ",this._viewFunc);for(var t=0;t<this._viewFunc.length;t++)this._viewFunc[t](this,this._viewParam[t]);this._viewFunc=null}},_initScene:function(){this.initialize(),this._hideLoading(),cc.log("currentSceneName = ",this.getCurrentSceneName())},requestURL:function(t,e){cc.log("requestURL = "+t);var i=new XMLHttpRequest;i.open("GET",t),i.addEventListener("load",function(i){if(cc.log("url ="+t),cc.log(i.target.status),200===i.target.status){var a=JSON.parse(i.target.responseText);e.parse(a)}cc.log("end:"+t),this.requestURLCount--}.bind(this)),i.send(),this.requestURLCount++},requestRes:function(t,e,i){if(a.res[t])return cc.log("this file is already loaded { "+t+" }"),void(i&&i());this._requestResList[t]=e,this._resourceRemainLoadCount+=1,cc.log("advgamerootbase requestRes loadFile:"+t),cc.loader.loadRes(t,e,function(a,n){this._onLoadedRes(t,e,i,a,n)}.bind(this))},_onLoadedRes:function(t,e,i,n,o){if(cc.log("requestRes = "+t),this._resourceRemainLoadCount-=1,null!==n)return delete this._requestResList[t],void cc.log(n);a.res[t]=o,delete this._requestResList[t],i&&i()},getResource:function(t){return a.res[t]},_initSceneTargetListener:function(){Array.isArray(this.sceneTarget)&&this.sceneTarget.length>1&&("undefined"===this.sceneTarget[1]||void 0===this.sceneTarget[1]||null===this.sceneTarget[1]?this.sceneParam=void 0:this.sceneParam=this.sceneTarget[1])},pushScene:function(t,e,i,n){var o,c;if(i&&(o=JSON.stringify(i)),n&&(c=JSON.stringify(n)),e){var l=e+";"+c;a.localData[s.SCENE_TRANSITION_TARGETS].push(l)}if(t===this.getCurrentSceneName()){var u=r.getRoot();u.sceneParam=""===o||null===o||void 0===o?void 0:o,u.callSceneTargetListener(),u.callSceneStackListener()}else{var h=!1;this._changeScene(function(){h||(h=!0,cc.director.loadScene(t+".fire",function(){h=!1;var t=r.getRoot();t.sceneParam=""===o||null===o||void 0===o?void 0:o,t.callSceneStackListener()}))})}},popScene:function(t){var e=r.getRoot(),i=a.localData[s.SCENE_TRANSITION_TARGETS].pop();if(!t&&i){var n=i.split(";");if(n[0]===this.getCurrentSceneName())e.callSceneTargetListener(n[1]),e.callSceneStackListener();else{var o=!1;this._changeScene(function(){o||(o=!0,cc.director.loadScene(n[0]+".fire",function(){cc.log("popScene:loadScene\u6642\u306e\u7b2c2\u5f15\u6570",n),o=!1;var t=r.getRoot();t.sceneTarget=n,t.callSceneStackListener()}))})}}else e.callSceneStackListener()},_changeScene:function(t){var e=cc.director.getScene().getChildByName("Canvas"),i=e.getChildByName("HeaderParent"),a=e.getChildByName("SideMenuParent"),n=e.getChildByName("SubRootParent"),o=!1;if(i&&i.children[0]&&(i.children[0].getComponent(cc.Animation).play("GlobalHeader_End"),o=!0),a&&a.children[0]&&(a.children[0].getComponent(cc.Animation).play("SideMenu_End"),o=!0),n){var r=n.getComponent(cc.Animation);r&&(r.play("SubRoot_End"),o=!0)}if(!o)return this._activeLoading(),t();cc.director.getScheduler().schedule(function(){this._activeLoading(),t()},this,.2)},getCurrentSceneName:function(){return cc.director.getScene().name},clearScene:function(){a.localData[s.SCENE_TRANSITION_TARGETS]=[]},callSceneTargetListener:function(t){},callSceneTargetListenerBase:function(t,e){"undefined"!==t&&void 0!==t&&null!==t||(t=void 0),cc.log("param = ",t),cc.log("this.sceneParam = ",this.sceneParam);var i={};if(t)i=JSON.parse(t);else{if(!this.sceneParam)return void cc.log("\u5024\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093");i=JSON.parse(this.sceneParam)}this.sceneParam=i,this.setViewFuncAndParam(i,e)},setViewFuncAndParam:function(t,e){this._viewFunc=[],this._viewParam=[];for(var i=Object.keys(t),a=Object.keys(e),n=0;n<a.length;n++){for(var o=!0,r=0;r<i.length;r++)i[r]===a[n]&&(this._viewFunc.push(e[a[n]].open),this._viewParam.push(t[i[r]]),o=!1);o&&(this._viewFunc.push(e[a[n]].close),this._viewParam.push([]))}},checkSceneStack:function(){return a.localData[s.SCENE_TRANSITION_TARGETS].length>=1},callSceneStackListener:function(){},_initOpenFirstView:function(t){var e;e=this.sceneParam?this.sceneParam:JSON.stringify(t),this.callSceneTargetListener(e)},_setTapEffect:function(){r.getResource(o.TAP_EFFECT_PREFAB_PATH)&&(this.tapEffectManager=cc.instantiate(r.getResource(o.TAP_EFFECT_PREFAB_PATH)).getComponent("TapEffectManager"),this.tapEffectManager.init())},_setErrorHandling:function(t){var e=a[n.ERROR_MANAGER];e&&e.setErrorHandling(this,t)}});cc._RF.pop()},{AdvGameConst:"AdvGameConst",AdvLocalDataConst:"AdvLocalDataConst",AdvSceneConst:"AdvSceneConst",AdvSingleton:"AdvSingleton",AdvSingletonConst:"AdvSingletonConst",AdvStaticResourceConst:"AdvStaticResourceConst",AdvUtils:"AdvUtils"}],AdvLocalDataConst:[function(t,e,i){"use strict";cc._RF.push(e,"8afa2n58TpLl6lEp3dgIVXn","AdvLocalDataConst"),cc.Class({statics:{FILTER_CHECK_LIST:"filterCheckList",SORT_TYPE:"sortType",SORT_ORDER:"sortOrder",SELECT_QUEST_DECK_ORDER:"selectQuestDeckOrder",SELECT_WORLD_ID:"selectWorldId",SELECT_AREA_ID:"selectAreaId",SELECT_STAGE_ID:"selectStageId",NOW_DATETIME:"nowDateTime",PRE_SYSTEM_DATE:"preSystemDate",SCENE_TRANSITION_TARGETS:"sceneTransitionTargets",DMM_USER_INFO:"dmmUserInfo",GAME_SERVER_COMM_USER_ID:"gameServerCommUserId",GAME_SERVER_COMM_TOKEN:"gameServerCommToken",GAME_SERVER_COMM_SECRET:"gameServerCommSecret",GAME_SERVER_COMM_EXPIRES:"gameServerCommExpires",PAYMENT_IMAGE_URL:"paymentImageUrl",LOCAL_STORAGE_KEY:cc.Enum({NEWS_BUNNER:"newsBunnerOpen",SUB_MENU_BUNNER:"subMenuBunnerOpen",PLAY_SKILL_ANIMATION:"playSkillAnimation"}),LOCAL_STORAGE_GET_TYPE:cc.Enum({STRING:0,BOOLEAN:1,INTEGER:2,FLOAT:3})}}),cc._RF.pop()},{}],AdvLogMessageThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"eeda56xY/FNcKdsRXKtHZl2","AdvLogMessageThumbnail");var a=t("AdvCommonButton"),n=t("AdvRichText"),o=t("AdvConstants"),r=t("AdvSingleton"),s=t("AdvUtils");cc.Class({extends:cc.Component,properties:{voiceBtn:a,selectDispNode:cc.Node,nameRichText:n,messageRichText:n},initAdvLogThumbnail:function(t,e,i){this.nameRichText.setCustomText(e.nameText,o.ADV_TEXT_LENGTH_MAX);var a=this._deleteLineFeedCode(e.messageText);switch(this.messageRichText.setCustomText(a,o.ADV_TEXT_LENGTH_MAX),i?(this.voiceBtn.node.active=!0,this.voiceBtn.setTapEvent(function(){var t=s.getResource(i);t&&r.soundManager.playVoice(t)})):this.voiceBtn.node.active=!1,this.selectDispNode.active=!1,e.tag){case o.ADV_LOG_TAG.SELECT:this.selectDispNode.active=!0}},_deleteLineFeedCode:function(t){return t.replace(/\r?\n/g,"")}}),cc._RF.pop()},{AdvCommonButton:"AdvCommonButton",AdvConstants:"AdvConstants",AdvRichText:"AdvRichText",AdvSingleton:"AdvSingleton",AdvUtils:"AdvUtils"}],AdvLogPopup:[function(t,e,i){"use strict";cc._RF.push(e,"b12772N8n1CJ5ehO3OUr1bo","AdvLogPopup");var a=t("AdvPopupBase"),n=t("AdvCommonScrollView"),o=t("AdvCommonButton"),r=t("AdvConstants");cc.Class({extends:a,properties:{scrollView:n,closeBtnArray:[o],advLogMessageThumbnailPrefab:cc.Prefab},openAdvLogPopup:function(t,e,i,a){this.setCloseCallBack(a),this.scrollView.node.active=!1,this._initButtons(),this._initLogScrollView(t,e,i),this.open(function(){this.scrollView.node.active=!0,this.scrollView.scrollToBottom(0)}.bind(this))},_initButtons:function(){for(var t=0;t<this.closeBtnArray.length;t++)this.closeBtnArray[t].setTapEvent(this.close.bind(this))},_initLogScrollView:function(t,e,i){for(var a=0,n="",o=0;o<e.length;o++){switch(e[o].tag){case r.ADV_LOG_TAG.VOICE:Array.isArray(i[e[o].tag])&&i[e[o].tag][a]?(n=""+i[e[o].tag][a].voiceFileName,a+=1):n="";break;default:n=""}var s=cc.instantiate(this.advLogMessageThumbnailPrefab).getComponent("AdvLogMessageThumbnail");s.initAdvLogThumbnail(t,e[o],n),this.scrollView.content.addChild(s.node)}}}),cc._RF.pop()},{AdvCommonButton:"AdvCommonButton",AdvCommonScrollView:"AdvCommonScrollView",AdvConstants:"AdvConstants",AdvPopupBase:"AdvPopupBase"}],AdvManager:[function(require,module,exports){"use strict";cc._RF.push(module,"6c500fFtGRODoUuZNzyfpVH","AdvManager");var Async=require("Async"),AdvUtils=require("AdvUtils"),AdvConstants=require("AdvConstants"),AdvData=require("AdvData"),AdvSingleton=require("AdvSingleton"),AdvSingletonConst=require("AdvSingletonConst"),AdvCommandTypeList=require("AdvCommandTypeList"),AdvCommandTypeResourceList=require("AdvCommandTypeResourceList"),_advData=null,_customCommandObject=null;function initAdvManager(t,e,i,a,n,o,r,s){cc.log("AdvManager:initAdvManager"),_advData=new AdvData(t,e,a,o,r,s),_customCommandObject=i;var c=[];for(var l in t)c.push(requestAdvTextRes.bind(null,t[l].storyFilePathName)),c.push(requestAdvRes.bind(null,t[l].synopsisFilePathName,cc.TextAsset));n&&c.push(n),c.push(function(t){return _advData.playState=AdvConstants.ADV_PLAY_STATE.PLAY,t()}),Async.waterfall(c)}function getAdvData(){return _advData}function startAdvManager(){cc.log("AdvManager:startAdvManager"),_initCommandList(_advData.advTextInfoArray[_advData.currentScenarioIndex])}function requestAdvTextRes(t,e){requestAdvRes(t,cc.TextAsset,function(t){t&&_advData.callbackEndAdv&&(AdvSingleton.soundManager?_advData.callbackEndAdv(AdvSingleton.soundManager.getSoundConfig(),t):_advData.callbackEndAdv(void 0,t)),e&&e()})}function _initCommandList(t){var e=AdvUtils.getResource(t.storyFilePathName);cc.log("\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\uff1a"),cc.log(e.toString()),_advData.synopsisText=AdvUtils.getResource(t.synopsisFilePathName),_advData.synopsisText&&(cc.log("\u3042\u3089\u3059\u3058\u30d5\u30a1\u30a4\u30eb\uff1a"),cc.log(_advData.synopsisText.toString()));for(var i=e.toString().split(/\r\n|\r|\n/),a=[],n=0;n<i.length;n++){var o=i[n].split(","),r=o[0].trim();r&&(AdvCommandTypeResourceList[r]?AdvCommandTypeResourceList[r](o,requestAdvRes):_customCommandObject.customCommandTypeResourceList[r]&&_customCommandObject.customCommandTypeResourceList[r](o,requestAdvRes)),a.push(o)}cc.log("\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u5f8c\uff1a"),cc.log(a),_setCommandList(a)}function requestAdvRes(t,e,i){return _advData.loadResFunc?_advData.loadResFunc(t,e,i):AdvSingleton.res[t]?(cc.log("this file is already loaded { "+t+" }"),i?i():void 0):(_advData.maxResourceCount+=1,_advData.requestResList[t]=e,cc.log("advmanager requestAdvRes loadFile:"+t),void cc.loader.loadRes(t,e,function(a,n){return onLoadedAdvRes(t,e,i,a,n)}))}function onLoadedAdvRes(t,e,i,a,n){return cc.log("requestAdvRes loadRes:"+t+", type="+e),_advData.currentResourceCount+=1,null!==a?(delete _advData.requestResList[t],cc.error(a),i?i(a):void 0):(AdvSingleton.res[t]=n,delete _advData.requestResList[t],_advData.callbackLoadingRes&&_advData.callbackLoadingRes(_advData.currentResourceCount,_advData.maxResourceCount),_advData.playState!==AdvConstants.ADV_PLAY_STATE.INIT&&Object.keys(_advData.requestResList).length<=0&&(_advData.initialized=!0,_advData.callbackVisibleAdvSubRoot&&_advData.callbackVisibleAdvSubRoot()),i?i():void 0)}function _isInitialized(t){return _advData&&_advData.initialized&&t.enabledInHierarchy}function update(t,e){if(_isInitialized(t)){var i=!0;for(_updateMessage(t,e),_updateMovieState(t,e),_advData.cnt=_advData.startCnt;_advData.cnt<_advData.commandList.length;_advData.cnt++)if(_isPlayableCommand(_advData.cnt)){switch(_advData.commandList[_advData.cnt].getState()){case AdvConstants.ADV_COMMAND_STATE.INIT:cc.log(_advData.cnt+1,"\u756a\u76ee\u306e\u547d\u4ee4\u3092\u5b9f\u884c\u958b\u59cb"),_advData.commandList[_advData.cnt].initialize(t),_advData.commandList[_advData.cnt].getCommandName()===AdvConstants.ADV_COMMAND_NAME.MESSAGE?_advData.messageCommandList.push(_advData.commandList[_advData.cnt]):_advData.commandList[_advData.cnt].getCommandName()===AdvConstants.ADV_COMMAND_NAME.PLAY_MOVIE&&(_advData.movieCommand=_advData.commandList[_advData.cnt]),i=!1;break;case AdvConstants.ADV_COMMAND_STATE.UPDATE:_advData.commandList[_advData.cnt].getCommandName()!==AdvConstants.ADV_COMMAND_NAME.MESSAGE&&_advData.commandList[_advData.cnt].update(t,e,i),i=!1}if(_isCntStop())return}}}function _updateMessage(t,e){for(var i=0;i<_advData.messageCommandList.length;i+=1)switch(_advData.messageCommandList[i].getState()){case AdvConstants.ADV_COMMAND_STATE.UPDATE:_advData.messageCommandList[i].update(t,e)}}function _updateMovieState(t,e){if(null!=_advData.movieCommand)switch(_advData.movieCommand.getState()){case AdvConstants.ADV_COMMAND_STATE.UPDATE:case AdvConstants.ADV_COMMAND_STATE.END:_advData.movieCommand.update(t,e)}}function _isPlayableCommand(t){switch(_advData.processState){case AdvConstants.ADV_PROCESS_STATE.NONE:case AdvConstants.ADV_PROCESS_STATE.TRUE:return!0}switch(_advData.commandList[t].getCommandName()){case AdvConstants.ADV_COMMAND_NAME.IF:case AdvConstants.ADV_COMMAND_NAME.ELSE_IF:case AdvConstants.ADV_COMMAND_NAME.END_IF:return!0;default:return!1}}function _isCntStop(){return _advData.commandList[_advData.cnt].getIsCntStop()}function getSynopsisText(){return _advData.synopsisText?_advData.synopsisText.toString():""}function setCurrentDispName(t){_advData.currentName=t}function getCurrentDispName(){return _advData.currentName}function addMessageLog(t,e,i){var a={tag:t,nameText:e,messageText:i};_advData.messageLogList.push(a)}function getMessageLogList(){return _advData.messageLogList}function addVoiceLog(t,e){t=t||0,_advData.voiceLogMap[t]||(_advData.voiceLogMap[t]=[]);var i={tag:t,voiceFileName:e};_advData.voiceLogMap[t].push(i)}function getVoiceLogMap(){return _advData.voiceLogMap}function addMovieLog(t,e){t=t||0,_advData.movieLogMap[t]||(_advData.movieLogMap[t]=[]);var i={tag:t,movieFileName:e};_advData.movieLogMap[t].push(i)}function removeMovieLog(t){delete _advData.movieLogMap[t]}function getMovieLogMap(){return _advData.movieLogMap}function tapEvent(t){_isInitialized(t)&&(_adjustCnt(),_advData.commandList[_advData.cnt].tapEvent(t))}function readNextLine(){_advData.startCnt=_advData.cnt+1,_adjustCnt()}function getCurrentCommandName(){return _adjustCnt(),_advData.commandList[_advData.cnt].getCommandName()}function setKeyValue(key,operator,value){_advData.valueMap[key]||(_advData.valueMap[key]=0),eval('_advData.valueMap["'+key+'"] '+operator+value)}function getKeyValue(t){return _advData.valueMap[t]||(_advData.valueMap[t]=0),_advData.valueMap[t]}function setProcessState(t){_advData.processState=t}function getProcessState(){return _advData.processState}function setPlayState(t){_advData.playState=t}function getPlayState(){return _advData.playState}function setFalseNestCount(t){_advData.falseNestCount=t,_advData.falseNestCount<0&&(_advData.falseNestCount=0)}function getFalseNestCount(){return _advData.falseNestCount}function _adjustCnt(){_advData.cnt<0?_advData.cnt=0:_isNextScenarioEnabled()?_nextScript():_advData.cnt>=_advData.commandList.length-1&&(_advData.cnt=_advData.commandList.length-1,_endScript())}function _isNextScenarioEnabled(){return _advData.cnt>=_advData.commandList.length-1&&_advData.advTextInfoArray[_advData.currentScenarioIndex+1]}function _nextScript(){_advData.initialized=!1,_advData.cnt=0,_advData.startCnt=0,_advData.valueMap={},_advData.currentScenarioIndex+=1,_initCommandList(_advData.advTextInfoArray[_advData.currentScenarioIndex])}function _endScript(){getPlayState()!==AdvConstants.ADV_PLAY_STATE.END&&(setPlayState(AdvConstants.ADV_PLAY_STATE.END),_advData.callbackEndAdv(AdvSingleton.soundManager.getSoundConfig()))}function getCurrentScenarioIndex(){return _advData.currentScenarioIndex}function getCurrentAdvTextInfo(){return _advData.advTextInfoArray[_advData.currentScenarioIndex]}function _setCommandList(scriptList){_advData.commandList=[],_advData.messageCommandList=[],_advData.movieCommand=null;for(var i=0;i<scriptList.length;i++)if(AdvCommandTypeList[scriptList[i][0]]){var argumentStr=_getCommandArgument(scriptList[i].slice(1)),command=eval("new AdvCommandTypeList[scriptList[i][0]]("+argumentStr+")");_advData.commandList.push(command)}else if(_customCommandObject.customCommandTypeList[scriptList[i][0]]){var argumentStr=_getCommandArgument(scriptList[i].slice(1)),command=eval("new _customCommandObject.customCommandTypeList[scriptList[i][0]]("+argumentStr+")");_advData.commandList.push(command)}else cc.log("\u5b58\u5728\u3057\u306a\u3044\u30b3\u30de\u30f3\u30c9("+(i+1)+"\u756a\u76ee)\uff1a"+scriptList[i][0]);cc.log("\u4f5c\u6210\u3057\u305fcommand\u30ea\u30b9\u30c8\uff1a"),cc.log(_advData.commandList)}function _getCommandArgument(t){if(0===t.length)return"";for(var e='"'+t[0],i=1;i<t.length;i++)e+='","'+t[i];return e+'"'}function convertConditionText(t){for(var e=t.split("|"),i=e[0].split("_"),a='advSubRoot.getKeyValue("'+i[0]+'")'+i[1]+i[2],n=1;n<e.length;n++){var o=e[n].split("_"),r={key:o[0],operator:o[1],value:o[2]};a+=' || advSubRoot.getKeyValue("'+r.key+'")'+r.operator+r.value}return a}module.exports={initAdvManager:initAdvManager,startAdvManager:startAdvManager,getAdvData:getAdvData,requestAdvRes:requestAdvRes,onLoadedAdvRes:onLoadedAdvRes,update:update,tapEvent:tapEvent,readNextLine:readNextLine,getCurrentCommandName:getCurrentCommandName,setKeyValue:setKeyValue,getKeyValue:getKeyValue,setProcessState:setProcessState,getProcessState:getProcessState,setPlayState:setPlayState,getPlayState:getPlayState,setFalseNestCount:setFalseNestCount,getFalseNestCount:getFalseNestCount,convertConditionText:convertConditionText,getSynopsisText:getSynopsisText,setCurrentDispName:setCurrentDispName,getCurrentDispName:getCurrentDispName,addMessageLog:addMessageLog,getMessageLogList:getMessageLogList,addVoiceLog:addVoiceLog,getVoiceLogMap:getVoiceLogMap,addMovieLog:addMovieLog,removeMovieLog:removeMovieLog,getMovieLogMap:getMovieLogMap,getCurrentScenarioIndex:getCurrentScenarioIndex,getCurrentAdvTextInfo:getCurrentAdvTextInfo},cc._RF.pop()},{AdvCommandTypeList:"AdvCommandTypeList",AdvCommandTypeResourceList:"AdvCommandTypeResourceList",AdvConstants:"AdvConstants",AdvData:"AdvData",AdvSingleton:"AdvSingleton",AdvSingletonConst:"AdvSingletonConst",AdvUtils:"AdvUtils",Async:"Async"}],AdvPopupBase:[function(t,e,i){"use strict";cc._RF.push(e,"e9e26CcxRNApIuNBPK4rDqK","AdvPopupBase");var a=t("AdvWindowBase"),n=(t("AdvStaticResourceConst"),t("AdvUtils"),t("AdvGameConst")),o=cc.Enum({OPEN_ANIM_IDX:0,CLOSE_ANIM_IDX:1});cc.Class({extends:a,_openCallBack:null,_closeCallBack:null,properties:{popupAnimation:cc.Animation,simpleTex:cc.SpriteFrame},_bSystemPopup:!1,_popupAnimation:null,_setOpenCallBack:function(t){t&&(this._openCallBack=t)},setCloseCallBack:function(t){this._closeCallBack=t},activateSystemPopupMode:function(){this._bSystemPopup=!0},open:function(t){this._openPopupBase(t)},_openPopupBase:function(t){this._setOpenCallBack(t),this._initPopupAnim(),this._addGrayBack(cc.director.getScene().getChildByName("Canvas"),n.Z_ORDER.GRAY_BACK),this._addWindow(),this._openWindowBase(),this._playOpenAnimation()},_addWindow:function(){var t=new cc.Node("ModalLayer");t.setContentSize(cc.winSize),t.zIndex=-1,t.active=!0;var e=-1*this.node.getPosition().x,i=-1*this.node.getPosition().y;t.setPosition(cc.v2(e,i)),this.node.addChild(t),this.windowNode&&(this.windowNode.on("touchstart",function(t){t.stopPropagation()}),this.windowNode.on("touchend",function(t){t.stopPropagation()})),t.on("touchstart",function(t){t.stopPropagation()}),t.on("touchend",function(t){this.windowNode&&!this._bSystemPopup&&this.close(),t.stopPropagation()}.bind(this)),t.on(cc.Node.EventType.MOUSE_WHEEL,function(t){t.stopPropagation()});var a=this._bSystemPopup?n.Z_ORDER.SYSTEM_POPUP:n.Z_ORDER.POPUP;cc.director.getScene().getChildByName("Canvas").addChild(this.node,a)},_addGrayBack:function(t,e){var i=this._getGrayBackSprite();i||((i=new cc.Node("PopupGrayBack").addComponent(cc.Sprite)).spriteFrame=this.simpleTex,i.node.setContentSize(cc.winSize),i.node.color=cc.color(0,0,0),i.node.opacity=128,t.addChild(i.node,e))},_removeGrayBack:function(){if(cc.director.getScene().getChildByName("Canvas").getComponentsInChildren("PopupBase").length<=0){var t=this._getGrayBackSprite();t&&t.node.destroy()}},_getGrayBackSprite:function(){return cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack")?cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack").getComponent(cc.Sprite):null},close:function(){this._playCloseAnimation()},_closePopupBase:function(){this.isValid&&(this.node.active=!1,this._closeCallBack&&this._closeCallBack(),this._closeWindowBase(),this._removeGrayBack())},_initPopupAnim:function(){cc.director.isPaused()||(this._popupAnimation=this.popupAnimation)},_playOpenAnimation:function(){!cc.director.isPaused()&&this._popupAnimation?(this._popupAnimation.once("finished",function(){if(this._openCallBack)return this._openCallBack()}.bind(this),this),this.node.setScale(0,0),this._popupAnimation.play(this._popupAnimation.getClips()[o.OPEN_ANIM_IDX].name)):this._openCallBack&&this._openCallBack()},_playCloseAnimation:function(){!cc.director.isPaused()&&this._popupAnimation?(this._popupAnimation.once("finished",this._closePopupBase.bind(this),this),this._popupAnimation.play(this._popupAnimation.getClips()[o.CLOSE_ANIM_IDX].name)):this._closePopupBase()}}),cc._RF.pop()},{AdvGameConst:"AdvGameConst",AdvStaticResourceConst:"AdvStaticResourceConst",AdvUtils:"AdvUtils",AdvWindowBase:"AdvWindowBase"}],AdvRichText:[function(t,e,i){"use strict";cc._RF.push(e,"21a5abvarpPu689ptCAV58x","AdvRichText");var a=t("AdvConstants"),n=/<(.*?)>/;cc.Class({extends:cc.RichText,_planeText:null,_latestTextFontSize:null,_textFontSizeArrayByIndex:null,_tagInfoArray:null,_customTagInfoArrayByIndex:null,_contentNode:null,_maxLength:0,_dispLength:0,setCustomText:function(t,e){this.node.active=!1,this._contentNode?this._contentNode.destroyAllChildren():(this._contentNode=new cc.Node("contentNode"),this.node.addChild(this._contentNode)),this._initTagInfoArray(t),this._initPlaneTextAndCustomTagInfoArrayByIndex(t),this.setDispLength(e),this.node.active=!0},getPlaneText:function(){return this._planeText},_initTagInfoArray:function(t){this._tagInfoArray=[];for(var e=new RegExp(n,"g"),i=!0;i;)(i=e.exec(t))&&this._tagInfoArray.push(i)},_getTagInfoByIndex:function(t){return this._tagInfoArray.find(function(e){return parseInt(e.index)===parseInt(t)})},_createRubyTagObject:function(t,e){var i=t.substring(e,t.indexOf("</ruby>",e)).split("|");return{name:"<ruby>",target:i[0],data:i[1]}},_initPlaneTextAndCustomTagInfoArrayByIndex:function(t){this._planeText="",this._textFontSizeArrayByIndex=[],this._customTagInfoArrayByIndex=[],this._latestTextFontSize=this.fontSize;for(var e=!1,i=0;i<t.length;i+=1)if("|"===t[i]){i=t.indexOf("</ruby>",i)-1}else{for(var a=[],n=i;n<t.length;n+=1){var o=this._getTagInfoByIndex(n);if(!o){i=n;break}this._setLatestFontSize(o[0]),a.push(this._createTagObject(o[0],t,n)),n+=parseInt(o[0].length-1)}this._customTagInfoArrayByIndex.push(a);for(var r=0,s=0;s<a.length;s+=1)r+=a[s].name.length;if(e){if(t[i]+t[i+1]==="</")break;if(t[i-1]+t[i]==="</"){this._planeText=this._planeText.slice(0,-1);break}this._planeText+=t[i],this._textFontSizeArrayByIndex.push(this._getTextLength(t[i])*this._latestTextFontSize)}else i+r<t.length||0===this._planeText.length?(this._planeText+=t[i],this._textFontSizeArrayByIndex.push(this._getTextLength(t[i])*this._latestTextFontSize)):(e=!0,this._planeText+=t[i],this._textFontSizeArrayByIndex.push(this._getTextLength(t[i])*this._latestTextFontSize))}this._maxLength=this._planeText.length},_setLatestFontSize:function(t){switch(t.substring(1,5)){case"size":var e=t.split("="),i=parseFloat(e[1].split(">")[0]);this._latestTextFontSize=i;break;case"/siz":this._latestTextFontSize=this.fontSize}},_createTagObject:function(t,e,i){return"<ruby>"===t?this._createRubyTagObject(e,i+"<ruby>".length):{name:t,target:null,data:null}},getMaxLength:function(){return this._maxLength},setDispLength:function(t){this._contentNode&&(this._contentNode.destroyAllChildren(),t>=a.ADV_TEXT_LENGTH_MAX?this._dispLength=this.getMaxLength():this._dispLength=t,this._dispCustomText())},_dispCustomText:function(){var t="",e=[];if(this._customTagInfoArrayByIndex.length<1)this.string="";else{for(var i=0;i<this._dispLength;i+=1){for(var a=0;a<this._customTagInfoArrayByIndex[i].length;a+=1){for(var n=!1,o=0;o<e.length;o+=1)if(e[o]===this._customTagInfoArrayByIndex[i][a].name){e.splice(o,1),t+=this._customTagInfoArrayByIndex[i][a].name,n=!0;break}if(!n)if("<ruby>"===this._customTagInfoArrayByIndex[i][a].name)i+this._customTagInfoArrayByIndex[i][a].target.length<=this._dispLength&&this._addRubyTextNode(this._customTagInfoArrayByIndex[i][a],i,this._getRubyColor(i,e),this._getOutlineData(i,e));else"</ruby>"!==this._customTagInfoArrayByIndex[i][a].name&&(t+=this._customTagInfoArrayByIndex[i][a].name,e.push(this._getEndTag(this._customTagInfoArrayByIndex[i][a].name)))}t+=this._planeText[i]}this.string=this._createAfterCustomText(t,e)}},_createAfterCustomText:function(t,e){if(e.length>0){for(var i=e.length,a=0;a<i;a+=1)t+=e.pop();e=[]}return t},_getRubyColor:function(t,e){if(e.length>0){if(e.find(function(t){return"</color>"===t}))for(var i=t;i>-1;i-=1){var a=this._getStartColorTag(this._customTagInfoArrayByIndex[i]);if(a)return a}return null}return null},_getStartColorTag:function(t){if(t.length>0)for(var e=t.length-1;e>-1;e-=1)if(-1!==t[e].name.indexOf("<color="))return t[e].name;return null},_getOutlineData:function(t,e){if(e.length>0){if(e.find(function(t){return"</outline>"===t}))for(var i=t;i>-1;i-=1){var a=this._getStartOutlineTag(this._customTagInfoArrayByIndex[i]);if(a)return a}return null}return null},_getStartOutlineTag:function(t){if(t.length>0)for(var e=t.length-1;e>-1;e-=1)if(-1!==t[e].name.indexOf("<outline"))return t[e].name;return null},_getEndTag:function(t){var e=t.slice(0,1)+"/"+t.slice(1),i=e,a=e.indexOf("=");-1!==a&&(i=e.substring(0,a),i+=">");var n=e.indexOf(" ");return-1!==n&&(i=e.substring(0,n),i+=">"),i},_getTextLength:function(t){var e=t.match(/[a-zA-Z0-9]+/g),i=t.length;if(e)for(var a=0;a<e.length;a++)t.search(e[a])>=0&&(i-=.5*e[a].length);return i},_createLineInfo:function(){for(var t=0,e=[],i=this._planeText.split("\n"),a=[],n=0;n<i.length;n+=1){t=n>0?i[n-1].length+1:0,e.push(t);for(var o=0,r=0;r<i[n].length;r+=1){var s=this._textFontSizeArrayByIndex[n>0?r+i[n-1].length+1:r];if(o+s>this.maxWidth){t=n>0?r+i[n-1].length+1:r,e.push(t);break}o+=s}var c=1+2*n;e.length>c?(a.push(i[n].substring(e[c-1],e[c])),a.push(i[n].substring(e[c]))):a.push(i[n])}return{afterTextArray:a,lineStartIdxArray:e}},_getRubyTextPosition:function(t,e){for(var i=this._createLineInfo(),a=0,n=0;n<i.lineStartIdxArray.length;n+=1){if(e<i.lineStartIdxArray[n]){a=n-1;break}a=n}for(var o=i.lineStartIdxArray[a],r=e+t.target.length,s=0,c=o;c<e;c+=1)s+=this._textFontSizeArrayByIndex[c];for(var l=o;l<r;l+=1)s+=this._textFontSizeArrayByIndex[l];var u=0-s,h=0,d=0;switch(this.horizontalAlign){case cc.macro.TextAlignment.LEFT:h=s+u/2,d-=this.lineHeight*a;break;case cc.macro.TextAlignment.CENTER:for(var p=this._dispLength-o,m=0,_=o;_<o+p;_+=1)m+=this._textFontSizeArrayByIndex[_];h=(this.maxWidth-m)/2+s+u/2,d-=this.lineHeight*a}return cc.v2(h,d)},_addRubyTextNode:function(t,e,i,a){var n="";n=i?i+t.data+"</color>":t.data,a&&(n=a+t.data+"</outline>");var o=this._getRubyTextPosition(t,e);if(o){var r=new cc.Node("RubyNode_"+this.node.childrenCount).addComponent(cc.RichText);r.string=n,r.font=this.font,r.fontSize=this.fontSize/40*16,r.lineHeight=this.fontSize/40*18,r.horizontalAlign=cc.macro.TextAlignment.CENTER,r.node.setAnchorPoint(cc.v2(.5,.5)),this._contentNode.addChild(r.node),r.node.setPosition(o)}}}),cc._RF.pop()},{AdvConstants:"AdvConstants"}],AdvRoot:[function(t,e,i){"use strict";cc._RF.push(e,"cd831745p9PgaBH5fGGcQ88","AdvRoot");var a=t("AdvGameRootBase"),n=(t("AdvSoundManager"),t("AdvConstants")),o=t("AdvSingleton"),r=t("AdvUtils");cc.Class({extends:a,properties:{scriptFilePath:n.ADV_STORY_FILE_PATH,scriptFileName:"tutorial",synopsisFilePath:n.ADV_SYNOPSIS_FILE_PATH,synopsisFileName:"tutorial",playerName:"\u30c6\u30b9\u30c8\u30d7\u30ec\u30a4\u30e4\u30fc",returnSceneName:"AdvScene",debugSkipRate:n.ADV_SKIP_RATE,debugSearchMessage:"",subRootPath:n.ADV_SUB_ROOT_PATH,defaultSubRootPrefab:cc.Prefab},_advTextInfoArray:null,_endCallFunc:null,_soundConfig:null,onLoad:function(){},initAdvRoot:function(t,e,i,a,n){cc.log("AdvRoot:initAdvRoot"),this._advTextInfoArray=t,e&&(this.playerName=e),i&&(this._soundConfig=i),a&&(this.subRootPath=a),this._endCallFunc=n},initResource:function(){for(var t in cc.log("AdvRoot:initResource"),cc.log(this.scriptFilePath+this.scriptFileName),this.requestRes(this.subRootPath,cc.Prefab),this.requestRes(n.ADV_POPUP_OPEN_ANIM_CLIP_PATH,cc.AnimationClip),this.requestRes(n.ADV_POPUP_CLOSE_ANIM_CLIP_PATH,cc.AnimationClip),this._advTextInfoArray||(this._advTextInfoArray=[r.createAdvTextInfo(this.scriptFilePath+this.scriptFileName,this.synopsisFilePath+this.synopsisFileName)]),this._advTextInfoArray)this.requestRes(this._advTextInfoArray[t].storyFilePathName,cc.TextAsset),this.requestRes(this._advTextInfoArray[t].synopsisFilePathName,cc.TextAsset)},initialize:function(){cc.log("AdvRoot:initialize");var t=null,e=this.getResource(this.subRootPath);(t=e?cc.instantiate(e).getComponent("AdvSubRootBase"):cc.instantiate(this.defaultSubRootPrefab).getComponent("AdvSubRootBase")).initAdvSubRoot(this._advTextInfoArray,this.playerName,this._soundConfig,this._endSceneEvent.bind(this),this._callbackVisibleAdvSubRoot.bind(this),this._callbackLoadingAdvRes.bind(this)),this._setDebugSkipRate(t),this._setDebugSearchMessage(t),this.node.addChild(t.node)},updateChild:function(t){},_endSceneEvent:function(t,e){o.soundManager.stopAll(),cc.loader.releaseAsset(o.res),o.res={},this._endCallFunc?this._endCallFunc(t,e):cc.director.loadScene(this.returnSceneName)},_setDebugSkipRate:function(t){this.debugSkipRate>=0&&t.setSkipRate(this.debugSkipRate)},_setDebugSearchMessage:function(t){this.debugSearchMessage&&t.setDebugSearchMessage(this.debugSearchMessage)},_callbackVisibleAdvSubRoot:function(){},_callbackLoadingAdvRes:function(t,e){}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvGameRootBase:"AdvGameRootBase",AdvSingleton:"AdvSingleton",AdvSoundManager:"AdvSoundManager",AdvUtils:"AdvUtils"}],AdvSceneConst:[function(t,e,i){"use strict";cc._RF.push(e,"f7d70n3xcdOuLxia7BDf9gK","AdvSceneConst"),cc.Class({statics:{SCENE:{NAME:{battle:"\u30d0\u30c8\u30eb",battleLoading:"",BootScene:"",DebugScene:"",DeckScene:"\u7de8\u6210",DummyLoginScene:"",EventQuestScene:"\u30a4\u30d9\u30f3\u30c8",ExchangeScene:"\u4ea4\u63db\u6240",GachaAnimationScene:"",GachaScene:"\u30ac\u30c1\u30e3",HomeScene:"\u30db\u30fc\u30e0",MissionScene:"\u4efb\u52d9",PictureBookScene:"\u5bdd\u5ba4",PresentBoxScene:"\u30ae\u30d5\u30c8\u30dc\u30c3\u30af\u30b9",PromoteCharacterDetailScene:"\u80b2\u6210",PromoteCharacterSelectScene:"\u80b2\u6210",PvPScene:"\u30a2\u30ea\u30fc\u30ca",QuestScene:"\u51fa\u6483",RoomScene:"\u30eb\u30fc\u30e0",RoomCharacterScene:"\u30eb\u30fc\u30e0",SetTestBattleScene:"",ShopScene:"\u30b7\u30e7\u30c3\u30d7",StoryScene:"\u56de\u60f3",TestScene:"",TowerScene:"\u30bf\u30ef\u30fc",WarehouseScene:"\u5009\u5eab",NormalQuestScene:"\u901a\u5e38\u30af\u30a8\u30b9\u30c8",WeekScene:"\u66dc\u65e5\u30af\u30a8\u30b9\u30c8",EquipmentScene:"\u88c5\u5099"},FILE_NAME:cc.Enum({BATTLE:"battle",BATTLE_LOADING:"battleLoading",BOOT:"BootScene",DEBUG:"DebugScene",DECK:"DeckScene",DUMMY_LOGIN:"DummyLoginScene",EVENT:"EventQuestScene",EXCHANGE:"ExchangeScene",GACHA_ANIMATION:"GachaAnimationScene",GACHA:"GachaScene",HOME:"HomeScene",MISSION:"MissionScene",PICTURE_BOOK:"PictureBookScene",PRESENT_BOX:"PresentBoxScene",PROMOTE_CHARACTER_DETAIL:"PromoteCharacterDetailScene",PROMOTE_CHARACTER_SELECT:"PromoteCharacterSelectScene",PVP:"PvPScene",QUEST:"QuestScene",ROOM:"RoomScene",ROOM_CHARACTER:"RoomCharacterScene",SET_TEST_BATTLE:"SetTestBattleScene",SHOP:"ShopScene",STORY:"StoryScene",TEST:"TestScene",TOWER:"TowerScene",WARE_HOUSE:"WarehouseScene",NORMAL_QUEST:"NormalQuestScene",WEEK:"WeekScene",EQUIPMENT:"EquipmentScene"})},LOADING_TYPE:{TestScene:"PROGRESS",RoomCharacterScene:"PROGRESS",battleLoading:"PROGRESS"}}}),cc._RF.pop()},{}],AdvSelectThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"495a4y32B5OzYo5ACMAXKxJ","AdvSelectThumbnail");var a=t("AdvCommonButton"),n=t("AdvRichText"),o=t("AdvConstants");cc.Class({extends:cc.Component,properties:{imageSprite:cc.Sprite,advSelectBtn:a,selectText:n},onLoad:function(){this.imageSprite&&this.node.setContentSize(this.imageSprite.node.getContentSize())},init:function(t,e,i,a){this.selectText.setCustomText(i,o.ADV_TEXT_LENGTH_MAX),cc.log("init thumbnail",e),this.advSelectBtn.setTapEvent(function(n){t.setKeyValue(o.SELECT_KEY,"=",e),a&&a(i),this._tapEvent()}.bind(this))},_tapEvent:function(){this.node.destroy()}}),cc._RF.pop()},{AdvCommonButton:"AdvCommonButton",AdvConstants:"AdvConstants",AdvRichText:"AdvRichText"}],AdvSingletonConst:[function(t,e,i){"use strict";cc._RF.push(e,"9cb33qm2RxN4LoKjCmbz5mg","AdvSingletonConst"),e.exports={ENVIRONMENT:"Environment",OAUTH:"oauth",SCHEDULER:"scheduler",ERROR_MANAGER:"ErrorManager",SERVICE_MANAGER:"ServiceManger",SERVICE_AUTH:"AuthService",SERVICE_USER:"UserService",SERVICE_CHARACTER:"CharacterService",SERVICE_EQUIPMENT:"EquipmentService",SERVICE_ITEM:"ItemService",DAO:"DAO"},cc._RF.pop()},{}],AdvSingleton:[function(t,e,i){"use strict";cc._RF.push(e,"e6346YLaeRIuY0sPY9AVIX+","AdvSingleton"),e.exports={res:{},localData:{},soundManager:null},cc._RF.pop()},{}],AdvSoundManager:[function(t,e,i){"use strict";cc._RF.push(e,"8fab8FxajVPm733CLNKU/xI","AdvSoundManager");t("AdvSingleton"),t("AdvUtils");var a=cc.Class({properties:{bgmVolume:.3,seVolume:1,voiceVolume:1,soundMute:!1,curBGM_id:-1,curVoice_id:-1,playingBGM:null,bgmFadeDelayTime:.01,bgmMute:!1,seMute:!1,voiceMute:!1,curplay_loopSE_list:null,curplay_skillSE_list:null},statics:{instance:null},_bgmFadeVolume:null,_bgmVolumeDeltaCount:null,_bgmFadeRepeatAction:null,ctor:function(){a.instance=this,this.curplay_loopSE_list=new Array,this.curplay_skillSE_list=new Array},init:function(t){this.setSoundConfig(t),this._bgmFadeVolume=1,this._bgmVolumeDeltaCount=0,this._bgmFadeRepeatAction=null},playBGM:function(t){this.playingBGM=t,!1===this.soundMute&&!1===this.bgmMute&&(-1!==this.curBGM_id&&cc.audioEngine.stop(this.curBGM_id),this.curBGM_id=cc.audioEngine.play(t,!0,this.bgmVolume*this._bgmFadeVolume),this.setBGMVol(this.bgmVolume))},playSE:function(t,e,i){if(!1===this.soundMute&&!1===this.seMute&&0!==this.seVolume){var a=!!e,n=cc.audioEngine.play(t,a,this.seVolume);return a&&this.curplay_loopSE_list.push(n),i&&cc.audioEngine.setFinishCallback(n,i),n}},playMovie:function(t,e){},setMute:function(t){this.setBgmMute(t),this.setSeMute(t),this.setVoiceMute(t)},bgmPause:function(){-1!==this.curBGM_id&&cc.audioEngine.pause(this.curBGM_id)},bgmResume:function(){-1!==this.curBGM_id&&cc.audioEngine.resume(this.curBGM_id)},bgmStop:function(t){this.soundMute||this.bgmMute||0===t||void 0===t?-1!==this.curBGM_id&&(cc.director.getScene().getChildByName("Canvas").stopAction(this._bgmFadeRepeatAction),cc.audioEngine.stop(this.curBGM_id)):(this._bgmFadeVolume=-1,this._bgmVolumeDeltaCount=this._bgmFadeVolume*this.bgmFadeDelayTime/t,this._bgmFadeStart())},stopSeId:function(t){cc.audioEngine.stop(t)},stopLoopSe:function(){this.curplay_loopSE_list.forEach(function(t){this.stopSeId(t)}.bind(this)),this.curplay_loopSE_list=new Array},voiceStop:function(){if(-1!=this.curVoice_id){cc.director.getScene().getChildByName("Canvas");cc.audioEngine.stop(this.curVoice_id)}},stopAll:function(){cc.audioEngine.stopAll()},playSE_onQuery:function(t,e){if(!1===this.soundMute&&!1===this.seMute&&0!==this.seVolume){var i=e.get("seFile");this.playSE(i)}t()},playSE_skillSE:function(t){if(cc.log("playSE_skillSE = "),!this.soundMute&&!this.seMute&&0!=this.seVolume){cc.log("playSE_skillSE = "+t);var e=cc.audioEngine.play(t,!1,this.seVolume);this.curplay_skillSE_list.push(e)}},togglePauseInBattle:function(t){for(var e in this.curplay_skillSE_list){var i=this.curplay_skillSE_list[e];t?cc.audioEngine.pause(i):!1===this.soundMute&&!1===this.seMute&&cc.audioEngine.resume(i)}},playVoice:function(t){!1===this.soundMute&&!1===this.voiceMute&&0!==this.voiceVolume&&(-1!==this.curVoice_id&&cc.audioEngine.stop(this.curVoice_id),this.curVoice_id=cc.audioEngine.play(t,!1,this.voiceVolume))},getPlayingVoiceState:function(){return cc.audioEngine.getState(this.curVoice_id)},continuePlayBGM:function(t,e){if(e=e>0?e:0,this._fadeBgmStop(),this._bgmFadeVolume=1,this._bgmVolumeDeltaCount=e?this._bgmFadeVolume*this.bgmFadeDelayTime/e:0,this._bgmVolumeDeltaCount>0&&(this._bgmFadeVolume=0,this._bgmFadeStart()),t===this.playingBGM){var i=cc.audioEngine.getState(this.curBGM_id);cc.audioEngine.AudioState.PLAYING!==i&&this.playBGM(t)}else cc.audioEngine.stop(this.curBGM_id),this.curBGM_id=cc.audioEngine.play(t,!0,this.bgmVolume*this._bgmFadeVolume),this.setBGMVol(this.bgmVolume),this.playingBGM=t},_bgmFadeStart:function(){var t=cc.director.getScene().getChildByName("Canvas");t.stopAction(this._bgmFadeRepeatAction),this._bgmFadeVolume=this._bgmVolumeDeltaCount>0?0:1,this.setBGMVol(this.bgmVolume);var e=cc.sequence(cc.delayTime(this.bgmFadeDelayTime),cc.callFunc(this._fadeBgmVolume.bind(this)));this._bgmFadeRepeatAction=cc.repeatForever(e),t.runAction(this._bgmFadeRepeatAction)},_fadeBgmVolume:function(){if(this._bgmFadeVolume+=this._bgmVolumeDeltaCount,this._bgmFadeVolume>=1)this._fadeBgmStop();else if(this._bgmFadeVolume<0&&-1!=this.curBGM_id)return this._fadeBgmStop(),void cc.audioEngine.stop(this.curBGM_id);this.setBGMVol(this.bgmVolume)},_fadeBgmStop:function(){null===this._bgmFadeRepeatAction&&void 0===this._bgmFadeRepeatAction||(cc.director.getScene().getChildByName("Canvas").stopAction(this._bgmFadeRepeatAction),this._bgmFadeRepeatAction=null,this._bgmFadeVolume=this._bgmVolumeDeltaCount>0?1:0)},setSEVol:function(t){var e=t;for(var i in this.curplay_skillSE_list){var a=this.curplay_skillSE_list[i];this.seMute&&(e=0),cc.audioEngine.setVolume(a,e*this._bgmFadeVolume)}this.seVolume=t},setVoiceVol:function(t){if(-1!==this.curVoice_id){var e=t;this.voiceMute&&(e=0),cc.audioEngine.setVolume(this.curVoice_id,e*this._bgmFadeVolume)}this.voiceVolume=t},setBGMVol:function(t){if(-1!==this.curBGM_id){var e=t;this.bgmMute&&(e=0),cc.audioEngine.setVolume(this.curBGM_id,e*this._bgmFadeVolume)}this.bgmVolume=t},setSeMute:function(t){this.seMute=t,this.soundMute=this.bgmMute&&this.seMute&&this.voiceMute},setVoiceMute:function(t){this.voiceMute=t,this.soundMute=this.bgmMute&&this.seMute&&this.voiceMute,t?cc.audioEngine.setVolume(this.curVoice_id,0):this.setVoiceVol(this.voiceVolume)},setBgmMute:function(t){this.bgmMute=t,this.soundMute=this.bgmMute&&this.seMute&&this.voiceMute,-1!==this.curBGM_id&&(this.bgmMute?cc.audioEngine.setVolume(this.curBGM_id,0):cc.audioEngine.setVolume(this.curBGM_id,this.bgmVolume*this._bgmFadeVolume))},setSoundConfig:function(t){t&&(this.bgmVolume=Math.max(Math.min(t.bgmVolume,1),0),this.seVolume=Math.max(Math.min(t.seVolume,1),0),this.voiceVolume=Math.max(Math.min(t.voiceVolume,1),0),this.voiceMute=t.voiceMute,this.seMute=t.seMute,this.bgmMute=t.bgmMute)},getSoundConfig:function(){return{bgmVolume:this.bgmVolume,seVolume:this.seVolume,voiceVolume:this.voiceVolume,voiceMute:this.voiceMute,seMute:this.seMute,bgmMute:this.bgmMute}}});e.exports=a,cc._RF.pop()},{AdvSingleton:"AdvSingleton",AdvUtils:"AdvUtils"}],AdvSoundSettingView:[function(t,e,i){"use strict";cc._RF.push(e,"58be6F9fb9MCLYS4Io5V1sn","AdvSoundSettingView");var a=t("AdvCommonButton"),n=t("AdvSingleton");cc.Class({extends:cc.Component,properties:{seSlider:cc.Slider,voiceSlider:cc.Slider,bgmSlider:cc.Slider,seProgressBar:cc.ProgressBar,voiceProgressBar:cc.ProgressBar,bgmProgressBar:cc.ProgressBar,seVolumeLabel:cc.Label,voiceVolumeLabel:cc.Label,bgmVolumeLabel:cc.Label,seMuteBtn:a,voiceMuteBtn:a,bgmMuteBtn:a,soundMasterBtn:a,setInitBtn:a},_seVolume:0,_voiceVolume:0,_bgmVolume:0,onLoad:function(){var t;t={seVolume:n.soundManager.seVolume,voiceVolume:n.soundManager.voiceVolume,bgmVolume:n.soundManager.bgmVolume,seMute:n.soundManager.seMute,voiceMute:n.soundManager.voiceMute,bgmMute:n.soundManager.bgmMute};var e=Math.max(Math.min(t.seVolume,1),0),i=Math.max(Math.min(t.voiceVolume,1),0),a=Math.max(Math.min(t.bgmVolume,1),0);this._seVolume=e,this._voiceVolume=i,this._bgmVolume=a,this._setDispSeVolume(e,t.seMute),this._setDispVoiceVolume(i,t.voiceMute),this._setDispBgmVolume(a,t.bgmMute),this.seMuteBtn.switchBtnImage(!t.seMute),this.voiceMuteBtn.switchBtnImage(!t.voiceMute),this.bgmMuteBtn.switchBtnImage(!t.bgmMute),this.seMuteBtn.setTapEvent(this._seMuteButtonEvent.bind(this)),this.voiceMuteBtn.setTapEvent(this._voiceMuteButtonEvent.bind(this)),this.bgmMuteBtn.setTapEvent(this._bgmMuteButtonEvent.bind(this)),this.soundMasterBtn&&this.soundMasterBtn.setTapEvent(this._soundMasterBtnEvent.bind(this)),this.setInitBtn&&this.setInitBtn.setTapEvent(this._setInitBtnEvent.bind(this))},getSoundSetting:function(){var t={};return t.se=this._seVolume,t.voice=this._voiceVolume,t.bgm=this._bgmVolume,t.seMute=!this.seMuteBtn.getBtnImageSwitchState(),t.voiceMute=!this.voiceMuteBtn.getBtnImageSwitchState(),t.bgmMute=!this.bgmMuteBtn.getBtnImageSwitchState(),t.soundMute=t.seMute&&t.voiceMute&&t.bgmMute,t},seSlideEvent:function(){n.soundManager.setSEVol(this.seSlider.progress),this._seVolume=this.seSlider.progress,this._setSeProgress(this.seSlider.progress)},voiceSlideEvent:function(){n.soundManager.setVoiceVol(this.voiceSlider.progress),this._voiceVolume=this.voiceSlider.progress,this._setVoiceProgress(this.voiceSlider.progress)},bgmSlideEvent:function(){n.soundManager.setBGMVol(this.bgmSlider.progress),this._bgmVolume=this.bgmSlider.progress,this._setBgmProgress(this.bgmSlider.progress)},_setSeProgress:function(t){this.seProgressBar&&(this.seProgressBar.progress=t),this.seVolumeLabel&&(this.seVolumeLabel.string=parseInt(100*t)),this.seMuteBtn.switchBtnImage(t>0),n.soundManager.setSeMute(t<=0),this._soundChangeEvent()},_setVoiceProgress:function(t){this.voiceProgressBar&&(this.voiceProgressBar.progress=t),this.voiceVolumeLabel&&(this.voiceVolumeLabel.string=parseInt(100*t)),this.voiceMuteBtn.switchBtnImage(t>0),n.soundManager.setVoiceMute(t<=0),this._soundChangeEvent()},_setBgmProgress:function(t){this.bgmProgressBar&&(this.bgmProgressBar.progress=t),this.bgmVolumeLabel&&(this.bgmVolumeLabel.string=parseInt(100*t)),this.bgmMuteBtn.switchBtnImage(t>0),n.soundManager.setBgmMute(t<=0),this._soundChangeEvent()},_setSeSlideProgress:function(t){this.seSlider.progress=t,this._setSeProgress(t)},_setVoiceSlideProgress:function(t){this.voiceSlider.progress=t,this._setVoiceProgress(t)},_setBgmSlideProgress:function(t){this.bgmSlider.progress=t,this._setBgmProgress(t)},_setDispSeVolume:function(t,e){e?this._setSeSlideProgress(0):(this._seVolume<=0&&(this._seVolume=.01),this._setSeSlideProgress(this._seVolume))},_setDispVoiceVolume:function(t,e){e?this._setVoiceSlideProgress(0):(this._voiceVolume<=0&&(this._voiceVolume=.01),this._setVoiceSlideProgress(this._voiceVolume))},_setDispBgmVolume:function(t,e){e?this._setBgmSlideProgress(0):(this._bgmVolume<=0&&(this._bgmVolume=.01),this._setBgmSlideProgress(this._bgmVolume))},_seMuteButtonEvent:function(){this.seMuteBtn.switchBtnImage(!this.seMuteBtn.getBtnImageSwitchState()),this._setDispSeVolume(this._seVolume,!this.seMuteBtn.getBtnImageSwitchState())},_voiceMuteButtonEvent:function(){this.voiceMuteBtn.switchBtnImage(!this.voiceMuteBtn.getBtnImageSwitchState()),this._setDispVoiceVolume(this._voiceVolume,!this.voiceMuteBtn.getBtnImageSwitchState())},_bgmMuteButtonEvent:function(){this.bgmMuteBtn.switchBtnImage(!this.bgmMuteBtn.getBtnImageSwitchState()),this._setDispBgmVolume(this._bgmVolume,!this.bgmMuteBtn.getBtnImageSwitchState())},_soundMasterBtnEvent:function(t){this.soundMasterBtn.switchBtnImage(!this.soundMasterBtn.getBtnImageSwitchState()),n.soundManager.setMute(!this.soundMasterBtn.getBtnImageSwitchState()),this.setMuteAll(!this.soundMasterBtn.getBtnImageSwitchState())},_setInitBtnEvent:function(t){n.soundManager.setBGMVol(.5),this._bgmVolume=.5,this._setDispBgmVolume(),n.soundManager.setSEVol(.5),this._seVolume=.5,this._setDispSeVolume(),n.soundManager.setVoiceVol(.5),this._voiceVolume=.5,this._setDispVoiceVolume()},_soundChangeEvent:function(){var t=this.getSoundSetting();this.soundMasterBtn&&this.soundMasterBtn.switchBtnImage(!t.soundMute),this._callbackToSoundChangeEvent&&this._callbackToSoundChangeEvent(t)},setMuteAll:function(t){this._setDispSeVolume(this._seVolume,t),this._setDispVoiceVolume(this._voiceVolume,t),this._setDispBgmVolume(this._bgmVolume,t)},setCallbackToSoundChangeEvent:function(t){this._callbackToSoundChangeEvent=t}}),cc._RF.pop()},{AdvCommonButton:"AdvCommonButton",AdvSingleton:"AdvSingleton"}],AdvStaticResourceConst:[function(t,e,i){"use strict";cc._RF.push(e,"064d8x8KlBAdrIe2CAAxDK+","AdvStaticResourceConst");cc.Class({statics:{LOADING_SIMPLE_PREFAB_PATH:"prefab/system/Connecting",LOADING_PROGRESS_PREFAB_PATH:"prefab/system/NowLoading",TAP_EFFECT_PREFAB_PATH:"prefab/system/TapEffect",POPUP_WINDOW_OPEN_ANIM_CLIP_PATH:"animation/outGame/common/PopupWindow_Open_Anim",POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH:"animation/outGame/common/PopupWindow_Close_Anim"}});cc._RF.pop()},{}],AdvSubRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"dc1fc7MuD9E2ZDo2906bDRq","AdvSubRootBase");var a=t("MessageView"),n=t("AdvManager"),o=t("AdvSoundManager"),r=t("AdvConstants"),s=t("AdvUtils"),c=t("AdvSingleton");cc.Class({extends:cc.Component,properties:{shakeTargetNode:cc.Node,fadeNode:cc.Node,slideNode:cc.Node,contentNode:cc.Node,uiNode:cc.Node,clickWaitCursorNode:cc.Node,clickWaitAnimation:cc.Animation,bgImageSprite:cc.Sprite,messageView:a,advLogPopupPrefab:cc.Prefab,advConfigPopupPrefab:cc.Prefab,advMovie:cc.Prefab},messageTouchNode:null,_callbackArrayForClick:null,_advLogPopup:null,_advConfigPopup:null,_callbackToEndAdv:null,_skipRate:null,_debugSearchMessage:null,ACTION_MOVE_TAG:null,onLoad:function(){this.node.on(cc.Node.EventType.MOUSE_ENTER,function(t){},this),this.node.on(cc.Node.EventType.TOUCH_END,this._viewTapEvent,this),this._initButtons()},initAdvSubRoot:function(t,e,i,a,r,s,l){cc.loader.releaseAsset(c.res),this.ACTION_MOVE_TAG=1,c.res={},this._callbackArrayForClick=[],this.node.opacity=0,this.fadeNode.opacity=0,this.slideNode.active=!1,this._callbackToEndAdv=a||this._removeSelf.bind(this),this.messageView.init(),this.setActiveWaitCursor(!1),c.soundManager||(c.soundManager=new o),c.soundManager.init(i),n.initAdvManager(t,e,this._getCustomCommandObject(),this._callbackToEndAdv,function(t){return this._loadUIResources(),n.startAdvManager(),t()}.bind(this),function(){r&&r(),this.node.opacity=255}.bind(this),s,l)},setSkipRate:function(t){this._skipRate=t},getSkipRate:function(){return this._skipRate<0&&(this._skipRate=r.ADV_SKIP_RATE),this._skipRate},setDebugSearchMessage:function(t){this._debugSearchMessage=t},getDebugSearchMessage:function(){return this._debugSearchMessage||(this._debugSearchMessage=""),this._debugSearchMessage},_loadUIResources:function(){cc.error("_loadUIResources()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},_initButtons:function(){cc.error("\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044")},_getCustomCommandObject:function(){return cc.warn("\u30ab\u30b9\u30bf\u30e0\u30b3\u30de\u30f3\u30c9\u304c\u5fc5\u8981\u306a\u969b\u306b\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044"),{customCommandTypeList:{},customCommandTypeResourceList:{}}},_removeSelf:function(){this.node.destroy()},update:function(t){n.update(this,t)},readNextLine:function(){this.stopVoice(),this.setActiveWaitCursor(!1),n.readNextLine()},doCallbackForClick:function(){for(var t in this._callbackArrayForClick)this._callbackArrayForClick[t](this);this._callbackArrayForClick=[]},setKeyValue:function(t,e,i){n.setKeyValue(t,e,i)},getKeyValue:function(t){return n.getKeyValue(t)},setProcessState:function(t){n.setProcessState(t)},getProcessState:function(){return n.getProcessState()},setPlayState:function(t){n.setPlayState(t)},getPlayState:function(){return n.getPlayState()},setFalseNestCount:function(t){n.setFalseNestCount(t)},getFalseNestCount:function(){return n.getFalseNestCount()},convertConditionText:function(t){return n.convertConditionText(t)},playBgm:function(t,e,i){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:e=0}c.soundManager&&c.soundManager.stopAll();var a=s.getResource(t);a&&c.soundManager.continuePlayBGM(a,e),i&&(e>0?this.node.runAction(cc.sequence(cc.delayTime(e),cc.callFunc(function(){i(this)},this))):i(this))},stopBgm:function(t,e){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:t=0}c.soundManager.bgmStop(t),e&&(t>0?this.node.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){e(this)},this))):e(this))},playSe:function(t){var e=s.getResource(t);e&&c.soundManager.playSE(e,!1,function(){})},playVoice:function(t,e){switch(n.addVoiceLog(t,e),this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:break;default:var i=s.getResource(e);i&&c.soundManager.playVoice(i)}},stopVoice:function(){c.soundManager.voiceStop()},getPlayingVoiceState:function(){return c.soundManager.getPlayingVoiceState()},getMessageView:function(){return this.messageView},setActiveWaitCursor:function(t){this.clickWaitCursorNode.active=t,t&&this.clickWaitAnimation.play()},setFade:function(t,e,i,a,o){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:a*=this.getSkipRate()}0==Object.keys(n.getMovieLogMap()).length?(this.fadeNode.stopAllActions(),this.fadeNode.color=t,e>=0&&(this.fadeNode.opacity=e),this.fadeNode.runAction(cc.sequence(cc.fadeTo(a,i),cc.callFunc(function(){o&&o(this)},this)))):(this.fadeNode.opacity=0,0==i?(e=0,i=255):(e=255,i=0),this.node.stopAllActions(),e>=0&&(this.node.opacity=e),this.node.runAction(cc.sequence(cc.fadeTo(a,i),cc.callFunc(function(){o&&o(this)},this))))},setGradationSlideIn:function(t,e,i,a){var n,o,r=this.slideNode.getContentSize().height;switch(e){case"up":this.slideNode.angle=180,n=cc.v2(0,-360),o=cc.v2(0,360+r);break;case"down":this.slideNode.angle=0,n=cc.v2(0,360),o=cc.v2(0,-360-r);break;case"left":this.slideNode.angle=270,n=cc.v2(640,0),o=cc.v2(-640-r,0);break;case"right":this.slideNode.angle=90,n=cc.v2(-640,0),o=cc.v2(640+r,0)}this.fadeNode.getComponent(cc.Component).schedule(function(){var t=this.slideNode.getPosition().x-o.x,e=this.slideNode.getPosition().y-o.y;this.fadeNode.setPosition(cc.v2(t,e))}.bind(this),0);var s=this.slideNode.getPosition().x-o.x,c=this.slideNode.getPosition().y-o.y;this.fadeNode.setPosition(cc.v2(s,c)),this.fadeNode.color=i,this.scheduleOnce(function(){this.fadeNode.opacity=255}.bind(this),this),this._startGradationSlideAction(t,0,n,o,i,255,a)},setGradationSlideOut:function(t,e,i){var a,n,o=this.slideNode.getContentSize().height;switch(e){case"up":this.slideNode.angle=0,a=cc.v2(0,-360),n=cc.v2(0,360+o);break;case"down":this.slideNode.angle=180,a=cc.v2(0,360),n=cc.v2(0,-360-o);break;case"left":this.slideNode.angle=90,a=cc.v2(640,0),n=cc.v2(-640-o,0);break;case"right":this.slideNode.angle=270,a=cc.v2(-640,0),n=cc.v2(640+o,0)}this.fadeNode.getComponent(cc.Component).schedule(function(){var t=this.slideNode.getPosition().x-a.x,e=this.slideNode.getPosition().y-a.y;this.fadeNode.setPosition(cc.v2(t,e))}.bind(this),0),this.fadeNode.setPosition(cc.v2(0,0)),this._startGradationSlideAction(t,1,a,n,this.fadeNode.color,this.fadeNode.opacity,function(){this.fadeNode.opacity=0,i&&i(this)}.bind(this))},_startGradationSlideAction:function(t,e,i,a,n,o,s){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:t*=this.getSkipRate()}this.slideNode.active=!0,this.slideNode.anchorY=e,this.slideNode.setPosition(i),this.slideNode.color=n,this.slideNode.opacity=o,this.slideNode.runAction(cc.sequence(cc.moveTo(t,a),cc.callFunc(function(){this.slideNode.active=!1,this.fadeNode.setPosition(cc.v2(0,0)),this.fadeNode.getComponent(cc.Component).unscheduleAllCallbacks(),s&&s(this)},this)))},setFlash:function(t,e,i,a,n){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:i*=this.getSkipRate(),a*=this.getSkipRate()}this.fadeNode.stopAllActions(),this.fadeNode.color=t;var o=[];o.push(cc.fadeIn(.5*i));for(var s=1;s<e;s++)o.push(cc.fadeOut(.5*i)),o.push(cc.fadeIn(.5*i));o.push(cc.fadeOut(a)),o.push(cc.callFunc(function(){n&&n(this)},this)),this.fadeNode.runAction(cc.sequence(o))},setShake:function(t,e,i,a,n,o){var c=this.shakeTargetNode,l=cc.v2(0,0);switch(n&&this._findContentNodeByChildTagName(n)&&(c=this._findContentNodeByChildTagName(n),l=cc.v2(c.getPosition().x,c.getPosition().y)),this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:t*=this.getSkipRate()}c.stopAllActions();var u=[];u.push(cc.moveBy(.5*t,cc.v2(-.5*i,-.5*a)));for(var h=0;h<e;h++){var d=s.getRandomForFloat(.5*i,i),p=s.getRandomForFloat(.5*-a,a);u.push(cc.moveBy(.5*t,cc.v2(d,p))),u.push(cc.moveBy(.5*t,cc.v2(-d,-p)))}u.push(cc.moveTo(.5*t,l)),u.push(cc.callFunc(function(){o&&o(this)})),c.runAction(cc.sequence(u))},setVisibleMessageUI:function(t,e){this.messageView.node.active=t,e&&e(this)},setBgImage:function(t,e,i,a){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:e*=this.getSkipRate()}this._instantBgNode=cc.instantiate(this.bgImageSprite.node),this.node.addChild(this._instantBgNode,this.bgImageSprite.node.zIndex-1),this._setBgImageByFileName(t),this.bgImageSprite.node.opacity=0,this.bgImageSprite.node.runAction(cc.sequence(cc.fadeTo(e,i),cc.callFunc(function(){a&&a(this),this._instantBgNode&&(this._instantBgNode.destroy(),this._instantBgNode=null)},this)))},_setBgImageByFileName:function(t){if(0===t.indexOf("color_")){this.bgImageSprite.spriteFrame=this.fadeNode.getComponent(cc.Sprite).spriteFrame;var e=t.split("_");this.bgImageSprite.node.color=cc.color(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]))}else this.bgImageSprite.node.color=cc.Color.WHITE,this.bgImageSprite.spriteFrame=s.getResource(t)},removeBgImage:function(t,e){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:t*=this.getSkipRate()}this.bgImageSprite.node.stopAllActions(),this.bgImageSprite.node.runAction(cc.sequence(cc.fadeOut(t),cc.callFunc(function(){e&&e(this),this.bgImageSprite.spriteFrame=null},this)))},setImageConfig:function(t,e,i,a,n,o,c,l,u,h){if(this._findContentNodeByChildTagName(t)){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:u*=this.getSkipRate()}var d=this._findContentNodeByChildTagName(t),p=null;e&&(p=this._findContentNodeByChildTagName(e)),u>0?s.setFadeOutAll(d,u/2,function(){e&&(d.removeFromParent(!1),p.addChild(d)),null!==a&&null!==n&&d.setContentSize(cc.size(a,n)),d.setPosition(i),d.zIndex=o,d.scaleX=c,d.scaleY=l,s.setFadeIn(d,u/2,function(){h&&h(this)}.bind(this))}.bind(this)):(e&&(d.removeFromParent(!1),p.addChild(d)),null!==a&&null!==n&&d.setContentSize(cc.size(a,n)),d.setPosition(i),d.zIndex=o,d.scaleX=c,d.scaleY=l,h&&h(this))}else h&&h(this)},addMask:function(t,e,i,a,n){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:a*=this.getSkipRate()}var o=this._findContentNodeByChildTagName(t);o&&(o.removeFromParent(),o.destroy());var c=new cc.Node(t).addComponent(cc.Mask);c.node.setContentSize(i),this._findParentNodeByChildTagName(t).addChild(c.node),c.node.setPosition(e),a>0?s.setFadeIn(c.node,a,function(){n&&n(this)}.bind(this)):n&&n(this)},addImageSprite:function(t,e,i,a,n,o){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:n*=this.getSkipRate()}var l=this._findContentNodeByChildTagName(e);l&&(l.removeFromParent(),l.destroy());var u=new cc.Node(e).addComponent(cc.Sprite);if(u.spriteFrame=s.getResource(t),u.node.scale=a,c.downManifestManager){var h=c.downManifestManager.getFileScaleData(t);u.node.scale*=1/h}this._findParentNodeByChildTagName(e).addChild(u.node),u.node.setPosition(i),n>0?(u.node.opacity=0,u.node.runAction(cc.sequence(cc.fadeIn(n),cc.callFunc(function(){o&&o(this)},this)))):o&&o(this)},addImageSpriteAtlas:function(t,e,i,a,n,o,l){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:o*=this.getSkipRate()}var u=this._findContentNodeByChildTagName(i);u&&(u.removeFromParent(),u.destroy());var h=new cc.Node(i);h.addComponent(cc.Sprite);var d=s.getResource(t);if(d&&d.getSpriteFrame(e[0])){var p=d.getSpriteFrame(e[0]).getOriginalSize();h.setContentSize(p),h.scale=n;var m=new cc.Node,_=null;d=null;for(var g=0;g<e.length;g+=1)_=(new cc.Node).addComponent(cc.Sprite),(d=s.getResource(t))&&d.getSpriteFrame(e[g])&&(_.spriteFrame=d.getSpriteFrame(e[g]),_.node.position=_.spriteFrame.getOffset(),m.addChild(_.node)),_=null,d=null;if(h.addChild(m),c.downManifestManager){n=c.downManifestManager.getFileScaleData(t);m.scale*=1/n}this._findParentNodeByChildTagName(i).addChild(h),h.setPosition(a),o>0?(h.opacity=0,h.runAction(cc.sequence(cc.fadeIn(o),cc.callFunc(function(){l&&l(this)},this)))):l&&l(this)}else l&&l(this)},addSpine:function(t,e,i,a,n,o,c){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:o*=this.getSkipRate()}var l=this._getChildSpine(t,e);l.node.scale=a,l.node.setPosition(i),o>0?s.setFadeIn(l.node,o,function(){l.timeScale=n,c&&c(this)}):c&&(l.timeScale=n,c(this))},_getChildSpine:function(t,e){var i=this._findContentNodeByChildTagName(e);return i?i.getComponent(sp.Skeleton)?i.getComponent(sp.Skeleton):(i.removeFromParent(),i.destroy(),this._createToAddSpine(t,e)):this._createToAddSpine(t,e)},_createToAddSpine:function(t,e){var i=new cc.Node(e).addComponent(sp.Skeleton);return this._findParentNodeByChildTagName(e).addChild(i.node),i.skeletonData=s.getResource(t),i.timeScale=0,i},setSpineSequence:function(t,e,i,a,n,o){var r=this._findContentNodeByChildTagName(t).getComponent(sp.Skeleton);o&&this._callbackArrayForClick.push(o),this._setSpineAnimation(r,e,i,a,n,0,o)},_setSpineAnimation:function(t,e,i,a,n,o,r){var c;if(i[o+1])c=!1,t.setCompleteListener(function(){o+=1,this._setSpineAnimation(t,e,i,a,n,o)}.bind(this));else{for(var l in c=a,this._callbackArrayForClick)r===this._callbackArrayForClick[l]&&this._callbackArrayForClick.splice(l,1);t.setCompleteListener(null)}t.defaultSkin=e[o],t.setSkin(e[o]),i[o]&&(t.defaultAnimation=i[o],t.setAnimation(0,i[o],c)),t.setSlotsToSetupPose(),n>0&&s.setFadeIn(t.node,n)},setAnimationForContent:function(t,e,i,a,n,o){var s=i;switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:s=i*this.getSkipRate()}if(this._findContentNodeByChildTagName(n)){var c=this._findContentNodeByChildTagName(n),l=c.getComponentsInChildren(cc.Sprite);switch(t){case"move":this._playAnimMove(c,l,t,e,s,a,o);break;case"scale":this._playAnimScale(c,l,t,e,s,a,o);break;case"fade":this._playAnimFade(c,l,t,e,s,a,o);break;case"jump":this._playAnimJump(c,l,t,e,s,a,o);break;case"tint":this._playAnimTint(c,l,t,e,s,a,o)}}else o&&o(this)},_playAnimMove:function(t,e,i,a,n,o,s){if(this.getPlayState()===r.ADV_PLAY_STATE.SKIP)return t.setPosition(cc.v2(parseFloat(a[0]),parseFloat(a[1]))),void(s&&s(this));var c=cc.moveTo(n,cc.v2(parseFloat(a[0]),parseFloat(a[1])));o&&(c=c.easing(cc.easeSineInOut())),t.getActionByTag(this.ACTION_MOVE_TAG)&&!t.actionEnd&&(t.stopActionByTag(this.ACTION_MOVE_TAG),t.callFunc&&t.callFunc(),t.callFunc=null);var l=cc.sequence(c,cc.callFunc(function(){s&&s(this),t.actionEnd=!0}));l.setTag(this.ACTION_MOVE_TAG),t.callFunc=s,t.actionEnd=!1,t.runAction(l)},_playAnimScale:function(t,e,i,a,n,o,s){if(this.getPlayState()===r.ADV_PLAY_STATE.SKIP)return t.scaleX=parseFloat(a[0]),t.scaleY=parseFloat(a[1]),void(s&&s(this));var c=cc.scaleTo(n,parseFloat(a[0]),parseFloat(a[1]));o&&(c=c.easing(cc.easeSineInOut())),t.runAction(cc.sequence(c,cc.callFunc(function(){s&&s(this)})))},_playAnimFade:function(t,e,i,a,n,o,s){if(this.getPlayState()===r.ADV_PLAY_STATE.SKIP)return t.opacity=parseInt(a[0]),void(s&&s(this));var c=cc.fadeTo(n,parseInt(a[0]));o&&(c=c.easing(cc.easeSineInOut())),t.runAction(cc.sequence(c,cc.callFunc(function(){s&&s(this)})))},_playAnimJump:function(t,e,i,a,n,o,s){if(this.getPlayState()===r.ADV_PLAY_STATE.SKIP)return t.setPosition(cc.v2(parseFloat(a[0]),parseFloat(a[1]))),void(s&&s(this));var c=cc.jumpTo(n,cc.v2(parseFloat(a[0]),parseFloat(a[1])),parseFloat(a[2]),parseInt(a[3]));o&&(c=c.easing(cc.easeSineInOut())),t.runAction(cc.sequence(c,cc.callFunc(function(){s&&s(this)})))},_playAnimTint:function(t,e,i,a,n,o,s){if(this.getPlayState()!==r.ADV_PLAY_STATE.SKIP){var c=cc.tintTo(n,parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));o&&(c=c.easing(cc.easeSineInOut())),e.length>0?(t.runAction(cc.sequence(cc.delayTime(n),cc.callFunc(function(){s&&s(this)},this))),e.forEach(function(t){var e=c.clone();t.node.runAction(e)})):t.runAction(cc.sequence(c,cc.callFunc(function(){s&&s(this)})))}else{t.color=cc.color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));for(var l=0;l<e.length;l+=1)e[l].node.color=cc.color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));s&&s(this)}},removeContent:function(t,e,i){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:e*=this.getSkipRate()}var a=this._findContentNodeByChildTagName(t);a?(a.name="",s.setFadeOut(a,e,function(){a.removeFromParent(),a.destroy(),i&&i(this)}.bind(this))):i&&i(this)},removeContentAll:function(t,e){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:t*=this.getSkipRate()}s.setFadeOutAll(this.contentNode,t,function(){this.contentNode.destroyAllChildren(),this.contentNode.opacity=255,this.contentNode.color=cc.color(255,255,255),e&&e(this)}.bind(this))},setWait:function(t,e){switch(this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:t*=this.getSkipRate()}this.node.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){e&&e(this)},this)))},setName:function(t,e){this.getMessageView().setName(t,e),n.setCurrentDispName(t)},setMessage:function(t,e,i){this.getMessageView().setMessage(e,i),e&&e.match(/\S/g)&&this.addMessageLog(t,n.getCurrentDispName(),e)},addMessageLog:function(t,e,i){n.addMessageLog(t,e,i)},setMessageDispLength:function(t){this.getMessageView().messageText.setDispLength(t)},setSelectThumbnails:function(t){this.getMessageView().setSelectThumbnails(this,t)},_viewTapEvent:function(){n.tapEvent(this)},_findParentNodeByChildTagName:function(t){var e=t.split("/");if(e.length>1){e.pop();var i=e.join("/");return cc.find(i,this.contentNode)}return this.contentNode},_findContentNodeByChildTagName:function(t){var e=this.contentNode.getComponentsInChildren(cc.Sprite).find(function(e){return e.node.name===t});return e?e.node:(e=this.contentNode.getComponentsInChildren(sp.Skeleton).find(function(e){return e.node.name===t}))?e.node:(e=this.contentNode.getComponentsInChildren(cc.Mask).find(function(e){return e.node.name===t}))?e.node:(e=this.contentNode.getComponentsInChildren("MovieController").find(function(e){return e.node.name===t}))?e.node:null}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvManager:"AdvManager",AdvSingleton:"AdvSingleton",AdvSoundManager:"AdvSoundManager",AdvUtils:"AdvUtils",MessageView:"MessageView"}],AdvSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"d3ccdqIJt5Bao+kmYzvraf5","AdvSubRoot");var a=t("AdvSubRootBase"),n=t("CommonButton"),o=t("ExtensionAdvUtils"),r=t("AdvManager"),s=t("AdvConstants"),c=t("AdvSingleton"),l=t("CustomCommandTypeList"),u=t("CustomCommandTypeResourceList"),h=t("ResourceUtils"),d=t("RoomUtils"),p=t("Singleton"),m=(t("BattleData"),t("BattleFunction")),g=t("SoundManager"),C=t("FileLoaderManager"),f=t("MemoryManager"),E=t("DownManifestManager"),T=t("PopupUtils"),S=t("TutorialConst"),R=t("LocalDataConst"),A=t("AdvCustomConstants"),b=(t("AdvSingletonConst"),t("StaticResourceConst"),t("GameConst"),1.2),M=1;cc.Class({extends:a,properties:{soundMuteBtn:n,configBtn:n,nextBtn:n,autoBtn:n,skipBtn:n,logBtn:n,hideUiBtn:n,roomWholeFurnitureViewPrefab:cc.Prefab},_contentTagMap:null,_callbackToTutorialEndBtn:null,initTutorialSubRoot:function(t,e,i,a){c.soundManager||(p.soundManager?c.soundManager=p.soundManager:c.soundManager=new g),c.downManifestManager||(c.downManifestManager=p.downManifestManager),this._callbackToTutorialEndBtn=null,this.initAdvSubRoot(t,e,i,a),this.soundMuteBtn.node.active=!1,this.configBtn.node.active=!1,this.hideUiBtn.node.active=!1,this.nextBtn.node.active=!1},initAdvSubRoot:function(t,e,i,a,n,o){this._contentTagMap={},c.soundManager||(p.soundManager?c.soundManager=p.soundManager:(c.soundManager=new g,p.soundManager=c.soundManager)),this.soundMuteBtn.switchBtnImage(!c.soundManager.soundMute),c.fileLoaderManager||(p.fileLoaderManager?(c.fileLoaderManager=p.fileLoaderManager,c.memoryManager=p.memoryManager,c.downManifestManager=p.downManifestManager):(c.fileLoaderManager=new C,p.memoryManager=new f,c.downManifestManager=new E)),this._super(t,e,i,a,n,o,this.requestAdvRes)},requestAdvRes:function(t,e,i){if(c.res[t])return cc.log("this file is already loaded { "+t+" }"),i?i():void 0;r.getAdvData().maxResourceCount+=1,r.getAdvData().requestResList[t]=e,cc.log("advsubroot requestAdvRes loadFile:"+t),c.fileLoaderManager.loadFile(t,e,function(a,n){return r.onLoadedAdvRes(t,e,i,a,n)})},_loadUIResources:function(){r.requestAdvRes(s.ADV_POPUP_OPEN_ANIM_CLIP_PATH,cc.AnimationClip),r.requestAdvRes(s.ADV_POPUP_CLOSE_ANIM_CLIP_PATH,cc.AnimationClip)},_getCustomCommandObject:function(){return{customCommandTypeList:l,customCommandTypeResourceList:u}},_initButtons:function(){this.skipBtn.switchBtnImage(!1),this.autoBtn.switchBtnImage(!1),this.autoBtn.setTapEvent(this._autoBtnEvent.bind(this)),this.skipBtn.setTapEvent(this._skipBtnEvent.bind(this)),this.logBtn.setTapEvent(this._logBtnEvent.bind(this)),this.nextBtn.setTapEvent(this._nextBtnEvent.bind(this)),this.hideUiBtn.setTapEvent(this._hideUiBtnEvent.bind(this),n.SE_NAME.CANCEL),this.soundMuteBtn.setTapEvent(this._soundMuteBtnEvent.bind(this)),this.configBtn.setTapEvent(this._configBtnEvent.bind(this))},openLogPopup:function(){this.closeLogPopup();var t=this.getPlayState();this.setPlayState(s.ADV_PLAY_STATE.PLAY),this._advLogPopup=cc.instantiate(this.advLogPopupPrefab).getComponent("D1AdvLogPopup"),this._advLogPopup.openAdvLogPopup(this,r.getMessageLogList(),r.getVoiceLogMap(),this._onClosePopup.bind(this,t))},closeLogPopup:function(){this._advLogPopup&&(this._advLogPopup.close(),this._advLogPopup=null)},openConfigPopup:function(){this.closeConfigPopup();var t=this.getPlayState();this.setPlayState(s.ADV_PLAY_STATE.PLAY),this._advConfigPopup=cc.instantiate(this.advConfigPopupPrefab).getComponent("D1AdvConfigPopup"),this._advConfigPopup.openAdvConfigPopup(r.getSynopsisText(),this._callbackToEndAdv,this._onClosePopup.bind(this,t))},closeConfigPopup:function(){this._advConfigPopup&&(this._advConfigPopup.close(),this._advConfigPopup=null)},_onClosePopup:function(t){this.soundMuteBtn.switchBtnImage(!c.soundManager.soundMute),this.setPlayState(t)},_viewTapEvent:function(){r.tapEvent(this)},_autoBtnEvent:function(){switch(cc.log("\u30aa\u30fc\u30c8\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.getPlayState()){case s.ADV_PLAY_STATE.AUTO:this.autoBtn.switchBtnImage(!1),this.setPlayState(s.ADV_PLAY_STATE.PLAY);break;case s.ADV_PLAY_STATE.END:break;default:this.autoBtn.switchBtnImage(!0),this.skipBtn.switchBtnImage(!1),this.setPlayState(s.ADV_PLAY_STATE.AUTO)}},_skipBtnEvent:function(){switch(cc.log("\u30b9\u30ad\u30c3\u30d7\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.getPlayState()){case s.ADV_PLAY_STATE.SKIP:this.skipBtn.switchBtnImage(!1),this.setPlayState(s.ADV_PLAY_STATE.PLAY);break;case s.ADV_PLAY_STATE.END:break;default:this.skipBtn.switchBtnImage(!0),this.autoBtn.switchBtnImage(!1),this.setPlayState(s.ADV_PLAY_STATE.SKIP),c.soundManager.voiceStop()}},_logBtnEvent:function(){cc.log("\u30ed\u30b0\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.openLogPopup()},_nextBtnEvent:function(){cc.log("\u8aad\u4e86\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8");var t=this.getPlayState();this.setPlayState(s.ADV_PLAY_STATE.PLAY),T.openCommonPopupYesNo("\u30b9\u30c8\u30fc\u30ea\u30fc\u518d\u751f\u7d42\u4e86\u78ba\u8a8d","\u30b9\u30c8\u30fc\u30ea\u30fc\u306e\u518d\u751f\u3092\u7d42\u4e86\u3057\u307e\u3059\u304b\uff1f","",!1,function(){this._callbackToEndAdv&&this._callbackToEndAdv(c.soundManager.getSoundConfig())}.bind(this),function(){this.setPlayState(t)}.bind(this),"\u306f\u3044","\u3044\u3044\u3048",!0)},_hideUiBtnEvent:function(){cc.log("UI\u6d88\u53bb\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.uiNode.active=!1;var t=new cc.Node("DispUITouchNode");t.setContentSize(cc.winSize),t.on(cc.Node.EventType.TOUCH_START,function(e){this.uiNode.active=!0,t.destroy(),e.stopPropagation()},this),cc.director.getScene().getChildByName("Canvas").addChild(t)},_soundMuteBtnEvent:function(){cc.log("\u30df\u30e5\u30fc\u30c8\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),c.soundManager.setMute(!c.soundManager.soundMute),this.soundMuteBtn.switchBtnImage(!c.soundManager.soundMute)},_configBtnEvent:function(){cc.log("\u8a2d\u5b9a\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.openConfigPopup()},setBgImage:function(t,e,i,a){switch(this.getPlayState()){case s.ADV_PLAY_STATE.SKIP:e*=this.getSkipRate()}this._instantBgNode=cc.instantiate(this.bgImageSprite.node),this.node.addChild(this._instantBgNode,this.bgImageSprite.node.zIndex-1),this.bgImageSprite.node.destroyAllChildren(),this._setBgImageByFileName(t),this.bgImageSprite.node.opacity=0,this.bgImageSprite.node.runAction(cc.sequence(cc.fadeTo(e,i),cc.callFunc(function(){a&&a(this),this._instantBgNode&&(this._instantBgNode.destroy(),this._instantBgNode=null)},this)))},setRoomBgImage:function(t,e,i){switch(this.getPlayState()){case s.ADV_PLAY_STATE.SKIP:e*=this.getSkipRate()}this._instantBgNode=cc.instantiate(this.bgImageSprite.node),this.node.addChild(this._instantBgNode,this.bgImageSprite.node.zIndex-1),this.bgImageSprite.node.destroyAllChildren();var a=d.getRoomFurnitureModelArrayByCharacterGroupId(t);if(a.length>0){var n=cc.instantiate(this.roomWholeFurnitureViewPrefab).getComponent("RoomWholeFurnitureView");n.initRoomWholeFurnitureViewFromFurnitures(a),this.bgImageSprite.node.addChild(n.node)}else this._setBgImageByFileName(A.DEBUG_ROOM_BG_FILE_NAME);this.bgImageSprite.node.color=cc.Color.WHITE,this.bgImageSprite.node.opacity=0,this.bgImageSprite.node.runAction(cc.sequence(cc.fadeIn(e),cc.callFunc(function(){i&&i(this),this._instantBgNode&&(this._instantBgNode.destroy(),this._instantBgNode=null)},this)))},_setBgImageByFileName:function(t){this._super(t),this.bgImageSprite.node.scale=this._getBgScale(t)},_getBgScale:function(t){return this._isStillBg(t)?M:b},_isStillBg:function(t){if((t.startsWith("download/character/")||t.startsWith("/download/character/"))&&t.indexOf("/adv/image/")>0){var e=t.split("/");if(e.length>0){var i=e[e.length-1].split(".")[0];if(!_.isNaN(parseInt(i))&&3===i.length)return!0}}return!1},_isBg:function(t){return!!t&&(t.startsWith("download/bg/")||t.startsWith("/download/bg/"))},playTutorialEvent:function(t,e){var i=p.dao.TutorialEventMasters.find(function(e){return e.getTutorialEventId()===t});switch(i.getActionType()){case S.TUTORIAL_ACTION_TYPE.BUTTON:this._playBtnEventTutorial(i,e);break;case S.TUTORIAL_ACTION_TYPE.BATTLE_STATE:this._playBattleEventTutorial(i,e)}},_playBtnEventTutorial:function(t,e){var i=this._findTutorialTargetComponent(t.getActionParam1(),t.getActionParam2());if(this._addModalLayer(),i){var a=i.node.parent,n=i.node.getPosition(),o=i.node.convertToWorldSpaceAR(cc.v2(0,0)),r=this.node.convertToNodeSpaceAR(o),s=i.node.parent.getComponent(cc.Layout);s&&(s.enabled=!1),i.node.removeFromParent(!1),this.node.addChild(i.node),i.node.setPosition(r),this._setTutorialEvent(i,a,n,t,e)}else cc.warn("target = "+t.getActionParam2(),"\u6307\u5b9a\u306e\u30ce\u30fc\u30c9\u3092\u518d\u63a2\u7d22\u3057\u307e\u3059\u3002"),this.scheduleOnce(function(){this._playBtnEventTutorial(t,e)}.bind(this),.1)},_addModalLayer:function(){this._removeModalLayer();var t=new cc.Node("AdvModalLayer");t.setContentSize(cc.winSize),t.on(cc.Node.EventType.MOUSE_ENTER,function(t){t.stopPropagation()},this),t.on(cc.Node.EventType.TOUCH_END,function(t){t.stopPropagation()},this),this.node.addChild(t)},_removeModalLayer:function(){this.isValid&&this.node.getChildByName("AdvModalLayer")&&this.node.getChildByName("AdvModalLayer").destroy()},_findTutorialTargetComponent:function(t,e){return cc.director.getScene().getChildByName("Canvas").getComponentsInChildren(t).find(function(t){return t.node.name===e})},_isExceptionTutorial:function(t){for(var e=Object.keys(S.EXCEPTION_TUTORIAL_EVENT),i=0;i<e.length;i+=1)if(e[i]&&S.EXCEPTION_TUTORIAL_EVENT[e[i]]&&t.getTutorialEventId()===S.EXCEPTION_TUTORIAL_EVENT[e[i]].EVENT_ID&&t.getCompleteSubStep()===S.EXCEPTION_TUTORIAL_EVENT[e[i]].SUB_STEP)return!0;return!1},_setTutorialEvent:function(t,e,i,a,n){if(t.getTapEvent&&t.setTapEvent&&t.setTouchEnable){var o=t.getTapEvent();a.getCompleteStep()>0||this._isExceptionTutorial(a)?(this._callbackToTutorialEndBtn=o,t.setTapEvent(this._onEndTutorialEvent.bind(this,t,a,function(){n(this)}.bind(this)))):t.setTapEvent(this._onEndTutorialEvent.bind(this,t,a,function(){o(),t.node.removeFromParent(!1),e.addChild(t.node),t.node.setPosition(i),this._removeModalLayer(),n(this)}.bind(this))),t.setTouchEnable(!0)}else cc.error('\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u306b\u306f\u6307\u5b9a\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b"getTapEvent"\u3001"setTapEvent"\u3001"setTouchEnable"\u306e\u5b9a\u7fa9\u304c\u5fc5\u8981\u3067\u3059\u3002')},_onEndTutorialEvent:function(t,e,i){e.getCompleteStep()>0?(p.localData[R.TUTORIAL_SUB_STEP]=S.SUB_STEP_DISABLE,this._callbackToEndAdv(c.soundManager.getSoundConfig())):e.getCompleteSubStep()>S.SUB_STEP_DISABLE?(p.localData[R.TUTORIAL_SUB_STEP]=e.getCompleteSubStep()+1,this.scheduleOnce(i)):this.scheduleOnce(i),t.setTouchEnable(!1)},_playBattleEventTutorial:function(t,e){switch(t.getActionParam1()){case S.BATTLE_EVENT.SKILL_GAUGE:this._playBattleEventForSkillGauge(t,e)}},_playBattleEventForSkillGauge:function(t,e){var i=t.getActionParam2().split("_"),a=m.getUnitList(i[0]===S.BATTLE_EVENT_TARGET.ENEMY_UNIT),n=Math.min(Math.max(parseInt(i[1])-1,0),a.length-1),o=Math.min(Math.max(parseInt(i[2]),0),100);a[n].curSkillRate=o,a[n].unitController.setSkillRate(o),e&&e(this)},playCallbackToTutorialEndBtn:function(){this._callbackToTutorialEndBtn&&this._callbackToTutorialEndBtn()},addImageSpriteAtlas:function(t,e,i,a,n,r,l){switch(this.getPlayState()){case s.ADV_PLAY_STATE.SKIP:r*=this.getSkipRate()}var u=this._findContentNodeByChildTagName(i);u&&(u.removeFromParent(),u.destroy());var h=new cc.Node(i);h.addComponent(cc.Sprite);var d=o.getResource(t);if(d&&d.getSpriteFrame(e[0])){this._contentTagMap[i]=t;var p=d.getSpriteFrame(e[0]).getOriginalSize();h.setContentSize(p),h.scale=n;var m=new cc.Node,_=null;d=null;for(var g=0;g<e.length;g+=1)_=(new cc.Node).addComponent(cc.Sprite),(d=o.getResource(t))&&d.getSpriteFrame(e[g])&&(_.spriteFrame=d.getSpriteFrame(e[g]),_.node.position=_.spriteFrame.getOffset(),m.addChild(_.node)),_=null,d=null;if(h.addChild(m),c.downManifestManager){var C=c.downManifestManager.getFileScaleData(t);m.scale*=1/C}this._findParentNodeByChildTagName(i).addChild(h),h.setPosition(a),r>0?(h.opacity=0,h.runAction(cc.sequence(cc.fadeIn(r),cc.callFunc(function(){l&&l(this)},this)))):l&&l(this)}else l&&l(this)},playMovie:function(t,e,i,a){r.addMovieLog(e,t),this.getPlayState();var n=o.getResource(t);if(n){this._contentTagMap[e]=t;var s=cc.instantiate(this.advMovie).getComponent("MovieController"),c=s.node.children[0].getComponent(cc.VideoPlayer);s.node.setName(e),s.setLoop(i),this._findParentNodeByChildTagName(e).addChild(s.node);var l=this,u=function(){l.shakeTargetNode.active=!1;for(var t=l.node.parent.children,e=t.indexOf(l.node),i=0;i<t.length;i++)i!==e&&(t[i].name.startsWith("BandNode")||(t[i].opacity=0));cc.Camera.main.node.active=!0,s.setTapEvent(function(){}),s.setCompleteListener(function(){a&&a(s)})};return cc.sys.isNative?(c.clip=n,u()):h.addMovie(c,t,function(){c._impl._video.style.zIndex=-1,u()}),c}return null},removeMovie:function(t,e,i){var a=this._findContentNodeByChildTagName(t);if(a)if(e>0)a.runAction(cc.sequence(cc.delayTime(e),cc.callFunc(function(){a.name="",a.removeFromParent(),a.destroy(),i&&i(this)}.bind(this),this)));else{a.name="",a.removeFromParent(),a.destroy(),this.shakeTargetNode.active=!0;for(var n=this.node.parent.children,o=0;o<n.length;o++)n[o].opacity=255;i&&i(this)}else i&&i(this);r.removeMovieLog(t)},addImageSprite:function(t,e,i,a,n,r){switch(this.getPlayState()){case s.ADV_PLAY_STATE.SKIP:n*=this.getSkipRate()}var l=this._findContentNodeByChildTagName(e);l&&(l.removeFromParent(),l.destroy()),this._contentTagMap[e]=t;var u=new cc.Node(e).addComponent(cc.Sprite);if(u.spriteFrame=o.getResource(t),u.node.scale=a,c.downManifestManager){var h=c.downManifestManager.getFileScaleData(t);u.node.scale*=1/h,u.node.resScale=h}this._findParentNodeByChildTagName(e).addChild(u.node),u.node.setPosition(i),n>0?(u.node.opacity=0,u.node.runAction(cc.sequence(cc.fadeIn(n),cc.callFunc(function(){r&&r(this)},this)))):r&&r(this)},_playAnimScale:function(t,e,i,a,n,o,r){var l=parseFloat(a[0]),u=parseFloat(a[1]);if(c.downManifestManager&&this._isBg(this._contentTagMap[t.name])){var h=c.downManifestManager.getFileScaleData(this._contentTagMap[t.name]);l*=1/h,u*=1/h}if(this.getPlayState()===s.ADV_PLAY_STATE.SKIP)return t.scaleX=l,t.scaleY=u,void(r&&r(this));var d=cc.scaleTo(n,l,u);o&&(d=d.easing(cc.easeSineInOut())),t.runAction(cc.sequence(d,cc.callFunc(function(){r&&r(this)})))},setImageConfig:function(t,e,i,a,n,r,c,l,u,h){if(this._findContentNodeByChildTagName(t)){switch(this.getPlayState()){case s.ADV_PLAY_STATE.SKIP:u*=this.getSkipRate()}var d=this._findContentNodeByChildTagName(t),p=null;e&&(p=this._findContentNodeByChildTagName(e)),u>0?o.setFadeOutAll(d,u/2,function(){e&&(d.removeFromParent(!1),p.addChild(d)),null!==a&&null!==n&&d.setContentSize(cc.size(a,n)),d.setPosition(i),d.zIndex=r,d.resScale?(d.scaleX=c/d.resScale,d.scaleY=l/d.resScale):(d.scaleX=c,d.scaleY=l),o.setFadeIn(d,u/2,function(){h&&h(this)}.bind(this))}.bind(this)):(e&&(d.removeFromParent(!1),p.addChild(d)),null!==a&&null!==n&&d.setContentSize(cc.size(a,n)),d.setPosition(i),d.zIndex=r,d.resScale?(d.scaleX=c/d.resScale,d.scaleY=l/d.resScale):(d.scaleX=c,d.scaleY=l),h&&h(this))}else h&&h(this)},setMovieSequence:function(t){t&&this._callbackArrayForClick.push(t)}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvCustomConstants:"AdvCustomConstants",AdvManager:"AdvManager",AdvSingleton:"AdvSingleton",AdvSingletonConst:"AdvSingletonConst",AdvSubRootBase:"AdvSubRootBase",BattleData:"BattleData",BattleFunction:"BattleFunction",CommonButton:"CommonButton",CustomCommandTypeList:"CustomCommandTypeList",CustomCommandTypeResourceList:"CustomCommandTypeResourceList",DownManifestManager:"DownManifestManager",ExtensionAdvUtils:"ExtensionAdvUtils",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",RoomUtils:"RoomUtils",Singleton:"Singleton",SoundManager:"SoundManager",StaticResourceConst:"StaticResourceConst",TutorialConst:"TutorialConst"}],AdvText:[function(t,e,i){"use strict";cc._RF.push(e,"34c721MFiJGfZL8V3XRjcwl","AdvText");var a=t("AdvConstants"),n=/<(.*?)>/;cc.Class({extends:cc.Label,_planeText:null,_latestTextFontSize:null,_textFontSizeArrayByIndex:null,_tagInfoArray:null,_customTagInfoArrayByIndex:null,_contentNode:null,_maxLength:0,_dispLength:0,_beforeFontResize:0,setCustomText:function(t,e){this.node.active=!1,this._restoreFontSize(),this._contentNode?this._contentNode.destroyAllChildren():(this._contentNode=new cc.Node("contentNode"),this.node.addChild(this._contentNode)),this._initTagInfoArray(t),this._initPlaneTextAndCustomTagInfoArrayByIndex(t),this.setDispLength(e),this.node.active=!0},getPlaneText:function(){return this._planeText},_initTagInfoArray:function(t){this._tagInfoArray=[];for(var e=new RegExp(n,"g"),i=!0;i;)(i=e.exec(t))&&this._tagInfoArray.push(i)},_getTagInfoByIndex:function(t){return this._tagInfoArray.find(function(e){return parseInt(e.index)===parseInt(t)})},_createRubyTagObject:function(t,e){var i=t.substring(e,t.indexOf("</ruby>",e)).split("|");return{name:"<ruby>",target:i[0],data:i[1]}},_initPlaneTextAndCustomTagInfoArrayByIndex:function(t){this._planeText="",this._textFontSizeArrayByIndex=[],this._customTagInfoArrayByIndex=[],this._latestTextFontSize=this.fontSize;for(var e=!1,i=0;i<t.length;i+=1)if("|"===t[i]){i=t.indexOf("</ruby>",i)-1}else{for(var a=[],n=i;n<t.length;n+=1){var o=this._getTagInfoByIndex(n);if(!o){i=n;break}this._setLatestFontSize(o[0]),a.push(this._createTagObject(o[0],t,n)),n+=parseInt(o[0].length-1)}this._customTagInfoArrayByIndex.push(a);for(var r=0,s=0;s<a.length;s+=1)r+=a[s].name.length;if(e){if(t[i]+t[i+1]==="</")break;if(t[i-1]+t[i]==="</"){this._planeText=this._planeText.slice(0,-1);break}this._planeText+=t[i],this._textFontSizeArrayByIndex.push(this._getTextLength(t[i])*this._latestTextFontSize)}else i+r<t.length||0===this._planeText.length?(this._planeText+=t[i],this._textFontSizeArrayByIndex.push(this._getTextLength(t[i])*this._latestTextFontSize)):(e=!0,this._planeText+=t[i],this._textFontSizeArrayByIndex.push(this._getTextLength(t[i])*this._latestTextFontSize))}this._maxLength=this._planeText.length},_setLatestFontSize:function(t){switch(t.substring(1,7)){case"resize":this._beforeFontResize=this.fontSize;var e=t.split("="),i=parseFloat(e[1].split(">")[0]);this._latestTextFontSize=i,this.fontSize=i}},_createTagObject:function(t,e,i){return"<ruby>"===t?this._createRubyTagObject(e,i+"<ruby>".length):{name:t,target:null,data:null}},getMaxLength:function(){return this._maxLength},setDispLength:function(t){this._contentNode&&(this._contentNode.destroyAllChildren(),t>=a.ADV_TEXT_LENGTH_MAX||t>this.getMaxLength()?this._dispLength=this.getMaxLength():this._dispLength=t,this._dispCustomText())},_dispCustomText:function(){var t=[];if(this._customTagInfoArrayByIndex.length<1)this.string="";else{for(var e=0;e<this._dispLength;e+=1)for(var i=0;i<this._customTagInfoArrayByIndex[e].length;i+=1){"<ruby>"===this._customTagInfoArrayByIndex[e][i].name&&e+this._customTagInfoArrayByIndex[e][i].target.length<=this._dispLength&&this._addRubyTextNode(this._customTagInfoArrayByIndex[e][i],e,this._getRubyColor(e,t),this._getOutlineData(e,t))}if(this.string=this._planeText.substring(0,this._dispLength),!this.node.getComponent(cc.LabelOutline)){var a=this.node.addComponent(cc.LabelOutline);a.width=2,a.color=cc.color(0,0,0)}}},_createAfterCustomText:function(t,e){if(e.length>0){for(var i=e.length,a=0;a<i;a+=1)t+=e.pop();e=[]}return t},_getRubyColor:function(t,e){if(e.length>0){if(e.find(function(t){return"</color>"===t}))for(var i=t;i>-1;i-=1){var a=this._getStartColorTag(this._customTagInfoArrayByIndex[i]);if(a)return a}return null}return null},_getStartColorTag:function(t){if(t.length>0)for(var e=t.length-1;e>-1;e-=1)if(-1!==t[e].name.indexOf("<color="))return t[e].name;return null},_getOutlineData:function(t,e){if(e.length>0){if(e.find(function(t){return"</outline>"===t}))for(var i=t;i>-1;i-=1){var a=this._getStartOutlineTag(this._customTagInfoArrayByIndex[i]);if(a)return a}return null}return null},_getStartOutlineTag:function(t){if(t.length>0)for(var e=t.length-1;e>-1;e-=1)if(-1!==t[e].name.indexOf("<outline"))return t[e].name;return null},_getEndTag:function(t){var e=t.slice(0,1)+"/"+t.slice(1),i=e,a=e.indexOf("=");-1!==a&&(i=e.substring(0,a),i+=">");var n=e.indexOf(" ");return-1!==n&&(i=e.substring(0,n),i+=">"),i},_getTextLength:function(t){var e=t.match(/[a-zA-Z0-9]+/g),i=t.length;if(e)for(var a=0;a<e.length;a++)t.search(e[a])>=0&&(i-=.5*e[a].length);return i},_getLineStartIndexArray:function(){for(var t=[],e=this._planeText.split("\n"),i=0;i<e.length;i+=1){var a=i>0?e[i-1].length+1:0;t.push(a);for(var n=0,o=0;o<e[i].length;o+=1){var r=this._textFontSizeArrayByIndex[i>0?o+e[i-1].length+1:o];if(n+r>this.maxWidth){a=i>0?o+e[i-1].length+1:o,t.push(a);break}n+=r}}return t},_getRubyTextPosition:function(t,e){var i=0,a=this._getLineStartIndexArray(),n=0;for(i=0;i<a.length;i+=1){if(e<a[i]){n=i-1;break}n=i}var o=a[n],r=e+t.target.length,s=0;for(i=o;i<e;i+=1)s+=this._textFontSizeArrayByIndex[i];var c=0;for(i=e;i<r;i+=1)c+=this._textFontSizeArrayByIndex[i];var l=s+c/2,u=-this.lineHeight*n;return cc.v2(l,u)},_addRubyTextNode:function(t,e,i,a){var n="";n=i?i+t.data+"</color>":t.data,a&&(n=a+t.data+"</outline>");var o=this._getRubyTextPosition(t,e);if(o){var r=new cc.Node("RubyNode_"+this.node.childrenCount).addComponent(cc.Label);r.string=n,r.font=this.font,r.fontSize=this.fontSize/40*16,r.lineHeight=this.fontSize/40*18,r.horizontalAlign=cc.Label.HorizontalAlign.CENTER,r.verticalAlign=cc.Label.VerticalAlign.CENTER,r.node.color=cc.color(255,255,255),r.node.setAnchorPoint(cc.v2(.5,.5));var s=r.node.addComponent(cc.LabelOutline);s.width=2,s.color=cc.color(0,0,0),this._contentNode.addChild(r.node),r.node.setPosition(o)}},_restoreFontSize:function(){this._beforeFontResize&&(this.fontSize=this._beforeFontResize,this._beforeFontResize=0)}}),cc._RF.pop()},{AdvConstants:"AdvConstants"}],AdvTimeUtils:[function(t,e,i){"use strict";cc._RF.push(e,"c670buF72dNW4S/keBIWp6J","AdvTimeUtils");var a=t("AdvSingleton"),n=t("AdvLocalDataConst");function o(t){return r(t)+" "+c(t)}function r(t){return t.slice(0,4)+"/"+t.slice(4,6)+"/"+t.slice(6,8)}function s(t){return t.slice(8,10)+":"+t.slice(10,12)}function c(t){return t.slice(8,10)+":"+t.slice(10,12)+":"+t.slice(12)}function l(){return u()+h()}function u(){return d()+p()+m()}function h(){return _()+g()+C()}function d(){return a.localData[n.NOW_DATETIME].getFullYear()}function p(){return("0"+(a.localData[n.NOW_DATETIME].getMonth()+1)).slice(-2)}function m(){return("0"+a.localData[n.NOW_DATETIME].getDate()).slice(-2)}function _(){return("0"+a.localData[n.NOW_DATETIME].getHours()).slice(-2)}function g(){return("0"+a.localData[n.NOW_DATETIME].getMinutes()).slice(-2)}function C(){return("0"+a.localData[n.NOW_DATETIME].getSeconds()).slice(-2)}function f(t,e){var i=new Date(o(t)),a=new Date(o(l())),n=i.getTime()-a.getTime();return!e&&n<0&&(n=0),n}function E(t){return parseInt(t/36e5)}function T(t){return parseInt(t/6e4)}function S(t){return parseInt(t/1e3)}function R(t,e){return("0000000000"+t).slice(-e)}function A(){return a.localData[n.NOW_DATETIME].getDay()}e.exports={parseTimeToYmdhm:function(t){return r(t)+" "+s(t)},parseTimeToYmdhms:o,parseTimeToYmd:r,parseTimeToHm:s,parseTimeToHms:c,parseSecondToHms:function(t){var e=new Date(1900,0,0,0,0,t),i=R(e.getSeconds(),2),a=R(e.getMinutes(),2);return R(e.getHours()+24*e.getDay(),2)+":"+a+":"+i},parseToYmdhmsMap:function(t){return{year:t.slice(0,4),month:t.slice(4,6),date:t.slice(6,8),hour:t.slice(8,10),minute:t.slice(10,12),second:t.slice(12)}},getNowDateTime:l,getNowDate:u,getNowTime:h,getNowYear:d,getNowMonth:p,getNowDay:m,getNowHour:_,getNowMinute:g,getNowSecond:C,getDiffMS:f,getDiffHms:function(t){var e=f(t),i=parseInt(E(e)%24),a=parseInt(T(e)%60),n=parseInt(S(e)%60);return R(i,2)+":"+R(a,2)+":"+R(n,2)},parseMsToDay:function(t){return parseInt(t/864e5)},parseMsToHour:E,parseMsToMinute:T,parseMsToSecond:S,parseSecondToMinute:function(t){return parseInt(t/60)},getNowWeek:A,isDateInRange:function(t,e,i){return e<=t&&t<=i},getNextWeekDifferenceTime:function(t){var e=A(),i=e===t?1440:0,a=(t+7-e)%7*1440-(60*parseInt(_())+parseInt(g()))+i,n=parseInt(a/60)+1;return{totalDay:parseInt(a/60/24)+1,totalHour:n,totalMinute:a}},getNowCountSeconds:function(){return(new Date).getTime()/1e3},isRangeOfDate:function(t,e){return t=t||"20000101000000",e=e||"99991231235959",f(t,!0)<=0&&f(e,!0)>=0}},cc._RF.pop()},{AdvLocalDataConst:"AdvLocalDataConst",AdvSingleton:"AdvSingleton"}],AdvUtils:[function(t,e,i){"use strict";cc._RF.push(e,"426dfvaDahPJKM0RoVlpRYV","AdvUtils");var a=t("AdvSingleton"),n=(t("AdvSingletonConst"),t("AdvLocalDataConst"));function o(t,e,i){t.getComponent(sp.Skeleton)&&(t.getComponent(sp.Skeleton).premultipliedAlpha=!1),t.runAction(cc.sequence(cc.spawn(cc.fadeOut(e),cc.tintTo(e,0,0,0)),cc.callFunc(function(){i&&i()},this)))}function r(t,e){return{storyFilePathName:t,synopsisFilePathName:e}}e.exports={getRoot:function(){var t=cc.director.getScene().getChildByName("Canvas").getComponent("AdvGameRootBase");return t||(t=cc.director.getScene().getChildByName("Canvas").getComponent(cc.Component))||cc.director.getScene().getChildByName("Canvas").addComponent(cc.Component)},saveLocalStorage:function(t,e){cc.log("save key="+t+" value="+e),cc.sys.localStorage.setItem(t,e)},loadLocalStorage:function(t,e,i){var a=cc.sys.localStorage.getItem(t);if(!a)return e;switch(i){case n.LOCAL_STORAGE_GET_TYPE.BOOLEAN:a="true"===a.toLowerCase()||"1"===a;break;case n.LOCAL_STORAGE_GET_TYPE.INTEGER:a=parseInt(a);break;case n.LOCAL_STORAGE_GET_TYPE.FLOAT:a=parseFloat(a)}return cc.log("load data="+a),a},getResource:function(t){cc.log("advUtils getResource:"+t);var e=null;return a.res[t]?e=a.res[t]:cc.error("{ "+t+" } \u306f\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),e},startAdv:function(t,e,i,n,o){cc.log(t),a.soundManager&&a.soundManager.bgmStop(),cc.director.loadScene("AdvScene",function(){cc.log(t),cc.director.getScene().getChildByName("Canvas").getComponent("AdvRoot").initAdvRoot(t,e,i,n,o)})},getRandom:function(t,e){var i=t,a=e;return t>e&&(i=e,a=t),Math.round(Math.random()*(a-i))+i},getRandomForFloat:function(t,e){var i=1e3*t,a=1e3*e,n=this.getRandom(i,a);return n=parseFloat(n/1e3)},setFadeIn:function(t,e,i){t.getComponent(sp.Skeleton)&&(t.getComponent(sp.Skeleton).premultipliedAlpha=!0),t.opacity=0,t.color=cc.color(0,0,0),t.runAction(cc.sequence(cc.spawn(cc.fadeIn(e),cc.tintTo(e,255,255,255)),cc.callFunc(function(){i&&i()},this)))},setFadeOut:o,setFadeOutAll:function(t,e,i){t.runAction(cc.sequence(cc.fadeOut(e),cc.callFunc(function(){i&&i()},this)));for(var a=t.getComponentsInChildren(sp.Skeleton),n=0;n<a.length;n+=1)o(a[n].node,e)},createAdvTextInfo:r,createAdvTextFileSet:function(t,e){return cc.warn("createAdvTextFileSet \u306f\u524a\u9664\u4e88\u5b9a\u306e\u6a5f\u80fd\u3067\u3059\u3002 createAdvTextInfo \u3092\u4f7f\u7528\u3059\u308b\u3088\u3046\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),r(t,e)}},cc._RF.pop()},{AdvLocalDataConst:"AdvLocalDataConst",AdvSingleton:"AdvSingleton",AdvSingletonConst:"AdvSingletonConst"}],AdvWindowBase:[function(t,e,i){"use strict";cc._RF.push(e,"4a46f1sE7VAXaLKFTZUWTpz","AdvWindowBase");cc.Class({extends:cc.Component,properties:{windowNode:cc.Node},_openWindowBase:function(){this.node.active=!0},_closeWindowBase:function(){this.node.destroy()},open:function(){this._openWindowBase()},close:function(){this._closeWindowBase()}});cc._RF.pop()},{}],AlertPopup:[function(t,e,i){"use strict";cc._RF.push(e,"da30chI95hBpIWfp9nlqYNV","AlertPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{mainLabel:cc.Label,attentionLabel:cc.Label,okBtnLabel:cc.Label,okBtn:n,cancelBtn:n},callback:null,openAlertPopup:function(t,e,i,a){this._setParameter(t,e,i,a),this._setButtonEvents(),this.open()},_setParameter:function(t,e,i,a){this.mainLabel.string=t,this.attentionLabel.string=e,this.okBtnLabel.string=i,this._callback=a},_setButtonEvents:function(){this.okBtn.setTapEvent(this._okBtnEvent.bind(this)),this.cancelBtn.setTapEvent(this._cancelBtnEvent.bind(this),n.SE_NAME.CANCEL)},_okBtnEvent:function(){this._callback(),this.close()},_cancelBtnEvent:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],AllResourceDownloadConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"3aac1dPdLxI/bJjs9pho2hA","AllResourceDownloadConfirmPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonUtils"),s=t("GameConst"),c=t("LocalDataConst"),l=t("MemoryManager"),u=t("DownManifestManager"),h=t("SceneConst"),d=t("SingletonConst"),p=t("PopupUtils"),m=t("FileLoaderConsts");cc.Class({extends:a,properties:{needCapacityGbLabel:cc.Label,needCapacityMbLabel:cc.Label,executeBtn:o,cancelBtn:o},_quality:0,_callbackToExecute:void 0,_callbackToCancel:void 0,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),o.SE_NAME.CANCEL)},openAllResourceDownloadConfirmPopup:function(t,e,i){this._quality=t,this._callbackToExecute=e,this._callbackToCancel=i,this._setCapacityLabel(t),this.open()},_setCapacityLabel:function(t){var e,i=u.instance.getNeedCapacity();switch(t){case s.RESOURCE_QUALITY.HIGH:e=i[1];break;case s.RESOURCE_QUALITY.LOW:e=i[0]}var a=(e/1024).toFixed(2);this.needCapacityGbLabel.string=r.convertToCommaDelimited(a)+"GB",this.needCapacityMbLabel.string="("+r.convertToCommaDelimited(e.toFixed(2))+"MB)"},_onTapExecuteBtn:function(){r.saveLocalStorage(c.LOCAL_STORAGE_KEY.RESOURCE_DL_TYPE,s.RESOURCE_DL_TYPE.ALL),this.setCloseCallBack(function(){this._callbackToExecute?this._callbackToExecute():(n.soundManager.stopAll(),this._checkRamSpace())}.bind(this)),this.close()},_checkRamSpace:function(){var t,e=n[d.ENVIRONMENT],i=jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","getRamSpace","()F"),a=u.instance.getNeedCapacity(),o=0;switch(r.loadLocalStorage(c.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,c.LOCAL_STORAGE_GET_TYPE.INTEGER)){case s.RESOURCE_QUALITY.LOW:o=a[0],t=cc.sys.localStorage.getItem(m.CURRENT_LD_ALL_RES_VERSION);break;case s.RESOURCE_QUALITY.HIGH:o=a[1],t=cc.sys.localStorage.getItem(m.CURRENT_HD_ALL_RES_VERSION)}t!=m.ALL_RES_VERSION.ZIP&&(i>=o?(cc.log("MemoryManager start release AllResDownload..."),n.localData[c.IS_CAPACITY_ZIP_AMPLE]=!1,n.soundManager.stopAll(),l.instance.release(),r.getRoot().clearScene(),r.getRoot().pushScene("ResourceDownloadScene",h.SCENE.FILE_NAME.HOME)):(n.localData[c.IS_CAPACITY_ZIP_AMPLE]=!0,p.openCommonPopupOk("\u78ba\u8a8d","\u5bb9\u91cf\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093","",!1,function(){}))),cc.log("freeBytes = "+i),cc.log("mbValue = "+o)},_onTapCancelBtn:function(){this.close(),r.saveLocalStorage(c.LOCAL_STORAGE_KEY.ALL_RES_POP_TYPE,s.ALL_RES_POP_TYPE.POP),this._callbackToExecute&&this._callbackToCancel()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",FileLoaderConsts:"FileLoaderConsts",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",PopupBase:"PopupBase",PopupUtils:"PopupUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst"}],AnimationEventComponent:[function(t,e,i){"use strict";cc._RF.push(e,"4b708bztHxA8IbAqPw+F13M","AnimationEventComponent");cc.Class({extends:cc.Component,_animationEventInfoMap:null,_initAnimationEventInfoMap:function(){this._animationEventInfoMap||(this._animationEventInfoMap={},_.forEach(this.getComponent(cc.Animation).getClips(),function(t){this._animationEventInfoMap[t.name]=this._createAnimationEventInfo()}.bind(this)))},setAnimationEvent:function(t,e,i){this._initAnimationEventInfoMap(),_.find(this.getComponent(cc.Animation).getClips(),function(e){return e.name===t})&&(this._animationEventInfoMap[t].callbackArray=e,this._animationEventInfoMap[t].paramsArray=i,this._setClipEvent(t,this._animationEventInfoMap[t].paramsArray))},addAnimationEvent:function(t,e,i,a){if(this._initAnimationEventInfoMap(),_.find(this.getComponent(cc.Animation).getClips(),function(e){return e.name===t})){this._animationEventInfoMap[t].durationArray=e,this._animationEventInfoMap[t].callbackArray=i,this._animationEventInfoMap[t].paramsArray=a;for(var n=0;n<this._animationEventInfoMap[t].durationArray.length;n+=1)this._pushClipEvent(t,this._animationEventInfoMap[t].durationArray[n],this._animationEventInfoMap[t].paramsArray[n])}},_animationEvent:function(){var t=_.find(this.getComponent(cc.Animation).getClips(),function(t){return this.getComponent(cc.Animation).getAnimationState(t.name).isPlaying}.bind(this));t&&(this._animationEventInfoMap[t.name].callbackArray[this._animationEventInfoMap[t.name].eventCounter](),this._animationEventInfoMap[t.name].eventCounter+=1,this._animationEventInfoMap[t.name].eventCounter>t.events.length&&(this._animationEventInfoMap[t.name].eventCounter=0))},getDurationByClipName:function(t){var e=_.find(this.getComponent(cc.Animation).getClips(),function(e){return e.name===t});return e?e.duration:0},_createAnimationEventInfo:function(){return{eventCounter:0,durationArray:[],callbackArray:[],paramsArray:[]}},_createClipEvent:function(t,e){return{frame:t,func:"_animationEvent",params:e}},_setClipEvent:function(t,e){for(var i=0;i<this.getComponent(cc.Animation).getClips().length;i+=1)if(this.getComponent(cc.Animation).getClips()[i].name===t){for(var a=0;a<this.getComponent(cc.Animation).getClips()[i].events.length;a+=1)this.getComponent(cc.Animation).getClips()[i].events[a].func="_animationEvent",this.getComponent(cc.Animation).getClips()[i].events[a].params=e[a];break}},_pushClipEvent:function(t,e,i){for(var a=0;a<this.getComponent(cc.Animation).getClips().length;a+=1)if(this.getComponent(cc.Animation).getClips()[a].name===t){this.getComponent(cc.Animation).getClips()[a].events.push(this._createClipEvent(e,i));break}}});cc._RF.pop()},{}],AnimationUtils:[function(t,e,i){"use strict";cc._RF.push(e,"c71f0YWxrtPKr1fqOQqXg2S","AnimationUtils");var a=t("ResourceUtils"),n=t("StaticResourceConst"),o=t("GameConst");function r(t,e,i,r){var s,u,h,d=cc.instantiate(a.getResource(n.GRADATION_PREFAB_PATH)),p=d.getContentSize().height;switch(e){case o.DIRECTION_TYPE.UP:s=180,u=cc.v2(0,-360),h=cc.v2(0,360+p);break;case o.DIRECTION_TYPE.DOWN:s=0,u=cc.v2(0,360),h=cc.v2(0,-360-p);break;case o.DIRECTION_TYPE.LEFT:s=90,u=cc.v2(-640,0),h=cc.v2(640+p,0);break;case o.DIRECTION_TYPE.RIGHT:s=270,u=cc.v2(640,0),h=cc.v2(-640-p,0)}var m=d.getPosition().x-h.x,_=d.getPosition().y-h.y;c(cc.v2(m,_),i,function(t){if(d.isValid){var e=d.getPosition().x-h.x,i=d.getPosition().y-h.y;t.setPosition(cc.v2(e,i))}}),l(d,t,0,u,h,s,i,r)}function s(t,e,i,r){var s,u,h,d=cc.instantiate(a.getResource(n.GRADATION_PREFAB_PATH)),p=d.getContentSize().height;switch(e){case o.DIRECTION_TYPE.UP:s=0,u=cc.v2(0,-360),h=cc.v2(0,360+p);break;case o.DIRECTION_TYPE.DOWN:s=180,u=cc.v2(0,360),h=cc.v2(0,-360-p);break;case o.DIRECTION_TYPE.LEFT:s=270,u=cc.v2(-640,0),h=cc.v2(640+p,0);break;case o.DIRECTION_TYPE.RIGHT:s=90,u=cc.v2(640,0),h=cc.v2(-640-p,0)}c(cc.v2(0,0),i,function(t){if(d.isValid){var e=d.getPosition().x-u.x,i=d.getPosition().y-u.y;t.setPosition(cc.v2(e,i))}else t.destroy()}),l(d,t,1,u,h,s,i,r)}function c(t,e,i){var r=cc.director.getScene().getChildByName("Canvas").getChildByName("SimpleColorNode");r&&(r.getComponent(cc.Component).unscheduleAllCallbacks(),r.destroy());var s=new cc.Node("SimpleColorNode"),c=s.addComponent(cc.Sprite);a.addSprite(c,n.SIMPLE_TEX_PATH,function(){s.setContentSize(cc.winSize)}),s.setPosition(t),s.color=e,s.getComponent(cc.Component).schedule(function(){i(s)},0),cc.director.getScene().getChildByName("Canvas").addChild(s,o.Z_ORDER.LOADING)}function l(t,e,i,a,n,r,s,c){t.active=!0,t.anchorY=i,t.setPosition(a),t.angle=r,t.color=s,t.runAction(cc.sequence(cc.moveTo(e,n),cc.callFunc(function(){t.destroy(),c&&c()},this))),cc.director.getScene().getChildByName("Canvas").addChild(t,o.Z_ORDER.LOADING)}function u(t,e){var i=new cc.Node(t.name+"_parent");return i.setContentSize(t.getContentSize()),i.addChild(t),h(t,e),i}function h(t,e){t.stopAllActions(),t.setPosition(cc.v2(0,-30));var i=cc.sequence(cc.delayTime(.015*e),cc.moveTo(.4,cc.v2(0,0)).easing(cc.easeOut(3)));t.runAction(i),t.opacity=0;var a=cc.sequence(cc.delayTime(.015*e),cc.fadeIn(.4));t.runAction(a)}e.exports={startSlideAnimation:function(t,e,i,a){switch(e){case o.DIRECTION_TYPE.NONE:return void(a&&a())}cc.director.getScene().getChildByName("Canvas").getChildByName("SimpleColorNode")||r(t*=.5,e,i,function(){a&&a(),s(t,e,i)})},startSlideInAnimation:r,startSlideOutAnimation:s,createSpawnAnimationNode:u,recreateSpawnAnimationNode:function(t,e){if(_.endsWith(t.name,"_parent")){var i=_.replace(t.name,"_parent",""),a=t.children.find(function(t){return _.startsWith(t.name,i)});return a&&h(a,e),t}return u(t,e)},playResultRibbonAnimation:function(t,e){cc.instantiate(a.getResource(n.RESULT_RIBBON_PREFAB_PATH)).getComponent("ResultRibbonPopup").openResultRibbonPopup(t,e)}},cc._RF.pop()},{GameConst:"GameConst",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],ApRecoveryPopup:[function(t,e,i){"use strict";cc._RF.push(e,"b72e1QRcb9AJb09I/A0BFOM","ApRecoveryPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonCountView"),s=t("GameConst"),c=t("PopupUtils"),l=t("ResourceUtils"),u=t("StaticResourceConst"),h=t("ItemUtils"),d=t("ItemConst");cc.Class({extends:a,properties:{apHalfThumbnailParentNode:cc.Node,beforeApHalfCountLabel:cc.Label,afterApHalfCountLabel:cc.Label,apHalfCounter:r,apHalfDecisionBtn:o,apThumbnailParentNode:cc.Node,beforeApCountLabel:cc.Label,afterApCountLabel:cc.Label,apCounter:r,apDecisionBtn:o,gemThumbnailParentNode:cc.Node,gemCostLabel:cc.Label,beforeGemCountLabel:cc.Label,afterGemCountLabel:cc.Label,gemCounter:r,gemDecisionBtn:o,beforeUserApLabel:cc.Label,afterUserApLabel:cc.Label,cancelBtn:o,shopBtn:o},_callbackToDecision:null,_userApBaseNum:null,_userApCurrentNum:null,_apHalfItemMaster:null,_apHalfMaxBaseCount:null,_apHalfCount:null,_apItemMaster:null,_apMaxBaseCount:null,_apCount:null,_apGemItemMaster:null,_gemMaxBaseCount:null,onLoad:function(){this.apHalfDecisionBtn.setTapEvent(this._onTapHalfDecision.bind(this),o.SE_NAME.SELECT),this.apDecisionBtn.setTapEvent(this._onTapFullDecision.bind(this),o.SE_NAME.SELECT),this.gemDecisionBtn.setTapEvent(this._onTapGemDecision.bind(this),o.SE_NAME.SELECT),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),o.SE_NAME.CANCEL),this.shopBtn.setTapEvent(this._onTapShopBtn.bind(this))},openApRecoveryPopup:function(t){this._setParameter(),this._setCallbackToDecision(t),this.open()},_setParameter:function(){var t=n.dao[n.USER];this._userApBaseNum=t.getMaxStamina(),this._userApCurrentNum=t.getCurrentStaminaInfo().currentStamina,this.beforeUserApLabel.string=t.getCurrentStaminaInfo().currentStamina,this.afterUserApLabel.string=t.getCurrentStaminaInfo().currentStamina,this._initHalfItemUI(),this._initFullItemUI(),this._initGemUI(),this.shopBtn.switchBtnImage(!0)},_initHalfItemUI:function(){this._apHalfItemMaster=h.getItemMaster(d.AP_CONSUME_ITEM_HALF),this._apHalfMaxBaseCount=h.getUserItemCount(d.AP_CONSUME_ITEM_HALF),this._setThumbnailParam(d.AP_CONSUME_ITEM_HALF,this._apHalfMaxBaseCount,this.apHalfThumbnailParentNode,this.beforeApHalfCountLabel,this.afterApHalfCountLabel);var t=this._apHalfItemMaster.getEffectValue()/100,e=(s.MAX_USER_AP-this._userApCurrentNum)/(this._userApBaseNum*t);this.apHalfCounter.initCommonCountView(this._onChangeCountByHalf.bind(this),0,Math.floor(Math.max(Math.min(e,this._apHalfMaxBaseCount),0)),0),this.apHalfDecisionBtn.switchBtnImage(!1)},_initFullItemUI:function(){this._apItemMaster=h.getItemMaster(d.AP_CONSUME_ITEM),this._apMaxBaseCount=h.getUserItemCount(d.AP_CONSUME_ITEM),this._setThumbnailParam(d.AP_CONSUME_ITEM,this._apMaxBaseCount,this.apThumbnailParentNode,this.beforeApCountLabel,this.afterApCountLabel);var t=this._apItemMaster.getEffectValue()/100,e=(s.MAX_USER_AP-this._userApCurrentNum)/(this._userApBaseNum*t);this.apCounter.initCommonCountView(this._onChangeCountByFull.bind(this),0,Math.floor(Math.max(Math.min(e,this._apMaxBaseCount),0)),0),this.apDecisionBtn.switchBtnImage(!1)},_initGemUI:function(){this._apGemItemMaster=n.dao.ItemApRecoveryGemMasters[0],this._gemMaxBaseCount=n.dao[n.USER].getGem(),this._setThumbnailParam(d.GEM_ITEM_ID.FREE,this._gemMaxBaseCount,this.gemThumbnailParentNode,this.beforeGemCountLabel,this.afterGemCountLabel),this.gemCostLabel.string=this._apGemItemMaster.getCostCount();var t=this._apGemItemMaster.getEffectValue()/100,e=(s.MAX_USER_AP-this._userApCurrentNum)/(this._userApBaseNum*t);this.gemCounter.initCommonCountView(this._onChangeCountByGem.bind(this),0,Math.floor(Math.max(Math.min(this._gemMaxBaseCount/this._apGemItemMaster.getCostCount(),e),0)),0),this.gemDecisionBtn.switchBtnImage(!1)},_onChangeCountByHalf:function(t){this.afterApHalfCountLabel.string=""+Math.floor(Math.max(Math.min(this._apHalfMaxBaseCount-t,this._apHalfMaxBaseCount),0)),this.afterUserApLabel.string=""+Math.floor(this._userApCurrentNum+this._calcRecoveryValue(this._userApBaseNum,t,this._apHalfItemMaster.getEffectValue()/100)),this._drawHalfUI(t)},_onChangeCountByFull:function(t){this.afterApCountLabel.string=""+Math.floor(Math.max(Math.min(this._apMaxBaseCount-t,this._apMaxBaseCount),0)),this.afterUserApLabel.string=""+Math.floor(this._userApCurrentNum+this._calcRecoveryValue(this._userApBaseNum,t,this._apItemMaster.getEffectValue()/100)),this._drawFullUI(t)},_onChangeCountByGem:function(t){this.afterGemCountLabel.string=""+Math.floor(Math.max(Math.min(this._gemMaxBaseCount-t*this._apGemItemMaster.getCostCount(),this._gemMaxBaseCount),0)),this.afterUserApLabel.string=""+Math.floor(this._userApCurrentNum+this._calcRecoveryValue(this._userApBaseNum,t,this._apGemItemMaster.getEffectValue()/100)),this._drawGemUI(t)},_drawHalfUI:function(t){t>0?(this.apHalfDecisionBtn.switchBtnImage(!0),this._drawFullUI(0),this._drawGemUI(0)):(this.apHalfCounter.setCountNum(0),this.apHalfCounter.redrawSimply(),this.apHalfDecisionBtn.switchBtnImage(!1),this.afterApHalfCountLabel.string=this._apHalfMaxBaseCount)},_drawFullUI:function(t){t>0?(this.apDecisionBtn.switchBtnImage(!0),this._drawHalfUI(0),this._drawGemUI(0)):(this.apCounter.setCountNum(0),this.apCounter.redrawSimply(),this.apDecisionBtn.switchBtnImage(!1),this.afterApCountLabel.string=this._apMaxBaseCount)},_drawGemUI:function(t){t>0?(this.gemDecisionBtn.switchBtnImage(!0),this._drawHalfUI(0),this._drawFullUI(0)):(this.gemCounter.setCountNum(0),this.gemCounter.redrawSimply(),this.gemDecisionBtn.switchBtnImage(!1),this.afterGemCountLabel.string=this._gemMaxBaseCount)},_onTapHalfDecision:function(){this._executeRecover(d.AP_CONSUME_ITEM_HALF,this.apHalfCounter.getCountNum())},_onTapFullDecision:function(){this._executeRecover(d.AP_CONSUME_ITEM,this.apCounter.getCountNum())},_onTapGemDecision:function(){this._executeRecover(d.GEM_ITEM_ID.FREE,this.gemCounter.getCountNum())},_executeRecover:function(t,e){if(e<=0)return c.openSimpleMessageWindow("\u500b\u6570\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");this._callbackToDecision&&this._callbackToDecision(t,e,this.close.bind(this))},_setThumbnailParam:function(t,e,i,a,n){var o=cc.instantiate(l.getResource(u.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");o.setMainImage(l.getFileNameItemThumbnail(t)),i.addChild(o.node);var r=e;a.string=r,n.string=r||0},_calcRecoveryValue:function(t,e,i){return Math.ceil(t*e*i)},_setCallbackToDecision:function(t){this._callbackToDecision=t},_onTapCancelBtn:function(){this.close()},_onTapShopBtn:function(){cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase").transitionShopSceneByApRecoveryPopup(),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],ApiConstants:[function(t,e,i){"use strict";cc._RF.push(e,"25fdfcvSHVGkIAbpnrhQLDk","ApiConstants"),e.exports={DMM_REQUEST_TOKEN:"getDmmWebRequestToken",DEV_REQUEST_TOKEN:"getDevRequestToken",DMM_ACCESS_TOKEN:"getDmmAccessToken",PHONE_ACCESS_TOKEN:"getPhoneAccessToken",DEV_ACCESS_TOKEN:"getDevAccessToken",TEST_ACCESS_TOKEN:"getLoadTestAccessToken",LOGIN:"login",INITIAL_USER_DATA:"initialUserData",GET_USER_DATA:"getUserData",USER_GET_MASTER_DATA:"getMasterUserData",QUEST_GET_MASTER_DATA:"getMasterQuestData",ITEM_GET_MASTER_DATA:"getMasterItemData",SHOP_GET_MASTER_DATA:"getMasterShopData",CAMPAIGN_GET_MASTER_DATA:"getMasterCampaignData",CHARACTER_GET_MASTER_DATA:"getMasterCharacterData",CHARACTER_TEXT_GET_MASTER_DATA:"getMasterCharacterTextData",CHARACTER_TEXT_GET_MASTER_DATA2:"getMasterCharacterTextData2",CHARACTER_TEXT_GET_MASTER_DATA3:"getMasterCharacterTextData3",CHARACTER_SKILL_GET_MASTER_DATA:"getMasterCharacterSkillData",CHARACTER_SKILL_EFFECT_GET_MASTER_DATA:"getMasterCharacterSkillEffectData",CHARACTER_SKILL_EFFECT_GET_MASTER_DATA2:"getMasterCharacterSkillEffectData2",CHARACTER_ABILITY_GET_MASTER_DATA:"getMasterCharacterAbilityData",CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA:"getMasterCharacterAbilityEffectData",CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA2:"getMasterCharacterAbilityEffectData2",CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA3:"getMasterCharacterAbilityEffectData3",EQUIPMENT_GET_MASTER_DATA:"getMasterEquipmentData",PRESENT_GET_MASTER_DATA:"getMasterPresentData",EVENT_GET_MASTER_DATA:"getMasterEventData",EVENT_GET_USER_DATA:"getUserEventData",EVENT_QUEST_START_BATTLE:"eventQuestStartBattle",EVENT_QUEST_END_BATTLE:"eventQuestEndBattle",RAID_GET_MASTER_DATA:"getMasterRaidData",RAID_GET_LIST:"raidGetList",RAID_GET_DETAIL:"raidGetDetail",RAID_SEND_RESCUE:"raidSendRescue",RAID_APPEAR_BATTLE:"raidAppearBattle",RAID_START_BATTLE:"raidStartBattle",RAID_END_BATTLE:"raidEndBattle",RAID_RECEIVE_RESULT:"raidReceiveResult",LOGIN_BONUS_GET_MASTER_DATA:"getMasterLoginBonusData",LOGIN_PACK_GET_MASTER_DATA:"getMasterLoginPackData",CHARACTER_CHANGE_PROTECT:"characterChangeProtect",CHARACTER_CHANGE_PARTNER:"characterChangePartner",EQUIPMENT_SELL:"equipmentSell",EQUIPMENT_SELL_WAREHOUSE:"equipmentSellWarehouse",EQUIPMENT_FORTIFY:"equipmentFortify",EQUIPMENT_FORTIFY_WAREHOUSE:"equipmentFortifyWarehouse",EQUIPMENT_EXCEED_LIMIT:"equipmentExceedLimit",EQUIPMENT_EXCEED_LIMIT_WAREHOUSE:"equipmentExceedLimitWarehouse",EQUIPMENT_CREATE:"equipmentCreate",EQUIPMENT_CHANGE_PROTECT:"equipmentChangeProtect",QUEST_START_BATTLE:"questStartBattle",QUEST_END_BATTLE:"questEndBattle",QUEST_SKIP_BATTLE:"skipBattle",QUEST_UNLOCK:"unlockQuest",QUEST_STAGE_DATA:"getStageData",QUEST_START_BATTLE_TRANSACTION:"startBattleTransaction",QUEST_SAVE_BATTLE_TRANSACTION:"saveBattleTransaction",QUEST_CLEAR_BATTLE_TRANSACTION:"clearBattleTransaction",SHOP_PURCHASE:"purchase",SHOP_EXCHANGE:"exchange",MISSION_RECEIVE:"missionReceive",USER_GET_CLIENT_VERSION:"userGetClientVersion",USER_UPDATE_USERNAME:"userUpdateUserName",USER_UPDATE_SETTING:"userUpdateSetting",USER_RECOVERY_STAMINA:"userrecoveryStamina",USER_RECOVERY_BATTLE_POINT:"userRecoveryBattlePoint",USER_UPDATE_USER_TEXT:"updateUserText",USER_UPDATE_PLAYER_TYPE:"updateplayertype",PRESENT_LIST:"presentList",PRESENT_HISTORY_LIST:"presentHistoryList",PRESENT_RECEIVE:"presentReceive",CHARACTER_FORTIFY:"characterFortify",CHARACTER_FORTIFY_WAREHOUSE:"characterFortifyWarehouse",CHARACTER_FORTIFY_SKILL:"characterFortifySkill",CHARACTER_FORTIFY_SKILL_WAREHOUSE:"characterFortifySkillWarehouse",CHARACTER_FORTIFY_ABILITY:"characterFortifyAbility",CHARACTER_SELL:"characterSell",CHARACTER_SELL_WAREHOUSE:"characterSellWarehouse",CHARACTER_EQUIP:"characterEquip",CHARACTER_EQUIP_REMOVE_ALL:"characterEquipRemoveAll",CHARACTER_EXCEED_LIMIT:"characterExceedLimit",CHARACTER_EXCEED_LIMIT_WAREHOUSE:"characterExceedLimitWarehouse",CHARACTER_EXCEED_LIMIT_ITEM:"characterExceedLimitByItem",ROOM_GET_MASTER_DATA:"getMasterRoomData",ROOM_GET_USER_DATA:"getUserRoomData",ROOM_SET_FURNITURE:"setFurniture",ROOM_SET_CHARACTER:"setCharacter",ROOM_BUY_CHARACTER_FRAME:"buyCharacterFrame",ROOM_BUY_FURNITURE:"buyFurniture",ROOM_SAVE_LAYOUT:"saveLayout",ROOM_LOAD_LAYOUT:"loadLayout",ROOM_CLEAR_LAYOUT:"clearLayout",ROOM_UPDATE_LAYOUT_NAME:"updateLayoutName",ROOM_COLLECT:"collect",ROOM_SAVE_SELECT_CHARACTER:"saveSelectCharacter",PVP_GET_MASTER_DATA:"getMasterPvPData",PVP_GET_USER_DATA:"getUserPvPData",PICTURE_BOOK_GET_USER_DATA:"getUserPictureBookData",SHOP_GET_USER_DATA:"getUserShopData",PVP_GET_BATTLE_PLAYERS:"getBattlePlayers",PVP_UPDATE_BATTLE_PLAYERS:"updateBattlePlayers",PVP_START_BATTLE:"startBattle",PVP_END_BATTLE:"endBattle",TOWER_GET_MATER_DATA:"getMasterTowerData",TOWER_GET_USER_DATA:"getUserTowerData",TOWER_SELECT_AREA:"selectTowerArea",TOWER_GET_AREA_DATA:"getTowerAreaData",TOWER_RETIRE:"retireTower",TOWER_START_BATTLE:"startTowerBattle",TOWER_END_BATTLE:"endTowerBattle",TOWER_SAVE_BATTLE_TRANSACTION:"saveTowerBattleTransaction",TOWER_CLEAR_BATTLE_TRANSACTION:"clearTowerBattleTransaction",PICTURE_BOOK_GIFT:"gift",GACHA_GET_LIST:"getlist",GACHA_GET_DETAIL:"getDetail",GACHA_PLAY:"play",GACHA_REPLAY:"replay",GACHA_DECIDE:"decide",GACHA_LOAD_SESSION:"loadSession",BOX_GACHA_DETAIL:"getBoxDetail",BOX_GACHA_PLAY:"playBox",BOX_GACHA_RESET:"resetBox",STORY_ADD_STORY:"addStory",STORY_READ_STORY:"readStory",STORY_GET_RESOURCE:"getResource",ITEM_SELL:"sell",ITEM_USE:"use",ITEM_USE_RECOVERY_ITEM:"useRecoveryItem",PAYMENT_DMM_GET_MASTER_DATA:"payment/getMasterData",PAYMENT_RESULT:"getPaymentResult",BEGIN_ANDROID_PAYMENT:"beginAndroidPayment",CREATE_ANDROID_PAYMENT:"createAndroidPayment",WAREHOUSE_MATERIAL_COUNT:"getMaterialCount",WAREHOUSE_MATERIAL_LIST:"getMaterialList",WAREHOUSE_CHARACTER_COUNT:"getCharacterCount",WAREHOUSE_CHARACTER_LIST:"getCharacterList",WAREHOUSE_EQUIPMENT_COUNT:"getEquipmentCount",WAREHOUSE_EQUIPMENT_LIST:"getEquipmentList",WAREHOUSE_TAKE:"takeWarehouse",MINIGAME_PLAY:"playMinigame",MINIGAME_GET_LIST:"getMinigameList",MINIGAME_GET_USER_DATA:"getUserMinigameData",UPDATE_DECKS:"updateDecks",UPDATE_DECKS_ALL:"updateDecksAll",UPDATE_DECK_WITH_EQUIP:"updateDeckWithEquip",GET_LOGIN_BONUSES:"getLoginBonuses",GET_LOGIN_PACKS:"getLoginPacks",DMM_PAYMENT:"requestDmmPayment",CHARACTER_GET_USER_DATA:"getUserCharacterData",DECK_GET_USER_DATA:"getUserDeckData",EQUIPMENT_GET_USER_DATA:"getUserEquipmentData",QUEST_GET_USER_DATA:"getUserQuestData",MISSION_GET_USER_DATA:"getUserMissionData",STORY_GET_USER_DATA:"getUserStoryData",ITEM_GET_USER_DATA:"getUserItemData",MISSION_GET_MASTER_DATA:"getMasterMissionData",STORY_GET_MASTER_DATA:"getMasterStoryData",MY_PAGE_REFRESH:"refresh",TUTORIAL_GET_MASTER_DATA:"getMasterTutorialData",TUTORIAL_UPDATE_STEP:"updateTutorialStep",MINIGAME_GET_MASTER_DATA:"getMasterMinigameData",QUESTIONNAIRE_GET_LIST:"getQuestionnaireList",QUESTIONNAIRE_ANSWER:"answer"},cc._RF.pop()},{}],ApplicationServiceManager:[function(t,e,i){"use strict";cc._RF.push(e,"17a1dITDaRGOb9dGjEPMj1N","ApplicationServiceManager");var a=t("ServiceManager"),n=t("Singleton"),o=t("MasterDataConstants"),r=t("UserDataConstants"),s=t("CharacterService"),c=t("EquipmentService"),l=t("QuestService"),u=t("MissionService"),h=t("UserService"),d=t("PresentService"),p=t("DeckService"),m=t("RoomService"),_=t("PvPService"),g=t("TowerService"),C=t("PictureBookService"),f=t("ShopService"),E=t("GachaService"),T=t("StoryService"),S=t("ItemService"),R=t("MyPageService"),A=t("EventService"),b=t("RaidService"),M=t("LoginBonusService"),v=t("LoginPackService"),P=t("TutorialService"),I=t("PaymentService"),y=t("WarehouseService"),N=t("MinigameService"),B=t("QuestionnaireService"),L={};Object.keys(o.DATA_MODEL).map(function(t){return o.DATA_MODEL[t]}).forEach(function(e){L[e]=t(e)}),Object.keys(r.DATA_MODEL).map(function(t){return r.DATA_MODEL[t]}).forEach(function(e){L[e]=t(e)}),cc.Class({extends:a,_initializeServices:function(){this._super(),n.CharacterService=new s,n.DeckService=new p,n.EquipmentService=new c,n.QuestService=new l,n.UserService=new h,n.RoomService=new m,n.PresentService=new d,n.PvPService=new _,n.TowerService=new g,n.GachaService=new E,n.PictureBookService=new C,n.StoryService=new T,n.ItemService=new S,n.MissionService=new u,n.ShopService=new f,n.MyPageService=new R,n.EventService=new A,n.RaidService=new b,n.LoginBonusService=new M,n.LoginPackService=new v,n.TutorialService=new P,n.PaymentService=new I,n.WarehouseService=new y,n.MinigameService=new N,n.QuestionnaireService=new B},_initializeDao:function(){this._super(),this._models=L}}),cc._RF.pop()},{CharacterService:"CharacterService",DeckService:"DeckService",EquipmentService:"EquipmentService",EventService:"EventService",GachaService:"GachaService",ItemService:"ItemService",LoginBonusService:"LoginBonusService",LoginPackService:"LoginPackService",MasterDataConstants:"MasterDataConstants",MinigameService:"MinigameService",MissionService:"MissionService",MyPageService:"MyPageService",PaymentService:"PaymentService",PictureBookService:"PictureBookService",PresentService:"PresentService",PvPService:"PvPService",QuestService:"QuestService",QuestionnaireService:"QuestionnaireService",RaidService:"RaidService",RoomService:"RoomService",ServiceManager:"ServiceManager",ShopService:"ShopService",Singleton:"Singleton",StoryService:"StoryService",TowerService:"TowerService",TutorialService:"TutorialService",UserDataConstants:"UserDataConstants",UserService:"UserService",WarehouseService:"WarehouseService"}],AreaThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"5fcd19/ElNL37rQnxGNX8mA","AreaThumbnailView");var a=t("QuestUtils"),n=(t("ResourceConst"),t("ResourceUtils")),o=t("CommonButton"),r=t("GameConst");cc.Class({extends:cc.Component,properties:{areaNameLabel:cc.Label,consumeApNode:cc.Node,consumeApLabel:cc.Label,coinDropNode:cc.Node,coinDropLabel:cc.Label,expDropNode:cc.Node,expDropLabel:cc.Label,newSprite:cc.Sprite,completeSprite:cc.Sprite,areaSprite:cc.Sprite,stageBtn:o},_areaId:0,_areaMst:null,_root:null,initAreaThumbnailView:function(t,e,i){this._root=t,this._areaId=e,this._areaMst=i;var o=a.getAreaProgress(this._areaId);this.newSprite.node.active=o.newFlg,this.completeSprite.node.active=o.completeFlg,this._initCampaign(),this.areaNameLabel.string=this._areaMst.getName(),n.addSprite(this.areaSprite,n.getFileNameAreaThumbnail(e)),this.stageBtn.setTapEvent(this.setStageVisible.bind(this))},getAreaId:function(){return this._areaId},setStageVisible:function(){this._root.pushStageScrollView(this._areaId,this._root.selectDifficult)},_initCampaign:function(){this.consumeApNode.active=!1,this.coinDropNode.active=!1,this.expDropNode.active=!1;var t=a.getCampaignCategoryObjectByAreaId(this.getAreaId()),e=0,i=0;t.ap&&(this.consumeApNode.active=!0,this.consumeApLabel.string=r.CAMPAIGN.AP.LABEL+t.ap),t.charaExp&&(this.expDropNode.active=!0,this.expDropNode.string=r.CAMPAIGN.CAHRA_EXP.LABEL+t.charaExp,i+=1),t.drop&&(this.coinDropNode.active=!0,this.coinDropLabel.string=r.CAMPAIGN.DROP.LABEL+t.drop,e+=1),t.userExp&&(this.expDropNode.active=!0,this.expDropNode.string=r.CAMPAIGN.USER_EXP.LABEL+t.userExp,i+=1),t.gold&&(this.coinDropNode.active=!0,this.coinDropLabel.string=r.CAMPAIGN.GOLD.LABEL+t.gold,e+=1),t.unlock&&(this._unlockCount=t.unlock),(e>1||i>1)&&cc.error("\u30ad\u30e3\u30f3\u30da\u30fc\u30f3\u9805\u76ee\u304c\u91cd\u8907\u3057\u3066\u3044\u307e\u3059")}}),cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",QuestUtils:"QuestUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils"}],AreaWeekThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"a2cefxB9aNBSbZQpsVivQnm","AreaWeekThumbnailView");var a=t("QuestUtils"),n=(t("ResourceConst"),t("ResourceUtils")),o=t("CommonButton"),r=t("PopupUtils"),s=t("TimeUtils"),c=t("ItemUtils"),l=t("GameConst"),u=t("Singleton"),h={DATE:{REPLACE_AREA_DATE_LABEL:"{date}",DATE_UP_TO_START_LABEL_DAY:"\u958b\u653e\u307e\u3067\u3042\u3068{date}\u65e5",DATE_UP_TO_START_LABEL_HOUR:"\u958b\u653e\u307e\u3067\u3042\u3068{date}\u6642\u9593",DATE_UP_TO_START_LABEL_MINUTE:"\u958b\u653e\u307e\u3067\u3042\u3068{date}\u5206",DATE_UP_TO_END_LABEL_DAY:"\u7d42\u4e86\u307e\u3067\u3042\u3068{date}\u65e5",DATE_UP_TO_END_LABEL_HOUR:"\u7d42\u4e86\u307e\u3067\u3042\u3068{date}\u6642\u9593",DATE_UP_TO_END_LABEL_MINUTE:"\u7d42\u4e86\u307e\u3067\u3042\u3068{date}\u5206"}};cc.Class({extends:cc.Component,properties:{areaNameLabel:cc.Label,coinDropNode:cc.Node,coinDropLabel:cc.Label,expDropNode:cc.Node,expDropLabel:cc.Label,apFreeNode:cc.Node,toStartNode:cc.Node,toStartLabel:cc.Label,toEndNode:cc.Node,toEndLabel:cc.Label,toEndMinuteNode:cc.Node,toEndMinuteLabel:cc.Label,remainingNode:cc.Node,remainingLabel:cc.Label,clearSprite:cc.Sprite,newSprite:cc.Sprite,completeSprite:cc.Sprite,areaSprite:cc.Sprite,stageBtn:o,grayOutNode:cc.Node,freeUnlockNode:cc.Node,freeUnlockBtn:o,normalUnlockNode:cc.Node,normalUnlockBtn:o,weekLabel:cc.Label},_areaId:0,_areaMaster:null,_unlockCount:0,_root:null,_unlockItemMaster:null,_callbackToContentRedraw:null,_expCampaignTextArray:null,_campaignTextArray:null,_expCampaignTextIndex:0,_campaignTextIndex:0,initAreaWeekThumbnailView:function(t,e,i,o){this._root=t,this._areaId=e,this._areaMaster=i,this._unlockCount=1,this._callbackToContentRedraw=o,this._campaignTextArray=[],this._expCampaignTextArray=[],this._campaignTextIndex=0,this._expCampaignTextIndex=0;var r=a.getAreaProgress(this._areaId);this.newSprite.node.active=r.newFlg,this.clearSprite.node.active=r.clearFlg,this.completeSprite.node.active=r.completeFlg,this.areaNameLabel.string=i.getName(),n.addSprite(this.areaSprite,n.getFileNameAreaThumbnail(i.getAreaId())),this.weekLabel.string=this.convertWeek(i.getWeekTypes())+"\u958b\u653e",this._initCampaign(),this.redraw()},convertWeek:function(t){for(var e=t.split(","),i="",n=0;n<e.length;n+=1)i+=a.convertWeekIntToString(parseInt(e[n])),n<e.length-1&&(i+="\u3001");return i+="\u66dc\u65e5"},_initCampaign:function(){this.coinDropNode.active=!1,this.expDropNode.active=!1;var t=a.getCampaignCategoryObjectByAreaId(this.getAreaId());t.charaExp&&this._expCampaignTextArray.push(l.CAMPAIGN.CAHRA_EXP.LABEL+t.charaExp),t.userExp&&this._expCampaignTextArray.push(l.CAMPAIGN.USER_EXP.LABEL+t.userExp),t.ap&&this._campaignTextArray.push(l.CAMPAIGN.AP.LABEL+t.ap),t.drop&&this._campaignTextArray.push(l.CAMPAIGN.DROP.LABEL+t.drop),t.gold&&this._campaignTextArray.push(l.CAMPAIGN.GOLD.LABEL+t.gold),t.limitCount&&this._campaignTextArray.push(l.CAMPAIGN.LIMIT_COUNT.LABEL+t.limitCount),t.unlock&&(this._unlockCount=t.unlock),this._initCampaignLabel(this.expDropNode,this.expDropLabel,this._expCampaignTextArray,this._getExpCampaignTextIndex.bind(this),this._incExpCampaignTextIndex.bind(this)),this._initCampaignLabel(this.coinDropNode,this.coinDropLabel,this._campaignTextArray,this._getCampaignTextIndex.bind(this),this._incCampaignTextIndex.bind(this))},_initCampaignLabel:function(t,e,i,a,n){i.length<=0?t.active=!1:(t.active=!0,e.string=i[a()],1!==i.length&&(e.node.stopAllActions(),e.node.opacity=255,e.node.runAction(cc.repeatForever(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){n(),e.string=i[a()]},this),cc.delayTime(.1),cc.fadeIn(.5),cc.delayTime(3))))))},_getExpCampaignTextIndex:function(){return this._expCampaignTextIndex},_getCampaignTextIndex:function(){return this._campaignTextIndex},_incExpCampaignTextIndex:function(){Array.isArray(this._expCampaignTextArray)&&(this._expCampaignTextArray.length<=0||(this._expCampaignTextIndex=Math.floor((this._expCampaignTextIndex+1)%this._expCampaignTextArray.length)))},_incCampaignTextIndex:function(){Array.isArray(this._campaignTextArray)&&(this._campaignTextArray.length<=0||(this._campaignTextIndex=Math.floor((this._campaignTextIndex+1)%this._campaignTextArray.length)))},redraw:function(){this.freeUnlockNode.active=!1,this.normalUnlockNode.active=!1,this.apFreeNode.active=!1,this.toStartNode.active=!1,this.toEndNode.active=!1,this.toEndMinuteNode.active=!1,this.remainingNode.active=!1;var t="",e=a.getTodayUnlockUserBoostByQuestId(l.QUEST_TYPE.AREA,this._areaId,[l.BOOST_TYPE.QUEST_UNLOCK,l.BOOST_TYPE.QUEST_LIMITED_UNLOCK]),i=a.getItemQuestLockMasterByQuestId(this._areaId),n=this._getLockState(this._areaId,e);switch(n){case l.LOCK_STATE.BOOST_UNLOCK:case l.LOCK_STATE.WEEK_UNLOCK:if(this.weekLabel.node.active=!1,this.stageBtn.setTapEvent(this.setStageVisible.bind(this)),this.newSprite.node.parent.active=!0,this.grayOutNode.active=!1,!this._areaMaster.getWeekTypes())return void(this.apFreeNode.active=!0);"\u5206"===(t=n===l.LOCK_STATE.BOOST_UNLOCK?this._getUnlockRemainingDateLabel(e.nowUnlockUserBoost):this._getWeekRemainingDateLabel(s.getNowWeek())).slice(-1)?(this.toEndMinuteNode.active=!0,this.toEndMinuteLabel.string=t):(this.toEndNode.active=!0,this.toEndLabel.string=t);break;case l.LOCK_STATE.LOCK:case l.LOCK_STATE.FREE_LOCK:this.weekLabel.node.active=!0,this.newSprite.node.parent.active=!1,this.grayOutNode.active=!0,this.toStartNode.active=!0,this.toStartLabel.string=this._getWeekRemainingDateLabel(a.getNextWeekTypeByAreaId(this._areaId)),this._unlockItemMaster=c.getItemMaster(i.getItemId()),this.stageBtn.setTouchEnable(!1),n===l.LOCK_STATE.LOCK?(this.normalUnlockNode.active=!0,this.normalUnlockBtn.setTapEvent(this._setItemUnlockButtonEvent.bind(this))):(this.remainingNode.active=!0,this.remainingLabel.string="\u6b8b\u308a"+(this._unlockCount-e.todayUnlockUserBoosts.length)+"\u56de",this.freeUnlockNode.active=!0,this.freeUnlockBtn.setTapEvent(this._setFreeUnlockButtonEvent.bind(this)))}},getAreaId:function(){return this._areaId},setStageVisible:function(){var t=a.getTodayUnlockUserBoostByQuestId(l.QUEST_TYPE.AREA,this._areaId,[l.BOOST_TYPE.QUEST_UNLOCK,l.BOOST_TYPE.QUEST_LIMITED_UNLOCK]);if(!(t&&t.nowUnlockUserBoost&&t.nowUnlockUserBoost.getBoostType()===l.BOOST_TYPE.QUEST_UNLOCK||this._isDayChallengeCountRemaining(this.getAreaId())))return r.openSimpleMessageWindow("\u672c\u65e5\u306e\u4e0a\u9650\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f\u3002");var e=this._getLockState(this._areaId,t);e===l.LOCK_STATE.LOCK||e===l.LOCK_STATE.FREE_LOCK?r.openCommonPopupOk("","\u3053\u306e\u30af\u30a8\u30b9\u30c8\u306f\u7d42\u4e86\u3057\u3066\u3044\u307e\u3059","",!1,this._callbackToContentRedraw.bind(this)):this._root.pushStageScrollView(this._areaId)},_isDayChallengeCountRemaining:function(t){return _.some(u.dao.userQuests,function(e){return e.getAreaId()===t&&e.getIsDayChallengeCountRemain()})},_setFreeUnlockButtonEvent:function(){var t=a.getTodayUnlockUserBoostByQuestId(l.QUEST_TYPE.AREA,this._areaId,[l.BOOST_TYPE.QUEST_UNLOCK,l.BOOST_TYPE.QUEST_LIMITED_UNLOCK]);this._root.openQuestFreeUnlockPopup(l.QUEST_TYPE.AREA,this._areaId,l.UNLOCK_TYPE.FREE,void 0,function(t){this._openUnlockRequestEndPopup(t)}.bind(this),this._unlockCount-t.todayUnlockUserBoosts.length)},_setItemUnlockButtonEvent:function(){this._root.openQuestItemUnlockPopup(l.QUEST_TYPE.AREA,this._areaId,l.UNLOCK_TYPE.ITEM,this._unlockItemMaster.getItemId(),function(t){this._openUnlockRequestEndPopup(t)}.bind(this))},_openUnlockRequestEndPopup:function(t){var e="\u958b\u653e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002";t&&(e="\u958b\u653e\u3057\u307e\u3057\u305f\u3002"),r.openSimpleMessageWindow(e,function(){this._root.redrawUIHeader(),this._callbackToContentRedraw()}.bind(this))},_getLockState:function(t,e){return a.checkNowWeekByAreaId(t)?l.LOCK_STATE.WEEK_UNLOCK:e.nowUnlockUserBoost?l.LOCK_STATE.BOOST_UNLOCK:e.todayUnlockUserBoosts.length>=this._unlockCount?l.LOCK_STATE.LOCK:l.LOCK_STATE.FREE_LOCK},_getWeekRemainingDateLabel:function(t){var e=s.getNextWeekDifferenceTime(t);return t===s.getNowWeek()?this._getRemainingDateEndLabel(e.totalDay,e.totalHour,e.totalMinute):this._getRemainingDateStartLabel(e.totalDay,e.totalHour,e.totalMinute)},_getUnlockRemainingDateLabel:function(t){var e=s.getDiffMS(t.getEndDate()),i={totalDay:s.parseMsToDay(e),totalHour:s.parseMsToHour(e),totalMinute:s.parseMsToMinute(e)};return this._getRemainingDateEndLabel(i.totalDay,i.totalHour,i.totalMinute)},_getRemainingDateStartLabel:function(t,e,i){return i<=60?h.DATE.DATE_UP_TO_START_LABEL_MINUTE.replace(h.DATE.REPLACE_AREA_DATE_LABEL,i):e<=24?h.DATE.DATE_UP_TO_START_LABEL_HOUR.replace(h.DATE.REPLACE_AREA_DATE_LABEL,e):h.DATE.DATE_UP_TO_START_LABEL_DAY.replace(h.DATE.REPLACE_AREA_DATE_LABEL,t)},_getRemainingDateEndLabel:function(t,e,i){return i<=60?h.DATE.DATE_UP_TO_END_LABEL_MINUTE.replace(h.DATE.REPLACE_AREA_DATE_LABEL,i):e<=24?h.DATE.DATE_UP_TO_END_LABEL_HOUR.replace(h.DATE.REPLACE_AREA_DATE_LABEL,e):h.DATE.DATE_UP_TO_END_LABEL_DAY.replace(h.DATE.REPLACE_AREA_DATE_LABEL,t)}}),cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],ArenaGameManager:[function(t,e,i){"use strict";cc._RF.push(e,"4087dKdVqJMLZzroFTBXwsk","ArenaGameManager");var a=t("BaseGameManager"),n=t("GameEffectQueue").EffectQuery,o=(t("GameEffectQueue").EffectData,t("BattleData")),r=t("BattleResult"),s=t("EnumTypes"),c=t("Singleton"),l=t("BattleConstants"),u=t("BattleFunction"),h=t("SingletonConst"),d=(t("CharacterConst"),cc.Class({extends:a,ctor:function(){cc.log("ArenaGameManager ctor !!!!")},startGameManager:function(){cc.log("ArenaGameManager startGameManager!!");for(var t=u.getUnitList(!1),e=0;e<t.length;e+=1)t[e].curSkillRate=0;for(var i=u.getUnitList(!0),a=0;a<i.length;a+=1)i[a].curSkillRate=0;this._super(),this.loop.beginLoop(this.showBattleStartEffect),this.soundManager.continuePlayBGM(o.RM.stage_bgm)},playActionEndAnimation:function(t){cc.log("playActionEndAnimation")},initLoop:function(){cc.log("ArenaGameManager initLoop!!"),this._super(),this.loop.changeAction(this.showStartUI,this.showWaveStart,this.makeEnemy)},clearBaseLayout:function(){cc.log("ArenaGameManager clearBaseLayout"),this._super();var t=this.gameRoot.enemyUnitLayout.children;if(t)for(var e=0;e<t.length;e++)t[e].destroy()},_createEnemy:function(t,e){for(var i=this.battleOBJ_Prefabs.pvpEnemyUnit,a=this.battleOBJ_Prefabs.monsterAvatar,n=(this.gameRoot.monsterUnitLayout,this.getCurEnemyList()),r=l.ENEMY_PARAMETER_POSITION[n.length],s=l.ENEMY_AVATAR_POSITION[n.length],c=l.ENEMY_AVATAR_SCALE[n.length],u=0;u<n.length;u++){var h=n[u];cc.log("currentBattleUnit = ",h);var d=cc.instantiate(i),p=cc.instantiate(a),m=new cc.Node;m.parent=o.GM.gameRoot.enemyUnitLayout,m.setPosition(r[u]),d.parent=m,h.initBattleUnit(d,p),p.parent=this.gameRoot.bgBattleNode,p.setPosition(s[u]),p.setScale(c[u]),p.zIndex=5-u}t()},_executeWin:function(){return o.GM.showResult(),null},_executeLose:function(){return o.GM.showResult(),null},executeDraw:function(){return o.GM._executeLose(),null},showResult:function(){o.UI_M.b_canInputUI=!1;var t=o.GM;t.saveBattleSetting(function(){t.sendBattleResult(function(t){o.battleResult=t?r.createPvpBattleResult(t):r.create_temp_battleResult(),o.UI_M.showResultWindow()})}),o.gameResult===s.GameResult.PLAYER_WIN?t.playWinVoice():t.playLoseVoice()},checkAfterAction:function(){var t=o.GM,e=null;if(t.checkLastUnit())o.gameResult===s.GameResult.PLAYER_WIN?e=o.GM._executeWin():o.gameResult===s.GameResult.ENEMY_WIN||o.gameResult===s.GameResult.DRAW?e=o.GM._executeLose():cc.log("not exist result");else{var i=null;i=o.isNowPlayerTurn?o.ourUnitList:t.getCurEnemyList(),e=o.curUnitIdx<i.length?t.loop.nextAction():t.loop.nextAction(1)}e&&e()},showYouwin:function(){o.UI_M.b_canInputUI=!1;var t=o.GM,e=new n;e.addAction(o.UI_M.showYouWin.bind(o.UI_M)),t.effectQueue.addQuery(e);var i=function(t){o.transitionEndBattleFunc?(o.transitionEndBattleFunc(),o.requestEndBattleFunc=null,o.requestRetireBattleFunc=null,o.transitionEndBattleFunc=null):cc.director.loadScene("PvPScene.fire")},a=function(e){t.sendBattleResult(i)};o.GM.effectQueue.play(function(){t.saveBattleSetting(a)}),c.soundManager.bgmStop()},sendBattleResult:function(t){var e=this._createEndBattleParams();o.requestEndBattleFunc?o.requestEndBattleFunc(e,function(e){t&&t(e),this.resetBattleSession()}.bind(this)):(cc.error("\u30d0\u30c8\u30eb\u7d42\u4e86\u6642\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"),cc.director.loadScene("PvPScene.fire"))},sendBattleRetire:function(t){return t(null)},getRemainTurnCount:function(){return c.dao.userPvP.getPvPMainMaster().getTurn()-o.cur_TurnCount},_createEndBattleParams:function(){var t=o.ourUnitList.filter(function(t){return!t.isDead}).length,e=o.GM.getCurEnemyList().filter(function(t){return!t.isDead}).length,i={status:o.gameResult===s.GameResult.PLAYER_WIN?s.GameResult.PLAYER_WIN:s.GameResult.ENEMY_WIN,sessionId:o.sessionObjectData.sessionId,aliveCount:t,aliveTargetCount:e,remainTurnCount:this.getRemainTurnCount()},a=o.sessionObjectData.sessionId,n=u.objectToEncryptString(i,a);return c[h.ENVIRONMENT].getDebugEnctypt()&&(n=JSON.stringify(i)),cc.log("strParam = "+n),n}}));e.exports=d,cc._RF.pop()},{BaseGameManager:"BaseGameManager",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",BattleResult:"BattleResult",CharacterConst:"CharacterConst",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ArenaGameRoot:[function(t,e,i){"use strict";cc._RF.push(e,"50c91SZtwtJP5/dngVa+dcO","ArenaGameRoot");var a=t("GameRoot"),n=t("Singleton"),o=t("SingletonConst"),r=t("BattleData"),s=cc.Class({extends:a,start:function(){r.GM.gameRoot=this,r.GM.cameraController=this.cameraController,r.GM.battleEventController=this.battleEventController;var t=this.battleUIManagerNode.getComponent("BattleUIManager");t.battleEffect_Prefabs=r.battleEffect_Prefabs,r.GM.battleOBJ_Prefabs=r.battleOBJ_Prefabs,r.UI_M=t,r.GM.startGameManager(),r.isAuto&&this.poolManager.openAutoRunWindow(r.maxAutoCount-r.autoCount+1,r.maxAutoCount),n[o.ENVIRONMENT].getDebugQueue()&&(this.buttonDebugQueue.active=!0)},nextQuery:function(){r.GM.effectQueue.nextQuery()},updateChild:function(){}});e.exports=s,cc._RF.pop()},{BattleData:"BattleData",GameRoot:"GameRoot",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ArenaPlayerUnit:[function(t,e,i){"use strict";cc._RF.push(e,"579a6N4BalLIrkkGJmpqQih","ArenaPlayerUnit");var a=t("BattlePlayerUnit"),n=t("BattleData"),o=t("BattleConstants"),r=t("GameEffectQueue").GameEffectQueue,s=t("GameEffectQueue").EffectQuery,c=t("GameEffectQueue").EffectData,l=t("CommonFunction"),u=t("BattleFunction"),h=t("MemoryManager");cc.Class({extends:a,initBattleUnit:function(t,e){this.unitController=t.getComponent("PvPEnemyUnitCtrl"),this.unitController.myBattleUnit=this,this.avatarController=e.getComponent("MonsterAvatarCtrl"),this.avatarController.myBattleUnit=this;var i=new cc.Node,a=i.addComponent(sp.Skeleton);a.skeletonData=this.unitObjectSpine,a.timeScale=n.cur_GameSpeed,i.parent=this.avatarController.mainUnitAdjustPos,i.setScale(0),i.setPosition(cc.v2(0,140)),i.zIndex=1,this.mainAvatar=a,h.instance.storeRes(a.skeletonData,sp.SkeletonData);var o=l.clamp(this.getAttribute()-1,0,n.UI_M.elementImages.length-1);this.unitController.elementIcon.spriteFrame=n.UI_M.elementImages[o],this.unitController.nameLabel.string="<outline color=#1b1b1b width=2>"+this.deckUnit.mainChara.getCharaShortName()+"</outline>",u.readHitEffectEvent(this),this.initComplete=!0},initAvatarPosition:function(t){var e=cc.v2(640,100),i=n.UI_M.playerAvatarCenter.convertToNodeSpace(e);t.setPosition(i),t.parent=n.UI_M.playerAvatarCenter},startCardShow:function(t,e){var i=o.STARTSHOWCARD_DELAYTIME_PERSHOW*e/n.cur_GameSpeed,a=new r,l=new s,u={};u.delay=i,l.addAction(new c(u,this.unitController.delayWait.bind(this.unitController))),a.addQuery(l),l=new s,u=new Map,l.addAction(new c(u,this.unitController.mainCardShow.bind(this.unitController))),l.addAction(new c(u,this.avatarController.avatarShow.bind(this.avatarController))),a.addQuery(l),(l=new s).addAction(new c(u,this.unitController.iconShow.bind(this.unitController))),(u={}).curHp=this.curHp,u.maxHp=this.getMaxHp(),u.targetTime=o.HPFILL_EFFECT_TIME/n.cur_GameSpeed,l.addAction(new c(u,this.unitController.startHpGaugeAction.bind(this.unitController))),u=new Map;var h={};h.skillRate=this.curSkillRate,l.addAction(new c(h,this.unitController.playSetSkillRate.bind(this.unitController))),a.addQuery(l);var d=n.GM.actionController;(u={}).effectQueue=a,t.addAction(new c(u,d.playEffectqueue.bind(d)))},get_EffectShowNode:function(){return this.avatarController.effectShowNode},get_DamageShowNode:function(){return this.avatarController.damageShowNode}});cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",BattlePlayerUnit:"BattlePlayerUnit",CommonFunction:"CommonFunction",GameEffectQueue:"GameEffectQueue",MemoryManager:"MemoryManager"}],ArenaPoolManager:[function(t,e,i){"use strict";cc._RF.push(e,"5d1bfgk+nRA9Jv7S/OISsDU","ArenaPoolManager");var a=t("PoolManager"),n=cc.Class({extends:a,properties:{poolManager:a},_getSkillCutinInAnimationName:function(){return"PvPSkillCutin_IN_Anim"},_getSkillCutinMessageInAnimationName:function(){return"PvPSkillCutinMessage_IN_Anim"},_getAbilityCutinInAnimationName:function(){return"PvPAbilityCutin_IN_Anim"},_getAbilityCutinOutAnimationName:function(){return"PvPAbilityCutin_Out_Anim"},_getAbilityCutinNextAnimationName:function(){return"PvPAbilityCutin_Next_Anim"}});e.exports=n,cc._RF.pop()},{PoolManager:"PoolManager"}],ArenaRankUpPopup:[function(t,e,i){"use strict";cc._RF.push(e,"1cc02la4yVEFoOEvLn3eg0y","ArenaRankUpPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("BattleData"),r=t("PvPUtils"),s=t("ResourceUtils"),c=t("MatrixThumbnailUtils"),l=cc.Enum({START:0,LOOP:1});cc.Class({extends:a,properties:{rankUpAnimation:cc.Animation,decorationAnimationLeft:cc.Animation,decorationAnimationRight:cc.Animation,classImageSprite:cc.Sprite,className:cc.Label,rewardList:cc.Node,okButton:n},_callbackFinishedOpen:null,onLoad:function(){this.okButton.setTapEvent(this._onTapOkBtn.bind(this))},openArenaRankUpPopup:function(){var t=this._createArenaRankParam();this._setParameter(t.beforeClass,t.afterClass),this.open(function(){this._callbackOpenedAnim(),this._callbackFinishedOpenFunc()}.bind(this))},_createArenaRankParam:function(){var t=o.battleResult.pvp.point-o.battleResult.addPoint,e=o.battleResult.pvp.point,i=r.getPvpClassMasterByPoint(t),a=r.getPvpClassMasterByPoint(e);return{beforeClass:i.getClass(),afterClass:a.getClass()}},_callbackFinishedOpenFunc:function(){this._callbackFinishedOpen&&this._callbackFinishedOpen()},_callbackOpenedAnim:function(){this.rankUpAnimation.once("finished",function(){this.rankUpAnimation.play(this.rankUpAnimation.getClips()[l.LOOP].name),this.decorationAnimationLeft.play(this.decorationAnimationLeft.getClips()[l.START].name),this.decorationAnimationRight.play(this.decorationAnimationRight.getClips()[l.START].name)},this),this.rankUpAnimation.play(this.rankUpAnimation.getClips()[l.START].name)},_setClassRank:function(t){this.className.string=t.pvpClassMaster.getName(),s.addSprite(this.classImageSprite,s.getFileNamePvPClassIcon(t.pvpClassMaster.getClass()))},_addRewardThumbnails:function(t){this.rewardList.destroyAllChildren();for(var e=0;e<t.length;e+=1){var i={prefix:"x",count:t[e].getCount()},a=c.createMatrixThumbnailByItemType(t[e].getItemId(),t[e].getItemType(),i);this.rewardList.addChild(a.node)}},_setParameter:function(t,e){var i=r.getPvPClassInfoArray().find(function(t){return t.pvpClassMaster.getClass()===e});i?(this._setClassRank(i),this._addRewardThumbnails(i.pvpClassRewardMasterArray)):this._callbackFinishedOpen=this.close},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{BattleData:"BattleData",CommonButton:"CommonButton",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupBase:"PopupBase",PvPUtils:"PvPUtils",ResourceUtils:"ResourceUtils"}],ArenaResultRankGaugeView:[function(t,e,i){"use strict";cc._RF.push(e,"33c0eOfpItDwY43+TCcBffC","ArenaResultRankGaugeView");var a=t("ResultPlayerRankView"),n=(t("BattleFunction"),t("BattleData")),o=t("PvPUtils"),r=t("ResourceUtils"),s=t("GameConst"),c=t("Singleton");cc.Class({extends:a,properties:{className:cc.Label,arenaCoinSprite:cc.Sprite,arenaCoinLabel:cc.Label,playerLevelDisplayNode:cc.Node},_userPvpData:null,_maxPvPClassMaster:null,initArenaResultRankGaugeView:function(t,e,i,a){this._maxPvPClassMaster=_.maxBy(c.dao.PvPClassMasters,function(t){return t.getClass()}),this._setArenaCoin(a),this.initResultPlayerRankView(t,e,i)},initResultPlayerRankView:function(t,e,i){this._result=t,this._delayCount=e,this._addExp=i,this._userPvpData=n.battleResult.pvp;var a=this._userPvpData.point-i;this.node.active=!1,this.playerRankNumberLevelUpLabel.node.active=!1;var r=o.getPvpClassMasterByPoint(a),s=r?r.getClass():1,c=o.getCurExpOnZeroBasePvpClassMaster(a,s),l=o.getNextPointPvpClass(s);this._setClassName(s),this.playerRankExpProgressBar.progress=c/l,this.playerRankAddExpLabel.string=""+i,this._playerData={currentLevel:s,needExp:l,currentExp:c,plusExp:0,remainExp:i}},_drawPlayerExpUpAction:function(t){var e=!1;if(this._playerData.remainExp>0){var i=this._addExp*(t/1);this._playerData.plusExp+=i,this._playerData.plusExp>=this._addExp?(this._playerData.plusExp=this._addExp,this._playerData.currentExp+=this._playerData.remainExp,this._playerData.remainExp=0,e=!0):(this._playerData.currentExp+=i,this._playerData.remainExp-=i),this._playerData.currentLevel<this._maxPvPClassMaster.getClass()&&this._playerData.currentExp>=this._playerData.needExp&&(this._playerData.currentExp-=this._playerData.needExp,this._playerData.currentLevel+=1,this._playerData.needExp=o.getNextPointPvpClass(this._playerData.currentLevel),this._setClassName(this._playerData.currentLevel)),this.playerRankExpProgressBar.progress=this._playerData.currentExp/this._playerData.needExp,this.playerRankAddExpLabel.string=""+parseInt(this._playerData.remainExp),n.GM.soundManager.playSE(n.RM.soundResourceList.ExperiencePointsRise)}else e=!0;if(e){var a=this._result.updateCallbacks.indexOf(this._callbackDrawPlayerExpUpAction);return this._result.updateCallbacks.splice(a,1),this._callback()}},_setClassName:function(t){this.className.string=o.getPvPClassMasterByClassOrder(t).getName()},_setArenaCoin:function(t){r.addSprite(this.arenaCoinSprite,r.getFileNameItemImage(s.ITEM_ID_PVP)),this.arenaCoinLabel.string=t.toString()},_hidePlayerLevelDisplayNode:function(){this.playerLevelDisplayNode.active=!1,this.playerRankNumberLevelUpLabel.node.active=!1,this.playerRankNumberLabel.node.active=!1}});cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",GameConst:"GameConst",PvPUtils:"PvPUtils",ResourceUtils:"ResourceUtils",ResultPlayerRankView:"ResultPlayerRankView",Singleton:"Singleton"}],ArenaResultSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"1ed37zbBNVALaaxEXZQSCac","ArenaResultSubRoot");var a=t("BattleData"),n=t("BattleFunction"),o=t("Singleton"),r=t("EnumTypes"),s=t("ArenaResultRankGaugeView"),c=t("CommonButton"),l=t("PvPUtils"),u=t("Async");cc.Class({extends:cc.Component,properties:{resultTitleLabel:cc.Label,resultBgGraySprite:cc.Sprite,battleClearNode:cc.Node,battleCharacterSlidInAnimation:cc.Animation,battleCharacterSkeleton:[sp.Skeleton],resultTitleAnimation:cc.Animation,upSlideOutAnimation:cc.Animation,downSlideOutAnimation:cc.Animation,arenaRankView:s,rankUpPopupPrefab:cc.Prefab,nextBtnSlidInAnimation:cc.Animation,nextRetryBtnGroupNode:cc.Node,nextButton:c},updateCallbacks:null,_isWin:!1,_beforePvpPoint:0,_gainPvpPoint:0,_pvpClass:0,_pvpCoin:0,ctor:function(){this.updateCallbacks=[]},show:function(){this._battleResult=a.battleResult,this._battleUnitList=n.getUnitList(!1),this._entryUsers=this._battleResult._res.entryUsers,this._initResult();var t=this._getAnimationTask();u.waterfall(t)},_initButtons:function(){this.nextButton.setTapEvent(this._nextPvp.bind(this))},_nextPvp:function(){o.soundManager.bgmStop(),a.transitionEndBattleFunc?(a.transitionEndBattleFunc(),a.requestSaveBattleFunc=null,a.requestEndBattleFunc=null,a.transitionEndBattleFunc=null):cc.director.loadScene("QuestScene.fire")},_initArenaRankView:function(){this.arenaRankView.initArenaResultRankGaugeView(this,1,this._gainPvpPoint,this._pvpCoin)},_initResult:function(){this._beforePvpPoint=a.battleResult.pvp.point-a.battleResult.addPoint,this._gainPvpPoint=a.battleResult.addPoint,this._pvpClass=a.battleResult.pvp.pvpClass,this._pvpCoin=a.battleResult.addPoint,this._initButtons(),this._initArenaRankView(),this._isWin=a.gameResult===r.GameResult.PLAYER_WIN,this.resultTitleLabel.string="RESULT"},_parallelAnimation:function(t,e){var i=t.length;if(!(t.length>0))return e();t.forEach(function(t){t(function(){if((i-=1)<=0)return e()})})},_getAnimationTask:function(){var t=[];return t.push(this._isWin?this._playBattleClearAnimation.bind(this):this._playBattleLoseAnimation.bind(this)),t.push(function(t){var e=[this._playBattleCharacterSlidInAnimation.bind(this),this._playBattleUiFadeOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),t.push(this._playResultBgGrayFadeIn.bind(this)),t.push(this._playResultTitleAnimation.bind(this)),t.push(this._playArenaRankSlidInAnimation.bind(this)),t.push(this._playArenaRankExpAnimation.bind(this)),t.push(this._openResultRankUpPopup.bind(this)),t.push(function(t){var e=[this._playUiUpSlideOutAnimation.bind(this),this._playUiDownSlideOutAnimation.bind(this),this._playNextBtnSlidInAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),t.push(this._endBattleResult.bind(this)),t},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e-=1)this.updateCallbacks[e](t)},_playBattleClearAnimation:function(t){var e=a.battleEffect_Prefabs.BattleWin,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleLoseAnimation:function(t){var e=a.battleEffect_Prefabs.BattleLose,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleCharacterSlidInAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)this.battleCharacterSkeleton[e].skeletonData=this._battleUnitList[e].mainAvatar.skeletonData,this.battleCharacterSkeleton[e].setAnimation(0,"idle",!0),this._battleUnitList[e].unitController.node.runAction(cc.fadeOut(.5));this.battleCharacterSlidInAnimation.once("finished",function(e){return t(e)},this),this.battleCharacterSlidInAnimation.play(this.battleCharacterSlidInAnimation.getClips()[0].name)},_playBattleUiFadeOutAnimation:function(t){var e=[function(t){this._startBattleUiFadeOutAnimation(a.UI_M.waveTurnPanel_Root,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SkillBtn_Pos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SpeedBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.PauseBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.BattleInfoBtnBasePos,t)}.bind(this)];this._parallelAnimation(e,t)},_startBattleUiFadeOutAnimation:function(t,e){t.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){t.active=!1,e()})))},_playResultBgGrayFadeIn:function(t){var e=cc.sequence(cc.delayTime(0),cc.fadeIn(.3),cc.callFunc(function(e){return t(e)}));this.resultBgGraySprite.node.opacity=0,this.resultBgGraySprite.node.active=!0,this.resultBgGraySprite.node.runAction(e)},_playResultTitleAnimation:function(t){this.resultTitleAnimation.once("finished",function(e){return t(e)},this),this.resultTitleAnimation.node.active=!0,this.resultTitleAnimation.play(this.resultTitleAnimation.getClips()[0].name)},_playArenaRankSlidInAnimation:function(t){var e=[];e=this._getPlayerRankSlidInAnimation(e),this._parallelAnimation(e,t)},_getPlayerRankSlidInAnimation:function(t){return t.push(this.arenaRankView.playPlayerRankSlidInAnimation.bind(this.arenaRankView)),t},_playArenaRankExpAnimation:function(t){this.arenaRankView.playPlayerRankExpAnimation(t)},_openResultRankUpPopup:function(t){var e=l.getPvpClassMasterByPoint(this._beforePvpPoint);if((e?e.getClass():1)===this._pvpClass){var i=cc.sequence(cc.delayTime(2),cc.callFunc(t));return this.arenaRankView.node.runAction(i)}var a=cc.instantiate(this.rankUpPopupPrefab).getComponent("ArenaRankUpPopup");a.setCloseCallBack(t),a.openArenaRankUpPopup()},_playUiUpSlideOutAnimation:function(t){this.upSlideOutAnimation.once("finished",function(e){return t(e)},this),this.upSlideOutAnimation.play(this.upSlideOutAnimation.getClips()[0].name)},_playUiDownSlideOutAnimation:function(t){this.downSlideOutAnimation.once("finished",function(e){return t(e)},this),this.downSlideOutAnimation.play(this.downSlideOutAnimation.getClips()[0].name)},_playNextBtnSlidInAnimation:function(t){this.nextBtnSlidInAnimation.once("finished",function(e){return t(e)},this),this.nextBtnSlidInAnimation.node.opacity=0,this.nextBtnSlidInAnimation.node.active=!0,this.nextBtnSlidInAnimation.play(this.nextBtnSlidInAnimation.getClips()[0].name)},_endBattleResult:function(t){if(a.autoBattleResultDropItemMap=null,a.autoBattleResultEventItemMap=null,t)return t()}});cc._RF.pop()},{ArenaResultRankGaugeView:"ArenaResultRankGaugeView",Async:"Async",BattleData:"BattleData",BattleFunction:"BattleFunction",CommonButton:"CommonButton",EnumTypes:"EnumTypes",PvPUtils:"PvPUtils",Singleton:"Singleton"}],ArenaUIManager:[function(t,e,i){"use strict";cc._RF.push(e,"317cdF5JcJCe6boMU1lBovk","ArenaUIManager");var a=t("BattleData"),n=t("BattleUIManager"),o=(t("PlayerUnitCtrl"),t("GameEffectQueue").GameEffectQueue),r=t("GameEffectQueue").EffectQuery,s=t("GameEffectQueue").EffectData,c=cc.Class({extends:n,showBattleStart:function(t,e){cc.log("ArenaUIManager.showBattleStart"),this._super(t,e);var i=new o,n=new r,c={};c.targetNode=a.GM.gameRoot.bgWhiteNode,c.fadeTime=.5,c.color=cc.color(0,0,0),c.opacity=0,n.addAction(new s(c,a.UI_M.fadeToNode.bind(a.UI_M))),i.addQuery(n),i.play()},showStartUI:function(t){t.addAction(new s(null,this.showWaveTurnUI.bind(this))),t.addAction(new s(null,this.showRightTopBtnUI.bind(this))),this.set_turn_label(a.cur_TurnCount)},showResultWindow:function(){var t=cc.instantiate(this.battleResultPrefab).getComponent("ArenaResultSubRoot");this.battleResultNode.addChild(t.node),this.battleResultNode.active=!0,t.show()}});e.exports=c,cc._RF.pop()},{BattleData:"BattleData",BattleUIManager:"BattleUIManager",GameEffectQueue:"GameEffectQueue",PlayerUnitCtrl:"PlayerUnitCtrl"}],AsyncFileLoader:[function(t,e,i){"use strict";cc._RF.push(e,"37d7fGNMhhL35/CNcy5UGz1","AsyncFileLoader");var a=t("Singleton"),n=t("SingletonConst"),o=t("GenerateMd5"),r=t("DownManifestManager"),s=t("GameConst"),c=t("CommonUtils"),l=t("LocalDataConst"),u=t("FileLoaderConsts"),h=(t("MemoryManager"),t("ErrorCode")),d=t("Async"),p=cc.Class({properties:{downloader:null,maxDownLoadTime:0,curDownLoadTime:0,ifDoLoadLogic:!0,isWaitingRetry:!1,retryRemoteUrl:null,retryLocalPath:null,retryFileType:null,retryLoadFunc:null},ctor:function(){this.ifDoLoadLogic=!0,this.maxDownLoadTime=2,this.isAdvFile=!1,this.isWaitingRetry=!1,this.initQualityPath()},initQualityPath:function(){var t=c.loadLocalStorage(l.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,l.LOCAL_STORAGE_GET_TYPE.INTEGER);a.localData[l.RES_QUALITY]=t,this._qualityPath="",this.setQuality(t)},setQuality:function(t){if(cc.sys.isNative)switch(t){case s.RESOURCE_QUALITY.LOW:default:this._qualityPath=u.DOWNLOAD_GAME_ANDROID+u.DOWNLOAD_GAME_LD;break;case s.RESOURCE_QUALITY.HIGH:this._qualityPath=u.DOWNLOAD_GAME_ANDROID+u.DOWNLOAD_GAME_HD}else switch(t){case s.RESOURCE_QUALITY.LOW:this._qualityPath=u.DOWNLOAD_GAME_WEB+u.DOWNLOAD_GAME_LD;break;case s.RESOURCE_QUALITY.HIGH:this._qualityPath=u.DOWNLOAD_GAME_WEB+u.DOWNLOAD_GAME_HD}},loadFileEx:function(t,e,i){var o=this;if(this.isWaitingRetry=!1,e==sp.SkeletonData){var s=!1;o.loadFileExInner(t+".atlas.txt","atlas",null,null,function(e,a,n){if(e)return i(e,null,t);for(var r=[n],c=t.lastIndexOf("/"),l=t.substr(0,c+1),u=a.match(new RegExp(/^.*.png*$/gim)),h=[],p=[],m=0;m<u.length;m++)u[m]=u[m].trim(),p.push(function(e,a){var n=l+u[a];o.loadFileExInner(n,"tex",null,null,function(n,o,c,l){if(n)return i(n,null,t);s=l,r.push(c),h.push(o),e(a)})});p.push(function(e){o.loadFileExInner(t+".json","json",null,null,function(e,n,o){if(e)return i(e,null,t);var c=new sp.SkeletonData;if(cc.sys.isNative){var l=JSON.parse(n);c.skeletonJson=l}else c.skeletonJson=n;if(c.textures=h,s){for(var d=0;d<u.length;d++)u[d]=u[d].replace(".png",".pkm");c.textureNames=u,a=a.replace(/.png/g,".pkm")}else c.textureNames=u;return c.atlasText=a,r.push(o),r.push(c),i(e,c,t,r)})}),d.waterfallWithIndex(p,null,0)})}else if(e==cc.TextAsset)o.loadFileExInner(t+".txt","txt",null,null,function(e,a,n){i(e,a,t,n)});else if(e==cc.SpriteFrame){var c="";if((u=t).endsWith(".jpg")||u.endsWith(".png"))u.endsWith(".jpg")?c="jpg":u.endsWith(".png")&&(c="png");else{var l=u=t+"."+(c="png");a[n.ENVIRONMENT].getPlainDynamicFileFlg()||null!=r.instance.getFileInfo(l)||(u=t+"."+(c="jpg"))}o.loadFileExInner(u,c,null,null,function(e,a,n){i(e,a,t,n)})}else if(e==cc.AnimationClip)o.loadFileExInner(t+".anim","anim",null,null,function(e,a,n){i(e,a,t,[a,n])});else if(e==cc.AudioClip){(u=t).endsWith(".mp3")||(u=t+".mp3"),o.loadFileExInner(u,"mp3",null,null,function(e,a,n){i(e,a,t,n)})}else if(e==cc.VideoPlayer){var u;(u=t).endsWith(".mp4")||(u=t+".mp4"),o.loadFileExInner(u,"mp4",null,null,function(e,a,n){i(e,a,t,[a,n])})}else if(e==cc.SpriteAtlas)o.loadFileExInner(t+".png","tex",null,null,function(e,a,n){if(e)return i(e,null,t,null);o.loadFileExInner(t+".plist","plist",null,null,function(e,o,r){var s=new cc.SpriteAtlas,c=s._spriteFrames;for(var l in o.frames){var u=l.lastIndexOf("."),h=l.substr(0,u),d=o.frames[l],p=d.textureRect,m=(p=(p=p.replace(/{/g,"")).replace(/}/g,"")).split(","),_=d.spriteOffset,g=(_=(_=_.replace(/{/g,"")).replace(/}/g,"")).split(","),C=d.spriteSourceSize,f=(C=(C=C.replace(/{/g,"")).replace(/}/g,"")).split(","),E=cc.rect(parseInt(m[0]),parseInt(m[1]),parseInt(m[2]),parseInt(m[3])),T=1==d.textureRotated,S=cc.v2(parseInt(g[0]),parseInt(g[1])),R=cc.size(parseInt(f[0]),parseInt(f[1])),A=new cc.SpriteFrame;A.name=h,A.setTexture(a,E,T,S,R),c[h]=A}return i(e,s,t,[s,n,r])})});else{var h="loadFileEx: don't know this type...";cc.log(h),i(h,null,t,null)}},loadAdvFileEx:function(t,e,i,o){console.log("loadAdvFileEx:"+t+" "+e+" "+i+" "+o);this.isWaitingRetry=!1,this.isAdvFile=!0;var r=t.lastIndexOf("."),s=t.substr(r,t.length),c=t.substr(r+1,t.length),l=e+"/"+i+s,u=a[n.ENVIRONMENT].getDynamicResourceUrl()+"download_adv/"+l;this.loadFileExInner(t,c,u,i,function(t,e,i){o(t,e,i)})},loadFileExInner:function(e,i,o,c,d){console.log("loadFileExInner:"+e+" "+i+" "+o+" "+c+" "+d);var p=this,m=e.replace("download/",""),_=m=m.replace(/(^\/+)/,""),g=m,C=_.lastIndexOf("."),f=_.substr(0,C),E=_.substr(C+1);-1!==_.indexOf(".atlas.txt")&&(E="atlas.txt");var T,S=i,R=E;if(r.instance.getServerFileIsEtcByName(m)&&(R=i="pkm",g=f+"."+i),T=null==o||a[n.ENVIRONMENT].getPlainDynamicFileFlg()?this.getResServerPath(e,R):o,cc.sys.isNative){var A,b=function(){p.ifDoLoadLogic?"txt"==i||"atlas"==i||"json"==i?d(null,jsb.fileUtils.getStringFromFile(A),A):"mp3"==i||"mp4"==i?cc.loader.load(A,function(t,e){d(t,e,A)}):"tex"==i?cc.loader.load(A,function(t,e){d(t,e,A)}):"plist"==i?cc.loader.load(A,function(t,e){d(t,e,A)}):"pkm"==i?cc.loader.load(A,function(t,e){var i,a=new cc.Texture2D;"jpg"==E?(a._format=cc.Texture2D.PixelFormat.RGB_ETC1,i=cc.rect(0,0,e.width,e.height)):(a._format=cc.Texture2D.PixelFormat.RGBA_ETC1,i=cc.rect(0,0,e.width,e.height/2)),a._nativeAsset=e,"tex"==S?d(t,a,A,!0):d(t,new cc.SpriteFrame(a,i),A)}):cc.loader.load(A,function(t,e){d(t,new cc.SpriteFrame(e),A)}):d()},M=jsb.fileUtils.getWritablePath()+this._qualityPath+g;A=this.isAdvFile?jsb.fileUtils.getWritablePath()+u.DOWNLOAD_GAME_ANDROID+g:M;var v=this.isResNeedUpdate(A,M,m,c);if(A=v.storagePath,!v.need)return void b();this.curDownLoadTime=1;this.downloader||(this.downloader=new jsb.Downloader({countOfMaxProcessingTasks:6,timeoutInSeconds:50,tempFileNameSuffix:".tmp"})),this.downloader.createDownloadFileTask(T,A),this.downloader.setOnTaskProgress(function(t,e,i,a){}),this.downloader.setOnFileTaskSuccess(function(t){b()}),this.downloader.setOnTaskError(function(o,r,c,u){if(cc.log("setOnTaskError..."+u),cc.log("Failed to load: "+T+", orgUrl:"+e),-1===u.indexOf(s.SPACE_NOT_ENOUGH_ERR1)&&-1===u.indexOf(s.SPACE_NOT_ENOUGH_ERR2))if(p.curDownLoadTime<p.maxDownLoadTime)p.curDownLoadTime++,cc.log("retry: "+T),p.downloader.createDownloadFileTask(T,A);else{if("mp3"==i||"mp4"==i)return void d(u,null,A);p.isWaitingRetry=!0,p.retryRemoteUrl=T,p.retryLocalPath=A;var m=t("FileLoaderManager");if(!m.instance.hasAsyncFileError)return m.instance.hasAsyncFileError=!0,a[n.ERROR_MANAGER].throwError(h.DYNAMIC_RES_ERROR,function(){m.instance.retryAllFailed()})}else cc.log("111:"+a.localData[l.IS_CAPACITY_FULL]),a.localData[l.IS_CAPACITY_FULL]||(a.localData[l.IS_CAPACITY_FULL]=!0,window.setIntervalId&&(clearInterval(window.setIntervalId),a.localData[l.NOW_DATETIME]=null),t("PopupUtils").openSystemPopup("\u78ba\u8a8d","\u5bb9\u91cf\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093","",!1,function(){cc.game.end()})),d(u,null,A)})}else{cc.loader.load(T,function o(r,s){if(r)if(cc.log("Failed to load: "+e+", remoteUrl:"+T),a[n.ENVIRONMENT].getPlainDynamicFileFlg())cc.log("\u30ed\u30fc\u30ab\u30eb\u5c02\u7528\u30ed\u30fc\u30c9\u30ea\u30c8\u30e9\u30a4","\u62e1\u5f35\u5b50\u3092\u5909\u66f4\u3057\u3066\u518d\u30ed\u30fc\u30c9\u3092\u884c\u3044\u307e\u3059\u3002"),"png"==i?(T=T.substring(0,T.length-4)+".jpg",cc.log("retry: "+T),cc.loader.load(T,function(t,e){cc.log("load: "+T),d(t,t?null:new cc.SpriteFrame(e),T)})):"atlas"==i?(T=T.replace(".txt",""),cc.log("retry: "+T),cc.loader.load(T,function(t,e){cc.log("load: "+T),d(t,t?null:e,T)})):d(r,null,T);else{if("mp3"==i||"mp4"==i)return void d(r,null,T);p.isWaitingRetry=!0,p.retryRemoteUrl=T,p.retryLoadFunc=o;var c=t("FileLoaderManager");if(!c.instance.hasAsyncFileError)return c.instance.hasAsyncFileError=!0,a[n.ERROR_MANAGER].throwError(h.DYNAMIC_RES_ERROR,function(){c.instance.retryAllFailed()})}else d(r,"png"==i||"jpg"==i?new cc.SpriteFrame(s):"mp4"==i?T:s,T)})}},retry:function(){cc.sys.isNative?this.downloader.createDownloadFileTask(this.retryRemoteUrl,this.retryLocalPath):cc.loader.load(this.retryRemoteUrl,this.retryLoadFunc)},getResServerPath:function(t,e){console.log("getResServerPath:"+t+" "+e);var i="";if(a[n.ENVIRONMENT].getPlainDynamicFileFlg())i=a[n.ENVIRONMENT].getDynamicResourceUrl()+t;else{var r=t.replace("download/","");r=r.replace(/(^\/+)/,"");var s=o.instance.MD5(r),c=o.instance.getFolderPath(s)+s+"."+e,l="";l=(cc.sys.isNative,this._qualityPath),i=a[n.ENVIRONMENT].getDynamicResourceUrl()+l+c;console.log("getResServerPath MD5:"+s+" "+c+" "+l);}return i},isResNeedUpdate:function(t,e,i,o){var s=t;if(!jsb.fileUtils.isFileExist(s)){if(!this.isAdvFile||!jsb.fileUtils.isFileExist(e))return{need:!0,storagePath:s};s=e}var c=a[n.ENVIRONMENT];return jsb.reflection.callStaticMethod(c.getAndroidDomain()+"NativeMethod","getFileMD5","(Ljava/lang/String;)Ljava/lang/String;",s)==(null!=o?o:r.instance.getServerFileMd5ByName(i))?{need:!1,storagePath:s}:(jsb.fileUtils.removeFile(s),{need:!0,storagePath:s})},setIfDoLoadLogic:function(t){this.ifDoLoadLogic=t}});e.exports=p,cc._RF.pop()},{Async:"Async",CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",ErrorCode:"ErrorCode",FileLoaderConsts:"FileLoaderConsts",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",GenerateMd5:"GenerateMd5",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",PopupUtils:"PopupUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],Async:[function(t,e,i){"use strict";cc._RF.push(e,"bbb18JZsiFBc54qX7wMHy5x","Async"),e.exports={waterfall:function(t,e){if(0===t.length){if(!e)return;return e()}var i=this;t.shift()(function(){i.waterfall(t,e)})},waterfallWithIndex:function(t,e,i){if(0===t.length){if(!e)return;return e()}var a=this;t.shift()(function(i){a.waterfallWithIndex(t,e,i+1)},i)}},cc._RF.pop()},{}],AuthApis:[function(t,e,i){"use strict";cc._RF.push(e,"9d0e4FjznhDlJ9k8QBf85x5","AuthApis");t("ApiConstants");var a=t("RESTClient").RESTClient;a.graft({name:"auth/getDevRequestToken",path:"auth/getDevRequestToken",method:"GET"}),a.graft({name:"auth/getDmmAccessToken",path:"auth/getDmmAccessToken",method:"GET"}),a.graft({name:"auth/getDevAccessToken",path:"auth/getDevAccessToken",method:"GET"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],AuthService:[function(t,e,i){"use strict";cc._RF.push(e,"1fa6bDErqdFBJ/B2FUJyPeS","AuthService");var a=t("Async"),n=t("../service/BaseService"),o=t("Singleton"),r=t("SingletonConst"),s=t("DmmAndroidJsToJava"),c=t("LocalDataConst");cc.Class({extends:n,authenticate:function(t){var e=this;this._getRequestToken(function(){e._getAccessToken(t)})},_getRequestToken:function(t){o[r.ENVIRONMENT].isDmmPlatform()?this._getDmmRequestToken(t):this._getDevRequestToken(t)},_getDmmRequestToken:function(t){var e=[];cc.sys.isBrowser&&cc.sys.isMobile?e.push(this._getDmmSpRequestToken.bind(this)):cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID?(e.push(this._getDmmAndroidLoginInfo.bind(this)),e.push(this._getDmmAndroidResourceVersion.bind(this)),e.push(this._getDmmAndroidRequestToken.bind(this))):(e.push(this._getDmmLoginInfo.bind(this)),e.push(this._getDmmPcResourceVersion.bind(this)),e.push(this._getDmmPcRequestToken.bind(this))),a.waterfall(e,t)},_getDmmLoginInfo:function(t){window.addEventListener("message",function e(i){if("getDmmLoginInfo"===i.data.api){window.removeEventListener("message",e);var a=JSON.parse(i.data.result);return o[r.OAUTH].set("user_id",a.dmmUserData.id),t()}},!1),window.parent.postMessage({api:"getDmmLoginInfo",param:void 0},"*")},_getDmmPcResourceVersion:function(t){window.addEventListener("message",function e(i){if("resourceVersion"===i.data.api)return window.removeEventListener("message",e),o[r.ENVIRONMENT].set("resourceVersion",i.data.result.resourceVersion),t()},!1),window.parent.postMessage({api:"resourceVersion",param:void 0},"*")},_getDmmPcRequestToken:function(t){window.addEventListener("message",function e(i){if("getDmmWebRequestToken"===i.data.api){window.removeEventListener("message",e);var a=o[r.OAUTH];return a.set("game_server_token",i.data.result.token),a.set("game_server_secret",i.data.result.secret),o[r.ENVIRONMENT].set("dmmAppId",i.data.appId),t()}},!1);var e=o[r.ENVIRONMENT];window.parent.postMessage({api:"getDmmWebRequestToken",param:{url:e.getApiHost()+"/"+e.getApiPrefix()+"auth/getDmmWebRequestToken"}},"*")},_getDmmSpRequestToken:function(t){var e=this._getUrlQueryParameter(),i=decodeURIComponent(e.token),a=JSON.parse(i),n=o[r.OAUTH];n.set("game_server_token",a.token),n.set("game_server_secret",a.secret),n.set("user_id",a.dmmId);var s=o[r.ENVIRONMENT];return s.set("dmmAppId",a.appId),s.set("resourceVersion",a.resourceVersion),t()},_getUrlQueryParameter:function(){cc.log("window.location = ",window.parent.location);for(var t=window.parent.location.search.substring(1).split("&"),e={},i=0;i<t.length;i+=1){var a=t[i].split("=");e[a[0]]=a[1]}return e},_getDmmAndroidLoginInfo:function(t){s.getDmmAndroidLoginInfo(function(e){return o[r.OAUTH].set("user_id",e.dmmId),_.assign(o.localData[c.USER_VERSION],{apkVersion:e.appVersionName}),t()})},_getDmmAndroidResourceVersion:function(t){s.getDmmAndroidResourceVersion(function(e){return o[r.ENVIRONMENT].set("resourceVersion",e.resourceVersion),t()})},_getDmmAndroidRequestToken:function(t){s.getDmmAndroidRequestToken(function(e){var i=o[r.OAUTH];return i.set("game_server_token",e.token),i.set("game_server_secret",e.secret),o[r.ENVIRONMENT].set("dmmAppId",e.appId),t()})},_getDevRequestToken:function(t){this._requestCallApi("auth/getDevRequestToken",{},function(e,i){if(!e){var a=o[r.OAUTH];a.set("game_server_token",i.token),a.set("game_server_secret",i.secret),a.set("user_id",i.userId);var n=o[r.ENVIRONMENT],s=n.getDebugAdult()?0:n.getNVersionAppIds()[0];return n.set("dmmAppId",s),t()}cc.log("ERROR: request token error")})},_getAccessToken:function(t){o[r.ENVIRONMENT].isDmmPlatform()?this._getDmmAccessToken(t):this._getDevAccessToken(t)},_getDmmAccessToken:function(t){this._requestCallApi("auth/getDmmAccessToken",{},function(e,i){if(!e){var a=o[r.OAUTH];return a.set("game_server_token",i.token),a.set("game_server_secret",i.secret),a.set("token_expire",i.expire),a.set("user_id",i.userId),t()}cc.log("ERROR: access token error")})},_getDevAccessToken:function(t){this._requestCallApi("auth/getDevAccessToken",{},function(e,i){if(!e){var a=o[r.OAUTH];return a.set("game_server_token",i.token),a.set("game_server_secret",i.secret),a.set("token_expire",i.expire),t()}cc.log("ERROR: access token error")})}});cc._RF.pop()},{"../service/BaseService":"BaseService",Async:"Async",DmmAndroidJsToJava:"DmmAndroidJsToJava",LocalDataConst:"LocalDataConst",Singleton:"Singleton",SingletonConst:"SingletonConst"}],AutoDeckEditPopup:[function(t,e,i){"use strict";cc._RF.push(e,"dd4dfIfB7tNrqjPok+WJQg8","AutoDeckEditPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=(t("Singleton"),t("LocalDataConst"));t("CharacterSortConst"),cc.Class({extends:a,properties:{editOkBtn:n,cancelBtn:n,attributeCheckBoxToggleArray:[cc.Toggle],statsToggleContainer:cc.ToggleContainer,targetCheckBoxToggleArray:[cc.Toggle],equipmentCheckBoxToggleArray:[cc.Toggle]},_callbackToEditOkBtn:null,openAutoDeckEditPopup:function(t,e,i,a,n,o){this._initAutoDeckEditPopup(t,e,i,a,n,o),this.open()},_initAutoDeckEditPopup:function(t,e,i,a,n,o){this._setSortType(t),this._setFilter(e,this.attributeCheckBoxToggleArray),this._setFilter(i,this.targetCheckBoxToggleArray),this._setFilter(a,this.equipmentCheckBoxToggleArray),this._initButtons(n,o)},_setSortType:function(t){this.statsToggleContainer.allowSwitchOff=!0;for(var e=0;e<this.statsToggleContainer.toggleItems.length;e+=1)this.statsToggleContainer.toggleItems[e].isChecked=!1;this.statsToggleContainer.toggleItems[t].isChecked=!0,this.statsToggleContainer.allowSwitchOff=!1},_setFilter:function(t,e){for(var i=0;i<e.length;i+=1)e[i].isChecked=t[i]},_initButtons:function(t,e){this.setCallbackToEditOkBtn(t),this.setCloseCallBack(e),this.editOkBtn.setTapEvent(this._editOkBtnEvent.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL)},_editOkBtnEvent:function(){o.saveLocalStorage(r.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,this.getSelectedIndex()),this._callbackToEditOkBtn&&this._callbackToEditOkBtn(this.getSelectedIndex(),this.getCheckList(this.attributeCheckBoxToggleArray),this.getCheckList(this.targetCheckBoxToggleArray),this.getCheckList(this.equipmentCheckBoxToggleArray)),this.close()},getSelectedIndex:function(){for(var t=0,e=0;e<this.statsToggleContainer.toggleItems.length;e+=1){if(this.statsToggleContainer.toggleItems[e].isChecked){t=e;break}}return t},getCheckList:function(t){for(var e=[],i=0;i<t.length;i+=1)e[i]=t[i].isChecked;return e},setCallbackToEditOkBtn:function(t){this._callbackToEditOkBtn=t}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CommonButton:"CommonButton",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",PopupBase:"PopupBase",Singleton:"Singleton"}],AutoDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"412800J2atCNJnak0WX6TlD","AutoDetailPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonCountView"),s=t("BattleData"),c=t("QuestUtils"),l=t("CampaignUtils");cc.Class({extends:a,properties:{costNum:cc.Label,consumeApBaseNum:cc.Label,consumeApAfterNum:cc.Label,countViewSpace:r,cancelBtn:o,decisionBtn:o},_root:null,_questModel:null,_consumeApBaseNum:null,_costNum:null,_consumeAp:null,_sortiesCount:null,_sortiesMaxCount:null,openAutoDetailPopup:function(t,e){this._root=t,this._questModel=e,this._setParameter(e),this.cancelBtn.setTapEvent(this._closeBtnEvent.bind(this),o.SE_NAME.CANCEL),this.decisionBtn.setTapEvent(this._onTapDecisionBtn.bind(this)),this.open()},_setParameter:function(t){this._consumeApBaseNum=n.dao[n.USER].getCurrentStaminaInfo().currentStamina,this._costNum=t.getStamina();var e=c.getCampaignAPValueByStageId(t.getQuestStageMaster().getStageId());e&&(this._costNum=Math.ceil(this._costNum*e/1e3));var i=Math.max(1,this._costNum);this._sortiesMaxCount=(this._consumeApBaseNum-this._consumeApBaseNum%i)/i,this._questModel.getMaxDayPlayCount()>0&&(this._sortiesMaxCount=Math.min(this._sortiesMaxCount,l.getMaxDayPlayCount(this._questModel.getQuestStageMaster())-this._questModel.getTodayPlayCount()));var a=Math.max(0,Math.min(1,this._sortiesMaxCount));this.consumeApBaseNum.string=this._consumeApBaseNum,this.costNum.string=this._costNum,this.countViewSpace.initCommonCountView(this.redraw.bind(this),a,this._sortiesMaxCount),this._sortiesCount=this.countViewSpace.getCountNum(),this._updateReductionAfter()},redraw:function(){this._sortiesCount=this.countViewSpace.getCountNum(),this.costNum.string=this._costNum*this._sortiesCount,this._updateReductionAfter()},_onTapDecisionBtn:function(){var t=this._sortiesCount;this._root.requestStartBattle(this._questModel.userData._data.stageId,this._questModel,s.isAuto,t>1?function(){s.isAuto=!0,s.autoBattleResultDropItemMap=null,s.autoBattleResultEventItemMap=null,s.battleResultDropLimitOverCountMap={},s.maxAutoCount=t,s.autoCount=t}:null)},_closeBtnEvent:function(){this.close()},_updateReductionAfter:function(){this.consumeApAfterNum.string=this._consumeApBaseNum-this._costNum*this._sortiesCount}});cc._RF.pop()},{BattleData:"BattleData",CampaignUtils:"CampaignUtils",CommonButton:"CommonButton",CommonCountView:"CommonCountView",PopupBase:"PopupBase",QuestUtils:"QuestUtils",Singleton:"Singleton"}],AutoDisplayWindow:[function(t,e,i){"use strict";cc._RF.push(e,"0efc2UJXXBMoYNNh9StHn5E","AutoDisplayWindow");var a=t("Singleton"),n=t("SingletonConst"),o=t("WindowBase"),r=t("GameConst"),s=t("BattleData"),c=t("BattleConstants");cc.Class({extends:o,properties:{lapsedNum:cc.Label,scheduledLapsNum:cc.Label},beforeBtnNodeParent:void 0,autoBtnNode:void 0,speedBtnNode:void 0,initAutoDisplayWindow:function(t,e){this.lapsedNum.string=t,this.scheduledLapsNum.string=e;var i=cc.callFunc(this.checkAutoError.bind(this)),a=cc.repeatForever(cc.sequence(i,cc.fadeOut(.5),cc.delayTime(.1),cc.fadeIn(.5),cc.delayTime(.4)));this.windowNode.runAction(a),cc.director.getScene().getChildByName("Canvas").addChild(this.node,r.Z_ORDER.SYSTEM_WINDOW),this.autoBtnNode=s.UI_M.autoBtn.node,this.beforeBtnNodeParent=this.autoBtnNode.parent,this._reAddBtnNode(this.autoBtnNode,this.node),this.speedBtnNode=s.UI_M.speedBtn.node,this._reAddBtnNode(this.speedBtnNode,this.node),this.setActive(!0)},openAutoStopPopup:function(t){s.GM.gameRoot.poolManager.openAutoStopPopup(),t.stopPropagation()},closeAutoDisplayWindow:function(){this.node.off("touchstart",this.openAutoStopPopup,this),this._reAddBtnNode(this.autoBtnNode,this.beforeBtnNodeParent),this._reAddBtnNode(this.speedBtnNode,this.beforeBtnNodeParent)},setActive:function(t){this.windowNode.active=t,t?this.node.on("touchstart",this.openAutoStopPopup,this):this.node.off("touchstart",this.openAutoStopPopup,this)},checkAutoError:function(){a[n.ERROR_MANAGER].isError()&&(s.isAuto=!1,s.GM.gameRoot.poolManager.closeAutoRunWindow(),s.GM.gameRoot.poolManager.openAutoEndPopup(c.AUTO_END_POPUP_CONST.NETWORK_ERROR))},_reAddBtnNode:function(t,e){var i=t.convertToWorldSpaceAR(cc.v2(0,0)),a=e.convertToNodeSpaceAR(i);t.removeFromParent(!1),t.setPosition(a),e.addChild(t)}}),cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",GameConst:"GameConst",Singleton:"Singleton",SingletonConst:"SingletonConst",WindowBase:"WindowBase"}],AutoEndPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e06bdIGfoVNhZilUB41n6oU","AutoEndPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("BattleData"),t("BattleConstants")),r="\u9023\u7d9a\u51fa\u6483\u306e\u505c\u6b62",s="\u9023\u7d9a\u51fa\u6483\u306e\u505c\u6b62",c="\u9023\u7d9a\u51fa\u6483\u306e\u5b8c\u4e86",l="\u9023\u7d9a\u51fa\u6483\u306e\u5b8c\u4e86",u="\u6226\u95d8\u306b\u6557\u5317\u3057\u305f\u305f\u3081\u3001\u9023\u7d9a\u51fa\u6483\u3092\u505c\u6b62\u3057\u307e\u3059\u3002",h="\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u5207\u65ad\u3055\u308c\u307e\u3057\u305f\u3002\n\u9023\u7d9a\u51fa\u6483\u3092\u505c\u6b62\u3057\u307e\u3059\u3002",d="\u6307\u5b9a\u6226\u95d8\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f\u3002\n\u9023\u7d9a\u51fa\u6483\u3092\u89e3\u9664\u3057\u307e\u3059\u3002",p="\u30a2\u30a4\u30c6\u30e0\u306e\u6240\u6301\u6570\u4e0a\u9650\u306b\u9054\u3057\u305f\u305f\u3081\u3001\n\u9023\u7d9a\u51fa\u6483\u3092\u505c\u6b62\u3057\u307e\u3059\u3002";cc.Class({extends:a,properties:{titleLabel:cc.Label,mainLabel:cc.Label,okBtn:n},_popupType:null,_callback:null,initPopup:function(t,e){this._popupType=t,this._callback=e,this.setCloseCallBack(function(){this._popupType===o.AUTO_END_POPUP_CONST.DEFEAT&&this._callback&&this._callback()}.bind(this)),this._setParameter(),this._setButtonEvents()},_setParameter:function(){switch(this._popupType){case o.AUTO_END_POPUP_CONST.DEFEAT:this.titleLabel.string=r,this.mainLabel.string=u;break;case o.AUTO_END_POPUP_CONST.NETWORK_ERROR:this.titleLabel.string=s,this.mainLabel.string=h;break;case o.AUTO_END_POPUP_CONST.COMPLETE:this.titleLabel.string=c,this.mainLabel.string=d;break;case o.AUTO_END_POPUP_CONST.ITEM_LIMIT:this.titleLabel.string=l,this.mainLabel.string=p;break;default:this.titleLabel.string=s,this.mainLabel.string=h}},_setButtonEvents:function(){switch(this._popupType){case o.AUTO_END_POPUP_CONST.DEFEAT:this.okBtn.setTapEvent(function(){this._callback&&this._callback(),this.close()}.bind(this));break;case o.AUTO_END_POPUP_CONST.NETWORK_ERROR:case o.AUTO_END_POPUP_CONST.COMPLETE:case o.AUTO_END_POPUP_CONST.ITEM_LIMIT:default:this.okBtn.setTapEvent(function(){this.close()}.bind(this))}}});cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",CommonButton:"CommonButton",PopupBase:"PopupBase"}],AutoSelectConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"0bc88irGCdDUKHqsqrVDRhW","AutoSelectConfirmPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{okBtn:n,cancelBtn:n,checkBoxToggleArray:[cc.Toggle]},openAutoSelectConfirmPopup:function(t,e){this._initAutoSelectConfirmPopup(t,e),this.open()},_initAutoSelectConfirmPopup:function(t,e){this._setCheckBoxToggleArray(t),this._setButtonEvent(e)},_setCheckBoxToggleArray:function(t){for(var e=0;e<this.checkBoxToggleArray.length;e+=1)this.checkBoxToggleArray[e].isChecked=t[e]},_getCheckBoxToggleArray:function(){for(var t=[],e=0;e<this.checkBoxToggleArray.length;e+=1)t.push(this.checkBoxToggleArray[e].isChecked);return t},_setButtonEvent:function(t){this.okBtn.setTapEvent(function(){if(this.close(),t)return t(this._getCheckBoxToggleArray())}.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL)}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],AutoStopDropItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"c8724mV9uJK0q8ePmCS4rMV","AutoStopDropItemListView");var a=t("BattleData"),n=t("ListViewBase"),o=t("CommonScrollView"),r=(t("ResourceUtils"),t("ItemConst")),s=(t("RaidConst"),t("EventQuestConst")),c=cc.Enum({NORMAL:"normal",EVENT:"event"});cc.Class({extends:n,properties:{scrollView:o},_dropItemArrayMap:null,initAutoStopDropItemListView:function(){this._initDropItemData(),this.initListView(),this.thumbnailParentNode.getComponent(cc.Layout).updateLayout(),this.scrollView.scrollToPercentVertical(1,0,!0)},_initDropItemData:function(){if(this._dropItemArrayMap={},this._dropItemArrayMap[c.NORMAL]=[],this._dropItemArrayMap[c.EVENT]=[],a.autoBattleResultDropItemMap)for(var t in a.autoBattleResultDropItemMap)for(var e in a.autoBattleResultDropItemMap[t])for(var i in a.autoBattleResultDropItemMap[t][e])this._dropItemArrayMap[c.NORMAL].push(a.autoBattleResultDropItemMap[t][e][i]);if(a.autoBattleResultEventItemMap)for(var i in a.autoBattleResultEventItemMap[s.EVENT_TYPE.ITEM])this._dropItemArrayMap[c.EVENT].push(a.autoBattleResultEventItemMap[s.EVENT_TYPE.ITEM][i])},_setListContent:function(){for(var t=0;t<this._dropItemArrayMap[c.EVENT].length;t+=1)this._addThumbnail(this._dropItemArrayMap[c.EVENT][t],c.EVENT);for(var e=0;e<this._dropItemArrayMap[c.NORMAL].length;e+=1)this._addThumbnail(this._dropItemArrayMap[c.NORMAL][e],c.NORMAL)},_addThumbnail:function(t,e){var i=cc.instantiate(this.thumbnailPrefab).getComponent("ResultMatrixThumbnail");switch(i.initItemMatrixThumbnail(t),t.itemType===r.ITEM_TYPE.CHARACTER&&1===t.newFlg&&i.setNew(!0),e){case c.EVENT:i.setAddReward();break;case c.NORMAL:}this.thumbnailParentNode.addChild(i.node)}});cc._RF.pop()},{BattleData:"BattleData",CommonScrollView:"CommonScrollView",EventQuestConst:"EventQuestConst",ItemConst:"ItemConst",ListViewBase:"ListViewBase",RaidConst:"RaidConst",ResourceUtils:"ResourceUtils"}],AutoStopPopup:[function(t,e,i){"use strict";cc._RF.push(e,"65300eL3KFPxoB0E+G6ovjM","AutoStopPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("BattleData");cc.Class({extends:a,properties:{currentNum:cc.Label,remainingNum:cc.Label,cancelBtn:n,decisionBtn:n,autoStopDropItemListViewParentNode:cc.Node,autoStopDropItemListViewPrefab:cc.Prefab},_autoStopDropItemListView:null,openAutoStopPopup:function(){if(o.GM.gameRoot.poolManager.setAutoRunWindowActive(!1),this._setParameter(),!1===o.now_paused){var t=o.GM.soundManager;t.playSE(o.RM.soundResourceList.PauseBtn),o.GM.gameRoot.tapEffectManager.hideTapEffect(),cc.director.pause(),o.now_paused=!0,t.togglePauseInBattle(!0)}this.setCloseCallBack(function(){o.UI_M.action_resume(),o.GM.gameRoot.poolManager.setAutoRunWindowActive(!0)}),this._setButtonEvents(),this.open(this._initAutoStopDropItemListView.bind(this))},_setParameter:function(){this.currentNum.string=o.maxAutoCount-o.autoCount,this.remainingNum.string=o.autoCount},_setButtonEvents:function(){this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.decisionBtn.setTapEvent(function(){this.setCloseCallBack(function(){o.isAuto=!1,o.UI_M.action_resume(),o.GM.gameRoot.poolManager.closeAutoRunWindow()}),this.close()}.bind(this))},_initAutoStopDropItemListView:function(){this._autoStopDropItemListView||(this._autoStopDropItemListView=cc.instantiate(this.autoStopDropItemListViewPrefab).getComponent("AutoStopDropItemListView"),this.autoStopDropItemListViewParentNode.addChild(this._autoStopDropItemListView.node),this._autoStopDropItemListView.initAutoStopDropItemListView())}}),cc._RF.pop()},{BattleData:"BattleData",CommonButton:"CommonButton",PopupBase:"PopupBase"}],BPProgressView:[function(t,e,i){"use strict";cc._RF.push(e,"68266qC6AJC5IJeT8JdQts/","BPProgressView");var a=t("Singleton"),n=t("CommonButton"),o=t("PopupUtils"),r=t("CommonUtils"),s=t("ResourceUtils"),c=t("StaticResourceConst");cc.Class({extends:cc.Component,properties:{valueLabel:cc.Label,remainLabel:cc.Label,progressBarParent:cc.Node,progressMaxAnimation:cc.Animation,recoveryBtn:n},_userBasicData:null,_iValue:0,onLoad:function(){this._userBasicData=a.dao.userBasicData,this.recoveryBtn.setTapEvent(this._onTapRecoveryBtn.bind(this))},_onTapRecoveryBtn:function(){if(this._iValue>=this._userBasicData.getMaxBattlePoint())return o.openSimpleMessageWindow("\u3059\u3067\u306bBP\u306f\u6700\u5927\u72b6\u614b\u3067\u3059");var t=r.getRoot(),e=cc.instantiate(s.getResource(c.BP_RECOVERY_POPUP_PREFAB_PATH)).getComponent("BpRecoveryPopup");e.openBpRecoveryPopup(t.requestUseRecoveryItem.bind(t)),e.setCloseCallBack(this.reload.bind(this))},reload:function(){this._userBasicData=a.dao.userBasicData},redraw:function(){this._userBasicData||this.reload(),this._userBasicData=a.dao.userBasicData;var t=this._userBasicData.getCurrentBattlePointInfo();this._drawBattlePoint(t.currentValue),this._drawRemainSec(t.remainSec),this._drawBpProgressBar(),this._switchBpProgressBarAnimation()},_drawBattlePoint:function(t){this._iValue=t,this.valueLabel.string=t+"/"+this._userBasicData.getMaxBattlePoint()},_drawBpProgressBar:function(){for(var t=0;t<this.progressBarParent.children.length;t+=1)this.progressBarParent.children[t].active=t+1<=this._iValue},_switchBpProgressBarAnimation:function(){this.progressBarParent.children[this.progressBarParent.children.length-1].active&&!this.progressMaxAnimation.getAnimationState(this.progressMaxAnimation.getClips()[0].name).isPlaying?this.progressMaxAnimation.play():!this.progressBarParent.children[this.progressBarParent.children.length-1].active&&this.progressMaxAnimation.getAnimationState(this.progressMaxAnimation.getClips()[0].name).isPlaying&&this.progressMaxAnimation.stop()},_drawRemainSec:function(t){if(this.remainLabel){var e=t%60,i=("00"+Math.floor(t/60)).slice(-2),a=("00"+e).slice(-2);this.remainLabel.string="\u3042\u3068 "+i+":"+a}}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],BackButton:[function(t,e,i){"use strict";cc._RF.push(e,"13b29+7up9KHbOpOi6h0uWK","BackButton");var a=t("CommonButton"),n=(t("Singleton"),t("CommonUtils"));cc.Class({extends:cc.Component,properties:{button:a,buttonOn:cc.Animation},_callback:null,onLoad:function(){this._backEventOnceFunc=null,this.button.setTapEvent(this._backEvent.bind(this),a.SE_NAME.CANCEL),this.button.setOverEvent(function(){this.buttonOn.node.active=!0}.bind(this),function(){this.buttonOn.node.active=!1}.bind(this))},getTapEvent:function(){return this.button.getTapEvent()},setTapEvent:function(t){this.button.setTapEvent(t,a.SE_NAME.CANCEL)},setTouchEnable:function(t){this.button.setTouchEnable(t)},_backEvent:function(){this._callback?this._callback(function(){n.getRoot().popScene()}):n.getRoot().popScene()},setCallback:function(t){this._callback=t}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",Singleton:"Singleton"}],BackgroundController:[function(t,e,i){"use strict";cc._RF.push(e,"5f6c2bOUvhADr1h2j+24CJL","BackgroundController");cc.Class({_backgroundView:null,setBackgroundView:function(t){this._backgroundView=t,this._backgroundView.initialize()},setPosition:function(t){this._backgroundView.setPosition(t)},changeRushMode:function(t){t?this._backgroundView.scaleIn():this._backgroundView.scaleOut()},addCharacterView:function(t,e){this._backgroundView.addCharacterView(t,e)},addTrapView:function(t,e){this._backgroundView.addTrapView(t,e)},addFrontTrapView:function(t){this._backgroundView.addFrontTrapView(t)}});cc._RF.pop()},{}],BackgroundView:[function(t,e,i){"use strict";cc._RF.push(e,"3dae7KyvyhE85QtIyj15FVl","BackgroundView");cc.Class({extends:cc.Component,properties:{spImageList:[cc.SpriteFrame]},_backgroundNode:null,_position:0,_nodeFarList:null,_nodeNearList:null,initialize:function(){this._initializeGroundNode(),this._initializeFar(),this._initializeNear(),this._position=0},setPosition:function(t){this._position=t},scaleIn:function(){cc.log(this.node.getPosition()),this.node.runAction(cc.scaleTo(.5,1.3))},scaleOut:function(){this.node.runAction(cc.scaleTo(.5,1))},addRushEffect:function(){},addCharacterView:function(t,e){this._backgroundNode.addChild(t,3+2*e)},addTrapView:function(t,e){this._backgroundNode.addChild(t,2+2*e)},addFrontTrapView:function(t){this._backgroundNode.addChild(t,50)},update:function(t){if(this._backgroundNode&&this._backgroundNode.setPosition(-this._position,0),this._nodeFarList&&this._nodeNearList){for(var e=.5*this._position,i=1680*parseInt((this._position-e)/1680),a=0;a<this._nodeFarList.length;a+=1)this._nodeFarList[a].setPosition(i+e+1680*a+500,0);var n=1680*parseInt(this._position/1680);for(a=0;a<this._nodeNearList.length;a+=1)this._nodeNearList[a].setPosition(n+1680*a+500,0)}},_initializeGroundNode:function(){this._backgroundNode=new cc.Node,this.node.addChild(this._backgroundNode)},_initializeFar:function(){this._nodeFarList=[];for(var t=0;t<2;t+=1){var e=new cc.Node;this._nodeFarList.push(e),e.addComponent(cc.Sprite).spriteFrame=this.spImageList[0],this._backgroundNode.addChild(e)}},_initializeNear:function(){this._nodeNearList=[];for(var t=0;t<2;t+=1){var e=new cc.Node;this._nodeNearList.push(e),e.addComponent(cc.Sprite).spriteFrame=this.spImageList[1],this._backgroundNode.addChild(e)}}});cc._RF.pop()},{}],BannerBtnView:[function(t,e,i){"use strict";cc._RF.push(e,"d5ffcgfglRKBo2OxD0bnpJZ","BannerBtnView");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{bannerImage:cc.Sprite,bannerBtn:a},_root:null,init:function(t,e,i){this._root=t,n.addSprite(this.bannerImage,n.getFileNameBanner(e)),this._bannerBtn(i)},_bannerBtn:function(t){this.bannerBtn.setTapEvent(function(){this._openBannerEvent(t)}.bind(this)),this.bannerBtn.enabled=!1},_openBannerEvent:function(t){cc.log("bannerEvent"),this._root.transitionBanner(t)}}),cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],BannerRollView:[function(t,e,i){"use strict";cc._RF.push(e,"76138/Gx9VEVaCwbz7GAPW0","BannerRollView");var a=t("LoopRollView"),n=(t("Singleton"),t("BannerBtnView"));cc.Class({extends:a,properties:{easeDuration:.5,bannerBtnPrefab:cc.Prefab,bannerIndicatorPrefab:cc.Prefab},_root:null,_startEasePosX:0,_endDiffEasePosX:0,_currentEaseTime:0,_currentDiffPosX:0,init:function(){this._startEasePosX=0,this._endDiffEasePosX=void 0,this._currentEaseTime=0,this._root=cc.director.getScene().getChildByName("Canvas").getComponent("HomeRoot");for(var t=this._root.bannerMasters,e=0;e<t.length;e++){var i=e,a=t[e].getFileName().split("."),o=cc.instantiate(this.bannerBtnPrefab);o.getComponent(n).init(this._root,a[0],i),this.content.addChild(o)}this._setIndicator(),this.setLoopRollChangeCallFunc(function(){this.redrawIndicator()}.bind(this))},redrawIndicator:function(){if(Array.isArray(this._bannerIndicatorArray)&&!(this._bannerIndicatorArray.length<=0)){for(var t=0;t<this._bannerIndicatorArray.length;t++)this._bannerIndicatorArray[t].getChildByName("IndicatorEnable").active=!1;this._bannerIndicatorArray[this.getSelectedNo()].getChildByName("IndicatorEnable").active=!0}},moveToLeft:function(){isNaN(this._endDiffEasePosX)&&(this._stopAutoLoopRoll(),this._startEasePosX=this._viewX,this._endDiffEasePosX=-this.pagingWidth,this._currentEaseTime=0,this._bMoveTo=!0)},moveToRight:function(){isNaN(this._endDiffEasePosX)&&(this._stopAutoLoopRoll(),this._startEasePosX=this._viewX,this._endDiffEasePosX=this.pagingWidth,this._currentEaseTime=0,this._bMoveTo=!0)},_easeOutQuint:function(t){return 1+--t*t*t*t*t},_adjustContentEasingTo:function(t){this._currentEaseTime+=t;var e=this._endDiffEasePosX;this._currentEaseTime>=this.easeDuration&&(this._currentEaseTime=this.easeDuration,this._endDiffEasePosX=void 0,this._iMoveX=0,this._bMoveTo=!1,this._startAutoLoopRoll()),this._viewX=e*this._easeOutQuint(this._currentEaseTime/this.easeDuration)+this._startEasePosX},_setIndicator:function(){var t=this.content.childrenCount;this._bannerIndicatorArray=[];for(var e=-25*(t-1)/2,i=0;i<t;i++){var a=cc.instantiate(this.bannerIndicatorPrefab);a.getChildByName("IndicatorEnable").active=!1,a.getChildByName("IndicatorBase").active=!0;var n=e+25*i;a.position=cc.v2(n,a.position.y),this.node.getChildByName("Indicator_group").addChild(a),this._bannerIndicatorArray.push(a)}this.redrawIndicator()}});cc._RF.pop()},{BannerBtnView:"BannerBtnView",LoopRollView:"LoopRollView",Singleton:"Singleton"}],BannerView:[function(t,e,i){"use strict";cc._RF.push(e,"b8499Km7IJH5J7kXVDTN783","BannerView");var a=t("CommonButton"),n=(t("CommonUtils"),t("BannerRollView"));t("LocalDataConst"),cc.Class({extends:cc.Component,properties:{bannerRollView:n,rightFrameBtn:a,leftFrameBtn:a},onLoad:function(){this.leftFrameBtn.setTapEvent(this._leftFrame.bind(this),a.SE_NAME.COUNT),this.rightFrameBtn.setTapEvent(this._rightFrame.bind(this),a.SE_NAME.COUNT)},_leftFrame:function(){this.bannerRollView.moveToLeft(),this.bannerRollView.redrawIndicator()},_rightFrame:function(){this.bannerRollView.moveToRight(),this.bannerRollView.redrawIndicator()}});cc._RF.pop()},{BannerRollView:"BannerRollView",CommonButton:"CommonButton",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst"}],BaseGameManager:[function(t,e,i){"use strict";cc._RF.push(e,"4ad5bmL095AwahlFA2GVsJr","BaseGameManager");var a=t("GameEffectQueue").GameEffectQueue,n=t("GameEffectQueue").EffectQuery,o=t("GameEffectQueue").EffectData,r=t("GameLoop").GameLoop,s=t("BattleData"),c=(t("GameRoot"),t("ActionController").ActionController),l=t("EnumTypes"),u=t("AbilityController").AbilityController,h=t("SoundManager"),d=t("ShaderController"),p=t("SkillController"),m=t("BattleFunction"),g=(t("BattleResult"),t("EquipmentController")),C=(t("CameraController"),t("BattleEventController"),t("Singleton")),f=t("BattleConstants"),E=(t("ResourceUtils"),t("CharacterConst")),T=t("MemoryManager"),S=cc.Class({gameRoot:null,effectQueue:null,loop:null,battleOBJ_Prefabs:null,actionController:null,abilityController:null,shaderController:null,skillController:null,equipmentController:null,soundManager:null,cameraController:null,battleEventController:null,ctor:function(){this.effectQueue=new a,this.actionController=new c,this.abilityController=new u,void 0!==C.soundManager?(this.soundManager=C.soundManager,C.soundManager.stopAll()):this.soundManager=new h,this.shaderController=new d,this.skillController=new p,this.equipmentController=new g},destroy:function(){},startGameManager:function(){this.clearBaseLayout(),this.createPlayerObject(),this.initLoop();s.GM;for(var t=0;t<s.ourUnitList.length;t++){var e=s.ourUnitList[t];this.equipmentController.initAllTimeBuff(e)}},clearBaseLayout:function(){cc.log("baseGM clearBaseLayout");var t=this.gameRoot.playerUnitLayout.children;if(t)for(var e=0;e<t.length;e++)t[e].destroy()},createPlayerObject:function(){for(var t=this.gameRoot.playerUnitLayout,e=this.battleOBJ_Prefabs.playerUnit,i=0;i<s.ourUnitList.length;i++){var a=s.ourUnitList[i],n=new cc.Node;n.parent=t,n.setPosition(128+256*i,0);var o=cc.instantiate(e);o.parent=n,n.zIndex=10-i,a.initBattleUnit(o),T.instance.localPrefabStore(e)}},initLoop:function(){this.loop=new r,this.loop.addAction(this.showBattleStartEffect,this.showStartUI),this.loop.addAction(this.showStartUI,this.showWaveStart),this.loop.addAction(this.showWaveStart,this.makeEnemy),this.loop.addAction(this.makeEnemy,this.showEnemy),this.loop.addAction(this.showEnemy,this.checkShowTurn),this.loop.addAction(this.checkShowTurn,this.showYourTurn,this.showEnemyTurn),this.loop.addAction(this.showYourTurn,this.checkWaveStart),this.loop.addAction(this.checkWaveStart,this.checkTurnStart),this.loop.addAction(this.checkTurnStart,this.createAction),this.loop.addAction(this.showEnemyTurn,this.checkTurnStart),this.loop.addAction(this.checkTurnStart,this.createAction),this.loop.addAction(this.createAction,this.playAction),this.loop.addAction(this.playAction,this.checkAfterAction),this.loop.addAction(this.checkAfterAction,this.createAction,this.checkTurnEnd,this.nextWaveProcess),this.loop.addAction(this.checkTurnEnd,this.checkShowTurn),this.loop.addAction(this.nextWaveProcess,this.sendTransactionProcess),this.loop.addAction(this.sendTransactionProcess,this.showWaveStart)},showBattleStartEffect:function(){var t=s.GM,e=new n;e.addAction(new o(null,s.UI_M.showBattleStart.bind(s.UI_M))),t.effectQueue.addQuery(e),t.loop.callNextAction()},showStartUI:function(){var t=new n("show_start_ui");s.UI_M.showStartUI(t),s.GM.showPlayerCard(t),s.GM.effectQueue.addQuery(t),s.GM.loop.callNextAction()},showPlayerCard:function(t){for(var e=0;e<s.ourUnitList.length;e++){s.ourUnitList[e].startCardShow(t,e)}},makeEnemy:function(){var t=new n("show_enemy"),e=new o(null,s.GM._createEnemy.bind(s.GM));t.addAction(e),s.GM.effectQueue.addQuery(t),s.GM.effectQueue.play(function(){s.GM.loop.callNextAction();for(var t=0;t<s.ourUnitList.length;t++)s.ourUnitList[t]})},_createEnemy:function(t,e){for(var i=this.battleOBJ_Prefabs.monsterUnit,a=this.battleOBJ_Prefabs.bossUnit,n=this.battleOBJ_Prefabs.monsterAvatar,o=(this.gameRoot.monsterUnitLayout,this.getCurEnemyList()),r=f.ENEMY_PARAMETER_POSITION[o.length],c=f.ENEMY_AVATAR_POSITION[o.length],l=f.ENEMY_AVATAR_SCALE[o.length],u=0;u<o.length;u++){var h=o[u],d=null;h.isBoss()?(d=cc.instantiate(a),T.instance.localPrefabStore(a)):(d=cc.instantiate(i),T.instance.localPrefabStore(i));var p=cc.instantiate(n);T.instance.localPrefabStore(n);var m=new cc.Node;m.parent=s.GM.gameRoot.enemyUnitLayout,m.setPosition(r[u]),d.parent=m,h.initBattleUnit(d,p),p.parent=s.GM.gameRoot.bgBattleNode,p.setPosition(c[u]),p.setScale(l[u]),p.zIndex=5-u}t()},showEnemy:function(){for(var t=s.GM,e=new n,i=t.getCurEnemyList(),a=0;a<i.length;a++){i[a].startCardShow(e,a)}t.effectQueue.addQuery(e),t.loop.callNextAction()},checkShowTurn:function(){var t=s.GM,e=null;e=s.isNowPlayerTurn?t.loop.nextAction():t.loop.nextAction(1);var i=new n,a={delayTime:.5};i.addAction(new o(a,s.UI_M.delayTime.bind(s.UI_M))),t.effectQueue.addQuery(i),t.effectQueue.play(function(){e()})},showYourTurn:function(){var t=s.GM,e=new n;e.addAction(new o(null,s.UI_M.showYourTurn.bind(s.UI_M))),t.effectQueue.addQuery(e),t.loop.callNextAction()},checkWaveStart:function(){var t=s.GM;!1===s.curWaveChecked&&(s.curWaveChecked=!0,t.updateTurnBuff(l.BuffEndType.WAVE_START),t.actionController.checkTriggerInGameLoop(l.TriggerType.WAVE_START),t.actionController.checkTriggerInGameLoop(l.TriggerType.BOSS_WAVE_START)),t.updateTurnBuff(l.BuffEndType.GENERAL_TURN_START),t.actionController.checkTriggerInGameLoop(l.TriggerType.GENERAL_TURN_START),t.actionController.executeQueryListToMainQueue(),t.loop.callNextAction()},checkTurnStart:function(){var t=s.GM;t.updateTurnBuff(l.BuffEndType.MY_TURN_START),t.actionController.checkTriggerInGameLoop(l.TriggerType.MY_TURN_START),t.updateTurnBuff(l.BuffEndType.ENEMY_TURN_START),t.actionController.checkTriggerInGameLoop(l.TriggerType.ENEMY_TURN_START),t.effectQueue.play(function(){for(var e=0;e<s.ourUnitList.length;e++){(a=s.ourUnitList[e]).isDead||!0!==s.isNowPlayerTurn||a.checkBuffAction(l.TriggerType.MY_TURN_START)}var i=t.getCurEnemyList();for(e=0;e<i.length;e++){var a;(a=i[e]).isDead||!1!==s.isNowPlayerTurn||a.checkBuffAction(l.TriggerType.MY_TURN_START)}t.actionController.executeQueryListToMainQueue(),s.isNowPlayerTurn?t.effectQueue.play(function(){t.loop.callNextAction()}):t.effectQueue.play(function(){t.loop.callNextAction(1)})})},createAction:function(){var t=s.GM;s.curActionData=t.actionController.createActionData(),t.effectQueue.play(function(){t.loop.callNextAction()})},playAction:function(){var t=s.GM,e=s.curActionData;null!==e&&null!==e.attacker&&e.attacker.doAction(),t.actionController.executeQueryListToMainQueue(),t.actionController.checkTriggerInGameLoop(l.TriggerType.ON_ATTACK_OUR_UNIT),t.actionController.checkTriggerInGameLoop(l.TriggerType.BE_ATTACKED_OUR_UNIT),t.actionController.checkTriggerInGameLoop(l.TriggerType.ON_KILL_ENEMY),t.actionController.checkTriggerInGameLoop(l.TriggerType.ON_SKILL_OUR_UNIT),t.actionController.checkTriggerInGameLoop(l.TriggerType.ON_SKILL_ENEMY_UNIT),t.actionController.checkTriggerInGameLoop(l.TriggerType.BE_ATTACKED_BY_ALL_TARGET_ATTACK),t.actionController.checkTriggerInGameLoop(l.TriggerType.BE_ATTACKED_COUNTER_IN_TURN),t.actionController.checkTriggerInGameLoop(l.TriggerType.BE_KILLED_OUR_UNIT),t.actionController.checkTriggerInGameLoop(l.TriggerType.ON_LESS_THAN_HP),t.actionController.checkTriggerInGameLoop(l.TriggerType.BE_CATCH_BAD_CONDITION),t.actionController.checkTriggerInGameLoop(l.TriggerType.ON_CATCH_BAD_CONDITION_ENEMY),t.actionController.executeQueryListToMainQueue(),t.effectQueue.play(function(){t.loop.callNextAction()})},playActionStartAnimation:function(){},playActionEndAnimation:function(){},checkAfterAction:function(){},checkTurnEnd:function(){var t=s.GM;s.curUnitIdx=0,t.updateTurnBuff(l.BuffEndType.MY_TURN_END),t.actionController.checkTriggerInGameLoop(l.TriggerType.MY_TURN_END),t.updateTurnBuff(l.BuffEndType.ENEMY_TURN_END),t.actionController.checkTriggerInGameLoop(l.TriggerType.ENEMY_TURN_END),t.actionController.executeQueryListToMainQueue(),s.isNowPlayerTurn?s.isNowPlayerTurn=!1:(s.isNowPlayerTurn=!0,t.turnEndProcess()),s.GM.getRemainTurnCount()<=0&&s.isNowPlayerTurn?(s.gameResult=l.GameResult.DRAW,s.GM.executeDraw()):s.GM.loop.callNextAction()},checkLastUnit:function(){for(var t=!0,e=!0,i=0;i<s.ourUnitList.length;i++){s.ourUnitList[i].isDead||(e=!1)}var a=s.GM.getCurEnemyList();for(i=0;i<a.length;i++){a[i].isDead||(t=!1)}return t?(s.gameResult=l.GameResult.PLAYER_WIN,!0):!!e&&(s.gameResult=l.GameResult.ENEMY_WIN,!0)},updateTurnBuff:function(t){s.GM;var e=[];t===l.BuffEndType.WAVE_START||t===l.BuffEndType.GENERAL_TURN_START||t===l.BuffEndType.GENERAL_TURN_END?e=(e=e.concat(Array.from(m.getUnitList(!s.isNowPlayerTurn)))).concat(Array.from(m.getUnitList(s.isNowPlayerTurn))):t===l.BuffEndType.MY_TURN_START||t===l.BuffEndType.MY_TURN_END?e=e.concat(Array.from(m.getUnitList(!s.isNowPlayerTurn))):t!==l.BuffEndType.ENEMY_TURN_START&&t!==l.BuffEndType.ENEMY_TURN_END||(e=e.concat(Array.from(m.getUnitList(s.isNowPlayerTurn))));for(var i=0;i<e.length;i++){e[i].updateAllBuff(t)}},showEnemyTurn:function(){var t=s.GM,e=new n;e.addAction(s.UI_M.showEnemyTurn.bind(s.UI_M)),t.effectQueue.addQuery(e),t.loop.callNextAction()},clearCurrentEnemy:function(){for(var t=s.GM.getCurEnemyList(),e=0;e<t.length;e++){t[e].destroyObjects()}},turnEndProcess:function(){var t=s.GM;s.GM.getRemainTurnCount()>0&&(s.cur_TurnCount++,s.UI_M.set_turn_label(s.cur_TurnCount)),t.updateTurnBuff(l.BuffEndType.GENERAL_TURN_END),t.actionController.checkTriggerInGameLoop(l.TriggerType.GENERAL_TURN_END);for(var e=0;e<s.ourUnitList.length;e++){(a=s.ourUnitList[e]).isDead||(a.checkBuffAction(l.TriggerType.GENERAL_TURN_END),a.beAttackCounterInTurn=0)}var i=t.getCurEnemyList();for(e=0;e<i.length;e++){var a;(a=i[e]).isDead||(a.checkBuffAction(l.TriggerType.GENERAL_TURN_END),a.beAttackCounterInTurn=0)}t.actionController.executeQueryListToMainQueue()},nextWaveProcess:function(){var t=s.GM;t.updateTurnBuff(l.BuffEndType.MY_TURN_END),t.actionController.checkTriggerInGameLoop(l.TriggerType.MY_TURN_END),t.updateTurnBuff(l.BuffEndType.ENEMY_TURN_END),t.actionController.checkTriggerInGameLoop(l.TriggerType.ENEMY_TURN_END),s.curUnitIdx=0,s.isNowPlayerTurn=!0,s.UI_M.set_wave_label(s.cur_waveCount,s.curBattleQuest.getMaxWaveCount()),t.turnEndProcess(),t.effectQueue.play(function(){t.loop.callNextAction()})},sendTransactionProcess:function(){var t=s.GM;t.sendBattleTransaction(function(e){t.loop.callNextAction()})},showWaveStart:function(){var t={};t.cur_wave_count=s.cur_waveCount,t.max_wave_count=s.curBattleQuest.getMaxWaveCount();var e,i=s.GM;m.chackBossWave()&&((e=new n).addAction(new o(t,s.UI_M.showBossBattle.bind(s.UI_M))),i.effectQueue.addQuery(e));m.chackBossWave()||0===s.cur_waveCount||((e=new n).addAction(new o(t,s.UI_M.showWaveStart.bind(s.UI_M))),i.effectQueue.addQuery(e));s.curUnitIdx=0,s.isNowPlayerTurn=!0,i.loop.callNextAction()},showYouwin:function(){},showGameOver:function(t,e){s.UI_M.stopAllBattleAnimation();var i=s.UI_M.gameOverNode.getChildByName("fadeNode");i.on("touchstart",function(t){t.stopPropagation()}),i.on("touchend",function(t){t.stopPropagation()}),i.color=cc.Color.BLACK,i.opacity=0,i.runAction(cc.sequence(cc.fadeTo(1/s.cur_GameSpeed,255),cc.callFunc(function(){var i=new n;i.addAction(s.UI_M.showGameOver.bind(s.UI_M)),t.addQuery(i),t.play(function(){e()})},this)))},sendBattleResult:function(t){},sendBattleRetire:function(t){},sendBattleTransaction:function(t){var e,i=m.makeBattleTransactionData();e=JSON.stringify(i),s.requestSaveBattleFunc?s.requestSaveBattleFunc(e,t):cc.error("\u4e2d\u65ad\u30c7\u30fc\u30bf\u4fdd\u5b58\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")},saveBattleSetting:function(t){var e=s.battleType;e!==l.BattleType.STORY_QUEST&&e!==l.BattleType.EVENT&&e!==l.BattleType.TOWER&&e!==l.BattleType.RAID||m.saveLastDeckData();var i=s.GM.soundManager,a=m.getBattleSpeedIdx(s.cur_GameSpeed)+1;C.UserService.updateSetting(i.bgmVolume,i.seVolume,i.voiceVolume,i.seMute,i.bgmMute,i.voiceMute,a,s.isSkillAuto,function(){cc.log("SoundSetting : \u901a\u4fe1\u5b8c\u4e86"),t()})},getCurEnemyList:function(){return m.getUnitList(!0)},resetBattleSession:function(){C.dao.battleSession&&(C.dao.battleSession=null),s.stageObjectData=null,s.sessionObjectData=null},getWaitRageUnit:function(){return!1},playWinVoice:function(){var t=_.sample(_.filter(m.getUnitList(!1),function(t){return!1===t.isDead}));m.playRandomBattleVoice(t.textMasterArray,E.TEXT_GROUP_TYPE.BATTLE.WIN)},playLoseVoice:function(){var t=s.latestDeadUnit;t||(t=_.sample(m.getUnitList(!1))),m.playRandomBattleVoice(t.textMasterArray,E.TEXT_GROUP_TYPE.BATTLE.LOSE)}});e.exports=S,cc._RF.pop()},{AbilityController:"AbilityController",ActionController:"ActionController",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleEventController:"BattleEventController",BattleFunction:"BattleFunction",BattleResult:"BattleResult",CameraController:"CameraController",CharacterConst:"CharacterConst",EnumTypes:"EnumTypes",EquipmentController:"EquipmentController",GameEffectQueue:"GameEffectQueue",GameLoop:"GameLoop",GameRoot:"GameRoot",MemoryManager:"MemoryManager",ResourceUtils:"ResourceUtils",ShaderController:"ShaderController",Singleton:"Singleton",SkillController:"SkillController",SoundManager:"SoundManager"}],BaseService:[function(t,e,i){"use strict";cc._RF.push(e,"7c7faUVpeNMGZNwmzvdK87J","BaseService");var a=t("Singleton"),n=t("SingletonConst"),o=t("LocalDataConst"),r=t("ErrorCode"),s=t("ViewUtils"),c=t("MissionUtils"),l=t("PaymentManager"),u=t("TextManager");cc.Class({_paymentManager:void 0,_textManager:void 0,_doRequestCallApi:function(){a.localData[o.REQUEST_QUEUE]&&a.localData[o.REQUEST_QUEUE].length>0?(a.localData[o.REQUEST_QUEUE].shift()(),a.localData[o.REQUEST_RUNNING]=!0):a.localData[o.REQUEST_RUNNING]=!1},_requestCallApi:function(t,e,i){this._checkRequestApiList(t)||(a.localData[o.REQUEST_API_LIST].push(t),s.addModalLayer(),a.localData[o.REQUEST_QUEUE]||(a.localData[o.REQUEST_QUEUE]=[]),a.localData[o.REQUEST_QUEUE].push(function(){a.ServiceManager.callAPI(t,e,function(e,l){return this._doRequestCallApi(),s.removeModalLayer(),a.localData[o.REQUEST_API_DEL_LIST].push(t),e?(this.isNoRetry(t)&&(e.retryAPI=void 0),this.isIgnoreError(t)&&(this._removeRequestApiList(),i)?i(e,void 0):a[n.ERROR_MANAGER].throwError(e.errorCode,e.retryAPI)):l.err?a[n.ERROR_MANAGER].throwError(l.status,void 0,l):l.isUserDisabled?a[n.ERROR_MANAGER].throwError(r.USER_DISABLED,void 0,void 0):l.isMaintenance?a[n.ERROR_MANAGER].throwError(r.MAINTENANCE,void 0,l):(l.finishedMissionCds&&c.noticeMissionUpdate(l.finishedMissionCds),this._removeRequestApiList(),i?i(void 0,l):void 0)}.bind(this))}.bind(this)),a.localData[o.REQUEST_RUNNING]||this._doRequestCallApi())},isNoRetry:function(t){return"sell"===t||"use"===t||"useRecoveryItem"===t||"equipmentExceedLimit"===t||"purchase"===t||"exchange"===t||"buyFurniture"===t||"gift"===t||"play"===t||"replay"===t||"decide"===t||"endBattle"===t||"questEndBattle"===t||"eventQuestEndBattle"===t||"endTowerBattle"===t||"raidEndBattle"===t},isIgnoreError:function(t){return"userUpdateSetting"===t},_checkRequestApiList:function(t){return a.localData[o.REQUEST_API_LIST].some(function(e){return e===t})},_removeRequestApiList:function(){a.localData[o.REQUEST_API_DEL_LIST].forEach(function(t){a.localData[o.REQUEST_API_LIST].forEach(function(e,i){t===e&&a.localData[o.REQUEST_API_LIST].splice(i,1)})})},_requestPayment:function(t,e,i){s.addModalLayer(),this._paymentManager||(this._paymentManager=new l(this._requestCallApi.bind(this))),this._paymentManager.request(t,e,function(t,e){return s.removeModalLayer(),i(t,e)})},_requestText:function(t,e,i,a,n){this._textManager||(this._textManager=new u(this._requestCallApi.bind(this))),this._textManager.request(t,e,i,a,n)}});cc._RF.pop()},{ErrorCode:"ErrorCode",LocalDataConst:"LocalDataConst",MissionUtils:"MissionUtils",PaymentManager:"PaymentManager",Singleton:"Singleton",SingletonConst:"SingletonConst",TextManager:"TextManager",ViewUtils:"ViewUtils"}],BaseUnitCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"c63352uGfxJm5tnlBbCVeYS","BaseUnitCtrl");var a=t("BattleData"),n=t("EnumTypes"),o=t("CommonFunction"),r=t("BattleUnit"),s=t("SpineEventInterpreter"),c=t("BuffEffectView"),l=t("BattleConstants"),u=t("BattleFunction"),h=cc.Class({extends:cc.Component,properties:{myBattleUnit:{default:null,type:r,serializable:!1,visible:!1},buffShowNode:cc.Node,hpGaugeBar:cc.ProgressBar,hpGaugeBarDanger:cc.ProgressBar,skillGaugeBar:cc.ProgressBar,elementIcon:cc.Sprite,rarityIcon:cc.Sprite,debugLabel:cc.Label,updateCallbacks:{default:[],type:Array,serializable:!1,visible:!1},timeCounter:{default:0,type:cc.Float,serializable:!1,visible:!1},showBuffIconList:{default:[],type:Array,serializable:!1,visible:!1},nowShowBuffIconList:{default:[],type:Array,serializable:!1,visible:!1},showBuffIdx:{default:0,type:cc.Integer,serializable:!1,visible:!1},nowPlayingDeath:{default:!1,serializable:!1,visible:!1},_buffEffectViewList:{default:[],type:Array,serializable:!1,visible:!1}},ctor:function(){this.updateCallbacks=[]},onLoad:function(){},delayWait:function(t,e){var i=e.delay;this.scheduleOnce(function(){t()},i)},startHpGaugeAction:function(t,e){var i=this,a=e.curHp,n=e.maxHp,r=e.targetTime,s=0;i.updateCallbacks.push(function e(c){s+=c,i.hpGaugeBar.progress=s/r,i.hpGaugeBar.progress=a/n*s/r;var l=Math.round(o.lerp(0,a,s/r));if(i.hpLabel&&(i.hpLabel.string=l),s>=r){i.hpGaugeBar.progress=a/n,i.hpLabel&&(i.hpLabel.string=a),t();var u=i.updateCallbacks.indexOf(e);i.updateCallbacks.splice(u,1)}})},setHp:function(t){cc.log("setHp need override")},playSetHp:function(t,e){var i=e.hp;this.setHp(i),t()},setSkillRate:function(t){cc.log("setSkillRate need override")},playSetSkillRate:function(t,e){var i=e.skillRate;this.setSkillRate(i),t()},playAttack:function(t,e){cc.log("playAttack need override")},playBeAttacked:function(t,e){cc.log("playBeAttacked need override")},play_AttackReturnToIdle:function(t,e){t()},play_SpineSkillReturnToIdle:function(t,e){t()},play_DamageToIdle:function(t,e){t()},playDead:function(t,e){cc.log("playDead need override")},playRevive:function(t,e){cc.log("playRevive need override"),t()},playScaleHide:function(t,e){t()},playScaleRestore:function(t,e){t()},playCardHide:function(t,e){t()},playCardRestore:function(t,e){t()},playSpineSkill:function(t,e){cc.log("playSpineSkill need override")},playSpineOnNode:function(t,e){var i=new cc.Node,n=i.addComponent(sp.Skeleton);i.parent=this.myBattleUnit.get_EffectShowNode(),n.skeletonData=a.RM.resourceList[e.resourceName],n.timeScale=a.cur_GameSpeed,i.setPosition(cc.v2(0,0)),n.setCompleteListener(function(e,i){t()}),n.setEventListener(function(t,e){if(0===e.data.name.indexOf("gr_se_")||0===e.data.name.indexOf("se_")){var i=u.getRefName(this.myBattleUnit.getId(),e.data.name);null!=a.RM.resourceList[i]&&a.GM.soundManager.playSE_skillSE(a.RM.resourceList[i])}}.bind(this)),n.setAnimation(0,e.animationName,!1)},playFullSpineSkill_UseEvent:function(t,e){var i=e.parentNode,n=e.fullSpineData,o=e.aniName,r=new cc.Node,c=r.addComponent(sp.Skeleton);if(c.skeletonData=n,c._skeleton&&c._skeleton.data&&c._skeleton.data.animations&&c._skeleton.data.animations.length)for(var l=0;l<c._skeleton.data.animations.length;l++)c._skeleton.data.animations[l].duration+=.1;c.timeScale=a.cur_GameSpeed,r.parent=i;var u=new Map;u.set("battleUnit",e.battleUnit),u.set("parentNode",i),u.set("fullSpineData",n),u.set("aniName",o),u.set("onEndDestroy",!0),u.set("main_spine",c),u.set("hitEffName",e.hitEffName),u.set("hitEffectAniName",e.hitEffectAniName),u.set("damageActionArr",e.damageActionArr);var h=new cc.Node,d=r.addComponent(s);h.parent=i,d.init(t,u)},playCannotAction:function(t,e){for(var i=e.moveNode,a=i.position,n=[],r=0;r<10;r++){var s=cc.v2(a.x+o.getRandomArbitrary(-10,10),a.y+o.getRandomArbitrary(-10,10)),c=cc.moveTo(.05,s);n.push(c)}n.push(cc.moveTo(.05,a)),n.push(cc.callFunc(t,this));var l=cc.sequence(n);i.runAction(l)},createBuffIcon:function(t){t.nodeIcon=new cc.Node,t.nodeIcon.addComponent(cc.Sprite).spriteFrame=t.spriteFrameIcon,t.nodeIcon.parent=this.buffShowNode,t.nodeIcon.setPosition(0,0);var e=new cc.Node;e.parent=t.nodeIcon,e.setPosition(-15,-15),e.opacity=150;var i=e.addComponent(cc.Label);i.string=String(t.endVal),i.fontSize=15,t.remainCountLabel=i,t.nodeIcon.active=!1,this.createBuffContinueAnimation(t)},checkRemove_buffIcon:function(t){null!==t.nodeIcon&&(t.nodeIcon.destroy(),t.nodeIcon=null),this.removeBuffContinueAnimation(t)},showBuffIcon:function(){for(var t in this.nowShowBuffIconList)this.nowShowBuffIconList[t].nodeIcon&&(this.nowShowBuffIconList[t].nodeIcon.active=!1);this.nowShowBuffIconList=[],this.showBuffIdx>=this.showBuffIconList.length&&(this.showBuffIdx=0);for(var e=0;e<l.SHOW_BUFF_ICON_NUMBER&&!(this.showBuffIdx>=this.showBuffIconList.length);e++){var i=this.showBuffIconList[this.showBuffIdx];i.nodeIcon&&(i.nodeIcon.setSiblingIndex(e),i.nodeIcon.active=!0,this.nowShowBuffIconList.push(i)),this.showBuffIdx+=1}},showFadeBuffIcon:function(){var t=cc.fadeTo(.25,0),e=cc.fadeTo(.25,255),i=cc.callFunc(this.showBuffIcon,this),a=cc.sequence(t,i,e);this.buffShowNode.runAction(a)},updateBuffIcon:function(t){this.showBuffIconList.length<=0||(this.showBuffIconList.length<=l.SHOW_BUFF_ICON_NUMBER?(this.showBuffIdx=0,this.showBuffIcon(),this.buffShowNode.opacity=255,this.timeCounter=0):(this.timeCounter+=t*a.cur_GameSpeed,this.timeCounter>l.SHOW_BUFF_ICON_TIME&&(this.showFadeBuffIcon(),this.timeCounter=0)))},createBuffContinueAnimation:function(t){if(this.checkContinueBuff(t)){var e,i=new c;e=this.myBattleUnit.isEnemy?a.UI_M.monsterEffectCenter:a.UI_M.effectCenter;var n=this.myBattleUnit.get_EffectShowNode();i.initBuffEffectView(t,e,n,this),this._buffEffectViewList.push(i)}},removeBuffContinueAnimation:function(t){if(this.checkContinueBuff(t))for(var e in this._buffEffectViewList)t.type==this._buffEffectViewList[e].buff.type&&(this._buffEffectViewList[e].removeBuffContinueNode(),this._buffEffectViewList.splice(e,1))},checkContinueBuff:function(t){switch(t.type){case n.BuffType.POISON:case n.BuffType.PARALYSIS:return!0;default:return!1}},playBuffContinueAnimation:function(){this._buffEffectViewList.length>0&&(this._buffEffectViewList[0].buffContinueAnimation.play().speed=a.cur_GameSpeed,this._buffEffectViewList.push(this._buffEffectViewList[0]),this._buffEffectViewList.shift())},checkIsPlayingBuffContinueAnimation:function(){var t=!1;for(var e in this._buffEffectViewList){var i=this._buffEffectViewList[e].buffContinueAnimation.getClips()[0].name;this._buffEffectViewList[e].buffContinueAnimation.getAnimationState(i).isPlaying&&(t=!0)}return t},setSpineActionIdleOrGroggy:function(t){},playCardFlip:function(t,e){},playCardFlipRestore:function(t,e){},onClickSkillBtn:function(){},update:function(t){},getAnimationAddName:function(){return""}});e.exports=h,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",BattleUnit:"BattleUnit",BuffEffectView:"BuffEffectView",CommonFunction:"CommonFunction",EnumTypes:"EnumTypes",SpineEventInterpreter:"SpineEventInterpreter"}],BattleAbility:[function(t,e,i){"use strict";cc._RF.push(e,"95b7eWAMiBEkZKAzQc2LFhG","BattleAbility");var a=t("BattleAction"),n=t("CharacterAbilityUtils"),o=cc.Class({properties:{_battleUnit:null,_abilityMain:null,_jsonTextData:null,_objectData:null,_battleActionList:null,actionList:{get:function(){return this.getBattleActionList()}}},_abilityId:0,_abilityName:null,_description:null,_triggerType:null,_triggerValue:null,_triggerConditionType:null,_triggerConditionValue:null,ctor:function(){this._battleUnit=arguments[0]},initWithCharacterModel:function(t,e,i){var o=n.getAbilityMainMasterByAbilityId(t);this._abilityId=t,this._abilityName=o.getName(),this._description=e.getAbilityShortTextByAbilityId(t,e.getAbilityLebelByIndex(i+1)),this._triggerType=o.getTriggerType(),this._triggerValue=o.getTriggerValue(),this._triggerConditionType=o.getTriggerConditionType(),this._triggerConditionValue=o.getTriggerConditionValue();var r=n.getAbilityEffectMasterArrayByAbilityIdAndLevel(t,e.getAbilityLebelByIndex(i+1));if(r){var s=[];for(var c in r)if(r.hasOwnProperty(c)){var l=new a(r[c]);l.jsonDataMode=!1,s.push(l)}this._battleActionList=s}},initWithJsonTextData:function(t){this._jsonTextData=t,this._abilityId=t.abilityId,this._abilityName=t.name,this._description=t.name,this._triggerType=t.triggerType,this._triggerValue=t.triggerValue,this._triggerConditionType=t.triggerConditionType,this._triggerConditionValue=t.triggerConditionValue;var e=this._jsonTextData.actionList;if(e){var i=new Array;for(var n in e){var o=e[n],r=new a(o);r.jsonDataMode=!0,i.push(r)}this._battleActionList=i}},initWithObjectData:function(t){this._objectData=t;var e=this._objectData.actionList;if(e){var i=new Array;for(var n in e){var o=e[n],r=new a(o);r.jsonDataMode=!0,i.push(r)}this._battleActionList=i}},getAbilityId:function(){return this._jsonTextData?this._jsonTextData.id:this._objectData?this._objectData.abilityId:this._abilityId},getAbilityName:function(){return this._abilityName?this._abilityName:this._jsonTextData?this._jsonTextData.abilityName:this._objectData?this._objectData.name:""},getDescription:function(){return this._description?this._description:this._jsonTextData?this._jsonTextData.description:(this._objectData,"")},getTriggerType:function(){return this._jsonTextData?this._jsonTextData.triggerType:this._objectData?this._objectData.triggerType:this._triggerType},getTriggerValue:function(){return this._jsonTextData?this._jsonTextData.triggerValue:this._objectData?this._objectData.triggerValue:this._triggerValue},getTriggerConditionType:function(){return this._jsonTextData?this._jsonTextData.triggerConditionType:this._objectData?this._objectData.triggerConditionType:this._triggerConditionType},getTriggerConditionValue:function(){return this._jsonTextData?this._jsonTextData.triggerConditionVal:this._objectData?this._objectData.triggerConditionVal:this._triggerConditionValue},getBattleActionList:function(){return this._battleActionList}});e.exports=o,cc._RF.pop()},{BattleAction:"BattleAction",CharacterAbilityUtils:"CharacterAbilityUtils"}],BattleAction:[function(t,e,i){"use strict";cc._RF.push(e,"1d0eerjAalC26D/uoUwuZkA","BattleAction");var a=cc.Class({properties:{jsonDataMode:!1,_data:null},ctor:function(){this._data=arguments[0]},getSkillId:function(){return this.jsonDataMode?this._data.skillId:this._data.getSkillId()},getIndex:function(){return this.jsonDataMode?this._data.index:this._data.getIndex()},getLevel:function(){return this.jsonDataMode?this._data.level:this._data.getLevel()},getText:function(){return this.jsonDataMode?this._data.text:this._data.getText()},getActionType:function(){return this.jsonDataMode?this._data.actionType:this._data.getActionType()},getEffectType:function(){return this.jsonDataMode?this._data.effectType:this._data.getEffectType()},getEffectValue:function(){return this.jsonDataMode?this._data.effectValue:this._data.getEffectValue()},getEffectLimit:function(){return this.jsonDataMode?this._data.effectLimit:this._data.getEffectLimit()},getEffectConditionType:function(){return this.jsonDataMode?this._data.effectConditionType:this._data.getEffectConditionType()},getEffectConditionValue:function(){return this.jsonDataMode?this._data.effectConditionValue:this._data.getEffectConditionValue()},getOccurrenceRate:function(){return this.jsonDataMode?this._data.occurrenceRate:this._data.getOccurrenceRate()},getSuccessRate:function(){return this.jsonDataMode?this._data.successRate:this._data.getSuccessRate()},getTargetType:function(){return this.jsonDataMode?this._data.targetType:this._data.getTargetType()},getTargetValue:function(){return this.jsonDataMode?this._data.targetValue:this._data.getTargetValue()},getEndType:function(){return this.jsonDataMode?this._data.endType:this._data.getEndType()},getEndValue:function(){return this.jsonDataMode?this._data.endValue:this._data.getEndValue()}});e.exports=a,cc._RF.pop()},{}],BattleBossUnit:[function(t,e,i){"use strict";cc._RF.push(e,"5820bqm90FCzJ10V+Y3Gn9T","BattleBossUnit");var a=t("BattleMonsterUnit"),n=t("BattleData"),o=t("BattleFunction"),r=t("CommonFunction"),s=t("BattleConstants"),c=t("MemoryManager");cc.Class({extends:a,spineRageFront:null,spineRageBack:null,isRageMode:!1,initBattleUnit:function(t,e){this.unitController=t.getComponent("BossUnitCtrl"),this.unitController.myBattleUnit=this,this.avatarController=e.getComponent("MonsterAvatarCtrl"),this.avatarController.myBattleUnit=this;var i=new cc.Node,a=i.addComponent(sp.Skeleton);a.skeletonData=this.unitObjectSpine,a.timeScale=n.cur_GameSpeed,i.parent=this.avatarController.mainUnitAdjustPos,i.setScale(0),i.setPosition(cc.v2(0,140)),i.zIndex=1,this.mainAvatar=a,c.instance.storeRes(a.skeletonData,sp.SkeletonData);var s=new cc.Node,l=s.addComponent(sp.Skeleton);l.skeletonData=n.RM.resourceList["download/monster/90101/spine/def/ef_raging_red"],s.parent=this.avatarController.mainUnitAdjustPos,s.setPosition(cc.v2(0,100)),s.zIndex=0,this.spineRageBack=l,c.instance.storeRes(l.skeletonData,sp.SkeletonData);var u=this.battleMonsterModel.getSpineScale();this.avatarController.mainUnitAdjustPos.setScale(cc.v2(u,u));var h=r.clamp(this.getAttribute()-1,0,n.UI_M.elementImages.length-1);this.unitController.elementIcon.spriteFrame=n.UI_M.elementImages[h],c.instance.storeRes(this.unitController.elementIcon.spriteFrame,cc.SpriteFrame),this.unitController.nameLabel.string="<outline color=#1b1b1b width=2>"+this.battleMonsterModel.getName()+"</outline>",o.readHitEffectEvent(this),this.initComplete=!0},isBoss:function(){return!0},getBaseAtk:function(){return this.isRageMode?2*this.battleMonsterModel.getBaseAtk():this.battleMonsterModel.getBaseAtk()},canUseSkill:function(t){return!(!this.isRageMode||this.isUsedSkill)||!!(t&&this.curSkillRate>=s.CANUSESKILL_SKILLRATE)},isWaittingRage:function(){return!(this.curHp<=0)&&(this.curHp/this.getMaxHp()<s.RAGE_MODE_RATIO&&!this.isRageMode)},getHitEffectAniNameFromMultiple:function(t){var e=t.getHitEffectAniName().split(",");return this.isRageMode?e[1]:e[0]}});cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",BattleMonsterUnit:"BattleMonsterUnit",CommonFunction:"CommonFunction",MemoryManager:"MemoryManager"}],BattleChara:[function(t,e,i){"use strict";cc._RF.push(e,"79764IObvVJa7FFy+76mUVf","BattleChara");var a=t("BattleData"),n=t("BattleEquipment"),o=(t("CharacterUtils"),cc.Class({properties:{_characterModel:null,_masterCharaCard:null,_objectData:null,level:0,curExp:0,_equipmentList:null,myEquipmentList:{get:function(){return null!=this._equipmentList?this._equipmentList:null}},isSupport:!1},ctor:function(){},initWithCharacterModel:function(t){this._characterModel=t,this.level=t.getLevel(),this.curExp=t.getCharacterExp(),this.skillLv=t.getSkillLevel(),this.initEquipmentList()},initWithObjectData:function(t){this._objectData=t,this.level=0,this.curExp=0,this.skillLv=t.skillAttack.skillLevel,this.initEquipmentList()},getCharaId:function(){return this._characterModel?this._characterModel.getCharacterId():this._objectData?this._objectData.characterId:0},getMaxHpChaCard:function(){if(this._characterModel)return this._characterModel.getTotalHp();if(this._objectData){var t=this._objectData.hp,e=0,i=this.myEquipmentList;for(var a in i){e+=i[a].getHp()}return t+e}return 0},getMaxHpChaCardExceptEquipEffect:function(){if(this._characterModel)return this._characterModel.getTotalHpExceptEquipEffect();if(this._objectData){var t=this._objectData.hp,e=0,i=this.myEquipmentList;for(var a in i){e+=i[a].getHp()}return t+e}return 0},getAtkChaCard:function(){if(this._characterModel)return this._characterModel.getTotalAtk();if(this._objectData){var t=this._objectData.atk,e=0,i=this.myEquipmentList;for(var a in i){e+=i[a].getAtk()}return t+e}return 0},getAtkChaCardExceptEquipEffect:function(){if(this._characterModel)return this._characterModel.getTotalAtkExceptEquipEffect();if(this._objectData){var t=this._objectData.atk,e=0,i=this.myEquipmentList;for(var a in i){e+=i[a].getAtk()}return t+e}return 0},getDefChaCard:function(){if(this._characterModel)return this._characterModel.getTotalDef();if(this._objectData){var t=this._objectData.def,e=0,i=this.myEquipmentList;for(var a in i){e+=i[a].getDef()}return t+e}return 0},getDefChaCardExceptEquipEffect:function(){if(this._characterModel)return this._characterModel.getTotalDefExceptEquipEffect();if(this._objectData){var t=this._objectData.def,e=0,i=this.myEquipmentList;for(var a in i){e+=i[a].getDef()}return t+e}return 0},getCharaName:function(){return this._characterModel?this._characterModel.getName():this._objectData?this._objectData.name:null},getCharaShortName:function(){return this._characterModel?this._characterModel.getShortName():null},getSkillId:function(){return this._objectData?this._objectData.skillId:this._characterModel?this._characterModel.getCharacterMainMaster().getSkillId():null},getAbilityIdList:function(){if(this._objectData)return this._objectData.abilityId;if(this._characterModel){var t=this._characterModel.getCharacterMainMaster().getAbilityGroupId();return this._characterModel.getAvailableAbilityId(t)}return null},getSupportAbilityIdList:function(){if(this._characterModel){var t=this._characterModel.getCharacterMainMaster().getSupportAbilityGroupId();return this._characterModel.getAvailableAbilityId(t)}return null},getSpineDirectoryPath:function(){return cc.log(this._characterModel),this._characterModel?this._characterModel.getSpineDirectoryPath():null},getSpineName:function(){return this._characterModel?this._characterModel.getSpineName():this._objectData?this._objectData.spineName:null},getSpineScale:function(){return this._objectData?this._objectData.spineScale:this._characterModel?this._characterModel.getCharacterMainMaster().getSpineScale():null},getNormalAttackData:function(){return this._characterModel?this._characterModel.getCharacterNormalAttackMaster():this._objectData?this._objectData.normalAttack:null},getCharaterModel:function(){return this._characterModel?this._characterModel:null},getMasterCharaCard:function(){return null==this._masterCharaCard&&(this._masterCharaCard=a.localJsonDataS.CharaCardData.json[this._characterModel.getCharacterId()]),this._masterCharaCard},getObjectData:function(){return this._objectData?this._objectData:null},getSkillData:function(){return this._objectData?this._objectData.skillAttack:null},getAbilityData:function(){return this._objectData?this._objectData.ability:null},getAttribute:function(){return this._characterModel?this._characterModel.getAttribute():this._objectData?this._objectData.attribute:null},getRarity:function(){return this._characterModel,this._characterModel.getRarity()},initEquipmentList:function(){var t=[];if(this._characterModel){var e=this._characterModel.getAvailableEquipmentWeaponModelList();if(e)for(var i=0;i<e.length;i++){var a=new n;a.initWithModel(e[i],this._characterModel),t.push(a)}var o=this._characterModel.getAvailableEquipmentProtectorModelList();if(o)for(i=0;i<o.length;i++){var r=new n;r.initWithModel(o[i],this._characterModel),t.push(r)}}this._equipmentList=t}}));e.exports=o,cc._RF.pop()},{BattleData:"BattleData",BattleEquipment:"BattleEquipment",CharacterUtils:"CharacterUtils"}],BattleConstants:[function(t,e,i){"use strict";cc._RF.push(e,"90cc276E8NJ85f+bwZaJliS","BattleConstants"),e.exports={ATTACK_EFFECT_POOL_AMOUNT:2,ABILITYCUTIN_MOVETO_Y_PLAYER:170,ABILITYCUTIN_MOVETO_Y_ENEMY:0,SHOW_ABILITY_WAITTIME:.5,CARD_FLUSH_WAITTIME:.1,BUFF_EFFECT_SHOW_WAITTIME:.5,BUFF_INVOKE_EFFECT_WAITTIME:.5,CANCEL_BUFF_EFFECT_WAITTIME:.5,ATTACK_SELF_EFFECT_WAITTIME:.5,ATTACK_TARGET_EFFECT_WAITTIME:.5,NORMAL_ATTACK_SPEED_RATIO:1,NORMAL_ATTACK_SPEED_RATIO_MONSTER:2,SUPPORT_CHARA_PARAMETER_RATIO:.5,BASE_DAMAGE_RANGE:.05,BASE_CRITICAL_CHANCE_RATE:.15,ATTACK_CRITICAL_PLUSRATE:1.3,UNISON_ATTACK_PLUSRATE:1.3,UNISON_ATTACK_BASE_RATIO:.5,ENEMY_ACTION_OCCURRENCERATE_MAX:1e3,BASE_TARGETING_WEIGHT:100,BATTLE_SPEED_NORMAL:1,BATTLE_SPEED_DOUBLE:2,BATTLE_SPEED_TRIPLE:3,SHOW_NOTICE_LABEL_WAITTIME:1.5,SUB_AVILITY_INDEX:2,SUPPORT_AVATAR_SCALE:.7,STARTSHOWCARD_DELAYTIME_PERSHOW:.2,HPFILL_EFFECT_TIME:.5,DEAD_FADEOUT_TIME:.75,SKILLRATE_MAX:100,CANUSESKILL_SKILLRATE:100,BASE_PLUS_SKILLRATE_PER_ATTACK:25,BASE_PLUS_SKILLRATE_PER_DAMAGE:15,BASE_UNISON_CHANCE:5,BUFF_POWER_MAX_PERCENTAGE:300,BUFF_POWER_MIN_PERCENTAGE:40,RAGE_MODE_RATIO:.5,LOWHP_RATIO:.5,BGM_FADEOUT_TIME_INSKILL:1.5,BGM_FADEIN_TIME_INSKILL:1,SHOW_DAMAGE_RANDOM_POS:70,SHOW_BUFF_ICON_NUMBER:5,SHOW_BUFF_ICON_TIME:2,SUBCAMERA_MONSTER_MOVEANDZOOM_TIME:.25,SUBCAMERA_MONSTER_ZOOM_RATIO:1.4,SUBCAMERA_MONSTER_ZOOM_CANMOVE_POSX_ABSOLUTE:284,SUBCAMERA_SKILLEVENT_MOVETO_TIME:.25,SUBCAMERA_SKILLEVENT_ZOOM_TIME:.25,SUBCAMERA_SKILLEVENT_ZOOM_RATIO:1.8,ENEMY_PARAMETER_POSITION:[[],[cc.v2(0,0)],[cc.v2(250,0),cc.v2(-250,0)],[cc.v2(0,0),cc.v2(-220,0),cc.v2(220,0)],[cc.v2(90,0),cc.v2(-90,-50),cc.v2(270,-50),cc.v2(-270,0)],[cc.v2(0,-50),cc.v2(-360,-50),cc.v2(360,-50),cc.v2(-180,0),cc.v2(180,0)]],ENEMY_AVATAR_POSITION:[[],[cc.v2(0,-20)],[cc.v2(250,-20),cc.v2(-250,-20)],[cc.v2(0,-20),cc.v2(-400,-20),cc.v2(400,-20)],[cc.v2(150,-20),cc.v2(-150,-20),cc.v2(450,-20),cc.v2(-450,-20)],[cc.v2(0,-20),cc.v2(-500,-20),cc.v2(500,-20),cc.v2(-250,20),cc.v2(250,20)]],ENEMY_AVATAR_SCALE:[[],[1.25],[1.25,1.25],[1.25,1.25,1.25],[1.25,1.25,1.25,1.25],[1.25,1.25,1.25,1,1]],AUTO_END_POPUP_CONST:{DEFEAT:1,NETWORK_ERROR:2,COMPLETE:3,ITEM_LIMIT:4},BACKGROUND_DIRECTORY:"download/bg/",BACKGROUND_SPINE_ANIM_NAME:"animation",EXTENSION_GROUPING_PATTERN:/(.+)(\.[^.]+$)/,BACKGROUND_EXPANSION_RATE:1.07,SPINE_EFFECT_RES_FOLDER:"_old/spine/inGame/forEffect/",GENERAL_SPINE:"download/character/common/spine/",GENERAL_SE:"download/character/common/se/",BGM_RES_FOLDER:"download/sound/bgm/",BATTLE_UI_FOLDER_NAME:"prefab/inGame/battleEffect",BATTLE_OBJ_FOLDER_NAME:"prefab/inGame/battleOBJ",BATTLE_SE_FOLDER_NAME:"sound/ingame",SPRITE_FRAME_RES_FOLDER:"image/inGame/"},cc._RF.pop()},{}],BattleDataLoader:[function(t,e,i){"use strict";cc._RF.push(e,"f052apIbEdODLH6V7V+Wjbr","BattleDataLoader");var a=t("BattleChara"),n=t("BattleDeckUnit"),o=t("BattleData"),r=t("BattlePlayerUnit"),s=t("TowerBattlePlayerUnit"),c=t("BattleBossUnit"),l=t("RaidBattleBossUnit"),u=t("ArenaPlayerUnit"),h=t("BattleMonsterUnit"),d=t("EnumTypes"),p=t("ResourceManager"),m=t("TutorialGameManager"),_=t("QuestGameManager"),g=t("TowerGameManager"),C=t("TowerBattleMonsterUnit"),f=t("TowerBattleBossUnit"),E=t("RaidGameManager"),T=t("ArenaGameManager"),S=t("BattleFunction"),R=t("CommonFunction"),A=t("BattleQuest"),b=t("CommonUtils"),M=t("DeckUtils"),v=t("Singleton"),P=t("LocalDataConst"),I=(t("GameConst"),t("DeckConst")),y=t("QuestUtils"),N=t("TutorialUtils"),B=t("BattleConstants"),L=t("Async");cc.Class({extends:cc.Component,_loadResourceMaxCount:0,_callbackToLoadedResource:null,_resourceLoadTasks:void 0,initBattleDataLoader:function(t){this._callbackToLoadedResource=t,this._loadResourceMaxCount=0,this._resourceLoadTasks=[],this.initBattleData(),N.isTutorialEnded()?o.battleType===d.BattleType.TOWER?o.GM=new g:o.battleType===d.BattleType.RAID?o.GM=new E:o.battleType===d.BattleType.ARENA_PVP?o.GM=new T:o.GM=new _:o.GM=new m;var e=o.battleType;if(e===d.BattleType.STORY_QUEST||e===d.BattleType.EVENT||e===d.BattleType.TOWER||e===d.BattleType.RAID){this.makeBattleDeckUnitFromMyDeck();var i=o.battleLoadType;i===d.BattleLoadType.QUEST_START_BATTLE||i===d.BattleLoadType.FROM_CONTINUE?this.loadBattledata():i===d.BattleLoadType.FROM_BATTLE_TRANSACTION&&this.loadBattleFromTransactionData()}else e===d.BattleType.ARENA_PVP&&this.makeBattleDeckUnitFromArenaDeck();this.setBattleUnit(),this.loadBattleResource(),L.waterfall(this.getResourceLoadTask())},initBattleData:function(){o.now_paused=!1,o.now_skill_skip_mode=this.loadSkillSkipMode(),o.cur_waveCount=0,o.cur_TurnCount=1,o.playerUseItemCount=0,o.playerSkillCount=0,o.playerNormalAttackCount=0,o.playerTotalDamageGiven=0,o.playerTotalDamageTaken=0,o.isNowPlayerTurn=!0,o.curWaveChecked=!1,o.curUnitIdx=0,o.gameResult=d.GameResult.NOT_END,o.battleResult=null,o.spMaxAnimStateArray=[],o.currentTurnAbilityCount=0,o.latestDeadUnit=null;var t=v.dao[v.USER];o.beforePlayerExp=t.userData.getExp(),o.beforePlayerLv=t.getLevel();var e=t.getBattleSpeed()-1;e=R.clamp(e,0,2),o.cur_GameSpeed=S.getBattleSpeed(e),o.isSkillAuto=t.getIsSkillAuto()},loadSkillSkipMode:function(){return!b.loadLocalStorage(P.LOCAL_STORAGE_KEY.PLAY_SKILL_ANIMATION,!0,P.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},makeBattleDeckUnitFromMyDeck:function(){var t=null;t=o.sessionObjectData?M.createDeckMap()[o.sessionObjectData.deckType][o.sessionObjectData.deckId]:M.createDeckMap()[I.DECK_TYPE.QUEST][v.localData[P.SELECT_QUEST_DECK_ORDER]],o.myDeckUnitList=this.makeBattleDeckUnit(t)},makeBattleDeckUnitFromArenaDeck:function(){var t=M.createDeckMap()[I.DECK_TYPE.PVP][v.localData[P.SELECT_PVP_DECK_ORDER]];o.myDeckUnitList=this.makeBattleDeckUnit(t)},makeBattleDeckUnit:function(t){var e=[];for(var i in t){var o,r=t[i],s=r[I.ROLE_TYPE.MAIN],c=r[I.ROLE_TYPE.SUPPORT],l=new a;if(l.initWithCharacterModel(s),c){var u=new a;u.initWithCharacterModel(c),u.isSupport=!0,o=new n(l,u,parseInt(i))}else o=new n(l,null,parseInt(i));e.push(o)}return e},loadBattledata:function(){var t=new A,e=o.stageObjectData;t.initWithObjectData(e),o.curBattleQuest=t},loadBattleFromTransactionData:function(){var t=o.savedBattleTransaction.battleData;o.battleType=t.battleType,o.cur_waveCount=t.cur_waveCount,o.cur_TurnCount=t.cur_TurnCount,o.playerUseItemCount=t.playerUseItemCount,o.playerSkillCount=t.playerSkillCount,o.playerNormalAttackCount=t.playerNormalAttackCount,o.playerTotalDamageGiven=t.playerTotalDamageGiven,o.playerTotalDamageTaken=t.playerTotalDamageTaken,o.isNowPlayerTurn=t.isNowPlayerTurn,o.curWaveChecked=t.curWaveChecked,o.curUnitIdx=t.curUnitIdx;var e=new A,i=o.stageObjectData;e.initWithObjectData(i);var a=i.stageId,n=v.dao.userQuests.find(function(t){return a===t.userData.getStageId()});n&&(o.selectedQuestModel=n),o.curBattleQuest=e,cc.log(o)},setBattleUnit:function(){var t=o.myDeckUnitList,e=[];switch(o.battleType){case d.BattleType.TOWER:t.forEach(function(t){var i=new s(t);e.push(i)},this);break;default:t.forEach(function(t){var i=new r(t);e.push(i)},this)}o.ourUnitList=e;var i=new p;if(o.RM=i,o.battleType===d.BattleType.STORY_QUEST||o.battleType===d.BattleType.EVENT||o.battleType===d.BattleType.TOWER||o.battleType===d.BattleType.RAID){var a=o.curBattleQuest,n=[];a.getWaves().forEach(function(t){var e=[];t.enemies.forEach(function(i){var a;if(cc.log("BattleDataLoader wave = ",t),i.isBoss)switch(o.battleType){case d.BattleType.TOWER:a=new f(i);break;case d.BattleType.RAID:a=new l(i);break;default:a=new c(i)}else a=o.battleType===d.BattleType.TOWER?new C(i):new h(i);a.isEnemy=!0,e.push(a)},this),n.push(e)},this),o.enemyUnitList=n,this.setResourceLoadTask(function(t){i.loadPlayerResource(o.ourUnitList,function(){t()})}),this.setResourceLoadTask(function(t){i.loadMonsterResource(o.enemyUnitList,function(){t()})}),this.setResourceLoadTask(this._loadNormalWavaBgm.bind(this)),this.setResourceLoadTask(this._loadBossWavaBgm.bind(this))}else if(o.battleType===d.BattleType.ARENA_PVP){var m=[],_=(n=[],o.savedArenaData,o.pvpBattlePlayerData.playerDetail.deck[I.DECK_TYPE.PVP]),g="";for(var E in _){g=E;break}var T=_[g],S=this.makeBattleDeckUnit(T);cc.log(S),S.forEach(function(t){var e=new u(t);e.isEnemy=!0,n.push(e)},this),m.push(n),o.enemyUnitList=m,this.setResourceLoadTask(function(t){i.loadPlayerResource(o.ourUnitList,function(){t()})}),this.setResourceLoadTask(function(t){i.loadPlayerResource(n,function(){t()})}),this.setResourceLoadTask(function(t){i.loadStageObject(a,function(){t()})})}else cc.log("resource load error")},loadBattleResource:function(){this.setResourceLoadTask(this._loadBattleEffect.bind(this)),this.setResourceLoadTask(this._loadBattleObject.bind(this)),this.setResourceLoadTask(this._loadBattleSe.bind(this)),this.setResourceLoadTask(this._loadBattleImage.bind(this))},getLoadResourceMaxCount:function(){return this._loadResourceMaxCount},setResourceLoadTask:function(t){this._loadResourceMaxCount+=1,this._resourceLoadTasks.push(function(e){t(function(){return this._callbackToLoadedResource(1),e()}.bind(this))}.bind(this))},getResourceLoadTask:function(){return this._resourceLoadTasks},_loadBattleEffect:function(t){o.RM.loadBattleEffect_Prefab(function(e){e.forEach(function(t){o.battleEffect_Prefabs[t.name]=t},this),t()}.bind(this))},_loadBattleObject:function(t){o.RM.loadBattleObject_Prefab(function(e){e.forEach(function(t){o.battleOBJ_Prefabs[t.name]=t},this),t()}.bind(this))},_loadBattleSe:function(t){o.RM.loadBattleSE_Dir(function(e,i){for(var a in e){var n=e[a],r=i[a].split("/"),s=r[r.length-1];o.RM.soundResourceList[s]=n}t()})},_loadBattleImage:function(t){if(o.stageObjectData){var e=y.getStageMasterByStageId(o.stageObjectData.stageId).getBackground();".spine"===e.match(B.EXTENSION_GROUPING_PATTERN)[2]?o.RM.loadBackgroundSpine(e,function(i){o.RM.resourceBackground[B.BACKGROUND_DIRECTORY+e]=i,t()}):o.RM.loadBackground(e,function(i){o.RM.resourceBackground[B.BACKGROUND_DIRECTORY+e]=i,t()})}else t()},_loadNormalWavaBgm:function(t){var e=y.getStageMasterByStageId(o.stageObjectData.stageId).getNormalWaveBgm();o.RM.loadBattleBgm(e,function(e){o.RM.normalWaveBgm=e,t()})},_loadBossWavaBgm:function(t){var e=y.getStageMasterByStageId(o.stageObjectData.stageId).getBossWaveBgm();o.RM.loadBattleBgm(e,function(e){o.RM.bossWaveBgm=e,t()})}});cc._RF.pop()},{ArenaGameManager:"ArenaGameManager",ArenaPlayerUnit:"ArenaPlayerUnit",Async:"Async",BattleBossUnit:"BattleBossUnit",BattleChara:"BattleChara",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleDeckUnit:"BattleDeckUnit",BattleFunction:"BattleFunction",BattleMonsterUnit:"BattleMonsterUnit",BattlePlayerUnit:"BattlePlayerUnit",BattleQuest:"BattleQuest",CommonFunction:"CommonFunction",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckUtils:"DeckUtils",EnumTypes:"EnumTypes",GameConst:"GameConst",LocalDataConst:"LocalDataConst",QuestGameManager:"QuestGameManager",QuestUtils:"QuestUtils",RaidBattleBossUnit:"RaidBattleBossUnit",RaidGameManager:"RaidGameManager",ResourceManager:"ResourceManager",Singleton:"Singleton",TowerBattleBossUnit:"TowerBattleBossUnit",TowerBattleMonsterUnit:"TowerBattleMonsterUnit",TowerBattlePlayerUnit:"TowerBattlePlayerUnit",TowerGameManager:"TowerGameManager",TutorialGameManager:"TutorialGameManager",TutorialUtils:"TutorialUtils"}],BattleData:[function(t,e,i){"use strict";cc._RF.push(e,"dc5a5tA8WRFaqlpl9B8qzVG","BattleData");var a=t("EnumTypes"),n={battleLoadType:a.BattleLoadType.QUEST_START_BATTLE,sessionObjectData:null,requestSaveBattleFunc:null,requestEndBattleFunc:null,requestRetireBattleFunc:null,transitionEndBattleFunc:null,requestAutoBattleFunc:null,characterStatus:null,enemyStatus:null,battleType:a.BattleType.STORY_QUEST,stageObjectData:null,cur_waveCount:0,cur_TurnCount:1,playerUseItemCount:0,playerSkillCount:0,playerNormalAttackCount:0,playerTotalDamageGiven:0,playerTotalDamageTaken:0,isNowPlayerTurn:!0,curWaveChecked:!1,curUnitIdx:0,curEnemyActionCount:0,curBattleQuest:null,selectedQuestModel:null,savedBattleTransaction:null,pvpBattlePlayerData:void 0,myDeckUnitList:null,ourUnitList:null,enemyUnitList:null,latestDeadUnit:null,battleEffect_Prefabs:[],battleOBJ_Prefabs:[],GM:null,UI_M:null,RM:null,isLocalMode:!1,now_paused:!1,now_skill_skip_mode:!1,cur_GameSpeed:1,isSkillAuto:0,beforePlayerExp:0,beforePlayerLv:0,curActionData:null,lastDeckDataOBJ:null,gameResult:a.GameResult.NOT_END,battleResult:null,autoBattleResultDropItemMap:null,autoBattleResultEventItemMap:null,battleResultDropLimitOverCountMap:{},testDataOBJ:null,isAuto:!1,autoCount:0,maxAutoCount:0,currentTurnAbilityCount:0,spMaxAnimStateArray:[],raidBattleSession:void 0,maxTurnCount:0,isQueueStop:!1};e.exports=n,cc._RF.pop()},{EnumTypes:"EnumTypes"}],BattleDeckUnit:[function(t,e,i){"use strict";cc._RF.push(e,"25adaJxZF1BqYskgffrkXmx","BattleDeckUnit");var a=t("BattleChara"),n=t("BattleConstants"),o=cc.Class({properties:{mainChara:{default:null,type:a,serializable:!1},supportChara:{default:null,type:a,serializable:!1},deckPosition:0},ctor:function(){this.mainChara=arguments[0],this.supportChara=arguments[1],this.deckPosition=isNaN(arguments[2])?0:arguments[2]},getMaxHp_DeckUnit:function(){var t=this.mainChara.getMaxHpChaCard();if(this.supportChara){var e=this.supportChara.getMaxHpChaCard();return t+Math.floor(e*n.SUPPORT_CHARA_PARAMETER_RATIO)}return t},getMaxHp_DeckUnitExceptEquipEffect:function(){var t=this.mainChara.getMaxHpChaCardExceptEquipEffect();if(this.supportChara){var e=this.supportChara.getMaxHpChaCard();return t+Math.floor(e*n.SUPPORT_CHARA_PARAMETER_RATIO)}return t},getAtk_DeckUnit:function(){var t=this.mainChara.getAtkChaCard();if(this.supportChara){var e=this.supportChara.getAtkChaCard();return t+Math.floor(e*n.SUPPORT_CHARA_PARAMETER_RATIO)}return t},getAtk_DeckUnitExceptEquipEffect:function(){var t=this.mainChara.getAtkChaCardExceptEquipEffect();if(this.supportChara){var e=this.supportChara.getAtkChaCard();return t+Math.floor(e*n.SUPPORT_CHARA_PARAMETER_RATIO)}return t},getDef_DeckUnit:function(){var t=this.mainChara.getDefChaCard();if(this.supportChara){var e=this.supportChara.getDefChaCard();return t+Math.floor(e*n.SUPPORT_CHARA_PARAMETER_RATIO)}return t},getDef_DeckUnitExceptEquipEffect:function(){var t=this.mainChara.getDefChaCardExceptEquipEffect();if(this.supportChara){var e=this.supportChara.getDefChaCard();return t+Math.floor(e*n.SUPPORT_CHARA_PARAMETER_RATIO)}return t}});e.exports=o,cc._RF.pop()},{BattleChara:"BattleChara",BattleConstants:"BattleConstants"}],BattleEffectThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"49d8fflGEpHfZviLnToPyiV","BattleEffectThumbnail");var a=t("BattleData"),n=t("MemoryManager"),o=cc.Class({extends:cc.Component,properties:{buffImageSprite:cc.Sprite,buffNameLabal:cc.Label,prefixLabal:cc.Label,turnLabel:cc.Label,SuffixLabel:cc.Label},initBattleEffectThumbnail:function(t){this.setBuffNameLabel(t),this.setTurnLabel(t),this.buffImageSprite.spriteFrame=a.GM.gameRoot.poolManager.getSpriteFrameIcon(t),n.instance.storeRes(this.buffImageSprite.spriteFrame,cc.SpriteFrame)},setBuffNameLabel:function(t){this.buffNameLabal.string=t.getBuffName()},setTurnLabel:function(t){this.prefixLabal.string=t.getBuffRemainDescPrefix(),this.turnLabel.string=t.getBuffRemainDescValue(),this.SuffixLabel.string=t.getBuffRemainDescSuffix()}});e.exports=o,cc._RF.pop()},{BattleData:"BattleData",MemoryManager:"MemoryManager"}],BattleEquipment:[function(t,e,i){"use strict";cc._RF.push(e,"53551KGYglO6rqxQuxNTUej","BattleEquipment");var a=t("BattleAction"),n=(t("EquipmentUtils"),cc.Class({properties:{_equipmentModel:null,_jsonTextData:null,_objectData:null,_battleActionList:null,actionList:{get:function(){return this.getBattleActionList()}}},ctor:function(){},initWithModel:function(t,e){this._equipmentModel=t;var i=this._equipmentModel.getEquipmentEffectMaster();if(i){var n=new Array;for(var o in i){var r=i[o];if((0!==r.getBoostType()||this._equipmentModel.getAttribute()!==e.getAttribute())&&(1!==r.getBoostType()||this._equipmentModel.getAttribute()===e.getAttribute())){var s=new a(r);s.jsonDataMode=!1,n.push(s)}}this._battleActionList=n}},initWithJsonTextData:function(t){this._jsonTextData=t;var e=this._jsonTextData.actionList;if(e){var i=new Array;for(var n in e){var o=e[n],r=new a(o);r.jsonDataMode=!0,i.push(r)}this._battleActionList=i}},initWithObjectData:function(t){this._objectData=t;var e=this._objectData.actionList;if(e){var i=new Array;for(var n in e){var o=e[n],r=new a(o);r.jsonDataMode=!0,i.push(r)}this._battleActionList=i}},getEquipmentId:function(){return this._jsonTextData?this._jsonTextData.id:this._objectData?this._objectData.id:this._equipmentModel?this._equipmentModel.getEquipmentMainMaster().getEquipmentId():void 0},getEquipmentName:function(){return this._jsonTextData?this._jsonTextData.equipmentName:this._objectData?this._objectData.equipmentName:this._equipmentModel?this._equipmentModel.getEquipmentName():void 0},getDescription:function(){return this._jsonTextData?this._jsonTextData.description:this._objectData?this._objectData.description:this._equipmentModel?this._equipmentModel.getEquipmentText():void 0},getTriggerType:function(){return this._jsonTextData?this._jsonTextData.triggerType:this._objectData?this._objectData.triggerType:this._equipmentModel?this._equipmentModel.getEquipmentMainMaster().getTriggerType():void 0},getTriggerValue:function(){return this._jsonTextData?this._jsonTextData.triggerVal:this._objectData?this._objectData.triggerVal:this._equipmentModel?this._equipmentModel.getEquipmentMainMaster().getTriggerValue():void 0},getTriggerConditionType:function(){return this._jsonTextData?this._jsonTextData.triggerConditionType:this._objectData?this._objectData.triggerConditionType:this._equipmentModel?this._equipmentModel.getEquipmentMainMaster().getTriggerConditionType():void 0},getTriggerConditionValue:function(){return this._jsonTextData?this._jsonTextData.triggerConditionVal:this._objectData?this._objectData.triggerConditionVal:this._equipmentModel?this._equipmentModel.getEquipmentMainMaster().getTriggerConditionValue():void 0},getBattleActionList:function(){return this._battleActionList},getHp:function(){if(this._objectData)return this._objectData.hp},getAtk:function(){if(this._objectData)return this._objectData.atk},getDef:function(){if(this._objectData)return this._objectData.def}}));e.exports=n,cc._RF.pop()},{BattleAction:"BattleAction",EquipmentUtils:"EquipmentUtils"}],BattleEventController:[function(t,e,i){"use strict";cc._RF.push(e,"486e4HYPaVDkoUln9PG6b05","BattleEventController");var a=t("BattleData"),n=t("CommonFunction"),o=cc.Class({extends:cc.Component,properties:{updateCallbacks:{default:[],serializable:!1,visible:!1}},changeBgmVolume:function(t,e){var i=a.GM.soundManager,o=this,r=e.targetVolume,s=e.fadeTime,c=i.bgmVolume,l=0;o.updateCallbacks.push(function t(e){l+=e*a.cur_GameSpeed;var u=n.lerp(c,r,l/s);if(i.setBGMTempVol(u),l>=s){var h=o.updateCallbacks.indexOf(t);o.updateCallbacks.splice(h,1)}}),t()},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e--)this.updateCallbacks[e](t)}});e.exports=o,cc._RF.pop()},{BattleData:"BattleData",CommonFunction:"CommonFunction"}],BattleFunction:[function(t,e,i){"use strict";cc._RF.push(e,"4c95aJDlPJGCI81FfhMkkEk","BattleFunction");var a=t("BattleData"),n=t("CommonFunction"),o=t("EnumTypes"),r=t("CommonUtils"),s=t("Singleton"),c=t("BattleConstants"),l=t("GameConst"),u=t("ResourceUtils");function h(t){return t?a.enemyUnitList[a.cur_waveCount]:a.ourUnitList}e.exports={getUnitList:h,getTargetList:function(t,e,i,n,r,s,c){s||(s=null);var l=[],u=String(e.getTargetValue()).split("."),h=void 0!==e.actionType?e.actionType:e.getActionType(),d=i.getAttribute();if(t===o.TargetRange.ENEMY_ONE){var p=[];for(var m in r)!(S=r[m]).isDead&&S.initComplete&&p.push(S);var g=0;if(u.length>0&&(g=u[0]),s){var C,f=s.getTriggerType();if(f===o.TriggerType.ON_NORMAL_ATTACK){if(C=a.curActionData.target[0])return C.isDead||l.push(C),l}else if(f===o.TriggerType.BE_ATTACK_AFTER_TIMING)return(C=a.curActionData.attacker)&&(C.isDead||(l.push(C),p=_.reject(p,function(t){return t===C}),g--)),g>0&&(l=l.concat(this.getTargetListUsingChance(p,!0,g))),l}l=h!==o.ActionType.ATTACK||i.isEnemy?h===o.ActionType.HEAL||h===o.BuffType.REGENERATION?this.getTargetListUsingChanceByHeal(p,!0,g):this.getTargetListUsingChance(p,!0,g):this.getTargetListUsingChanceByAtk(p,!0,g,d)}else if(t===o.TargetRange.ENEMY_ALL)for(var m in r)!(S=r[m]).isDead&&S.initComplete&&l.push(S);else if(t===o.TargetRange.OUR_SIDE_ONE){for(var m in p=[],n)!(S=n[m]).isDead&&S.initComplete&&p.push(S);g=0,u.length>0&&(g=u[0]),l=h===o.ActionType.HEAL||h===o.BuffType.REGENERATION?this.getTargetListUsingChanceByHeal(p,!1,g):this.getTargetListUsingChance(p,!1,g)}else if(t===o.TargetRange.OUR_SIDE_ALL)for(var m in n)!(S=n[m]).isDead&&S.initComplete&&l.push(S);else if(t===o.TargetRange.ME)i.isDead||l.push(i);else if(t===o.TargetRange.OUR_SIDE_DEAD_ONE){for(var m in p=new Array,n)(S=n[m]).isDead&&S.initComplete&&p.push(S);g=0,u.length>0&&(g=u[0]),l=this.getTargetListUsingChance(p,!1,g)}else if(t===o.TargetRange.OUR_SIDE_DEAD_ALL)for(var m in n)(S=n[m]).isDead&&S.initComplete&&l.push(S);else if(t===o.TargetRange.OUR_SIDE_BY_ELEMENT){for(var m in n)if(!(S=n[m]).isDead&&!1!==S.initComplete)for(var E in u){var T=Number(u[E]);S.getAttribute()===T&&l.push(S)}}else if(t===o.TargetRange.ENEMY_SIDE_DEAD_ONE){for(var m in p=[],r)(S=r[m]).isDead&&S.initComplete&&p.push(S);g=0,u.length>0&&(g=u[0]),l=this.getTargetListUsingChance(p,!0,g)}else if(t===o.TargetRange.ENEMY_SIDE_DEAD_ALL)for(var m in r)(S=r[m]).isDead&&S.initComplete&&l.push(S);else if(t===o.TargetRange.ENEMY_SIDE_BY_ELEMENT){for(var m in r)if(!(S=r[m]).isDead&&!1!==S.initComplete)for(var E in u)T=Number(u[E]),S.getAttribute()===T&&l.push(S)}else if(t===o.TargetRange.ENEMY_SIDE_BY_CHARA_TYPE)for(var m in r){var S;if(!(S=r[m]).isDead&&!1!==S.initComplete)for(var E in u)u[E],l.push(i)}else if(t===o.TargetRange.ME_BY_ELEMENT)for(var E in u)T=Number(u[E]),!i.isDead&&i.initComplete&&(c?i.getSupportAttribute()===T&&l.push(i):i.getAttribute()===T&&l.push(i));else if(t===o.TargetRange.ME_BY_CHARA_TYPE)for(var E in u)u[E],l.push(i);return l},getTargetListUsingChance:function(t,e,i){var a=[];void 0===e&&(e=!0),void 0===i&&(i=1);var n=[];for(var o in t){var r=t[o].getTargetWeight(e);a.push(r)}for(var s=0;s<i&&!(a.length<=0);s++){var c=this.getRandomIdxFromChanceList(a),l=t[c];n.push(l),t.splice(c,1),a.splice(c,1)}return n},getRandomIdxFromChanceList:function(t){var e,i=0,a=0;if(t.length<=1)return 0;for(var o=0;o<t.length;o++)a+=t[o];e=n.getRandomInt(1,a+1);for(var r=0;r<t.length;r++)if(e<=(i+=t[r]))return r;return 0},getTargetListUsingChanceByAtk:function(t,e,i,a){var n=[];void 0===e&&(e=!0),void 0===i&&(i=1);var o=[];for(var r in t){var s=t[r].getTargetWeight(e);n.push(s)}for(var l=0;l<i&&!(n.length<=0);l++){var u=t[p=this.getRandomIdxFromChanceList(n)];o.push(u),t.splice(p,1),n.splice(p,1)}var h=[];for(var r in t){var d=t[r];!(this.getAttributeRatio(a,d.getAttribute())>0)||d.getTargetWeight(e)<c.BASE_TARGETING_WEIGHT||h.push(d)}if(0===h.length)return o;for(var r in n=[],h)s=(d=h[r]).getTargetWeight(e),n.push(s);for(var r in o){if(n.length<=0)break;var p,m=o[r];if(!(this.getAttributeRatio(a,m.getAttribute())>0||m.getTargetWeight(e)>c.BASE_TARGETING_WEIGHT))u=h[p=this.getRandomIdxFromChanceList(n)],o[r]=u,h.splice(p,1),n.splice(p,1)}return o},getTargetListUsingChanceByHeal:function(t,e,i){void 0===i&&(i=1);var a=[];t.sort(function(t,e){return t.curHp/t.getMaxHp()-e.curHp/e.getMaxHp()});for(var n=0;n<i&&!(t.length<=0);n++)a.push(t[0]),t.splice(0,1);return a},objectToEncryptString:function(t,e){var i=JSON.stringify(t);return r.encrypt(i,e)},getAddExpOnUser:function(t){var e=a.beforePlayerExp;return t.exp-e},getAddExpOnChara:function(t,e){var i=t.getCharaterModel().getCharacterCd(),a=t.deckUnit.mainChara,n=null;for(var o in e){var r=e[o];r.characterCd===i&&(n=r)}if(n){var s=a.curExp;return n.exp-s}return 0},getNextExpPlayer:function(t){var e=s.dao.UserMainMasters.find(function(e){return e.getUserLevel()===t});return e?e.getNextLevelExp():0},getCurExpOnZeroBasePlayer:function(t,e){var i=s.dao.UserMainMasters.find(function(t){return t.getUserLevel()===e});return i?t-i.getTotalExp():t},getNextExpChara:function(t,e){var i=s.dao.CharacterLevelMasters.find(function(i){return i.getExpType()===e&&i.getLevel()===t});return i?i.getNextLevelExp():0},getCurExpOnZeroBaseChara:function(t,e,i){var a=s.dao.CharacterLevelMasters.find(function(t){return t.getExpType()===i&&t.getLevel()===e});return a?t-a.getTotalExp():t},checkAliveUnitExist:function(t){var e=this.getUnitList(t);for(var i in e)if(!e[i].isDead)return!0;return!1},checkAliveOtherUnitExist:function(t){var e=this.getUnitList(t.isEnemy);for(var i in e){var a=e[i];if(!a.isDead&&a!==t)return!0}return!1},getBattleSpeedIdx:function(t){return t===c.BATTLE_SPEED_NORMAL?0:t===c.BATTLE_SPEED_DOUBLE?1:t===c.BATTLE_SPEED_TRIPLE?2:0},getBattleSpeed:function(t){return 0===t?c.BATTLE_SPEED_NORMAL:1===t?c.BATTLE_SPEED_DOUBLE:2===t?c.BATTLE_SPEED_TRIPLE:c.BATTLE_SPEED_NORMAL},saveLastDeckData:function(){var t={};a.sessionObjectData&&(t.lastDeckId=a.sessionObjectData.deckId);var e=[],i=this.getUnitList(!1);for(var n in i){var o=i[n],r={},s=o.deckUnit.mainChara.getCharaterModel();if(s&&(r.mainCharaCd=s.getCharacterCd()),o.deckUnit.supportChara){var c=o.deckUnit.supportChara.getCharaterModel();c&&(r.supportCharaCd=c.getCharacterCd())}r.useSkill=o.useSkillMode,e.push(r)}t.battleUnitData=e,a.lastDeckDataOBJ=t,cc.log(a.lastDeckDataOBJ)},checkUseSkillWithLastDeckData:function(t){var e=a.lastDeckDataOBJ;if(!e)return!1;if(cc.log("start check lastDeckData"),a.sessionObjectData&&a.sessionObjectData.deckId!==e.lastDeckId)return cc.log("deckId wrong"),!1;var i=e.battleUnitData;if(t.length!==i.length)return cc.log("length wrong"),!1;for(var n in t){var o=t[n];if(!(c=i[n]))return!1;var r=o.deckUnit.mainChara.getCharaterModel();if(r&&r.getCharacterCd()!==c.mainCharaCd)return cc.log("main changed"),!1;if(c.mainCharaCd=r.getCharacterCd(),o.deckUnit.supportChara){var s=o.deckUnit.supportChara.getCharaterModel();if(s&&s.getCharacterCd()!==c.supportCharaCd)return cc.log("support changed"),!1}}for(var n in cc.log("all info is safe and same"),t){o=t[n];var c=i[n];o.useSkillMode=c.useSkill}},checkFirstLiveUnit:function(t){for(var e=this.getUnitList(t.isEnemy),i=0;i<e.length;i++){var a=e[i];if(!a.isDead)return a===t}return!1},checkLastLiveUnit:function(t){for(var e=this.getUnitList(t.isEnemy),i=e.length-1;i>=0;i--){var a=e[i];if(!a.isDead)return a===t}return!0},linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t},easeInOutQuadSet:function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},getRefName:function(t,e){return 0===e.lastIndexOf("gr_",0)?e:String(t)+"_"+e},readHitEffectEvent:function(t){var e=a.RM,i=t.myNormalAttack,n=i.getHitEffectName(),o=i.getHitEffectAniName(),r=this.getRefName(t.getId(),n),s=e.getResource(r),c=[],l=100;cc.log(r),cc.log(s);var u={};for(var h in null!=s&&(u=s.skeletonJson.animations),cc.log(u),u){var d=u[h];if(h===o){var p=d.events;for(var m in p)"evt_damage"===(C=p[m]).name&&(l>=(f=parseInt(C.string))?c.push(f):l>0&&c.push(l))}}t.nAttackDamageRatioList=c;var _=t.mySkill;if(_){c=[],l=100,n=_.getHitEffectName(),o=t.getHitEffectAniNameFromMultiple(_),cc.log(n),cc.log(o);var g=this.getRefName(t.getId(),n);for(var h in s=e.getResource(g),cc.log("skillHitEffRefName = "+g),cc.log("hitEffSpine",s),u={},null!=s&&(u=s.skeletonJson.animations),u)if(d=u[h],h===o)for(var m in p=d.events){var C,f;"evt_damage"===(C=p[m]).name&&(l>=(f=parseInt(C.string))?c.push(f):l>0&&c.push(l))}t.skillDamageRatioList=c}},getAttributeRatio:function(t,e){return t===l.ATTRIBUTE.FIRE&&e===l.ATTRIBUTE.WATER?-.25:t===l.ATTRIBUTE.WATER&&e===l.ATTRIBUTE.THUNDER?-.25:t===l.ATTRIBUTE.THUNDER&&e===l.ATTRIBUTE.WIND?-.25:t===l.ATTRIBUTE.WIND&&e===l.ATTRIBUTE.FIRE?-.25:t===l.ATTRIBUTE.FIRE&&e===l.ATTRIBUTE.WIND?.25:t===l.ATTRIBUTE.WATER&&e===l.ATTRIBUTE.FIRE?.25:t===l.ATTRIBUTE.THUNDER&&e===l.ATTRIBUTE.WATER?.25:t===l.ATTRIBUTE.WIND&&e===l.ATTRIBUTE.THUNDER?.25:t===l.ATTRIBUTE.LIGHT&&e===l.ATTRIBUTE.DARK?.25:t===l.ATTRIBUTE.DARK&&e===l.ATTRIBUTE.LIGHT?.25:0},setQuestStartBattleData:function(t,e,i,n,s){var c=r.decrypt(e,i.sessionId),l=JSON.parse(c);a.battleType=o.BattleType.STORY_QUEST,a.isQueueStop=!1,a.battleLoadType=o.BattleLoadType.QUEST_START_BATTLE,a.stageObjectData=l,a.sessionObjectData=i,a.selectedQuestModel=t,n&&(a.requestSaveBattleFunc=n.requestSaveBattleFunc,a.requestEndBattleFunc=n.requestEndBattleFunc,a.requestRetireBattleFunc=n.requestRetireBattleFunc,a.transitionEndBattleFunc=n.transitionEndBattleFunc,a.requestAutoBattleFunc=n.requestAutoBattleFunc),a.characterStatus=s},setQuestReStartBattleData:function(t,e,i,n,s){var c=r.decrypt(e,i.sessionId),l=JSON.parse(c);a.battleType=o.BattleType.STORY_QUEST,a.isQueueStop=!1,a.battleLoadType=o.BattleLoadType.FROM_BATTLE_TRANSACTION,a.stageObjectData=l,a.savedBattleTransaction=t,a.sessionObjectData=i,a.requestSaveBattleFunc=n.requestSaveBattleFunc,a.requestEndBattleFunc=n.requestEndBattleFunc,a.requestRetireBattleFunc=n.requestRetireBattleFunc,a.transitionEndBattleFunc=n.transitionEndBattleFunc,a.characterStatus=s},setEventStartBattleData:function(t,e,i,n,s){var c=r.decrypt(e,i.sessionId),l=JSON.parse(c);a.battleType=o.BattleType.EVENT,a.isQueueStop=!1,a.battleLoadType=o.BattleLoadType.QUEST_START_BATTLE,a.stageObjectData=l,a.sessionObjectData=i,a.selectedQuestModel=t,n&&(a.requestSaveBattleFunc=n.requestSaveBattleFunc,a.requestEndBattleFunc=n.requestEndBattleFunc,a.requestRetireBattleFunc=n.requestRetireBattleFunc,a.transitionEndBattleFunc=n.transitionEndBattleFunc,a.requestAutoBattleFunc=n.requestAutoBattleFunc),a.characterStatus=s},setEventReStartBattleData:function(t,e,i,n,s){var c=r.decrypt(e,i.sessionId),l=JSON.parse(c);a.battleType=o.BattleType.EVENT,a.isQueueStop=!1,a.battleLoadType=o.BattleLoadType.FROM_BATTLE_TRANSACTION,a.stageObjectData=l,a.savedBattleTransaction=t,a.sessionObjectData=i,a.requestSaveBattleFunc=n.requestSaveBattleFunc,a.requestEndBattleFunc=n.requestEndBattleFunc,a.requestRetireBattleFunc=n.requestRetireBattleFunc,a.transitionEndBattleFunc=n.transitionEndBattleFunc,a.characterStatus=s},setTowerStartBattleData:function(t,e,i,n,s,c){var l=r.decrypt(e,i.sessionId),u=JSON.parse(l);a.battleType=o.BattleType.TOWER,a.isQueueStop=!1,a.stageObjectData=u,a.sessionObjectData=i,a.selectedQuestModel=t,n&&(a.requestSaveBattleFunc=n.requestSaveBattleFunc,a.requestEndBattleFunc=n.requestEndBattleFunc,a.requestRetireBattleFunc=n.requestRetireBattleFunc,a.transitionEndBattleFunc=n.transitionEndBattleFunc,a.requestAutoBattleFunc=n.requestAutoBattleFunc),a.characterStatus=s,c?(a.battleLoadType=o.BattleLoadType.FROM_CONTINUE,a.enemyStatus=c.enemyStatus):(a.battleLoadType=o.BattleLoadType.QUEST_START_BATTLE,a.enemyStatus=[])},setRaidStartBattleData:function(t,e,i,n,s,c,l){var u=r.decrypt(e,s.sessionId),h=JSON.parse(u);a.battleType=o.BattleType.RAID,a.isQueueStop=!1,a.battleLoadType=o.BattleLoadType.QUEST_START_BATTLE,a.stageObjectData=h,a.sessionObjectData=s,a.selectedQuestModel=t,a.raidBattleSession=i,a.maxTurnCount=n,c&&(a.requestSaveBattleFunc=c.requestSaveBattleFunc,a.requestEndBattleFunc=c.requestEndBattleFunc,a.requestRetireBattleFunc=c.requestRetireBattleFunc,a.transitionEndBattleFunc=c.transitionEndBattleFunc,a.requestAutoBattleFunc=c.requestAutoBattleFunc),a.characterStatus=l},createSessionObjectData:function(t,e,i,a){return{sessionId:t,stageId:e,deckId:i,deckType:a}},createBattleCallbacks:function(t,e,i,a,n){return{requestSaveBattleFunc:t,requestEndBattleFunc:e,requestRetireBattleFunc:i,transitionEndBattleFunc:a,requestAutoBattleFunc:n}},setPvPStartBattleData:function(t,e,i){a.battleType=o.BattleType.ARENA_PVP,a.isQueueStop=!1,a.pvpBattlePlayerData=t,a.sessionObjectData=e,i&&(a.requestEndBattleFunc=i.requestEndBattleFunc,a.requestRetireBattleFunc=i.requestRetireBattleFunc,a.transitionEndBattleFunc=i.transitionEndBattleFunc)},createPvPSessionObjectData:function(t){return{sessionId:t}},createPvPBattleCallbacks:function(t,e,i){return{requestEndBattleFunc:t,requestRetireBattleFunc:e,transitionEndBattleFunc:i}},makeBattleTransactionData:function(){var t={},e={};e.battleType=a.battleType,a.isQueueStop=!1,e.cur_waveCount=a.cur_waveCount,e.cur_TurnCount=a.cur_TurnCount,e.playerUseItemCount=a.playerUseItemCount,e.playerSkillCount=a.playerSkillCount,e.playerNormalAttackCount=a.playerNormalAttackCount,e.playerTotalDamageGiven=a.playerTotalDamageGiven,e.playerTotalDamageTaken=a.playerTotalDamageTaken,e.isNowPlayerTurn=a.isNowPlayerTurn,e.curWaveChecked=a.curWaveChecked,e.curUnitIdx=a.curUnitIdx,t.battleData=e;var i=[],n=this.getUnitList(!1);for(var o in n){var r=n[o].makeBattleTransactionData();i.push(r)}return t.battleUnitData=i,t},makeBattleContinueData:function(){var t,e={},i={};i.cur_waveCount=a.cur_waveCount,e.battleData=i,e.characterStatus=[];var n=h(!1);for(var o in n)t=n[o].makeBattleContinueData(),e.characterStatus.push(t);e.enemyStatus=[];var r=h(!0);for(var s in r)t=r[s].makeBattleContinueData(),e.enemyStatus.push(t);return e},getEndBattleParam:function(t){var e=0;t===o.GameResult.PLAYER_WIN?e=1:t===o.GameResult.ENEMY_WIN||t===o.GameResult.DRAW?e=2:cc.log("not exist result");var i=[],n=this.getUnitList(!1),r=100,s=100,c=100;for(var l in n){var u=n[l],h=u.deckUnit.mainChara.getCharaterModel().getCharacterCd();if(!u.isDead){var d=u.deckUnit.supportChara;if(i.push(h),d){var p=d.getCharaterModel().getCharacterCd();i.push(p)}}for(var m in u.buffList){var _=u.buffList[m];_.type===o.BuffType.ITEM_DROP_RATE_UP?r+=_.power:_.type===o.BuffType.GOLD_DROP_RATE_UP?s+=_.power:_.type===o.BuffType.GET_EXP_RATE_UP&&(c+=_.power)}}var g=i.join(","),C=0,f=a.curActionData;return f&&f.attacker&&(C=!1===f.attacker.isEnemy&&f.commandType===o.CommandType.USE_SKILL?1:0),{status:e,aliveCharacterCds:g,turnCount:a.cur_TurnCount,useItemCount:a.playerUseItemCount,isSkillFinish:C,skillCount:a.playerSkillCount,attackCount:a.playerNormalAttackCount,totalDamageGiven:Math.floor(a.playerTotalDamageGiven),totalDamageTaken:Math.floor(a.playerTotalDamageTaken),itemDropRate:r,goldDropRate:s,getExpRate:c}},caluculateNormalAttackDamage:function(t,e,i){var a=(t/2-e/4)*n.getRandomArbitrary(1-c.BASE_DAMAGE_RANGE,1+c.BASE_DAMAGE_RANGE);return i&&(a*=c.ATTACK_CRITICAL_PLUSRATE),a=parseInt(a)},chackBossWave:function(){if(a.battleType===o.BattleType.ARENA_PVP)return!1;var t=a.curBattleQuest.getWaves()[a.cur_waveCount].enemies;for(var e in t)if(t[e].isBoss)return!0;return!1},playRandomBattleVoice:function(t,e){var i=_.sample(_.filter(t,function(t){return t.getGroupType()===e}));i&&s.fileLoaderManager.loadFile(u.getFileNameCharacterSound(i.getCharacterId(),i.getVoiceFile()),cc.AudioClip,function(t,e){t?cc.error(t):s.soundManager.playVoice(e)})}},cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",CommonFunction:"CommonFunction",CommonUtils:"CommonUtils",EnumTypes:"EnumTypes",GameConst:"GameConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],BattleInfoDeckUnit:[function(t,e,i){"use strict";cc._RF.push(e,"2226bZEB05JVZDC2D0tkW8V","BattleInfoDeckUnit");var a=cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,maskNode:cc.Node,avatarSpr:cc.Sprite}});e.exports=a,cc._RF.pop()},{}],BattleLoadRoot:[function(t,e,i){"use strict";cc._RF.push(e,"b025226C6lIaI+0xGeWl+5J","BattleLoadRoot");var a=t("GameRootBase"),n=(t("Singleton"),t("BattleDataLoader")),o=t("BattleData"),r=t("EnumTypes"),s=t("MemoryManager");cc.Class({extends:a,properties:{battleDataLoader:n},initResource:function(){cc.log("MemoryManager start release BattleLoadRoot..."),s.instance.release(),this.battleDataLoader.initBattleDataLoader(this._callbackToLoadedResource.bind(this)),this._loadCountMax=this.battleDataLoader.getLoadResourceMaxCount(),this._resourceRemainLoadCount=this._loadCountMax},initialize:function(){switch(o.battleType){case r.BattleType.STORY_QUEST:case r.BattleType.EVENT:case r.BattleType.TOWER:default:cc.director.loadScene("battle.fire");break;case r.BattleType.RAID:cc.director.loadScene("RaidBattleScene.fire");break;case r.BattleType.ARENA_PVP:cc.director.loadScene("PvPStartAnimScene.fire")}},_callbackToLoadedResource:function(t){this._resourceRemainLoadCount-=t},updateChild:function(){}}),cc._RF.pop()},{BattleData:"BattleData",BattleDataLoader:"BattleDataLoader",EnumTypes:"EnumTypes",GameRootBase:"GameRootBase",MemoryManager:"MemoryManager",Singleton:"Singleton"}],BattleMonsterModel:[function(t,e,i){"use strict";cc._RF.push(e,"090ed2/sp1J5acBzIvikhX3","BattleMonsterModel");var a=cc.Class({properties:{_battleUnit:null,_localJsonData:null,_objectJsonData:null},ctor:function(){this._battleUnit=arguments[0]},initLocalJsonData:function(t){this._localJsonData=t},initWithObjectData:function(t){this._objectJsonData=t,this._initEnemyAIList()},getEnemyId:function(){return this._localJsonData?this._localJsonData.enemyId:this._objectJsonData?this._objectJsonData.enemyId:void 0},getLevel:function(){return this._objectJsonData?this._objectJsonData.level:1},getIndex:function(){return this._localJsonData?this._localJsonData.index:this._objectJsonData?this._objectJsonData.index:void 0},getSkillId:function(){return this._localJsonData?this._localJsonData.skill_id:this._objectJsonData?this._objectJsonData.abilityList[0].skillId:void 0},getAbilityData:function(){if(this._objectJsonData)return this._objectJsonData.abilityList},getSkillData:function(){if(this._objectJsonData)return this._objectJsonData.skillAttackList},getAttribute:function(){return this._localJsonData?this._localJsonData.attributeType:this._objectJsonData?this._objectJsonData.attribute:void 0},getBaseMaxHp:function(){return this._localJsonData?this._localJsonData.baseHp:this._objectJsonData?this._objectJsonData.hp:void 0},getBaseAtk:function(){return this._localJsonData?this._localJsonData.baseAtk:this._objectJsonData?this._objectJsonData.atk:void 0},getBaseDef:function(){return this._localJsonData?this._localJsonData.baseDef:this._objectJsonData?this._objectJsonData.def:void 0},getSpineDirectoryPath:function(){if(this._objectJsonData)return this._objectJsonData.spineDirectoryPath},getSpineName:function(){return this._objectJsonData?this._objectJsonData.spineName:null},getIconName:function(){return this._localJsonData?this._localJsonData.unitIconName:this._objectJsonData?this._objectJsonData.iconName:void 0},getEnemyAIList:function(){if(this._objectJsonData)return this._objectJsonData.enemyAIList},getNormalAttackData:function(){return this._localJsonData?this._localJsonData.normalAttack:this._objectJsonData?this._objectJsonData.normalAttack:void 0},getResistData:function(){if(this._objectJsonData)return this._objectJsonData.resist},getName:function(){return this._localJsonData?this._localJsonData.enemyName:this._objectJsonData?this._objectJsonData.name:void 0},getSpineScale:function(){return this._localJsonData?this._localJsonData.spineScale:this._objectJsonData?this._objectJsonData.spineScale:void 0},getIsBoss:function(){return!!this._localJsonData&&this._localJsonData.isBoss},_initEnemyAIList:function(){var t=this._objectJsonData.enemyAIList;for(var e in t.sort(function(t,e){return e.priority-t.priority}),t){if("string"==typeof t[e].conditionPlayerAttribute){var i=new Array;for(var a in i=t[e].conditionPlayerAttribute.split(","))i[a]=Number(i[a]);1==i.length&&0==i[0]&&(i=null),t[e].conditionPlayerAttribute=i}if("string"==typeof t[e].conditionEnemyAbnormal){var n=new Array;for(var a in n=t[e].conditionEnemyAbnormal.split(","))n[a]=Number(n[a]);1==n.length&&0==n[0]&&(n=null),t[e].conditionEnemyAbnormal=n}}this._objectJsonData.enemyAIList=t}});e.exports=a,cc._RF.pop()},{}],BattleMonsterUnit:[function(t,e,i){"use strict";cc._RF.push(e,"fbc3cY23G1ItYaXbhAEGJK0","BattleMonsterUnit");var a=t("BattleData"),n=t("GameEffectQueue").GameEffectQueue,o=t("GameEffectQueue").EffectQuery,r=t("GameEffectQueue").EffectData,s=t("CommonFunction"),c=(t("Buff"),t("BattleMonsterModel")),l=t("BattleNormalAttack"),u=t("BattleFunction"),h=t("BattleConstants"),d=t("EnumTypes"),p=t("BattleUnit"),m=t("BattleSkill"),_=t("BattleAbility"),g=t("MemoryManager"),C=cc.Class({extends:p,properties:{battleMonsterModel:{get:function(){return null!=this._battleMonsterModel?this._battleMonsterModel:null}},_battleMonsterModel:{default:null,type:c,serializable:!1},monsterUnitIconResource:null,mySkill:{get:function(){return null!=this._battleSkill?this._battleSkill:null},set:function(t){t&&(this._battleSkill=t)},override:!0}},avatarController:null,isUsedSkill:!1,battleSkillList:null,ctor:function(){this.unitType=d.UnitType.MONSTER;var t=new c(this);this._battleMonsterModel=t;var e=arguments[0];t.initWithObjectData(e),this._initSkill(t),this._initAbilityMain(t);var i=new l,a=this._battleMonsterModel.getNormalAttackData();i.initWithObjectData(a),this._normalAttack=i,this.curHp=this.getMaxHp(),this._curSkillRate=0},_initSkill:function(t){if(this.battleSkillList=new Array,t){var e=t.getSkillData();for(var i in e){var a=new m(this);a.initWithObjectData(e[i]),this.battleSkillList.push(a)}this.battleSkillList[0]&&(this.mySkill=this.battleSkillList[0])}else cc.error("BattleMonsterUnit._initSkill() : \u4e0d\u6b63\u306aBattleMonsterModel\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3057\u305f")},_initAbilityMain:function(t){if(this.battleAbilityMainList=[],t){var e=t.getAbilityData();for(var i in e){var a=new _(this);a.initWithObjectData(e[i]),this.battleAbilityMainList.push(a)}}else cc.error("BattleMonsterUnit._initAbilityMain() : \u4e0d\u6b63\u306aCharacterModel\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3057\u305f")},initBattleUnit:function(t,e){this.unitController=t.getComponent("MonsterUnitCtrl"),this.unitController.myBattleUnit=this,this.avatarController=e.getComponent("MonsterAvatarCtrl"),this.avatarController.myBattleUnit=this;var i=new cc.Node,n=i.addComponent(sp.Skeleton);n.skeletonData=this.unitObjectSpine,n.timeScale=a.cur_GameSpeed,i.parent=this.avatarController.mainUnitAdjustPos,i.setScale(0),i.setPosition(cc.v2(0,140)),i.zIndex=1,this.mainAvatar=n,g.instance.storeRes(n.skeletonData,sp.SkeletonData);var o=this.battleMonsterModel.getSpineScale();this.avatarController.mainUnitAdjustPos.setScale(cc.v2(o,o));var r=s.clamp(this.getAttribute()-1,0,a.UI_M.elementImages.length-1);this.unitController.elementIcon.spriteFrame=a.UI_M.elementImages[r],this.unitController.nameLabel.string="<outline color=#1b1b1b width=2>"+this.battleMonsterModel.getName()+"</outline>",u.readHitEffectEvent(this),this.initComplete=!0},isBoss:function(){return!1},getAttribute:function(){return this.battleMonsterModel.getAttribute()},getId:function(){return this.battleMonsterModel.getEnemyId()},getIndex:function(){return this.battleMonsterModel.getIndex()},getBaseMaxHp:function(){return this.battleMonsterModel.getBaseMaxHp()},getBaseMaxHpExceptEquipEffect:function(){return this.getBaseMaxHp()},getBaseAtk:function(){return this.battleMonsterModel.getBaseAtk()},getBaseAtkExceptEquipEffect:function(){return this.getBaseAtk()},getBaseDef:function(){return this.battleMonsterModel.getBaseDef()},getBaseDefExceptEquipEffect:function(){return this.getBaseDef()},getEnemyAIList:function(){return this.battleMonsterModel.getEnemyAIList()},getResistData:function(){return this.battleMonsterModel.getResistData()},get_MainObjectNode:function(){return this.mainAvatar.node},get_DamageShowNode:function(){return this.avatarController.damageShowNode},get_EffectShowNode:function(){return this.avatarController.effectShowNode},get_BuffShowNode:function(){return this.unitController.buffShowNode},getCharaterModel:function(){return this._battleMonsterModel},startCardShow:function(t,e){var i=h.STARTSHOWCARD_DELAYTIME_PERSHOW*e/a.cur_GameSpeed,s=new n,c=new o,l={};l.delay=i,c.addAction(new r(l,this.unitController.delayWait.bind(this.unitController))),s.addQuery(c),c=new o,l=new Map,c.addAction(new r(l,this.unitController.mainCardShow.bind(this.unitController))),c.addAction(new r(l,this.avatarController.avatarShow.bind(this.avatarController))),s.addQuery(c),(c=new o).addAction(new r(l,this.unitController.iconShow.bind(this.unitController))),(l={}).curHp=this.curHp,l.maxHp=this.getMaxHp(),l.targetTime=h.HPFILL_EFFECT_TIME/a.cur_GameSpeed,c.addAction(new r(l,this.unitController.startHpGaugeAction.bind(this.unitController))),l=new Map;var u={};u.skillRate=this.curSkillRate,c.addAction(new r(u,this.unitController.playSetSkillRate.bind(this.unitController))),s.addQuery(c);var d=a.GM.actionController;(l={}).effectQueue=s,t.addAction(new r(l,d.playEffectqueue.bind(d)))},destroyObjects:function(){this.unitController.node.destroy(),void 0!=this.avatarController&&this.avatarController.node.destroy()},playSkillStartAnimation:function(){var t=a.GM.cameraController,e=a.GM.effectQueue,i={},n=new o;i.targetNode=this.avatarController.mainUnitAdjustPos,n.addAction(new r(i,t.subCameraMonsterZoomIn.bind(t))),e.addQuery(n)},playSkillEndAnimation:function(){var t=a.GM.cameraController,e=a.GM.effectQueue,i=new o;i.addAction(this.unitController.play_AttackReturnToIdle.bind(this.unitController)),i.addAction(new r(null,t.subCameraRestore.bind(t))),e.addQuery(i)},createQueryAbilityCutin:function(t,e,i){var n={};n.battleUnit=this,n.battleAbility=t,n.animationKind="enemy",a.currentTurnAbilityCount+=1,i.addAction(new r(n,a.GM.gameRoot.poolManager.playAbilityShow.bind(a.GM.gameRoot.poolManager)))},canUseSkill:function(t){return!!(t&&this.curSkillRate>=h.CANUSESKILL_SKILLRATE)},isWaittingRage:function(){return!1},checkTriggerInvoke:function(t,e,i){var n=!1;arguments[1]||(e=null),arguments[2]||(i=!0);var o=a.GM;if(!this.isDead){for(var r=0;r<this.battleAbilityMainList.length;r++)o.abilityController.checkAbility_inAction(this,this.battleAbilityMainList[r],t,e)&&(cc.log("main checkAbility_inAction   return true  timing :"+t),a.GM.abilityController.excuteAbility(this,this.battleAbilityMainList[r],void 0,i),n=!0);return n}}});e.exports=C,cc._RF.pop()},{BattleAbility:"BattleAbility",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",BattleMonsterModel:"BattleMonsterModel",BattleNormalAttack:"BattleNormalAttack",BattleSkill:"BattleSkill",BattleUnit:"BattleUnit",Buff:"Buff",CommonFunction:"CommonFunction",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue",MemoryManager:"MemoryManager"}],BattleNormalAttack:[function(t,e,i){"use strict";cc._RF.push(e,"52e97f1cVVIRJw4e2yMhCdl","BattleNormalAttack");var a=cc.Class({properties:{_characterNormalAttackModel:null,_data:null},ctor:function(){},initWithCharacterNormalAttackModel:function(t){this._characterNormalAttackModel=t},initWithObjectData:function(t){this._data=t},getNormalAttackId:function(){return this._characterNormalAttackModel?this._characterNormalAttackModel.getNormalAttackId():this._data?this._jsonData.id:void 0},getEffectShowType:function(){return this._characterNormalAttackModel?this._characterNormalAttackModel.getEffectShowType():this._data?this._data.effectShowType:void 0},getEffectShowValue:function(){return this._characterNormalAttackModel?this._characterNormalAttackModel.getEffectShowValue():this._data?this._data.effectShowValue:void 0},getSpineDirectoryPath:function(){return this._characterNormalAttackModel?this._characterNormalAttackModel.getSpineDirectoryPath():this._data?this._data.spineDirectoryPath:void 0},getAniName:function(){return this._characterNormalAttackModel?this._characterNormalAttackModel.getAniName():this._data?this._data.aniName:void 0},getHitEffectName:function(){return this._characterNormalAttackModel?this._characterNormalAttackModel.getHitEffectName():this._data?this._data.hitEffectName:void 0},getHitEffectAniName:function(){return this._characterNormalAttackModel?this._characterNormalAttackModel.getHitEffectAniName():this._data?this._data.hitEffectAniName:void 0}});e.exports=a,cc._RF.pop()},{}],BattleParameterView:[function(t,e,i){"use strict";cc._RF.push(e,"8d774x9nGZExa/3CyeX6rW+","BattleParameterView");var a=t("CommonUtils");cc.Class({extends:cc.Component,properties:{hpNumLabel:cc.Label,atkNumLabel:cc.Label,defNumLabel:cc.Label,hpAnimation:cc.Animation,atkAnimation:cc.Animation,defAnimation:cc.Animation},initBattleParameterView:function(t,e,i){this.hpNumLabel.string=isNaN(t)?t:a.convertToCommaDelimited(t),this.atkNumLabel.string=isNaN(e)?e:a.convertToCommaDelimited(e),this.defNumLabel.string=isNaN(i)?i:a.convertToCommaDelimited(i)},resetBattleParameterView:function(t){this.hpNumLabel.string=t,this.atkNumLabel.string=t,this.defNumLabel.string=t},setPrefix:function(t){this.hpNumLabel.string=t+this.hpNumLabel.string,this.atkNumLabel.string=t+this.atkNumLabel.string,this.defNumLabel.string=t+this.defNumLabel.string},setSuffix:function(t){this.hpNumLabel.string=this.hpNumLabel.string+t,this.atkNumLabel.string=this.atkNumLabel.string+t,this.defNumLabel.string=this.defNumLabel.string+t},setActive:function(t){this.hpNumLabel.node.active=t,this.atkNumLabel.node.active=t,this.defNumLabel.node.active=t},setColor:function(t,e,i){this.hpNumLabel.node.color=t,this.atkNumLabel.node.color=e,this.defNumLabel.node.color=i},setScale:function(t){this.hpNumLabel.node.scale=t,this.atkNumLabel.node.scale=t,this.defNumLabel.node.scale=t},playAnimation:function(){this.hpAnimation.play(),this.atkAnimation.play(),this.defAnimation.play()}});cc._RF.pop()},{CommonUtils:"CommonUtils"}],BattlePauseHelpView:[function(t,e,i){"use strict";cc._RF.push(e,"95900U0Xo1J+JgmNtjML7pC","BattlePauseHelpView");var a=t("CommonScrollView"),n=t("Singleton"),o=t("ResourceUtils"),r=t("BattlePauseViewBase");cc.Class({extends:r,properties:{buffHelpScrollView:a,buffHelpThumbnailPrefab:cc.Prefab},onLoad:function(){},initBattlePauseView:function(){this._super(),this._drawBuffHelpList()},_drawBuffHelpList:function(){for(var t in this.buffHelpScrollView.content.destroyAllChildren(),n.dao.UserBuffHelpMasters){var e=n.dao.UserBuffHelpMasters[t];if(e&&e.getFileName()){var i=cc.instantiate(this.buffHelpThumbnailPrefab).getComponent("BuffHelpThumbnail");i.setBuffImage(o.getFileNameBuffIcon(e.getFileName())),i.setBuffName(e.getName()),i.setBuffText(e.getText()),this.buffHelpScrollView.content.addChild(i.node)}}this.buffHelpScrollView.scrollToPercentVertical(1)}});cc._RF.pop()},{BattlePauseViewBase:"BattlePauseViewBase",CommonScrollView:"CommonScrollView",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],BattlePauseInfoEnemyView:[function(t,e,i){"use strict";cc._RF.push(e,"d47fcp9SMtIl4NLnc6QQiZJ","BattlePauseInfoEnemyView");var a=t("ResourceUtils"),n=(t("CommonUtils"),t("BattlePauseInfoPlayerView")),o=(t("BattleFunction"),t("BattleConstants")),r=t("EnumTypes");cc.Class({extends:n,properties:{},onLoad:function(){},initBattlePauseView:function(){this._super(!0)},_setBattleThumbnailParameter:function(t,e,i){e.unitType!==r.UnitType.PLAYER_UNIT?(t.setMainImage(a.getFileNameEnemyThumbnail(e.battleMonsterModel.getSpineDirectoryPath())),t.setAttributeImage(a.getFileNameAttributeIcon(e.getAttribute())),t.setLevel(e.battleMonsterModel.getLevel()),t.setHpProgress(e.curHp,e.getMaxHp()),t.setSkillProgress(e.curSkillRate),t.setCallbackToThumbBtn(this._drawBattleUnit.bind(this,e,i))):this._super(t,e,i)},_drawBattleUnit:function(t,e){if(t.unitType!==r.UnitType.PLAYER_UNIT){a.addSprite(this.unitImageSprite,a.getFileNameEnemyThumbnail(t.battleMonsterModel.getSpineDirectoryPath())),this.unitLevelLabel.string=""+t.battleMonsterModel.getLevel(),this.unitNameLabel.string=t.battleMonsterModel.getName(),this.hpProgressBar.progress=t.getCurHp()/t.getMaxHp(),this.skillProgressBar.progress=t.curSkillRate/o.SKILLRATE_MAX;var i={hp:t.battleMonsterModel.getBaseMaxHp(),atk:t.battleMonsterModel.getBaseAtk(),def:t.battleMonsterModel.getBaseDef()};this.parameterView.initBattleParameterView(i.hp,i.atk,i.def,i.hp+i.atk+i.def),this.addParameterView.resetBattleParameterView("(+0)"),this._drawBattleEffectList(t),this._drawBattleUnitSkillAbilityList(t),this._drawSelectedArrow(e)}else this._super(t,e)},_drawBattleUnitSkillAbilityList:function(t){if(t.unitType!==r.UnitType.PLAYER_UNIT){this.skillAbilityThumbnailLayout.node.destroyAllChildren();var e=cc.instantiate(this.skillAbilityThumbnailPrefab).getComponent("BattleSkillAbilityThumbnail");for(var i in e.initBattleSkillThumbnail(t.mySkill,1),this.skillAbilityThumbnailLayout.node.addChild(e.node),t.battleAbilityMainList){var a=cc.instantiate(this.skillAbilityThumbnailPrefab).getComponent("BattleSkillAbilityThumbnail");a.initBattleAbilityThumbnail(t.battleAbilityMainList[i],1),this.skillAbilityThumbnailLayout.node.addChild(a.node)}this.skillAbilityThumbnailLayout.updateLayout(),this.skillAbilityListScrollView.scrollToPercentVertical(1,0,!0)}else this._super(t)}});cc._RF.pop()},{BattleConstants:"BattleConstants",BattleFunction:"BattleFunction",BattlePauseInfoPlayerView:"BattlePauseInfoPlayerView",CommonUtils:"CommonUtils",EnumTypes:"EnumTypes",ResourceUtils:"ResourceUtils"}],BattlePauseInfoPlayerView:[function(t,e,i){"use strict";cc._RF.push(e,"8b127jUe7ZPMbQGHHXKa6VD","BattlePauseInfoPlayerView");t("CommonUtils"),t("ResourceUtils");var a=t("MatrixThumbnailUtils"),n=t("BattlePauseInfoViewBase"),o=t("ItemConst"),r=t("BattleFunction"),s=t("BattleConstants");cc.Class({extends:n,properties:{mainIconPrefab:cc.Prefab,subIconPrefab:cc.Prefab,infoThumbNode:cc.Node,matrixThumbParent:cc.Node},onLoad:function(){},initBattlePauseView:function(){var t=!1;arguments[0]&&(t=arguments[0]),this._super(),this._initBattlePauseInfoView(r.getUnitList(t))},_setBattleThumbnailParameter:function(t,e,i){var a=this._getCharacterMatrixThumbnail(e);t.setMatrixThumbnail(a),t.setHpProgress(e.curHp,e.getMaxHp()),t.setSkillProgress(e.curSkillRate),t.setCallbackToThumbBtn(this._drawBattleUnit.bind(this,e,i))},_drawBattleUnit:function(t,e){this.infoThumbNode.active=!1;var i=this._getCharacterMatrixThumbnail(t);this.matrixThumbParent.addChild(i.node),this.unitNameLabel.string=t.getCharaterModel().getName()+"["+t.getCharaterModel().getSkinName()+"]",this.hpProgressBar.progress=t.getCurHp()/t.getMaxHp(),this.skillProgressBar.progress=t.curSkillRate/s.SKILLRATE_MAX;var a={hp:t.getBaseMaxHp(),atk:t.getBaseAtk(),def:t.getBaseDef()},n={hp:a.hp-t.getCharaterModel().getTotalHp(),atk:a.atk-t.getCharaterModel().getTotalAtk(),def:a.def-t.getCharaterModel().getTotalDef()};this.parameterView.initBattleParameterView(a.hp,a.atk,a.def,a.hp+a.atk+a.def),this.addParameterView.initBattleParameterView(n.hp,n.atk,n.def,n.hp+n.atk+n.def),this.addParameterView.setPrefix("(+"),this.addParameterView.setSuffix(")"),this._drawBattleEffectList(t),this._drawBattleUnitSkillAbilityList(t),this._drawSelectedArrow(e)},_drawBattleUnitSkillAbilityList:function(t){this.skillAbilityThumbnailLayout.node.destroyAllChildren();var e=cc.instantiate(this.mainIconPrefab);this.skillAbilityThumbnailLayout.node.addChild(e);var i=cc.instantiate(this.skillAbilityThumbnailPrefab).getComponent("BattleSkillAbilityThumbnail");for(var a in i.initBattleSkillThumbnail(t.mySkill,t.getCharaterModel().getSkillLevel()),this.skillAbilityThumbnailLayout.node.addChild(i.node),t.battleAbilityMainList){var n=cc.instantiate(this.skillAbilityThumbnailPrefab).getComponent("BattleSkillAbilityThumbnail");n.initBattleAbilityThumbnail(t.battleAbilityMainList[a],t.getCharaterModel().getCharacterAbilityInfoArray()[a].abilityLevel),this.skillAbilityThumbnailLayout.node.addChild(n.node)}if(t.battleAbilitySupportList.length>0){var o=cc.instantiate(this.subIconPrefab);this.skillAbilityThumbnailLayout.node.addChild(o)}for(var r in t.battleAbilitySupportList){var s=cc.instantiate(this.skillAbilityThumbnailPrefab).getComponent("BattleSkillAbilityThumbnail");s.initBattleAbilityThumbnail(t.battleAbilitySupportList[r],t.deckUnit.supportChara.getCharaterModel().getAbilityLevel3()),this.skillAbilityThumbnailLayout.node.addChild(s.node)}this.skillAbilityThumbnailLayout.updateLayout(),this.skillAbilityListScrollView.scrollToPercentVertical(1,0,!0)},_getCharacterMatrixThumbnail:function(t){var e=t.getId(),i={exceedLimit:t.getCharaterModel().getExceedLimit(),prefix:"Lv.",count:t.getCharaterModel().getLevel()};return a.createMatrixThumbnailByItemType(e,o.ITEM_TYPE.CHARACTER,i)}});cc._RF.pop()},{BattleConstants:"BattleConstants",BattleFunction:"BattleFunction",BattlePauseInfoViewBase:"BattlePauseInfoViewBase",CommonUtils:"CommonUtils",ItemConst:"ItemConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils"}],BattlePauseInfoViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"ce5cdjad01B4apDb4F25aka","BattlePauseInfoViewBase");var a=t("CommonScrollView"),n=t("BattlePauseViewBase"),o=t("BattleParameterView");t("BattleData"),t("BattleThumbnail"),cc.Class({extends:n,properties:{battleThumbnailPrefab:cc.Prefab,battleThumbnailNodeArray:[cc.Node],selectedArrowNodeArray:[cc.Node],unitImageSprite:cc.Sprite,attributeImageSprite:cc.Sprite,natureImageSprite:cc.Sprite,unitLevelLabel:cc.Label,unitNameLabel:cc.Label,hpProgressBar:cc.ProgressBar,skillProgressBar:cc.ProgressBar,parameterView:o,addParameterView:o,effectListScrollView:a,buffListLayout:cc.Layout,debuffListLayout:cc.Layout,effectThumbnailPrefab:cc.Prefab,skillAbilityListScrollView:a,skillAbilityThumbnailLayout:cc.Layout,skillAbilityThumbnailPrefab:cc.Prefab},onLoad:function(){},_initBattlePauseInfoView:function(t){this._drawBattleUnitList(t),this._drawBattleUnit(t[0],0)},_drawBattleUnitList:function(t){for(var e=0;e<this.battleThumbnailNodeArray.length;e+=1){this.battleThumbnailNodeArray[e].destroyAllChildren();var i=cc.instantiate(this.battleThumbnailPrefab).getComponent("BattleThumbnail");t[e]&&(this._setBattleThumbnailParameter(i,t[e],e),this.battleThumbnailNodeArray[e].addChild(i.node))}},_drawSelectedArrow:function(t){for(var e in this.selectedArrowNodeArray)this.selectedArrowNodeArray[e].active=!1;this.selectedArrowNodeArray[t].active=!0},_drawBattleEffectList:function(t){this.buffListLayout.node.destroyAllChildren(),this.debuffListLayout.node.destroyAllChildren();var e=t.buffList;for(var i in e){var a=e[i];if(a.getBuffName()){var n=cc.instantiate(this.effectThumbnailPrefab);n.getComponent("BattleEffectThumbnail").initBattleEffectThumbnail(a),a.isNormalBuff()?this.buffListLayout.node.addChild(n):a.isBadConditionBuff()&&this.debuffListLayout.node.addChild(n)}}this.buffListLayout.updateLayout(),this.debuffListLayout.updateLayout(),this.effectListScrollView.content.getComponent(cc.Layout).updateLayout(),this.effectListScrollView.scrollToPercentVertical(1,0,!0)},_setBattleThumbnailParameter:function(t,e,i){cc.error("_drawBattleUnitList(thumb, unit, idx) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_drawBattleUnit:function(t,e){cc.error("_drawBattleUnit() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_drawBattleUnitSkillAbilityList:function(t){cc.error("_drawBattleUnitAbilityList() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")}});cc._RF.pop()},{BattleData:"BattleData",BattleParameterView:"BattleParameterView",BattlePauseViewBase:"BattlePauseViewBase",BattleThumbnail:"BattleThumbnail",CommonScrollView:"CommonScrollView"}],BattlePausePopup:[function(t,e,i){"use strict";cc._RF.push(e,"d31e1Ppm9BNDIMYNPhP62BV","BattlePausePopup");t("Singleton");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("StaticResourceConst"),s=t("BattlePauseTabView"),c=(t("GameEffectQueue").GameEffectQueue,t("BattleFunction")),l=t("BattleData"),u=t("EnumTypes");cc.Class({extends:a,properties:{battlePauseTabview:s,retireBtn:n,resumeBtn:n},onLoad:function(){this.setCloseCallBack(this._getResumeBtnEvent),l.battleType!==u.BattleType.TOWER?(this.retireBtn.switchBtnImage(!0),this.retireBtn.setTapEvent(this._onTapRetireBtn.bind(this),n.SE_NAME.CANCEL)):this.retireBtn.switchBtnImage(!1),this.resumeBtn.setTapEvent(this._onTapResumeBtn.bind(this))},openBattlePausePopup:function(){this.open(this._initBattlePauseTabView.bind(this))},_initBattlePauseTabView:function(){this.battlePauseTabview.initBattlePauseTabView(0)},_onTapRetireBtn:function(){if(l.battleType===u.BattleType.STORY_QUEST||l.battleType===u.BattleType.EVENT)(t=cc.instantiate(o.getResource(r.DIALOG_PREFAB_PATH)).getComponent("CommonPopup")).initYesNo("\u30af\u30a8\u30b9\u30c8\u30ea\u30bf\u30a4\u30a2",this._getQuestRetirePopupLabel(),"",!1,this._getGameOverEvent.bind(this),void 0,"\u30ea\u30bf\u30a4\u30a2\u3059\u308b","\u30ad\u30e3\u30f3\u30bb\u30eb"),t.setCloseCallBack(function(){this.node.active=!0}.bind(this)),t.setNodeGroup("UI"),t.open(),this.node.active=!1;else if(l.battleType===u.BattleType.RAID){var t;(t=cc.instantiate(o.getResource(r.DIALOG_PREFAB_PATH)).getComponent("CommonPopup")).initYesNo("\u30ea\u30bf\u30a4\u30a2\u78ba\u8a8d","\u30ea\u30bf\u30a4\u30a2\u3059\u308b\u3068\u5831\u916c\u306f\u53d7\u3051\u53d6\u308c\u307e\u305b\u3093\uff01","",!1,this._getGameOverEvent.bind(this)),t.setCloseCallBack(function(){this.node.active=!0}.bind(this)),t.setNodeGroup("UI"),t.open(),this.node.active=!1}else this._getGameOverEvent()},_onTapResumeBtn:function(){this.close()},_getResumeBtnEvent:function(){l.UI_M.action_resume()},_getGameOverEvent:function(){l.gameResult=u.GameResult.ENEMY_WIN,l.isAuto=!1,l.isQueueStop=!0,l.playerTotalDamageGiven=0,this.setCloseCallBack(function(){cc.director.resume(),l.GM.showResult()}.bind(this)),this.close()},_getShowGameOverEvent:function(){l.GM.sendBattleRetire(function(){l.GM.saveBattleSetting(function(){var t=l.battleType;t!==u.BattleType.STORY_QUEST&&t!==u.BattleType.EVENT&&t!==u.BattleType.TOWER&&t!==u.BattleType.RAID||c.saveLastDeckData(),l.transitionEndBattleFunc?l.battleType===u.BattleType.ARENA_PVP?l.transitionEndBattleFunc():l.transitionEndBattleFunc(l.selectedQuestModel._questStageMaster.getStageId()):cc.director.loadScene("HomeScene.fire")})})},_getQuestRetirePopupLabel:function(){return"\u30ea\u30bf\u30a4\u30a2\u3059\u308b\u3068\u30af\u30a8\u30b9\u30c8\u5831\u916c\u3092\u7372\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f"}});cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",BattlePauseTabView:"BattlePauseTabView",CommonButton:"CommonButton",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],BattlePauseSettingView:[function(t,e,i){"use strict";cc._RF.push(e,"b4840q7v/pHG6I0y6ZeOEnC","BattlePauseSettingView");var a=t("CommonButton"),n=t("CommonUtils"),o=(t("SoundManager"),t("BattlePauseViewBase")),r=t("BattleData"),s=t("LocalDataConst");cc.Class({extends:o,properties:{skillNormalSwitchBtn:a,skillSimpleSwitchBtn:a,bgmVolumeLabel:cc.Label,bgmSlider:cc.Slider,bgmProgressBar:cc.ProgressBar,bgmMuteSwitchBtn:a,seVolumeLabel:cc.Label,seSlider:cc.Slider,seProgressBar:cc.ProgressBar,seMuteSwitchBtn:a,voiceVolumeLabel:cc.Label,voiceSlider:cc.Slider,voiceProgressBar:cc.ProgressBar,voiceMuteSwitchBtn:a,masterSoundMuteSwitchBtn:a,setInitBtn:a},onLoad:function(){this.skillNormalSwitchBtn.setTapEvent(this._onTapSkillNormalSwitchBtn.bind(this)),this.skillSimpleSwitchBtn.setTapEvent(this._onTapSkillSimpleSwitchBtn.bind(this)),this.setInitBtn.setTapEvent(this._onTapSetInitBtn.bind(this)),this.masterSoundMuteSwitchBtn.setTapEvent(this._onTapMasterMuteSwitchBtn.bind(this)),this.bgmSlider.node.on("slide",this._onSlideSoundSlider.bind(this)),this.seSlider.node.on("slide",this._onSlideSoundSlider.bind(this)),this.voiceSlider.node.on("slide",this._onSlideSoundSlider.bind(this)),this.bgmMuteSwitchBtn.setTapEvent(this._onTapBgmMuteSwitchBtn.bind(this)),this.seMuteSwitchBtn.setTapEvent(this._onTapSeMuteSwitchBtn.bind(this)),this.voiceMuteSwitchBtn.setTapEvent(this._onTapVoiceMuteSwitchBtn.bind(this))},initBattlePauseView:function(){this._super(),this._initSkillEffectSwitchBtn(),this._initMasterSoundSwitchBtn(),this._initSoundSlider()},_initSkillEffectSwitchBtn:function(){this.skillNormalSwitchBtn.switchBtnImage(!r.now_skill_skip_mode),this.skillSimpleSwitchBtn.switchBtnImage(r.now_skill_skip_mode)},_initSoundSlider:function(){var t=r.GM.soundManager,e=t.bgmVolume,i=t.seVolume,a=t.voiceVolume;t.bgmMute&&(e=0),t.seMute&&(i=0),t.voiceMute&&(a=0),this._setVolumeUI(this.bgmSlider,e),this._setVolumeUI(this.seSlider,i),this._setVolumeUI(this.voiceSlider,a)},_initMasterSoundSwitchBtn:function(){var t=r.GM.soundManager;t.bgmMute&&t.seMute&&t.voiceMute?this.masterSoundMuteSwitchBtn.switchBtnImage(!1):this.masterSoundMuteSwitchBtn.switchBtnImage(!0)},_setVolumeUI:function(t,e){t.progress=e,this._setProgressBar(t,e),this._initMasterSoundSwitchBtn()},_setProgressBar:function(t,e){t===this.bgmSlider?(this.bgmVolumeLabel.string=""+Math.floor(100*e),this.bgmProgressBar.progress=e,this.bgmProgressBar._updateBarStatus(),e<=0?this.bgmMuteSwitchBtn.switchBtnImage(!1):this.bgmMuteSwitchBtn.switchBtnImage(!0)):t===this.seSlider?(this.seVolumeLabel.string=""+Math.floor(100*e),this.seProgressBar.progress=e,this.seProgressBar._updateBarStatus(),e<=0?this.seMuteSwitchBtn.switchBtnImage(!1):this.seMuteSwitchBtn.switchBtnImage(!0)):t===this.voiceSlider&&(this.voiceVolumeLabel.string=""+Math.floor(100*e),this.voiceProgressBar.progress=e,this.voiceProgressBar._updateBarStatus(),e<=0?this.voiceMuteSwitchBtn.switchBtnImage(!1):this.voiceMuteSwitchBtn.switchBtnImage(!0))},_setMasterSoundOn:function(){var t=r.GM.soundManager;t.bgmVolume>0&&this.bgmMuteSwitchBtn.switchBtnImage(!0),t.seVolume>0&&this.seMuteSwitchBtn.switchBtnImage(!0),t.voiceVolume>0&&this.voiceMuteSwitchBtn.switchBtnImage(!0),this._onSwitchBgmMute(),this._onSwitchSeMute(),this._onSwitchVoiceMute(),t.setMute(!1),this._setVolumeUI(this.bgmSlider,t.bgmVolume),this._setVolumeUI(this.seSlider,t.seVolume),this._setVolumeUI(this.voiceSlider,t.voiceVolume)},_setMasterSoundOff:function(){var t=r.GM.soundManager;this.bgmMuteSwitchBtn.switchBtnImage(!1),this.seMuteSwitchBtn.switchBtnImage(!1),this.voiceMuteSwitchBtn.switchBtnImage(!1),this._onSwitchBgmMute(),this._onSwitchSeMute(),this._onSwitchVoiceMute(),t.setMute(!0),this._setVolumeUI(this.bgmSlider,0),this._setVolumeUI(this.seSlider,0),this._setVolumeUI(this.voiceSlider,0)},_onSwitchSkillEffect:function(){r.now_skill_skip_mode=!r.now_skill_skip_mode,this._initSkillEffectSwitchBtn(),n.saveLocalStorage(s.LOCAL_STORAGE_KEY.PLAY_SKILL_ANIMATION,!r.now_skill_skip_mode)},_onSwitchBgmMute:function(){var t=r.GM.soundManager;this.bgmMuteSwitchBtn.getBtnImageSwitchState()?(t.bgmMute=0,t.setBgmMute(0),this._setVolumeUI(this.bgmSlider,t.bgmVolume)):(t.bgmMute=1,t.setBgmMute(1),this._setVolumeUI(this.bgmSlider,0))},_onSwitchSeMute:function(){var t=r.GM.soundManager;this.seMuteSwitchBtn.getBtnImageSwitchState()?(t.seMute=0,this._setVolumeUI(this.seSlider,t.seVolume)):(t.seMute=1,this._setVolumeUI(this.seSlider,0))},_onSwitchVoiceMute:function(){var t=r.GM.soundManager;this.voiceMuteSwitchBtn.getBtnImageSwitchState()?(t.voiceMute=0,this._setVolumeUI(this.voiceSlider,t.voiceVolume)):(t.voiceMute=1,this._setVolumeUI(this.voiceSlider,0))},_onTapSkillNormalSwitchBtn:function(){this.skillNormalSwitchBtn.getBtnImageSwitchState()||this._onSwitchSkillEffect()},_onTapSkillSimpleSwitchBtn:function(){this.skillSimpleSwitchBtn.getBtnImageSwitchState()||this._onSwitchSkillEffect()},_onTapSetInitBtn:function(){var t=r.GM.soundManager;this.bgmMuteSwitchBtn.switchBtnImage(!0),t.setBgmMute(0),t.bgmVolume=.5,t.setBGMVol(.5),this._setVolumeUI(this.bgmSlider,.5),this.seMuteSwitchBtn.switchBtnImage(!0),t.setSeMute(0),t.seVolume=.5,this._setVolumeUI(this.seSlider,.5),this.voiceMuteSwitchBtn.switchBtnImage(!0),t.setVoiceMute(0),t.voiceVolume=.5,this._setVolumeUI(this.voiceSlider,.5),this._initMasterSoundSwitchBtn()},_onSlideSoundSlider:function(t){var e=r.GM.soundManager,i=t.progress;t===this.bgmSlider?(i<=0?(this.bgmMuteSwitchBtn.switchBtnImage(!1),e.setBgmMute(1)):(this.bgmMuteSwitchBtn.switchBtnImage(!0),e.setBgmMute(0)),e.bgmVolume=i,e.setBGMVol(i)):t===this.seSlider?(i<=0?(this.seMuteSwitchBtn.switchBtnImage(!1),e.setSeMute(1)):(this.seMuteSwitchBtn.switchBtnImage(!0),e.setSeMute(0)),e.seVolume=i):t===this.voiceSlider&&(i<=0?(this.voiceMuteSwitchBtn.switchBtnImage(!1),e.setVoiceMute(1)):(this.voiceMuteSwitchBtn.switchBtnImage(!0),e.setVoiceMute(0)),e.voiceVolume=i),this._setVolumeUI(t,i),t._updateHandlePosition()},_onTapBgmMuteSwitchBtn:function(){this.bgmMuteSwitchBtn.switchBtnImage(!this.bgmMuteSwitchBtn.getBtnImageSwitchState()),this._onSwitchBgmMute()},_onTapSeMuteSwitchBtn:function(){this.seMuteSwitchBtn.switchBtnImage(!this.seMuteSwitchBtn.getBtnImageSwitchState()),this._onSwitchSeMute()},_onTapVoiceMuteSwitchBtn:function(){this.voiceMuteSwitchBtn.switchBtnImage(!this.voiceMuteSwitchBtn.getBtnImageSwitchState()),this._onSwitchVoiceMute()},_onTapMasterMuteSwitchBtn:function(){this.masterSoundMuteSwitchBtn.switchBtnImage(!this.masterSoundMuteSwitchBtn.getBtnImageSwitchState()),this.masterSoundMuteSwitchBtn.getBtnImageSwitchState()?this._setMasterSoundOn():this._setMasterSoundOff()}});cc._RF.pop()},{BattleData:"BattleData",BattlePauseViewBase:"BattlePauseViewBase",CommonButton:"CommonButton",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",SoundManager:"SoundManager"}],BattlePauseTabView:[function(t,e,i){"use strict";cc._RF.push(e,"e519dYvpvVIC4ONaNvtNNTg","BattlePauseTabView");var a=t("TabViewBase"),n=t("BattlePauseViewBase");cc.Class({extends:a,properties:{battlePauseViewArray:[n]},onLoad:function(){},initBattlePauseTabView:function(t){this.initTabViewBase(),this._setCurrentTab(t),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetPauseView(),this.battlePauseViewArray[t].initBattlePauseView()},_resetPauseView:function(){for(var t in this.battlePauseViewArray)this.battlePauseViewArray[t].resetBattlePauseView()}});cc._RF.pop()},{BattlePauseViewBase:"BattlePauseViewBase",TabViewBase:"TabViewBase"}],BattlePauseViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"78bf1czoeRD67qulqEiHaKl","BattlePauseViewBase");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},resetBattlePauseView:function(){this.node.active=!1},initBattlePauseView:function(){this.node.active=!0}});cc._RF.pop()},{}],BattlePlayerUnitByJson:[function(t,e,i){"use strict";cc._RF.push(e,"543c7OWXsZNU4KxAgmjhK/V","BattlePlayerUnitByJson");var a=t("BattlePlayerUnit"),n=t("BattleNormalAttack"),o=t("CharacterNormalAttackModel"),r=t("EnumTypes"),s=t("BattleData"),c=t("BattleSkill"),l=t("BattleAbility");cc.Class({extends:a,ctor:function(){this.unitType=r.UnitType.PLAYER_UNIT,this.deckUnit=arguments[0];var t=new n,e=this.deckUnit.mainChara.getNormalAttackData();e instanceof o?t.initWithCharacterNormalAttackModel(e):t.initWithObjectData(e),this._normalAttack=t;var i=this.deckUnit.mainChara.getSkillData();if(i){var a=new c(this);a.initWithObjectData(i),this._battleSkill=a}var u=this.deckUnit.mainChara.getAbilityData();u&&((h=new l(this)).initWithObjectData(u),this._battleAbility=h);var h,d=null;(this.deckUnit.supportChara&&(d=this.deckUnit.supportChara.getAbilityData()),d)&&((h=new l(this)).initWithObjectData(d),this._supportBattleAbility=h);var p=null;s.characterStatus&&(p=s.characterStatus.find(function(t){return t.characterCd===this.deckUnit.mainChara.getCharaterModel().getCharacterCd()}.bind(this))),p?(this.curHp=p.hp,this.curSkillRate=p.skillGauge,this.checkFutureDead(0)):this.curHp=this.getMaxHp()}});cc._RF.pop()},{BattleAbility:"BattleAbility",BattleData:"BattleData",BattleNormalAttack:"BattleNormalAttack",BattlePlayerUnit:"BattlePlayerUnit",BattleSkill:"BattleSkill",CharacterNormalAttackModel:"CharacterNormalAttackModel",EnumTypes:"EnumTypes"}],BattlePlayerUnit:[function(t,e,i){"use strict";cc._RF.push(e,"d59a9YegvBBI5NpTdzbWVh9","BattlePlayerUnit");var a=t("BattleDeckUnit"),n=t("BattleData"),o=t("GameEffectQueue").GameEffectQueue,r=t("GameEffectQueue").EffectQuery,s=t("GameEffectQueue").EffectData,c=t("CommonFunction"),l=t("EnumTypes"),u=t("Buff"),h=t("BattleSkill"),d=t("BattleAbility"),p=t("BattleNormalAttack"),m=t("CharacterNormalAttackModel"),_=t("BattleFunction"),g=t("BattleConstants"),C=t("BattleUnit"),f=(t("GameConst"),t("DeckConst")),E=t("MemoryManager"),T=cc.Class({extends:C,properties:{deckUnit:{default:null,type:a,serializable:!1},supportCutinTextureResource:null,useSkillMode:!1},battleAbilitySupportList:null,cutinTextureResource:null,supportUnisonTextureResource:null,textMasterArray:null,ctor:function(){this.unitType=l.UnitType.PLAYER_UNIT,this.deckUnit=arguments[0];var t=new p,e=this.deckUnit.mainChara.getNormalAttackData();if(e instanceof m?t.initWithCharacterNormalAttackModel(e):t.initWithObjectData(e),this._normalAttack=t,this.deckUnit.mainChara.getObjectData()){var i=this.deckUnit.mainChara.getSkillData();if(i){var a=new h(this);a.initWithObjectData(i),this._battleSkill=a}var n,o=this.deckUnit.mainChara.getAbilityData(),r=null;if(this.deckUnit.supportChara&&(r=this.deckUnit.supportChara.getAbilityData()),o)(n=new d(this)).initWithObjectData(o),this.battleAbilityMainList=n;if(r)(n=new d(this)).initWithObjectData(r),this.battleAbilitySupportList=n}else{cc.log("normal battlePlayerUnit");var s=this.deckUnit.mainChara.getCharaterModel(),c=null;this.deckUnit.supportChara&&(c=this.deckUnit.supportChara.getCharaterModel()),this._initSkill(s),this._initAbilityMain(s),this._initAbilitySub(c)}this.curHp=this.getMaxHp()},_initSkill:function(t){t?t.getCharacterMainMaster().getSkillId()&&(this._battleSkill=new h(this),this._battleSkill.initWithCharacterModel(t)):cc.error("BattlePlayerUnit._initSkill() : \u4e0d\u6b63\u306aCharacterModel\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3057\u305f")},_initAbilityMain:function(t){if(this.battleAbilityMainList=[],t){var e=t.getCharacterMainMaster().getAbilityGroupId(),i=t.getAvailableAbilityId(e);if(i)for(var a=0;a<i.length;a++){var n=new d(this);n.initWithCharacterModel(i[a],t,a),this.battleAbilityMainList.push(n)}}else cc.error("BattlePlayerUnit._initAbilityMain() : \u4e0d\u6b63\u306aCharacterModel\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3057\u305f")},_initAbilitySub:function(t){if(this.battleAbilitySupportList=[],t){var e=t.getCharacterMainMaster().getAbilityGroupId(),i=t.getAvailableAbilityId(e);if(i&&i[g.SUB_AVILITY_INDEX]){var a=new d(this);a.initWithCharacterModel(i[g.SUB_AVILITY_INDEX],t,g.SUB_AVILITY_INDEX),this.battleAbilitySupportList.push(a)}}},initBattleUnit:function(t){this.unitController=t.getComponent("PlayerUnitCtrl"),t.name="PlayerUnitCtrl_"+this.deckUnit.deckPosition,this.unitController.myBattleUnit=this,this.unitController.node.runAction(cc.fadeOut(0));var e=new cc.Node;this.initAvatarPosition(e);var i=new cc.Node,a=i.addComponent(sp.Skeleton);a.skeletonData=this.unitObjectSpine,a.timeScale=n.cur_GameSpeed,i.parent=e,this.mainAvatar=a,i.setScale(2.4),i.active=!1,E.instance.storeRes(a.skeletonData,sp.SkeletonData);var o=new cc.Node,r=o.addComponent(sp.Skeleton);r.skeletonData=this.unitObjectSpine,r.timeScale=n.cur_GameSpeed,o.parent=this.unitController.avatarBaseNode,o.setScale(1.3),this.thumbnailAvatar=r,E.instance.storeRes(r.skeletonData,sp.SkeletonData);var s=new cc.Node;s.addComponent(cc.Sprite).spriteFrame=this.supportUnisonTextureResource,s.parent=this.unitController.supportAvatarBaseNode,s.setScale(g.SUPPORT_AVATAR_SCALE);var l=c.clamp(this.getAttribute()-1,0,n.UI_M.elementImages.length-1);this.unitController.elementIcon.spriteFrame=n.UI_M.elementImages[l];var u=c.clamp(this.deckUnit.mainChara.getRarity()-1,0,n.UI_M.spriteRarityIcon.length-1);this.unitController.rarityIcon.spriteFrame=n.UI_M.spriteRarityIcon[u],this.updateUseSkillMode(),_.readHitEffectEvent(this),this.initComplete=!0},initAvatarPosition:function(t){var e=this.unitController.mainUnitAdjustPos.convertToWorldSpace(cc.v2(0,0)),i=n.UI_M.playerAvatarCenter.convertToNodeSpace(e);t.setPosition(i),t.parent=n.UI_M.playerAvatarCenter},getAttribute:function(){return this.deckUnit.mainChara.getAttribute()},getSupportAttribute:function(){return this.deckUnit.supportChara.getAttribute()},getCharaterModel:function(){return this.deckUnit.mainChara.getCharaterModel()},getId:function(){return this.deckUnit.mainChara.getCharaId()},getBaseMaxHp:function(){return this.deckUnit.getMaxHp_DeckUnit()},getBaseMaxHpExceptEquipEffect:function(){return this.deckUnit.getMaxHp_DeckUnitExceptEquipEffect()},getBaseAtk:function(){return this.deckUnit.getAtk_DeckUnit()},getBaseAtkExceptEquipEffect:function(){return this.deckUnit.getAtk_DeckUnitExceptEquipEffect()},getBaseDef:function(){return this.deckUnit.getDef_DeckUnit()},getBaseDefExceptEquipEffect:function(){return this.deckUnit.getDef_DeckUnitExceptEquipEffect()},get_MainObjectNode:function(){return this.mainAvatar.node.parent},get_DamageShowNode:function(){return this.unitController.damageShowNode},get_EffectShowNode:function(){return this.unitController.effectShowNode},get_BuffShowNode:function(){return this.unitController.buffShowNode},get_CastBadConditionChance:function(t){var e=0;if(t){var i=this.deckUnit.supportChara.myEquipmentList;for(var a in i){var n=i[a];if(n.getTriggerType()===l.TriggerType.IN_BATTLE_ALL_TIMES){var o=n.getBattleActionList();for(var r in o){var s=o[r];s.getActionType()===l.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE&&(e+=s.getEffectValue())}}}}else for(var c=Array.from(this.buffList),u=0;u<c.length;u++){var h=c[u];h.type==l.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE&&(cc.log(h),e+=h.power)}return e},startCardShow:function(t,e){var i=g.STARTSHOWCARD_DELAYTIME_PERSHOW*e/n.cur_GameSpeed,a=this.unitController;if(!this.isDead){var c=new o,l=new r,u={};u.delay=i,l.addAction(new s(u,a.delayWait.bind(a))),c.addQuery(l),(l=new r).addAction(new s(u,a.mainCardShow.bind(a))),l.addAction(new s(u,a.charaCardShow.bind(a))),c.addQuery(l),this._startCardParameterShow(c,a);var h=n.GM.actionController;(u=new Map).effectQueue=c,t.addAction(new s(u,h.playEffectqueue.bind(h)))}},startPvPPlayerCardShow:function(t,e){var i=new o,a=new r,c={};c.delay=e,a.addAction(new s(c,this.unitController.delayWait.bind(this.unitController))),a.addAction(new s(c,this.unitController.charaCardShow.bind(this.unitController))),i.addQuery(a),(a=new r).addAction(new s(c,this.unitController.playPvPPlayerShow.bind(this.unitController))),i.addQuery(a),this._startCardParameterShow(i,this.unitController),c.effectQueue=i;var l=n.GM.actionController;t.addAction(new s(c,l.playEffectqueue.bind(l)))},startPvPEnemyCardShow:function(t,e){var i=new o,a=new r,c={};c.delay=e,a.addAction(new s(c,this.unitController.delayWait.bind(this.unitController))),i.addQuery(a),(a=new r).addAction(new s(c,this.unitController.playPvPEnemyShow.bind(this.unitController))),a.addAction(new s(c,this.unitController.charaCardShow.bind(this.unitController))),i.addQuery(a),this._startCardParameterShow(i,this.unitController),c.effectQueue=i;var l=n.GM.actionController;t.addAction(new s(c,l.playEffectqueue.bind(l)))},_startCardParameterShow:function(t,e){var i=new r,a={};a.curHp=this.curHp,a.maxHp=this.getMaxHp(),a.targetTime=g.HPFILL_EFFECT_TIME/n.cur_GameSpeed,i.addAction(new s(a,e.startHpGaugeAction.bind(e)));var o={};o.skillRate=this.curSkillRate,i.addAction(new s(o,e.playSetSkillRate.bind(e))),t.addQuery(i)},checkTriggerInvoke:function(t,e,i){var a=!1;arguments[1]||(e=null),arguments[2]||(i=!0);var o=n.GM;if(!this.isDead){for(var r=0;r<this.battleAbilityMainList.length;r++)o.abilityController.checkAbility_inAction(this,this.battleAbilityMainList[r],t,e)&&(cc.log("main checkAbility_inAction   return true  timing :"+t),n.GM.abilityController.excuteAbility(this,this.battleAbilityMainList[r],f.ROLE_TYPE.MAIN,i),a=!0);if(this.deckUnit.supportChara){cc.log("hasSupport");for(var s=0;s<this.battleAbilitySupportList.length;s++)o.abilityController.checkAbility_inAction(this,this.battleAbilitySupportList[s],t,e)&&(cc.log("support checkAbility_inAction   return true  timing :"+t),n.GM.abilityController.excuteAbility(this,this.battleAbilitySupportList[s],f.ROLE_TYPE.SUPPORT,i),a=!0)}return o.equipmentController.checkEquipmentTriggerInAction(this,t,e)&&(cc.log("checkEquipmentTriggerInAction   return true    timing :"+t),a=!0),a}},makeBattleTransactionData:function(){var t={};t.unitType=this.unitType,t.isEnemy=this.isEnemy,t.curHp=this.curHp,t.curSkillRate=this.curSkillRate,t.isDead=this.isDead;for(var e=[],i=this.buffList,a=0;a<i.length;a++){var n=i[a].makeBattleTransactionData();e.push(n)}return t.buffData=e,t},restoreBattleTransaction:function(t){this.unitType=t.unitType,this.isEnemy=t.isEnemy,this.curHp=t.curHp,this.curSkillRate=t.curSkillRate,this.isDead=t.isDead;var e=t.buffData;for(var i in e){var a=e[i],o=new u;o.restoreBattleTransaction(a),o.spriteFrameIcon=n.GM.gameRoot.poolManager.getSpriteFrameIcon(o),this.addBuff(o)}return!0},updateUseSkillMode:function(t){t?this.useSkillMode=!1:this.curSkillRate>=g.SKILLRATE_MAX&&(n.isSkillAuto||this.isEnemy)?this.useSkillMode=!0:this.curSkillRate<g.SKILLRATE_MAX&&(this.useSkillMode=!1)},playActionStartAnimation:function(t){var e=n.GM.effectQueue,i=new r;i.addAction(this.unitController.playActionStart.bind(this.unitController)),e.addQuery(i)},playActionEndAnimation:function(t){var e=n.GM.effectQueue,i=new r;i.addAction(this.unitController.play_AttackReturnToIdle.bind(this.unitController)),e.addQuery(i)},playSkillStartAnimation:function(){},createQueryAbilityCutin:function(t,e,i){var a={};a.battleUnit=this,a.battleAbility=t,e===f.ROLE_TYPE.MAIN&&(a.animationKind="main"),e===f.ROLE_TYPE.SUPPORT&&(a.animationKind="sub",this.isEnemy||i.addAction(new s(null,this.unitController.playAbilityCharaChange.bind(this.unitController)))),n.currentTurnAbilityCount+=1,i.addAction(new s(a,n.GM.gameRoot.poolManager.playAbilityShow.bind(n.GM.gameRoot.poolManager)))},checkUnisonAttack:function(t){if(!this.deckUnit.supportChara)return!1;for(var e=!1,i=0;i<t.length;i++)t[i].curHp>0&&(e=!0);if(!e)return!1;var a=this.get_UnisonChanceRate();return c.getRandomInt(0,100)<a},_getUnisonAttackPlusPowerBySupportEquipment:function(){var t=0,e=this.deckUnit.supportChara.myEquipmentList;for(var i in e){var a=e[i];if(a.getTriggerType()===l.TriggerType.IN_BATTLE_ALL_TIMES){var n=a.getBattleActionList();for(var o in n){var r=n[o];r.getActionType()===l.BuffType.PLUS_UNISON_ATTACK_POWER&&(t+=r.getEffectValue())}}}return t},executeUnisonAttack:function(t){var e=new r,i=new o("unison_attack_"+this.getCharaterModel().getCharacterId()),a=new r,u=this.unitController.node.convertToWorldSpace(cc.v2(-100,90)),h={};h.speed=n.cur_GameSpeed,h.standTextureResource=this.supportUnisonTextureResource,h.x=u.x,a.addAction(new s(h,n.GM.gameRoot.poolManager.playUnisonCutin.bind(n.GM.gameRoot.poolManager))),i.addQuery(a);var d=n.GM.actionController.checkCriticalByUnison(this);a=new r;var p={},m=this.deckUnit.supportChara.getNormalAttackData().getHitEffectName();p.resourceName=_.getRefName(this.deckUnit.supportChara.getCharaId(),m),p.animationName=this.deckUnit.supportChara.getNormalAttackData().getHitEffectAniName();for(var C=0;C<t.length;C++){var f=this.deckUnit.supportChara.getCharaterModel().getAtk(),E=t[C].getDef(),T=_.caluculateNormalAttackDamage(f,E,d),S=g.UNISON_ATTACK_BASE_RATIO,R=S+_.getAttributeRatio(this.deckUnit.supportChara.getCharaterModel().getAttribute(),t[C].getAttribute());T=parseInt(T*R);for(var A=0,b=Array.from(this.buffList),M=0;M<b.length;M++){var v=b[M];v.type==l.BuffType.PLUS_UNISON_ATTACK_POWER&&(A+=v.power)}A+=this._getUnisonAttackPlusPowerBySupportEquipment(),T=parseInt(T*(1+A/100));var P=l.DamageType.NONE;R<S?P=l.DamageType.RESIST:R>S&&(P=l.DamageType.WEAK),T=c.clamp(T,1,T),T=t[C].checkImmortal(T),t[C].decreaseHp(T),t[C].processDamageShow(a,t[C].curHp,T,P,d,!1),a.addAction(new s(p,t[C].unitController.playSpineOnNode.bind(t[C].unitController)))}i.addQuery(a),a=new r;var I={},y=new o;for(C=0;C<t.length;C++)t[C].processAfterAttack(y,!0,!0),(I={}).effectQueue=y,a.addAction(new s(I,t[C].playLocalEffectqueue.bind(t[C])));i.addQuery(a),(I={}).effectQueue=i,e.addAction(new s(I,this.playLocalEffectqueue.bind(this))),n.GM.effectQueue.addQuery(e),n.GM.equipmentController.checkEquipmentTriggerInActionBySupport(this,l.TriggerType.ON_ATTACK,t)}});e.exports=T,cc._RF.pop()},{BattleAbility:"BattleAbility",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleDeckUnit:"BattleDeckUnit",BattleFunction:"BattleFunction",BattleNormalAttack:"BattleNormalAttack",BattleSkill:"BattleSkill",BattleUnit:"BattleUnit",Buff:"Buff",CharacterNormalAttackModel:"CharacterNormalAttackModel",CommonFunction:"CommonFunction",DeckConst:"DeckConst",EnumTypes:"EnumTypes",GameConst:"GameConst",GameEffectQueue:"GameEffectQueue",MemoryManager:"MemoryManager"}],BattleQuest:[function(t,e,i){"use strict";cc._RF.push(e,"23478WywYRKl4EO2EH2AW2E","BattleQuest");var a=t("Singleton"),n=t("BattleData"),o=cc.Class({properties:{_localJsonData:null,_objectJsonData:null,_selectedStageModel:null,_questStageMaster:null},ctor:function(){},initWithLocalJsonData:function(t){this._localJsonData=t},initWithObjectData:function(t){this._objectJsonData=t},getWaves:function(){return this._localJsonData?this._localJsonData.enemyList:this._objectJsonData?this._objectJsonData.waves:void 0},getNormalWaveBgm:function(){return this._localJsonData?this._localJsonData.stage_bgm:this._objectJsonData?this.getQuestStageMaster().getNormalWaveBgm():void 0},getMaxWaveCount:function(){return this._localJsonData?this._localJsonData.enemyList.length:this._objectJsonData?this._objectJsonData.waves.length:void 0},getQuestName:function(){return this._localJsonData?this._localJsonData.questName:n.selectedQuestModel?n.selectedQuestModel.getStageName():void 0},getQuestStageMaster:function(){return this._questStageMaster||(this._questStageMaster=a.dao.QuestStageMasters.find(function(t){return t.getStageId()===this._objectJsonData.stageId}.bind(this))),this._questStageMaster}});e.exports=o,cc._RF.pop()},{BattleData:"BattleData",Singleton:"Singleton"}],BattleResultSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"e43e91uX95Baou5mwMFXNZV","BattleResultSubRoot");var a=t("BattleData"),n=t("BattleFunction"),o=t("Singleton"),r=t("GameConst"),s=t("ItemConst"),c=t("CharacterUtils"),l=t("EquipmentUtils"),u=t("EnumTypes"),h=t("EventUtils"),d=t("EventQuestConst"),p=t("LocalDataConst"),m=t("CommonButton"),g=t("Async"),C=t("ResultPlayerRankView"),f=t("ResultDropItemWindow"),E=t("ResultEventPointWindow"),T=t("BattleConstants"),S=t("QuestUtils"),R=t("TutorialUtils"),A=t("ResultSubMissionStarView"),b=t("PopupUtils"),M=cc.Enum({WIN:1001,DROP:1002,LOSE:2001});cc.Class({extends:cc.Component,properties:{resultBgGraySprite:cc.Sprite,battleClearNode:cc.Node,battleCharacterSlidInAnimation:cc.Animation,battleCharacterSkeleton:[sp.Skeleton],downSlideInAnimation:cc.Animation,resultTitleAnimation:cc.Animation,subMissionStarView:A,playerRankView:C,upSlideOutAnimation:cc.Animation,characterExpPrefab:cc.Prefab,characterExpAddNode:cc.Node,downSlideOutAnimation:cc.Animation,rankUpPopupPrefab:cc.Prefab,dropWindowAddNode:cc.Node,dropItemWindowPrefab:cc.Prefab,eventPointWindowPrefab:cc.Prefab,nextBtnSlidInAnimation:cc.Animation,retryBtnSlidInAnimation:cc.Animation,subMissionDetailPopupPrefab:cc.Prefab,subMissionDetailPopupPosNode:cc.Node,missionConfirmButton:m,nextButton:m,retryButton:m},updateCallbacks:null,_battleUnitList:null,_battleResult:null,_subMissionMasters:null,_characterExpViewArray:null,_dropItemWindow:f,_eventPointWindow:E,_nextBtnEventType:0,winTasks:null,dropTasks:null,loseTasks:null,isPlayCharacterExpArray:null,ctor:function(){this.updateCallbacks=[],this.isPlayCharacterExpArray=[]},show:function(){this._battleResult=a.battleResult,this._subMissionMasters=this._getSubMissionMasters(),this._battleUnitList=n.getUnitList(!1),this._createCharacterExpView(),this._createAddEventItem(),this._createResultDropItem(),this._initResultSubMissionStarView(),this._initPlayerRankView(),this._initResultDropItemWindow(),this._initResultEventPointWindow(),this._initButtons(),a.gameResult===u.GameResult.PLAYER_WIN?this._showWinResult():a.gameResult===u.GameResult.ENEMY_WIN?this._showLoseResult():cc.error("not exist result")},_showWinResult:function(){this.winTasks=[],this.winTasks.push(this._playBattleClearAnimation.bind(this)),this.winTasks.push(function(t){var e=[this._playBattleCharacterSlidInAnimation.bind(this),this._playBattleUiFadeOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),this.winTasks.push(this._playResultBgGrayFadeIn.bind(this)),this.winTasks.push(this._playResultTitleAnimation.bind(this)),this.winTasks.push(this._playSubMissionAndPlayerRankSlidInAnimation.bind(this)),this.winTasks.push(this._playSubMissionStarAnimation.bind(this)),this.winTasks.push(this._playPlayerRankExpAnimation.bind(this)),this.winTasks.push(this._openResultRankUpPopup.bind(this)),this.winTasks.push(this._playCharacterExpAnimation.bind(this)),this.winTasks.push(function(t){var e=[this._playSubMissionBtnSlideInAnimation.bind(this),this._playNextBtnSlidInAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),g.waterfall(this.winTasks,function(){a.isAuto&&g.waterfall(this.dropTasks)}.bind(this)),this.dropTasks=[],this.dropTasks.push(function(t){var e=[this._playUiUpSlideOutAnimation.bind(this),this._playUiDownSlideOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),a.autoCount>1&&a.isAuto&&!this._isLimitOver()||(this.dropTasks.push(function(t){var e=[this._playDropItemWindowOpenAnimation.bind(this),this._playEventPointWindowOpenAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),this.dropTasks.push(this._playDropItemThumbnailOpenAnimation.bind(this)),this.dropTasks.push(this._openMaxLimitPopup.bind(this))),this.dropTasks.push(this._playRetryBtnSlidInAnimation.bind(this)),this.dropTasks.push(this._endBattleResult.bind(this))},_showLoseResult:function(){this._nextBtnEventType=M.LOSE,a.GM.gameRoot.poolManager.closeAutoRunWindow(),this.loseTasks=[],this.loseTasks.push(this._playBattleLoseAnimation.bind(this)),this.loseTasks.push(function(t){var e=[this._playBattleCharacterSlidInAnimation.bind(this),this._playBattleUiFadeOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),this.loseTasks.push(this._playResultBgGrayFadeIn.bind(this)),this.loseTasks.push(this._playResultTitleAnimation.bind(this)),null!==a.autoBattleResultDropItemMap&&(this.loseTasks.push(function(t){var e=[this._playUiUpSlideOutAnimation.bind(this),this._playUiDownSlideOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),this.loseTasks.push(function(t){var e=[this._playDropItemWindowOpenAnimation.bind(this),this._playEventPointWindowOpenAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),this.loseTasks.push(this._playDropItemThumbnailOpenAnimation.bind(this)),this.loseTasks.push(this._openMaxLimitPopup.bind(this))),this.loseTasks.push(function(t){var e=[this._playNextBtnSlidInAnimation.bind(this),this._playRetryBtnSlidInAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),this.loseTasks.push(this._endBattleResult.bind(this)),g.waterfall(this.loseTasks)},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e-=1)this.updateCallbacks[e](t)},_initEventStageButtons:function(){var t=a.selectedQuestModel.getQuestWorldMaster().getWorldId(),e=h.getEventMainMasterByWorldId(t),i=o.dao[o.USER].getCurrentStaminaInfo().currentStamina,n=S.getCampaignAPValueByStageId(a.selectedQuestModel.getStageId()),r=a.selectedQuestModel.getStamina();switch(n&&(r=Math.ceil(r*n/1e3)),e.getEventType()){case d.EVENT_TYPE.EQUIPMENT_FORTIFY:S.getTodayUserStageClearCountByWorldId(t)>=S.getWorldMasterByWorldId(t).getMaxBattleCount()-e.getMaxUnlockCount()?(this.retryButton.switchBtnImage(!1),this.retryButton.setTouchEnable(!1)):i<r||this._isLimitOver()?(this.retryButton.switchBtnImage(!1),this.retryButton.setTouchEnable(!1)):(this.retryButton.switchBtnImage(!0),this.retryButton.setTouchEnable(!0));break;default:i<r||this._isLimitOver()?(this.retryButton.switchBtnImage(!1),this.retryButton.setTouchEnable(!1)):(this.retryButton.switchBtnImage(!0),this.retryButton.setTouchEnable(!0))}},_initButtons:function(){switch(this._nextBtnEventType=M.WIN,this.missionConfirmButton.setTapEvent(this._openQuestSubMissionPopup.bind(this)),this.nextButton.setTapEvent(this._nextQuest.bind(this)),this.retryButton.setTapEvent(this._retryQuest.bind(this)),a.battleType){case u.BattleType.STORY_QUEST:var t=o.dao[o.USER].getCurrentStaminaInfo().currentStamina,e=S.getCampaignAPValueByStageId(a.selectedQuestModel.getStageId()),i=a.selectedQuestModel.getStamina();e&&(i=Math.ceil(i*e/1e3)),t<i||this._isLimitOver()?(this.retryButton.switchBtnImage(!1),this.retryButton.setTouchEnable(!1)):(this.retryButton.switchBtnImage(!0),this.retryButton.setTouchEnable(!0));break;case u.BattleType.EVENT:this._initEventStageButtons();break;case u.BattleType.RAID:break;case u.BattleType.TOWER:this.retryButton.node.active=!1}R.isTutorialEnded()||(this.retryButton.node.active=!1)},_initPlayerRankView:function(){this.playerRankView.initQuestResultExpGaugeView(this,0,this._battleResult.getPlayerExp,this._battleResult.addGold)},_initResultDropItemWindow:function(){var t=[],e=[];if(this._dropItemWindow=cc.instantiate(this.dropItemWindowPrefab).getComponent("ResultDropItemWindow"),1===a.autoCount&&a.isAuto||!a.isAuto&&null!==a.autoBattleResultDropItemMap||a.gameResult===u.GameResult.ENEMY_WIN&&a.isAuto||this._isLimitOver()){for(var i in a.autoBattleResultDropItemMap)for(var n in a.autoBattleResultDropItemMap[i])for(var o in a.autoBattleResultDropItemMap[i][n])t.push(a.autoBattleResultDropItemMap[i][n][o]);for(var o in t=0!==t.length?t:this._battleResult.dropItemList,a.autoBattleResultEventItemMap[d.EVENT_TYPE.ITEM])e.push(a.autoBattleResultEventItemMap[d.EVENT_TYPE.ITEM][o]);this._dropItemWindow.initResultDropItemWindow(this._battleResult._beforeClearQuestData,this._battleResult._clearQuestData,e,t,[])}else{for(var o in this._battleResult.addEventPointItemMap[d.EVENT_TYPE.ITEM])e.push(this._battleResult.addEventPointItemMap[d.EVENT_TYPE.ITEM][o]);this._dropItemWindow.initResultDropItemWindow(this._battleResult._beforeClearQuestData,this._battleResult._clearQuestData,e,this._battleResult.dropItemList,[])}this.dropWindowAddNode.addChild(this._dropItemWindow.node)},_initResultEventPointWindow:function(){this._eventPointWindow=cc.instantiate(this.eventPointWindowPrefab).getComponent("ResultEventPointWindow"),this._eventPointWindow.initResultEventPointWindow(this._battleResult.addEventPointItemMap[d.EVENT_TYPE.POINT]),this.dropWindowAddNode.addChild(this._eventPointWindow.node)},_initResultSubMissionStarView:function(){this.subMissionStarView.initResultSubMissionStarView(this._battleResult._beforeClearQuestData,this._battleResult._clearQuestData,void 0)},_createResultDropItem:function(){if(a.isAuto||null!==a.autoBattleResultDropItemMap)for(var t in this._battleResult.dropItemList){a.autoBattleResultDropItemMap||(a.autoBattleResultDropItemMap={}),a.autoBattleResultDropItemMap[this._battleResult.dropItemList[t].itemType]||(a.autoBattleResultDropItemMap[this._battleResult.dropItemList[t].itemType]={}),a.autoBattleResultDropItemMap[this._battleResult.dropItemList[t].itemType][this._battleResult.dropItemList[t].itemId]||(a.autoBattleResultDropItemMap[this._battleResult.dropItemList[t].itemType][this._battleResult.dropItemList[t].itemId]={});var e=this._battleResult.dropItemList[t].exceedLimit?this._battleResult.dropItemList[t].exceedLimit:0;a.autoBattleResultDropItemMap[this._battleResult.dropItemList[t].itemType][this._battleResult.dropItemList[t].itemId][e]?a.autoBattleResultDropItemMap[this._battleResult.dropItemList[t].itemType][this._battleResult.dropItemList[t].itemId][e].count+=this._battleResult.dropItemList[t].count:a.autoBattleResultDropItemMap[this._battleResult.dropItemList[t].itemType][this._battleResult.dropItemList[t].itemId][e]=this._battleResult.dropItemList[t]}a.battleResultDropLimitOverCountMap||(a.battleResultDropLimitOverCountMap={}),a.battleResultDropLimitOverCountMap.materialCount||(a.battleResultDropLimitOverCountMap.materialCount=0),a.battleResultDropLimitOverCountMap.characterCount||(a.battleResultDropLimitOverCountMap.characterCount=0),a.battleResultDropLimitOverCountMap.equipmentCount||(a.battleResultDropLimitOverCountMap.equipmentCount=0),a.battleResultDropLimitOverCountMap.materialCount+=this._battleResult.dropLimitOverCountMap.materialCount,a.battleResultDropLimitOverCountMap.characterCount+=this._battleResult.dropLimitOverCountMap.characterCount,a.battleResultDropLimitOverCountMap.equipmentCount+=this._battleResult.dropLimitOverCountMap.equipmentCount},_createAddEventItem:function(){if(!a.autoBattleResultEventItemMap)for(var t in a.autoBattleResultEventItemMap={},d.EVENT_TYPE)a.autoBattleResultEventItemMap[d.EVENT_TYPE[t]]||(a.autoBattleResultEventItemMap[d.EVENT_TYPE[t]]={});if(void 0!==this._battleResult.addEventPointItems&&Array.isArray(this._battleResult.addEventPointItems))for(var e=this._battleResult.addEventPointItems,i=0;i<e.length;i+=1){var n=parseInt(h.getEventMainMasterByItemId(e[i].itemId).getEventType(),10);a.autoBattleResultEventItemMap[n][e[i].itemId]?a.autoBattleResultEventItemMap[n][e[i].itemId].count+=e[i].count:a.autoBattleResultEventItemMap[n][e[i].itemId]=e[i]}},_createCharacterExpView:function(){this._characterExpViewArray=[];for(var t=0;t<this._battleUnitList.length;t+=1){var e=cc.instantiate(this.characterExpPrefab).getComponent("ResultCharacterExpView");this.characterExpAddNode.addChild(e.node),e.initResultCharacterExpView(this,1,t,this._battleUnitList[t],this._battleResult.mainU_getExpList[t]),this._characterExpViewArray.push(e)}},_openQuestSubMissionPopup:function(){var t=[this.subMissionStarView.getProgressStarNode(),this.missionConfirmButton.node],e=[],i=function(){for(var i in t){var a=cc.instantiate(t[i]),n=t[i].convertToWorldSpaceAR(cc.v2(0,0)),o=this.node.convertToNodeSpaceAR(n);this.node.addChild(a,r.Z_ORDER.POPUP),a.setPosition(o),e.push(a)}}.bind(this),a=this._battleResult._clearQuestData.getQuestStageMaster(),n=cc.instantiate(this.subMissionDetailPopupPrefab).getComponent("ResultSubMissionDetailPopup");n.node.position=this.subMissionDetailPopupPosNode.position,n.setCloseCallBack(function(){for(var t in e)e[t].destroy()}),n.openResultSubMissionDetailPopup(this.node,a,this._battleResult._clearQuestData,i)},_nextQuest:function(){switch(this._nextBtnEventType){case M.WIN:g.waterfall(this.dropTasks),this._nextBtnEventType=M.DROP;break;case M.DROP:case M.LOSE:o.soundManager.bgmStop(),a.transitionEndBattleFunc?(a.transitionEndBattleFunc(a.selectedQuestModel._questStageMaster.getStageId()),a.requestSaveBattleFunc=null,a.requestEndBattleFunc=null,a.transitionEndBattleFunc=null):cc.director.loadScene("QuestScene.fire")}},_retryQuest:function(){var t=a.selectedQuestModel._questStageMaster.getStageId(),e=this._battleResult._clearQuestData;this._startBattle(t,e,a.isAuto)},_startBattle:function(t,e,i,s,c){var l=o.localData[p.SELECT_QUEST_DECK_ORDER];if(a.requestAutoBattleFunc&&"function"==typeof a.requestAutoBattleFunc)return a.requestAutoBattleFunc(t,e,l,i,s,c),null;var u=n.setQuestStartBattleData;e.getQuestWorldMaster().getCategory()===r.WORLD_CATEGORY.EVENT&&(u=n.setEventStartBattleData),o.QuestService.startBattle(t,l,i,function(t){var i=t.session;u(e,t.stage,n.createSessionObjectData(i.sessionId,i.stageId,i.deckId,i.deckType),null),o.soundManager.bgmStop(),s&&"function"==typeof s&&s(),cc.director.loadScene("battleLoading.fire",function(){c&&"function"==typeof c&&c()})})},_parallelAnimation:function(t,e){var i=t.length;if(!(t.length>0))return e();t.forEach(function(t){t(function(){if((i-=1)<=0)return e()})})},_getSubMissionMasters:function(){var t=a.battleResult,e=[];return t._beforeClearQuestData.getQuestAchieveMaster1()&&e.push(t._beforeClearQuestData.getQuestAchieveMaster1()),t._beforeClearQuestData.getQuestAchieveMaster2()&&e.push(t._beforeClearQuestData.getQuestAchieveMaster2()),t._beforeClearQuestData.getQuestAchieveMaster3()&&e.push(t._beforeClearQuestData.getQuestAchieveMaster3()),e},_playBattleClearAnimation:function(t){var e=a.battleEffect_Prefabs.BattleWin,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleLoseAnimation:function(t){var e=a.battleEffect_Prefabs.BattleLose,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleCharacterSlidInAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)this.battleCharacterSkeleton[e].skeletonData=this._battleUnitList[e].mainAvatar.skeletonData,this.battleCharacterSkeleton[e].setAnimation(0,"idle",!0),this._battleUnitList[e].unitController.node.runAction(cc.fadeOut(.5));this.battleCharacterSlidInAnimation.once("finished",function(e){return t(e)},this),this.battleCharacterSlidInAnimation.play(this.battleCharacterSlidInAnimation.getClips()[0].name)},_playBattleUiFadeOutAnimation:function(t){var e=[function(t){this._startBattleUiFadeOutAnimation(a.UI_M.waveTurnPanel_Root,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SkillBtn_Pos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SpeedBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.PauseBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.BattleInfoBtnBasePos,t)}.bind(this)];this._parallelAnimation(e,t)},_startBattleUiFadeOutAnimation:function(t,e){t.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){t.active=!1,e()})))},_playResultBgGrayFadeIn:function(t){var e=cc.sequence(cc.delayTime(0),cc.fadeIn(.3),cc.callFunc(function(e){return t(e)}));this.resultBgGraySprite.node.opacity=0,this.resultBgGraySprite.node.active=!0,this.resultBgGraySprite.node.runAction(e)},_playResultTitleAnimation:function(t){this.resultTitleAnimation.once("finished",function(e){return t(e)},this),this.resultTitleAnimation.node.active=!0,this.resultTitleAnimation.play(this.resultTitleAnimation.getClips()[0].name)},_playSubMissionAndPlayerRankSlidInAnimation:function(t){var e=[];e=this._getSubMissionOpenAnimations(e),e=this._getPlayerRankSlidInAnimation(e),e=this._getCharacterExpSlidInAnimation(e),this._parallelAnimation(e,t)},_getSubMissionOpenAnimations:function(t){return t.push(this.subMissionStarView.playSubMissionOpenAnimation.bind(this.subMissionStarView)),t},_getPlayerRankSlidInAnimation:function(t){return t.push(this.playerRankView.playPlayerRankSlidInAnimation.bind(this.playerRankView)),t},_getCharacterExpSlidInAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)t.push(this._characterExpViewArray[e].playResultCharacterExpSlidInAnimation.bind(this._characterExpViewArray[e]));return t},_playSubMissionStarAnimation:function(t){var e=[];e=this._getSubMissionStarAnimations(e),this._parallelAnimation(e,t)},_getSubMissionStarAnimations:function(t){return t.push(this.subMissionStarView.playSubMissionStarOnAnimation.bind(this.subMissionStarView)),t},_playSubMissionBtnSlideInAnimation:function(t){if(a.autoCount>1&&a.isAuto&&!this._isLimitOver()){if(t)return t()}else this._subMissionBtnSlideInAnimation(t)},_subMissionBtnSlideInAnimation:function(t){this.node.runAction(cc.callFunc(function(){this.downSlideInAnimation.on("finished",function(e){return t(e)},this),this.downSlideInAnimation.node.active=!0,this.downSlideInAnimation.play(this.downSlideInAnimation.getClips()[0].name)}.bind(this)))},_playPlayerRankExpAnimation:function(t){this.playerRankView.playPlayerRankExpAnimation(t)},_openResultRankUpPopup:function(t){if(a.beforePlayerLv===o.dao.userBasicData.getLevel())return t();cc.instantiate(this.rankUpPopupPrefab).getComponent("ResultRankUpPopup").openResultRankUpPopup(t)},_playCharacterExpAnimation:function(t){var e=[];e=this._getCharacterExpAnimation(e),this._parallelAnimation(e,function(){this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(t)))}.bind(this)),this._setPlayingCharacterExpSE()},_getCharacterExpAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)t.push(this._characterExpViewArray[e].playResultCharacterExpAnimation.bind(this._characterExpViewArray[e]));return t},_setPlayingCharacterExpSE:function(){for(var t in this._battleUnitList)this.isPlayCharacterExpArray.push(!0);var e=this._playCharacterExpSEUpdateCallBack.bind(this);this.updateCallbacks.push(e)},_playCharacterExpSEUpdateCallBack:function(){this.isPlayCharacterExpArray.find(function(t){return t})&&a.GM.soundManager.playSE(a.RM.soundResourceList.ExperiencePointsRise)},_playUiUpSlideOutAnimation:function(t){this.upSlideOutAnimation.once("finished",function(e){return t(e)},this),this.upSlideOutAnimation.play(this.upSlideOutAnimation.getClips()[0].name)},_playUiDownSlideOutAnimation:function(t){this.downSlideOutAnimation.once("finished",function(e){return t(e)},this),this.downSlideOutAnimation.play(this.downSlideOutAnimation.getClips()[0].name)},_playDropItemWindowOpenAnimation:function(t){this._dropItemWindow.playDropItemWindowOpenAnimation(t)},_playDropItemThumbnailOpenAnimation:function(t){this._dropItemWindow.playDropItemThumbnailOpenAnimation(t),a.GM.soundManager.playSE(a.RM.soundResourceList.DropReward)},_playEventPointWindowOpenAnimation:function(t){this._eventPointWindow.playEventPointWindowOpenAnimation(t)},_openMaxLimitPopup:function(t){var e=[];a.battleResultDropLimitOverCountMap.characterCount>0&&e.push("\u30e6\u30cb\u30c3\u30c8"),a.battleResultDropLimitOverCountMap.equipmentCount>0&&e.push("\u88c5\u5099"),a.battleResultDropLimitOverCountMap.materialCount>0&&e.push("\u7d20\u6750"),e.length>0&&b.openCommonPopupOk("\u6240\u6301\u4e0a\u9650","["+_.join(e,", ")+"]\u304c\u6240\u6301\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n\u5009\u5eab\u306b\u9001\u3089\u308c\u307e\u3057\u305f\u3002",void 0,!1),t()},_playNextBtnSlidInAnimation:function(t){this.nextBtnSlidInAnimation.once("finished",function(e){return t(e)},this),this.nextBtnSlidInAnimation.node.opacity=0,this.nextBtnSlidInAnimation.node.active=!0,this.nextBtnSlidInAnimation.play(this.nextBtnSlidInAnimation.getClips()[0].name)},_playRetryBtnSlidInAnimation:function(t){this.retryBtnSlidInAnimation.once("finished",function(e){return t(e)},this),this.retryBtnSlidInAnimation.node.opacity=0,this.retryBtnSlidInAnimation.node.active=!0,this.retryBtnSlidInAnimation.play(this.retryBtnSlidInAnimation.getClips()[0].name)},_endBattleResult:function(t){if(!a.isAuto)return a.autoBattleResultDropItemMap=null,a.autoBattleResultEventItemMap=null,a.battleResultDropLimitOverCountMap={},t();a.autoCount-=1,a.autoCount>0&&!this._isLimitOver()&&a.gameResult===u.GameResult.PLAYER_WIN?this._automateStartBattle():(a.isAuto=!1,o.soundManager.bgmStop(),this._nextBtnEventType=M.DROP,this._isLimitOver()?a.GM.gameRoot.poolManager.openAutoEndPopup(T.AUTO_END_POPUP_CONST.ITEM_LIMIT):a.gameResult===u.GameResult.PLAYER_WIN?a.GM.gameRoot.poolManager.openAutoEndPopup(T.AUTO_END_POPUP_CONST.COMPLETE):a.GM.gameRoot.poolManager.openAutoEndPopup(T.AUTO_END_POPUP_CONST.DEFEAT),a.autoBattleResultDropItemMap=null,a.autoBattleResultEventItemMap=null,a.battleResultDropLimitOverCountMap={},a.GM.gameRoot.poolManager.closeAutoRunWindow())},_automateStartBattle:function(){this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){this._retryQuest()}.bind(this))))},_isLimitOver:function(){return c.getPlayableUserCharacterModelArray().length>o.dao[o.USER].userData.getCharacterMaxCount()||(c.getNonPlayableUserCharacterModelArray().length>r.MAX_MATERIAL_COUNT||(l.getEquipmentModelArrayByEquipmentType(s.EQUIPMENT_TYPE.ATK).length>o.dao[o.USER].userData.getEquipmentMaxCount()||(l.getEquipmentModelArrayByEquipmentTypes([s.EQUIPMENT_TYPE.FORTIFY_MATERIAL,s.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL]).length>r.MAX_MATERIAL_COUNT||o.dao.userItems.length>o.dao[o.USER].userData.getItemMaxCount())))}});cc._RF.pop()},{Async:"Async",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",EnumTypes:"EnumTypes",EquipmentUtils:"EquipmentUtils",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResultDropItemWindow:"ResultDropItemWindow",ResultEventPointWindow:"ResultEventPointWindow",ResultPlayerRankView:"ResultPlayerRankView",ResultSubMissionStarView:"ResultSubMissionStarView",Singleton:"Singleton",TutorialUtils:"TutorialUtils"}],BattleResult:[function(t,e,i){"use strict";cc._RF.push(e,"9fd123NTApGIoNxDS8Wj+2J","BattleResult");var a=t("BattleData"),n=t("CommonFunction"),o=t("BattleFunction"),r=t("Singleton"),s=t("EventUtils"),c=t("EventQuestConst"),l=cc.Class({properties:{getPlayerExp:0,mainU_getExpList:null,_beforeClearQuestData:null,_clearQuestData:null,_res:null,dropItemList:null},statics:{create_temp_battleResult:function(){var t=new l;t.getPlayerExp=parseInt(10*n.getRandomArbitrary(50,90));for(var e=o.getUnitList(!1).length,i=new Array,a=0;a<e;a++){var r=parseInt(10*n.getRandomArbitrary(50,100));i.push(r)}return t.mainU_getExpList=i,t.dropItemList=new Array,cc.log(t),t},createBattleResult:function(t){var e=new l;e._res=t;var i=t.user;e.getPlayerExp=o.getAddExpOnUser(i);var n=t.characters,u=new Array,h=o.getUnitList(!1);for(var d in h){var p=h[d],m=o.getAddExpOnChara(p,n);u.push(m)}e.mainU_getExpList=u;var _,g=a.selectedQuestModel;_=r.dao.userQuests.find(function(t){return g.getStageId()==t.userData.getStageId()}.bind(this)),e._beforeClearQuestData=g,e._clearQuestData=_,e.dropItemList=new Array;var C=t.dropItems;if(C)for(var d in C)for(var f in C[d]){var E=C[d][f];e.dropItemList.push(E)}for(var T in e.addGold=t.addGolds.reduce(function(t,e){return t+e},0),e.achieveRewards=t.achieveRewards,e.addEventPointItems=t.addEventPointItems,e.addEventPointItemMap={},c.EVENT_TYPE)e.addEventPointItemMap[c.EVENT_TYPE[T]]||(e.addEventPointItemMap[c.EVENT_TYPE[T]]={});if(Array.isArray(t.addEventPointItems))for(var S=t.addEventPointItems,R=0;R<S.length;R+=1){var A=s.getEventMainMasterByItemId(S[R].itemId);if(A){var b=parseInt(A.getEventType(),10);e.addEventPointItemMap[b][S[R].itemId]?e.addEventPointItemMap[b][S[R].itemId].count+=S[R].count:e.addEventPointItemMap[b][S[R].itemId]={itemId:S[R].itemId,itemType:S[R].itemType,count:S[R].count}}}return e.raidRewards=t.raidRewards,e.dropLimitOverCountMap={materialCount:t.addWarehouseMaterials.length+t.updateWarehouseMaterials.length,characterCount:t.addWarehouseCharacters.length+t.updateWarehouseCharacters.length,equipmentCount:t.addWarehouseEquipments.length+t.updateWarehouseEquipments.length},e},createPvpBattleResult:function(t){var e=new l;e._res=t;var i=t.user;e.getPlayerExp=i?o.getAddExpOnUser(i):0;var n=t.characters,s=new Array,c=o.getUnitList(!1);for(var u in c){var h=c[u],d=o.getAddExpOnChara(h,n);s.push(d)}e.mainU_getExpList=s;var p=a.selectedQuestModel,m=p?r.dao.userQuests.find(function(t){return p.getStageId()===t.userData.getStageId()}):null;e._beforeClearQuestData=p,e._clearQuestData=m,e.dropItemList=new Array;var _=t.dropItems;if(_)for(var u in _)for(var g in _[u]){var C=_[u][g];e.dropItemList.push(C)}return e.pvp=t.pvp,e.addPoint=t.addPoint,e.addPresents=t.addPresents,e}}});e.exports=l,cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",CommonFunction:"CommonFunction",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",Singleton:"Singleton"}],BattleSessionModel:[function(t,e,i){"use strict";cc._RF.push(e,"4af34hOEH1NfL0623xmhuTF","BattleSessionModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSessionId:function(){if(this._isKeyFieldAvailable("sessionId"))return this._data.sessionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sessionId")},getDeckId:function(){if(this._isKeyFieldAvailable("deckId"))return this._data.deckId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: deckId")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getSaveData:function(){return this._isKeyFieldAvailable("saveData")?this._data.saveData:null}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],BattleSkillAbilityThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"afa7aOxgIxLC442pfhOpw9L","BattleSkillAbilityThumbnail");t("BattleData");var a=cc.Class({extends:cc.Component,properties:{skillIconNode:cc.Node,abilityIconNode:cc.Node,levelLabel:cc.Label,nameLabel:cc.Label,descriptionRichText:cc.RichText},initBattleSkillThumbnail:function(t,e){this.skillIconNode.active=!0,this.abilityIconNode.active=!1,this.levelLabel.string="Lv."+e,this.nameLabel.string=t.getName(),this.descriptionRichText.string=t.getDescription()},initBattleAbilityThumbnail:function(t,e){this.skillIconNode.active=!1,this.abilityIconNode.active=!0,this.levelLabel.string="Lv."+e,this.nameLabel.string=t.getAbilityName(),this.descriptionRichText.string=t.getDescription()}});e.exports=a,cc._RF.pop()},{BattleData:"BattleData"}],BattleSkill:[function(t,e,i){"use strict";cc._RF.push(e,"e4b278NYKpLgLG2XwvAn+IE","BattleSkill");var a=t("BattleAction"),n=cc.Class({properties:{_battleUnit:null,_characterModel:null,_jsonTextData:null,_objectData:null,_battleActionList:null,actionList:{get:function(){return this.getBattleActionList()}},skillLv:{get:function(){}},skillPower:{get:function(){}}},_description:null,ctor:function(){this._battleUnit=arguments[0],this._description=""},initWithCharacterModel:function(t){this._characterModel=t;var e=this._characterModel.getSkillEffectMaster();if(e){var i=new Array;for(var n in e){var o=e[n],r=new a(o);r.jsonDataMode=!1,i.push(r)}this._battleActionList=i,this._description=t.getSkillShortText()}},initWithJsonTextData:function(t){this._jsonTextData=t;var e=this._jsonTextData.actionList;if(e){var i=new Array;for(var n in e){var o=e[n],r=new a(o);r.jsonDataMode=!0,i.push(r)}this._battleActionList=i}},initWithObjectData:function(t){this._objectData=t;var e=this._objectData.actionList;if(e){var i=new Array;for(var n in e){var o=e[n],r=new a(o);r.jsonDataMode=!0,i.push(r)}this._battleActionList=i}this._description=this._convertEnemyEffectText(e)},_convertEnemyEffectText:function(t){var e="";for(var i in t){e&&"\u3001"!==e.slice(-1)&&(e+="\n");var a=t[i].effectValue;e+=t[i].shortText.replace("{0}",Math.abs(a))}return e},getSkillId:function(){return this._jsonTextData?this._jsonTextData.skillId:this._objectData?this._objectData.skillId:this._characterModel?this._characterModel.getCharacterMainMaster().getSkillId():void 0},getEffectShowType:function(){return this._jsonTextData?this._jsonTextData.effectShowType:this._objectData?this._objectData.effectShowType:this._characterModel?this._characterModel.getSkillMainMaster().getEffectShowType():void 0},getSpineDirectoryPath:function(){return this._jsonTextData?this._jsonTextData.spineDirectoryPath:this._objectData?this._objectData.spineDirectoryPath:this._characterModel?this._characterModel.getSkillMainMaster().getSpineDirectoryPath():void 0},getSpineName:function(){return this._jsonTextData?this._jsonTextData.spineName:this._objectData?"eventKey"==this._objectData.spineName?"eventkey":this._objectData.spineName:this._characterModel?"eventKey"==this._characterModel.getSkillMainMaster().getSpineName()?"eventkey":this._characterModel.getSkillMainMaster().getSpineName():void 0},getBgmVolumeAmount:function(){return this._jsonTextData?this._jsonTextData.bgmVolumeAmount:this._objectData?this._objectData.bgmVolumeAmount:this._characterModel?this._characterModel.getSkillMainMaster().getBgmVolumeAmount():void 0},getName:function(){return this._jsonTextData?this._jsonTextData.name:this._objectData?this._objectData.name:this._characterModel?this._characterModel.getSkillMainMaster().getName():void 0},getDescription:function(){return this._description},getBattleActionList:function(){return this._battleActionList},getAniName:function(){return this._jsonTextData?this._jsonTextData.aniName:this._objectData?this._objectData.aniName:this._characterModel?this._characterModel.getSkillMainMaster().getAniName():void 0},getHitEffectName:function(){return this._jsonTextData?this._jsonTextData.hitEffectName:this._objectData?this._objectData.hitEffectName:this._characterModel?this._characterModel.getSkillMainMaster().getHitEffectName():void 0},getHitEffectAniName:function(){return this._jsonTextData?this._jsonTextData.hitEffectAniName:this._objectData?this._objectData.hitEffectAniName:this._characterModel?this._characterModel.getSkillMainMaster().getHitEffectAniName():void 0},getSkillGroupIndex:function(){if(this._objectData)return this._objectData.skillGroupIndex}});e.exports=n,cc._RF.pop()},{BattleAction:"BattleAction"}],BattleStartConfirmSubRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"fc592T0XnxEhYY1aZpyC/oF","BattleStartConfirmSubRootBase");var a=t("WindowBase"),n=t("GameConst"),o=t("DeckConst"),r=t("CommonButton"),s=t("Singleton"),c=t("LocalDataConst"),l=(t("BattleData"),t("StaticResourceConst"),t("ItemConst")),u=t("ResourceUtils"),h=t("PopupUtils"),d=t("QuestUtils"),p=t("CharacterUtils"),m=t("DeckUtils"),_=t("ItemUtils"),g=t("MatrixThumbnailUtils"),C=t("EquipmentUtils");cc.Class({extends:a,properties:{deckTabSimpleViewPrefab:cc.Prefab,deckTabSimpleViewPositionNode:cc.Node,questStageNameLabel:cc.Label,waveNumLabel:cc.Label,recommendPowerNumLabel:cc.Label,itemThumbnailParentNode:cc.Node,enemyAddLayoutNode:cc.Node,enemyThumbnailPrefab:cc.Prefab,enemyDetailWindow:cc.Prefab,battleBtn:r,dropInfoPopupPrefab:cc.Prefab,enemyInfoPopupPrefab:cc.Prefab,dropInfoBtn:r,enemyInfoBtn:r},_root:null,_stageId:null,_questStageMaster:null,onLoad:function(){this._initBattleBtn()},initBattleStartConfirmSubRoot:function(t,e){this._root=t,this._questStageMaster=e,this._initDeckTabSimpleView(t,m.getDeckArrayByDeckTypes([o.DECK_TYPE.QUEST]),s.localData[c.SELECT_QUEST_DECK_ORDER]),this.redraw(),this._getRequestGetStageData(e.getStageId(),function(t){this._initStageData(t)}.bind(this)),this.dropInfoBtn.setTapEvent(this._onTapDropInfoBtn.bind(this),"")},redraw:function(){this._stageId=this._questStageMaster.getStageId(),this.questStageNameLabel.string=this._questStageMaster.getName(),this.recommendPowerNumLabel.string=this._questStageMaster.getRecommendPower(),this._drawDropItems()},_getRequestGetStageData:function(t,e){s.QuestService.getStageData(t,function(t){e&&e(t)})},_initBattleBtn:function(){this.battleBtn.setTapEvent(function(){p.getPlayableUserCharacterModelArray().length>s.dao[s.USER].userData.getCharacterMaxCount()?h.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"):p.getNonPlayableUserCharacterModelArray().length>n.MAX_MATERIAL_COUNT?h.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"):C.getPlayableUserEquipmentModelArray().length>s.dao[s.USER].userData.getEquipmentMaxCount()?h.openSimpleMessageWindow("\u88c5\u5099\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"):C.getNonPlayableUserEquipmentModelArray().length>n.MAX_MATERIAL_COUNT?h.openSimpleMessageWindow("\u88c5\u5099\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"):s.dao.userItems.length>s.dao[s.USER].userData.getItemMaxCount()?h.openSimpleMessageWindow("\u30a2\u30a4\u30c6\u30e0\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"):this._startBattle()}.bind(this))},_drawDropItems:function(){this.itemThumbnailParentNode.destroyAllChildren();for(var t=d.getDropMasterArrayByStageId(this._questStageMaster.getStageId(),!0,!0),e=0;e<5;e+=1){if(t[e]){var i={};t[e].getItemType()===l.ITEM_TYPE.EQUIPMENT&&(i.rarity=C.getRarityByEquipmentIdAndExceedLimit(t[e].getItemId(),t[e].getExceedLimit()));var a=g.createMatrixThumbnailByItemType(t[e].getItemId(),t[e].getItemType(),i);this.itemThumbnailParentNode.addChild(a.node),a.setCallbackToThumbnailBtn(this._onTapItemThumbnail.bind(this,a.node,t[e].getItemType(),t[e].getItemId(),a.node.parent.scale))}}},_initStageData:function(t){this.waveNumLabel.string=t.wave,this._drawEnemies(t.stageEnemies),this.enemyInfoBtn.setTapEvent(function(){this._openEnemyInfoPopup(t.stageEnemies)}.bind(this),"")},_drawEnemies:function(t){this.enemyAddLayoutNode.destroyAllChildren();for(var e=0;e<5;e+=1)if(t[e]){var i=cc.instantiate(this.enemyThumbnailPrefab).getComponent("EnemyMatrixThumbnail");this.enemyAddLayoutNode.addChild(i.node),i.initEnemyMatrixThumbnail(u.getFileNameEnemyThumbnail(t[e].path),u.getFileNameAttributeIcon(t[e].attribute),u.getFileNameRarityRing(n.RARITY.SR)),i.setCallbackToThumbnailBtn(this._setEnemyThumbnailBtnEvent.bind(this,i,t[e],i.node.parent.scale)),i.setLevel(t[e].level)}},_setEnemyThumbnailBtnEvent:function(t,e,i){var a=cc.instantiate(this.enemyDetailWindow).getComponent("ModelDetailPopup");a.node.setPosition(cc.v2(0,0));var o=cc.instantiate(t.node),r=cc.instantiate(t.node),s=t.node.convertToWorldSpaceAR(cc.v2(0,0)),c=this._root.node.convertToNodeSpaceAR(s);this._root.node.addChild(r,n.Z_ORDER.POPUP),r.setScale(i),r.setPosition(c),a.openModelDetailPopup(o,e.name,e.text,function(){r.destroy()})},_startBattle:function(){cc.error("_startBattle() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_initDeckTabSimpleView:function(t,e,i){var a=cc.instantiate(this.deckTabSimpleViewPrefab).getComponent("DeckTabSimpleView");a.initDeckTabSimpleView(t,e,o.DECK_TYPE.QUEST,i,o.DECK_COUNT_MAX.QUEST),this.deckTabSimpleViewPositionNode.addChild(a.node)},_onTapItemThumbnail:function(t,e,i,a){if(this.enemyDetailWindow){var o=cc.instantiate(this.enemyDetailWindow).getComponent("ModelDetailPopup");o.node.setPosition(cc.v2(0,0));var r=cc.instantiate(t),s=cc.instantiate(t);s.setScale(a);var c=t.convertToWorldSpaceAR(cc.v2(0,0)),l=this._root.node.convertToNodeSpaceAR(c);this._root.node.addChild(s,n.Z_ORDER.POPUP),s.setPosition(l);var u=_.getItemInfo(e,i);o.openModelDetailPopup(r,u.name,u.text,function(){s.destroy()})}},_onTapDropInfoBtn:function(){this._openDropInfoPopup()},_openDropInfoPopup:function(){this._closeDropInfoPopup(),this._dropInfoPopup=cc.instantiate(this.dropInfoPopupPrefab).getComponent("QuestDropInfoPopup"),this._dropInfoPopup.openQuestDropInfoPopup(this._stageId)},_closeDropInfoPopup:function(){this._dropInfoPopup&&(this._dropInfoPopup.close(),this._dropInfoPopup=null)},_openEnemyInfoPopup:function(t){this._closeEnemyInfoPopup(),this._enemyInfoPopup=cc.instantiate(this.enemyInfoPopupPrefab).getComponent("QuestEnemyInfoPopup"),this._enemyInfoPopup.openQuestEnemyInfoPopup(t)},_closeEnemyInfoPopup:function(){this._enemyInfoPopup&&(this._enemyInfoPopup.close(),this._enemyInfoPopup=null)}});cc._RF.pop()},{BattleData:"BattleData",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",DeckConst:"DeckConst",DeckUtils:"DeckUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",WindowBase:"WindowBase"}],BattleStartConfirmSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ed97fyX+sRMLa3dUacYsPJF","BattleStartConfirmSubRoot");var a=t("BattleStartConfirmSubRootBase"),n=t("GameConst"),o=(t("QuestConst"),t("SceneConst"),t("CommonButton")),r=t("Singleton"),s=t("PopupUtils"),c=(t("TimeUtils"),t("BattleData")),l=(t("CharacterUtils"),t("ItemConst")),u=t("QuestUtils"),h=t("QuestConditionUtils");t("UserUtils"),cc.Class({extends:a,properties:{subMissionPopupPrefab:cc.Prefab,consumeApLabel:cc.Label,currentApLabel:cc.Label,afterConsumeApLabel:cc.Label,haveTicketLabel:cc.Label,skipGroupNode:cc.Node,questAchieveNode1:cc.Node,questAchieveNode2:cc.Node,questAchieveNode3:cc.Node,infoBtn:o,skipBtn:o},_questModel:null,_skipFlag:null,_userStaminaValue:null,_childContinuousSortieBtn:null,initBattleStartConfirmSubRoot:function(t,e,i){this._questModel=e,t.setSelectedQuestId(u.getWorldMasterByStageId(e.getQuestStageMaster().getStageId()).getCategory(),e.getQuestStageMaster().getWorldId(),e.getQuestStageMaster().getAreaId(),e.getQuestStageMaster().getStageId()),this._super(t,e.getQuestStageMaster()),this.questAchieveNode1.active=this._questModel.getIsClearMission1(),this.questAchieveNode2.active=this._questModel.getIsClearMission2(),this.questAchieveNode3.active=this._questModel.getIsClearMission3(),this.questAchieveNode1.active&&this.questAchieveNode2.active&&this.questAchieveNode3.active?(this.skipBtn.switchBtnImage(h.isTotalClearCountEnabled(this._questModel)&&h.isTodaySkipCountEnabled(this._questModel,1)),this._skipFlag=!0):(this.skipBtn.switchBtnImage(!1),this._skipFlag=!1),this._setButtonEvent(),!i&&this._questModel.getQuestStageMaster().getIsSkip()||this._hideSkipGroupNode(),c.isAuto&&this.scheduleOnce(this._autoBattle.bind(this),3),this._root.redrawBackGround(e.getWorldId())},redraw:function(){this._questModel=r.dao.userQuests.find(function(t){return t.userData.getStageId()===this._questModel.userData.getStageId()}.bind(this)),this._super();var t=u.getCampaignAPValueByStageId(this._stageId),e=this._questModel.getStamina();t&&(e=Math.ceil(e*t/1e3)),this._userStaminaValue=r.dao[r.USER].getCurrentStaminaInfo().currentStamina,this.consumeApLabel.string=e,this.currentApLabel.string=this._userStaminaValue,this.afterConsumeApLabel.string=this._userStaminaValue-e;var i=r.dao.userItems.find(function(t){return t.getItemId()===l.NORMAL_QUEST_SKIP_TICKET});this.haveTicketLabel.string=i?i.getCount():0},_initBattleBtn:function(){this.battleBtn.setTapEvent(this._onTapBattleBtn.bind(this))},_setButtonEvent:function(){this.skipBtn.setTapEvent(this._onTapSkipBtn.bind(this)),this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),"")},_hideSkipGroupNode:function(){this.skipGroupNode.active=!1},_autoBattle:function(){this._root.startBattleByCondition(0,function(){this._root.requestStartBattle(this._stageId,this._questModel,c.isAuto)}.bind(this))},_onTapBattleBtn:function(){this._root.startBattleByCondition(0,function(){this._skipFlag?this._root.openAutoDetailPopup(this._questModel):(this._root.requestStartBattle(this._stageId,this._questModel,c.isAuto),this.battleBtn.setTouchEnable(!1))}.bind(this))},_onTapSkipBtn:function(){this._skipFlag?this._root.startBattleByCondition(1,function(){"0"===this.haveTicketLabel.string?s.openSimpleMessageWindow("\u30c1\u30b1\u30c3\u30c8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059"):this._root.openSkipDetailPopup(this._questModel)}.bind(this)):cc.log("skipBtn")},_onTapInfoBtn:function(){var t=[this.infoBtn.node,this.questAchieveNode1.parent,this.questAchieveNode2.parent,this.questAchieveNode3.parent],e=[];for(var i in t){var a=cc.instantiate(t[i]),o=t[i].convertToWorldSpaceAR(cc.v2(0,0)),r=this._root.node.convertToNodeSpaceAR(o);this._root.node.addChild(a,n.Z_ORDER.POPUP),a.setPosition(r),e.push(a)}var s=u.getStageMasterByStageId(this._questModel.getStageId()),c=cc.instantiate(this.subMissionPopupPrefab).getComponent("QuestSubMissionPopup");c.setCloseCallBack(function(){for(var t in e)e[t].destroy()}),c.openQuestSubMissionPopup(s,this._questModel)}});cc._RF.pop()},{BattleData:"BattleData",BattleStartConfirmSubRootBase:"BattleStartConfirmSubRootBase",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",GameConst:"GameConst",ItemConst:"ItemConst",PopupUtils:"PopupUtils",QuestConditionUtils:"QuestConditionUtils",QuestConst:"QuestConst",QuestUtils:"QuestUtils",SceneConst:"SceneConst",Singleton:"Singleton",TimeUtils:"TimeUtils",UserUtils:"UserUtils"}],BattleThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"6914019kWJLFpYJe3dd7R2i","BattleThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=(t("EnumTypes"),cc.Class({extends:cc.Component,properties:{mainImageSprite:cc.Sprite,attributeImageSprite:cc.Sprite,levelLabel:cc.Label,hpProgressBar:cc.ProgressBar,skillProgressBar:cc.ProgressBar,thumbBtn:a,matrixThumbParent:cc.Node},_matrixThumb:null,setMainImage:function(t){n.addSprite(this.mainImageSprite,t)},setAttributeImage:function(t){n.addSprite(this.attributeImageSprite,t)},setLevel:function(t){this.levelLabel.string=""+t},setMatrixThumbnail:function(t){this._matrixThumb=t,this.matrixThumbParent.addChild(this._matrixThumb.node),this.thumbBtn.node.active=!1},setHpProgress:function(t,e){this.hpProgressBar.progress=Math.max(t/e,0)},setSkillProgress:function(t){this.skillProgressBar.progress=Math.max(t/100,0)},setCallbackToThumbBtn:function(t){t&&(this._matrixThumb?this._matrixThumb.setCallbackToThumbnailBtn(t):this.thumbBtn.setTapEvent(t))}}));e.exports=o,cc._RF.pop()},{CommonButton:"CommonButton",EnumTypes:"EnumTypes",ResourceUtils:"ResourceUtils"}],BattleUIManager:[function(t,e,i){"use strict";cc._RF.push(e,"f60f2urWYZAvLuAVovjC9T8","BattleUIManager");var a=t("BattleData"),n=(t("GameEffectQueue").EffectQuery,t("GameEffectQueue").EffectData),o=(t("SoundManager"),t("BattleConstants")),r=t("BattleFunction"),s=t("CommonFunction"),c=t("CommonUtils"),l=t("ViewUtils"),u=t("MemoryManager"),h=t("EnumTypes"),d=t("CharacterConst"),p=(t("Singleton"),t("ResourceUtils"),t("StaticResourceConst"),t("GameConst"),cc.Class({extends:cc.Component,properties:{effectCenter:cc.Node,playerAvatarCenter:cc.Node,damageCenter:cc.Node,monsterDamageCenter:cc.Node,popupCenter:cc.Node,monsterEffectCenter:cc.Node,waveTurnPanel_Root:cc.Node,waveFrontNumParentLayout:cc.Layout,waveRearNumParentLayout:cc.Layout,turnNumParentLayout:cc.Layout,PauseBtnBasePos:cc.Node,SkillBtn_Pos:cc.Node,SpeedBtnBasePos:cc.Node,BattleInfoBtnBasePos:cc.Node,pauseBtn:cc.Button,speedBtn:cc.Button,battleInfoBtn:cc.Button,speedSpriteFrames:[cc.SpriteFrame],autoBtn:cc.Button,autoSpriteFrames:[cc.SpriteFrame],speedBtnAnim:cc.Animation,autoBtnAnim:cc.Animation,b_canInputUI:!1,gameOverNode:cc.Node,waveNumbers:[cc.SpriteFrame],newWaveTurnNumbers:[cc.SpriteFrame],elementImages:[cc.SpriteFrame],damageNumbers:[cc.SpriteFrame],criticalNumbers:[cc.SpriteFrame],weakNumbers:[cc.SpriteFrame],resistNumbers:[cc.SpriteFrame],healNumbers:[cc.SpriteFrame],criticalTextSpriteFrame:cc.SpriteFrame,weakTextSpriteFrame:cc.SpriteFrame,resistTextSpriteFrame:cc.SpriteFrame,battleEffect_Prefabs:[],spriteRarityIcon:[cc.SpriteFrame],temp_paused_text_label:cc.Node,grayScreenOBJ:cc.Node,fullSkillEffectCenter:cc.Node,tempNoticeLabel:cc.Label,inputBarrierNode:cc.Node,BattleUICenter:cc.Node,battleInfoWindowNode:cc.Node,battleResultNode:cc.Node,battleResultPrefab:cc.Prefab,towerResultPrefab:cc.Prefab,pauseWindowPrefab:cc.Prefab,buffEffectNode:cc.Node},targetShake:null,targetFlash:null,ctor:function(){},onLoad:function(){this.b_canInputUI=!1,a.UI_M=this,this.targetFlash=[],this.targetShake=[];var t=this.pauseBtn.node.parent;this.origin_pos_pauseBtn=this.pauseBtn.node.position,this.origin_parent_pauseBtn=t,this.redrawAutoBtn(),this.redrawPlayBtn(),this.addBattleBand(this.popupCenter),this.addBattleBand(this.gameOverNode),this.addBattleBand(this.BattleUICenter)},addBattleBand:function(t){l.addEdgeBand(t)},onDestroy:function(){},showBattleStart:function(t,e){var i=this.battleEffect_Prefabs.BattleStartEffect,n=cc.instantiate(i);this.popupCenter.addChild(n),u.instance.localPrefabStore(i);var o=n.getComponent(cc.Animation);o.on("finished",function(e){n.destroy(),t()}.bind(this),this);var s=o.getClips();for(var c in s){if(s.hasOwnProperty(c))s[c].speed=a.cur_GameSpeed}a.GM.soundManager.playSE(a.RM.soundResourceList.BattleStart);var l=_.sample(r.getUnitList(!1));r.playRandomBattleVoice(l.textMasterArray,d.TEXT_GROUP_TYPE.BATTLE.START)},showYourTurn:function(t,e){var i=this.battleEffect_Prefabs.PlayerTurnEffect,n=cc.instantiate(i);this.popupCenter.addChild(n),u.instance.localPrefabStore(i);var o=n.getComponent(cc.Animation);o.on("finished",function(e){n.destroy(),t()}.bind(this),this);var r=o.getClips();for(var s in r){if(r.hasOwnProperty(s))r[s].speed=a.cur_GameSpeed}a.GM.soundManager.playSE(a.RM.soundResourceList.WaveChangeSE)},showEnemyTurn:function(t,e){var i=this.battleEffect_Prefabs.EnemyTurnEffect,n=cc.instantiate(i);this.popupCenter.addChild(n),u.instance.localPrefabStore(i);var o=n.getComponent(cc.Animation);o.on("finished",function(e){n.destroy(),t()}.bind(this),this);var r=o.getClips();for(var s in r){if(r.hasOwnProperty(s))r[s].speed=a.cur_GameSpeed}a.GM.soundManager.playSE(a.RM.soundResourceList.WaveChangeSE)},showWaveStart:function(t,e){var i=e.cur_wave_count,n=(e.max_wave_count,this.battleEffect_Prefabs.NextWave),o=i+1,r=cc.instantiate(n);this.popupCenter.addChild(r);var s=parseInt(o/10),c=o%10;u.instance.localPrefabStore(n);var l=r.getChildByName("word_01").getComponent(cc.Sprite),h=r.getChildByName("word_02").getComponent(cc.Sprite);o<10?(r.getChildByName("word_01").active=!0,r.getChildByName("word_02").active=!1,l.spriteFrame=this.waveNumbers[c]):(r.getChildByName("word_01").active=!0,r.getChildByName("word_02").active=!0,l.spriteFrame=this.waveNumbers[s],h.spriteFrame=this.waveNumbers[c]);var d=r.getComponent(cc.Animation);d.on("finished",function(e){r.destroy(),t()}.bind(this),this);var p=d.getClips();for(var m in p){if(p.hasOwnProperty(m))p[m].speed=a.cur_GameSpeed}a.GM.soundManager.playSE(a.RM.soundResourceList.BattleStart)},showBossBattle:function(t,e){var i=this.battleEffect_Prefabs.BossBattle,n=cc.instantiate(i);this.popupCenter.addChild(n),u.instance.localPrefabStore(i);var o=n.getComponent(cc.Animation);o.on("finished",function(e){n.destroy(),t()}.bind(this),this);var r=o.getClips();for(var s in r){if(r.hasOwnProperty(s))r[s].speed=a.cur_GameSpeed}a.GM.soundManager.playSE(a.RM.soundResourceList.WaveChangeSE)},showYouWin:function(t,e){t()},showGameOver:function(t,e){var i=this.battleEffect_Prefabs.GameOver,n=cc.instantiate(i);this.gameOverNode.addChild(n),u.instance.localPrefabStore(i);var o=n.getComponent(cc.Animation);o.on("finished",function(e){n.destroy(),t()}.bind(this),this);var r=o.getClips();for(var s in r){r[s].speed=a.cur_GameSpeed}},showWaveTurnUI:function(t,e){var i=this.waveTurnPanel_Root;i.opacity=0;var a=cc.sequence(cc.fadeIn(.5),cc.callFunc(t,this));i.runAction(a)},showSkillBtnUI:function(t,e){var i=this.SkillBtn_Pos;i.opacity=0;var a=cc.sequence(cc.fadeIn(.5),cc.callFunc(t,this));i.runAction(a);var n=cc.sequence(cc.delayTime(0),cc.fadeIn(.5));this.SpeedBtnBasePos.runAction(n),this.scanAndChangeAllSpeed()},showRightTopBtnUI:function(t,e){var i=function(){this.b_canInputUI=!0,t()}.bind(this),a=this.SkillBtn_Pos;a.opacity=0,a.runAction(cc.fadeIn(.5));var n=this.SpeedBtnBasePos;n.opacity=0,n.runAction(cc.fadeIn(.5));var o=this.PauseBtnBasePos;o.opacity=0;var r=cc.sequence(cc.fadeIn(.5),cc.callFunc(i,this));o.runAction(r);var s=this.BattleInfoBtnBasePos;s.opacity=0,s.runAction(cc.fadeIn(.5))},showStartUI:function(t){t.addAction(new n(null,this.showWaveTurnUI.bind(this)));var e=new Map;e.cur_GameSpeed=a.cur_GameSpeed,t.addAction(new n(e,this.showSkillBtnUI.bind(this))),t.addAction(new n(null,this.showRightTopBtnUI.bind(this))),this.set_wave_label(a.cur_waveCount,a.curBattleQuest.getMaxWaveCount()),this.set_turn_label(a.cur_TurnCount)},onClick_AutoBtn:function(){(cc.log("onClickAutoBtn!"),this.b_canInputUI)&&(a.isSkillAuto=!a.isSkillAuto,this.redrawAutoBtn(),r.getUnitList(!1).forEach(function(t){t.updateUseSkillMode&&t.updateUseSkillMode(!a.isSkillAuto),t.unitController.redrawSkillOnEffect()},this),a.GM.soundManager.playSE(a.RM.soundResourceList.SkillBtn))},redrawAutoBtn:function(){(a.isSkillAuto?this.autoBtnAnim.play("SideButtonAutoSelect_Anim"):this.autoBtnAnim.play("SideButtonAutoSelectEnd_Anim")).speed=a.cur_GameSpeed},onClick_PlayBtn:function(){if(cc.log("onClick_PlayBtn!"),this.b_canInputUI){var t=a.cur_GameSpeed;if(!a.now_paused){var e=r.getBattleSpeedIdx(a.cur_GameSpeed);++e>2&&(e=0),e=s.clamp(e,0,2);var i=r.getBattleSpeed(e);a.cur_GameSpeed=i,this.redrawPlayBtn(),t!=a.cur_GameSpeed&&this.scanAndChangeAllSpeed()}}a.GM.soundManager.playSE(a.RM.soundResourceList.SpeedBtn)},redrawPlayBtn:function(){var t;switch(a.cur_GameSpeed){case o.BATTLE_SPEED_NORMAL:t=this.speedBtnAnim.play("SideButtonSpeedSelectEnd_Anim");break;case o.BATTLE_SPEED_DOUBLE:t=this.speedBtnAnim.play("SideButtonSpeedSelect2_Anim");break;case o.BATTLE_SPEED_TRIPLE:t=this.speedBtnAnim.play("SideButtonSpeedSelect3_Anim")}t.speed=a.cur_GameSpeed},scanAndChangeAllSpeed:function(){var t=a.cur_GameSpeed,e=a.GM.gameRoot,i=e.getComponentsInChildren(cc.Animation);for(var n in i){var o=i[n],r=o.getClips();for(var s in r){var c=r[s];if(c&&"TapEffect_Anim"!==c.name)o.getAnimationState(c.name).speed=t}}var l=e.getComponentsInChildren(sp.Skeleton);for(var u in l){l[u].timeScale=t}},onClick_PauseBtn:function(){if(cc.log("onClick_PauseBtn!"),a.GM.gameRoot.poolManager._autoRunWindow&&a.isAuto&&(a.GM.gameRoot.poolManager._autoRunWindow.node.active=!1),this.b_canInputUI&&0==a.now_paused){var t=a.GM.soundManager;t.playSE(a.RM.soundResourceList.PauseBtn),a.GM.gameRoot.tapEffectManager.hideTapEffect(),this.b_canInputUI=!0,cc.director.pause(),a.now_paused=!0,cc.instantiate(this.pauseWindowPrefab).getComponent("BattlePausePopup").openBattlePausePopup(),t.togglePauseInBattle(!0)}},action_resume:function(){a.now_paused=!1,cc.director.resume(),a.GM.soundManager.togglePauseInBattle(!1),a.GM.gameRoot.poolManager._autoRunWindow&&a.isAuto&&(a.GM.gameRoot.poolManager._autoRunWindow.node.active=!0)},onClickBG:function(){},setNumSpriteFrames:function(t,e){for(var i=(""+e).split("");t.node.childrenCount<i.length;)t.node.addChild(new cc.Node("num_"+a).addComponent(cc.Sprite).node);for(var a=0;a<t.node.childrenCount;a+=1)i[a]?(t.node.children[a].active=!0,t.node.children[a].getComponent(cc.Sprite).spriteFrame=this.newWaveTurnNumbers[parseInt(i[a])]):t.node.children[a].active=!1},set_turn_label:function(t){this.setNumSpriteFrames(this.turnNumParentLayout,t)},set_wave_label:function(t,e){this.setNumSpriteFrames(this.waveFrontNumParentLayout,t+1),this.setNumSpriteFrames(this.waveRearNumParentLayout,e)},showTempNoticeLabel:function(t,e){var i=e.msg;this.tempNoticeLabel.string=i,this.tempNoticeLabel.node.parent.active=!0;var n=this,r=o.SHOW_NOTICE_LABEL_WAITTIME/a.cur_GameSpeed,s=[];s.push(cc.delayTime(r));s.push(cc.callFunc(function(){n.tempNoticeLabel.node.parent.active=!1,t()},this));var c=cc.sequence(s);this.tempNoticeLabel.node.runAction(c)},showResultWindow:function(){var t=null;switch(a.battleType){case h.BattleType.STORY_QUEST:case h.BattleType.EVENT:t=cc.instantiate(this.battleResultPrefab).getComponent("BattleResultSubRoot");break;case h.BattleType.TOWER:t=cc.instantiate(this.towerResultPrefab).getComponent("TowerResultSubRoot");break;default:t=cc.instantiate(this.battleResultPrefab).getComponent("BattleResultSubRoot")}this.battleResultNode.addChild(t.node),this.battleResultNode.active=!0,t.show()},resumeAllAvatarAction:function(t,e){this.allAvatarAction(t,e,!1)},stopAllAvatarAction:function(t,e){this.allAvatarAction(t,e,!0)},allAvatarAction:function(t,e,i){for(var a=r.getUnitList(!0),n=0;n<a.length;n+=1)a[n].mainAvatar.paused=i;for(var o=r.getUnitList(!1),s=0;s<o.length;s+=1)o[s].thumbnailAvatar.paused=i;t()},shakeNode:function(t,e){var i=e.targetNode,n=e.shakeTime/a.cur_GameSpeed,o=e.shakeCount,r=e.shakeRangeX,s=e.shakeRangeY;if(-1===this.targetShake.indexOf(i)){this.targetShake.push(i),i.stopAllActions();var l=[];l.push(cc.moveBy(.5*n,cc.v2(-.5*r,-.5*s)));for(var u=0;u<o;u++){var h=c.getRandomForFloat(.5*r,r),d=c.getRandomForFloat(.5*-s,s);l.push(cc.moveBy(.5*n,cc.v2(h,d))),l.push(cc.moveBy(.5*n,cc.v2(-h,-d)))}l.push(cc.moveTo(.5*n,cc.v2(0,0))),l.push(cc.callFunc(function(){t&&(this.targetShake.splice(this.targetShake.indexOf(i),1),t())}.bind(this))),i.runAction(cc.sequence(l))}else t()},flashNode:function(t,e){var i=e.targetNode,a=e.blinkCount,n=e.blinkTime,o=e.fadeTime,r=e.color;if(-1===this.targetFlash.indexOf(i)){this.targetFlash.push(i),i.stopAllActions(),i.color=r;var s=[];s.push(cc.fadeTo(.5*n,255));for(var c=1;c<a;c++)s.push(cc.fadeTo(.5*n,0)),s.push(cc.fadeTo(.5*n,255));s.push(cc.fadeTo(o,0)),s.push(cc.callFunc(function(){this.targetFlash.splice(this.targetFlash.indexOf(i),1),t&&t()}.bind(this))),i.runAction(cc.sequence(s))}else t()},fadeToNode:function(t,e){var i=e.targetNode,a=e.fadeTime,n=e.color,o=e.opacity;i.stopAllActions(),i.color=n;var r=cc.fadeTo(a,o),s=cc.sequence(r,cc.callFunc(t));i.runAction(s)},delayTime:function(t,e){var i=[];i.push(cc.delayTime(e.delayTime)),i.push(cc.callFunc(function(){t&&t()})),a.GM.gameRoot.node.runAction(cc.sequence(i))},stopAllBattleAnimation:function(){for(var t=cc.director.getScene().getChildByName("Canvas"),e=t.getComponentsInChildren(cc.Animation),i=t.getComponentsInChildren(sp.Skeleton),a=0;a<e.length;a+=1)e[a].stop();for(a=0;a<i.length;a+=1)i[a].paused=!0}}));e.exports=p,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",CharacterConst:"CharacterConst",CommonFunction:"CommonFunction",CommonUtils:"CommonUtils",EnumTypes:"EnumTypes",GameConst:"GameConst",GameEffectQueue:"GameEffectQueue",MemoryManager:"MemoryManager",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SoundManager:"SoundManager",StaticResourceConst:"StaticResourceConst",ViewUtils:"ViewUtils"}],BattleUnit:[function(t,e,i){"use strict";cc._RF.push(e,"38439XgAulBw4zWDSJhIJD5","BattleUnit");var a=t("EnumTypes").UnitType,n=(t("BattleDeckUnit"),t("BattleData")),o=t("GameEffectQueue").GameEffectQueue,r=t("GameEffectQueue").EffectQuery,c=t("GameEffectQueue").EffectData,l=t("CommonFunction"),u=t("EnumTypes"),h=(t("Buff"),t("BattleSkill"),t("BattleAbility"),t("BattleMonsterModel"),t("BattleNormalAttack"),t("CharacterNormalAttackModel"),t("BattleFunction")),d=t("BattleConstants"),p=t("EquipmentConst"),m=cc.Class({properties:{unitType:a.PLAYER_UNIT,isEnemy:!1,_curHp:0,_curSkillRate:100,isDead:!1,buffList:[],initComplete:!1,curHp:{get:function(){return this._curHp},set:function(t){this._curHp=parseInt(t)}},curSkillRate:{get:function(){return this._curSkillRate},set:function(t){this._curSkillRate=parseInt(t),this.updateUseSkillMode&&this.updateUseSkillMode()}},unitObjectSpine:null,mySkill:{get:function(){return null!=this._battleSkill?this._battleSkill:null}},myNormalAttack:{get:function(){return null!=this._normalAttack?this._normalAttack:null}},_normalAttack:null,unitController:null,mainAvatar:sp.Skeleton,thumbnailAvatar:sp.Skeleton,nAttackDamageRatioList:{default:[],type:Array,serializable:!1,visible:!1},skillDamageRatioList:{default:[],type:Array,serializable:!1,visible:!1},beAttackCounterInTurn:{default:0,type:cc.Integer,serializable:!1,visible:!1}},_battleSkill:null,battleAbilityMainList:null,ctor:function(){},initBattleUnit:function(){cc.log("initBattleUnit need override")},getAttribute:function(){cc.log("getAttribute need override")},getCharaterModel:function(){cc.log("getCharaterModel need override")},getId:function(){cc.log("getId need override")},getCurHp:function(){return this.curHp},getMaxHp:function(){var t=this.getBaseMaxHpExceptEquipEffect(),e=Math.floor(t*d.BUFF_POWER_MIN_PERCENTAGE/100),i=[u.BuffClass.NORMAL,u.BuffClass.ABILITY,u.BuffClass.SKILL],a=this._getMaxHpApplyBuff(t,d.BUFF_POWER_MAX_PERCENTAGE,i);if(a.hasChangeTo)return t=a.changeVal,t=Math.floor(t),Math.max(t,0);i=[u.BuffClass.EQUIPMENT];var n=this._getMaxHpApplyBuff(t,p.EQUIPMENT_BUFF_POWER_MAX_PERCENTAGE,i);return n.hasChangeTo?(t=n.changeVal,t=Math.floor(t),Math.max(t,0)):(t+=a.changeVal+n.changeVal,t=(t=Math.floor(t))>e?t:e,Math.max(t,0))},_getMaxHpApplyBuff:function(t,e,i){var a=0,n=0,o=0,r=0,s=0,c=0,l=!1,h=0;for(var d in this.buffList){var p=this.buffList[d];if(l)break;if(i.includes(p.buffClass))if(p.type==u.BuffType.HP_CHANGE)if(p.powerType==u.PowerType.FIX)p.power>=0?a=a>p.power?a:p.power:n=n<p.power?n:p.power;else{if(p.powerType==u.PowerType.CHANGE_TO){l=!0,origin_para=p.power;break}p.power>=0?o=o>p.power?o:p.power:r=r<p.power?r:p.power}else if(p.type==u.BuffType.HP_CHANGE_STOCKABLE||p.type==u.BuffType.HP_CHANGE_FOR_EQUIPMENT)if(p.powerType==u.PowerType.FIX)s+=p.power;else{if(p.powerType==u.PowerType.CHANGE_TO){l=!0,origin_para=p.power;break}c+=p.power}}if(!l){var m=t*e/100;return h+=s,h+=t*c/100,h+=a+n,h+=t*o/100,{changeVal:h=(h+=t*r/100)<m?h:m,hasChangeTo:!1}}return{changeVal:h,hasChangeTo:!0}},getAtk:function(){var t=this.getBaseAtkExceptEquipEffect(),e=Math.floor(t*d.BUFF_POWER_MIN_PERCENTAGE/100),i=[u.BuffClass.NORMAL,u.BuffClass.ABILITY,u.BuffClass.SKILL],a=this._getAtkApplyBuff(t,d.BUFF_POWER_MAX_PERCENTAGE,i);if(a.hasChangeTo)return t=a.changeVal,t=Math.floor(t),Math.max(t,0);i=[u.BuffClass.EQUIPMENT];var n=this._getAtkApplyBuff(t,p.EQUIPMENT_BUFF_POWER_MAX_PERCENTAGE,i);return n.hasChangeTo?(t=n.changeVal,t=Math.floor(t),Math.max(t,0)):(t+=a.changeVal+n.changeVal,t=(t=Math.floor(t))>e?t:e,Math.max(t,0))},_getAtkApplyBuff:function(t,e,i){var a=0,n=0,o=0,r=0,s=0,c=0,l=!1,h=0;for(var d in this.buffList){var p=this.buffList[d];if(l)break;if(i.includes(p.buffClass))if(p.type==u.BuffType.ATK_CHANGE)if(p.powerType==u.PowerType.FIX)p.power>=0?a=a>p.power?a:p.power:n=n<p.power?n:p.power;else{if(p.powerType==u.PowerType.CHANGE_TO){l=!0,h=p.power;break}p.power>=0?o=o>p.power?o:p.power:r=r<p.power?r:p.power}else if(p.type==u.BuffType.ATK_CHANGE_STOCKABEL||p.type==u.BuffType.ATK_CHANGE_FOR_EQUIPMENT)if(p.powerType==u.PowerType.FIX)s+=p.power;else{if(p.powerType==u.PowerType.CHANGE_TO){l=!0,h=p.power;break}c+=p.power}}if(!l){var m=t*e/100;return h+=s,h+=t*c/100,h+=a+n,h+=t*o/100,{changeVal:h=(h+=t*r/100)<m?h:m,hasChangeTo:!1}}return{changeVal:h,hasChangeTo:!0}},getDef:function(){var t=this.getBaseDefExceptEquipEffect(),e=Math.floor(t*d.BUFF_POWER_MIN_PERCENTAGE/100),i=[u.BuffClass.NORMAL,u.BuffClass.ABILITY,u.BuffClass.SKILL],a=this._getDefApplyBuff(t,d.BUFF_POWER_MAX_PERCENTAGE,i);if(a.hasChangeTo)return t=a.changeVal,t=Math.floor(t),Math.max(t,0);i=[u.BuffClass.EQUIPMENT];var n=this._getDefApplyBuff(t,p.EQUIPMENT_BUFF_POWER_MAX_PERCENTAGE,i);return n.hasChangeTo?(t=n.changeVal,t=Math.floor(t),Math.max(t,0)):(t+=a.changeVal+n.changeVal,t=(t=Math.floor(t))>e?t:e,Math.max(t,0))},_getDefApplyBuff:function(t,e,i){var a=0,n=0,o=0,r=0,s=0,c=0,l=!1,h=0;for(var d in this.buffList){var p=this.buffList[d];if(l)break;if(i.includes(p.buffClass))if(p.type==u.BuffType.DEF_CHANGE)if(p.powerType==u.PowerType.FIX)p.power>=0?a=a>p.power?a:p.power:n=n<p.power?n:p.power;else{if(p.powerType==u.PowerType.CHANGE_TO){l=!0,origin_para=p.power;break}p.power>=0?o=o>p.power?o:p.power:r=r<p.power?r:p.power}else if(p.type==u.BuffType.DEF_CHANGE_STOCKABLE||p.type==u.BuffType.DEF_CHANGE_FOR_EQUIPMENT)if(p.powerType==u.PowerType.FIX)s+=p.power;else{if(p.powerType==u.PowerType.CHANGE_TO){l=!0,origin_para=p.power;break}c+=p.power}}if(!l){var m=t*e/100;return h+=s,h+=t*c/100,h+=a+n,h+=t*o/100,{changeVal:h=(h+=t*r/100)<m?h:m,hasChangeTo:!1}}return{changeVal:h,hasChangeTo:!0}},getSkillRatePerAtk:function(){var t=d.BASE_PLUS_SKILLRATE_PER_ATTACK;t+=l.getRandomArbitrary(-3,3);for(var e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];if(a.type===u.BuffType.PLUS_SKILL_RATE)t+=a.power;else if(a.type===u.BuffType.SEAL_PLUS_SKILL_RATE){cc.log("sealPlusSkillRate has"),t=0;break}}return t},getSkillRatePerDamage:function(){var t=d.BASE_PLUS_SKILLRATE_PER_DAMAGE;t+=l.getRandomArbitrary(-3,3);for(var e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];if(a.type===u.BuffType.PLUS_SKILL_RATE)t+=a.power;else if(a.type===u.BuffType.SEAL_PLUS_SKILL_RATE){cc.log("sealPlusSkillRate has"),t=0;break}}return t},get_UnisonChanceRate:function(){for(var t=d.BASE_UNISON_CHANCE,e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type==u.BuffType.PLUS_UNISON_ATTACK_CHANCE&&(t+=a.power)}return t},get_UnisonPlusPower:function(){for(var t=0,e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type==u.BuffType.PLUS_UNISON_ATTACK_POWER&&(t+=a.power)}return t},get_CastBadConditionChance:function(){for(var t=0,e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type==u.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE&&(cc.log(a),t+=a.power)}return t},checkImmuneBadCondition:function(t){for(var e=!1,i=Array.from(this.buffList),a=0;a<i.length;a++){var n=!1,o=i[a];if(o.type==u.BuffType.IMMUNE_BAD_CONDITION&&(null==o.invokeType||void 0==o.invokeType||o.invokeType==u.EffectConditionType.NO_CONDITION?(e=!0,n=!0):(o.invokeType,u.EffectConditionType.BUFF_TARGET_TYPE_PARTICULAR)),n){cc.log("Immune invoked"),cc.log(o),this.updateBuff(o,u.BuffEndType.ON_INVOKE);break}}return e},get_PreventBadConditionChance:function(){for(var t=0,e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type==u.BuffType.PREVENT_BAD_CONDITION&&(t+=a.power)}return t},get_RecoveryPowerOnHeal:function(){for(var t=0,e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type===u.BuffType.RECOVERY_POWER_UP&&(t+=a.power/100)}return t},get_RecoveryLimitOnHeal:function(){for(var t=0,e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type==u.BuffType.RECOVERY_LIMIT_UP&&(t+=a.power)}return t},get_SkillDamageUpEffect:function(t){for(var e=0,i=Array.from(this.buffList),a=0;a<i.length;a++){var n=i[a];n.powerType===t&&n.type==u.BuffType.SKILL_DAMAGE_UP&&(e+=n.power)}return e},get_CriticalChanceRate:function(){for(var t=0,e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type==u.BuffType.CRITICAL_CHANCE_UP&&(t+=a.power)}return t},get_MainObjectNode:function(){cc.log("get_MainObjectNode need override")},get_DamageShowNode:function(){cc.log("get_DamageShowNode need override")},get_EffectShowNode:function(){cc.log("get_EffectShowNode need override")},getTargetWeight:function(t){for(var e=d.BASE_TARGETING_WEIGHT,i=Array.from(this.buffList),a=0;a<i.length;a++){var n=i[a];n.type==u.BuffType.ADJUST_HATE_WEIGHT_FROM_ENEMY&&1==t&&(cc.log(n),e+=n.power)}return e<0&&(e=0),e},addDamage:function(t){this.curHp-=t},addBuff:function(t){if(!t.isBadConditionBuff()||!this.checkImmuneBadCondition(t.type))switch(t.type){case u.BuffType.INVOKED_ABILITY:case u.BuffType.INVOKED_EQUIPMENT:this.buffList.push(t);break;case u.BuffType.HP_CHANGE_FOR_EQUIPMENT:var e=this.curHp/this.getMaxHp();this.buffList.push(t),this.curHp=parseInt(e*this.getMaxHp()),this.unitController.setHp(this.curHp);break;case u.BuffType.ATK_CHANGE_FOR_EQUIPMENT:case u.BuffType.DEF_CHANGE_FOR_EQUIPMENT:this.buffList.push(t);break;case u.BuffType.HP_CHANGE:case u.BuffType.HP_CHANGE_STOCKABLE:e=this.curHp/this.getMaxHp();var i=!0;this.buffList.forEach(function(e){t.type==u.BuffType.HP_CHANGE&&e.type==t.type&&(t.power>=e.power?this.removeBuff(e):i=!1),t.type==u.BuffType.HP_CHANGE_FOR_EQUIPMENT&&e.type==t.type&&(t.power>=e.power?this.removeBuff(e):i=!1)},this),i&&(this.buffList.push(t),this.unitController.createBuffIcon(t),this.sortBuffIconList()),this.curHp=parseInt(e*this.getMaxHp()),this.unitController.setHp(this.curHp);break;case u.BuffType.ATK_CHANGE_STOCKABEL:case u.BuffType.DEF_CHANGE_STOCKABLE:case u.BuffType.PLUS_UNISON_ATTACK_CHANCE:case u.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE:case u.BuffType.RECOVERY_POWER_UP:case u.BuffType.RECOVERY_LIMIT_UP:case u.BuffType.CRITICAL_CHANCE_UP:case u.BuffType.PREVENT_BAD_CONDITION:case u.BuffType.SKILL_DAMAGE_UP:0!=t.isGoodBuff()||t.endType!=u.BuffEndType.GENERAL_TURN_END&&t.endType!=u.BuffEndType.MY_TURN_END&&t.endType!=u.BuffEndType.ENEMY_TURN_END||this.buffList.forEach(function(e){e.type==u.BuffType.ADD_DEBUFF_TURN&&(cc.log("beforeNewbuff endVal : "+t.endVal),cc.log(e),t.endVal+=e.power,cc.log("after  Newbuff endVal : "+t.endVal))},this),this.buffList.push(t),t.spriteFrameIcon&&this.unitController.createBuffIcon(t),this.sortBuffIconList();break;default:var a=!1;this.buffList.forEach(function(e){e.buffId==t.buffId&&e.type==t.type&&e.buffClass==t.buffClass&&(a=!0,t.power>=e.power&&(e.power=t.power,e.endVal=t.endVal,null!=e.remainCountLabel&&(e.remainCountLabel.string=String(e.endVal))))},this),a||(0!=t.isGoodBuff()||t.endType!=u.BuffEndType.GENERAL_TURN_END&&t.endType!=u.BuffEndType.MY_TURN_END&&t.endType!=u.BuffEndType.ENEMY_TURN_END||this.buffList.forEach(function(e){e.type==u.BuffType.ADD_DEBUFF_TURN&&(cc.log("beforeNewbuff endVal : "+t.endVal),cc.log(e),t.endVal+=e.power,cc.log("after  Newbuff endVal : "+t.endVal))},this),this.buffList.push(t),t.spriteFrameIcon&&this.unitController.createBuffIcon(t),this.sortBuffIconList())}},deleteAllBuff:function(){var t=this;Array.from(this.buffList).forEach(function(e){t.removeBuff(e)},this)},updateAllBuff:function(t){var e=this;Array.from(this.buffList).forEach(function(i){e.updateBuff(i,t)},this)},updateBuff:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!1;if(t.endType==e){var n=!0;if(t.endType==u.BuffEndType.DAMAGE_COUNT)void 0!=i&&(t.endVal-=i);else if(t.endType==u.BuffEndType.BE_ATTACKED_CHECK_CHANCE){n=!1,l.getRandomArbitrary(0,100)<=Number(t.endValSub)&&(a=!0)}else t.endVal--;n&&t.endVal<=0?(cc.log(e+" <= endType is equal this buff. and endval over !!!"),a=!0):null!=t.remainCountLabel&&(t.remainCountLabel.string=String(t.endVal))}else t.endType==u.BuffEndType.BOTH_ON_INVOKE_GENERAL_TURN_END&&(e==u.BuffEndType.GENERAL_TURN_END?(cc.log("this buff is end on, both_onInvoke_generalTurnEnd and generalTurnEnd timing  "+t.endType+" "+e),t.endVal--,t.endVal<=0?a=!0:null!=t.remainCountLabel&&(t.remainCountLabel.string=String(t.endVal))):e==u.BuffEndType.ON_INVOKE&&(cc.log("this buff is end on, both_onInvoke_generalTurnEnd and onInvoke timing  "+t.endType+" "+e),t.endValSub--,t.endValSub<=0&&(a=!0)));a&&(t.invokeType==u.EffectConditionType.ON_BUFF_END_INVOKE&&(cc.log(t),cc.log("invokeType  is onBuffEndInvoke"),this.invokeBuffAction(t)),this.removeBuff(t))},removeBuff:function(t){this.unitController.checkRemove_buffIcon(t);var e=this;this.buffList.some(function(i,a){i==t&&e.buffList.splice(a,1)}),this.sortBuffIconList()},hasBuff:function(t){for(var e=0;e<this.buffList.length;e++){if(this.buffList[e].type==t)return!0}return!1},sortBuffIconList:function(){this.unitController.showBuffIconList=new Array;var t=Array.from(this.buffList);for(var e in t.sort(function(t,e){return t.isGoodBuff()&&0==e.isGoodBuff()?-1:0==t.isGoodBuff()&&e.isGoodBuff()?1:0}),t){var i=t[e];i.type==u.BuffType.INVOKED_ABILITY||i.type==u.BuffType.INVOKED_EQUIPMENT||this.unitController.showBuffIconList.push(i)}},startCardShow:function(t,e){cc.log("startCardShow need override")},checkGroggy:function(){return this.curHp/this.getMaxHp()<=.5||!(!this.hasBuff(u.BuffType.POISON)&&!this.hasBuff(u.BuffType.PARALYSIS))},checkCanAction:function(){if(this.isDead)return!1;n.GM;var t=n.UI_M,e=n.GM.effectQueue,i=n.GM.gameRoot.poolManager,a=!0;for(var o in this.buffList){var s=this.buffList[o],l=!1;if(s.type===u.BuffType.PARALYSIS){var h=new r;(d=new Map).set("buff",s),h.addAction(new c(d,this.playEffectSound_buff.bind(this))),e.addQuery(h),l=!0,a=!1}else if(s.type==u.BuffType.STUN){if(s.checkInvoke()){var d,p=new r;(d={}).targetNode=this.get_EffectShowNode(),d.parentNode=t.buffEffectNode,d.buffType=u.BuffType.STUN,p.addAction(new c(d,i.playBuffInvokeEffect_Instant.bind(i))),e.addQuery(p),l=!0,a=!1}}else if(s.type==u.BuffType.SLEEP){var m=new r,_=new Map;this.get_MainObjectNode(),m.addAction(new c(_,this.unitController.playCannotAction.bind(this.unitController))),(_=new Map).set("buff",s),m.addAction(new c(_,this.playEffectSound_buff.bind(this))),e.addQuery(m),l=!0,a=!1}if(l&&this.updateBuff(s,u.BuffEndType.ON_INVOKE),0==a)break}return a},checkMiss:function(t){var e=!1;for(var i in this.buffList){var a=this.buffList[i];if(a.type==u.BuffType.DARKNESS_ON_NORMAL_ATTK&&t.commandType==u.CommandType.ATTACK){if(a.checkInvoke()){t.badConditionInvoked=!0,t.badConditionBuff=a,e=!0;break}}else if(a.type==u.BuffType.DARKNESS_ON_ALL&&a.checkInvoke()){t.badConditionInvoked=!0,t.badConditionBuff=a,e=!0;break}}return e},checkNormalAttackHit:function(){for(var t=n.UI_M,e=n.GM.gameRoot.poolManager,i={isHit:!0,afterActionQuery:null},a=Array.from(this.buffList),o=0;o<a.length;o++){var s=!1,d=a[o];if(d.type==u.BuffType.NORMAL_ATTACK_COUNTER){if(d.checkInvoke()){var p=n.GM.actionController,m=n.curActionData,_=m.attacker,g=p.getNormalAttackPower(this),C=1;C+=h.getAttributeRatio(this.getAttribute(),_.getAttribute()),C=l.clamp(C,0,100),m.damageType=C<1?u.DamageType.RESIST:C>1?u.DamageType.WEAK:u.DamageType.NONE;var f=p.calculateBaseDamage(g,C,_);f=_.checkImmortal(f);var E=p.getCounterActionQuery(m,this,d,f,"\u901a\u5e38\u653b\u6483\u30ab\u30a6\u30f3\u30bf\u30fc");i.isHit=!1,i.afterActionQuery=E,s=!0}}else if(d.type==u.BuffType.NORMAL_ATTACK_EVASION&&d.checkInvoke()){var T=new r,S={};S.targetNode=this.get_EffectShowNode(),S.parentNode=t.buffEffectNode,S.buffType=u.BuffType.NORMAL_ATTACK_EVASION,T.addAction(new c(S,e.playBuffInvokeEffect_Instant.bind(e))),i.isHit=!1,i.afterActionQuery=T,s=!0}s&&this.updateBuff(d,u.BuffEndType.ON_INVOKE)}return i},doAction:function(){var t=n.GM,e=n.curActionData;if(0==this.checkCanAction())e.commandType=u.CommandType.IDLE;else if(this.checkMiss(e)){e.commandType=u.CommandType.ATTACK;for(var i=0;i<e.target.length;i++)e.isHitList[i]=!1}e.commandType==u.CommandType.ATTACK?this.isDead||e.target[0].isDead||(t.playActionStartAnimation(this),this.playActionStartAnimation(e.commandType),this.doAttack(e),this.playActionEndAnimation(e.commandType),t.playActionEndAnimation(this)):e.commandType==u.CommandType.USE_SKILL&&(t.playActionStartAnimation(this),this.playActionStartAnimation(e.commandType),this.doSkill(e),this.playActionEndAnimation(e.commandType),t.playActionEndAnimation(this));for(var a=Array.from(this.buffList),o=0;o<a.length;o++){var s=a[o];s.endType==u.BuffEndType.ONCE&&this.updateBuff(s,u.BuffEndType.ONCE)}for(var l=0;l<e.target.length;l++){e.target[l].doReAction_afterAction(e)}this.isDead||this.badConditionAction_afterAction();var h=new r,d=new Map;d.set("timing",u.BuffEndType.action),h.addAction(new c(d,this.action_updateAllBuff.bind(this))),t.effectQueue.addQuery(h)},doAttack:function(t){var e=n.RM,i=n.GM.effectQueue,s=n.GM.actionController,h=new r,d=new Map,p=!1,m=[],_=n.GM.gameRoot.poolManager;this.badConditionInvokedAction(t),t.attacker.isEnemy||((d=new Map).targetList=t.target,d.isEnemyAttacker=t.attacker.isEnemy,(h=new r).addAction(new c(d,_.playHighlightOn.bind(_))),i.addQuery(h));for(var g=0;g<t.target.length;g++){var C=(R=t.target[g]).checkNormalAttackHit();!1===C.isHit&&(cc.log(C),m.push(C.afterActionQuery),t.isHitList[g]=!1)}var f=this.myNormalAttack,E=f.getEffectShowValue();if(d=new Map,this.nAttackDamageRatioList.length>0){var T=this.createDamageShowActionList(t,this.nAttackDamageRatioList);d.set("damageActionArr",T),d.set("hitEffName",f.getHitEffectName()),d.set("hitEffectAniName",f.getHitEffectAniName()),p=!0}d.set("groggy",this.checkGroggy()),d.set("particleFolder",e.particleResFolder),d.set("aniName",f.getAniName()+this.unitController.getAnimationAddName()),d.set("bgmVolumeAmount",1),d.set("changeBGMVolume",!1),d.set("battleUnit",this),d.set("selfEffectNode",this.get_EffectShowNode());var S=[];for(g=0;g<t.target.length;g++){var R=t.target[g];S.push(R.get_EffectShowNode())}d.set("targetEffectNodeList",S),d.set("startDelay",E/n.cur_GameSpeed),(h=new r).addAction(new c(d,this.unitController.playAttack.bind(this.unitController))),i.addQuery(h),this.executeAbilityBeforeBeAttack(t),h=new r;for(g=0;g<t.target.length;g++){R=t.target[g];var A=t.isHitList[g];if(A&&!1===p){h.addAction(R.beAttacked(t)),i.addQuery(h),h=new r;var b=new o;R.processAfterAttack(b,!0,!0),(d={}).effectQueue=b,h.addAction(new c(d,s.playEffectqueue.bind(s)))}else if(A){b=new o;R.processAfterAttack(b,!0,!0),(d={}).effectQueue=b,h.addAction(new c(d,s.playEffectqueue.bind(s)))}}if(i.addQuery(h),m.length>0)for(var M in m){var v=m[M];i.addQuery(v)}var P=this.getSkillRatePerAtk();this.incrementSkillRate(P),this.executeAbilityAfterBeAttack(t),h=new r,d=new Map;var I=Array.from(this.buffList);for(g=0;g<I.length;g++){var y=I[g],N=!1;if(y.type===u.BuffType.NORMAL_ATTACK_HP_DRAIN){var B=0;for(var M in t.damageArr)B+=t.damageArr[M];var L=parseInt(B*y.power/100);L=l.clamp(L,1,this.getMaxHp()),this.beHealed(h,L),i.addQuery(h),N=!0}N&&(cc.log(y),this.updateBuff(y,u.BuffEndType.ON_INVOKE))}this.checkTriggerInvoke(u.TriggerType.ON_NORMAL_ATTACK),this.checkUnisonAttack(t.target)&&(this.executeUnisonAttack(t.target),this.checkTriggerInvoke(u.TriggerType.ON_NORMAL_ATTACK)),this.checkTriggerAfterAttack(t),this.unitType===a.PLAYER_UNIT&&!1===this.isEnemy&&n.playerNormalAttackCount++,t.attacker.isEnemy||(h=new r,(d=new Map).targetList=t.target,d.isEnemyAttacker=t.attacker.isEnemy,h.addAction(new c(d,_.playHighlightOff.bind(_))),i.addQuery(h))},checkTriggerAfterAttack:function(t){n.GM.effectQueue;this.checkTriggerInvoke(u.TriggerType.ON_ATTACK),this.checkTriggerInvoke(u.TriggerType.ON_ATTACK_BY_ELEMENT,t.target,!0),this.curSkillRate>=d.CANUSESKILL_SKILLRATE&&this.checkTriggerInvoke(u.TriggerType.ON_ATTACK_ON_MAX_SKILL_RATE),this.checkTriggerInvoke(u.TriggerType.ON_ATTACK_MORE_THAN_HP),this.checkTriggerInvoke(u.TriggerType.ON_ATTACK_LESS_THAN_HP),t.isCriti&&this.checkTriggerInvoke(u.TriggerType.ON_ATTACK_CRITICAL),this.checkTriggerInvoke(u.TriggerType.ON_ATTACK_BAD_CONDITION,t.target,!0)},beAttacked:function(t){var e=this.checkDamage(t,this);e=this.checkImmortal(e),this.beAttackCounterInTurn++;var i=new o,a=new r,n=new Map;return this.decreaseHp(e,t),this.processDamageShow(a,this.curHp,e,t.damageType,t.isCriti,!1),i.addQuery(a),(n=new Map).effectQueue=i,new c(n,this.playLocalEffectqueue.bind(this))},processAfterAttack:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=new r,o=new Map;if(e){this.curSkillRate+=this.getSkillRatePerDamage(),this.curSkillRate=l.clamp(this.curSkillRate,0,d.SKILLRATE_MAX);var s={};s.skillRate=this.curSkillRate,a.addAction(new c(s,this.unitController.playSetSkillRate.bind(this.unitController))),t.addQuery(a)}i&&(a=new r,(o=new Map).set("timing",u.BuffEndType.BE_ATTACKED),a.addAction(new c(o,this.action_updateAllBuff.bind(this))),(o=new Map).set("timing",u.BuffEndType.BE_ATTACKED_CHECK_CHANCE),a.addAction(new c(o,this.action_updateAllBuff.bind(this))),t.addQuery(a)),this.isDead?((o=new Map).set("fadeTime",d.DEAD_FADEOUT_TIME/n.cur_GameSpeed),o.set("aliveExist",h.checkAliveUnitExist(this.isEnemy)),(a=new r).addAction(new c(o,this.unitController.playDead.bind(this.unitController))),a.addAction(new c(o,this.action_deleteAllBuff.bind(this))),t.addQuery(a)):((a=new r).addAction(this.unitController.play_DamageToIdle.bind(this.unitController)),t.addQuery(a))},subActionExist:function(t){var e=t.actionList;return void 0!=e&&e.length>1},checkDamage:function(t,e){var i=t.power,a=t.attacker,n=1;switch(t.effectConditionType){case u.EffectConditionType.SPECIFY_BUFF:for(var o=0;o<t.effectConditionList.length;o++)e.hasBuff(parseInt(t.effectConditionList[o]))&&(i*=t.effectConditionPowerUpRate)}if(t.useDesignatedElement)for(var r in t.designatedElement){var s=t.designatedElement[r];n+=h.getAttributeRatio(s,e.getAttribute())}else n+=h.getAttributeRatio(a.getAttribute(),e.getAttribute());n=l.clamp(n,0,100),t.damageType=n<1?u.DamageType.RESIST:n>1?u.DamageType.WEAK:u.DamageType.NONE;var c=e.getDef(),d=h.caluculateNormalAttackDamage(i,c,t.isCriti);d*=n;for(var p=Array.from(a.buffList),m=0;m<p.length;m++){var _=p[m];if(_.type==u.BuffType.ATK_CHANGE_BY_ELEMENT)cc.log("before atkChange_ByElement damage  :"+d),cc.log(_),e.getAttribute()==_.elementType&&(d=parseInt(d*_.power/100)),cc.log("after   atkChange_ByElement damage  :"+d);else if(_.type==u.BuffType.LOW_HP_ATK_UP){cc.log("before lowHp_AtkUp dmg:"+d),cc.log(_);var g=(_.power-100)/100*(1-a.getCurHp()/a.getMaxHp());cc.log(g+":buffRatio"),d=parseInt(d*(1+g)),cc.log("after lowHp_AtkUp dmg:"+d)}}for(var C=Array.from(e.buffList),f=0;f<C.length;f++){var E=C[f],T=!1;if(E.type==u.BuffType.DAMAGE_CHANGE)cc.log("before damageChange dmg:"+d),cc.log(E),d+=parseInt(d*E.power/100),cc.log("after damageChange dmg:"+d),T=!0;else if(E.type==u.BuffType.DAMAGE_CHANGE_BY_ELEMENT){var S=E.elementType;if(t.useDesignatedElement)for(var r in t.designatedElement){S==t.designatedElement[r]&&(cc.log("before element damageChange dmg:"+d),cc.log(E),d+=parseInt(d*E.power/100),cc.log("after element damageChange dmg:"+d),T=!0)}else S==a.getAttribute()&&(cc.log("before element damageChange dmg:"+d),cc.log(E),d+=parseInt(d*E.power/100),cc.log("after element damageChange dmg:"+d),T=!0)}else if(E.type==u.BuffType.DAMAGE_BARRIER){var R=E.endVal;cc.log("damageBarrier buffVal :"+R);var A=0;A=R>=d?d:R,A=l.clamp(A,1,A),cc.log("reduceVal :"+A),d=parseInt(d-A),e.updateBuff(E,u.BuffEndType.DAMAGE_COUNT,A)}else if(E.type==u.BuffType.SLEEP)cc.log("before sleep dmg:"+d),cc.log(E),d+=parseInt(d*E.power/100),cc.log("after sleep dmg:"+d),T=!0;else if(E.type===u.BuffType.LOW_HP_DEF_UP){cc.log("before lowHp_DefUp dmg:"+d),cc.log(E);var b=(E.power-100)/100*(1-e.getCurHp()/e.getMaxHp());cc.log(b+":buffRatio"),d=parseInt(d/(1+b)),cc.log("after lowHp_DefUp dmg:"+d)}T&&e.updateBuff(E,u.BuffEndType.ON_INVOKE)}return d=l.clamp(d,1,d)},doReAction_afterAction:function(t){if(this.isDead)return!1;var e=Array.from(this.buffList);switch(t.actionType){case u.ActionType.ATTACK:this._doReAction_afterAttack(t,e);break;case u.ActionType.HEAL:this._doReAction_afterHeal(t,e)}},_doReAction_afterAttack:function(t,e){for(var i=n.GM.effectQueue,a=n.GM.actionController,o=0;o<e.length;o++){var r=e[o];if(r.checkInvoke())switch(r.type){case u.BuffType.ALL_COUNTER:var s=parseInt(t.power*r.power/100);s=t.attacker.checkImmortal(s);var c=a.getCounterActionQuery(t,this,r,s,"\u53cd\u5c04");i.addQuery(c),this.updateBuff(r,u.BuffEndType.ON_INVOKE)}}},_doReAction_afterHeal:function(t,e){cc.log("\u56de\u5fa9\u3078\u306e\u30ea\u30a2\u30af\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a")},checkFutureDead:function(t){this.curHp-t<=0&&(this.isDead=!0,n.curActionData.deadUnitList.push(this))},decreaseHp:function(t,e){cc.log("decreaseHp = "+t),this.curHp-=t,cc.log("decreaseHp curhp = "+this.curHp),this.curHp<=0&&(this.curHp=0,this.isDead=!0,cc.log("processDamageShow = "+this.isDead),n.curActionData.deadUnitList.push(this)),e&&Array.isArray(e.damageArr)?n.GM.actionController.addDamageRecord(e,t):n.GM.actionController.addBuffDamageRecord(this.isEnemy,t)},processDamageShow:function(t,e,i,a,o,r){cc.log("processDamageShow");var s={};s.hp=e,t.addAction(new c(s,this.unitController.playSetHp.bind(this.unitController)));var h=new Map,p={};p.isDead=this.isDead,t.addAction(new c(p,this.unitController.playBeAttacked.bind(this.unitController)));var m=n.UI_M.damageNumbers,_=null;h=new Map;var g=1;this.isEnemy||(g=.7),o?(m=n.UI_M.criticalNumbers,_=n.UI_M.criticalTextSpriteFrame,g*=1.5,this.showCriticalAnimation(t,this.isEnemy)):a===u.DamageType.WEAK?(m=n.UI_M.weakNumbers,_=n.UI_M.weakTextSpriteFrame,g*=1.5,this.showWeakAnimation(t,this.isEnemy)):a===u.DamageType.RESIST&&(m=n.UI_M.resistNumbers,g*=.7,_=n.UI_M.resistTextSpriteFrame),h.set("damage",i),h.set("node",this.get_MainObjectNode()),h.set("dmgShowNode",this.get_DamageShowNode()),this.isEnemy?(h.set("parentNode",n.UI_M.monsterDamageCenter),h.set("anchorPoint",cc.v2(.5,.5)),h.set("textPosition",cc.v2(0,0))):(h.set("parentNode",n.UI_M.damageCenter),h.set("anchorPoint",cc.v2(0,.5)),h.set("textPosition",cc.v2(-15,0))),cc.log("parent = ",h.get("parentNode").parent),h.set("damageTextSpriteFrame",_),h.set("numSpriteFrames",m),h.set("speed",n.cur_GameSpeed),h.set("scale",g);var C=cc.v2(0,0);if(r){var f=d.SHOW_DAMAGE_RANDOM_POS;C=cc.v2(l.getRandomArbitrary(-f,f),l.getRandomArbitrary(-f,f))}h.set("modiPos",C);var E=n.GM.gameRoot.poolManager;t.addAction(new c(h,E.playDamageNum.bind(E)))},showCriticalAnimation:function(t,e){var i={};i.targetNode=n.GM.gameRoot.bgWhiteNode,i.blinkCount=1,i.blinkTime=.1,i.fadeTime=.1,i.color=cc.color(255,255,255),t.addAction(new c(i,n.UI_M.flashNode.bind(n.UI_M)));var a={shakeTime:.1,shakeCount:2};e?(a.targetNode=this.unitController.node,a.shakeRangeX=10,a.shakeRangeY=10,t.addAction(new c(a,n.UI_M.shakeNode.bind(n.UI_M)))):(a.targetNode=n.GM.gameRoot.bgBattleNode,a.shakeRangeX=30,a.shakeRangeY=30,t.addAction(new c(a,n.UI_M.shakeNode.bind(n.UI_M))))},showWeakAnimation:function(t,e){var i={shakeTime:.1,shakeCount:2};e?(i.targetNode=this.unitController.node,i.shakeRangeX=10,i.shakeRangeY=10,t.addAction(new c(i,n.UI_M.shakeNode.bind(n.UI_M)))):(i.targetNode=n.GM.gameRoot.bgBattleNode,i.shakeRangeX=30,i.shakeRangeY=30,t.addAction(new c(i,n.UI_M.shakeNode.bind(n.UI_M))))},beHealed:function(t,e){var i=n.GM.gameRoot.poolManager,a=new Map;this.curHp+=e,this.curHp=l.clamp(this.curHp,1,this.getMaxHp());var o={};o.hp=this.curHp,t.addAction(new c(o,this.unitController.playSetHp.bind(this.unitController))),a=new Map;var r=1;this.isEnemy||(r=.7),a.set("healPow",e),a.set("numShowNode",this.get_DamageShowNode()),a.set("effShowNode",this.get_EffectShowNode()),this.isEnemy?a.set("parentNode",n.UI_M.monsterDamageCenter):a.set("parentNode",n.UI_M.damageCenter),a.set("numSpriteFrames",n.UI_M.healNumbers),a.set("speed",n.cur_GameSpeed),a.set("scale",r),this.isEnemy?a.set("anchorPoint",cc.v2(.5,.5)):a.set("anchorPoint",cc.v2(0,.5)),t.addAction(new c(a,i.playHeal.bind(i)))},beRevive:function(t,e){var i=n.GM.gameRoot.poolManager,a=new Map;this.curHp=e;var o={};o.hp=this.curHp,t.addAction(new c(o,this.unitController.playSetHp.bind(this.unitController))),this.isDead&&(this.isDead=!1),a=new Map;var r=1;this.isEnemy||(r=.7),a.set("healPow",e),a.set("numShowNode",this.get_DamageShowNode()),a.set("effShowNode",this.get_EffectShowNode()),this.isEnemy?a.set("parentNode",n.UI_M.monsterDamageCenter):a.set("parentNode",n.UI_M.damageCenter),a.set("numSpriteFrames",n.UI_M.healNumbers),a.set("speed",n.cur_GameSpeed),a.set("scale",r),this.isEnemy?a.set("anchorPoint",cc.v2(.5,.5)):a.set("anchorPoint",cc.v2(0,.5)),t.addAction(new c(a,i.playHeal.bind(i))),(a=new Map).set("groggy",this.checkGroggy()),t.addAction(new c(a,this.unitController.playRevive.bind(this.unitController)))},playLocalEffectqueue:function(t,e){e.effectQueue.play(t)},destroyObjects:function(){this.unitController.node.destroy()},doSkill:function(t){cc.log("doSkill");var e=n.GM.effectQueue,i=n.GM.cameraController,o=n.RM,s=t.attacker.mySkill,l=s.actionList[0],p=l.getActionType(),m=h.getUnitList(this.isEnemy),_=n.GM.gameRoot.poolManager;if(t.attacker.isEnemy||((C=new Map).targetList=t.target,C.isEnemyAttacker=t.attacker.isEnemy,(g=new r).addAction(new c(C,_.playHighlightOn.bind(_))),e.addQuery(g)),void 0!==l){var g=new r,C=new Map;this.playSkillStartAnimation();var f={};f.battleUnit=this,f.speed=n.cur_GameSpeed,f.battleSkill=s,g.addAction(new c(f,_.playSkillCutin.bind(_)));var E=!1,T=!1,S=n.GM.soundManager.bgmVolume,R=new Map,A=s.getEffectShowType();R.set("groggy",this.checkGroggy()),R.set("particleFolder",o.particleResFolder),R.set("battleUnit",this),R.set("selfEffectNode",this.get_EffectShowNode());for(var b=new Array,M=0;M<t.target.length;M++){var v=t.target[M];b.push(v.get_EffectShowNode())}if(R.set("targetEffectNodeList",b),this.unitType===a.PLAYER_UNIT&&n.now_skill_skip_mode){var P=this.myNormalAttack,I=(P.getEffectShowType(),P.getEffectShowValue());if(this.nAttackDamageRatioList.length>0){var y=this.createDamageShowActionList(t,this.nAttackDamageRatioList);R.set("damageActionArr",y),R.set("hitEffName",P.getHitEffectName()),R.set("hitEffectAniName",P.getHitEffectAniName()),E=!0}R.set("aniName",P.getAniName()),R.set("startDelay",I/n.cur_GameSpeed),g.addAction(new c(R,this.unitController.playAttack.bind(this.unitController)))}else{if(p===u.ActionType.ATTACK&&this.skillDamageRatioList.length>0){var N=this.createDamageShowActionList(t,this.skillDamageRatioList);R.set("damageActionArr",N),R.set("hitEffName",s.getHitEffectName()),R.set("hitEffectAniName",this.getHitEffectAniNameFromMultiple(s)),E=!0}R.set("aniName",s.getAniName()+this.unitController.getAnimationAddName());var B=s.getBgmVolumeAmount();if(B<1){var L=n.GM.battleEventController;C=new Map,(F={}).targetVolume=S*B,F.fadeTime=d.BGM_FADEOUT_TIME_INSKILL,g.addAction(new c(F,L.changeBgmVolume.bind(L))),T=!0}if(A==u.SkillEffectShowType.SPINE_ANI_SHOW)this.unitType==a.PLAYER_UNIT&&m.forEach(function(t){this!=t&&g.addAction(new c(null,t.unitController.playScaleHide.bind(t.unitController)))},this),g.addAction(new c(R,this.unitController.playSpineSkill.bind(this.unitController)));else if(A==u.SkillEffectShowType.FULL_SPINE_EFFECT_BY_SPINE_EVENT){m.forEach(function(t){g.addAction(new c(null,t.unitController.playCardHide.bind(t.unitController)))},this);var w=h.getRefName(this.getId(),s.getSpineName()),D=o.getResource(w),U={};U.fullSpineData=D,U.parentNode=n.UI_M.fullSkillEffectCenter,U.aniName=s.getAniName(),U.battleUnit=this,U.hitEffName=s.getHitEffectName(),U.hitEffectAniName=this.getHitEffectAniNameFromMultiple(s),U.damageActionArr=N,g.addAction(new c(U,this.unitController.playFullSpineSkill_UseEvent.bind(this.unitController)))}}if(e.addQuery(g),this.playSkillEndAnimation(),T){var F,O=n.GM.battleEventController;g=new r,(F={}).targetVolume=S,F.fadeTime=d.BGM_FADEOUT_TIME_INSKILL,g.addAction(new c(F,O.changeBgmVolume.bind(O))),e.addQuery(g)}if(p===u.ActionType.ATTACK){if(!1===E){g=new r;for(var k=0;k<t.target.length;k++){t.target[k].checkTriggerInvoke(u.TriggerType.BE_ATTACK_BEFORE_TIMING)}g=new r;for(var x=0;x<t.target.length;x++)g.addAction(t.target[x].beAttacked(t));e.addQuery(g)}this.processAfterSkillAttack(e,t)}else n.GM.skillController.checkEachAction(t,l);this.curSkillRate=0,g=new r,C=new Map;var V={};if(V.skillRate=this.curSkillRate,g.addAction(new c(V,this.unitController.playSetSkillRate.bind(this.unitController))),this.unitType==a.PLAYER_UNIT&&n.now_skill_skip_mode||(A==u.SkillEffectShowType.SPINE_ANI_SHOW?((C=new Map).set("groggy",this.checkGroggy()),g.addAction(new c(C,this.unitController.play_SpineSkillReturnToIdle.bind(this.unitController))),m.forEach(function(t){this!=t&&g.addAction(new c(C,t.unitController.playScaleRestore.bind(t.unitController)))},this)):m.forEach(function(t){g.addAction(new c(C,t.unitController.playCardRestore.bind(t.unitController)))},this)),this.unitType==a.MONSTER&&h.checkLastLiveUnit(this)&&g.addAction(new c(null,i.subCameraRestore.bind(i))),e.addQuery(g),this.subActionExist(s))for(var G=s.actionList,q=1;q<G.length;q++){var H=G[q];n.GM.skillController.checkEachAction(t,H)}this.checkTriggerInvoke(u.TriggerType.ON_SKILL),p==u.ActionType.ATTACK&&(this.checkTriggerInvoke(u.TriggerType.ON_SKILL_ATTACK),this.checkTriggerAfterAttack(t)),this.unitType==a.PLAYER_UNIT&&0==this.isEnemy&&n.playerSkillCount++,this.isEnemy&&this.isRageMode&&(this.isUsedSkill=!0),t.attacker.isEnemy||(g=new r,(C=new Map).targetList=t.target,C.isEnemyAttacker=t.attacker.isEnemy,g.addAction(new c(C,_.playHighlightOff.bind(_))),e.addQuery(g))}else cc.log("error   mainAction is undefined ")},processAfterSkillAttack:function(t,e){for(var i=0;i<e.target.length;i++){e.target[i].processAfterAttack(t,!0,!0)}var a=new Array;a.push(e.attacker);for(var n=0;n<e.target.length;n++){var o=e.target[n];o.checkTriggerInvoke(u.TriggerType.BE_ATTACK_AFTER_TIMING),o.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_BY_ELEMENT,a,!0),o.curSkillRate>=d.CANUSESKILL_SKILLRATE&&o.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_ON_MAX_SKILL_RATE),o.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_MORE_THAN_HP),o.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_LESS_THAN_HP)}},checkTriggerInvoke:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],!(arguments.length>2&&void 0!==arguments[2])||arguments[2];cc.log("checkTriggerInvoke need override")},doAbilityAttack:function(t,e){var i=new r,a=new Map,o=!1;a.set("groggy",this.checkGroggy()),a.set("particleFolder",n.RM.particleResFolder),a.set("battleUnit",this),a.set("selfEffectNode",this.get_EffectShowNode());for(var s=new Array,l=0;l<e.target.length;l++){var h=e.target[l];s.push(h.get_EffectShowNode())}a.set("targetEffectNodeList",s);var d=this.myNormalAttack,p=d.getEffectShowValue();if(this.nAttackDamageRatioList.length>0){var m=this.createDamageShowActionList(e,this.nAttackDamageRatioList);a.set("damageActionArr",m),a.set("hitEffName",d.getHitEffectName()),a.set("hitEffectAniName",d.getHitEffectAniName()),o=!0}if(a.set("aniName",d.getAniName()),a.set("startDelay",p/n.cur_GameSpeed),i.addAction(new c(a,this.unitController.playAttack.bind(this.unitController))),t.addQuery(i),!1===o){i=new r;for(var _=0;_<e.target.length;_++){e.target[_].checkTriggerInvoke(u.TriggerType.BE_ATTACK_BEFORE_TIMING)}i=new r;for(var g=0;g<e.target.length;g++)i.addAction(e.target[g].beAttacked(e));t.addQuery(i)}this.processAfterSkillAttack(t,e)},action_addBuff:function(t,e){var i=e.buff;this.addBuff(i),t()},action_updateAllBuff:function(t,e){var i=e.get("timing");this.updateAllBuff(i),t()},action_deleteAllBuff:function(t,e){this.deleteAllBuff(),t()},action_removeBuff:function(t,e){var i=e.buff;this.removeBuff(i),t()},badConditionAction_afterAction:function(){n.GM,n.GM.effectQueue,n.GM.gameRoot.poolManager,n.GM.soundManager,n.UI_M,new r;this.hasBuff(u.BuffType.POISON)},playEffectSound_buff:function(t,e){var i=e.get("buff"),a=n.GM.soundManager;i.type===u.BuffType.POISON?a.playSE(n.RM.soundResourceList.Poison):i.type===u.BuffType.PARALYSIS&&a.playSE(n.RM.soundResourceList.Paralysis),t()},checkBuffAction:function(t){var e=n.GM.effectQueue,i=new r,a=Array.from(this.buffList);if(t===u.TriggerType.GENERAL_TURN_END){for(var o=0,s=0;s<a.length;s++){var h=!1;if((g=a[s]).type===u.BuffType.REGENERATION){cc.log(g);var p=Number(g.getDefaultEffectValue(300));cc.log("buff regeneration invoke   healPow  : "+p),o+=p*(1+this.get_RecoveryPowerOnHeal()),h=!0}else if(g.type===u.BuffType.AUTO_PLUS_SKILL_RATE){cc.log(g);var m=Number(g.getDefaultEffectValue());this.curSkillRate+=m,this.curSkillRate=l.clamp(this.curSkillRate,0,d.SKILLRATE_MAX);var _={};_.skillRate=this.curSkillRate,i.addAction(new c(_,this.unitController.playSetSkillRate.bind(this.unitController))),e.addQuery(i),h=!0}h&&this.updateBuff(g,u.BuffEndType.ON_INVOKE,0)}o&&(this.beHealed(i,o),e.addQuery(i))}else if(t===u.TriggerType.MY_TURN_START)for(s=0;s<a.length;s++){var g;h=!1;(g=a[s]).type===u.BuffType.POISON&&(g.doBuffAction?(this.executeContinuePoison(g),this.updateBuff(g,u.BuffEndType.ON_INVOKE,0)):g.doBuffAction=!0)}else u.TriggerType.MY_TURN_END},executeContinuePoison:function(t){var e=new r,i=0;switch(t.powerType){case u.PowerType.PER_BY_DEF:i=this.getMaxHp()*t.power/100;break;case u.PowerType.FIX:case u.PowerType.CHANGE_TO:i=parseInt(t.power)}var a=new o,s=new r;i=this.checkImmortal(i),this.decreaseHp(i),this.processDamageShow(s,this.curHp,i,u.DamageType.NONE,!1,!1);var l=new Map;l.set("buff",t),s.addAction(new c(l,this.playEffectSound_buff.bind(this))),a.addQuery(s),this.processAfterAttack(a,!1,!1),(l={}).effectQueue=a,e.addAction(new c(l,this.playLocalEffectqueue.bind(this))),n.GM.effectQueue.addQuery(e)},invokeBuffAction:function(t){var e=n.GM.effectQueue,i=(n.UI_M,new r),a=new Map;if(t.type==u.BuffType.DEATH_SENTENCE){cc.log("deathSentence  invoke"),this.curHp=0,this.isDead=!0;var o={};o.hp=this.curHp,i.addAction(new c(o,this.unitController.playSetHp.bind(this.unitController))),e.addQuery(i),i=new r,(a=new Map).set("fadeTime",d.DEAD_FADEOUT_TIME/n.cur_GameSpeed),i.addAction(new c(a,this.unitController.playDead.bind(this.unitController))),i.addAction(new c(a,this.action_deleteAllBuff.bind(this))),s,e.addQuery(i)}},badConditionInvokedAction:function(t){if(t.badConditionInvoked&&!t.badConditionBuff)return},createDamageShowActionList:function(t,e){for(var i=new Array,a=0;a<t.target.length;a++){var n=t.target[a];if(t.isHitList[a]){var s=[];s.target=n;var c=n.checkDamage(t,n);c=n.checkImmortal(c),s.totalDamage=c,s.damageType=t.damageType,s.isCriti=t.isCriti,n.checkFutureDead(c),n.beAttackCounterInTurn++;for(var l=new Array,h=0,d=0;d<e.length;d++)if(d>=e.length-1){var p=parseInt(c-h);l.push(p)}else{var m=parseInt(c*e[d]*.01);h+=m,l.push(m)}s.dmgList=l,i.push(s)}}var _=new Array;_.push(t.attacker);for(var g=[],C=function(e){var a=i[e],n=a.target,s=a.dmgList;E=a.damageType,T=a.isCriti;var c=[];n.checkTriggerInvoke(u.TriggerType.BE_ATTACK_BEFORE_TIMING,_,!1);for(var l=function(e){(function(i,a){var l=s[e];n.decreaseHp(l,t);var u=n.curHp;c.push(function(){var t=new o,s=new r;0===e?n.processDamageShow(s,u,l,i,a,!1):n.processDamageShow(s,u,l,i,a,!0),t.addQuery(s),t.play(function(){})})})(E,T)},h=0;h<s.length;h++)l(h);g.push(c)},f=0;f<i.length;f++){var E,T;C(f)}return g},checkImmortal:function(t){if(this.getCurHp()-t>0)return t;if(this.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_MORTAL))return t=this.getCurHp()-1,t=l.clamp(t,0,t),this.doImmortal(),t;for(var e=Array.from(this.buffList),i=0;i<e.length;i++){var a=e[i];a.type==u.BuffType.IMMORTAL&&(t=this.getCurHp()-1,t=l.clamp(t,0,t),this.doImmortal(),this.updateBuff(a,u.BuffEndType.ON_INVOKE))}return t},doImmortal:function(){var t=n.GM.effectQueue,e=n.GM.gameRoot.poolManager,i=n.UI_M,a=new r,o={};o.targetNode=this.get_EffectShowNode(),o.parentNode=i.buffEffectNode,o.buffType=u.BuffType.IMMORTAL,a.addAction(new c(o,e.playBuffInvokeEffect_Instant.bind(e))),t.addQuery(a)},makeBattleTransactionData:function(){cc.log("makeBattleTransactionData need override")},restoreBattleTransaction:function(t){cc.log("restoreBattleTransaction need override")},makeBattleContinueData:function(){cc.log("makeBattleContinueData need override")},restoreBattleContinueData:function(t){cc.log("restoreBattleContinueData need override")},playActionStartAnimation:function(){},playActionEndAnimation:function(){},playSkillStartAnimation:function(){},playSkillEndAnimation:function(){},incrementSkillRate:function(t){var e=new r,i=n.GM.effectQueue;this.curSkillRate+=t,this.curSkillRate=l.clamp(this.curSkillRate,0,d.SKILLRATE_MAX);var a={};a.skillRate=this.curSkillRate,e.addAction(new c(a,this.unitController.playSetSkillRate.bind(this.unitController))),i.addQuery(e)},executeAbilityBeforeBeAttack:function(t){for(var e=0;e<t.target.length;e++){var i=t.target[e];t.isHitList[e]&&i.checkTriggerInvoke(u.TriggerType.BE_ATTACK_BEFORE_TIMING)}},executeAbilityAfterBeAttack:function(t){var e=[];e.push(t.attacker);for(var i=0;i<t.target.length;i++){var a=t.target[i];a.checkTriggerInvoke(u.TriggerType.BE_ATTACK_AFTER_TIMING),a.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_BY_ELEMENT,e,!0),a.curSkillRate>=d.CANUSESKILL_SKILLRATE&&a.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_ON_MAX_SKILL_RATE),a.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_MORE_THAN_HP),a.checkTriggerInvoke(u.TriggerType.BE_ATTACKED_LESS_THAN_HP)}},canUseSkill:function(t){return!!(t&&this.curSkillRate>=d.CANUSESKILL_SKILLRATE)},checkUnisonAttack:function(){return!1},executeUnisonAttack:function(){},getHitEffectAniNameFromMultiple:function(t){return t.getHitEffectAniName()}});e.exports=m,cc._RF.pop()},{BattleAbility:"BattleAbility",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleDeckUnit:"BattleDeckUnit",BattleFunction:"BattleFunction",BattleMonsterModel:"BattleMonsterModel",BattleNormalAttack:"BattleNormalAttack",BattleSkill:"BattleSkill",Buff:"Buff",CharacterNormalAttackModel:"CharacterNormalAttackModel",CommonFunction:"CommonFunction",EnumTypes:"EnumTypes",EquipmentConst:"EquipmentConst",GameEffectQueue:"GameEffectQueue"}],BoostModel:[function(t,e,i){"use strict";cc._RF.push(e,"e55f2uVKtJLXamoFGhVTDRw","BoostModel");var a=t("UserBoostModel"),n=t("Singleton");cc.Class({userData:void 0,_itemMainMaster:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t)},getBoostType:function(){return this.userData.getBoostType()},getItemId:function(){return this.userData.getItemId()},getParameter:function(){return this.userData.getParameter()},getEndDate:function(){return this.userData.getEndDate()},getStartDate:function(){return this.userData.getStartDate()},getItemMainMaster:function(){return this._itemMainMaster||(this._itemMainMaster=n.dao.ItemMainMasters.find(function(t){return t.getItemId()===this.userData.getItemId()}.bind(this))),this._itemMainMaster}});cc._RF.pop()},{Singleton:"Singleton",UserBoostModel:"UserBoostModel"}],BootRoot:[function(t,e,i){"use strict";cc._RF.push(e,"f06a6SZVa5H9Zu1BPt524We","BootRoot");var a=t("Singleton"),n=t("MinigamePlayData"),o=t("AdvSingleton"),r=t("Async"),s=t("OAuth"),c=t("Environment"),l=t("ErrorManager"),u=t("NoticeManager"),h=t("ErrorModel"),d=t("FixedTimeScheduler"),p=t("SingletonConst"),m=t("StaticResourceConst"),_=t("LocalDataConst"),g=t("EnvironmentConst"),C=(t("ErrorCode"),t("PopupUtils")),f=t("FileLoaderManager"),E=t("DownManifestManager"),T=t("MemoryManager"),S=t("AdvSingletonConst"),R=t("ResLoader"),A=(t("ResLeakChecker"),t("SoundManager"));cc.Class({extends:cc.Component,properties:{hotUpdatePrefab:cc.Prefab},ctor:function(){function t(t){cc.error(t),a[p.ERROR_MANAGER]}a.dao={},a.res={},a.staticRes={},a.localData={},a.localData[_.REQUEST_API_LIST]=[],a.localData[_.REQUEST_API_DEL_LIST]=[],a.localData[_.IS_OPEN_SYSTEM_POPUP]=!1,a.localData[_.USER_VERSION]={},a.soundManager=null,a.ServiceManager=null,window.setIntervalId&&clearInterval(window.setIntervalId),o.Environment=null,o.downManifestManager=null,o.fileLoaderManager=null,o.localData={},o.memoryManager=null,o.res={},o.soundManager=null,n.initialize(),window.onerror=function(e,i,a,n,o){t(o)},window.addEventListener("unhandledrejection",function(e){t(e)}),window.addEventListener("rejectionhandled",function(e){t(e)})},onLoad:function(){a.fileLoaderManager=new f,a.downManifestManager=new E,a.memoryManager=new T,a.soundManager=new A,a[p.SCHEDULER]=new d;var t=[];t.push(this._setEnvironment.bind(this)),t.push(this._setErrorPopup.bind(this)),t.push(this._setAndroidBackBtn.bind(this)),t.push(this._setErrorManager.bind(this)),t.push(this._setNoticeManager.bind(this)),t.push(this._setLoading.bind(this)),t.push(this._setStaticResource.bind(this)),t.push(this._setUnsupportedFunc.bind(this)),t.push(this._transitionNextScene.bind(this)),r.waterfall(t)},_setEnvironment:function(t){R.loader.loadRes("system/environment",function(e,i){if(null===e){var n=new c(i.json);a[p.ENVIRONMENT]=n,o[S.ENVIRONMENT]=n;var r=new s;return r.set("type",n.getAuthType()),r.set("consumer_key",n.getAuthConsumerKey()),r.set("consumer_secret",n.getAuthConsumerSecret()),r.set("signature_method",n.getAuthSignatureMethod()),a[p.OAUTH]=r,t()}cc.log("ERROR: Not Fround Environment File")},m.USE_KEY)},_setErrorManager:function(t){R.loader.loadRes("system/error",function(e,i){if(null===e){var n=i.json.map(function(t){return new h(t)});return a[p.ERROR_MANAGER]=new l(n),t()}cc.log("[error] Not Fround Error File")},m.USE_KEY)},_setErrorPopup:function(t){var e=[];e.push(function(t){R.loader.loadRes(m.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH,cc.AnimationClip,function(e,i){a.staticRes[m.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH]=i,t()},m.USE_KEY)}),e.push(function(t){R.loader.loadRes(m.POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH,cc.AnimationClip,function(e,i){a.staticRes[m.POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH]=i,t()},m.USE_KEY)}),e.push(function(t){R.loader.loadRes(m.DIALOG_PREFAB_PATH,cc.Prefab,function(e,i){a.staticRes[m.DIALOG_PREFAB_PATH]=i,t()},m.USE_KEY)}),r.waterfall(e,t)},_setAndroidBackBtn:function(t){if(null==a.persistNode){var e=new cc.Node;return e.isEffecte=!0,cc.game.addPersistRootNode(e),a.persistNode=e,cc.sys.os===cc.sys.OS_ANDROID&&cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(t){switch(t.keyCode){case cc.macro.KEY.back:if(!e.isEffecte)return;e.isEffecte=!1,C.openSystemPopupYesNo("\u30a2\u30d7\u30ea\u7d42\u4e86\u78ba\u8a8d","DeepOne \u865a\u7121\u3068\u5922\u5e7b\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8 \u3092\u7d42\u4e86\u3057\u307e\u3059","",!1,function(){e.isEffecte=!0,cc.game.end()},function(){e.isEffecte=!0},"\u306f\u3044","\u3044\u3044\u3048",!0)}},e),t()}t()},_setNoticeManager:function(t){return a[p.NOTICE_MANAGER]=new u,t()},_setLoading:function(t){var e=[];e.push(function(t){R.loader.loadRes(m.LOADING_SIMPLE_PREFAB_PATH,cc.Prefab,function(e,i){a.staticRes[m.LOADING_SIMPLE_PREFAB_PATH]=i,t()},m.USE_KEY)}),e.push(function(t){R.loader.loadRes(m.LOADING_PROGRESS_CHARA_PREFAB_PATH,cc.Prefab,function(e,i){a.staticRes[m.LOADING_PROGRESS_CHARA_PREFAB_PATH]=i,t()},m.USE_KEY)}),e.push(function(t){R.loader.loadRes(m.LOADING_PROGRESS_TIPS_PREFAB_PATH,cc.Prefab,function(e,i){a.staticRes[m.LOADING_PROGRESS_TIPS_PREFAB_PATH]=i,t()},m.USE_KEY)}),r.waterfall(e,t)},_setStaticResource:function(t){var e=[];e.push(function(t){R.loader.loadRes(m.SIMPLE_TEX_PATH,cc.SpriteFrame,function(e,i){a.staticRes[m.SIMPLE_TEX_PATH]=i,t()},m.USE_KEY)}),e.push(function(t){R.loader.loadRes(m.SE.START,cc.AudioClip,function(e,i){a.staticRes[m.SE.START]=i,t()},m.USE_KEY)}),e.push(function(t){R.loader.loadRes(m.SE.SELECT,cc.AudioClip,function(e,i){a.staticRes[m.SE.SELECT]=i,t()},m.USE_KEY)}),e.push(function(t){R.loader.loadRes(m.TAP_EFFECT_PREFAB_PATH,cc.Prefab,function(e,i){a.staticRes[m.TAP_EFFECT_PREFAB_PATH]=i,t()},m.USE_KEY)}),r.waterfall(e,t)},_transitionNextScene:function(t){a[p.ENVIRONMENT].getAuthType()===g.AUTH_TYPE_VALUES.DEVELOP?(cc.log("authType is develop"),cc.director.loadScene("DummyLoginScene.fire")):(cc.log("authType is release"),cc.log("Scene do not exist"),cc.director.loadScene("TitleScene.fire")),t()},_setUnsupportedFunc:function(t){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null===this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var a=arguments[1],n=0;n<i;){var o=e[n];if(t.call(a,o,n,e))return o;n++}},configurable:!0,writable:!0}),Object.prototype.find||Object.defineProperty(Object.prototype,"find",{value:function(t){if(null===this)throw new TypeError('"this" is null or not defined');var e=Object(this);if("function"!=typeof t)throw new TypeError("predicate must be a function");var i=arguments[1];for(var a in this)if(t.call(i,this[a],a,e))return this[a]},configurable:!0,writable:!0}),Object.prototype.filter||Object.defineProperty(Object.prototype,"filter",{value:function(t){if(null===this)throw new TypeError('"this" is null or not defined');Object(this).length;if("function"!=typeof t)throw new TypeError("predicate must be a function");var e=arguments[1],i={};for(var a in this)t.call(e,this[a],a,this)&&(i[a]=this[a]);return i},configurable:!0,writable:!0}),Number.parseInt||(Number.parseInt=parseInt),Number.parseFloat||(Number.parseFloat=parseFloat),t()}}),cc._RF.pop()},{AdvSingleton:"AdvSingleton",AdvSingletonConst:"AdvSingletonConst",Async:"Async",DownManifestManager:"DownManifestManager",Environment:"Environment",EnvironmentConst:"EnvironmentConst",ErrorCode:"ErrorCode",ErrorManager:"ErrorManager",ErrorModel:"ErrorModel",FileLoaderManager:"FileLoaderManager",FixedTimeScheduler:"FixedTimeScheduler",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",MinigamePlayData:"MinigamePlayData",NoticeManager:"NoticeManager",OAuth:"OAuth",PopupUtils:"PopupUtils",ResLeakChecker:"ResLeakChecker",ResLoader:"ResLoader",Singleton:"Singleton",SingletonConst:"SingletonConst",SoundManager:"SoundManager",StaticResourceConst:"StaticResourceConst"}],BossUnitCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"4308cZfWDNEJLY+PhrDHegI","BossUnitCtrl");var a=t("BattleData"),n=t("MonsterUnitCtrl");cc.Class({extends:n,playRage:function(t,e){this.myBattleUnit.spineRageBack.setAnimation(0,"animation",!1);var i=this;this.myBattleUnit.mainAvatar.setAnimation(0,"raging_in",!1),this.myBattleUnit.mainAvatar.setCompleteListener(function(e,a){i.myBattleUnit.mainAvatar.setCompleteListener(null),i.myBattleUnit.mainAvatar.setAnimation(0,"idle"+i.getAnimationAddName(),!0),t()}),a.GM.soundManager.playSE(a.RM.soundResourceList.Enraged)},getAnimationAddName:function(){return this.myBattleUnit.isRageMode?"_raging":""}});cc._RF.pop()},{BattleData:"BattleData",MonsterUnitCtrl:"MonsterUnitCtrl"}],BpRecoveryPopup:[function(t,e,i){"use strict";cc._RF.push(e,"dbefaYKujNMKaq0M1XVA7sS","BpRecoveryPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("PopupUtils"),s=t("ResourceUtils"),c=t("StaticResourceConst"),l=t("ItemUtils"),u=t("ItemConst");cc.Class({extends:a,properties:{bpHalfThumbnailParentNode:cc.Node,bpThumbnailParentNode:cc.Node,beforeBpHalfCountLabel:cc.Label,beforeBpCountLabel:cc.Label,afterBpHalfCountLabel:cc.Label,afterBpCountLabel:cc.Label,cancelBtn:o,bpHalfDecisionBtn:o,bpDecisionBtn:o},_callbackToDecision:null,_bpHalfUserItemCount:null,_bpUserItemCount:null,_userBasicData:null,onLoad:function(){this._userBasicData=n.dao.userBasicData,this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),o.SE_NAME.CANCEL),this.bpHalfDecisionBtn.setTapEvent(this._onTapBpHalfDecisionBtn.bind(this)),this.bpDecisionBtn.setTapEvent(this._onTapBpDecisionBtn.bind(this))},openBpRecoveryPopup:function(t){this._setParameter(),this._setCallbackToDecision(t),this.open()},_setParameter:function(){this._bpHalfUserItemCount=l.getUserItemCount(u.BP_CONSUME_ITEM_HALF),this._bpUserItemCount=l.getUserItemCount(u.BP_CONSUME_ITEM),this._setThumbnailParam(u.BP_CONSUME_ITEM_HALF,this._bpHalfUserItemCount,this.bpHalfThumbnailParentNode,this.beforeBpHalfCountLabel,this.afterBpHalfCountLabel),this._setThumbnailParam(u.BP_CONSUME_ITEM,this._bpUserItemCount,this.bpThumbnailParentNode,this.beforeBpCountLabel,this.afterBpCountLabel),0===this._bpHalfUserItemCount&&this.bpHalfDecisionBtn.switchBtnImage(!1),0===this._bpUserItemCount&&this.bpDecisionBtn.switchBtnImage(!1)},_setThumbnailParam:function(t,e,i,a,n){var o=cc.instantiate(s.getResource(c.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");o.setMainImage(s.getFileNameItemThumbnail(t)),i.addChild(o.node);var r=e;a.string=r,n.string=r?r-1:0},_setCallbackToDecision:function(t){this._callbackToDecision=t},_onTapCancelBtn:function(){this.close()},_onTapBpHalfDecisionBtn:function(){return 0===this._bpHalfUserItemCount?r.openSimpleMessageWindow("\u30a2\u30a4\u30c6\u30e0\u3092\u6240\u6301\u3057\u3066\u3044\u307e\u305b\u3093\u3002"):this._userBasicData.getCurrentBattlePointInfo().currentValue>=this._userBasicData.getMaxBattlePoint()?r.openSimpleMessageWindow("\u3059\u3067\u306bBP\u306f\u6700\u5927\u72b6\u614b\u3067\u3059"):void(this._callbackToDecision&&this._callbackToDecision([u.BP_CONSUME_ITEM_HALF],[1],this.close.bind(this)))},_onTapBpDecisionBtn:function(){return 0===this._bpUserItemCount?r.openSimpleMessageWindow("\u30a2\u30a4\u30c6\u30e0\u3092\u6240\u6301\u3057\u3066\u3044\u307e\u305b\u3093\u3002"):this._userBasicData.getCurrentBattlePointInfo().currentValue>=this._userBasicData.getMaxBattlePoint()?r.openSimpleMessageWindow("\u3059\u3067\u306bBP\u306f\u6700\u5927\u72b6\u614b\u3067\u3059"):void(this._callbackToDecision&&this._callbackToDecision([u.BP_CONSUME_ITEM],[1],this.close.bind(this)))}});cc._RF.pop()},{CommonButton:"CommonButton",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],BuffEffectView:[function(t,e,i){"use strict";cc._RF.push(e,"31135rA3DNPbL0eCxU5lvl8","BuffEffectView");var a=t("BattleData"),n=t("Buff");cc.Class({extends:cc.Component,buff:n,properties:{buffContinueNode:cc.Node,buffContinueAnimation:cc.Animation},initBuffEffectView:function(t,e,i){this.buff=t,this._setBuffContinueNode(t,e,i),this.buffContinueAnimation=this.buffContinueNode.getComponent(cc.Animation)},_setBuffContinueNode:function(t,e,i){var n=a.GM.gameRoot.poolManager.getBuffContinuePrefab(t);this.buffContinueNode=cc.instantiate(n),this.buffContinueNode.parent=e;var o=i.convertToWorldSpace(i.getPosition());this.buffContinueNode.setPosition(this.buffContinueNode.convertToNodeSpace(o))},removeBuffContinueNode:function(){this.buffContinueNode.destroy()}});cc._RF.pop()},{BattleData:"BattleData",Buff:"Buff"}],BuffHelpThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"0df03mnyZJIALSisZjQf+VV","BuffHelpThumbnail");var a=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{buffImageSprite:cc.Sprite,buffNameLabel:cc.Label,buffTextLabel:cc.Label},onLoad:function(){},setBuffImage:function(t){a.addSprite(this.buffImageSprite,t)},setBuffName:function(t){this.buffNameLabel.string=t},setBuffText:function(t){this.buffTextLabel.string=t}});cc._RF.pop()},{ResourceUtils:"ResourceUtils"}],Buff:[function(t,e,i){"use strict";cc._RF.push(e,"889fd4IBY9G3Z9ItuwVEMue","Buff");t("BattleData");var a=t("CommonFunction"),n=t("EnumTypes"),o=cc.Class({properties:{buffId:0,type:null,powerType:null,power:0,powerValSub:0,buffClass:null,endType:null,endVal:0,endValSub:0,elementType:null,invokeType:null,invokeVal:null},remainCountLabel:null,iconEffectObject:null,spriteFrameIcon:null,nodeIcon:null,doBuffAction:!1,ctor:function(){arguments[1]&&(this.buffId=arguments[1]),arguments[2]&&(this.type=arguments[2]),arguments[3]&&(this.powerType=arguments[3]),arguments[4]&&(this.power=arguments[4]),arguments[5]&&(this.buffClass=arguments[5]),arguments[6]&&(this.endType=arguments[6]),(arguments[6]||0==arguments[6])&&(this.endType=arguments[6]),arguments[7]&&(this.endVal=arguments[7])},isGoodBuff:function(){return this.type==n.BuffType.ATK_CHANGE||this.type==n.BuffType.DEF_CHANGE||this.type==n.BuffType.HP_CHANGE||this.type==n.BuffType.LUK_CHANGE||this.type==n.BuffType.ATK_CHANGE_STOCKABEL||this.type==n.BuffType.DEF_CHANGE_STOCKABLE||this.type==n.BuffType.HP_CHANGE_STOCKABLE||this.type==n.BuffType.LUK_CHANGE_STOCKABLE||this.type==n.BuffType.PLUS_UNISON_ATTACK_CHANCE||this.type==n.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE||this.type==n.BuffType.RECOVERY_POWER_UP||this.type==n.BuffType.CRITICAL_CHANCE_UP||this.type==n.BuffType.PLUS_SKILL_RATE||this.type==n.BuffType.PREVENT_BAD_CONDITION||this.type==n.BuffType.PLUS_UNISON_ATTACK_POWER||this.type==n.BuffType.SKILL_DAMAGE_UP||this.type==n.BuffType.HP_CHANGE_FOR_EQUIPMENT||this.type==n.BuffType.ATK_CHANGE_FOR_EQUIPMENT||this.type==n.BuffType.DEF_CHANGE_FOR_EQUIPMENT?this.power>=0:this.type==n.BuffType.DAMAGE_CHANGE||this.type==n.BuffType.DAMAGE_CHANGE_BY_ELEMENT||this.type==n.BuffType.DAMAGE_CHANGE_BY_CHARA_TYPE?!(this.power>=0):this.type==n.BuffType.LOW_HP_ATK_UP||this.type==n.BuffType.LOW_HP_DEF_UP||this.type==n.BuffType.ATK_CHANGE_BY_ELEMENT||this.type==n.BuffType.RECOVERY_LIMIT_UP||this.type==n.BuffType.IMMUNE_BAD_CONDITION||this.type==n.BuffType.DAMAGE_BARRIER||this.type==n.BuffType.IMMORTAL||this.type==n.BuffType.NORMAL_ATTACK_COUNTER||this.type==n.BuffType.NORMAL_ATTACK_EVASION||this.type==n.BuffType.NORMAL_ATTACK_HP_DRAIN||this.type==n.BuffType.ALL_COUNTER||this.type==n.BuffType.REGENERATION||this.type==n.BuffType.AUTO_PLUS_SKILL_RATE||this.type==n.BuffType.ADJUST_HATE_WEIGHT_FROM_ENEMY||this.type==n.BuffType.ITEM_DROP_RATE_UP||this.type==n.BuffType.GOLD_DROP_RATE_UP||this.type==n.BuffType.GET_EXP_RATE_UP||(this.type==n.BuffType.POISON||this.type==n.BuffType.PARALYSIS||this.type==n.BuffType.STUN||this.type==n.BuffType.SLEEP||this.type==n.BuffType.CONFUSE||this.type==n.BuffType.DARKNESS_ON_NORMAL_ATTK||this.type==n.BuffType.DARKNESS_ON_ALL||this.type==n.BuffType.ADD_DEBUFF_TURN||this.type==n.BuffType.ZOMBIE||this.type==n.BuffType.CURSE||this.type==n.BuffType.DEATH_SENTENCE||this.type==n.BuffType.SEAL_SKILL||(this.type,n.BuffType.SEAL_PLUS_SKILL_RATE),!1)},isBadConditionBuff:function(){return this.type==n.BuffType.POISON||this.type==n.BuffType.PARALYSIS||this.type==n.BuffType.STUN||this.type==n.BuffType.SLEEP||this.type==n.BuffType.CONFUSE||this.type==n.BuffType.DARKNESS_ON_NORMAL_ATTK||this.type==n.BuffType.DARKNESS_ON_ALL||this.type==n.BuffType.ADD_DEBUFF_TURN||this.type==n.BuffType.ZOMBIE||this.type==n.BuffType.CURSE||this.type==n.BuffType.DEATH_SENTENCE||this.type==n.BuffType.SEAL_SKILL||this.type==n.BuffType.SEAL_PLUS_SKILL_RATE},isNormalBuff:function(){return!this.isBadConditionBuff()&&(this.type!=n.BuffType.ITEM_DROP_RATE_UP&&(this.type!=n.BuffType.GOLD_DROP_RATE_UP&&(this.type!=n.BuffType.GET_EXP_RATE_UP&&(this.type!=n.BuffType.INVOKED_ABILITY&&this.type!=n.BuffType.INVOKED_EQUIPMENT))))},getBuffName:function(){switch(this.type){case n.BuffType.ATK_CHANGE:case n.BuffType.ATK_CHANGE_STOCKABEL:return this.power>=0?"ATK UP":"ATK DOWN";case n.BuffType.DEF_CHANGE:case n.BuffType.DEF_CHANGE_STOCKABLE:return this.power>=0?"DEF UP":"DEF DOWN";case n.BuffType.HP_CHANGE:case n.BuffType.HP_CHANGE_STOCKABLE:return this.power>=0?"HP UP":"HP DOWN";case n.BuffType.LUK_CHANGE:case n.BuffType.LUK_CHANGE_STOCKABLE:return this.power>=0?"LUC UP":"LUC DOWN";case n.BuffType.PLUS_UNISON_ATTACK_CHANCE:return this.power>=0?"\u5354\u529b\u653b\u6483\u767a\u52d5\u78ba\u7387UP":"\u5354\u529b\u653b\u6483\u767a\u52d5\u78ba\u7387DOWN";case n.BuffType.PLUS_UNISON_ATTACK_POWER:return this.power>=0?"\u5354\u529b\u653b\u6483\u5a01\u529bUP":"\u5354\u529b\u653b\u6483\u5a01\u529bDOWN";case n.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE:return this.power>=0?"\u72b6\u614b\u7570\u5e38\u4ed8\u4e0e\u6210\u529f\u7387UP":"\u72b6\u614b\u7570\u5e38\u4ed8\u4e0e\u6210\u529f\u7387DOWN";case n.BuffType.RECOVERY_POWER_UP:return this.power>=0?"\u56de\u5fa9\u529bUP":"\u56de\u5fa9\u529bDOWN";case n.BuffType.CRITICAL_CHANCE_UP:return this.power>=0?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u78ba\u7387UP":"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u78ba\u7387DOWN";case n.BuffType.PLUS_SKILL_RATE:return this.power>=0?"\u30b9\u30ad\u30eb\u30b2\u30fc\u30b8\u4e0a\u6607\u5024UP":"\u30b9\u30ad\u30eb\u30b2\u30fc\u30b8\u4e0a\u6607\u5024DOWN";case n.BuffType.PREVENT_BAD_CONDITION:return this.power>=0?"\u72b6\u614b\u7570\u5e38\u514d\u75ab\u529bUP":"\u72b6\u614b\u7570\u5e38\u514d\u75ab\u529bDOWN";case n.BuffType.DAMAGE_CHANGE:return this.power>=0?"\u88ab\u30c0\u30e1\u30fc\u30b8\u5897\u52a0":"\u88ab\u30c0\u30e1\u30fc\u30b8\u6e1b\u5c11";case n.BuffType.DAMAGE_CHANGE_BY_ELEMENT:return this.power>=0?"\u5c5e\u6027\u306e\u653b\u6483\u304b\u3089\u306e\u30c0\u30e1\u30fc\u30b8\u5897\u52a0":"\u5c5e\u6027\u306e\u653b\u6483\u304b\u3089\u306e\u30c0\u30e1\u30fc\u30b8\u6e1b\u5c11";case n.BuffType.DAMAGE_CHANGE_BY_CHARA_TYPE:return this.power>=0?"\u30bf\u30a4\u30d7\u306e\u653b\u6483\u304b\u3089\u306e\u30c0\u30e1\u30fc\u30b8\u5897\u52a0":"\u30bf\u30a4\u30d7\u306e\u653b\u6483\u304b\u3089\u306e\u30c0\u30e1\u30fc\u30b8\u6e1b\u5c11";case n.BuffType.DAMAGE_BARRIER:return"\u30c0\u30e1\u30fc\u30b8\u30d0\u30ea\u30a2\u30fc";case n.BuffType.SKILL_DAMAGE_UP:return this.power>=0?"\u30b9\u30ad\u30eb\u306e\u5a01\u529bUP":"\u30b9\u30ad\u30eb\u306e\u5a01\u529bDOWN";case n.BuffType.LOW_HP_ATK_UP:return"HP\u4f4e\u3044\u307b\u3069\u653b\u6483\u529bUP";case n.BuffType.LOW_HP_DEF_UP:return"HP\u4f4e\u3044\u307b\u3069\u9632\u5fa1\u529bUP";case n.BuffType.ATK_CHANGE_BY_ELEMENT:return"\u5c5e\u6027\u653b\u6483\u529bUP";case n.BuffType.RECOVERY_LIMIT_UP:return"\u56de\u5fa9\u4e0a\u9650UP";case n.BuffType.IMMUNE_BAD_CONDITION:return"\u72b6\u614b\u7570\u5e38\u7121\u52b9";case n.BuffType.IMMORTAL:return"\u4e0d\u6b7b";case n.BuffType.ALL_COUNTER:return"\u30ab\u30a6\u30f3\u30bf\u30fc";case n.BuffType.NORMAL_ATTACK_COUNTER:return"\u901a\u5e38\u653b\u6483\u30ab\u30a6\u30f3\u30bf\u30fc";case n.BuffType.NORMAL_ATTACK_EVASION:return"\u901a\u5e38\u653b\u6483\u56de\u907f";case n.BuffType.NORMAL_ATTACK_HP_DRAIN:return"\u30c9\u30ec\u30a4\u30f3";case n.BuffType.REGENERATION:return"\u518d\u751f";case n.BuffType.AUTO_PLUS_SKILL_RATE:return"\u30aa\u30fc\u30c8\u30b9\u30ad\u30eb\u30b2\u30fc\u30b8\u4e0a\u6607";case n.BuffType.ADJUST_HATE_WEIGHT_FROM_ENEMY:return this.power>=0?"\u30bf\u30fc\u30b2\u30c3\u30c6\u30a3\u30f3\u30b0\u78ba\u7387\u5897\u52a0":"\u30bf\u30fc\u30b2\u30c3\u30c6\u30a3\u30f3\u30b0\u78ba\u7387\u6e1b\u5c11";case n.BuffType.POISON:return"\u6bd2";case n.BuffType.PARALYSIS:return"\u9ebb\u75fa";case n.BuffType.STUN:return"\u30b9\u30bf\u30f3";case n.BuffType.SLEEP:return"\u30b9\u30ea\u30fc\u30d7";case n.BuffType.CONFUSE:return"\u6df7\u4e71";case n.BuffType.DARKNESS_ON_NORMAL_ATTK:case n.BuffType.DARKNESS_ON_ALL:return"\u6697\u95c7";case n.BuffType.ADD_DEBUFF_TURN:return"\u5f31\u4f53\u52b9\u679c\u306e\u6301\u7d9a\u4e0a\u6607";case n.BuffType.ZOMBIE:return"\u30be\u30f3\u30d3\u30fc";case n.BuffType.CURSE:return"\u546a\u3044";case n.BuffType.DEATH_SENTENCE:return"\u6b7b\u306e\u5ba3\u544a";case n.BuffType.SEAL_SKILL:return"\u30b9\u30ad\u30eb\u5c01\u5370";case n.BuffType.SEAL_PLUS_SKILL_RATE:return"\u30b9\u30ad\u30eb\u30b2\u30fc\u30b8\u5c01\u5370";case n.BuffType.ITEM_DROP_RATE_UP:return"\u30a2\u30a4\u30c6\u30e0\u30c9\u30ed\u30c3\u30d7\u7387UP";case n.BuffType.GOLD_DROP_RATE_UP:return"\u30cd\u30e2\u30c9\u30ed\u30c3\u30d7\u7387UP";case n.BuffType.GET_EXP_RATE_UP:return"\u7372\u5f97\u7d4c\u9a13\u5024UP";default:return""}},getBuffRemainDescPrefix:function(){switch(this.endType){case n.BuffEndType.GENERAL_TURN_START:case n.BuffEndType.GENERAL_TURN_END:case n.BuffEndType.MY_TURN_START:case n.BuffEndType.MY_TURN_END:case n.BuffEndType.ENEMY_TURN_START:case n.BuffEndType.ENEMY_TURN_END:case n.BuffEndType.ON_INVOKE:case n.BuffEndType.BE_ATTACKED:case n.BuffEndType.BOTH_ON_INVOKE_GENERAL_TURN_END:case n.BuffEndType.DAMAGE_COUNT:case n.BuffEndType.ONCE:return" \u6b8b\u308a ";case n.BuffEndType.BE_ATTACKED_CHECK_CHANCE:return"\u653b\u6483\u3055\u308c\u305f\u969b";default:return""}},getBuffRemainDescValue:function(){switch(this.endType){case n.BuffEndType.GENERAL_TURN_START:case n.BuffEndType.GENERAL_TURN_END:case n.BuffEndType.MY_TURN_START:case n.BuffEndType.MY_TURN_END:case n.BuffEndType.ENEMY_TURN_START:case n.BuffEndType.ENEMY_TURN_END:case n.BuffEndType.ON_INVOKE:case n.BuffEndType.BE_ATTACKED:case n.BuffEndType.DAMAGE_COUNT:return this.endVal+"";case n.BuffEndType.BOTH_ON_INVOKE_GENERAL_TURN_END:return this.endval+"/n"+this.endValSub;case n.BuffEndType.BE_ATTACKED_CHECK_CHANCE:return this.endValSub+"";case n.BuffEndType.ONCE:return"1";default:return""}},getBuffRemainDescSuffix:function(){switch(this.endType){case n.BuffEndType.GENERAL_TURN_START:case n.BuffEndType.GENERAL_TURN_END:case n.BuffEndType.MY_TURN_START:case n.BuffEndType.MY_TURN_END:case n.BuffEndType.ENEMY_TURN_START:case n.BuffEndType.ENEMY_TURN_END:return"\u30bf\u30fc\u30f3";case n.BuffEndType.ON_INVOKE:case n.BuffEndType.BE_ATTACKED:case n.BuffEndType.ONCE:return"\u56de";case n.BuffEndType.BOTH_ON_INVOKE_GENERAL_TURN_END:return"\u30bf\u30fc\u30f3/n\u56de";case n.BuffEndType.BE_ATTACKED_CHECK_CHANCE:return"%\u3067\u89e3\u9664";case n.BuffEndType.DAMAGE_COUNT:return"\u30c0\u30e1\u30fc\u30b8";default:return""}},getBuffDescription:function(){var t="";return t+=this.getBuffName(),t+=this.getBuffRemainDescPrefix(),t+=this.getBuffRemainDescValue(),t+=this.getBuffRemainDescSuffix()},checkInvoke:function(){return null==this.invokeType||void 0==this.invokeType||this.invokeType==n.EffectConditionType.NO_CONDITION||this.invokeType==n.EffectConditionType.RANDOM_PERCENT&&a.getRandomArbitrary(0,100)<=Number(this.invokeVal)},getDefaultEffectValue:function(t){if(this.powerType===n.PowerType.FIX)return this.power;if(this.powerType===n.PowerType.PER_BY_DEF)return t?t*this.power/100:0;if(this.powerType===n.PowerType.MIN_MAX_LIMIT_RANDOM){var e=this.power,i=this.powerValSub;return a.getRandomArbitrary(e,i)}return 0},makeBattleTransactionData:function(){var t={};return t.buffId=this.buffId,t.type=this.type,t.powerType=this.powerType,t.power=this.power,t.powerValSub=this.powerValSub,t.buffClass=this.buffClass,t.endType=this.endType,t.endVal=this.endVal,t.endValSub=this.endValSub,t.elementType=this.elementType,t.invokeType=this.invokeType,t.invokeVal=this.invokeVal,t},restoreBattleTransaction:function(t){return this.buffId=t.buffId,this.type=t.type,this.powerType=t.powerType,this.power=t.power,this.powerValSub=t.powerValSub,this.buffClass=t.buffClass,this.endType=t.endType,this.endVal=t.endVal,this.endValSub=t.endValSub,this.elementType=t.elementType,this.invokeType=t.invokeType,this.invokeVal=t.invokeVal,!0}});e.exports=o,cc._RF.pop()},{BattleData:"BattleData",CommonFunction:"CommonFunction",EnumTypes:"EnumTypes"}],CameraController:[function(t,e,i){"use strict";cc._RF.push(e,"cdd02XTwlpM541NCiexC2ac","CameraController");var a=t("BattleData"),n=t("BattleConstants"),o=t("CommonFunction"),r=t("BattleFunction"),s=cc.Class({extends:cc.Component,properties:{mainCamera:cc.Camera,subCamera:cc.Camera,effectCamera:cc.Camera,updateCallbacks:{default:[],serializable:!1,visible:!1}},onLoad:function(){},subCameraMonsterZoomIn:function(t,e){var i=e.targetNode,o=n.SUBCAMERA_MONSTER_MOVEANDZOOM_TIME/a.cur_GameSpeed,r=this.subCamera,s=r.node,c=s.getPosition(),l=i.convertToWorldSpace(i.getAnchorPoint()),u=s.convertToNodeSpace(l),h=cc.v2(c.x+u.x,c.y+u.y);Math.abs(h.x)>n.SUBCAMERA_MONSTER_ZOOM_CANMOVE_POSX_ABSOLUTE&&(h.x=n.SUBCAMERA_MONSTER_ZOOM_CANMOVE_POSX_ABSOLUTE*Math.sign(h.x));var d=n.SUBCAMERA_MONSTER_ZOOM_RATIO;this.addCameraMoveAction(r,h,o,t),this.addCameraZoomAction(r,d,o)},subCameraRestore:function(t,e){var i=n.SUBCAMERA_MONSTER_MOVEANDZOOM_TIME/a.cur_GameSpeed,o=this.subCamera,r=cc.v2(0,0);this.addCameraMoveAction(o,r,i,t),this.addCameraZoomAction(o,1,i)},subCameraMoveToBySpineEvent:function(t){var e=n.SUBCAMERA_SKILLEVENT_MOVETO_TIME/a.cur_GameSpeed,i=this.subCamera,o=i.node,r=o.getPosition(),s=t.convertToWorldSpace(t.getAnchorPoint()),c=o.convertToNodeSpace(s),l=cc.v2(r.x+c.x,r.y+c.y);this.addCameraMoveAction(i,l,e)},subCameraMoveRestoreBySpineEvent:function(){var t=n.SUBCAMERA_SKILLEVENT_MOVETO_TIME/a.cur_GameSpeed,e=this.subCamera,i=cc.v2(0,0);this.addCameraMoveAction(e,i,t)},subCameraZoomInBySpineEvent:function(){var t=this.subCamera,e=n.SUBCAMERA_SKILLEVENT_ZOOM_TIME/a.cur_GameSpeed,i=n.SUBCAMERA_SKILLEVENT_ZOOM_RATIO;this.addCameraZoomAction(t,i,e)},subCameraZoomRestoreBySpineEvent:function(){var t=this.subCamera,e=n.SUBCAMERA_SKILLEVENT_ZOOM_TIME/a.cur_GameSpeed;this.addCameraZoomAction(t,1,e)},addCameraMoveAction:function(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=this,s=0,c=t.node,l=c.getPosition(),u=function(t){var h=(s+=t)/i;h=r.easeInOutQuad(h);var d=o.lerp(l.x,e.x,h),p=o.lerp(l.y,e.y,h);if(c.setPosition(cc.v2(d,p)),s>=i){c.setPosition(e),a&&a();var m=n.updateCallbacks.indexOf(u);n.updateCallbacks.splice(m,1)}}.bind(this);n.updateCallbacks.push(u)},addCameraZoomAction:function(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=this,s=0,c=t.zoomRatio,l=function(u){var h=(s+=u)/i;h=r.easeInOutQuad(h);var d=o.lerp(c,e,h);if(t.zoomRatio=d,s>=i){t.zoomRatio=e,a&&a();var p=n.updateCallbacks.indexOf(l);n.updateCallbacks.splice(p,1)}}.bind(this);n.updateCallbacks.push(l)},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e--)this.updateCallbacks[e](t)}});e.exports=s,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",CommonFunction:"CommonFunction"}],CampaignApis:[function(t,e,i){"use strict";cc._RF.push(e,"69e0533piVJlK7F1H9v/Y5D","CampaignApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.CAMPAIGN_GET_MASTER_DATA,path:"campaign/getMasterData",method:"GET",type:"binary"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],CampaignModel:[function(t,e,i){"use strict";cc._RF.push(e,"1ab252z/fVERomplqR/nmI0","CampaignModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getTargetType:function(){if(this._isKeyFieldAvailable("targetType"))return this._data.targetType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetType")},getTargetIds:function(){if(this._isKeyFieldAvailable("targetIds"))return this._data.targetIds;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetIds")},getCampaignType:function(){if(this._isKeyFieldAvailable("campaignType"))return this._data.campaignType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: campaignType")},getCampaignValue:function(){if(this._isKeyFieldAvailable("campaignValue"))return this._data.campaignValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: campaignValue")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getWeekTypes:function(){if(this._isKeyFieldAvailable("weekTypes"))return this._data.weekTypes;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: weekTypes")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CampaignService:[function(t,e,i){"use strict";cc._RF.push(e,"a62ecFjLFdJ/pPYQ8ubQIMh","CampaignService");var a=t("BaseService");t("ApiConstants"),cc.Class({extends:a});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],CampaignUtils:[function(t,e,i){"use strict";cc._RF.push(e,"28234Srxg9JnptD7xrxeVO4","CampaignUtils");var a=t("Singleton"),n=t("TimeUtils"),o=t("GameConst");function r(t,e,i,a){return t.getTargetType()===i&&t.getCampaignType()===a&&_.some(t.getTargetIds().split(","),function(t){return parseInt(t)===e})}e.exports={getMaxDayPlayCount:function(t,e){var i=e?t.getMaxSkipCount():t.getMaxBattleCount();if(i<=0)return 0;var s=_.find(a.dao.CampaignMasters,function(e){return _.some(e.getTargetIds().split(","),function(i){return n.isRangeOfDate(e.getFromDate(),e.getToDate())&&n.isOpenWeek(e.getWeekTypes())&&r(e,t.getAreaId(),o.CAMPAIGN_TARGET_TYPE.AREA,o.CAMPAIGN.LIMIT_COUNT.CATEGORY)})});return s?i+s.getCampaignValue():i}},cc._RF.pop()},{GameConst:"GameConst",Singleton:"Singleton",TimeUtils:"TimeUtils"}],CharacterAbilityEffectModel:[function(t,e,i){"use strict";cc._RF.push(e,"07764y+F3JBkpl7NrrLLb8s","CharacterAbilityEffectModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getAbilityId:function(){if(this._isKeyFieldAvailable("a"))return this._data.a;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityId")},getIndex:function(){if(this._isKeyFieldAvailable("c"))return this._data.c;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getOccurrenceRate:function(){if(this._isKeyFieldAvailable("l"))return this._data.l;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: occurrenceRate")},getEffectConditionType:function(){if(this._isKeyFieldAvailable("j"))return this._data.j;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectConditionType")},getLevel:function(){if(this._isKeyFieldAvailable("b"))return this._data.b;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getSuccessRate:function(){if(this._isKeyFieldAvailable("n"))return this._data.n;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: successRate")},getText:function(){if(this._isKeyFieldAvailable("d"))return this._data.d;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getShortText:function(){if(this._isKeyFieldAvailable("e"))return this._data.e;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shortText")},getEffectLimit:function(){if(this._isKeyFieldAvailable("i"))return this._data.i;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectLimit")},getEffectConditionValue:function(){if(this._isKeyFieldAvailable("k"))return this._data.k;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectConditionValue")},getTargetType:function(){if(this._isKeyFieldAvailable("m"))return this._data.m;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetType")},getEffectValue:function(){if(this._isKeyFieldAvailable("h"))return this._data.h;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectValue")},getActionType:function(){if(this._isKeyFieldAvailable("f"))return this._data.f;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: actionType")},getEndValue:function(){if(this._isKeyFieldAvailable("q"))return this._data.q;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endValue")},getEffectType:function(){if(this._isKeyFieldAvailable("g"))return this._data.g;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectType")},getEndType:function(){if(this._isKeyFieldAvailable("p"))return this._data.p;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endType")},getTargetValue:function(){if(this._isKeyFieldAvailable("o"))return this._data.o;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetValue")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterAbilityGroupModel:[function(t,e,i){"use strict";cc._RF.push(e,"c519f0q+1BN1pzzQ5+O54r/","CharacterAbilityGroupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getAbilityId:function(){if(this._isKeyFieldAvailable("abilityId"))return this._data.abilityId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityId")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getAbilityGroupId:function(){if(this._isKeyFieldAvailable("abilityGroupId"))return this._data.abilityGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityGroupId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterAbilityMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"558c4DW5VZOnYOZ8vO3ZOXT","CharacterAbilityMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getAbilityId:function(){if(this._isKeyFieldAvailable("abilityId"))return this._data.abilityId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getTriggerType:function(){if(this._isKeyFieldAvailable("triggerType"))return this._data.triggerType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerType")},getTriggerValue:function(){if(this._isKeyFieldAvailable("triggerValue"))return this._data.triggerValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerValue")},getTriggerConditionType:function(){if(this._isKeyFieldAvailable("triggerConditionType"))return this._data.triggerConditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerConditionType")},getTriggerConditionValue:function(){if(this._isKeyFieldAvailable("triggerConditionValue"))return this._data.triggerConditionValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerConditionValue")},getAbilityFortifyType:function(){if(this._isKeyFieldAvailable("abilityFortifyType"))return this._data.abilityFortifyType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityFortifyType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterAbilityUpModel:[function(t,e,i){"use strict";cc._RF.push(e,"610694Pr2lHF5LanraHso6u","CharacterAbilityUpModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getAbilityFortifyType:function(){if(this._isKeyFieldAvailable("abilityFortifyType"))return this._data.abilityFortifyType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityFortifyType")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getMaterialId1:function(){if(this._isKeyFieldAvailable("materialId1"))return this._data.materialId1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialId1")},getMaterialCount1:function(){if(this._isKeyFieldAvailable("materialCount1"))return this._data.materialCount1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialCount1")},getMaterialId2:function(){if(this._isKeyFieldAvailable("materialId2"))return this._data.materialId2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialId2")},getMaterialCount2:function(){if(this._isKeyFieldAvailable("materialCount2"))return this._data.materialCount2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialCount2")},getMaterialId3:function(){if(this._isKeyFieldAvailable("materialId3"))return this._data.materialId3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialId3")},getMaterialCount3:function(){if(this._isKeyFieldAvailable("materialCount3"))return this._data.materialCount3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialCount3")},getMaterialId4:function(){if(this._isKeyFieldAvailable("materialId4"))return this._data.materialId4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialId4")},getMaterialCount4:function(){if(this._isKeyFieldAvailable("materialCount4"))return this._data.materialCount4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialCount4")},getMaterialId5:function(){if(this._isKeyFieldAvailable("materialId5"))return this._data.materialId5;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialId5")},getMaterialCount5:function(){if(this._isKeyFieldAvailable("materialCount5"))return this._data.materialCount5;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialCount5")},getPrice:function(){if(this._isKeyFieldAvailable("price"))return this._data.price;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: price")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterAbilityUtils:[function(t,e,i){"use strict";cc._RF.push(e,"e7137fNvIdPaJjwEncXjD9y","CharacterAbilityUtils");var a=t("Singleton"),n=t("CharacterConst"),o=t("CharacterUtils"),r=t("CharacterParameterUtils");function s(){var t=a.dao.CharacterAbilityMainMasters,e={};for(var i in t){var n=t[i];e[n.getAbilityId()]=n}return e}function c(){return s()}function l(t){return a.dao.CharacterAbilityGroupMasters.filter(function(e){return parseInt(e.getAbilityGroupId())===t})}function u(t){return a.dao.CharacterAbilityUpMasters.filter(function(e){return e.getAbilityFortifyType()===t}).length}function h(t,e,i,a,n,o,r,s,c,l){return{abilityIndex:t,abilityMainMaster:e,abilityEffectMasterArray:i,abilityText:a,abilityLevel:n,maxAbilityLevel:o,needExceedLimit:r,rarity:s,isReleased:c,isSupportAbility:l}}function d(t){for(var e=_.filter(a.dao.CharacterAbilityGroupMasters,function(e){return e.getAbilityGroupId()===t}),i={},n=0;n<e.length;n+=1){var o=e[n];i[o.getAbilityId()]=o}return i}function p(t){var e=a.dao.CharacterAbilityMainMasters,i={};for(var n in e){var o=e[n],r=o.getAbilityId();t[r]&&(i[r]=o)}return i}function m(t){var e=_.filter(a.dao.CharacterAbilityEffectMasters,function(e){for(var i in t)if(e.getAbilityId()===t[i].getAbilityId())return!0;return!1}),i={};for(var n in e){var o=e[n].getAbilityId(),r=e[n].getLevel();i[o]||(i[o]={}),i[o][r]||(i[o][r]=[]),i[o][r].push(e[n])}return i}function g(t){var e="";for(var i in t){e&&"\u3001"!==e.slice(-1)&&(e+="\n");var a=t[i].getEffectValue();e+=t[i].getText().replace("{0}",Math.abs(a))}return e}e.exports={getCharacterAbilityMainMasterMap:c,getAbilityGroupMasterArrayByAbilityGroupId:l,getAbilityMainMasterArrayByAbilityGroupId:function(t){var e=l(t),i=[];for(var a in e){var n=e[a].getAbilityId(),o=c()[n];o&&i.push(o)}return i},getAbilityMainMasterByAbilityId:function(t){return c()[t]},getAbilityEffectMasterArrayByAbilityIdAndLevel:function(t,e){return a.dao.CharacterAbilityEffectMasters.filter(function(e){return e.getAbilityId()===t}).filter(function(t){return t.getLevel()===e})},getMaxLevelAbilityInfoArrayByCharacterId:function(t){var e=a.dao.CharacterMainMasters.find(function(e){return e.getCharacterId()===t}),i=a.dao.CharacterAbilityGroupMasters.filter(function(t){return t.getAbilityGroupId()===e.getAbilityGroupId()}),s=r.getMaxExceedLimit(t),c=[];return i.forEach(function(t){var i=a.dao.CharacterAbilityMainMasters.find(function(e){return e.getAbilityId()===t.getAbilityId()}),r=u(i.getAbilityFortifyType()),l=a.dao.CharacterAbilityEffectMasters.filter(function(t){return t.getAbilityId()===i.getAbilityId()&&t.getLevel()===r});c.push(h(t.getIndex(),i,l,o.convertEffectText(l),r,r,s,e.getRarity(),!0,t.getIndex()===n.SUB_ABILITY_INDEX))}),c},createCharacterAbilityInfo:h,createCharacterAbilityUpMaterialInfoArray:function(t,e){for(var i=a.dao.CharacterAbilityUpMasters.find(function(i){return i.getAbilityFortifyType()===t&&i.getLevel()===e}),o=[],r=1;r<=n.ABILITY_UP_MATERIAL_MAX_COUNT;r+=1)o.push({itemId:i["getMaterialId"+r].apply(i),count:i["getMaterialCount"+r].apply(i)});return o},createCharacterAbilityGroupMasterMap:d,createCharacterAbilityMainMasterMap:p,createCharacterAbilityEffectMasterMap:m,createCharacterAbilityInfoArray:function(t,e,i,a,r,s){var c=d(t),l=p(c),u=m(c),C=o.getExceedLimitMasterArrayByExceedLimitType(a),f=[];for(var E in l){var T=l[E],S=T.getAbilityId(),R=c[S].getIndex(),A=1,b=Object.keys(u[S]).length;r?A=r.getAbilityLebelByIndex(R):s&&(A=b);var M=u[S][A],v=g(M),P=_.find(C,function(t){return t.getAbilityCount()===R});if(P){var I=P.getExceedLimit(),y=I<=i,N=R===n.SUB_ABILITY_INDEX,B=h(R,T,M,v,A,b,I,e,y,N);f.push(B)}}return f},calcAbilityFortifyPrice:function(t,e,i){var n=a.dao.CharacterAbilityUpMasters.find(function(i){return i.getAbilityFortifyType()===t&&i.getLevel()===e});return n?n.getPrice():0},isAbilityLevelUpMaterials:function(t,e){for(var i in t)if(t[i].getCharacterType()===n.CHARACTER_TYPE.ABILITY&&t[i].getRarity()>=e)return!0;return!1}},cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterParameterUtils:"CharacterParameterUtils",CharacterUtils:"CharacterUtils",Singleton:"Singleton"}],CharacterApis:[function(t,e,i){"use strict";cc._RF.push(e,"6078cPryLlAfprOp1XNwNH3","CharacterApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.CHARACTER_GET_MASTER_DATA,path:"character/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_TEXT_GET_MASTER_DATA,path:"character/getMasterTextData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_TEXT_GET_MASTER_DATA2,path:"character/getMasterTextData2",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_TEXT_GET_MASTER_DATA3,path:"character/getMasterTextData3",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_SKILL_GET_MASTER_DATA,path:"character/getMasterSkillData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_SKILL_EFFECT_GET_MASTER_DATA,path:"character/getMasterSkillEffectData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_SKILL_EFFECT_GET_MASTER_DATA2,path:"character/getMasterSkillEffectData2",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_ABILITY_GET_MASTER_DATA,path:"character/getMasterAbilityData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA,path:"character/getMasterAbilityEffectData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA2,path:"character/getMasterAbilityEffectData2",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA3,path:"character/getMasterAbilityEffectData3",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.CHARACTER_GET_USER_DATA,path:"character/getUserData",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_SELL,path:"character/sell",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_SELL_WAREHOUSE,path:"character/sellWarehouse",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_FORTIFY,path:"character/fortify",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_FORTIFY_WAREHOUSE,path:"character/fortifyWarehouse",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_FORTIFY_SKILL,path:"character/fortifySkill",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_FORTIFY_SKILL_WAREHOUSE,path:"character/fortifySkillWarehouse",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_FORTIFY_ABILITY,path:"character/fortifyAbility",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_EQUIP_REMOVE_ALL,path:"character/equipRemoveAll",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_EQUIP,path:"character/equip",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_EXCEED_LIMIT,path:"character/exceedLimit",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_EXCEED_LIMIT_WAREHOUSE,path:"character/exceedLimitWarehouse",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_EXCEED_LIMIT_ITEM,path:"character/exceedLimitByItem",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_CHANGE_PROTECT,path:"character/changeProtect",method:"POST"}),a.RESTClient.graft({name:n.CHARACTER_CHANGE_PARTNER,path:"character/changePartner",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],CharacterConst:[function(t,e,i){"use strict";cc._RF.push(e,"d6e3fB7bHtCkqluTPGrPKIF","CharacterConst");cc.Class({statics:{CHARACTER_TYPE:cc.Enum({NORMAL:1,FORTIFY:2,EXCEEDLIMIT:3,SELL:4,SKILL_UP:5,ABILITY_UP:6,ROOM:9,DEFAULT:10}),MATERIAL_DATA_TYPE:cc.Enum({CHARACTER:0,WAREHOUSE:1}),WHOLE_DISPLAY_ENABLED_BORDER_RARITY:3,EXCEED_LIMIT_MAX_COUNT:4,EQUIPMENT_MAX_COUNT:4,ABILITY_UP_MATERIAL_MAX_COUNT:5,SKILL_FORTIFY_MAX_RATE:100,SAME_ATTRIBUTE_MATERIAL_BONUS_RATE:1.2,SAME_CHARACTER_GROUP_BONUS_RATIO:1.3,MATERIAL_CATEGORY:cc.Enum({N:0,R:1,SR:2,SSR:3,SKILL:4,ABILITY:5,SAME:6}),EXCEED_LIMIT_MATERIAL_TYPE:cc.Enum({CHARACTER:0,ITEM:1}),PROMOTE_TYPE:cc.Enum({STATUS:0,FORTIFY:1,EXCEED_LIMIT:2}),TEXT_SCENE_TYPE:cc.Enum({ROOM:1,MYPAGE:2,QUEST:3,MISSION:4,STORY:5,SHOP:6,GACHA:7,PROMOTE:8,BATTLE:9,TITLE:10}),TEXT_GROUP_TYPE:{ROOM:{FRIENDSHIP:0,NORMAL:1,FRIENDSHIP_MAX:2},MYPAGE:{NORMAL:0,LOGIN:1},QUEST:{NORMAL:1,WEEK:2},MISSION:{NORMAL:0},STORY:{CATEGORY:0,WORLD:1,AREA:2,STAGE:3,EVENT:4,STORY:5},SHOP:{NORMAL:0},GACHA:{NORMAL:0,GET:1},PROMOTE:{EXCEED_LIMIT:0},BATTLE:{START:0,DAMAGE:1,DEATH:2,WIN:3,LOSE:4},TITLE:{NORMAL:0}},SUPPORT_CHARA_PARAMETER_RATIO:.5,SUB_ABILITY_INDEX:3,ROOM_SPINE_SKIN_TYPE:cc.Enum({NORMAL:"normal",SURPRISE:"surprise",ANGER:"anger",SAD:"sad",SMILE:"smile",SHY:"shy",UNIQUE:"unique"}),ROOM_SPINE_ANIM_TYPE:cc.Enum({IDLE:"idle",HOME:"home",SKILL:"animation"})}});cc._RF.pop()},{}],CharacterContentsModel:[function(t,e,i){"use strict";cc._RF.push(e,"e13d3/ZEHtKG6mqPz8a1MIL","CharacterContentsModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getConditionValue1:function(){if(this._isKeyFieldAvailable("conditionValue1"))return this._data.conditionValue1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionValue1")},getConditionValue2:function(){if(this._isKeyFieldAvailable("conditionValue2"))return this._data.conditionValue2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionValue2")},getConditionType1:function(){if(this._isKeyFieldAvailable("conditionType1"))return this._data.conditionType1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionType1")},getConditionType2:function(){if(this._isKeyFieldAvailable("conditionType2"))return this._data.conditionType2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionType2")},getContentsId:function(){if(this._isKeyFieldAvailable("contentsId"))return this._data.contentsId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: contentsId")},getContentType:function(){if(this._isKeyFieldAvailable("contentType"))return this._data.contentType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: contentType")},getContentsGroupId:function(){if(this._isKeyFieldAvailable("contentsGroupId"))return this._data.contentsGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: contentsGroupId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getTextId:function(){if(this._isKeyFieldAvailable("textId"))return this._data.textId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: textId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterEquipmentListView:[function(t,e,i){"use strict";cc._RF.push(e,"6d19djmfY9PQIH+qNWFoLsG","CharacterEquipmentListView");var a=t("CommonButton"),n=t("CommonUtils");cc.Class({extends:cc.Component,properties:{thumbnailParentNode:cc.Node,selectBtn:a},initCharacterEquipmentListView:function(t,e){if(t){this.node.active=!0;for(var i=t.getCharacterEquipmentInfoArray(),a=0;a<i.length;a+=1){var n=i[a];if(n.isReleased){var o=e(n,this.thumbnailParentNode.children[a],a);o?this.thumbnailParentNode.addChild(o):this.thumbnailParentNode.children[a].active=!0}else this.thumbnailParentNode.children[a]&&(this.thumbnailParentNode.children[a].active=!1)}this.selectBtn.setTapEvent(this._onTapSelectBtn.bind(this,t))}else this.node.active=!1},_onTapSelectBtn:function(t){t&&n.getRoot().transitionForPromoteCharacterDetail(t)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils"}],CharacterEquipmentUtils:[function(t,e,i){"use strict";cc._RF.push(e,"8b0bbJDwZFLWL6q5jXRB3j2","CharacterEquipmentUtils");t("Singleton");var a=t("CharacterUtils"),n=t("EquipmentUtils"),o=(t("CharacterConst"),t("ItemConst"));function r(t,e,i,o){var r=a.getExceedLimitMasterArrayByExceedLimitType(i.getExceedLimitType()),u=(r.length,_.maxBy(r,function(t){return t.getExceedLimit()})),h=null;h=o?_.find(r,function(t){return t.getExceedLimit()===o.getExceedLimit()}):_.find(r,function(t){return 0===t.getExceedLimit()});for(var d=c(t,u,o),p=[],m=0;m<d.equipmentMaxCount;m+=1){var g=e[d.equipmentCds[m]],C=s(r,t,m),f=h.getExceedLimit()>=C,E=l(o,n.convertEquipmentTypeToText(t,m+1),t,m,C,f,g);p.push(E)}return p}function s(t,e,i){var a=i+1;return _.find(t,function(t){var i=0;switch(e){case o.EQUIPMENT_TYPE.ATK:i=t.getEquipmentWeaponCount();break;case o.EQUIPMENT_TYPE.DEF:i=t.getEquipmentProtectorCount()}return i>=a}).getExceedLimit()}function c(t,e,i){var a=0,n=[];if(!e||!i)return{equipmentMaxCount:a,equipmentCds:n};switch(t){case o.EQUIPMENT_TYPE.ATK:a=e.getEquipmentWeaponCount(),i&&(n=i.userData.getEquipmentWeaponCds());break;case o.EQUIPMENT_TYPE.DEF:a=e.getEquipmentProtectorCount(),i&&(n=i.userData.getEquipmentProtectorCds())}return{equipmentMaxCount:a,equipmentCds:n}}function l(t,e,i,a,n,o,r){return{characterModel:t,frameName:e,equipmentType:i,position:a,needExceedLimit:n,isReleased:o,equipmentModel:r}}e.exports={createCharacterEquipmentInfoArray:function(t,e){var i=n.getEquipmentModelMap(),a=r(o.EQUIPMENT_TYPE.ATK,i,t,e),s=r(o.EQUIPMENT_TYPE.DEF,i,t,e);return a.concat(s)}},cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",Singleton:"Singleton"}],CharacterExceedLimitCharacterMaterialView:[function(t,e,i){"use strict";cc._RF.push(e,"e3ca90IlgdKj6Ca2oeTyaGG","CharacterExceedLimitCharacterMaterialView");var a=t("CommonButton"),n=t("CommonUtils"),o=t("CharacterUtils"),r=t("CharacterConst"),s=(t("ResourceUtils"),t("CharacterExceedLimitMaterialViewBase"));cc.Class({extends:s,properties:{unitMaterialNode:cc.Node,maximumNode:cc.Node,priceLabel:cc.Label,resetBtn:a,executeBtn:a},_callbackToResetBtn:null,initCharacterExceedLimitMaterialView:function(t,e,i){if(this._super(t,e),this._callbackToResetBtn=i,!(this._root.getCurrentCharacterModel().getExceedLimitMaxCount()-this._root.getCurrentCharacterModel().getExceedLimit()>0))return this.unitMaterialNode.active=!1,this.maximumNode.active=!0,this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),void this._initButtons();this.unitMaterialNode.active=!0,this.maximumNode.active=!1,this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this._drawMaterials([])},drawCharacterExceedLimitMaterialView:function(t){this._drawMaterials(t)},_drawMaterials:function(t){this._materialCharacterModelArray=t,this.thumbnailParentNode.destroyAllChildren();for(var e=this._root.getCurrentCharacterModel().getExceedLimitMaxCount()-this._root.getCurrentCharacterModel().getExceedLimit(),i=0;i<r.EXCEED_LIMIT_MAX_COUNT;i+=1){var a=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");t[i]?a.initCharacterMatrixThumbnail(t[i].getCharacterMainMaster(),t[i].getExceedLimit(),t[i].getLevel(),1):a.initAddingMatrixThumbnail(),i>=e?(a.setActive(!1),a.setCenterLabel("\u9078\u629e\u4e0d\u53ef")):a.setCallbackToThumbnailBtn(function(){this._callbackToThumbnail()}.bind(this)),this.thumbnailParentNode.addChild(a.node)}this._setPriceLabel(),this._initButtons()},_callbackToThumbnail:function(t){this._root.pushPromoteCharacterExceedLimitMaterialSelectSubRoot(this.getTabIndex())},_setPriceLabel:function(){this.priceLabel.string=n.convertToCommaDelimited(o.calcExceedLimitPrice(this._root.getCurrentCharacterModel().getExceedLimitType(),this._root.getCurrentCharacterModel().getExceedLimit(),this._root.getCurrentCharacterModel().getExceedLimit()+this.getAddExceedLimit()))},_initButtons:function(){this._root.getMaterialCharacterModelArray().length>0?(this.resetBtn.switchBtnImage(!0),this.executeBtn.switchBtnImage(!0),this.resetBtn.setTouchEnable(!0),this.executeBtn.setTouchEnable(!0)):(this.resetBtn.switchBtnImage(!1),this.executeBtn.switchBtnImage(!1),this.resetBtn.setTouchEnable(!1),this.executeBtn.setTouchEnable(!1))},_onTapResetBtn:function(){this._callbackToResetBtn(),this._initButtons()},_onTapExecuteBtn:function(){this._root.openCharacterExceedLimitConfirmPopup(this.getMaterialNodeArray(),this.priceLabel.string,this.getExceedLimitMaterialType(),this.getSelectedMaterial())},getAddExceedLimit:function(){return this._materialCharacterModelArray.length},getMaterialNodeArray:function(){for(var t=[],e=0;e<this._materialCharacterModelArray.length;e+=1)t.push(cc.instantiate(this.thumbnailParentNode.children[e]));return t},getExceedLimitMaterialType:function(){return r.EXCEED_LIMIT_MATERIAL_TYPE.CHARACTER},getSelectedMaterial:function(){return this._materialCharacterModelArray}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterExceedLimitMaterialViewBase:"CharacterExceedLimitMaterialViewBase",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ResourceUtils:"ResourceUtils"}],CharacterExceedLimitIconThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"4b5cal76CxHsISMnCK99GW1","CharacterExceedLimitIconThumbnail");cc.Class({extends:cc.Component,properties:{activeImageSprite:cc.Sprite,inActiveImageSprite:cc.Sprite,futureImageSprite:cc.Sprite},switcnImage:function(t,e){this.activeImageSprite.node.active=t,this.inActiveImageSprite.node.active=!t,this.futureImageSprite.node.active=e}});cc._RF.pop()},{}],CharacterExceedLimitItemMaterialView:[function(t,e,i){"use strict";cc._RF.push(e,"94e36X5zPRGlLSxnSXwWJgb","CharacterExceedLimitItemMaterialView");var a=t("CommonButton"),n=t("CommonUtils"),o=t("ItemUtils"),r=t("CharacterUtils"),s=t("ResourceUtils"),c=(t("PopupUtils"),t("CharacterExceedLimitMaterialViewBase")),l=t("CharacterConst"),u=t("StaticResourceConst"),h=t("GameConst"),d=t("ItemSourceConst");cc.Class({extends:c,properties:{itemMaterialNode:cc.Node,maximumNode:cc.Node,itemNameLabel:cc.Label,itemNeedCountLabel:cc.Label,itemCurrentCountLabel:cc.Label,priceLabel:cc.Label,executeBtn:a,sourceSearchBtn:a},_materialItemMaster:null,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.sourceSearchBtn.setTapEvent(this._onTapSourceSearchBtn.bind(this))},initCharacterExceedLimitMaterialView:function(t,e,i){if(this._super(t,e),this._callbackToResetBtn=i,this._materialItemMaster=o.getItemMaster(t.getCurrentCharacterModel().getExceedLimitMaterialId()),!this._materialItemMaster)return this.itemMaterialNode.active=!1,this.maximumNode.active=!0,void this._initButtons();this.itemMaterialNode.active=!0,this.maximumNode.active=!1;var a=t.getCurrentCharacterModel().getExceedLimitMaterialCount(),n=o.getUserItemCount(t.getCurrentCharacterModel().getExceedLimitMaterialId());this._setCountLabel(a,n),this._setPriceLabel(),this._initButtons(a,n)},_initThumbnail:function(t){this.thumbnailParentNode.destroyAllChildren();var e=cc.instantiate(s.getResource(u.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");e.setMainImage(s.getFileNameItemThumbnail(t.getItemId())),this.thumbnailParentNode.addChild(e.node)},_setCountLabel:function(t,e){this.itemNameLabel.string=this._materialItemMaster.getName(),this.itemNeedCountLabel.string=n.convertToCommaDelimited(t),this._initThumbnail(this._materialItemMaster),this.itemCurrentCountLabel.string=n.convertToCommaDelimited(e),t>e&&(this.itemCurrentCountLabel.node.color=h.COLOR_STATE.ALERT)},_setPriceLabel:function(){this.priceLabel.string=n.convertToCommaDelimited(r.calcExceedLimitPrice(this._root.getCurrentCharacterModel().getExceedLimitType(),this._root.getCurrentCharacterModel().getExceedLimit(),this._root.getCurrentCharacterModel().getExceedLimit()+this.getAddExceedLimit()))},_initButtons:function(t,e){t<=e&&this.getAddExceedLimit()>0?(this.executeBtn.switchBtnImage(!0),this.executeBtn.setTouchEnable(!0)):(this.executeBtn.switchBtnImage(!1),this.executeBtn.setTouchEnable(!1))},_onTapExecuteBtn:function(){this._root.openCharacterExceedLimitConfirmPopup(this.getMaterialNodeArray(),this.priceLabel.string,this.getExceedLimitMaterialType(),this.getSelectedMaterial())},_onTapSourceSearchBtn:function(){cc.instantiate(s.getResource(u.ITEM_SOURCE_LIST_POPUP_PREFAB_PATH)).getComponent("ItemSourceListPopup").openItemSourceListPopup(o.getItemMaster(d.SOURCE_ITEM_ID.CHARACTER_EXCEED_LIMIT_MATERIAL),this._root.getCurrentSceneName(),this._root.sceneParam)},getAddExceedLimit:function(){return this._materialItemMaster?1:0},getMaterialNodeArray:function(){var t=[];for(var e in this.thumbnailParentNode.children)t.push(cc.instantiate(this.thumbnailParentNode.children[e]));return t},getExceedLimitMaterialType:function(){return l.EXCEED_LIMIT_MATERIAL_TYPE.ITEM}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterExceedLimitMaterialViewBase:"CharacterExceedLimitMaterialViewBase",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemSourceConst:"ItemSourceConst",ItemUtils:"ItemUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],CharacterExceedLimitMaterialTabView:[function(t,e,i){"use strict";cc._RF.push(e,"04af2f/ru5C96nQ+sx5ohCA","CharacterExceedLimitMaterialTabView");var a=t("TabViewBase"),n=t("CharacterExceedLimitMaterialViewBase"),o=t("ViewUtils"),r=0,s=1,c={POSITION:cc.v2(80,18),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{exceedLimitMaterialViewArray:[n]},_root:null,_callbackToSwitchTab:null,initCharacterExceedLimitMaterialTabView:function(t,e,i,a){for(var n in this.exceedLimitMaterialViewArray)this.exceedLimitMaterialViewArray[n].initCharacterExceedLimitMaterialView(t,n,a);this._root=t,this._callbackToSwitchTab=i,this.initTabViewBase(),this._setCurrentTab(e||0),this._activateTab(this.getCurrentTab()),t.getCurrentCharacterModel()&&this._drawNoticeBadge(t)},_drawNoticeBadge:function(t){if(t.getCurrentCharacterModel().getIsMaxExceedLimit())return o.hideNoticeBadge(this.tabBtnArray[r].node),void o.hideNoticeBadge(this.tabBtnArray[s].node);t.getCurrentCharacterModel().hasExceedableMaterialCharacter()&&o.addNoticeBadge(this.tabBtnArray[s].node,c.POSITION,c.SCALE),t.getCurrentCharacterModel().hasExceedableMaterialItem()&&o.addNoticeBadge(this.tabBtnArray[r].node,c.POSITION,c.SCALE)},drawCharacterExceedLimitMaterialTabView:function(t){for(var e in this.exceedLimitMaterialViewArray)this.exceedLimitMaterialViewArray[e].drawCharacterExceedLimitMaterialView(t)},getAddExceedLimit:function(){return this.exceedLimitMaterialViewArray[this.getCurrentTab()].getAddExceedLimit()},getMaterialNodeArray:function(){return this.exceedLimitMaterialViewArray[this.getCurrentTab()].getMaterialNodeArray()},getExceedLimitMaterialType:function(){return this.exceedLimitMaterialViewArray[this.getCurrentTab()].getExceedLimitMaterialType()},getSelectedMaterial:function(){return this.exceedLimitMaterialViewArray[this.getCurrentTab()].getSelectedMaterial()},_tabEvent:function(t,e,i){this._activateTab(e),this._callbackToSwitchTab(this.exceedLimitMaterialViewArray[e].getAddExceedLimit())},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetListView(),this.exceedLimitMaterialViewArray[t].node.active=!0,this.drawCharacterExceedLimitMaterialTabView(this._root.getMaterialCharacterModelArray())},_resetListView:function(){for(var t in this.exceedLimitMaterialViewArray)this.exceedLimitMaterialViewArray[t].node.active=!1}});cc._RF.pop()},{CharacterExceedLimitMaterialViewBase:"CharacterExceedLimitMaterialViewBase",TabViewBase:"TabViewBase",ViewUtils:"ViewUtils"}],CharacterExceedLimitMaterialViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"f18e1O6rEBME4Y8XG61Wyh3","CharacterExceedLimitMaterialViewBase");t("TabViewBase"),cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node},_root:null,_tabIndex:0,initCharacterExceedLimitMaterialView:function(t,e){this._root=t,this._tabIndex=e},drawCharacterExceedLimitMaterialView:function(){},getAddExceedLimit:function(){return 0},getTabIndex:function(){return this._tabIndex},getMaterialNodeArray:function(){var t=[];for(var e in this.thumbnailParentNode.children)t.push(cc.instantiate(this.thumbnailParentNode.children[e]));return t},getExceedLimitMaterialType:function(){return 0},getSelectedMaterial:function(){return null}});cc._RF.pop()},{TabViewBase:"TabViewBase"}],CharacterExceedLimitModel:[function(t,e,i){"use strict";cc._RF.push(e,"29f7aUsV89DMoyztGJJ5gfA","CharacterExceedLimitModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getExceedLimitType:function(){if(this._isKeyFieldAvailable("exceedLimitType"))return this._data.exceedLimitType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimitType")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")},getMaterialId:function(){if(this._isKeyFieldAvailable("materialId"))return this._data.materialId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialId")},getMaterialCount:function(){if(this._isKeyFieldAvailable("materialCount"))return this._data.materialCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialCount")},getTotalExceedLimitExp:function(){if(this._isKeyFieldAvailable("totalExceedLimitExp"))return this._data.totalExceedLimitExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: totalExceedLimitExp")},getNeedExceedLimitExp:function(){if(this._isKeyFieldAvailable("needExceedLimitExp"))return this._data.needExceedLimitExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: needExceedLimitExp")},getEquipmentWeaponCount:function(){if(this._isKeyFieldAvailable("equipmentWeaponCount"))return this._data.equipmentWeaponCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentWeaponCount")},getEquipmentProtectorCount:function(){if(this._isKeyFieldAvailable("equipmentProtectorCount"))return this._data.equipmentProtectorCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentProtectorCount")},getAbilityCount:function(){if(this._isKeyFieldAvailable("abilityCount"))return this._data.abilityCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityCount")},getExceedLimitPrice:function(){if(this._isKeyFieldAvailable("exceedLimitPrice"))return this._data.exceedLimitPrice;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimitPrice")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterExceedLimitProgressView:[function(t,e,i){"use strict";cc._RF.push(e,"922eaXtZqZCYLvW+chrtvXA","CharacterExceedLimitProgressView");t("CommonUtils"),t("CharacterUtils");var a=t("CharacterExceedLimitIconThumbnail");cc.Class({extends:cc.Component,properties:{exceedLimitIconThumbnailArray:[a]},initCharacterExceedLimitProgressView:function(t,e,i){this._initExceedLimitIconThumbnailArray(t,e,i)},_initExceedLimitIconThumbnailArray:function(t,e,i){for(var a=0;a<this.exceedLimitIconThumbnailArray.length;a+=1){var n=this.exceedLimitIconThumbnailArray[a];if(a<i){n.node.active=!0;var o=!1,r=!1;a<t?o=!0:a<e&&(o=!0,r=!0),n.switcnImage(o,r)}else n.node.active=!1}}});cc._RF.pop()},{CharacterExceedLimitIconThumbnail:"CharacterExceedLimitIconThumbnail",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils"}],CharacterFavoriteModel:[function(t,e,i){"use strict";cc._RF.push(e,"c982cYOkV9OKLpGJ+BCCOgd","CharacterFavoriteModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getFavoriteItemId:function(){if(this._isKeyFieldAvailable("favoriteItemId"))return this._data.favoriteItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: favoriteItemId")},getAddType:function(){if(this._isKeyFieldAvailable("addType"))return this._data.addType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addType")},getValue:function(){if(this._isKeyFieldAvailable("value"))return this._data.value;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: value")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterFilterConst:[function(t,e,i){"use strict";cc._RF.push(e,"0ba0ao8/NFFAqV+hfaOm7su","CharacterFilterConst");cc.Class({statics:{PROPERTY_NAME:"CharacterFilter",FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9}),FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4"},SELL_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9,FORTIFY:10,SELL:11,UNIT:12}),SELL_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",FORTIFY:"getFilterFlgByMaterial",SELL:"getFilterFlgBySellMaterial",UNIT:"getFilterFlgByUnit"},SKILL_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9,SKILL:10,UNIT:11}),SKILL_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",SKILL:"getFilterFlgBySkillMaterial",UNIT:"getFilterFlgByUnit"},AUTO_DECK_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5}),AUTO_DECK_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark"},FILTER_GROUP_END:{ATTRIBUTE:5,RARITY:9,TYPE:11},SELL_FILTER_GROUP_END:{ATTRIBUTE:5,RARITY:9,TYPE:12},RECOMMEND_SELL_FILTER_TYPE:{RARITY_1:0,RARITY_2:1,RARITY_3:2,RARITY_4:3,MATERIAL:4,SELL:5,CHARACTER:6},RECOMMEND_SELL_FILTER_FUNC_NAME:{RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",MATERIAL:"getFilterFlgByMaterial",SELL:"getFilterFlgBySellMaterial",CHARACTER:"getFilterFlgByUnit"},MATERIAL_FILTER_RARITY_COUNT:4,MATERIAL_FILTER_TYPE:cc.Enum({RARITY_1:0,RARITY_2:1,RARITY_3:2,RARITY_4:3,UNIT:4}),MATERIAL_FILTER_FUNC_NAME:{RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",UNIT:"getFilterFlgByUnit"},MATERIAL_CHARACTER_FILTER_TYPE:cc.Enum({RARITY_1:0,RARITY_2:1,RARITY_3:2,RARITY_4:3}),MATERIAL_CHARACTER_FILTER_FUNC_NAME:{RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4"}}});cc._RF.pop()},{}],CharacterGroupFilterConst:[function(t,e,i){"use strict";cc._RF.push(e,"35ac7bdQEBOhaRiSRmzlOds","CharacterGroupFilterConst");cc.Class({statics:{PROPERTY_NAME:"CharacterGroupFilter",FILTER_TYPE:cc.Enum({NAME_A_TO_S:0,NAME_T_TO_H:1,NAME_M_TO_W:2,UNION_A:3,UNION_B:4,UNION_C:5}),FILTER_FUNC_NAME:{NAME_A_TO_S:"getFilterFlgByReadingNameAToS",NAME_T_TO_H:"getFilterFlgByReadingNameTToH",NAME_M_TO_W:"getFilterFlgByReadingNameMToW",UNION_A:"getFilterFlgByUnionA",UNION_B:"getFilterFlgByUnionB",UNION_C:"getFilterFlgByUnionC"}}});cc._RF.pop()},{}],CharacterGroupModel:[function(t,e,i){"use strict";cc._RF.push(e,"955cawIfy1OW7iZe+kMQVMC","CharacterGroupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterGroupId:function(){if(this._isKeyFieldAvailable("characterGroupId"))return this._data.characterGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterGroupId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getShortName:function(){if(this._isKeyFieldAvailable("shortName"))return this._data.shortName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shortName")},getReadingName:function(){if(this._isKeyFieldAvailable("readingName"))return this._data.readingName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: readingName")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getUnion:function(){if(this._isKeyFieldAvailable("union"))return this._data.union;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: union")},getContentsGroupId:function(){if(this._isKeyFieldAvailable("contentsGroupId"))return this._data.contentsGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: contentsGroupId")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getStandHeadPositionX:function(){if(this._isKeyFieldAvailable("standHeadPositionX"))return this._data.standHeadPositionX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: standHeadPositionX")},getStandHeadPositionY:function(){if(this._isKeyFieldAvailable("standHeadPositionY"))return this._data.standHeadPositionY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: standHeadPositionY")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterLevelModel:[function(t,e,i){"use strict";cc._RF.push(e,"92fe3oO6FNDT5Sxzv0d9K18","CharacterLevelModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getExpType:function(){if(this._isKeyFieldAvailable("expType"))return this._data.expType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: expType")},getSalePrice:function(){if(this._isKeyFieldAvailable("salePrice"))return this._data.salePrice;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: salePrice")},getFortifyPrice:function(){if(this._isKeyFieldAvailable("fortifyPrice"))return this._data.fortifyPrice;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fortifyPrice")},getTotalExp:function(){if(this._isKeyFieldAvailable("totalExp"))return this._data.totalExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: totalExp")},getNextLevelExp:function(){if(this._isKeyFieldAvailable("nextLevelExp"))return this._data.nextLevelExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: nextLevelExp")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterLevelProgressView:[function(t,e,i){"use strict";cc._RF.push(e,"b4808j0ow5DF4mROiNXW0+H","CharacterLevelProgressView");var a=t("CommonUtils"),n=t("CharacterConst"),o=t("CharacterLevelView");cc.Class({extends:cc.Component,properties:{expProgressBar:cc.ProgressBar,expProgressAfterBar:cc.ProgressBar,needExpNumLabel:cc.Label,characterLevelViewArray:[o]},initCharacterLevelProgressView:function(t,e,i,o,r,s,c,l){switch(this._drawCharacterLevelView(t,e,i,o,r),this.expProgressBar.progress=c,l?(this.expProgressAfterBar.node.active=!0,this.expProgressAfterBar.progress=l):this.expProgressAfterBar.node.active=!1,t){case n.PROMOTE_TYPE.STATUS:case n.PROMOTE_TYPE.FORTIFY:this.needExpNumLabel.node.active=!0,this.needExpNumLabel.string=a.convertToCommaDelimited(s);break;case n.PROMOTE_TYPE.EXCEED_LIMIT:this.needExpNumLabel.node.active=!1}},_resetCharacterLevelView:function(){for(var t in this.characterLevelViewArray)this.characterLevelViewArray[t].node.active=!1},_drawCharacterLevelView:function(t,e,i,a,n){this._resetCharacterLevelView(),this.characterLevelViewArray[t].node.active=!0,this.characterLevelViewArray[t].initCharacterLevelView(e,i,a,n)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterLevelView:"CharacterLevelView",CommonUtils:"CommonUtils"}],CharacterLevelView:[function(t,e,i){"use strict";cc._RF.push(e,"518a0+bZaFJf4Qg+teDYxKq","CharacterLevelView");cc.Class({extends:cc.Component,properties:{currentLevelNumLabel:cc.Label,nextLevelNumLabel:cc.Label,currentMaxLevelNumLabel:cc.Label,nextMaxLevelNumLabel:cc.Label},initCharacterLevelView:function(t,e,i,a){this.currentLevelNumLabel&&(this.currentLevelNumLabel.string=t+""),this.currentMaxLevelNumLabel&&(this.currentMaxLevelNumLabel.string=i+""),this.nextLevelNumLabel&&(this.nextLevelNumLabel.string=e+""),this.nextMaxLevelNumLabel&&(this.nextMaxLevelNumLabel.string=a+"")}});cc._RF.pop()},{}],CharacterMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"c2c6fG0dFBIb6F/s67IuZ3X","CharacterMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterGroupId:function(){if(this._isKeyFieldAvailable("characterGroupId"))return this._data.characterGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterGroupId")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getCharacterType:function(){if(this._isKeyFieldAvailable("characterType"))return this._data.characterType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterType")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getShortName:function(){if(this._isKeyFieldAvailable("shortName"))return this._data.shortName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shortName")},getSkinName:function(){if(this._isKeyFieldAvailable("skinName"))return this._data.skinName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skinName")},getCostumeName:function(){if(this._isKeyFieldAvailable("costumeName"))return this._data.costumeName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costumeName")},getReadingName:function(){if(this._isKeyFieldAvailable("readingName"))return this._data.readingName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: readingName")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getShortText:function(){if(this._isKeyFieldAvailable("shortText"))return this._data.shortText;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shortText")},getVoiceActorName:function(){if(this._isKeyFieldAvailable("voiceActorName"))return this._data.voiceActorName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: voiceActorName")},getIllustratorName:function(){if(this._isKeyFieldAvailable("IllustratorName"))return this._data.IllustratorName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: IllustratorName")},getContentsGroupId:function(){if(this._isKeyFieldAvailable("contentsGroupId"))return this._data.contentsGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: contentsGroupId")},getCostumeId:function(){if(this._isKeyFieldAvailable("costumeId"))return this._data.costumeId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costumeId")},getRarity:function(){if(this._isKeyFieldAvailable("rarity"))return this._data.rarity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rarity")},getAttribute:function(){if(this._isKeyFieldAvailable("attribute"))return this._data.attribute;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: attribute")},getSkillId:function(){if(this._isKeyFieldAvailable("skillId"))return this._data.skillId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skillId")},getAbilityGroupId:function(){if(this._isKeyFieldAvailable("abilityGroupId"))return this._data.abilityGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityGroupId")},getSupportAbilityGroupId:function(){if(this._isKeyFieldAvailable("supportAbilityGroupId"))return this._data.supportAbilityGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: supportAbilityGroupId")},getNormalAttackId:function(){if(this._isKeyFieldAvailable("normalAttackId"))return this._data.normalAttackId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: normalAttackId")},getSpineDirectoryPath:function(){if(this._isKeyFieldAvailable("spineDirectoryPath"))return this._data.spineDirectoryPath;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: spineDirectoryPath")},getSpineName:function(){if(this._isKeyFieldAvailable("spineName"))return this._data.spineName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: spineName")},getMyPageBgFileName:function(){if(this._isKeyFieldAvailable("myPageBgFileName"))return this._data.myPageBgFileName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: myPageBgFileName")},getExpType:function(){if(this._isKeyFieldAvailable("expType"))return this._data.expType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: expType")},getMaterialType:function(){if(this._isKeyFieldAvailable("materialType"))return this._data.materialType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialType")},getExceedLimitType:function(){if(this._isKeyFieldAvailable("exceedLimitType"))return this._data.exceedLimitType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimitType")},getMaxLevel0:function(){if(this._isKeyFieldAvailable("maxLevel0"))return this._data.maxLevel0;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel0")},getMaxLevel1:function(){if(this._isKeyFieldAvailable("maxLevel1"))return this._data.maxLevel1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel1")},getMaxLevel2:function(){if(this._isKeyFieldAvailable("maxLevel2"))return this._data.maxLevel2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel2")},getMaxLevel3:function(){if(this._isKeyFieldAvailable("maxLevel3"))return this._data.maxLevel3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel3")},getMaxLevel4:function(){if(this._isKeyFieldAvailable("maxLevel4"))return this._data.maxLevel4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel4")},getMinHp:function(){if(this._isKeyFieldAvailable("minHp"))return this._data.minHp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minHp")},getMaxHp0:function(){if(this._isKeyFieldAvailable("maxHp0"))return this._data.maxHp0;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp0")},getMaxHp1:function(){if(this._isKeyFieldAvailable("maxHp1"))return this._data.maxHp1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp1")},getMaxHp2:function(){if(this._isKeyFieldAvailable("maxHp2"))return this._data.maxHp2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp2")},getMaxHp3:function(){if(this._isKeyFieldAvailable("maxHp3"))return this._data.maxHp3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp3")},getMaxHp4:function(){if(this._isKeyFieldAvailable("maxHp4"))return this._data.maxHp4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp4")},getMaxAddHp:function(){if(this._isKeyFieldAvailable("maxAddHp"))return this._data.maxAddHp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAddHp")},getMinAtk:function(){if(this._isKeyFieldAvailable("minAtk"))return this._data.minAtk;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minAtk")},getMaxAtk0:function(){if(this._isKeyFieldAvailable("maxAtk0"))return this._data.maxAtk0;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk0")},getMaxAtk1:function(){if(this._isKeyFieldAvailable("maxAtk1"))return this._data.maxAtk1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk1")},getMaxAtk2:function(){if(this._isKeyFieldAvailable("maxAtk2"))return this._data.maxAtk2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk2")},getMaxAtk3:function(){if(this._isKeyFieldAvailable("maxAtk3"))return this._data.maxAtk3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk3")},getMaxAtk4:function(){if(this._isKeyFieldAvailable("maxAtk4"))return this._data.maxAtk4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk4")},getMaxAddAtk:function(){if(this._isKeyFieldAvailable("maxAddAtk"))return this._data.maxAddAtk;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAddAtk")},getMinDef:function(){if(this._isKeyFieldAvailable("minDef"))return this._data.minDef;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minDef")},getMaxDef0:function(){if(this._isKeyFieldAvailable("maxDef0"))return this._data.maxDef0;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef0")},getMaxDef1:function(){if(this._isKeyFieldAvailable("maxDef1"))return this._data.maxDef1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef1")},getMaxDef2:function(){if(this._isKeyFieldAvailable("maxDef2"))return this._data.maxDef2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef2")},getMaxDef3:function(){if(this._isKeyFieldAvailable("maxDef3"))return this._data.maxDef3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef3")},getMaxDef4:function(){if(this._isKeyFieldAvailable("maxDef4"))return this._data.maxDef4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef4")},getMaxAddDef:function(){if(this._isKeyFieldAvailable("maxAddDef"))return this._data.maxAddDef;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAddDef")},getMinLuck:function(){if(this._isKeyFieldAvailable("minLuck"))return this._data.minLuck;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minLuck")},getMaxLuck0:function(){if(this._isKeyFieldAvailable("maxLuck0"))return this._data.maxLuck0;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLuck0")},getMaxLuck1:function(){if(this._isKeyFieldAvailable("maxLuck1"))return this._data.maxLuck1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLuck1")},getMaxLuck2:function(){if(this._isKeyFieldAvailable("maxLuck2"))return this._data.maxLuck2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLuck2")},getMaxLuck3:function(){if(this._isKeyFieldAvailable("maxLuck3"))return this._data.maxLuck3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLuck3")},getMaxLuck4:function(){if(this._isKeyFieldAvailable("maxLuck4"))return this._data.maxLuck4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLuck4")},getMaxAddLuck:function(){if(this._isKeyFieldAvailable("maxAddLuck"))return this._data.maxAddLuck;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAddLuck")},getStandHeadPositionX:function(){if(this._isKeyFieldAvailable("standHeadPositionX"))return this._data.standHeadPositionX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: standHeadPositionX")},getStandHeadPositionY:function(){if(this._isKeyFieldAvailable("standHeadPositionY"))return this._data.standHeadPositionY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: standHeadPositionY")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterMaterialModel:[function(t,e,i){"use strict";cc._RF.push(e,"ad142ya8CZO24ymmi7ao4o5","CharacterMaterialModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getAddExp:function(){if(this._isKeyFieldAvailable("addExp"))return this._data.addExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addExp")},getAddExceedLimitExp:function(){if(this._isKeyFieldAvailable("addExceedLimitExp"))return this._data.addExceedLimitExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addExceedLimitExp")},getAddSkillUpRate:function(){if(this._isKeyFieldAvailable("addSkillUpRate"))return this._data.addSkillUpRate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addSkillUpRate")},getMaterialType:function(){if(this._isKeyFieldAvailable("materialType"))return this._data.materialType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"6bf58eYdCxFUbDP5FmowzCo","CharacterMatrixThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("Singleton"),r=t("MatrixThumbnailBase"),s=t("CharacterSortConst");cc.Class({extends:r,properties:{mainImageSprite:cc.Sprite,attributeImageSprite:cc.Sprite,attributeFrameImageSprite:cc.Sprite,rarityImageSprite:cc.Sprite,isProtectNode:cc.Node,isSelectedNode:cc.Node,selectedOrderLabel:cc.Label,isEventBoostNode:cc.Node,grayImageSpriteNode:cc.Node,bottomNumPrefixNode:cc.Node,bottomNumNode:cc.Node,centerLabel:cc.Label,bottomLabel:cc.Label,emptyNode:cc.Node,addingNode:cc.Node,exceedLimitIconNodeArray:[cc.Node],exceedLimitFrameSpriteArray:[cc.Sprite],exceedLimitFrameBGSpriteArray:[cc.Sprite],popVeilNode:cc.Node,popAnim:cc.Animation,thumbnailBtn:a},initCharacterMatrixThumbnail:function(t,e,i,a){if(this._initSprites(t.getCharacterId(),t.getAttribute(),t.getRarity()),this.setBottomParams(this._getBottomNumPrefixText(a),i),isNaN(e)||e<0)this._resetExceedLimit();else{var n=o.dao.CharacterExceedLimitMasters.filter(function(e){return e.getExceedLimitType()===t.getExceedLimitType()});this._setExceedLimit(e,n.length-1,t.getRarity())}},resetCharacterMatrixThumbnail:function(){this.grayImageSpriteNode.active=!1,this.mainImageSprite.spriteFrame=null,this.attributeImageSprite.spriteFrame=null,this.attributeFrameImageSprite.spriteFrame=null,this.rarityImageSprite.spriteFrame=null,this.setBottomParams("",-1),this._resetExceedLimit(),this.setSelectedOrder(-1)},initPlainMatrixThumbnail:function(){this.emptyNode.active=!0},initDisablePlainMatrixThumbnail:function(){this.emptyNode.active=!1},initEmptyMatrixThumbnail:function(){this.emptyNode.active=!0},initAddingMatrixThumbnail:function(){this.addingNode.active=!0},_resetExceedLimit:function(){var t=0;for(t=0;t<this.exceedLimitIconNodeArray.length;t+=1)this.exceedLimitIconNodeArray[t].active=!1;for(t=0;t<this.exceedLimitFrameSpriteArray.length;t+=1)this.exceedLimitFrameSpriteArray[t].node.active=!1},_setExceedLimit:function(t,e,i){this._resetExceedLimit();var a=0;for(a=0;a<t;a+=1)this.exceedLimitIconNodeArray[a]&&(this.exceedLimitIconNodeArray[a].active=!0);for(a=0;a<e;a+=1)this.exceedLimitFrameSpriteArray[a]&&(this.exceedLimitFrameSpriteArray[a].node.active=!0,n.addSprite(this.exceedLimitFrameSpriteArray[a],n.getFileNameRarityExceedLimitFrame(i)));for(a=0;a<this.exceedLimitFrameBGSpriteArray.length;a+=1)this.exceedLimitFrameBGSpriteArray[a]&&n.addSprite(this.exceedLimitFrameBGSpriteArray[a],n.getFileNameRarityExceedLimitFrameBg(i))},setSelectedNodeActive:function(t){this.isSelectedNode.active=t},setSelectedOrder:function(t){var e=parseInt(t)>0;this.setSelectedNodeActive(e),this.selectedOrderLabel.node.parent.active=e,this.selectedOrderLabel.string=t},setActive:function(t){this.grayImageSpriteNode.active=!t},setProtected:function(t){this.isProtectNode.active=t},getProtected:function(){return this.isProtectNode.active},setEventBoost:function(t){this.isEventBoostNode.active=t},setCenterLabel:function(t,e){this.centerLabel.node.active=!!t,this.centerLabel.string=t,e&&(this.centerLabel.node.color=e)},setBottomLabel:function(t){this.bottomLabel.node.parent.stopAllActions(),t?(this.bottomLabel.node.parent.active=!0,this.bottomLabel.string=t||"",this.bottomLabel.node.parent.runAction(cc.repeatForever(cc.sequence(cc.fadeIn(.5),cc.delayTime(1),cc.fadeOut(.5),cc.delayTime(3))))):this.bottomLabel.node.parent.active=!1},setCallbackToThumbnailBtn:function(t){this.thumbnailBtn.setTapEvent(t,"")},_initSprites:function(t,e,i){this.grayImageSpriteNode.active=!1,n.addSprite(this.mainImageSprite,n.getFileNameCharacterThumbnail(t)),!isNaN(e)&&e>0&&(n.addSprite(this.attributeImageSprite,n.getFileNameAttributeIcon(e)),n.addSprite(this.attributeFrameImageSprite,n.getFileNameRarityRing(isNaN(i)?0:i))),isNaN(i)||n.addSprite(this.rarityImageSprite,n.getFileNameRarityCharacterFrame(i))},_setBottomNum:function(t){var e=this.bottomNumNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t+""},_setBottomNumPrefix:function(t){var e=this.bottomNumPrefixNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t},setBottomParams:function(t,e){e>=0?(this._setBottomNumPrefix(t||""),this._setBottomNum(e)):(this._setBottomNumPrefix(t||""),this._setBottomNum(""))},_getBottomNumPrefixText:function(t){switch(t){case s.SORT_TYPE.LEVEL:return"Lv.";case s.SORT_TYPE.RARE:return"\u2605";case s.SORT_TYPE.TOTAL:return"\u6226\u529b";case s.SORT_TYPE.HP:return"Hp";case s.SORT_TYPE.ATK:return"Atk";case s.SORT_TYPE.DEF:return"Def"}return""},playPopAnim:function(t){this.popVeilNode.active=!0,this.popAnim.play(),t&&this.popAnim.on("finished",function(e,i){if(i.name===this.popAnim.getClips()[0].name)return t()},this)}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CommonButton:"CommonButton",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],CharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"ec93cDPvWxPP6aucN7brg9r","CharacterModel");var a=t("UserCharacterModel"),n=t("Singleton"),o=(t("GameConst"),t("CharacterConst")),r=t("CharacterUtils"),s=t("CharacterEquipmentUtils"),c=t("CharacterSkillUtils"),l=t("CharacterAbilityUtils"),u=t("ItemConst"),h=t("ItemUtils"),d=t("EquipmentUtils"),p=(t("CommonUtils"),t("DeckUtils")),m=t("EventUtils"),g=t("PictureBookUtils");cc.Class({userData:void 0,_characterMainMaster:void 0,_characterMaterialMaster:void 0,_skillMainMaster:void 0,_skillEffectMasterMap:void 0,_skillUpRateMaster:void 0,_abilityGroupMasterMap:void 0,_abilityMainMasterMap:void 0,_abilityEffectMasterMap:void 0,_equipmentWeaponModelList:void 0,_equipmentProtectorModelList:void 0,_characterNormalAttackMaster:void 0,_characterExceedLimitMasterArray:void 0,_characterExceedLimitMasterMap:void 0,_characterAbilityInfoArray:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._characterMainMaster=null,this._characterLevelMaster=null,this._characterMaterialMaster=null,this._skillMainMaster=null,this._skillEffectMasterMap=null,this._skillUpRateMaster=null,this._abilityGroupMasterMap=null,this._abilityMainMasterMap=null,this._abilityEffectMasterMap=null,this._equipmentWeaponModelList=null,this._equipmentProtectorModelList=null,this._characterNormalAttackMaster=null,this._characterExceedLimitMasterArray=null,this._characterExceedLimitMasterMap=null,this._characterAbilityInfoArray=null},getCharacterMainMaster:function(){return this._characterMainMaster||(this._characterMainMaster=n.dao.CharacterMainMasters.find(function(t){return t.getCharacterId()===this.userData.getCharacterId()}.bind(this))),this._characterMainMaster},getCharacterLevelMaster:function(){if(!this._characterLevelMaster){var t=this.userData.getLevel(),e=this.getCharacterMainMaster().getExpType();this._characterLevelMaster=n.dao.CharacterLevelMasters.find(function(i){return i.getExpType()===e&&i.getLevel()===t})}return this._characterLevelMaster},getCharacterMaterialMaster:function(){if(!this._characterMaterialMaster){var t=this.getCharacterMainMaster().getMaterialType();this._characterMaterialMaster=n.dao.CharacterMaterialMasters.find(function(e){return e.getMaterialType()===t})}return this._characterMaterialMaster},getSkillMainMaster:function(){return this._skillMainMaster||(this._skillMainMaster=n.dao.CharacterSkillMainMasters.find(function(t){return t.getSkillId()===this.getCharacterMainMaster().getSkillId()}.bind(this))),this._skillMainMaster},getSkillEffectMaster:function(){return this.getSkillEffectMasterMap()[this.getSkillLevel()]},getSkillEffectMasterMap:function(){return this._skillEffectMasterMap||(this._skillEffectMasterMap=c.createCharacterSkillEffectMasterMap(this.getCharacterMainMaster().getSkillId())),this._skillEffectMasterMap},getAbilityGroupMasterMap:function(){return this._abilityGroupMasterMap||(this._abilityGroupMasterMap=l.createCharacterAbilityGroupMasterMap(this.getCharacterMainMaster().getAbilityGroupId())),this._abilityGroupMasterMap},getAbilityMainMasterMap:function(){return this._abilityMainMasterMap||(this._abilityMainMasterMap=l.createCharacterAbilityMainMasterMap(this.getAbilityGroupMasterMap())),this._abilityMainMasterMap},getAbilityEffectMasterMap:function(){return this._abilityEffectMasterMap||(this._abilityEffectMasterMap=l.createCharacterAbilityEffectMasterMap(this.getAbilityMainMasterMap())),this._abilityEffectMasterMap},getAbilityEffectMasterArrayByAbilityId:function(t,e){return this.getAbilityEffectMasterMap()[t][e]},getAvailableAbilityId:function(t){var e=[],i=this.getCharacterExceedLimitMaster().getAbilityCount(),a=n.dao.CharacterAbilityGroupMasters;for(var o in a)a.hasOwnProperty(o)&&a[o].getAbilityGroupId()===t&&a[o].getIndex()<=i&&e.push(a[o].getAbilityId());return e},getCharacterExceedLimitMasterArray:function(){return this._characterExceedLimitMasterArray||(this._characterExceedLimitMasterArray=n.dao.CharacterExceedLimitMasters.filter(function(t){return t.getExceedLimitType()===this.getCharacterMainMaster().getExceedLimitType()}.bind(this))),this._characterExceedLimitMasterArray},getCharacterExceedLimitMasterMap:function(){return this._characterExceedLimitMasterMap||(this._characterExceedLimitMasterMap=this._createCharacterExceedLimitMasterMap()),this._characterExceedLimitMasterMap},_createCharacterExceedLimitMasterMap:function(){var t={},e=this.getCharacterExceedLimitMasterArray();for(var i in e){var a=e[i];t[a.getExceedLimit()]=a}return t},getCharacterExceedLimitMasterByExceedLimit:function(t){return this.getCharacterExceedLimitMasterMap()[t]},getCharacterExceedLimitMaster:function(){return this.getCharacterExceedLimitMasterByExceedLimit(this.getExceedLimit())},getEquipmentWeaponCds:function(){return this.userData.getEquipmentWeaponCds()},getEquipmentProtectorCds:function(){return this.userData.getEquipmentProtectorCds()},getAvailableEquipmentModelList:function(){return this.getAvailableEquipmentWeaponModelList().concat(this.getAvailableEquipmentProtectorModelList())},getAvailableEquipmentWeaponModelList:function(){return this._equipmentWeaponModelList=this._getAvailableEquipmentModelListByEquipmentType(u.EQUIPMENT_TYPE.ATK),this._equipmentWeaponModelList},getAvailableEquipmentProtectorModelList:function(){return this._equipmentProtectorModelList=this._getAvailableEquipmentModelListByEquipmentType(u.EQUIPMENT_TYPE.DEF),this._equipmentProtectorModelList},_getAvailableEquipmentModelListByEquipmentType:function(t){var e=[],i=this._getEquipmentCdsByEquipmentType(t);if(Array.isArray(i)&&i.length>0)for(var a=this._getEquipmentAvailableCountByEquipmentType(t),n=d.getEquipmentModelMap(),o=0;o<a;o++){var r=n[i[o]];r&&e.push(r)}return e},_getEquipmentCdsByEquipmentType:function(t){switch(t){case u.EQUIPMENT_TYPE.ATK:return this.getEquipmentWeaponCds();case u.EQUIPMENT_TYPE.DEF:return this.getEquipmentProtectorCds()}return[]},_getEquipmentAvailableCountByEquipmentType:function(t){var e=this.getCharacterExceedLimitMaster();switch(t){case u.EQUIPMENT_TYPE.ATK:return e?e.getEquipmentWeaponCount():0;case u.EQUIPMENT_TYPE.DEF:return e?e.getEquipmentProtectorCount():0}return 0},getCharacterEquipmentInfoArray:function(){return this._createCharacterEquipmentInfoArray()},_createCharacterEquipmentInfoArray:function(){return s.createCharacterEquipmentInfoArray(this.getCharacterMainMaster(),this)},getCharacterSkillInfo:function(){return this._createCharacterSkillInfo()},_createCharacterSkillInfo:function(){return c.createCharacterSkillInfo(this.getSkillMainMaster(),this.getSkillEffectMaster(),this.getSkillText(),this.getSkillLevel(),this.getMaxSkillLevel())},getNextCharacterSkillInfo:function(){return this._createNextCharacterSkillInfo()},_createNextCharacterSkillInfo:function(){return c.createCharacterSkillInfo(this.getSkillMainMaster(),this.getSkillEffectMasterMap()[this.getSkillLevel()+1],this._convertEffectText(this.getSkillEffectMasterMap()[this.getSkillLevel()+1]),this.getSkillLevel()+1,this.getMaxSkillLevel())},getCharacterAbilityInfoArray:function(){return this._characterAbilityInfoArray||(this._characterAbilityInfoArray=l.createCharacterAbilityInfoArray(this.getCharacterMainMaster().getAbilityGroupId(),this.getRarity(),this.getExceedLimit(),this.getExceedLimitType(),this)),this._characterAbilityInfoArray},getNextCharacterAbilityInfoByCharacterAbilityInfo:function(t){var e=this.getAbilityLebelByIndex(t.abilityIndex),i=e===t.maxAbilityLevel?t.maxAbilityLevel:e+1,a=this.getAbilityTextByAbilityId(t.abilityMainMaster.getAbilityId(),i);return l.createCharacterAbilityInfo(t.abilityIndex,t.abilityMainMaster,t.abilityEffectMasterArray,a,i,t.maxAbilityLevel,t.needExceedLimit,t.rarity,t.isReleased,t.isSupportAbility)},getCharacterId:function(){return this.userData.getCharacterId()},getCharacterCd:function(){return this.userData.getCharacterCd()},getName:function(){return this.getCharacterMainMaster().getName()},getShortName:function(){return this.getCharacterMainMaster().getShortName()},getSkinName:function(){return this.getCharacterMainMaster().getSkinName()},getAttribute:function(){return this.getCharacterMainMaster().getAttribute()},getRarity:function(){return this.getCharacterMainMaster().getRarity()},getCharacterGroupId:function(){return this.getCharacterMainMaster().getCharacterGroupId()},getLevel:function(){return this.userData.getLevel()},getCharacterExp:function(){return this.userData.getExp()},getNeedExpForNextLevel:function(){return this.getLevel()>=this.getMaxLevel()?0:r.calcNeedExpForNextLevelByTotalExp(this.getCharacterExp(),this.getCharacterMainMaster().getExpType())},getExpRateForNextLevel:function(){return this.getLevel()!==this.getMaxLevel()?r.calcExpRateForNextLevelByTotalExp(this.getCharacterExp(),this.getCharacterMainMaster().getExpType()):1},getExceedLimitExp:function(){return this.userData.getExceedLimitExp()},getNeedExpForNextExceedLimit:function(){return r.calcNeedExceedLimitExpForNextExceedLimitByTotalExceedLimitExp(this.getExceedLimitExp())},getExpRateForNextExceedLimit:function(){return this.getExceedLimit()!==this.getExceedLimitMaxCount()?r.calcExceedLimitExpRateForNextExceedLimitByTotalExceedLimitExp(this.getExceedLimitExp()):1},getNowReleaseCharacterEquipmentInfoArray:function(){return this.getCharacterEquipmentInfoArray().filter(function(t){return t.needExceedLimit===this.getExceedLimit()}.bind(this))},getNowReleaseCharacterAbilityInfoArray:function(){return this.getCharacterAbilityInfoArray().filter(function(t){return t.needExceedLimit===this.getExceedLimit()}.bind(this))},getNextReleaseCharacterEquipmentInfoArray:function(){var t=this.getExceedLimit(),e=Math.min(t+1,this.getExceedLimitMaxCount());return this.getCharacterEquipmentInfoArray().filter(function(t){return t.needExceedLimit===e})},getNextReleaseCharacterAbilityInfoArray:function(){var t=this.getExceedLimit(),e=Math.min(t+1,this.getExceedLimitMaxCount());return this.getCharacterAbilityInfoArray().filter(function(t){return t.needExceedLimit===e})},getReleaseCharacterEquipmentInfoArrayByExceedLimit:function(t){return this.getCharacterEquipmentInfoArray().filter(function(e){return e.needExceedLimit===t})},getReleaseCharacterAbilityInfoArrayByExceedLimit:function(t){return this.getCharacterAbilityInfoArray().filter(function(e){return e.needExceedLimit===t})},getSkillLevel:function(){return this.userData.getSkillLevel()},getMaxSkillLevel:function(){return Object.keys(this.getSkillEffectMasterMap()).length},getSkillName:function(){return this.getSkillMainMaster().getName()},getSkillText:function(){return this._convertEffectText(this.getSkillEffectMaster())},getAbilityTextByAbilityId:function(t,e){return this._convertEffectText(this.getAbilityEffectMasterArrayByAbilityId(t,e))},_convertEffectText:function(t){var e="";for(var i in t){e&&"\u3001"!==e.slice(-1)&&(e+="\n");var a=t[i].getEffectValue();e+=t[i].getText().replace("{0}",Math.abs(a))}return e},getSkillShortText:function(){return this._convertEffectShortText(this.getSkillEffectMaster())},getAbilityShortTextByAbilityId:function(t,e){return this._convertEffectShortText(this.getAbilityEffectMasterArrayByAbilityId(t,e))},_convertEffectShortText:function(t){var e="";for(var i in t){e&&"\u3001"!==e.slice(-1)&&(e+="\n");var a=t[i].getEffectValue();e+=t[i].getShortText().replace("{0}",Math.abs(a))}return e},getIsSellMaterial:function(){return this.getCharacterMainMaster().getCharacterType()===o.CHARACTER_TYPE.SELL},getIsFortifyMaterial:function(){return this.getCharacterMainMaster().getCharacterType()===o.CHARACTER_TYPE.FORTIFY},getIsSkillMaterial:function(){return this.getCharacterMainMaster().getCharacterType()===o.CHARACTER_TYPE.SKILL_UP},getIsProtect:function(){return this.userData.getIsProtect()},getIsDeckUnit:function(){return p.isDeckUnit(this.getCharacterCd())},getIsMaxExceedLimit:function(){return this.getExceedLimit()>=this.getExceedLimitMaterialCount()},getExceedLimit:function(){return this.userData.getExceedLimit()},getExceedLimitMaxCount:function(){return this.getCharacterExceedLimitMasterArray().length-1},getAbilityLebelByIndex:function(t){return this.userData["getAbilityLevel"+t].apply(this.userData)},getAbilityLevel1:function(){return this.userData.getAbilityLevel1()},getAbilityLevel2:function(){return this.userData.getAbilityLevel2()},getAbilityLevel3:function(){return this.userData.getAbilityLevel3()},getFortifyPrice:function(){return this.getCharacterLevelMaster().getFortifyPrice()},getSalePrice:function(){return this.getCharacterLevelMaster().getSalePrice()},getMaxLevel0:function(){return this.getCharacterMainMaster().getMaxLevel0()},getAddExp:function(){return this.getCharacterMaterialMaster().getAddExp()},getAddExceedLimitExp:function(){return this.getCharacterMaterialMaster().getAddExceedLimitExp()},getAddSkillUpRate:function(){return this.getCharacterMaterialMaster().getAddSkillUpRate()},getMaterialType:function(){return this.getCharacterMaterialMaster().getMaterialType()},getSkillFortifyType:function(){return this.getSkillMainMaster().getSkillFortifyType()},getMaxLevel1:function(){return this.getCharacterMainMaster().getMaxLevel1()},getAtkName:function(){return this.getEquipmentMainMaster().getName()},getLimitBreakAfterRarity:function(){return this.getCharacterMainMaster().getRarity()+this.userData.getExceedLimit()},getSkillLv:function(){return this.userData.getSkillLevel()},_getExceedLimitByLevel:function(t){for(var e=0,i=0;i<=this.getCharacterExceedLimitMasterArray().length;i++)if(t<=this.getMaxLevelByExceedLimit(i)){e=i;break}return e},getMaxLevel:function(){var t=this.getExceedLimit();return this.getMaxLevelByExceedLimit(t)},getMaxLevelByExceedLimit:function(t){return{0:this.getCharacterMainMaster().getMaxLevel0(),1:this.getCharacterMainMaster().getMaxLevel1(),2:this.getCharacterMainMaster().getMaxLevel2(),3:this.getCharacterMainMaster().getMaxLevel3(),4:this.getCharacterMainMaster().getMaxLevel4()}[t]},_getMinLevel:function(){var t=this.getExceedLimit()-1;return t<0?1:this.getMaxLevelByExceedLimit(t)},_getMinLevelByExceedLimit:function(t){return(t-=1)<0?1:this.getMaxLevelByExceedLimit(t)},getTotalBasePower:function(){return this.getHp()+this.getAtk()+this.getDef()},getTotalPower:function(t){return this.getTotalHp(t)+this.getTotalAtk(t)+this.getTotalDef(t)},getTotalPowerByLevel:function(t){return this.getHpByLevel(t)+this.getAtkByLevel(t)+this.getDefByLevel(t)},_getPictureBookDetailModel:function(){return g.getPictureBookDetailModelByCharacterId(this.getCharacterId())},getTotalHp:function(t){t||(t=this.getLevel());var e=this._getPictureBookDetailModel();return e?this._getTotalHpByLevel(t,e.getFriendshipBonusHp()):this._getTotalHpByLevel(t,0)},_getTotalHpByLevel:function(t,e){e=e||0;var i=this.getEquipmentStatus().hp,a=this.getHpByLevel(t)+i+e;return a+this.getEquipmentEffect(a).hp},getTotalHpExceptEquipEffect:function(){var t=this._getPictureBookDetailModel();return t?this.getTotalHpByLevelExceptEquipEffect(this.getLevel())+t.getFriendshipBonusHp():this.getTotalHpByLevelExceptEquipEffect(this.getLevel())},getTotalHpByLevelExceptEquipEffect:function(t){var e=this.getEquipmentStatus().hp;return this.getHpByLevel(t)+e},getHp:function(){this._hpValue||(this._hpValue=this.getHpByLevel(this.getLevel()));var t=this._getPictureBookDetailModel();return t?this._hpValue+t.getFriendshipBonusHp():this._hpValue},getHpByLevel:function(t){var e=this._getExceedLimitByLevel(t),i=this._getMaxHpByExceedLimit(e),a=this._getMinHpByExceedLimit(e),n=t-this._getMinLevelByExceedLimit(e),o=this.getMaxLevelByExceedLimit(e)-this._getMinLevelByExceedLimit(e);return parseInt((i-a)*(n/o)+a)},_getMaxHpByExceedLimit:function(t){return{0:this.getCharacterMainMaster().getMaxHp0(),1:this.getCharacterMainMaster().getMaxHp1(),2:this.getCharacterMainMaster().getMaxHp2(),3:this.getCharacterMainMaster().getMaxHp3(),4:this.getCharacterMainMaster().getMaxHp4()}[t]},_getMinHpByExceedLimit:function(t){return(t-=1)<0?this.getCharacterMainMaster().getMinHp():this._getMaxHpByExceedLimit(t)},getTotalAtk:function(t){t||(t=this.getLevel());var e=this._getPictureBookDetailModel();return e?this._getTotalAtkByLevel(t,e.getFriendshipBonusAtk()):this._getTotalAtkByLevel(t,0)},_getTotalAtkByLevel:function(t,e){e=e||0;var i=this.getEquipmentStatus().atk,a=this.getAtkByLevel(t)+i+e;return a+this.getEquipmentEffect(void 0,a).atk},getTotalAtkExceptEquipEffect:function(){var t=this._getPictureBookDetailModel();return t?this.getTotalAtkByLevelExceptEquipEffect(this.getLevel())+t.getFriendshipBonusAtk():this.getTotalAtkByLevelExceptEquipEffect(this.getLevel())},getTotalAtkByLevelExceptEquipEffect:function(t){var e=this.getEquipmentStatus().atk;return this.getAtkByLevel(t)+e},getAtk:function(){this._atkValue||(this._atkValue=this.getAtkByLevel(this.getLevel()));var t=this._getPictureBookDetailModel();return t?this._atkValue+t.getFriendshipBonusAtk():this._atkValue},getAtkByLevel:function(t){var e=this._getExceedLimitByLevel(t),i=this._getMaxAtkByExceedLimit(e),a=this._getMinAtkByExceedLimit(e),n=t-this._getMinLevelByExceedLimit(e),o=this.getMaxLevelByExceedLimit(e)-this._getMinLevelByExceedLimit(e);return parseInt((i-a)*(n/o)+a)},_getMaxAtkByExceedLimit:function(t){return{0:this.getCharacterMainMaster().getMaxAtk0(),1:this.getCharacterMainMaster().getMaxAtk1(),2:this.getCharacterMainMaster().getMaxAtk2(),3:this.getCharacterMainMaster().getMaxAtk3(),4:this.getCharacterMainMaster().getMaxAtk4()}[t]},_getMinAtkByExceedLimit:function(t){return(t-=1)<0?this.getCharacterMainMaster().getMinAtk():this._getMaxAtkByExceedLimit(t)},getTotalDef:function(t){t||(t=this.getLevel());var e=this._getPictureBookDetailModel();return e?this._getTotalDefByLevel(t,e.getFriendshipBonusDef()):this._getTotalDefByLevel(t,0)},_getTotalDefByLevel:function(t,e){e=e||0;var i=this.getEquipmentStatus().def,a=this.getDefByLevel(t)+i+e;return a+this.getEquipmentEffect(void 0,void 0,a).def},getTotalDefExceptEquipEffect:function(){var t=this._getPictureBookDetailModel();return t?this.getTotalDefByLevelExceptEquipEffect(this.getLevel())+t.getFriendshipBonusDef():this.getTotalDefByLevelExceptEquipEffect(this.getLevel())},getTotalDefByLevelExceptEquipEffect:function(t){var e=this.getEquipmentStatus().def;return this.getDefByLevel(t)+e},getDef:function(){this._defValue||(this._defValue=this.getDefByLevel(this.getLevel()));var t=this._getPictureBookDetailModel();return t?this._defValue+t.getFriendshipBonusDef():this._defValue},getDefByLevel:function(t){var e=this._getExceedLimitByLevel(t),i=this._getMaxDefByExceedLimit(e),a=this._getMinDefByExceedLimit(e),n=t-this._getMinLevelByExceedLimit(e),o=this.getMaxLevelByExceedLimit(e)-this._getMinLevelByExceedLimit(e);return parseInt((i-a)*(n/o)+a)},_getMaxDefByExceedLimit:function(t){return{0:this.getCharacterMainMaster().getMaxDef0(),1:this.getCharacterMainMaster().getMaxDef1(),2:this.getCharacterMainMaster().getMaxDef2(),3:this.getCharacterMainMaster().getMaxDef3(),4:this.getCharacterMainMaster().getMaxDef4()}[t]},_getMinDefByExceedLimit:function(t){return(t-=1)<0?this.getCharacterMainMaster().getMinDef():this._getMaxDefByExceedLimit(t)},getTotalStatus:function(){return this.getTotalHp()+this.getTotalAtk()+this.getTotalDef()},getContentsGroupId:function(){return this.getCharacterMainMaster().getContentsGroupId()},getCharacterType:function(){return this.getCharacterMainMaster().getCharacterType()},getSpineName:function(){return this.getCharacterMainMaster().getSpineName()},getSpineDirectoryPath:function(){return this.getCharacterMainMaster().getSpineDirectoryPath()},getCharacterNormalAttackMaster:function(){return this._characterNormalAttackMaster||(this._characterNormalAttackMaster=n.dao.CharacterNormalAttackMasters.find(function(t){return t.getNormalAttackId()===this.getCharacterMainMaster().getNormalAttackId()}.bind(this))),this._characterNormalAttackMaster},getExceedLimitType:function(){return this.getCharacterMainMaster().getExceedLimitType()},getExceedLimitMaterialId:function(){return this.getCharacterExceedLimitMaster().getMaterialId()},getExceedLimitMaterialCount:function(){return this.getCharacterExceedLimitMaster().getMaterialCount()},getExceedLimitPrice:function(){return this.getCharacterExceedLimitMaster().getExceedLimitPrice()},getEventBoost:function(){return m.isBoostCharacter(this.getCharacterGroupId(),this.getCharacterId(),this.getRarity())?1:0},getEquipmentStatus:function(t){t||(t=this.getCharacterEquipmentInfoArray());var e=0,i=0,a=0,n=this.getCharacterMainMaster().getAttribute();for(var o in t){var r=t[o];r.equipmentModel&&(e+=r.equipmentModel.getHp(n),i+=r.equipmentModel.getAtk(n),a+=r.equipmentModel.getDef(n))}return{hp:e,atk:i,def:a}},getEquipmentEffect:function(t,e,i,a){a||(a=this.getCharacterEquipmentInfoArray());var n=0,o=0,s=0,c=this.getCharacterMainMaster().getAttribute();for(var l in a){var u=a[l];a[l].equipmentModel&&(t&&(n+=u.equipmentModel.getHpEffect(c,t)),e&&(o+=u.equipmentModel.getAtkEffect(c,e)),i&&(s+=u.equipmentModel.getDefEffect(c,i)))}return t&&(n=r.calcEquipmentEffectLimit(t,n)),e&&(o=r.calcEquipmentEffectLimit(e,o)),i&&(s=r.calcEquipmentEffectLimit(i,s)),{hp:n,atk:o,def:s}},hasExceedableMaterial:function(){return!this.getIsMaxExceedLimit()&&(!!this.hasExceedableMaterialCharacter()||!!this.hasExceedableMaterialItem())},hasExceedableMaterialCharacter:function(){return r.getExceedLimitMaterialCharacterModelArray(this).length>0},hasExceedableMaterialItem:function(){return h.getUserItemCount(this.getExceedLimitMaterialId())>=this.getExceedLimitMaterialCount()},hasAbilityFotifyableMaterial:function(){for(var t=this.getCharacterAbilityInfoArray(),e=0;e<t.length;e+=1)if(t[e].isReleased&&t[e].abilityLevel<t[e].maxAbilityLevel){var i=l.createCharacterAbilityUpMaterialInfoArray(t[e].abilityMainMaster.getAbilityFortifyType(),t[e].abilityLevel);if(_.every(i,function(t){return!t.itemId||t.count<=h.getUserItemCount(t.itemId)}))return!0}return!1}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CharacterConst:"CharacterConst",CharacterEquipmentUtils:"CharacterEquipmentUtils",CharacterSkillUtils:"CharacterSkillUtils",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",EquipmentUtils:"EquipmentUtils",EventUtils:"EventUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PictureBookUtils:"PictureBookUtils",Singleton:"Singleton",UserCharacterModel:"UserCharacterModel"}],CharacterNormalAttackModel:[function(t,e,i){"use strict";cc._RF.push(e,"ba260J+2wNKfaiO5XmkANT8","CharacterNormalAttackModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSpineDirectoryPath:function(){if(this._isKeyFieldAvailable("spineDirectoryPath"))return this._data.spineDirectoryPath;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: spineDirectoryPath")},getHitEffectName:function(){if(this._isKeyFieldAvailable("hitEffectName"))return this._data.hitEffectName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: hitEffectName")},getNormalAttackId:function(){if(this._isKeyFieldAvailable("normalAttackId"))return this._data.normalAttackId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: normalAttackId")},getAniName:function(){if(this._isKeyFieldAvailable("aniName"))return this._data.aniName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: aniName")},getEffectShowValue:function(){if(this._isKeyFieldAvailable("effectShowValue"))return this._data.effectShowValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectShowValue")},getEffectShowType:function(){if(this._isKeyFieldAvailable("effectShowType"))return this._data.effectShowType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectShowType")},getHitEffectAniName:function(){if(this._isKeyFieldAvailable("hitEffectAniName"))return this._data.hitEffectAniName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: hitEffectAniName")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterParameterUtils:[function(t,e,i){"use strict";cc._RF.push(e,"eb07eJ9LbVK4Z7PTBOSljyD","CharacterParameterUtils");var a=t("Singleton");function n(t){var e=a.dao.CharacterMainMasters.find(function(e){return e.getCharacterId()===t});return a.dao.CharacterExceedLimitMasters.filter(function(t){return t.getExceedLimitType()===e.getExceedLimitType()}).reduce(function(t,e){return Math.max(t,e.getExceedLimit())},0)}function o(t){var e=a.dao.CharacterMainMasters.find(function(e){return e.getCharacterId()===t}),i=n(t);return{hp:e["getMaxHp"+i](),atk:e["getMaxAtk"+i](),def:e["getMaxDef"+i]()}}e.exports={getMaxExceedLimit:n,getMaxLevel:function(t){return a.dao.CharacterMainMasters.find(function(e){return e.getCharacterId()===t})["getMaxLevel"+n(t)]()},getMaxBattleParameter:o,getMaxTotalBattleParameter:function(t){var e=o(t);return{total:e.hp+e.atk+e.def,hp:e.hp,atk:e.atk,def:e.def}}},cc._RF.pop()},{Singleton:"Singleton"}],CharacterService:[function(t,e,i){"use strict";cc._RF.push(e,"48566v/1YZF2busTvrzH3/h","CharacterService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,sell:function(t,e){var i={materials:t.join(",")};this._requestCallApi(n.CHARACTER_SELL,i,function(t,i){return e(t?void 0:i)})},sellWarehouse:function(t,e,i,a){var o={characterCd:t,count:e,warehouseType:i};this._requestCallApi(n.CHARACTER_SELL_WAREHOUSE,o,function(t,e){return a(t?void 0:e)})},fortify:function(t,e,i){var a={characterCd:t,materials:e.join(",")};this._requestCallApi(n.CHARACTER_FORTIFY,a,function(t,e){return i(t?void 0:e)})},fortifyWarehouse:function(t,e,i,a){var o={characterCd:t,materials:e,materialWarehouseType:i};this._requestCallApi(n.CHARACTER_FORTIFY_WAREHOUSE,o,function(t,e){return a(t?void 0:e)})},fortifySkill:function(t,e,i){var a={characterCd:t,materials:e.join(",")};this._requestCallApi(n.CHARACTER_FORTIFY_SKILL,a,function(t,e){return i(t?void 0:e)})},fortifySkillWarehouse:function(t,e,i){var a={characterCd:t,materials:e};this._requestCallApi(n.CHARACTER_FORTIFY_SKILL_WAREHOUSE,a,function(t,e){return i(t?void 0:e)})},fortifyAbility:function(t,e,i){var a={characterCd:t,abilityIndex:e};this._requestCallApi(n.CHARACTER_FORTIFY_ABILITY,a,function(t,e){return i(t?void 0:e)})},equip:function(t,e){var i={charactersEquipment:t};this._requestCallApi(n.CHARACTER_EQUIP,i,function(t,i){return e(t?void 0:i)})},equipRemoveAll:function(t){this._requestCallApi(n.CHARACTER_EQUIP_REMOVE_ALL,{},function(e,i){return t(e?void 0:i)})},exceedLimit:function(t,e,i){var a={characterCd:t,materials:e.join(",")};this._requestCallApi(n.CHARACTER_EXCEED_LIMIT,a,function(t,e){return i(t?void 0:e)})},exceedLimitWarehouse:function(t,e,i){var a={characterCd:t,materials:e};this._requestCallApi(n.CHARACTER_EXCEED_LIMIT_WAREHOUSE,a,function(t,e){return i(t?void 0:e)})},exceedLimitByItem:function(t,e){var i={characterCd:t};this._requestCallApi(n.CHARACTER_EXCEED_LIMIT_ITEM,i,function(t,i){return e(t?void 0:i)})},changeProtect:function(t,e){var i={characterCds:t.join(",")};this._requestCallApi(n.CHARACTER_CHANGE_PROTECT,i,function(t,i){return e(t?void 0:i)})},changePartner:function(t,e,i){var a={characterId:t.join(","),isDisplayRoom:e};this._requestCallApi(n.CHARACTER_CHANGE_PARTNER,a,function(t,e){return i(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],CharacterSkillEffectModel:[function(t,e,i){"use strict";cc._RF.push(e,"a9d31oIqMZAm40MGygQ48nE","CharacterSkillEffectModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getIndex:function(){if(this._isKeyFieldAvailable("c"))return this._data.c;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getOccurrenceRate:function(){if(this._isKeyFieldAvailable("l"))return this._data.l;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: occurrenceRate")},getEffectConditionType:function(){if(this._isKeyFieldAvailable("j"))return this._data.j;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectConditionType")},getLevel:function(){if(this._isKeyFieldAvailable("b"))return this._data.b;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getSuccessRate:function(){if(this._isKeyFieldAvailable("m"))return this._data.m;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: successRate")},getText:function(){if(this._isKeyFieldAvailable("d"))return this._data.d;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getShortText:function(){if(this._isKeyFieldAvailable("e"))return this._data.e;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shortText")},getEffectLimit:function(){if(this._isKeyFieldAvailable("i"))return this._data.i;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectLimit")},getEffectConditionValue:function(){if(this._isKeyFieldAvailable("k"))return this._data.k;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectConditionValue")},getTargetType:function(){if(this._isKeyFieldAvailable("n"))return this._data.n;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetType")},getEffectValue:function(){if(this._isKeyFieldAvailable("h"))return this._data.h;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectValue")},getActionType:function(){if(this._isKeyFieldAvailable("f"))return this._data.f;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: actionType")},getEndValue:function(){if(this._isKeyFieldAvailable("q"))return this._data.q;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endValue")},getEffectType:function(){if(this._isKeyFieldAvailable("g"))return this._data.g;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectType")},getEndType:function(){if(this._isKeyFieldAvailable("p"))return this._data.p;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endType")},getTargetValue:function(){if(this._isKeyFieldAvailable("o"))return this._data.o;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetValue")},getSkillId:function(){if(this._isKeyFieldAvailable("a"))return this._data.a;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skillId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterSkillMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"ea01fp3nYVAqrA27Wk1yZwi","CharacterSkillMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSkillId:function(){if(this._isKeyFieldAvailable("skillId"))return this._data.skillId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skillId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getEffectShowType:function(){if(this._isKeyFieldAvailable("effectShowType"))return this._data.effectShowType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectShowType")},getSpineDirectoryPath:function(){if(this._isKeyFieldAvailable("spineDirectoryPath"))return this._data.spineDirectoryPath;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: spineDirectoryPath")},getSpineName:function(){if(this._isKeyFieldAvailable("spineName"))return this._data.spineName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: spineName")},getAniName:function(){if(this._isKeyFieldAvailable("aniName"))return this._data.aniName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: aniName")},getHitEffectName:function(){if(this._isKeyFieldAvailable("hitEffectName"))return this._data.hitEffectName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: hitEffectName")},getHitEffectAniName:function(){if(this._isKeyFieldAvailable("hitEffectAniName"))return this._data.hitEffectAniName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: hitEffectAniName")},getBgmVolumeAmount:function(){if(this._isKeyFieldAvailable("bgmVolumeAmount"))return this._data.bgmVolumeAmount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bgmVolumeAmount")},getSkillFortifyType:function(){if(this._isKeyFieldAvailable("skillFortifyType"))return this._data.skillFortifyType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skillFortifyType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterSkillUpModel:[function(t,e,i){"use strict";cc._RF.push(e,"5e149DgJBZCW79iourwxJ8H","CharacterSkillUpModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSkillFortifyType:function(){if(this._isKeyFieldAvailable("skillFortifyType"))return this._data.skillFortifyType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skillFortifyType")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getAddSkillUpRate1:function(){if(this._isKeyFieldAvailable("addSkillUpRate1"))return this._data.addSkillUpRate1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addSkillUpRate1")},getAddSkillUpRate2:function(){if(this._isKeyFieldAvailable("addSkillUpRate2"))return this._data.addSkillUpRate2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addSkillUpRate2")},getAddSkillUpRate3:function(){if(this._isKeyFieldAvailable("addSkillUpRate3"))return this._data.addSkillUpRate3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addSkillUpRate3")},getAddSkillUpRate4:function(){if(this._isKeyFieldAvailable("addSkillUpRate4"))return this._data.addSkillUpRate4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addSkillUpRate4")},getPrice:function(){if(this._isKeyFieldAvailable("price"))return this._data.price;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: price")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterSkillUpRateModel:[function(t,e,i){"use strict";cc._RF.push(e,"fb5c7CN2qJAbIjPRQvdv9Ss","CharacterSkillUpRateModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLuckTotal:function(){if(this._isKeyFieldAvailable("luckTotal"))return this._data.luckTotal;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: luckTotal")},getSkillLevel:function(){if(this._isKeyFieldAvailable("skillLevel"))return this._data.skillLevel;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skillLevel")},getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterSkillUtils:[function(t,e,i){"use strict";cc._RF.push(e,"d9fcdvzdUpFmoRoQjo/91G9","CharacterSkillUtils");var a=t("Singleton"),n=t("CharacterConst"),o=t("CharacterUtils");function r(t,e){return a.dao.CharacterSkillUpMasters.find(function(i){return i.getSkillFortifyType()===t&&i.getLevel()===e})}function s(t){return a.dao.CharacterSkillUpMasters.filter(function(e){return e.getSkillFortifyType()===t}).length+1}function c(t,e){return t["getAddSkillUpRate"+e].apply(t)}function l(t,e,i,a,n){return{skillMainMaster:t,skillEffectMasterArray:e,skillText:i,skillLevel:a,maxSkillLevel:n}}e.exports={getSkillUpMaterialCharacterModelArray:function(t,e){return a.dao.userCharacters.filter(function(i){return(i.getCharacterGroupId()===t||i.getCharacterType()===n.CHARACTER_TYPE.SKILL_UP)&&i.getCharacterCd()!==e&&i.getCharacterType()!==n.CHARACTER_TYPE.ROOM})},getCharacterSkillUpMaster:r,getMaxLevelSkillInfoByCharacterId:function(t){var e=a.dao.CharacterMainMasters.find(function(e){return e.getCharacterId()===t}),i=a.dao.CharacterSkillMainMasters.find(function(t){return t.getSkillId()===e.getSkillId()}),n=s(i.getSkillFortifyType()),r=a.dao.CharacterSkillEffectMasters.filter(function(t){return t.getSkillId()===e.getSkillId()&&t.getLevel()===n});return l(i,r,o.convertEffectText(r),n,n)},calcTotalSkillUpRate:function(t,e,i){var a=0;for(var o in t)t[o].getCharacterGroupId()!==i.getCharacterGroupId()&&t[o].getCharacterType()!==n.CHARACTER_TYPE.SKILL_UP||(t[o].getCharacterId()===i.getCharacterId()?a+=n.SKILL_FORTIFY_MAX_RATE:a+=c(r(t[o].getSkillFortifyType(),e.skillLevel),i.getRarity()));return a},calcSkillFortifyPrice:function(t,e,i){return r(i.getSkillFortifyType(),e.skillLevel).getPrice()*t.length},createCharacterSkillEffectMasterMap:function(t){var e={},i=_.filter(a.dao.CharacterSkillEffectMasters,function(e){return e.getSkillId()===t});for(var n in i)e[i[n].getLevel()]||(e[i[n].getLevel()]=[]),e[i[n].getLevel()].push(i[n]);return e},createCharacterSkillInfo:l,convertEffectText:function(t){var e="";for(var i in t){e&&"\u3001"!==e.slice(-1)&&(e+="\n");var a=t[i].getEffectValue();e+=t[i].getText().replace("{0}",Math.abs(a))}return e}},cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",Singleton:"Singleton"}],CharacterSortConst:[function(t,e,i){"use strict";cc._RF.push(e,"57a01cMT0xHtpQvJkDdUxas","CharacterSortConst");cc.Class({statics:{SORT_TYPE:cc.Enum({GETTING:0,LEVEL:1,ATTRIBUTE:2,RARE:3,TOTAL:4,HP:5,ATK:6,DEF:7,BOOST:8}),SORT_FUNC_NAME:{GETTING:"getCharacterCd",LEVEL:"getLevel",ATTRIBUTE:"getAttribute",RARE:"getRarity",TOTAL:"getTotalPower",HP:"getTotalHp",ATK:"getTotalAtk",DEF:"getTotalDef",BOOST:"getEventBoost"}}});cc._RF.pop()},{}],CharacterStandView:[function(t,e,i){"use strict";cc._RF.push(e,"6d63dK3csxJmpfChd/khivq","CharacterStandView");var a=t("CharacterUtils"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{stand:cc.Sprite},_characterGroupId:null,_characterId:null,_characterModel:null,setCharacterStandImage:function(t){this._characterId=t,this._characterModel=a.getCharacterMainModelByCharacterId(t),n.addSprite(this.stand,n.getFileNameCharacterStand(t),this._setCharacterStandPosition.bind(this))},setCharacterGroupStandImage:function(t){this._characterGroupId=t,this._characterModel=a.getCharacterGroupMasterByCharacterGroupId(t),n.addSprite(this.stand,n.getFileNameCharacterGroupStand(t),this._setCharacterStandPosition.bind(this))},_setCharacterStandPosition:function(){this.stand.node.position=cc.v2(this._characterModel.getStandHeadPositionX(),this._characterModel.getStandHeadPositionY())}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",ResourceUtils:"ResourceUtils"}],CharacterTextModel:[function(t,e,i){"use strict";cc._RF.push(e,"d4dfbrT47JOCqwYWIUTJ5Bd","CharacterTextModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getSceneType:function(){if(this._isKeyFieldAvailable("sceneType"))return this._data.sceneType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sceneType")},getGroupType:function(){if(this._isKeyFieldAvailable("groupType"))return this._data.groupType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: groupType")},getTextId:function(){if(this._isKeyFieldAvailable("textId"))return this._data.textId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: textId")},getTitle:function(){if(this._isKeyFieldAvailable("title"))return this._data.title;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: title")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getSkinName:function(){if(this._isKeyFieldAvailable("skinName"))return this._data.skinName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skinName")},getVoiceFile:function(){if(this._isKeyFieldAvailable("voiceFile"))return this._data.voiceFile;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: voiceFile")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],CharacterUtils:[function(t,e,i){"use strict";cc._RF.push(e,"2408dN7nclJ8YhXCIKjEGuJ","CharacterUtils");var a=t("Singleton"),n=t("CharacterConst"),o=t("EquipmentConst"),r=t("GameConst"),s=t("CharacterSortConst"),c=(t("CommonUtils"),t("DeckUtils"));t("ItemConst");function l(t,e){return e=e||1,_.maxBy(_.filter(a.dao.CharacterLevelMasters,function(i){return i.getExpType()===e&&i.getTotalExp()<=t}),function(t){return t.getTotalExp()})}function u(t,e){return e=e||1,a.dao.CharacterLevelMasters.find(function(i){return i.getLevel()===t&&i.getExpType()===e})}function h(t,e){return a.dao.CharacterExceedLimitMasters.find(function(i){return i.getExceedLimitType()===t&&i.getExceedLimit()===e})}function d(t,e){return e=e||1,a.dao.CharacterExceedLimitMasters.find(function(i){return(0===i.getNeedExceedLimitExp()?i.getTotalExceedLimitExp()+i.getNeedExceedLimitExp()>=t:i.getTotalExceedLimitExp()+i.getNeedExceedLimitExp()>t)&&t>=i.getTotalExceedLimitExp()&&i.getExceedLimitType()===e})}function p(t){switch(t){case r.RARITY.N:return n.MATERIAL_CATEGORY.N;case r.RARITY.R:return n.MATERIAL_CATEGORY.R;case r.RARITY.SR:return n.MATERIAL_CATEGORY.SR;case r.RARITY.SSR:return n.MATERIAL_CATEGORY.SSR}return n.MATERIAL_CATEGORY.N}e.exports={getCharacterLevelMasterByTotalExp:l,getCharacterLevelMasterByLevel:u,getCharacterLevelByTotalExp:function(t,e){return l(t,e).getLevel()},getCharacterExceedLimitMasterByTotalExceedLimitExp:d,getCharacterExceedLimitByTotalExceedLimitExp:function(t,e){return d(t,e).getExceedLimit()},getExceedLimitMasterArrayByExceedLimitType:function(t){return _.filter(a.dao.CharacterExceedLimitMasters,function(e){return e.getExceedLimitType()===t})},getCharacterMainMasterArrayByCharacterGroupId:function(t){return a.dao.CharacterMainMasters.filter(function(e){return e.getCharacterGroupId()===t})},getCharacterGroupMasterByCharacterGroupId:function(t){return a.dao.CharacterGroupMasters.find(function(e){return e.getCharacterGroupId()===t})},getCharacterSkillMainMasterMapIndexBySkillId:function(){for(var t={},e=a.dao.CharacterSkillMainMasters,i=0;i<e.length;i+=1)t[e[i].getSkillId()]=e[i];return t},getPreEntryCharacterMinigameMainModelByCharacterId:function(t){return a.dao.MinigameCharacterMainMasters.find(function(e){return e.getCharacterId()===t})},getMinigameTextList:function(t,e){return a.dao.MinigameCharacterTextMasters.filter(function(i){return i.getCharacterId()===t&&i.getRivalCharacterId()===e})},createUserCharacterModelMap:function(){var t={},e=a.dao.userCharacters;for(var i in e)t[e[i].getCharacterCd()]=e[i];return t},getCharacterModelArrayByCharacterTypes:function(t){return _.filter(a.dao.userCharacters,function(e){return _.some(t,function(t){return e.getCharacterType()===t})})},getPlayableUserCharacterModelArray:function(){return a.dao.userCharacters.filter(function(t){return t.getCharacterType()===n.CHARACTER_TYPE.NORMAL})},getNonPlayableUserCharacterModelArray:function(){return a.dao.userCharacters.filter(function(t){return t.getCharacterType()===n.CHARACTER_TYPE.FORTIFY||t.getCharacterType()===n.CHARACTER_TYPE.SKILL_UP||t.getCharacterType()===n.CHARACTER_TYPE.SELL||t.getCharacterType()===n.CHARACTER_TYPE.EXCEEDLIMIT||t.getCharacterType()===n.CHARACTER_TYPE.ABILITY_UP})},getMaterialCharacterModelArray:function(t){return a.dao.userCharacters.filter(function(e){return!c.isDeckUnit(e.getCharacterCd())&&!e.getIsProtect()&&e.getCharacterType()!==n.CHARACTER_TYPE.ROOM&&e.getCharacterCd()!==t})},getFortifyMaterialCharacterModelArray:function(t){return a.dao.userCharacters.filter(function(e){return!(c.isDeckUnit(e.getCharacterCd())||e.getIsProtect()||e.getCharacterCd()===t||e.getCharacterType()!==n.CHARACTER_TYPE.NORMAL&&e.getCharacterType()!==n.CHARACTER_TYPE.FORTIFY)})},getExceedLimitMaterialCharacterModelArray:function(t){return a.dao.userCharacters.filter(function(e){return e.getCharacterId()===t.getCharacterId()&&e.getCharacterCd()!==t.getCharacterCd()||e.getCharacterType()===n.CHARACTER_TYPE.EXCEEDLIMIT})},getNotRoomUserCharacterModelArray:function(){return a.dao.userCharacters.filter(function(t){return t.getCharacterType()!==n.CHARACTER_TYPE.ROOM})},getCharacterModelByCharacterCd:function(t,e){return(e=e||a.dao.userCharacters).find(function(e){return e.getCharacterCd()===t})},getCharacterMainModelByCharacterId:function(t){return a.dao.CharacterMainMasters.find(function(e){return e.getCharacterId()===t})},getCharacterModelByEquipmentCd:function(t,e){return(e=e||a.dao.userCharacters).find(function(e){return e.getEquipmentWeaponCds().find(function(e){return e===t})||e.getEquipmentProtectorCds().find(function(e){return e===t})})},getSortParameter:function(t,e){return t[s.SORT_FUNC_NAME[Object.keys(s.SORT_TYPE)[e]]].apply(t)},createCharacterGroupMasterMap:function(t){t=Array.isArray(t)?t:a.dao.CharacterGroupMasters;var e={};for(var i in t){var n=t[i];e[n.getCharacterGroupId()]=n}return e},createFortifyMaterialCharacterModelMapArray:function(t){var e={};for(t=t?t.slice():a.dao[a.USER_CHARACTER].slice(),e[n.MATERIAL_CATEGORY.ABILITY]=[],e[n.MATERIAL_CATEGORY.SKILL]=[],e[n.MATERIAL_CATEGORY.N]=[],e[n.MATERIAL_CATEGORY.R]=[],e[n.MATERIAL_CATEGORY.SR]=[],e[n.MATERIAL_CATEGORY.SSR]=[];t.length>0;){var i=t.pop();switch(i.getCharacterType()){case n.CHARACTER_TYPE.SKILL:e[n.MATERIAL_CATEGORY.SKILL].push(i);break;case n.CHARACTER_TYPE.ABILITY:e[n.MATERIAL_CATEGORY.ABILITY].push(i);break;default:e[p(i.getRarity())].push(i)}}return e},createExceedLimitMaterialCharacterModelMapArray:function(t,e){var i={};for(t=t?t.slice():a.dao[a.USER_CHARACTER].slice(),i[n.MATERIAL_CATEGORY.SAME]=[],i[n.MATERIAL_CATEGORY.N]=[],i[n.MATERIAL_CATEGORY.R]=[],i[n.MATERIAL_CATEGORY.SR]=[],i[n.MATERIAL_CATEGORY.SSR]=[];t.length>0;){var o=t.pop();o.getCharacterId()===e?i[n.MATERIAL_CATEGORY.SAME].push(o):i[p(o.getRarity())].push(o)}return i},calcTotalSellPrice:function(t){var e=0;for(var i in t)e+=t[i].getSalePrice();return e},calcTotalMaterialExp:function(t,e){var i=0;for(var a in t)t[a].getAttribute()===e.getAttribute()?i+=t[a].getAddExp()*n.SAME_ATTRIBUTE_MATERIAL_BONUS_RATE:i+=t[a].getAddExp();return i},calcTotalMaterialExceedLimitExp:function(t,e,i){var a=0;for(var o in t){var r=t[o];a+=r.getCharacterId()===e.getCharacterId()?e.getNeedExpForNextExceedLimit():r.getCharacterGroupId()===e.getCharacterGroupId()?r.getAddExceedLimitExp()*n.SAME_CHARACTER_GROUP_BONUS_RATIO:r.getAddExceedLimitExp()}return i?parseInt(a):parseInt(Math.min(a,e.getNeedExpForNextExceedLimit()))},calcTotalMaterialPlice:function(t,e){return t.getFortifyPrice()*e},calcExceedLimitPrice:function(t,e,i){for(var a=0,n=e;n<i;n+=1)a+=h(t,n).getExceedLimitPrice();return a},calcExpRateForNextLevelByTotalExp:function(t,e){var i=l(t,e);return(t-i.getTotalExp())/i.getNextLevelExp()},calcNeedExpForNextLevelByTotalExp:function(t,e){var i=l(t,e),a=t-i.getTotalExp();return i.getNextLevelExp()-a},calcRemainingExpForMaxLevelByMaxLevelAndTotalExp:function(t,e,i){return u(t,i).getTotalExp()-e},calcExceedLimitExpRateForNextExceedLimitByTotalExceedLimitExp:function(t,e){var i=d(t,e);return(t-i.getTotalExceedLimitExp())/i.getNeedExceedLimitExp()},calcNeedExceedLimitExpForNextExceedLimitByTotalExceedLimitExp:function(t,e){var i=d(t,e),a=t-i.getTotalExceedLimitExp();return i.getNeedExceedLimitExp()-a},calcEquipmentEffectLimit:function(t,e){var i=t*(o.EQUIPMENT_BUFF_POWER_MAX_PERCENTAGE/100);return e<i?e:i},convertEffectText:function(t){var e="";for(var i in t){e&&"\u3001"!==e.slice(-1)&&(e+="\n");var a=t[i].getEffectValue();e+=t[i].getText().replace("{0}",Math.abs(a))}return e},convertViewSortType:function(t){var e=t;switch(t){case s.SORT_TYPE.GETTING:case s.SORT_TYPE.ATTRIBUTE:case s.SORT_TYPE.BOOST:case s.SORT_TYPE.RARE:e=s.SORT_TYPE.LEVEL}return e},convertSortTypeToText:function(t){switch(t){case s.SORT_TYPE.GETTING:return"\u5165\u624b\u9806";case s.SORT_TYPE.LEVEL:return"Lv\u9806";case s.SORT_TYPE.ATTRIBUTE:return"\u5c5e\u6027\u9806";case s.SORT_TYPE.RARE:return"\u30ec\u30a2\u9806";case s.SORT_TYPE.TOTAL:return"\u6226\u529b\u9806";case s.SORT_TYPE.HP:return"Hp\u9806";case s.SORT_TYPE.ATK:return"Atk\u9806";case s.SORT_TYPE.DEF:return"Def\u9806";case s.SORT_TYPE.BOOST:return"\u7279\u653b\u9806"}return""},isCharacterExceedLimitMaterialAlert:function(t){return t.some(function(t){return t.getRarity()>=r.RARITY.SR||t.getLevel()>1||t.getExceedLimit()>0||t.getSkillLevel()>1||t.getAbilityLevel1()>1||t.getAbilityLevel2()>1||t.getAbilityLevel3()>1})}},cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterSortConst:"CharacterSortConst",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",EquipmentConst:"EquipmentConst",GameConst:"GameConst",ItemConst:"ItemConst",Singleton:"Singleton"}],CircleRollView:[function(t,e,i){"use strict";cc._RF.push(e,"94699UGh4FDBoj8LkwvMTMH","CircleRollView");var a=t("LoopRollView"),n=(t("CommonButton"),t("GameConst")),o=t("CommonUtils");cc.Class({extends:a,properties:{subsequentDisplayCount:1,subsequentColor:cc.Color.GRAY,subsequentScale:.75,centerScale:1,defaultCircleRadius:cc.Vec2,additionalCircleRadius:cc.Vec2},_circleRadius:null,_diffAngle:0,_currentIndex:0,_currentDiffAngle:0,_contentNodeArray:null,_callbackToSwitchContent:null,onLoad:function(){this.subsequentDisplayCount=parseInt(this.subsequentDisplayCount)},initCircleRollView:function(){this.initBase(),this._circleRadius=cc.v2(1,1),this._contentNodeArray=[];for(var t=0;t<this.content.childrenCount;t++)this._contentNodeArray.push(this.content.children[t]);this._adjustDiffSpace(),this._currentIndex=0,this._currentDiffAngle=0,this._drawContentByIndex(!1)},addContent:function(t){t.isChildOf(this.content)||(this.content.addChild(t),this._contentNodeArray.push(t),this._addContentEvent(t),this._calcRadius(this._contentNodeArray.length),this._adjustDiffSpace())},_calcRadius:function(t){t-=1,this._circleRadius.x=Math.max(this.defaultCircleRadius.x+this.additionalCircleRadius.x*t,2),this._circleRadius.y=Math.max(this.defaultCircleRadius.y+this.additionalCircleRadius.y*t,2)},update:function(t){if(0!==this._currentDiffAngle){for(var e=0;e<this._contentNodeArray.length;e++){var i=this._diffAngle*e+270-this._diffAngle*this._currentIndex;for(i+=this._currentDiffAngle;i<0;)i+=360;i%=360,this._setContentNodeProperties(e,this._contentNodeArray[e],i,!1)}var a=.07*this._diffAngle;this._currentDiffAngle>0?(this._currentDiffAngle-=a,this._currentDiffAngle<0&&(this._currentDiffAngle=0)):this._currentDiffAngle<0&&(this._currentDiffAngle+=a,this._currentDiffAngle>0&&(this._currentDiffAngle=0))}},redraw:function(){this._drawContentByIndex(!1)},getSelectedNo:function(){return this._currentIndex},setSelectedNo:function(t){this._currentIndex=t},setCallbackToSwitchContent:function(t){this._callbackToSwitchContent=t},moveToLeft:function(){for(this._currentIndex--;this._currentIndex<0;)this._currentIndex+=this.content.childrenCount;this._currentIndex=this._currentIndex%this.content.childrenCount,this._currentDiffAngle-=this._diffAngle,this._drawContentByIndex(!0)},moveToRight:function(){this._currentIndex++,this._currentIndex=this._currentIndex%this.content.childrenCount,this._currentDiffAngle+=this._diffAngle,this._drawContentByIndex(!0)},_adjustDiffSpace:function(){this._contentNodeArray.length>0?this._diffAngle=360/this._contentNodeArray.length:this._diffAngle=360},_adjustContent:function(){var t=this._contentNodeArray[0];this._currentIndex=0;for(var e=0;e<this._contentNodeArray.length;e++){Math.abs(t.rollPosition-270)>Math.abs(this._contentNodeArray[e].rollPosition-270)&&(t=this._contentNodeArray[e],this._currentIndex=e)}},_switchContentEvent:function(){this._recentCenterContent!==this._currentCenterContent&&this._callbackToSwitchContent&&this._callbackToSwitchContent(this._currentCenterContent,this._currentIndex)},_drawContentByIndex:function(t){for(var e=0;e<this._contentNodeArray.length;e++){for(var i=this._diffAngle*e+270-this._diffAngle*this._currentIndex;i<0;)i+=360;i%=360,this._setContentNodeProperties(e,this._contentNodeArray[e],i,t)}this._recentCenterContent=null,this._currentCenterContent=this._contentNodeArray[this._currentIndex],this._switchContentEvent()},_drawContentByPosition:function(t){if(!(this.content.childrenCount<=1)){this._recentCenterContent=this._currentCenterContent;var e=t.x;e/=this._contentNodeArray.length;for(var i=0;i<this._contentNodeArray.length;i++){var a=this._contentNodeArray[i],n=a.rollPosition;for(n+=e;n<0;)n+=360;n%=360,(!this._currentCenterContent||a.scale>this._currentCenterContent.scale)&&(this._currentCenterContent=a,this._currentIndex=i),this._setContentNodeProperties(i,a,n,!1)}this._switchContentEvent()}},_setContentNodeProperties:function(t,e,i,a){e.rollPosition=i;var n=this._circleRadius.x*Math.cos(i*(Math.PI/180)),r=this._circleRadius.y*Math.sin(i*(Math.PI/180)),s=this._getDiffIdx(t),c=this._createNodeProperties(n,r,s);if(e.zIndex=c.zIndex,o.setChildrenColor(e,c.color),a){if(0!==this._currentDiffAngle)return;s>this.subsequentDisplayCount&&(c.opacity=0),e.stopAllActions(),e.runAction(cc.moveTo(.2,cc.v2(n,r))),e.runAction(cc.fadeTo(.2,c.opacity)),e.runAction(cc.scaleTo(.2,c.scale))}else e.setPosition(cc.v2(n,r)),e.opacity=c.opacity,e.scale=c.scale},_createNodeProperties:function(t,e,i){var a=this._getDiffCenterRate(t,e),o=255*a,r=Math.max(255*a,this.subsequentColor.getR()),s=Math.max(255*a,this.subsequentColor.getG()),c=Math.max(255*a,this.subsequentColor.getB()),l=cc.color(r,s,c),u=n.ACTIVATE_OPACITY;u=a<.5?Math.max(255*a,0):Math.max(255*a,this.subsequentColor.getA());var h=a*this.centerScale;return{zIndex:o,scale:h=Math.max(h,this.subsequentScale),color:l,opacity:u}},_getDiffIdx:function(t){var e=.5*this._contentNodeArray.length,i=Math.abs(this._currentIndex-t);return i>e?this._contentNodeArray.length-i:i},_getDiffCenterRate:function(t,e){var i=this._convertIdxToPosition(1);if(e<i.y)return 1-(e+this._circleRadius.y)/(i.y+this._circleRadius.y)*.5;var a=this._convertIdxToPosition(this.subsequentDisplayCount);if(e<a.y||2*this.subsequentDisplayCount>=this.content.childrenCount)return.5;var n=this._convertIdxToPosition(this.subsequentDisplayCount+1);return e<n.y?.5*(1-(e-a.y)/(n.y-a.y)):0},_convertIdxToPosition:function(t){var e=this._diffAngle*t+270,i=this._circleRadius.x*Math.cos(e*(Math.PI/180)),a=this._circleRadius.y*Math.sin(e*(Math.PI/180));return cc.v2(i,a)},_touchStartEvent:function(t){this.content.stopAllActions()},_touchMoveEvent:function(t){this._drawContentByPosition(t.getDelta())},_touchEndEvent:function(t){this._adjustContent(),this._drawContentByIndex(!0)}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",LoopRollView:"LoopRollView"}],CommandAnimation:[function(t,e,i){"use strict";cc._RF.push(e,"09532bt5BJM74uN0ltE997y","CommandAnimation");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1],a=this._arguments[2].split("_"),o=this._arguments[3],r=parseInt(this._arguments[4]);t.setAnimationForContent(e,a,o,r,i,this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandBgOff:[function(t,e,i){"use strict";cc._RF.push(e,"b62f0DWeoxM4KEUnneu2z1c","CommandBgOff");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.removeBgImage(this._arguments[0],this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandBg:[function(t,e,i){"use strict";cc._RF.push(e,"35963ojyCBAQ7Uyn9UafQNw","CommandBg");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setBgImage(this._arguments[0],parseFloat(this._arguments[1]),isNaN(parseInt(this._arguments[2]))?255:parseInt(this._arguments[2]),this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END},getCommandName:function(){return n.ADV_COMMAND_NAME.DISP_BG}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandCharacterOff:[function(t,e,i){"use strict";cc._RF.push(e,"47cf06JOThO6LVBABzF5oPn","CommandCharacterOff");var a=t("Command");cc.Class({extends:a});cc._RF.pop()},{Command:"Command"}],CommandCharacter:[function(t,e,i){"use strict";cc._RF.push(e,"bc195LuHT9GybXZ00yco4Ba","CommandCharacter");var a=t("Command");cc.Class({extends:a});cc._RF.pop()},{Command:"Command"}],CommandClickWait:[function(t,e,i){"use strict";cc._RF.push(e,"01ffdUAhKVL8qzngtgyxj8S","CommandClickWait");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,_autoWaitTime:0,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,this._autoWaitTime=-1},getCommandName:function(){return n.ADV_COMMAND_NAME.CLICK_WAIT},update:function(t,e,i){if(i)switch(t.getPlayState()){case n.ADV_PLAY_STATE.AUTO:this._skipAutoFunction(t,e,n.ADV_AUTO_SPEED);break;case n.ADV_PLAY_STATE.SKIP:var a=n.ADV_AUTO_SPEED*t.getSkipRate();this._skipAutoFunction(t,e,a);break;default:t.setActiveWaitCursor(!0)}},_skipAutoFunction:function(t,e,i){this._autoWaitTime<0&&(this._autoWaitTime=0,t.setActiveWaitCursor(!0)),t.getPlayingVoiceState()!==cc.audioEngine.AudioState.PLAYING&&(this._autoWaitTime+=e,this._autoWaitTime>=i&&(this._state=n.ADV_COMMAND_STATE.END,t.readNextLine()))},tapEvent:function(t){t.messageTouchNode||(this._state=n.ADV_COMMAND_STATE.END,t.readNextLine(),t.doCallbackForClick())},getIsCntStop:function(){return!0}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandElseIf:[function(require,module,exports){"use strict";cc._RF.push(module,"8eca0uhhlROTIlZTiwf/NUp","CommandElseIf");var Command=require("Command"),AdvConstants=require("AdvConstants"),CommandElseIf=cc.Class({extends:Command,initialize:function initialize(advSubRoot){switch(this._state=AdvConstants.ADV_COMMAND_STATE.END,advSubRoot.readNextLine(),advSubRoot.getProcessState()){case AdvConstants.ADV_PROCESS_STATE.NONE:case AdvConstants.ADV_PROCESS_STATE.TRUE:return advSubRoot.setProcessState(AdvConstants.ADV_PROCESS_STATE.FALSE),void advSubRoot.setFalseNestCount(advSubRoot.getFalseNestCount()+1);case AdvConstants.ADV_PROCESS_STATE.FALSE:break;case AdvConstants.ADV_PROCESS_STATE.FALSE_NEST:return}var conditionText=advSubRoot.convertConditionText(this._arguments[0]);eval(conditionText)?advSubRoot.setProcessState(AdvConstants.ADV_PROCESS_STATE.TRUE):advSubRoot.setProcessState(AdvConstants.ADV_PROCESS_STATE.FALSE)},getCommandName:function(){return AdvConstants.ADV_COMMAND_NAME.ELSE_IF},getIsCntStop:function(){return!0}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandEndIf:[function(t,e,i){"use strict";cc._RF.push(e,"9bedaBvAX5EvJjKsy62S360","CommandEndIf");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.END,t.setFalseNestCount(t.getFalseNestCount()-1),t.getFalseNestCount()<=0&&t.setProcessState(n.ADV_PROCESS_STATE.TRUE),t.readNextLine()},getCommandName:function(){return n.ADV_COMMAND_NAME.END_IF},getIsCntStop:function(){return!0}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandEndWait:[function(t,e,i){"use strict";cc._RF.push(e,"b02ccF031JMUJud29wsjs5K","CommandEndWait");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE},update:function(t,e,i){i&&(this._state=n.ADV_COMMAND_STATE.END,t.readNextLine())},getCommandName:function(){return n.ADV_COMMAND_NAME.END_WAIT},getIsCntStop:function(){return!0}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandFadeInBlack:[function(t,e,i){"use strict";cc._RF.push(e,"ff9a9IuN1xK4Lclt3OZIU8w","CommandFadeInBlack");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setFade(cc.Color.BLACK,-1,255,this._arguments[0],this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandFadeInWhite:[function(t,e,i){"use strict";cc._RF.push(e,"612b4pKyQdMwKSho6wG8Ll4","CommandFadeInWhite");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setFade(cc.Color.WHITE,0,255,this._arguments[0],this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandFadeOutBlack:[function(t,e,i){"use strict";cc._RF.push(e,"af8fcmsy0VIeorFy4OEMdMJ","CommandFadeOutBlack");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setFade(cc.Color.BLACK,-1,0,this._arguments[0],this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandFadeOutWhite:[function(t,e,i){"use strict";cc._RF.push(e,"5d1f4JlhBJJVbxJl98KlUZL","CommandFadeOutWhite");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setFade(cc.Color.WHITE,-1,0,this._arguments[0],this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandFlash:[function(t,e,i){"use strict";cc._RF.push(e,"29dcfEi/jVDxIPIK3Cs2br+","CommandFlash");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=cc.color(parseFloat(this._arguments[0]),parseFloat(this._arguments[1]),parseFloat(this._arguments[2])),i=this._arguments[3],a=this._arguments[4],o=this._arguments[5];t.setFlash(e,i,a,o,this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandIf:[function(require,module,exports){"use strict";cc._RF.push(module,"d585d4aFEJF8qd/16a0wzRL","CommandIf");var Command=require("Command"),AdvConstants=require("AdvConstants"),CommandIf=cc.Class({extends:Command,initialize:function initialize(advSubRoot){switch(this._state=AdvConstants.ADV_COMMAND_STATE.END,advSubRoot.getProcessState()){case AdvConstants.ADV_PROCESS_STATE.NONE:case AdvConstants.ADV_PROCESS_STATE.TRUE:break;case AdvConstants.ADV_PROCESS_STATE.FALSE:return advSubRoot.setFalseNestCount(advSubRoot.getFalseNestCount()+1),void advSubRoot.setProcessState(AdvConstants.ADV_PROCESS_STATE.FALSE_NEST);case AdvConstants.ADV_PROCESS_STATE.FALSE_NEST:return void advSubRoot.setFalseNestCount(advSubRoot.getFalseNestCount()+1)}var conditionText=advSubRoot.convertConditionText(this._arguments[0]);eval(conditionText)?advSubRoot.setProcessState(AdvConstants.ADV_PROCESS_STATE.TRUE):advSubRoot.setProcessState(AdvConstants.ADV_PROCESS_STATE.FALSE)},getCommandName:function(){return AdvConstants.ADV_COMMAND_NAME.IF}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandImageConfig:[function(t,e,i){"use strict";cc._RF.push(e,"9becaN6RHNGYIEodazt0bxY","CommandImageConfig");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=""!==this._arguments[1].trim()?this._arguments[1].trim():null,a=cc.v2(parseFloat(this._arguments[2]),parseFloat(this._arguments[3])),o=""!==this._arguments[4].trim()?parseFloat(this._arguments[4].trim()):null,r=""!==this._arguments[5].trim()?parseFloat(this._arguments[5].trim()):null,s=parseInt(this._arguments[6]),c=parseFloat(this._arguments[7]),l=parseFloat(this._arguments[8]),u=parseFloat(this._arguments[9]);t.setImageConfig(e,i,a,o,r,s,c,l,u,this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandMask:[function(t,e,i){"use strict";cc._RF.push(e,"d81bera31BN8rh+AiTq8rig","CommandMask");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=cc.v2(parseFloat(this._arguments[1]),parseFloat(this._arguments[2])),a=cc.size(parseFloat(this._arguments[3]),parseFloat(this._arguments[4])),o=parseFloat(this._arguments[5]);t.addMask(e,i,a,o,this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandMessage:[function(t,e,i){"use strict";cc._RF.push(e,"d7fd9aRkr1Chp9C5s0E1v0M","CommandMessage");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,_dispLength:0,_dispInterval:0,initialize:function(t){var e=this._arguments[0],i=this._arguments[1];switch(this._debugSearchMessage(t,i),t.getPlayState()){case n.ADV_PLAY_STATE.SKIP:return t.setMessage(e,i,n.ADV_TEXT_LENGTH_MAX),void(this._state=n.ADV_COMMAND_STATE.END)}if(this._state=n.ADV_COMMAND_STATE.UPDATE,this._dispInterval=0,this._dispLength=0,t.setMessage(e,i,this._dispLength),!t.messageTouchNode&&i.length>0){var a=new cc.Node("TouchNode");a.setContentSize(cc.winSize),a.on(cc.Node.EventType.TOUCH_END,this._touchEvent.bind(this,t),this),a._touchListener.setSwallowTouches(!1),cc.director.getScene().getChildByName("Canvas").addChild(a,t.node.zIndex),t.messageTouchNode=a}},update:function(t,e){switch(t.getPlayState()){case n.ADV_PLAY_STATE.SKIP:return t.setMessageDispLength(t.getMessageView().messageText.getMaxLength()),this._state=n.ADV_COMMAND_STATE.END,void this._removeTouchNode(t)}this._dispInterval+=e,this._dispInterval>=n.ADV_MESSAGE_SPEED&&(this._dispLength+=Math.floor(this._dispInterval/n.ADV_MESSAGE_SPEED),this._dispInterval=0,t.setMessageDispLength(this._dispLength),this._dispLength>=t.getMessageView().messageText.getMaxLength()&&(this._state=n.ADV_COMMAND_STATE.END,this._removeTouchNode(t)))},getCommandName:function(){return n.ADV_COMMAND_NAME.MESSAGE},_touchEvent:function(t,e){this._dispInterval=n.ADV_MESSAGE_SPEED,this._dispLength=n.ADV_TEXT_LENGTH_MAX,this._removeTouchNode(e)},_debugSearchMessage:function(t,e){var i=t.getDebugSearchMessage();i.length>0&&-1!==e.indexOf(i)&&t.setPlayState(n.ADV_PLAY_STATE.PLAY)},_removeTouchNode:function(t){t.messageTouchNode&&(t.messageTouchNode.destroy(),t.messageTouchNode=null)}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandName:[function(t,e,i){"use strict";cc._RF.push(e,"d2b75BTkKVBe6+1psf9g0Be","CommandName");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.END,void 0!==this._arguments[0]&&null!==this._arguments[0]?t.setName(this._arguments[0],n.ADV_TEXT_LENGTH_MAX):this._drawError("name\u30b3\u30de\u30f3\u30c9\u306e\u5f15\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093")}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandPlayBgm:[function(t,e,i){"use strict";cc._RF.push(e,"db6d2FldllCxLEgEaV4/mG9","CommandPlayBgm");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.playBgm(this._arguments[0],parseFloat(this._arguments[1]),this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandPlayMovieOff:[function(t,e,i){"use strict";cc._RF.push(e,"1a09c1ToT5PvLbIcN0w9aJd","CommandPlayMovieOff");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1]?parseFloat(this._arguments[1]):0;t.removeMovie(e,i,this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandPlayMovie:[function(t,e,i){"use strict";cc._RF.push(e,"7f5acUbtHVKtao0ttpOHS3j","CommandPlayMovie");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,_autoWaitTime:0,_index:0,_fileNames:void 0,_tags:void 0,_isEndLoop:!1,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,this._autoWaitTime=-1,this._index=-1,this._fileNames=this._arguments[0].split(":"),this._tags=this._arguments[1].split(":"),this._isEndLoop="1"===this._arguments[2],this._playMovieSequence(t),t.setMovieSequence(this._callbackForClick.bind(this))},_playMovieSequence:function(t){var e=this._index;this._setIndex(this._index+1),this._playMoveRecursive(t,e,this._index)},_removeRecentMovie:function(t,e,i){0<=e&&e<=this._tags.length-1&&e!==i&&t.removeMovie(this._tags[e],1)},_playMoveRecursive:function(t,e,i){switch(this._state){case n.ADV_COMMAND_STATE.INIT:case n.ADV_COMMAND_STATE.END:return}var a,o;(this._removeRecentMovie(t,e,i),0>i||i>this._fileNames.length-1)||(this.videoPlayer&&this.videoPlayer.node&&this.videoPlayer.node.parent?(a=this.videoPlayer.node.parent.getPosition(),o=this.videoPlayer.node.parent.getScale()):(a=cc.v2(0,0),o=1),i<this._fileNames.length-1?this.videoPlayer=t.playMovie(this._fileNames[i],this._tags[i],0,this._playMovieSequence.bind(this,t)):this.videoPlayer=t.playMovie(this._fileNames[i],this._tags[i],this._isEndLoop,this._endEvent.bind(this)),this.videoPlayer.node.parent.setPosition(a),this.videoPlayer.node.parent.setScale(o))},_setIndex:function(t){this._index=Math.max(0,Math.min(t,this._fileNames.length-1))},update:function(t,e,i){switch(t.getPlayState()){case n.ADV_PLAY_STATE.SKIP:if(cc.sys.isNative)this.videoPlayer.currentTime+=e/t.getSkipRate();else{if(!document.getElementsByClassName("cocosVideo")[0])return;if(1===document.getElementsByClassName("cocosVideo")[0].playbackRate){var a=1/t.getSkipRate();a>4&&(a=4),document.getElementsByClassName("cocosVideo")[0].playbackRate=a}}var o=this.videoPlayer.getDuration()/4;this._skipAutoFunction(t,e,o);break;default:cc.sys.isNative||document.getElementsByClassName("cocosVideo")[0]&&(document.getElementsByClassName("cocosVideo")[0].playbackRate=1)}},_skipAutoFunction:function(t,e,i){this._autoWaitTime+=e,this._autoWaitTime>=i&&(this._state=n.ADV_COMMAND_STATE.END)},getCommandName:function(){return n.ADV_COMMAND_NAME.PLAY_MOVIE},_callbackForClick:function(t){this._index>=this._fileNames.length-1?this._state=n.ADV_COMMAND_STATE.END:(this._playMoveRecursive(t,this._index,this._fileNames.length-1),this._state=n.ADV_COMMAND_STATE.END)},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END},tapEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandPlaySe:[function(t,e,i){"use strict";cc._RF.push(e,"3390c+JmXlJAKa9HKKXoaFS","CommandPlaySe");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.END,t.playSe(this._arguments[0])}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandPlayVoice:[function(t,e,i){"use strict";cc._RF.push(e,"b0542prGKNLv64SiHn89IDs","CommandPlayVoice");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.playVoice(this._arguments[0],this._arguments[1])},update:function(t,e){switch(t.getPlayState()){case n.ADV_PLAY_STATE.SKIP:return void(this._state=n.ADV_COMMAND_STATE.END)}t.getPlayingVoiceState()!==cc.audioEngine.AudioState.PLAYING&&(this._state=n.ADV_COMMAND_STATE.END)}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandRoomBg:[function(t,e,i){"use strict";cc._RF.push(e,"aff37lRqutKOpzarvrOn2SK","CommandRoomBg");var a=t("Command"),n=t("AdvConstants"),o=t("AdvCustomConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=parseInt(this._arguments[0]),i=parseFloat(this._arguments[1]);t.setRoomBgImage(e,i,this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END},getCommandName:function(){return o.ADV_COMMAND_NAME.DISP_ROOM_BG}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvCustomConstants:"AdvCustomConstants",Command:"Command"}],CommandSelect:[function(t,e,i){"use strict";cc._RF.push(e,"7414dmKD3BK/rvqSx7DoPuH","CommandSelect");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.END,t.setKeyValue(n.SELECT_KEY,"=",0),t.setSelectThumbnails(this._arguments)},getCommandName:function(){return n.ADV_COMMAND_NAME.SELECT},getIsCntStop:function(){return!0}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandShake:[function(t,e,i){"use strict";cc._RF.push(e,"a1e4c4B/SBLyIVq0834PmIY","CommandShake");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setShake(parseFloat(this._arguments[0]),parseInt(this._arguments[1]),parseFloat(this._arguments[2]),parseFloat(this._arguments[3]),this._arguments[4],this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandSlideInBlack:[function(t,e,i){"use strict";cc._RF.push(e,"66e49C91LJP8LGl9OTlYe+Y","CommandSlideInBlack");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1];t.setGradationSlideIn(e,i,cc.Color.BLACK,this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandSlideOutBlack:[function(t,e,i){"use strict";cc._RF.push(e,"90bebhSVVNIlLFIrqwaXiEy","CommandSlideOutBlack");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1];t.setGradationSlideOut(e,i,this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandSpineOff:[function(t,e,i){"use strict";cc._RF.push(e,"e454eof919AV5vJRunqoQtK","CommandSpineOff");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1];"all"===e?t.removeContentAll(i,this._endEvent.bind(this)):t.removeContent(e,i,this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandSpine:[function(t,e,i){"use strict";cc._RF.push(e,"939efPD3wtExqZfPoWnsNUa","CommandSpine");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1],a=this._arguments[2].split(":"),o=this._arguments[3].split(":"),r=!!parseInt(this._arguments[4]),s=cc.v2(this._arguments[5],this._arguments[6]),c=parseFloat(this._arguments[7]),l=parseFloat(this._arguments[8]),u=parseFloat(this._arguments[9]);t.addSpine(e,i,s,c,l,u,this._endEvent.bind(this)),t.setSpineSequence(i,a,o,r,0,this._callbackForClick.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END},_callbackForClick:function(t){this._state=n.ADV_COMMAND_STATE.END;var e=this._arguments[1],i=this._arguments[2].split(":").pop(),a=this._arguments[3].split(":").pop(),o=!!parseInt(this._arguments[4]);t.setSpineSequence(e,[i],[a],o,.5)}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandSpriteAtlas:[function(t,e,i){"use strict";cc._RF.push(e,"cc450HiA85GXLEpiFr6/0ud","CommandSpriteAtlas");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1].split(":"),a=this._arguments[2],o=cc.v2(parseFloat(this._arguments[3]),parseFloat(this._arguments[4])),r=parseFloat(this._arguments[5]),s=parseFloat(this._arguments[6]);t.addImageSpriteAtlas(e,i,a,o,r,s,this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandSpriteOff:[function(t,e,i){"use strict";cc._RF.push(e,"ccb2evpi6hJ/rmb0XN77amn","CommandSpriteOff");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1];"all"===e?t.removeContentAll(i,this._endEvent.bind(this)):t.removeContent(e,i,this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandSprite:[function(t,e,i){"use strict";cc._RF.push(e,"c746515MTxD6ri+v8RT2y1M","CommandSprite");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE;var e=this._arguments[0],i=this._arguments[1],a=cc.v2(parseFloat(this._arguments[2]),parseFloat(this._arguments[3])),o=parseFloat(this._arguments[4]),r=parseFloat(this._arguments[5]);t.addImageSprite(e,i,a,o,r,this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandStopBgm:[function(t,e,i){"use strict";cc._RF.push(e,"a29c72zWgVOBpoQPvdFp6Ll","CommandStopBgm");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,this._arguments.length>0?t.stopBgm(this._arguments[0].length>0?parseFloat(this._arguments[0]):0,this._endEvent.bind(this)):t.stopBgm(0,this._endEvent.bind(this))},_endEvent:function(){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandStopSe:[function(t,e,i){"use strict";cc._RF.push(e,"98a6fYR9HFB4rNCnoHIQH4z","CommandStopSe");var a=t("Command");cc.Class({extends:a});cc._RF.pop()},{Command:"Command"}],CommandStopVoice:[function(t,e,i){"use strict";cc._RF.push(e,"5d8bePDaUdH7p74yLYPYMVl","CommandStopVoice");var a=t("Command");cc.Class({extends:a});cc._RF.pop()},{Command:"Command"}],CommandTutorial:[function(t,e,i){"use strict";cc._RF.push(e,"eb029/yxp5IVZ6SW4Mcw/Do","CommandTutorial");var a=t("Command"),n=t("AdvConstants"),o=t("AdvCustomConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.playTutorialEvent(parseInt(this._arguments[0]),this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END,t.readNextLine(),t.doCallbackForClick()},getCommandName:function(){return o.ADV_COMMAND_NAME.DISP_TUTORIAL},getIsCntStop:function(){return!0}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvCustomConstants:"AdvCustomConstants",Command:"Command"}],CommandVal:[function(t,e,i){"use strict";cc._RF.push(e,"059d1j1zgFPu5iu+eW4UEl8","CommandVal");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.END;var e=this._arguments[0].split("_");t.setKeyValue(e[0],e[1],e[2])}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandWait:[function(t,e,i){"use strict";cc._RF.push(e,"d0381tyQtxHJbz14WHgPwZD","CommandWait");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setWait(this._arguments[0],this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END,t.readNextLine()},getCommandName:function(){return n.ADV_COMMAND_NAME.WAIT},getIsCntStop:function(){return!0}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],CommandWindowUI:[function(t,e,i){"use strict";cc._RF.push(e,"c73b9sPxg1DsIl6xGZCV82Q","CommandWindowUI");var a=t("Command"),n=t("AdvConstants");cc.Class({extends:a,initialize:function(t){this._state=n.ADV_COMMAND_STATE.UPDATE,t.setVisibleMessageUI("on"===this._arguments[0],this._endEvent.bind(this))},_endEvent:function(t){this._state=n.ADV_COMMAND_STATE.END}});cc._RF.pop()},{AdvConstants:"AdvConstants",Command:"Command"}],Command:[function(t,e,i){"use strict";cc._RF.push(e,"81df5QxECRKH7a5w1gUb+lm","Command");var a=t("AdvConstants");cc.Class({_arguments:void 0,_state:void 0,ctor:function(){this._arguments=arguments,this._state=a.ADV_COMMAND_STATE.INIT},initialize:function(){this._state=a.ADV_COMMAND_STATE.UPDATE},update:function(){},tapEvent:function(t){},getState:function(){return this._state},getCommandName:function(){return""},getIsCntStop:function(){return!1},_createErrorDisplayNode:function(t){var e=new cc.Node("ErrorDisplay").addComponent(cc.Label);e.fontSize=50,e.lineHeight=65,e.node.color=cc.color(255,80,80),e.string=t;var i=e.node.addComponent(cc.LabelOutline);return i.width=5,i.color=cc.color(255,255,255),e.node},_drawError:function(t){cc.error(t,"\n\u5f15\u6570 = ",this._arguments),cc.director.getScene().getChildByName("Canvas").addChild(this._createErrorDisplayNode(t)),cc.director.pause()}}),cc._RF.pop()},{AdvConstants:"AdvConstants"}],CommonButton:[function(t,e,i){"use strict";cc._RF.push(e,"4fc28QnlYFCI4ZhLQ/7Fd1N","CommonButton");var a=t("Singleton"),n=t("SceneConst"),o=t("CommonUtils"),r=t("DevelopmentUtils"),s=t("TutorialUtils"),c=t("ResourceUtils"),l=t("StaticResourceConst"),u=t("LocalDataConst"),h=cc.Enum({TAP:0,OVER:1,LEAVE:2}),d=cc.Enum({BOOT:n.SCENE.FILE_NAME.BOOT,MAINTENANCE:n.SCENE.FILE_NAME.MAINTENANCE,TEST:n.SCENE.FILE_NAME.TEST,DEBUG:n.SCENE.FILE_NAME.DEBUG,DUMMY_LOGIN:n.SCENE.FILE_NAME.DUMMY_LOGIN,SET_TEST_BATTLE:n.SCENE.FILE_NAME.SET_TEST_BATTLE,RESTORE_BATTLE:n.SCENE.FILE_NAME.RESTORE_BATTLE,BATTLE:n.SCENE.FILE_NAME.BATTLE,ARENA:n.SCENE.FILE_NAME.ARENA,RAID_BATTLE:n.SCENE.FILE_NAME.RAID_BATTLE,TITLE:n.SCENE.FILE_NAME.TITLE,FIRST_LOGIN:n.SCENE.FILE_NAME.FIRST_LOGIN,ADV:"AdvScene"}),p=cc.Enum({NORMAL:0,ADV:1}),m=cc.Class({extends:cc.Button,statics:{SE_NAME:{SELECT:l.SE.SELECT,CANCEL:l.SE.CANCEL,EXECUTE:l.SE.EXECUTE,RECEIVE:l.SE.RECEIVE,COUNT:l.SE.COUNT,EQUIP:l.SE.EQUIP,FORTIFY:l.SE.FORTIFY}},properties:{bPropagationStopped:!0,isBeforeAnim:!1,enabledType:p.NORMAL,activeImageNode:cc.Node,inactiveImageNode:cc.Node,tapAnimation:cc.Animation},_overEventFunc:null,_leaveEventFunc:null,_tapEventFunc:null,_touchStartEventFunc:null,_touchMoveEventFunc:null,_touchMoveEndEventFunc:null,_longTapEventFunc:null,_longTapEndEventFunc:null,_touchCancelEventFunc:null,_seFileNameTapEnd:null,_isTouching:!1,_isLongTapEnable:!1,_isMoved:!1,_moveStartDistance:!1,onLoad:function(){this._initCommonButton()},_initCommonButton:function(){this._moveStartDistance=this._moveStartDistance?this._moveStartDistance:10},switchBtnImage:function(t){this.activeImageNode&&(this.activeImageNode.active=t),this.inactiveImageNode&&(this.inactiveImageNode.active=!t)},getBtnImageSwitchState:function(){return this.activeImageNode?this.activeImageNode.active:this.inactiveImageNode?!this.inactiveImageNode.active:this.node.active},showDevelopmentText:function(t,e,i){if(r.checkDevelopmentScene(t)){var a=r.getDevelopmentLabel(),n=-this.node.width/2+e,o=this.node.height/2+i;a.node.setPosition(n,o),this.node.addChild(a.node)}},setOverEvent:function(t,e){this._overEventFunc=t,this._leaveEventFunc=e,this._setOverEventListener()},setTapEvent:function(t,e){switch(this._tapEventFunc=t,this._setTapEventSE(e),this.tapAnimation&&!this.isBeforeAnim&&this.tapAnimation.on("finished",function(t,e){e.name===this.tapAnimation.getClips()[h.TAP].name&&this._executeTapEventFunc()},this),this.enabledType){case p.ADV:break;default:if(!a.localData[u.IS_OPEN_SYSTEM_POPUP]&&s.isTutorialScene())return}this._setTouchEventListener()},_setTapEventSE:function(t){void 0===t||null===t?this._seFileNameTapEnd||(this._seFileNameTapEnd=m.SE_NAME.SELECT):this._seFileNameTapEnd=t},getTapEvent:function(){return this._tapEventFunc},setTouchStartEvent:function(t){this._touchStartEventFunc=t,s.isTutorialScene()||this._setTouchStartEventListener()},setTouchMoveEvent:function(t,e){this._touchMoveEventFunc=t,this._moveStartDistance=e||10,s.isTutorialScene()||this._setTouchMoveEventListener()},setTouchMoveEndEvent:function(t){this._touchMoveEndEventFunc=t,s.isTutorialScene()||this._setTouchMoveEndEventListener()},setLongTapEvent:function(t){this._longTapEventFunc=t,s.isTutorialScene()||this._setLongTapEventListener()},setLongTapEndEvent:function(t){this._longTapEndEventFunc=t,s.isTutorialScene()||this._setLongTapEventListener()},setTouchCancelEvent:function(t){this._touchCancelEventFunc=t,s.isTutorialScene()||this._setTouchCancelEventListener()},setTouchEnable:function(t){t?this._setAllListener():(this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseOver,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this),this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoveNow,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this))},_setAllListener:function(){this._tapEventFunc&&this._setTouchEventListener(),this._longTapEventFunc&&this._setLongTapEventListener(),this._longTapEndEventFunc&&this._setLongTapEndEventListener(),this._touchStartEventFunc&&this._setTouchStartEventListener(),this._touchMoveEventFunc&&this._setTouchMoveEventListener(),this._touchMoveEndEventFunc&&this._setTouchMoveEndEventListener(),this._touchCancelEventFunc&&this._setTouchCancelEventListener(),this._overEventFunc&&this._leaveEventFunc&&this._setOverEventListener()},_setOverEventListener:function(){this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseOver,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this)},_setTouchEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this)},_setTouchStartEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this)},_setLongTapEventListener:function(){this._isLongTapEnable=!0,this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this)},_setLongTapEndEventListener:function(){this._isLongTapEnable=!0,this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseLeave,this)},_setTouchMoveEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoveNow,this)},_setTouchMoveEndEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoveNow,this)},_setTouchCancelEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},_onMouseOver:function(t){this.tapAnimation&&this.tapAnimation.getClips()[h.OVER]&&(this.tapAnimation.playAdditive(this.tapAnimation.getClips()[h.OVER].name).wrapMode=cc.WrapMode.Normal),this._overEventFunc&&this._overEventFunc(t)},_onMouseLeave:function(t){this._isTouchAnimation()&&this._isPlayingTouchAnimation()||(this.tapAnimation&&(this.tapAnimation.getClips()[h.LEAVE]?this.tapAnimation.playAdditive(this.tapAnimation.getClips()[h.LEAVE].name):this.tapAnimation.getClips()[h.OVER]&&(this.tapAnimation.playAdditive(this.tapAnimation.getClips()[h.OVER].name).wrapMode=cc.WrapMode.Reverse)),this._endTouchProcess(),this._leaveEventFunc&&this._leaveEventFunc(t))},_onTouchStart:function(t){var e=cc.sequence(cc.delayTime(1),cc.callFunc(function(){this._isTouching&&this._onLongTap(t)},this));e.setTag(99),this.node.runAction(e),this._isTouching=!0,this._isMoved=!1,this._touchStartEventFunc&&this._touchStartEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onTouchMoveNow:function(t){this._touchMoveEventFunc&&this._isMoveStarted(t)&&this._touchMoveEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onTouchMoveEnd:function(t){this._touchMoveEndEventFunc&&this._touchMoveEndEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_setDuringInterval:function(){a.localData[u.IS_BUTTON_DURING_INTERVAL]=!0,setTimeout(function(){a.localData[u.IS_BUTTON_DURING_INTERVAL]=!1},300)},_onTouchEnd:function(t){!this._isLongTapEnable||this._isTouching?this._isExecutableTouchEvent()&&(this._setDuringInterval(),this._endTouchProcess(),this._isMoved?this._onTouchMoveEnd(t):(this._isTouchAnimation()?this._isPlayingTouchAnimation()||this.tapAnimation.playAdditive(this.tapAnimation.getClips()[h.TAP].name):this._tapEventFunc&&(this._executeTapEventFunc(t),this.tapAnimation&&this.tapAnimation.playAdditive(this.tapAnimation.getClips()[h.TAP].name)),this.bPropagationStopped&&t.stopPropagation())):this._onLongTapEnd(t)},_executeTapEventFunc:function(t){this._tapEventFunc(t),a.soundManager&&this._seFileNameTapEnd&&a.soundManager.playSE(c.getResource(this._seFileNameTapEnd))},_isExecutableTouchEvent:function(){if(a.localData[u.IS_OPEN_SYSTEM_POPUP])return!0;if(a.localData[u.IS_BUTTON_DURING_INTERVAL]||a.localData[u.IS_POPUP_OPENING])return!1;var t=o.getRoot();if(t){var e=t.getCurrentSceneName();for(var i in d)if(e===d[i])return!0;return!!t.isShowLoading()||t.isInitializedView()}return!0},_isTouchAnimation:function(){return this.tapAnimation&&!this.isBeforeAnim&&!cc.director.isPaused()},_isPlayingTouchAnimation:function(){return!!this.tapAnimation.getAnimationState(this.tapAnimation.getClips()[h.TAP].name)&&this.tapAnimation.getAnimationState(this.tapAnimation.getClips()[h.TAP].name).isPlaying},_onLongTap:function(t){this._endTouchProcess(),this._longTapEventFunc&&this._longTapEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onLongTapEnd:function(t){this._endTouchProcess(),this._longTapEndEventFunc&&this._longTapEndEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_onTouchCancel:function(t){this._endTouchProcess(),this._touchCancelEventFunc&&this._touchCancelEventFunc(t),this.bPropagationStopped&&t.stopPropagation()},_endTouchProcess:function(){this._isTouching=!1,this.node.stopActionByTag(99)},_isMoveStarted:function(t){return!this._isMoved&&this._isOverForMoveStartDistance(t)&&(this._isMoved=!0),this._isMoved},_isOverForMoveStartDistance:function(t){var e=t.getStartLocation(),i=t.getLocation(),a=Math.abs(e.x-i.x),n=Math.abs(e.y-i.y);return Math.max(a,n)>this._moveStartDistance}});cc._RF.pop()},{CommonUtils:"CommonUtils",DevelopmentUtils:"DevelopmentUtils",LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",TutorialUtils:"TutorialUtils"}],CommonCountView:[function(t,e,i){"use strict";cc._RF.push(e,"7e195ikKTlJz7HnVHPYKnr2","CommonCountView");t("GameConst");var a=t("CommonButton");cc.Class({extends:cc.Component,_closeCallBack:null,properties:{countNumLabel:cc.Label,minusBtn:a,plusBtn:a,additionalCount:5,additionalMinusBtn:a,additionalPlusBtn:a,resetBtn:a,maxBtn:a},_minNum:0,_maxNum:0,_countNum:0,_recentNum:0,_callbackToRedraw:null,onLoad:function(){this.additionalCount=parseInt(this.additionalCount),this._minNum=this._minNum?this._minNum:0,this._maxNum=this._maxNum?this._maxNum:0,this._countNum=this._countNum?this._countNum:0,this._recentNum=this._recentNum?this._recentNum:0,this._setButtonEvents(),this._redrawCommonCountView()},initCommonCountView:function(t,e,i,a){this._callbackToRedraw=t,this._minNum=e,this._maxNum=i,void 0!==a&&null!==a||(a=e),this.setCountNum(a),this._redrawCommonCountView()},setMaxNum:function(t){this._maxNum=t},getCountNum:function(){return this._countNum},setCountNum:function(t){this._countNum=Math.min(Math.max(t,this._minNum),this._maxNum)},redrawSimply:function(){this.countNumLabel.string=""+this.getCountNum()},_setButtonEvents:function(){this.minusBtn.setTapEvent(this._minusBtnEvent.bind(this),a.SE_NAME.COUNT),this.plusBtn.setTapEvent(this._plusBtnEvent.bind(this),a.SE_NAME.COUNT),this.additionalCount>0&&this.additionalMinusBtn&&this.additionalMinusBtn.setTapEvent(this._additionalMinusBtnEvent.bind(this),a.SE_NAME.COUNT),this.additionalCount>0&&this.additionalPlusBtn&&this.additionalPlusBtn.setTapEvent(this._additionalPlusBtnEvent.bind(this),a.SE_NAME.COUNT),this.resetBtn&&this.resetBtn.setTapEvent(this._resetBtnEvent.bind(this),a.SE_NAME.CANCEL),this.maxBtn&&this.maxBtn.setTapEvent(this._maxBtnEvent.bind(this),a.SE_NAME.SELECT)},_redrawCommonCountView:function(){this._recentNum!==this.getCountNum()&&(this._callbackToRedraw&&this._callbackToRedraw(this.getCountNum()),this.redrawSimply(),this._recentNum=this.getCountNum())},_minusBtnEvent:function(){this.setCountNum(this.getCountNum()-1),this._redrawCommonCountView()},_plusBtnEvent:function(){this.setCountNum(this.getCountNum()+1),this._redrawCommonCountView()},_additionalMinusBtnEvent:function(){this.setCountNum(this.getCountNum()-this.additionalCount),this._redrawCommonCountView()},_additionalPlusBtnEvent:function(){this.setCountNum(this.getCountNum()+this.additionalCount),this._redrawCommonCountView()},_resetBtnEvent:function(){this.setCountNum(this._minNum),this._redrawCommonCountView()},_maxBtnEvent:function(){this.setCountNum(this._maxNum),this._redrawCommonCountView()}}),cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst"}],CommonFunction:[function(t,e,i){"use strict";cc._RF.push(e,"25565BkGvZF8KdFu1bwDUdF","CommonFunction"),e.exports={numberWithCommas:function(){return arguments[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},lerp:function(t,e,i){return t+(e-t)*(i=(i=i<0?0:i)>1?1:i)},clamp:function(t,e,i){return t<e?e:t>i?i:t},log:function(){cc.log(arguments)},getRandomArbitrary:function(t,e){return Math.random()*(e-t)+t},getRandomInt:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t},shuffle:function(t){for(var e,i,a=t.length;a;)i=Math.floor(Math.random()*a--),e=t[a],t[a]=t[i],t[i]=e;return t}},cc._RF.pop()},{}],CommonNumber:[function(t,e,i){"use strict";cc._RF.push(e,"a48c8G+CJlK/6asuUxooyX8","CommonNumber"),cc.Class({extends:cc.Component,properties:{figureSpriteAtlas:cc.SpriteAtlas,isCentering:!1,displayInterval:cc.Vec2},_numSpriteList:null,_spaceX:null,_displayNum:null,_currentNum:null,ctor:function(){this.init()},init:function(){this._numSpriteList=[]},setNum:function(t){if(this.figureSpriteAtlas){if(!(t<0)){this._displayNum=t,this._currentNum=t,this._resetNumSpriteList();var e=t,i=[];if(0!==e){for(var a=0;e>0;a++){parseInt(e%10);this._setFigure(a,e,i),e=parseInt(e/10)}if(this.isCentering){var n=i.length/2-.5;for(a=0;a<i.length;a++){var o=cc.v2((n-a)*this.displayInterval.x,(a-n)*this.displayInterval.y);i[a].setPosition(o)}}}else this._setFigure(0,0,i)}}else cc.error("cc.SpriteAtlas is null")},_setFigure:function(t,e,i){var a=parseInt(e%10),n="figure_"+t;if(!this.node.getChildByName(n)){this._numSpriteList[t]=new cc.Node(n).addComponent(cc.Sprite),this.node.addChild(this._numSpriteList[t].node);var o=cc.v2(t*-this.displayInterval.x,t*this.displayInterval.y);this._numSpriteList[t].node.setPosition(o)}if(t<=0||e>0){var r=""+a;this._numSpriteList[t].spriteFrame=this.figureSpriteAtlas.getSpriteFrame(r),this._numSpriteList[t].node.active=!0,i.push(this._numSpriteList[t].node)}else this._numSpriteList[t].node.active=!1},_resetNumSpriteList:function(){for(var t=0;t<this._numSpriteList.length;t++)this._numSpriteList[t].node.active=!1}}),cc._RF.pop()},{}],CommonPageView:[function(t,e,i){"use strict";cc._RF.push(e,"4137aaGQdVEgZl8z/QUFVpB","CommonPageView");var a=t("PageViewBase");cc.Class({extends:a,properties:{pagerParentNode:cc.Node,pagerPrefab:cc.Prefab},_pageButtonView:null,initCommonPageView:function(t,e,i,a,n){this._initPageViewBase(t,e,i,a,n),this._initPageButtonView()},_initPageButtonView:function(){this._pageButtonView&&this._pageButtonView.node.destroy(),this.pagerParentNode&&this.pagerPrefab&&(this._pageButtonView=cc.instantiate(this.pagerPrefab).getComponent("PageButtonView"),this.pagerParentNode.addChild(this._pageButtonView.node),this._setPageButtonEvents())},setPageIndex:function(t){this._currentIndex=this._adjustPageIndex(t),this._setPageNode(this._currentIndex),this._pageButtonView&&this._pageButtonView.setPageButtons(this._currentIndex,this._pageCountMax)},redraw:function(){this.setPageIndex(this._currentIndex),this._initPageButtonView(!1)},_setPageButtonEvents:function(){this._pageButtonView.initPageButtonView(this._currentIndex,this._pageCountMax,this.switchPageContent.bind(this),this._callbackToLeftPageBtn.bind(this),this._callbackToRightPageBtn.bind(this),this._callbackToLeftEndBtn.bind(this),this._callbackToRightEndBtn.bind(this))},_callbackToLeftPageBtn:function(){this._currentIndex<=0||this.switchPageContent(this._currentIndex-1)},_callbackToRightPageBtn:function(){this._currentIndex>=this._pageCountMax-1||this.switchPageContent(this._currentIndex+1)},_callbackToLeftEndBtn:function(){this._currentIndex<=0||this.switchPageContent(0)},_callbackToRightEndBtn:function(){this._currentIndex>=this._pageCountMax-1||this.switchPageContent(this._pageCountMax-1)}}),cc._RF.pop()},{PageViewBase:"PageViewBase"}],CommonPopup:[function(t,e,i){"use strict";cc._RF.push(e,"9ca79T10zFAYri0CRPJXoR4","CommonPopup");var a=t("PopupBase"),n=t("CommonButton");t("StaticResourceConst"),t("ResourceUtils");cc.Class({extends:a,properties:{titleLabel:cc.Label,mainLabel:cc.Label,subLabel:cc.Label,subAttentionNode:cc.Node,yesBtn:n,noBtn:n,okBtn:n},_initChild:function(){this._yesBtnLabelArray=this.yesBtn.node.getComponentsInChildren(cc.Label),this._noBtnLabelArray=this.noBtn.node.getComponentsInChildren(cc.Label),this._okBtnLabelArray=this.okBtn.node.getComponentsInChildren(cc.Label),this.titleLabel.node.active=!1,this.mainLabel.node.active=!1,this.subLabel.node.active=!1,this.subAttentionNode.active=!1,this.yesBtn.node.active=!1,this.noBtn.node.active=!1,this.okBtn.node.active=!1},_initTexts:function(t,e,i,a){this.titleLabel.node.active=!0,this.mainLabel.node.active=!0,this.subLabel.node.active=!0,this.titleLabel.string=t||"",this.mainLabel.string=e||"",this.subLabel.string=i||"",this.subAttentionNode.active=a},_initYesNoButtons:function(t,e,i,a){if(this.yesBtn.node.active=!0,this.noBtn.node.active=!0,this.yesBtn.setTapEvent(function(){t&&t(),this.close()}.bind(this)),this.noBtn.setTapEvent(function(){e&&e(),this.close()}.bind(this),n.SE_NAME.CANCEL),i)for(var o in this._yesBtnLabelArray)this._yesBtnLabelArray[o].string=i;if(a)for(var o in this._noBtnLabelArray)this._noBtnLabelArray[o].string=a},_initOkButton:function(t){if(this.okBtn.node.active=!0,this.okBtn.setTapEvent(function(){this.close()}.bind(this)),t)for(var e in this._okBtnLabelArray)this._okBtnLabelArray[e].string=t},initPlane:function(t,e,i){this.setCloseCallBack(i),this._initChild(),this.mainLabel.node.active=!0,this.mainLabel.string=t,e&&(this.subLabel.node.active=!0,this.subAttentionNode.active=!0,this.subLabel.string=e)},initOk:function(t,e,i,a,n,o){this.setCloseCallBack(n),this._initChild(),this._initTexts(t,e,i,a),this._initOkButton(o)},initOkPlusNode:function(t,e,i){this.mainLabel.verticalAlign=cc.Label.VerticalAlign.TOP,this.node.addChild(e),this.initOk("",t,"",!1,i)},initYesNo:function(t,e,i,a,n,o,r,s){this._initChild(),this._initTexts(t,e,i,a),this._initYesNoButtons(n,o,r,s)},initYesNoPlusNode:function(t,e,i,a,n,o){this.initYesNo("",t,"",!1,i,a,n,o),this.mainLabel.verticalAlign=cc.Label.VerticalAlign.TOP,this.node.addChild(e)},getCloseCallback:function(){return this._closeCallBack}}),cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],CommonScrollLabel:[function(t,e,i){"use strict";cc._RF.push(e,"30316CfIGJGgK32DwbIKtyv","CommonScrollLabel"),cc.Class({extends:cc.Component,properties:{fontFile:cc.Font,labelFontSize:40},_scrollLabel:null,_defaultRightPos:null,_defaultLeftPos:null,onLoad:function(){this.node.getChildByName("Label")||this.init()},onEnable:function(){this.scheduleOnce(this.playScrollAnimation.bind(this),1)},init:function(){this.node.addComponent(cc.Mask),this._scrollLabel=new cc.Node("Label").addComponent(cc.Label),this._scrollLabel.node.setAnchorPoint(cc.v2(0,.5)),this._scrollLabel.horizontalAlign=cc.Label.HorizontalAlign.LEFT,this.fontFile&&(this._scrollLabel.font=this.fontFile),this._scrollLabel.fontFamily="Arial",this._scrollLabel.fontSize=this.labelFontSize,this._scrollLabel.lineHeight=this.labelFontSize,this._scrollLabel.overflow=cc.Label.Overflow.NONE,this._scrollLabel.node.color=this.node.color,this.node.addChild(this._scrollLabel.node)},setString:function(t){this.node.getChildByName("Label")||this.init(),this._scrollLabel.string=t;var e=this.node.getAnchorPoint().x;this._defaultRightPos=this.node.getContentSize().width-this.node.getContentSize().width*e,this._defaultLeftPos=this.node.getContentSize().width*e*-1,this._scrollLabel.node.setPosition(this._defaultLeftPos,0),this.scheduleOnce(this.playScrollAnimation.bind(this),1)},setLabelColor:function(t){this._scrollLabel.node.color=t},playScrollAnimation:function(){this._scrollLabel.node.stopAllActions();var t=this.node.getContentSize().width-this._scrollLabel.node.getContentSize().width;if(!(t>=0)){var e=cc.callFunc(function(){this._scrollLabel.node.setPosition(this._defaultLeftPos,0)}.bind(this)),i=cc.callFunc(function(){this._scrollLabel.node.setPosition(this._defaultRightPos,0)}.bind(this)),a=cc.delayTime(.5),n=cc.moveTo(.3,cc.v2(this._defaultLeftPos,0)),o=cc.delayTime(2),r=cc.moveTo(2,cc.v2(t+this._defaultLeftPos,0)),s=cc.delayTime(2),c=cc.sequence(e,o,r,s,i,a,n),l=cc.repeatForever(c);this._scrollLabel.node.runAction(l)}}}),cc._RF.pop()},{}],CommonScrollView:[function(t,e,i){"use strict";cc._RF.push(e,"15622MfP1lCNL/tUZX1QqKJ","CommonScrollView");var a=t("CommonButton");cc.Class({extends:cc.ScrollView,properties:{scrollHorizontalHandleBtn:a,scrollVerticalHandleBtn:a},_recentOffsetPos:null,_recentContentSize:null,onLoad:function(){this._init()},_init:function(){this._recentOffsetPos=cc.v2(0,0),this._recentContentSize=cc.v2(0,0),this.scrollHorizontalHandleBtn&&this.scrollHorizontalHandleBtn.setTouchMoveEvent(this._horizontalHandleEvent.bind(this)),this.scrollVerticalHandleBtn&&(this.scrollVerticalHandleBtn.setTouchMoveEvent(this._verticalHandleEvent.bind(this)),this._setVerticalHandleBtnPos(1)),this.elastic=!1},_horizontalHandleEvent:function(t){cc.log("horizontalHandleEvent"),cc.log(t)},_verticalHandleEvent:function(t){var e=this.scrollVerticalHandleBtn.node.parent,i=e.convertToNodeSpace(t.getLocation());i.y-=.5*e.getContentSize().height;var a=.5*e.getContentSize().height+-.5*this.scrollVerticalHandleBtn.node.getContentSize().height,n=-.5*e.getContentSize().height+.5*this.scrollVerticalHandleBtn.node.getContentSize().height;i.y>a?i.y=a:i.y<n&&(i.y=n);var o=this.scrollVerticalHandleBtn.node.getPosition();this.scrollVerticalHandleBtn.node.setPosition(cc.v2(o.x,i.y));var r=e.getContentSize().height-this.scrollVerticalHandleBtn.node.getContentSize().height,s=(i.y+.5*r)/r;this.scrollToPercentVertical(s,0,!0)},update:function(t){this._super(t),this._updateCommonScrollView(t)},_updateCommonScrollView:function(t){0===this.content.childrenCount&&(this.content.height=0),this._updateScrollBar(t)},_updateScrollBar:function(t){this._redrawVerticalHandleBtn(),this._recentOffsetPos=this.getScrollOffset()},_redrawVerticalHandleBtn:function(){if(this.getMaxScrollOffset().y<=0)return this._setVerticalHandleBtnPos(1),void(this.scrollVerticalHandleBtn.node.parent.active=!1);if(this.scrollVerticalHandleBtn.node.parent.active=!0,this._recentContentSize.height===this.content.height){if(this._recentOffsetPos.y!==this.getScrollOffset().y){a=this._getVerticalHandleBtnPosPercentage();this._setVerticalHandleBtnPos(a)}}else{this._recentContentSize=this.content.getContentSize();var t=.1*this.scrollVerticalHandleBtn.node.parent.getContentSize().height,e=this.scrollVerticalHandleBtn.node.parent.getContentSize().height,i=e*(e/this.content.height);i=Math.max(t,i),this.scrollVerticalHandleBtn.node.height=i;var a=this._getVerticalHandleBtnPosPercentage();this._setVerticalHandleBtnPos(a)}},_getVerticalHandleBtnPosPercentage:function(){var t=.5;return this.getMaxScrollOffset().y>0&&(this.scrollVerticalHandleBtn.node.active=!0,(t=this.getScrollOffset().y/this.getMaxScrollOffset().y)>1?t=1:t<0&&(t=0),t-=.5),t/=-.5},_setVerticalHandleBtnPos:function(t){var e=(.5*this.scrollVerticalHandleBtn.node.parent.getContentSize().height-.5*this.scrollVerticalHandleBtn.node.getContentSize().height)*t;this.scrollVerticalHandleBtn.node.setPosition(cc.v2(this.scrollVerticalHandleBtn.node.getPosition().x,e))},getCurrentVerticalScrollPercentage:function(){var t=this._getVerticalHandleBtnPosPercentage();return t=t-t/2+.5}});cc._RF.pop()},{CommonButton:"CommonButton"}],CommonUtils:[function(t,e,i){"use strict";cc._RF.push(e,"b774esUid5I6L6nN4Ec647J","CommonUtils");t("url");var a=t("LocalDataConst"),n=t("FilterUtils"),o=t("Singleton");function r(t,e){var i=t,a=e;return t>e&&(i=e,a=t),Math.round(Math.random()*(a-i))+i}function s(t,e){if(t<e){var i=t;t=e,e=i}return e<1?-1:t%e==0?e:s(e,t%e)}e.exports={getRoot:function(){if(cc.director.getScene()){var t=cc.director.getScene().getChildByName("Canvas").getComponent("GameRootBase");return t||(t=cc.director.getScene().getChildByName("Canvas").getComponent("AdvGameRootBase"))||void 0}},encrypt:function(t,e){var i=CryptoJS.SHA256(e+"one-deep"),a=i.toString(CryptoJS.enc.Base64).substr(0,32),n={iv:(i=CryptoJS.SHA256(e.substr(0,16))).toString(CryptoJS.enc.Base64).substr(0,16),mode:CryptoJS.mode.CTR};return CryptoJS.AES.encrypt(t,a,n).toString()},decrypt:function(t,e){var i=CryptoJS.SHA256(e+"one-deep"),a=i.toString(CryptoJS.enc.Base64).substr(0,32),n={iv:(i=CryptoJS.SHA256(e.substr(0,16))).toString(CryptoJS.enc.Base64).substr(0,16),mode:CryptoJS.mode.CTR};return CryptoJS.AES.decrypt(t,a,n).toString(CryptoJS.enc.Utf8)},encryptHmac:function(t,e){return CryptoJS.HmacSHA256(t,e).toString(CryptoJS.enc.Base64)},saveLocalStorage:function(t,e){var i=o.dao.userBasicData,a=t;i&&(a=i.getUserCd()+a),cc.sys.localStorage.setItem(a,e)},loadLocalStorage:function(t,e,i){var n=o.dao.userBasicData,r=t;n&&(r=n.getUserCd()+r);var s=cc.sys.localStorage.getItem(r);if(!s)return e;switch(i){case a.LOCAL_STORAGE_GET_TYPE.BOOLEAN:s="true"===s.toLowerCase()||"1"===s;break;case a.LOCAL_STORAGE_GET_TYPE.INTEGER:s=parseInt(s);break;case a.LOCAL_STORAGE_GET_TYPE.FLOAT:s=parseFloat(s)}return s},removeLocalStorage:function(t){var e=o.dao.userBasicData,i=t;e&&(i=e.getUserCd()+i),cc.sys.localStorage.removeItem(i)},sortFunc:function(t,e){return t>e?1:-1},sortModels:function(t,e){return e&&0!==e.length?t.slice().sort(function(t,i){for(var a=0;a<e.length;a+=1){var n,o,r=e[a];if(r.propertyName&&r.getterName?(n=t[r.propertyName][r.getterName].apply(t[r.propertyName],r.args),o=i[r.propertyName][r.getterName].apply(i[r.propertyName],r.args)):r.propertyName?(n=t[r.propertyName],o=i[r.propertyName]):(n=t[r.getterName].apply(t,r.args),o=i[r.getterName].apply(i,r.args)),n<o)return"desc"===r.order?1:-1;if(n>o)return"desc"===r.order?-1:1}return 0}):t.slice()},filterModels:function(t,e,i){return e&&0!==e.length?(i=i||n,t.slice().filter(function(t){for(var a=0;a<e.length;a+=1){var n=e[a];if(n.propertyName){if(n.getterName&&i[n.propertyName][n.getterName].apply(null,[t]))return!1}else if(i[n.getterName].apply(null,[t]))return!1}return!0})):t.slice()},isFilterActive:function(t){for(var e in t)if(t[e])return!0;return!1},convertToCommaDelimited:function(t){var e=t.toString().split("."),i=e[0].replace(/(\d)(?=(\d{3})+$)/g,"$1,");return e.length>1&&(i+="."+e[1]),i},getScrollPercentage:function(t,e){return e<=0?0:t/e},setChildrenColor:function t(e,i){e.color=i;for(var a=0;a<e.children.length;a+=1)t(e.children[a],i)},setChildrenColorOrLabelOpacity:function t(e,i,a){e.getComponent(cc.Label)?e.opacity=a:e.color=i;for(var n=0;n<e.children.length;n+=1)t(e.children[n],i,a)},getRandom:r,getRandomForFloat:function(t,e){var i=r(1e3*t,1e3*e);return i=parseFloat(i/1e3)},getFractionForLessThanThousand:function(t){for(var e=null,i=0,a=0,n=0;n<t;n+=1)if((a=s(t,1e3-n))>10){i=1e3-n;break}return i/a<=10&&(e={numerator:t/a,denominator:i/a}),e||cc.error("\u5206\u6bcd\u304c11\u4ee5\u4e0a\u306e\u8868\u793a\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002"),e},restartGame:function(){window.setIntervalId&&(clearInterval(window.setIntervalId),o.localData[a.NOW_DATETIME]=null),cc.game.off(cc.game.EVENT_SHOW,window.updateSystemDate),cc.game.restart()}},cc._RF.pop()},{FilterUtils:"FilterUtils",LocalDataConst:"LocalDataConst",Singleton:"Singleton",url:5}],CommonWholeView:[function(t,e,i){"use strict";cc._RF.push(e,"c514990Vf9Fpqa2cTQy/y4k","CommonWholeView");var a=t("WindowBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("GameConst"),s=t("CommonUtils");cc.Class({extends:a,properties:{closeBtn:n,wholeImageSprite:cc.Sprite},openCommonWholeView:function(t,e){s.getRoot().node.addChild(this.node,r.Z_ORDER.POPUP),cc.log(t),this._initBtn(e),this._initSprites(t),this._runActionForNode(this.wholeImageSprite.node,255)},_closeCommonWholeView:function(){this.isValid&&this.node.destroy()},_initBtn:function(t){this.closeBtn.setTapEvent(function(){this.isValid&&(this.closeBtn.node.active=!1,this._runActionForNode(this.wholeImageSprite.node,0,function(){t&&t(),this._closeCommonWholeView()}.bind(this)))}.bind(this),n.SE_NAME.CANCEL)},_initSprites:function(t){this.wholeImageSprite.node.opacity=0,this.wholeImageSprite.node.scale=1,o.addSprite(this.wholeImageSprite,t,function(){}.bind(this))},_runActionForNode:function(t,e,i){t.stopAllActions();var a=cc.sequence(cc.fadeTo(.3,e).easing(cc.easeSineInOut()),cc.callFunc(function(){i&&i()},this));t.runAction(a)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ResourceUtils:"ResourceUtils",WindowBase:"WindowBase"}],CommonWindow:[function(t,e,i){"use strict";cc._RF.push(e,"1d406+YGBdCHIJS4w3z97G7","CommonWindow");var a=t("WindowBase");cc.Class({extends:a,_initBase:function(t,e){t.addChild(this.node),e&&this.windowNode.setContentSize(e)},openVariableTextWindow:function(t,e,i,a){this._initBase(t,a);var n=this.windowNode.getContentSize(),o=new cc.Node("RitchTextNode").addComponent(cc.RichText);if(o.maxWidth=.9*n.width,o.horizontalAlign=null!==i&&void 0!==i?i:cc.macro.TextAlignment.CENTER,o.string=e,o.node.getContentSize().height-.9*n.height>0){var r=.9*n.height/o.node.getContentSize().height,s=Math.max(o.node.width/Math.max(n.width,.1),.01);o.fontSize=o.fontSize*r/s,o.lineHeight=o.lineHeight*r/s}this.windowNode.addChild(o.node)},closeWindow:function(){this.node.destroy()}}),cc._RF.pop()},{WindowBase:"WindowBase"}],CurrencyThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"0e2dblQblVM8IVddTY6XSkD","CurrencyThumbnail");var a=t("ItemUtils"),n=t("CommonUtils"),o=t("ExchangeUtils"),r=t("ResourceUtils"),s=t("ExchangeConst");cc.Class({extends:cc.Component,properties:{columnArrayNode:[cc.Node],column1CurrencyNameLabel:cc.Label,column1CurrencySprite:cc.Sprite,column1NeedCurrencyNumLabel:cc.Label,column2CurrencySpriteArray:[cc.Sprite],column2NeedCurrencyNumLabelArray:[cc.Label],column3CurrencySpriteArray:[cc.Sprite],column3NeedCurrencyNumLabelArray:[cc.Label]},_exchangeId:null,_currencyCostArray:null,_costCurrencyItemIdMap:null,initCurrencyThumbnail:function(t,e){if(this._exchangeId=t,this._currencyCostArray=e,this._costCurrencyItemIdMap=n.getRoot()._costCurrencyItemIdMap,this.columnArrayNode.forEach(function(t){t.active=!1}),e&&e instanceof Array)switch(e.length){case 1:this.initColumn1(e[0]);break;case 2:this.initColumn2(e);break;case 3:this.initColumn3(e);break;default:return cc.error("\uff14\u3064\u4ee5\u4e0a\u306eItemId\u304c\u6e21\u3055\u308c\u3066\u3044\u307e\u3059")}},initColumn1:function(t){switch(this.columnArrayNode[0].active=!0,this.column1CurrencySprite.node.active=!1,this.column1CurrencyNameLabel.node.active=!1,o.getCostGroupTypeByExchangeId(this._exchangeId)){case s.EXCHANGE_COST_GROUP_TYPE.TEXT_GROUP:var e=a.getItemMaster(t.itemId);this.column1CurrencyNameLabel.node.active=!0,this.column1CurrencyNameLabel.string=e.getName();break;default:this.column1CurrencySprite.node.active=!0,r.addSprite(this.column1CurrencySprite,r.getFileNameItemImage(t.itemId))}this.column1NeedCurrencyNumLabel.string=n.convertToCommaDelimited(t.count),this._setFontColor()},initColumn2:function(t){this.columnArrayNode[1].active=!0;for(var e=0;e<t.length;e+=1)r.addSprite(this.column2CurrencySpriteArray[e],r.getFileNameItemImage(t[e].itemId)),this.column2NeedCurrencyNumLabelArray[e].string=n.convertToCommaDelimited(t[e].count),this._setFontColor()},initColumn3:function(t){this.columnArrayNode[2].active=!0;for(var e=0;e<t.length;e+=1)r.addSprite(this.column3CurrencySpriteArray[e],r.getFileNameItemImage(t[e].itemId)),this.column3NeedCurrencyNumLabelArray[e].string=n.convertToCommaDelimited(t[e].count),this._setFontColor()},redraw:function(){this._setFontColor()},_setFontColor:function(){switch(this._currencyCostArray.length){case 1:this._setFontColorByCostOver(this.column1NeedCurrencyNumLabel.node,this._currencyCostArray[0].itemId,this._currencyCostArray[0].count);break;case 2:for(var t=0;t<this._currencyCostArray.length;t+=1)this._setFontColorByCostOver(this.column2NeedCurrencyNumLabelArray[t].node,this._currencyCostArray[t].itemId,this._currencyCostArray[t].count);break;case 3:for(var e=0;e<this._currencyCostArray.length;e+=1)this._setFontColorByCostOver(this.column3NeedCurrencyNumLabelArray[e].node,this._currencyCostArray[e].itemId,this._currencyCostArray[e].count)}},_setFontColorByCostOver:function(t,e,i){var n=a.getUserItemCount(e);t.color=n<i?s.COST_OVER_COLOR:s.NORMAL_COLOR}}),cc._RF.pop()},{CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils"}],CustomCommandTypeList:[function(t,e,i){"use strict";cc._RF.push(e,"4810ft5GGJPiro71ptaWQdh","CustomCommandTypeList");var a=t("CommandRoomBg"),n=t("CommandTutorial");e.exports={roombg:a,tutorial:n},cc._RF.pop()},{CommandRoomBg:"CommandRoomBg",CommandTutorial:"CommandTutorial"}],CustomCommandTypeResourceList:[function(t,e,i){"use strict";cc._RF.push(e,"e61d0LHPNxKAoZmLrxNhKY2","CustomCommandTypeResourceList");var a=t("ResourceUtils"),n=t("RoomUtils"),o=t("AdvCustomConstants");function r(t,e){return 0!==t.indexOf("color_")?e(t,cc.SpriteFrame):void 0}e.exports={roombg:function(t,e){var i=n.getRoomFurnitureModelArrayByCharacterGroupId(parseInt(t[1]));if(i>0)for(var s in i){var c=i[s];r(a.getFileNameFurnitureImage(c.getFurnitureId()),e)}else r(o.DEBUG_ROOM_BG_FILE_NAME,e)},tutorial:function(t,e){}},cc._RF.pop()},{AdvCustomConstants:"AdvCustomConstants",ResourceUtils:"ResourceUtils",RoomUtils:"RoomUtils"}],D1AdvConfigPopup:[function(t,e,i){"use strict";cc._RF.push(e,"df3ecgyIYVG7YAk6TtKdrcO","D1AdvConfigPopup");var a=t("AdvSingleton"),n=t("PopupBase"),o=t("AdvText"),r=t("CommonButton"),s=t("SoundSettingView"),c=t("GameConst");cc.Class({extends:n,properties:{soundSettingView:s,synopsisText:o,endBtn:r,closeBtnArray:[r]},_callbackToEndAdv:null,onLoad:function(){this._initButtons()},openAdvConfigPopup:function(t,e,i){this.setCloseCallBack(i),this.initAdvConfigPopup(t,e),this.synopsisText.node.active=!0,this.open(),this.node.zIndex=c.Z_ORDER.TUTORIAL_SUB_ROOT+2,this._getGrayBackSprite()&&(this._getGrayBackSprite().node.zIndex=c.Z_ORDER.TUTORIAL_SUB_ROOT+1)},initAdvConfigPopup:function(t,e){this._callbackToEndAdv=e,this.synopsisText.string=t},_initButtons:function(){this.endBtn.setTapEvent(this._endBtnEvent.bind(this));for(var t=0;t<this.closeBtnArray.length;t++)this.closeBtnArray[t].setTapEvent(this.close.bind(this))},_endBtnEvent:function(){this._callbackToEndAdv(a.soundManager.getSoundConfig()),this.close()}});cc._RF.pop()},{AdvSingleton:"AdvSingleton",AdvText:"AdvText",CommonButton:"CommonButton",GameConst:"GameConst",PopupBase:"PopupBase",SoundSettingView:"SoundSettingView"}],D1AdvLogMessageThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"f6abeiZuahHu7vv9D5O0YeO","D1AdvLogMessageThumbnail");var a=t("CommonButton"),n=t("AdvText"),o=t("AdvConstants"),r=t("AdvSingleton"),s=t("AdvUtils");cc.Class({extends:cc.Component,properties:{voiceBtn:a,selectDispNode:cc.Node,nameRichText:n,messageRichText:n},initAdvLogThumbnail:function(t,e,i){this.nameRichText.setCustomText(e.nameText,o.ADV_TEXT_LENGTH_MAX);var a=this._deleteLineFeedCode(e.messageText);switch(this.messageRichText.setCustomText(a,o.ADV_TEXT_LENGTH_MAX),i?(this.voiceBtn.node.active=!0,this.voiceBtn.setTapEvent(function(){var t=s.getResource(i);t&&r.soundManager.playVoice(t)})):this.voiceBtn.node.active=!1,this.selectDispNode.active=!1,e.tag){case o.ADV_LOG_TAG.SELECT:this.selectDispNode.active=!0}},_deleteLineFeedCode:function(t){return t.replace(/\r?\n/g,"")}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvSingleton:"AdvSingleton",AdvText:"AdvText",AdvUtils:"AdvUtils",CommonButton:"CommonButton"}],D1AdvLogPopup:[function(t,e,i){"use strict";cc._RF.push(e,"4bc37YepYlHuoHpjtY2XT0P","D1AdvLogPopup");var a=t("PopupBase"),n=t("CommonScrollView"),o=t("CommonButton"),r=t("AdvConstants"),s=t("GameConst");cc.Class({extends:a,properties:{scrollView:n,closeBtnArray:[o],advLogMessageThumbnailPrefab:cc.Prefab},openAdvLogPopup:function(t,e,i,a){this.setCloseCallBack(a),this._initButtons(),this._initLogScrollView(t,e,i),this.open(),this.node.zIndex=s.Z_ORDER.TUTORIAL_SUB_ROOT+2,this._getGrayBackSprite()&&(this._getGrayBackSprite().node.zIndex=s.Z_ORDER.TUTORIAL_SUB_ROOT+1)},_initButtons:function(){for(var t=0;t<this.closeBtnArray.length;t++)this.closeBtnArray[t].setTapEvent(this.close.bind(this))},_initLogScrollView:function(t,e,i){for(var a=0,n="",o=0;o<e.length;o++){switch(e[o].tag){case r.ADV_LOG_TAG.VOICE:Array.isArray(i[e[o].tag])&&i[e[o].tag][a]?(n=""+i[e[o].tag][a].voiceFileName,a+=1):n="";break;default:n=""}var s=cc.instantiate(this.advLogMessageThumbnailPrefab).getComponent("D1AdvLogMessageThumbnail");s.initAdvLogThumbnail(t,e[o],n),this.scrollView.content.addChild(s.node)}}});cc._RF.pop()},{AdvConstants:"AdvConstants",CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",GameConst:"GameConst",PopupBase:"PopupBase"}],D1AdvSelectThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"82f9fGzxZpKwoZ5xRj2kB7x","D1AdvSelectThumbnail");var a=t("CommonButton"),n=t("AdvText"),o=t("AdvConstants");cc.Class({extends:cc.Component,properties:{imageSprite:cc.Sprite,advSelectBtn:a,selectText:n},onLoad:function(){this.imageSprite&&this.node.setContentSize(this.imageSprite.node.getContentSize())},init:function(t,e,i,a){this.selectText.setCustomText(i,o.ADV_TEXT_LENGTH_MAX),cc.log("init thumbnail",e),this.advSelectBtn.setTapEvent(function(n){t.setKeyValue(o.SELECT_KEY,"=",e),a&&a(i),this._tapEvent()}.bind(this))},_tapEvent:function(){this.isValid&&this.node.destroy()}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvText:"AdvText",CommonButton:"CommonButton"}],D1MessageView:[function(t,e,i){"use strict";cc._RF.push(e,"c5c74k/sPNKBYz09FKZH9nb","D1MessageView");var a=t("AdvText"),n=t("MessageView"),o=t("AdvConstants");cc.Class({extends:n,properties:{_nameText:a,_messageText:a,nameText:{type:a,get:function(){return this._nameText},set:function(t){this._nameText=t},override:!0},messageText:{type:a,get:function(){return this._messageText},set:function(t){this._messageText=t},override:!0}},setSelectThumbnails:function(t,e){this.selectionNode.destroyAllChildren();for(var i=0;i<e.length;i++){var a=cc.instantiate(this.selectBtnPrefab).getComponent("D1AdvSelectThumbnail");a.init(t,i+1,e[i],function(e){t.readNextLine(),this.selectionNode.destroyAllChildren(),t.addMessageLog(o.ADV_LOG_TAG.SELECT,"",e)}.bind(this)),this.selectionNode.addChild(a.node)}}});cc._RF.pop()},{AdvConstants:"AdvConstants",AdvText:"AdvText",MessageView:"MessageView"}],DebugRoot:[function(t,e,i){"use strict";cc._RF.push(e,"9deb2Z4PspD+4YHqlr+T6x1","DebugRoot");var a=t("Singleton");cc.Class({extends:cc.Component,backEvent:function(){cc.director.loadScene("TestScene.fire")},buyFurniture:function(t,e){a.RoomService.buyFurniture(e,201001,function(){cc.log("\u5bb6\u5177ID {"+e+"} \u3092\u8cfc\u5165")}.bind(this))},setFurniture:function(t,e){var i=e.split(","),n=parseInt(i[0]),o=parseInt(i[1]),r=parseInt(i[2]),s=parseInt(i[3]),c=parseInt(i[4]),l=a.dao.userFurniture.find(function(t){return t.getFurnitureId()===n}.bind(this)),u=l.getFurnitureCd();a.RoomService.setFurniture(u,1,o,r,s,c,function(){cc.log("\u5bb6\u5177ID {"+l.getFurnitureId()+"} \u3092\u914d\u7f6e")}.bind(this))},setCharacter:function(t,e){var i=e.split(":"),n=parseInt(i[0]),o=parseInt(i[1]);a.RoomService.setCharacter(n,o,function(){cc.log("\u30ad\u30e3\u30e9\u30af\u30bf\u30fcID {"+n+"} \u3092\u914d\u7f6e")}.bind(this))},saveLayout:function(t,e){a.RoomService.saveLayout(e,"\u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30b9\u30c8",function(){cc.log("\u30ec\u30a4\u30a2\u30a6\u30c8ID {"+e+"} \u3092\u4fdd\u5b58")}.bind(this))}}),cc._RF.pop()},{Singleton:"Singleton"}],DeckApis:[function(t,e,i){"use strict";cc._RF.push(e,"641b5jTdKxFFYRB066oisyu","DeckApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.DECK_GET_USER_DATA,path:"deck/getUserData",method:"POST"}),a.RESTClient.graft({name:n.UPDATE_DECKS,path:"deck/update",method:"POST"}),a.RESTClient.graft({name:n.UPDATE_DECKS_ALL,path:"deck/updateAll",method:"POST"}),a.RESTClient.graft({name:n.UPDATE_DECK_WITH_EQUIP,path:"deck/updateDeckWithEquip",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],DeckAutoUtils:[function(t,e,i){"use strict";cc._RF.push(e,"28bcbUs1QhNr5/GqetRPf2C","DeckAutoUtils");var a=t("DeckConst"),n=t("DeckSortConst");function o(t,e,i,a,n){if(!t[e.anotherFilterIdx]&&a&&a.deck&&a.deck[i]&&a.deck[i][e.anotherRoleType])return a.deck[i][e.anotherRoleType];if(Array.isArray(n)){var o=_.find(n,function(t){return t.deckPosition===i});if(o)return o.characterModel}}function r(t){switch(t){case a.ROLE_TYPE.MAIN:return{targetCharacterFilterIdx:a.AUTO_DECK_EDIT.FILTER_TYPE.MAIN,targetEquipmentFilterIdx:a.AUTO_DECK_EDIT.FILTER_TYPE.MAIN_EQUIP,anotherFilterIdx:a.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT,anotherRoleType:a.ROLE_TYPE.SUPPORT};case a.ROLE_TYPE.SUPPORT:return{targetCharacterFilterIdx:a.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT,targetEquipmentFilterIdx:a.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT_EQUIP,anotherFilterIdx:a.AUTO_DECK_EDIT.FILTER_TYPE.MAIN,anotherRoleType:a.ROLE_TYPE.MAIN}}return{}}function s(t,e,i,n){switch(e){case a.ROLE_TYPE.MAIN:return c(t,i,n);case a.ROLE_TYPE.SUPPORT:return l(i,n)}}function c(t,e,i){for(var n,o=0;o<i.length;o+=1)if((n=i[o])&&(!e||n.getCharacterGroupId()!==e.getCharacterGroupId())&&!_.find(t,function(t){return t.roleType===a.ROLE_TYPE.MAIN&&t.characterModel&&t.characterModel.getCharacterId()===n.getCharacterId()}))return i.splice(o,1),n}function l(t,e){for(var i,a=0;a<e.length;a+=1)if((i=e[a])&&(!t||i.getCharacterGroupId()!==t.getCharacterGroupId()))return e.splice(a,1),i}function u(t,e,i,a,n){return{deckType:t,deckId:e,deckPosition:i,roleType:a,characterModel:n}}function h(t,e,i,n,o,r){if(t){var s=[],c=[];if(Array.isArray(r)){o[a.AUTO_DECK_EDIT.EQUIPMENT_FILTER_TYPE.SAME_ATTRIBUTE]&&(r=(r=d(r,n)).sort(function(e,i){return e.getAttribute()===t.getAttribute()&&i.getAttribute()!==t.getAttribute()?-1:1}));for(var l=_.filter(t.getCharacterEquipmentInfoArray(),function(t){return t.isReleased}).length,u=0;u<l;u+=1){var h=r.shift();h&&s.push(h.getEquipmentCd())}}else s=t.getEquipmentWeaponCds(),c=t.getEquipmentProtectorCds();return{position:e,roleType:i,characterCd:t.getCharacterCd(),characterId:t.getCharacterId(),characterGroupId:t.getCharacterGroupId(),equipmentWeapons:m(s),equipmentProtectors:m(c)}}}function d(t,e){var i=[];return i.push({getterName:n.EQUIPMENT_SORT_FUNC_NAME[Object.keys(n.EQUIPMENT_SORT_TYPE)[e]],order:"desc"}),i.push({getterName:"getEquipmentId"}),i.push({getterName:"getEquipmentCd"}),p(t,i)}function p(t,e){return e&&0!==e.length?t.sort(function(t,i){for(var a=0;a<e.length;a+=1){var n,o,r=e[a];if(r.propertyName&&r.getterName?(n=t[r.propertyName][r.getterName].apply(t[r.propertyName],r.args),o=i[r.propertyName][r.getterName].apply(i[r.propertyName],r.args)):r.propertyName?(n=t[r.propertyName],o=i[r.propertyName]):(n=t[r.getterName].apply(t,r.args),o=i[r.getterName].apply(i,r.args)),n<o)return"desc"===r.order?1:-1;if(n>o)return"desc"===r.order?-1:1}return 0}):t}function m(t){for(var e=[],i=0;i<t.length;i+=1)e.push({equipmentCd:t[i]});return e}e.exports={getDeckCharacterEquipments:function(t){for(var e=[],i=0;i<t.length;i+=1)t[i].characterModel&&(Array.prototype.push.apply(e,t[i].characterModel.getEquipmentWeaponCds()),Array.prototype.push.apply(e,t[i].characterModel.getEquipmentProtectorCds()));return e},getDeckCharacterEquipmentsByRoleType:function(t,e){for(var i=[],n=0,o=0;o<a.DECK_UNIT_COUNT_MAX;o+=1)n=a.DECK_LEADER_POSITION+o,t&&t.deck&&t.deck[n]&&t.deck[n][e]&&(Array.prototype.push.apply(i,t.deck[n][e].getEquipmentWeaponCds()),Array.prototype.push.apply(i,t.deck[n][e].getEquipmentProtectorCds()));return i},sortEquipments:d,createDeckCharacterInfoArray:function(t,e,i,n,c,l,h,d,p){for(var m=_.find(t,function(t){return t.deckType===e&&t.deckId===i}),g=r(n),C=[],f=0;f<a.DECK_UNIT_COUNT_MAX;f+=1){var E=a.DECK_LEADER_POSITION+f;if(h[g.targetCharacterFilterIdx]){var T=s(C,n,o(h,g,E,m,p),d);T&&C.push(u(e,i,E,n,T))}else m&&m.deck&&m.deck[E]&&m.deck[E][n]&&C.push(u(e,i,E,n,m.deck[E][n]))}return C},createDeckParamArray:function(t,e,i,a,n){for(var o=[],r=n?e:void 0,s=0;s<t.length;s+=1){var c=h(t[s].characterModel,t[s].deckPosition,t[s].roleType,a,i,r);c&&o.push(c)}return o}},cc._RF.pop()},{DeckConst:"DeckConst",DeckSortConst:"DeckSortConst"}],DeckBattleParameterView:[function(t,e,i){"use strict";cc._RF.push(e,"76caf1FTnBNc7+UoLhekxVa","DeckBattleParameterView");var a=t("CommonUtils"),n=t("BattleParameterView"),o={COMPARISON:{NORMAL:1,UP:2,DOWN:3},COLOR:{NORMAL_COLOR:cc.color(255,255,255),UP_COLOR:cc.color(28,224,11),DOWN_COLOR:cc.color(222,82,255)}};cc.Class({extends:n,properties:{totalPowerNumLabel:cc.Label,totalPowerAnimation:cc.Animation,totalPowerUpIconNode:cc.Node,totalPowerDownIconNode:cc.Node,hpUpIconNode:cc.Node,hpDownIconNode:cc.Node,atkUpIconNode:cc.Node,atkDownIconNode:cc.Node,defUpIconNode:cc.Node,defDownIconNode:cc.Node},initBattleParameterView:function(t,e,i,n,o,r,s,c){this.totalPowerNumLabel.string=isNaN(t)?t:a.convertToCommaDelimited(t),this.hpNumLabel.string=isNaN(e)?e:a.convertToCommaDelimited(e),this.atkNumLabel.string=isNaN(i)?i:a.convertToCommaDelimited(i),this.defNumLabel.string=isNaN(n)?n:a.convertToCommaDelimited(n),this._setComparisonStats(t,e,i,n,o,r,s,c)},resetBattleParameterView:function(t){this.totalPowerNumLabel.string=t,this.hpNumLabel.string=t,this.atkNumLabel.string=t,this.defNumLabel.string=t},setPrefix:function(t){this.totalPowerNumLabel.string=t+this.totalPowerNumLabel.string,this.hpNumLabel.string=t+this.hpNumLabel.string,this.atkNumLabel.string=t+this.atkNumLabel.string,this.defNumLabel.string=t+this.defNumLabel.string},setSuffix:function(t){this.totalPowerNumLabel.string=this.totalPowerNumLabel.string+t,this.hpNumLabel.string=this.hpNumLabel.string+t,this.atkNumLabel.string=this.atkNumLabel.string+t,this.defNumLabel.string=this.defNumLabel.string+t},setActive:function(t){this.totalPowerNumLabel.node.active=t,this.hpNumLabel.node.active=t,this.atkNumLabel.node.active=t,this.defNumLabel.node.active=t},setColor:function(t,e,i,a){this.hpNumLabel.node.color=t,this.atkNumLabel.node.color=e,this.defNumLabel.node.color=i,this.totalPowerNumLabel.node.color=a},setScale:function(t){this.totalPowerNumLabel.node.scale=t,this.hpNumLabel.node.scale=t,this.atkNumLabel.node.scale=t,this.defNumLabel.node.scale=t},playAnimation:function(){this.totalPowerAnimation.play(),this.hpAnimation.play(),this.atkAnimation.play(),this.defAnimation.play()},_setComparisonStats:function(t,e,i,a,n,o,r,s){var c=this._getComparison(t,n),l=this._getComparison(e,o),u=this._getComparison(i,r),h=this._getComparison(a,s);this.setColor(this._getNumColor(l),this._getNumColor(u),this._getNumColor(h),this._getNumColor(c)),this._setTotalPowerIcon(c),this._setHpIcon(l),this._setAtkIcon(u),this._setDefIcon(h)},_getComparison:function(t,e){if(!e)return o.COMPARISON.NORMAL;var i=parseInt(t)-parseInt(e);return 0===i?o.COMPARISON.NORMAL:i>0?o.COMPARISON.UP:i<0?o.COMPARISON.DOWN:void 0},_getNumColor:function(t){switch(t){case o.COMPARISON.NORMAL:return o.COLOR.NORMAL_COLOR;case o.COMPARISON.UP:return o.COLOR.UP_COLOR;case o.COMPARISON.DOWN:return o.COLOR.DOWN_COLOR}},_setTotalPowerIcon:function(t){switch(this.totalPowerUpIconNode.active=!1,this.totalPowerDownIconNode.active=!1,t){case o.COMPARISON.UP:this.totalPowerUpIconNode.active=!0;break;case o.COMPARISON.DOWN:this.totalPowerDownIconNode.active=!0}},_setHpIcon:function(t){switch(this.hpUpIconNode.active=!1,this.hpDownIconNode.active=!1,t){case o.COMPARISON.UP:this.hpUpIconNode.active=!0;break;case o.COMPARISON.DOWN:this.hpDownIconNode.active=!0}},_setAtkIcon:function(t){switch(this.atkUpIconNode.active=!1,this.atkDownIconNode.active=!1,t){case o.COMPARISON.UP:this.atkUpIconNode.active=!0;break;case o.COMPARISON.DOWN:this.atkDownIconNode.active=!0}},_setDefIcon:function(t){switch(this.defUpIconNode.active=!1,this.defDownIconNode.active=!1,t){case o.COMPARISON.UP:this.defUpIconNode.active=!0;break;case o.COMPARISON.DOWN:this.defDownIconNode.active=!0}}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonUtils:"CommonUtils"}],DeckCharacterDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"65cdfJldW1Bm6IbsJzzJxwf","DeckCharacterDetailPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=(t("GameConst"),t("DeckConst")),s=t("PromoteCharacterDetailPopupStatusView");cc.Class({extends:a,properties:{characterNameLabel:cc.Label,characterSkinNameLabel:cc.Label,characterLevelLabel:cc.Label,attributeIconImageSprite:cc.Sprite,rarityIconImageSprite:cc.Sprite,natureIconImageSprite:cc.Sprite,characterImageSprite:cc.Sprite,mainRoleImageSprite:cc.Sprite,subRoleImageSprite:cc.Sprite,promoteCharacterDetailPopupStatusView:s,okBtn:n},_root:null,_characterModel:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openDeckCharacterDetailPopup:function(t,e,i){this._root=t,this._characterModel=e,this._initLabels(i),this._initSprites(),this.promoteCharacterDetailPopupStatusView.initPromoteCharacterDetailStatusView(t,e.getCharacterMainMaster(),e),this.open()},_initLabels:function(t){this.characterNameLabel.string=this._characterModel.getShortName(),this.characterSkinNameLabel.string="["+this._characterModel.getSkinName()+"]",this.characterLevelLabel.string=""+this._characterModel.getLevel(),t===r.ROLE_TYPE.MAIN?(this.mainRoleImageSprite.node.active=!0,this.subRoleImageSprite.node.active=!1):(this.mainRoleImageSprite.node.active=!1,this.subRoleImageSprite.node.active=!0)},_initSprites:function(){o.addSprite(this.rarityIconImageSprite,o.getFileNameRarityStrIcon(this._characterModel.getRarity())),o.addSprite(this.attributeIconImageSprite,o.getFileNameAttributeIcon(this._characterModel.getAttribute())),o.addSprite(this.characterImageSprite,o.getFileNameCharacterMainDetail(this._characterModel.getCharacterId()))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",DeckConst:"DeckConst",GameConst:"GameConst",PopupBase:"PopupBase",PromoteCharacterDetailPopupStatusView:"PromoteCharacterDetailPopupStatusView",ResourceUtils:"ResourceUtils"}],DeckCharacterDetailStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"9b5d34qC7xKA4wwWRM6Za8B","DeckCharacterDetailStatusView");t("GameConst");var a=t("DeckConst"),n=t("BattleParameterView");cc.Class({extends:cc.Component,properties:{battleParameterView:n,incrementMainBattleParameterView:n,incrementSubBattleParameterView:n},initCharacterDetailStatusView:function(t,e){var i=this.battleParameterView.getComponent("BattleParameterView"),n=this.incrementMainBattleParameterView.getComponent("BattleParameterView"),o=this.incrementSubBattleParameterView.getComponent("BattleParameterView"),r=t.getTotalHp(),s=t.getTotalAtk(),c=t.getTotalDef(),l=t.getTotalHp()-t.getHp(),u=t.getTotalAtk()-t.getAtk(),h=t.getTotalDef()-t.getDef();i.initBattleParameterView(r,s,c),e===a.ROLE_TYPE.MAIN?(this._changeActive(!0,n,o),n.initBattleParameterView(l,u,h),n.setPrefix("(+"),n.setSuffix(")")):(this._changeActive(!1,n,o),o.initBattleParameterView(l,u,h),o.setPrefix("(+"),o.setSuffix(")"))},_changeActive:function(t,e,i){e.setActive(t),i.setActive(!t)}}),cc._RF.pop()},{BattleParameterView:"BattleParameterView",DeckConst:"DeckConst",GameConst:"GameConst"}],DeckCharacterSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"19c040KcClAhYb3SdOZbgKt","DeckCharacterSelectSideView");var a=t("CommonButton"),n=(t("ResourceUtils"),t("CommonUtils"),t("CharacterConst")),o=(t("GameConst"),t("DeckConst")),r=t("BattleParameterView"),s=t("PromoteCharacterSimpleAppendListView");cc.Class({extends:cc.Component,properties:{activeNode:cc.Node,inactiveNode:cc.Node,mainNameLabel:cc.Label,skinNameLabel:cc.Label,totalPowerLabel:cc.Label,battleParameterView:r,characterThumbnailPrefab:cc.Prefab,characterThumbnailParentNode:cc.Node,characterLevelProgressViewPrefab:cc.Prefab,characterLevelProgressViewParentNode:cc.Node,characterExceedLimitProgressViewPrefab:cc.Prefab,characterExceedLimitProgressViewParentNode:cc.Node,equipmentThumbnailPrefab:cc.Prefab,equipmentThumbnailParentNode:cc.Node,appendListView:s,infoBtn:a,protectBtn:a,executeBtn:a},_characterModel:null,_callbackToProtectBtn:null,_root:null,_subRoot:null,_characterThumbnail:null,_characterLevelProgressView:null,_characterExceedLimitProgressView:null,_equipmentThumbnailArray:null,onLoad:function(){this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),""),this.protectBtn.setTapEvent(this._onTapProtectBtn.bind(this),a.SE_NAME.EQUIP),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initDeckCharacterSelectSideView:function(t,e,i){this._root=t,this._subRoot=e,this._callbackToProtectBtn=i,this.activeNode.active=!1,this.inactiveNode.active=!0,this._addCharacterThumbnail(),this._addLevelProgressView(),this._addExceedLimitProgressView(),this._addEquipmentThumbnail()},_addCharacterThumbnail:function(){this._characterThumbnail||(this._characterThumbnail=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.characterThumbnailParentNode.addChild(this._characterThumbnail.node))},_addLevelProgressView:function(){this._characterLevelProgressView||(this._characterLevelProgressView=cc.instantiate(this.characterLevelProgressViewPrefab).getComponent("CharacterLevelProgressView"),this.characterLevelProgressViewParentNode.addChild(this._characterLevelProgressView.node))},_addExceedLimitProgressView:function(){this._characterExceedLimitProgressView||(this._characterExceedLimitProgressView=cc.instantiate(this.characterExceedLimitProgressViewPrefab).getComponent("CharacterExceedLimitProgressView"),this.characterExceedLimitProgressViewParentNode.addChild(this._characterExceedLimitProgressView.node))},_addEquipmentThumbnail:function(){if(!this._equipmentThumbnailArray){this._equipmentThumbnailArray=[];for(var t=0;t<n.EQUIPMENT_MAX_COUNT;t+=1){var e=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");this._equipmentThumbnailArray.push(e),this.equipmentThumbnailParentNode.addChild(e.node)}}},drawDeckCharacterSelectSideView:function(t,e){this.activeNode.active=!0,this.inactiveNode.active=!1,this._characterModel=t,this.protectBtn.switchBtnImage(t.getIsProtect()),this.mainNameLabel.node.parent.opacity=0,this.mainNameLabel.node.parent.runAction(cc.fadeIn(.3)),this.mainNameLabel.string=t.getShortName(),this.skinNameLabel.string="["+t.getSkinName()+"]",this._characterThumbnail.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),t.getLevel(),1),e?this.battleParameterView.initBattleParameterView(t.getTotalPower(),t.getTotalHp(),t.getTotalAtk(),t.getTotalDef(),e.getTotalPower(),e.getTotalHp(),e.getTotalAtk(),e.getTotalDef()):this.battleParameterView.initBattleParameterView(t.getTotalPower(),t.getTotalHp(),t.getTotalAtk(),t.getTotalDef()),this.appendListView.drawPromoteCharacterSimpleAppendListView(t),this._drawLevelProgress(t),this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(t.getExceedLimit(),t.getExceedLimit(),t.getExceedLimitMaxCount()),this._drawEquipmentThumbnails(t)},_drawLevelProgress:function(t){var e=t.getExpRateForNextLevel(),i=t.getNeedExpForNextLevel(),a=t.getMaxLevel(),n=t.getLevel();this._characterLevelProgressView.initCharacterLevelProgressView(0,n,0,a,0,i,e)},_drawEquipmentThumbnails:function(t){for(var e=t.getCharacterEquipmentInfoArray(),i=0;i<this._equipmentThumbnailArray.length;i+=1)e[i]?e[i].isReleased?e[i].equipmentModel?(this._equipmentThumbnailArray[i].node.active=!0,this._equipmentThumbnailArray[i].setLimited(!1),this._equipmentThumbnailArray[i].switchEmptyNodeActive(!1),this._equipmentThumbnailArray[i].initEquipmentMatrixThumbnail(e[i].equipmentModel.getEquipmentId(),e[i].equipmentModel.getAttribute(),e[i].equipmentModel.getRarity(),e[i].equipmentModel),this._equipmentThumbnailArray[i].setParameter("Lv.",e[i].equipmentModel.getLevel())):(this._equipmentThumbnailArray[i].node.active=!0,this._equipmentThumbnailArray[i].setLimited(!1),this._equipmentThumbnailArray[i].switchEmptyNodeActive(!0)):(this._equipmentThumbnailArray[i].node.active=!0,this._equipmentThumbnailArray[i].setLimited(!0),this._equipmentThumbnailArray[i].switchEmptyNodeActive(!0)):this._equipmentThumbnailArray[i].node.active=!1},_onTapInfoBtn:function(){var t=this._subRoot.getCharacterSelectData();this._root.transitionForPromoteCharacterDetailStatus(this._characterModel,t.deckType,t.deckId,t.deckPosition,t.roleType,t.firstCharacterCd)},_onTapProtectBtn:function(){this._callbackToProtectBtn(this._characterModel)},_onTapExecuteBtn:function(){var t=this._subRoot.getCharacterSelectData(),e=this._characterModel.getCharacterCd();if(t.firstCharacterCd===this._characterModel.getCharacterCd()&&(e=""),""!==e&&this._subRoot.isSwapCharacter(this._characterModel,t.roleType))return this._subRoot.isDeckUnitByCharacterCd(e,o.ROLE_TYPE.SUPPORT)?this._root.openDeckSwapReleaseCharacterPopup(e,t):this._root.openDeckSwapSelectCharacterPopup(e,t);this._root.requestDeckUpdate(t.deckType,t.deckId,t.deckPosition,t.roleType,e,this._root.popScene.bind(this._root))}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CharacterConst:"CharacterConst",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DeckConst:"DeckConst",GameConst:"GameConst",PromoteCharacterSimpleAppendListView:"PromoteCharacterSimpleAppendListView",ResourceUtils:"ResourceUtils"}],DeckCharacterSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ff213ha+A9EuYwlyWj8M9bU","DeckCharacterSelectSubRoot");var a=t("WindowBase"),n=t("MatrixPageViewBase"),o=t("Singleton"),r=t("DeckUtils"),s=t("ResourceUtils"),c=t("CharacterUtils"),l=t("CommonButton"),u=t("DeckCharacterSelectSideView"),h=t("CharacterSortConst"),d=t("CharacterFilterConst"),p=(t("GameConst"),t("DeckConst")),m=t("ResourceConst");cc.Class({extends:a,properties:{matrixPageView:n,thumbnailPrefab:cc.Prefab,deckCharacterSelectSideView:u,addCircleBtn:l},_root:null,_deckType:0,_deckId:0,_deckPosition:0,_roleType:0,_firstCharacterCd:null,_firstCharacterGroupId:null,_firstCharacterModel:null,_targetDeckModelArray:null,_characterModelList:null,onLoad:function(){this.addCircleBtn.setTapEvent(this._onAddCircleBtn.bind(this))},initDeckCharacterSelectSubRoot:function(t,e,i,a,n,o,r){this._root=t,this.matrixPageView.setCallBackToConvertSortText(c.convertSortTypeToText),this.matrixPageView.setCallBackToThumbnail(this._callbackToThumbnail.bind(this)),this.matrixPageView.setCallBackToIsImageActive(this._callBackToIsImageActive.bind(this)),this.matrixPageView.setCallBackToCreateSortConditions(this._callbackToCreateSortConditions.bind(this)),this.matrixPageView.setCallBackToCreateFilterConditions(this._callbackToCreateFilterConditions.bind(this)),this.matrixPageView.setSortParam(t.getCurrentSortType(!1),t.getCurrentSortOrder(!1)),this.matrixPageView.setFilterCheckList(t.getCurrentFilterCheckList()),this.matrixPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilter.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this.matrixPageView.setPageIndex(0),this.matrixPageView.node.active=!0,this.deckCharacterSelectSideView.initDeckCharacterSelectSideView(t,this,this._callbackToSideProtectBtn.bind(this)),n===p.ROLE_TYPE.MAIN?t._uiHeader.setTitle("\u30e1\u30a4\u30f3\u30e6\u30cb\u30c3\u30c8\u7de8\u6210"):t._uiHeader.setTitle("\u30b5\u30d6\u30e6\u30cb\u30c3\u30c8\u7de8\u6210"),this._initMatrixPageView(e,i,a,n,o),this._setTargetCharacterPageIndex(r)},_initMatrixPageView:function(t,e,i,a,n){this._deckType=parseInt(t),this._deckId=parseInt(e),this._deckPosition=parseInt(i),this._roleType=parseInt(a),this._targetDeckModelArray=this._createTargetDeckModelArray(t,e),this._firstCharacterModel=n||null,this._firstCharacterCd=n?n.getCharacterCd():0,this._firstCharacterGroupId=n?n.getCharacterMainMaster().getCharacterGroupId():0;var r=c.getPlayableUserCharacterModelArray().filter(function(t){return!this._isIgnoreTarget(t,this._roleType,this._firstCharacterCd)}.bind(this));this._characterModelList={};for(var s=0;s<r.length;s++)if(this._characterModelList[r[s].getCharacterCd()]=r[s],r[s].getCharacterCd()===this._firstCharacterCd){var l=r[s];r.splice(s,1),r.splice(0,0,l)}r=r.filter(function(t){return!this._isInvalidSelectCharacter(t,this._deckPosition,this._roleType,this._firstCharacterGroupId)}.bind(this)),this.matrixPageView.initMatrixPageView(r,o.dao[o.USER].getCharacterMaxCount(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToCreateThumbnailNode:function(t,e){var i;e?(i=e.getComponentInChildren("DeckMatrixThumbnail")).resetDeckMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("DeckMatrixThumbnail");var a=c.convertViewSortType(this._root.getCurrentSortType(!1));if(i.initDeckMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),c.getSortParameter(t,a),a),i.setProtected(t.getIsProtect()),i.setSelectedNodeActive(!1),this._firstCharacterCd===t.getCharacterCd())i.setCenterLabel("\u5916\u3059");else if(this._isOtherTowerDeckUnit(t,this._deckType,this._deckId)){var n=r.getDeckModelByDeckType(t.getCharacterCd(),this._deckType);i.setBottomLabel("\u7b2c"+n.getDeckId()+"\u30d1\u30fc\u30c6\u30a3\n\u7de8\u6210\u4e2d")}else this.isSwapCharacter(t,this._roleType)&&(this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.MAIN)?i.setBottomLabel("\u30e1\u30a4\u30f3\u7de8\u6210\u4e2d"):this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.SUPPORT)?i.setBottomLabel("\u30b5\u30d6\u7de8\u6210\u4e2d"):i.setBottomLabel("\u540c\u540d\u30e6\u30cb\u30c3\u30c8\n\u7de8\u6210\u4e2d"));return i.setEventBoost(t.getEventBoost()),i.node},_callBackToIsImageActive:function(t){return this._firstCharacterCd!==t.getCharacterCd()},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:h.SORT_FUNC_NAME[Object.keys(h.SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_callbackToCreateFilterConditions:function(t){for(var e=[],i=d.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:d.FILTER_FUNC_NAME[Object.keys(d.FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(d.FILTER_GROUP_END).indexOf(t)>=0},_callbackToSortAndFilter:function(t,e,i){this._root.setSortAndFilterParam(t,e,i,!1);for(var a=this.matrixPageView.getVisibleDataList(),n=0;n<a.length;n++)if(a[n].getCharacterCd()===this._firstCharacterCd){var o=a[n];a.splice(n,1),a.splice(0,0,o)}this.matrixPageView.setVisibleDataList(a)},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(s.getResource(m.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_BASE)).getComponent("SortFilterPopup")},_setTargetCharacterPageIndex:function(t){if(t){for(var e=this.matrixPageView.getVisibleDataList(),i=-1,a=0;a<e.length;a+=1)if(e[a].getCharacterCd()===t.getCharacterCd()){i=a;break}if(-1!==i){var n=parseInt(i/15);this.matrixPageView.setPageIndex(n),this.matrixPageView.content.getComponentsInChildren("MatrixThumbnailBase")[i-15*n].setSelectedNodeActive(!0),this._root.setCurrentCharacterCd(t.getCharacterCd()),this.deckCharacterSelectSideView.drawDeckCharacterSelectSideView(t,this._firstCharacterModel)}}},_resetActiveThumbnails:function(){var t=this.matrixPageView.content.getComponentsInChildren("MatrixThumbnailBase");for(var e in t)t[e].setSelectedNodeActive(!1)},_callbackToThumbnail:function(t,e){this._resetActiveThumbnails(),t.setSelectedNodeActive(!0),this._root.setCurrentCharacterCd(e.getCharacterCd()),this.deckCharacterSelectSideView.drawDeckCharacterSelectSideView(e,this._firstCharacterModel)},_callbackToSideProtectBtn:function(t){var e=this._deckType,i=this._deckId,a=this._deckPosition,n=this._roleType,o=this._firstCharacterModel;this._root.requestProtect([t],function(){this._initMatrixPageView(e,i,a,n,o),this._setTargetCharacterPageIndex(t),this.matrixPageView.redraw(),this.deckCharacterSelectSideView.drawDeckCharacterSelectSideView(this._root.getCurrentCharacterModel(),o)}.bind(this))},_onAddCircleBtn:function(){this._root.transitionShop(this._deckType,this._deckId,this._deckPosition,this._roleType,this._firstCharacterCd)},_isIgnoreTarget:function(t,e,i){return!(!this._isLastMainDeckUnit(t,e,i)&&!this._isSwapMainCharacterForEmpty(t,e,i))},_createTargetDeckModelArray:function(t,e){return o.dao[o.USER_DECK].filter(function(i){return i.getCharacterModel()?parseInt(i.getDeckType())===parseInt(t)&&parseInt(i.getDeckId())===parseInt(e):(cc.error("\u30c7\u30c3\u30ad\u306b\u6240\u6301\u3057\u3066\u3044\u306a\u3044\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059"),!1)})},_isLastMainDeckUnit:function(t,e,i){return e!==p.ROLE_TYPE.SUPPORT&&(t.getCharacterCd()===i&&!(_.filter(this._targetDeckModelArray,function(t){return t.getRoleType()===p.ROLE_TYPE.MAIN}).length>1))},_isSwapMainCharacterForEmpty:function(t,e,i){return!(i||e!==p.ROLE_TYPE.MAIN||!this.isSwapCharacter(t,e))},isSwapCharacter:function(t,e){switch(parseInt(e)){case parseInt(p.ROLE_TYPE.MAIN):return this._isDeckUnitByCharacterId(t.getCharacterMainMaster().getCharacterId(),p.ROLE_TYPE.MAIN)||this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.SUPPORT);case parseInt(p.ROLE_TYPE.SUPPORT):return this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.MAIN)||this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.SUPPORT)}},_isDeckUnitByGroupId:function(t,e){var i=this._targetDeckModelArray;return(i=i.filter(function(i){return i.getCharacterModel()?parseInt(i.getCharacterModel().getCharacterMainMaster().getCharacterGroupId())===parseInt(t)&&parseInt(i.getRoleType())===parseInt(e):(cc.error("\u30c7\u30c3\u30ad\u306b\u6240\u6301\u3057\u3066\u3044\u306a\u3044\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059"),!1)})).length>0},_isDeckUnitByCharacterId:function(t,e){var i=this._targetDeckModelArray;return(i=i.filter(function(i){return i.getCharacterModel()?parseInt(i.getCharacterModel().getCharacterMainMaster().getCharacterId())===parseInt(t)&&parseInt(i.getRoleType())===parseInt(e):(cc.error("\u30c7\u30c3\u30ad\u306b\u6240\u6301\u3057\u3066\u3044\u306a\u3044\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059"),!1)})).length>0},isDeckUnitByCharacterCd:function(t,e){var i=this._targetDeckModelArray;return(i=i.filter(function(i){return i.getCharacterModel()?i.getCharacterModel().getCharacterCd()===t&&parseInt(i.getRoleType())===parseInt(e):(cc.error("\u30c7\u30c3\u30ad\u306b\u6240\u6301\u3057\u3066\u3044\u306a\u3044\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059"),!1)})).length>0},_isInvalidSelectCharacter:function(t,e,i,a){switch(parseInt(i)){case parseInt(p.ROLE_TYPE.MAIN):return this._isInvalidSelectCharacterByMain(t,e,i,a);case parseInt(p.ROLE_TYPE.SUPPORT):return this._isInvalidSelectCharacterBySupport(t,e,i,a)}},_isInvalidSelectCharacterByMain:function(t,e,i,a){var n=this._targetDeckModelArray.find(function(t){return e===t.getPosition()&&p.ROLE_TYPE.SUPPORT===t.getRoleType()}),o=n?this._characterModelList[n.getCharacterCd()].getCharacterGroupId():0;return!this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.MAIN)&&this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.SUPPORT)&&this._isDeckUnitByCharacterId(t.getCharacterMainMaster().getCharacterId(),p.ROLE_TYPE.MAIN)&&t.getCharacterMainMaster().getCharacterGroupId()!==a||o===t.getCharacterGroupId()},_isInvalidSelectCharacterBySupport:function(t,e,i,a){var n=this._targetDeckModelArray.find(function(t){return e===t.getPosition()&&p.ROLE_TYPE.MAIN===t.getRoleType()}),o=n?this._characterModelList[n.getCharacterCd()].getCharacterGroupId():0;return a&&this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.MAIN)&&this._isDeckUnitByGroupId(t.getCharacterMainMaster().getCharacterGroupId(),p.ROLE_TYPE.MAIN)&&t.getCharacterMainMaster().getCharacterGroupId()!==a||!a&&this._getDeckPosition(t)===e||o===t.getCharacterGroupId()||!a&&this.isDeckUnitByCharacterCd(t.getCharacterCd(),p.ROLE_TYPE.MAIN)},_getDeckPosition:function(t){var e=this._targetDeckModelArray.find(function(e){return e.getCharacterModel().getCharacterCd()===t.getCharacterCd()});return e?parseInt(e.getPosition()):-1},_isOtherTowerDeckUnit:function(t,e,i){if(e===p.DECK_TYPE.TOWER){var a=r.getDeckModelByDeckType(t.getCharacterCd(),e);if(a)return a.getDeckId()!==i}return!1},getCharacterSelectData:function(){return{deckType:this._deckType,deckId:this._deckId,deckPosition:this._deckPosition,roleType:this._roleType,firstCharacterCd:this._firstCharacterCd}}});cc._RF.pop()},{CharacterFilterConst:"CharacterFilterConst",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",DeckCharacterSelectSideView:"DeckCharacterSelectSideView",DeckConst:"DeckConst",DeckUtils:"DeckUtils",GameConst:"GameConst",MatrixPageViewBase:"MatrixPageViewBase",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",WindowBase:"WindowBase"}],DeckConst:[function(t,e,i){"use strict";cc._RF.push(e,"92c22SnYVlDsq2YW/RQBprz","DeckConst"),e.exports={DECK_LEADER_POSITION:1,DECK_UNIT_COUNT_MAX:5,ROLE_TYPE:{MAIN:1,SUPPORT:2},DECK_TYPE:{QUEST:1,PVP:2,EXPEDITION:3,TOWER:4},DECK_COUNT_MAX:{QUEST:7,PVP:7,EXPEDITION:5,TOWER:5},AUTO_DECK_EDIT:{FILTER_TYPE:{MAIN:0,SUPPORT:1,MAIN_EQUIP:2,SUPPORT_EQUIP:3},EQUIPMENT_FILTER_TYPE:{SAME_ATTRIBUTE:0,FORCE_CHANGE:1,UNIQUE:2}}},cc._RF.pop()},{}],DeckMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"905dd7rVTRO6pXTBp6gCK0t","DeckMatrixThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("Singleton"),r=t("MatrixThumbnailBase"),s=t("CharacterSortConst");cc.Class({extends:r,properties:{mainImageSprite:cc.Sprite,attributeImageSprite:cc.Sprite,attributeFrameImageSprite:cc.Sprite,rarityImageSprite:cc.Sprite,mainNode:cc.Node,isProtectNode:cc.Node,isSelectedNode:cc.Node,isEventBoostNode:cc.Node,grayImageSpriteNode:cc.Node,bottomNumPrefixNode:cc.Node,bottomNumNode:cc.Node,centerLabel:cc.Label,bottomLabel:cc.Label,exceedLimitIconNodeArray:[cc.Node],exceedLimitFrameSpriteArray:[cc.Sprite],exceedLimitFrameBGSpriteArray:[cc.Sprite],thumbnailBtn:a},_spritesResArr:null,_overInitSprite:null,ctor:function(){this._spritesResArr=[],this._overInitSprite=!0},initDeckMatrixThumbnail:function(t,e,i,a){if(this._initSprites(t.getCharacterId(),t.getAttribute(),t.getRarity()),this._setBottomPalams(i,a),isNaN(e)||e<0)this._resetExceedLimit();else{var n=o.dao.CharacterExceedLimitMasters.filter(function(e){return e.getExceedLimitType()===t.getExceedLimitType()});this._setExceedLimit(e,n.length-1,t.getRarity())}},resetDeckMatrixThumbnail:function(){this.grayImageSpriteNode.active=!1,this.mainImageSprite.spriteFrame=null,this.rarityImageSprite.spriteFrame=null,this.attributeImageSprite.spriteFrame=null,this.attributeFrameImageSprite.spriteFrame=null,this.setCenterLabel(""),this.setBottomLabel(""),this._resetExceedLimit()},getTapEvent:function(){return this.thumbnailBtn.getTapEvent()},setTapEvent:function(t){this.thumbnailBtn.setTapEvent(t,"")},setTouchEnable:function(t){this.thumbnailBtn.setTouchEnable(t)},setSelectedNodeActive:function(t){this.isSelectedNode.active=t},setSelectedOrder:function(t){cc.error("setSelectedOrder(b)\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},setActive:function(t){this.grayImageSpriteNode.active=!t},setProtected:function(t){this.isProtectNode.active=t},getProtected:function(){return this.isProtectNode.active},setCallbackToThumbnailBtn:function(t){this.thumbnailBtn.setTapEvent(t,"")},_resetExceedLimit:function(){var t=0;for(t=0;t<this.exceedLimitIconNodeArray.length;t+=1)this.exceedLimitIconNodeArray[t].active=!1;for(t=0;t<this.exceedLimitFrameSpriteArray.length;t+=1)this.exceedLimitFrameSpriteArray[t].node.active=!1},_setExceedLimit:function(t,e,i){this._resetExceedLimit();var a=0;for(a=0;a<t;a+=1)this.exceedLimitIconNodeArray[a]&&(this.exceedLimitIconNodeArray[a].active=!0);for(a=0;a<e;a+=1)this.exceedLimitFrameSpriteArray[a]&&(this.exceedLimitFrameSpriteArray[a].node.active=!0,n.addSprite(this.exceedLimitFrameSpriteArray[a],n.getFileNameRarityExceedLimitFrame(i)));for(a=0;a<this.exceedLimitFrameBGSpriteArray.length;a+=1)this.exceedLimitFrameBGSpriteArray[a]&&n.addSprite(this.exceedLimitFrameBGSpriteArray[a],n.getFileNameRarityExceedLimitFrameBg(i))},_initSprites:function(t,e,i){this.grayImageSpriteNode.active=!1,i=isNaN(i)?0:i,this._spritesResArr.push([t,e,i]);var a=this;this._overInitSprite&&function t(){a._overInitSprite=!1;var e=a._spritesResArr[0][0],i=a._spritesResArr[0][1],o=a._spritesResArr[0][2];a._spritesResArr=a._spritesResArr.slice(1),n.addSprite(a.mainImageSprite,n.getFileNameCharacterThumbnail(e),function(){a._spritesResArr.length>0?t():a._overInitSprite=!0}),n.addSprite(a.rarityImageSprite,n.getFileNameRarityCharacterFrame(o)),isNaN(i)||(n.addSprite(a.attributeImageSprite,n.getFileNameAttributeIcon(i)),n.addSprite(a.attributeFrameImageSprite,n.getFileNameRarityRing(o)))}()},setEventBoost:function(t){this.isEventBoostNode.active=t,this._switchHeaderNodeAnimation()},_switchHeaderNodeAnimation:function(){if(this.isEventBoostNode.active){this.isEventBoostNode.opacity=0;cc.repeatForever(cc.sequence(cc.fadeOut(2),cc.fadeIn(2)));var t=cc.repeatForever(cc.sequence(cc.fadeIn(2),cc.fadeOut(2)));this.isEventBoostNode.runAction(t)}},setCenterLabel:function(t,e){this.centerLabel.node.active=!!t,this.centerLabel.string=t,e&&(this.centerLabel.node.color=e)},setBottomLabel:function(t){this.bottomLabel.node.parent.stopAllActions(),t?(this.bottomLabel.node.parent.active=!0,this.bottomLabel.string=t||"",this.bottomLabel.node.parent.runAction(cc.repeatForever(cc.sequence(cc.fadeIn(.5),cc.delayTime(1),cc.fadeOut(.5),cc.delayTime(3))))):this.bottomLabel.node.parent.active=!1},_setBottomNum:function(t){var e=this.bottomNumNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t+""},_setBottomNumPrefix:function(t){var e=this.bottomNumPrefixNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t},_setBottomPalams:function(t,e){t>=0?(this._setBottomNum(t),this._setBottomNumPrefix(this._getBottomNumPrefixText(e))):(this._setBottomNum(""),this._setBottomNumPrefix(""))},_getBottomNumPrefixText:function(t){switch(t){case s.SORT_TYPE.LEVEL:return"Lv.";case s.SORT_TYPE.RARE:return"\u2605";case s.SORT_TYPE.TOTAL:return"\u6226\u529b";case s.SORT_TYPE.HP:return"Hp";case s.SORT_TYPE.ATK:return"Atk";case s.SORT_TYPE.DEF:return"Def"}return""}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CommonButton:"CommonButton",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],DeckModel:[function(t,e,i){"use strict";cc._RF.push(e,"b758ey3tkNLvrzG807Zn4un","DeckModel");var a=t("UserDeckModel"),n=t("Singleton");cc.Class({userDeckModel:void 0,characterModel:void 0,ctor:function(){var t=arguments[0];this.userDeckModel=new a(t)},getCharacterModel:function(){return n.dao[n.USER_CHARACTER].find(function(t){return t.getCharacterCd()===this.userDeckModel.getCharacterCd()}.bind(this))},getCharacterCd:function(){return this.userDeckModel.getCharacterCd()},getDeckId:function(){return this.userDeckModel.getDeckId()},getPosition:function(){return this.userDeckModel.getPosition()},getDeckType:function(){return this.userDeckModel.getDeckType()},getRoleType:function(){return this.userDeckModel.getRoleType()}});cc._RF.pop()},{Singleton:"Singleton",UserDeckModel:"UserDeckModel"}],DeckRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"f04afwMVh9PaYb6t6OnNQe6","DeckRootBase");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("CharacterUtils"),r=t("PopupUtils"),s=t("GameConst"),c=t("DeckConst"),l=t("DeckUtils"),u=t("CommonUtils"),h=t("ResourceUtils"),d=(t("DeckViewSetting"),t("ItemConst")),p=t("LocalDataConst"),m=t("EquipmentSortConst"),g=t("CharacterSortConst"),C=t("ResourceConst"),f=cc.Enum({DECK_CHARACTER:0,ALL_CHARACTER:1});cc.Class({extends:a,properties:{deckCharacterDetailPopupPrefab:cc.Prefab,autoDeckEditPopupPrefab:cc.Prefab},_currentDeckType:0,_currentDeckId:0,_userCharacterModelMap:null,_currentCharacterCd:null,_currentFilterCheckList:null,deckArray:null,_deckCharacterDetailPopup:null,_autoDeckEditPopup:null,initResource:function(){this._super(),this.requestRes(C.DECK_EQUIPMENT_ALL_REMOVE_CONFIRM_POPUP_PREFAB_PATH,cc.Prefab)},reload:function(){this.deckArray=l.getDeckArrayByDeckTypes([this.getCurrentDeckType()])},openDeckCharacterDetailPopup:function(t,e){this.closeDeckCharacterDetailPopup(),this._deckCharacterDetailPopup=cc.instantiate(this.deckCharacterDetailPopupPrefab).getComponent("DeckCharacterDetailPopup"),this._deckCharacterDetailPopup.openDeckCharacterDetailPopup(this,t,e)},closeDeckCharacterDetailPopup:function(){this._deckCharacterDetailPopup&&(this._deckCharacterDetailPopup.close(),this._deckCharacterDetailPopup=null)},openAutoDeckEditPopup:function(t,e,i,a,n){this.closeAutoDeckEditPopup(),this._autoDeckEditPopup=cc.instantiate(this.autoDeckEditPopupPrefab).getComponent("AutoDeckEditPopup"),this._autoDeckEditPopup.openAutoDeckEditPopup(t,e,i,a,n)},closeAutoDeckEditPopup:function(){this._autoDeckEditPopup&&(this._autoDeckEditPopup.close(),this._autoDeckEditPopup=null)},openEquipmentAllRemoveConfirmPopup:function(t,e,i){this.closeEquipmentAllRemoveConfirmPopup(),this._equipmentAllRemoveConfirmPopup=cc.instantiate(h.getResource(C.DECK_EQUIPMENT_ALL_REMOVE_CONFIRM_POPUP_PREFAB_PATH)).getComponent("EquipmentAllRemoveConfirmPopup"),this._equipmentAllRemoveConfirmPopup.openEquipmentAllRemoveConfirmPopup(t,e,i,this._callbackToEquipmentAllRemoveExecute.bind(this))},closeEquipmentAllRemoveConfirmPopup:function(){this._equipmentAllRemoveConfirmPopup&&(this._equipmentAllRemoveConfirmPopup.close(),this._equipmentAllRemoveConfirmPopup=null)},_callbackToEquipmentAllRemoveExecute:function(t,e,i,a,n){switch(t){case f.DECK_CHARACTER:this._executeDeckCharacterEquipmentRemove(e,i,a,n);break;case f.ALL_CHARACTER:this._executeAllCharacterEquipmentRemove(n)}},_executeDeckCharacterEquipmentRemove:function(t,e,i,a){if(!i)return r.openSimpleMessageWindow("\u89e3\u9664\u3067\u304d\u308b\u30e6\u30cb\u30c3\u30c8\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002");this.requestUpdateDeckWithEquip(t,e,this._convertResetDeckEquipmentParam(i),a)},_executeAllCharacterEquipmentRemove:function(t){if(!this._hasEquipmentRemovableCharacter())return r.openSimpleMessageWindow("\u65e2\u306b\u5168\u3066\u306e\u88c5\u5099\u304c\u89e3\u9664\u3055\u308c\u3066\u3044\u307e\u3059\u3002");this.requestAllCharacterEquipRemove(t)},_hasEquipmentRemovableCharacter:function(){return _.some(n.dao.userCharacters,function(t){return t.getEquipmentWeaponCds().length>0||t.getEquipmentProtectorCds().length>0})},pushDeckSelectSubRoot:function(t,e){var i={DeckSelectSubRoot:{deckType:t,deckId:e}},a=this._createDeckSelectPreViewParam(t,e);this.pushScene("DeckScene",this.getCurrentSceneName(),i,a)},pushDeckCharacterSelectSubRoot:function(t,e,i,a,n){var o={DeckCharacterSelectSubRoot:{deckType:t,deckId:e,deckPosition:i,roleType:a,firstCharacterCd:n?n.getCharacterCd():0}},r=this._createDeckSelectPreViewParam(t,e);this.pushScene("DeckScene",this.getCurrentSceneName(),o,r)},pushPromoteCharacterEquipmentSelectSubRoot:function(t,e,i){var a="";t.equipmentModel&&(a=t.equipmentModel.getEquipmentCd());var n={PromoteCharacterEquipmentSelectSubRoot:{characterCd:t.characterModel.getCharacterCd(),frameName:t.frameName,equipmentType:t.equipmentType,position:t.position,needExceedLimit:t.needExceedLimit,isReleased:t.isReleased,equipmentCd:a}},o=this._createDeckSelectPreViewParam(e,i);this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),n,o)},requestDeckUpdate:function(t,e,i,a,o,r){n.DeckService.update(t,e,i,a,o,function(t){this._deckUpdateCallbackEvent(),r&&r()}.bind(this))},requestDeckUpdateAll:function(t,e,i,a){!i||i.length<1?r.openSimpleMessageWindow("\u8a72\u5f53\u3059\u308b\u30e6\u30cb\u30c3\u30c8\u3092\u6240\u6301\u3057\u3066\u3044\u307e\u305b\u3093"):n.DeckService.updateAll(t,e,i,function(t){this._deckUpdateCallbackEvent(),a&&a()}.bind(this))},requestUpdateDeckWithEquip:function(t,e,i,a){!i||i.length<1?r.openSimpleMessageWindow("\u8a72\u5f53\u3059\u308b\u30e6\u30cb\u30c3\u30c8\u3092\u6240\u6301\u3057\u3066\u3044\u307e\u305b\u3093"):n.DeckService.updateDeckWithEquip(t,e,i,function(t){this._deckUpdateCallbackEvent(),a&&a()}.bind(this))},requestChangeProtect:function(t,e){n.CharacterService.changeProtect([t],function(){this.reload(),e&&e()}.bind(this))},requestProtect:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(t[a].getCharacterCd());n.CharacterService.changeProtect(i,function(){this.reload(),e&&e(),this.redrawUIHeader()}.bind(this))},requestAllCharacterEquipRemove:function(t){n.CharacterService.equipRemoveAll(function(){this._deckUpdateCallbackEvent(),t&&t()}.bind(this))},_createDeckSelectPreViewParam:function(t,e){var i=this.sceneParam;for(var a in i)i[a].deckType=t,i[a].deckId=e;return i},_deckUpdateCallbackEvent:function(){cc.error("_deckUpdateCallbackEvent() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},transitionForPromoteCharacterDetailStatus:function(t,e,i,a,n,o){var r={PromoteCharacterDetailSubRoot:{targetCharacterCd:t.getCharacterCd(),topTabIndex:0}},s={DeckCharacterSelectSubRoot:{deckType:e,deckId:i,deckPosition:a,roleType:n,firstCharacterCd:o,targetCharacterCd:t.getCharacterCd()}};this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),r,s)},transitionForPromoteCharacterDetail:function(t){var e={PromoteCharacterDetailSubRoot:{targetCharacterCd:t.getCharacterCd(),topTabIndex:0}},i={};_.each(_.keys(this.sceneParam),function(t){i[t]=_.assign(this.sceneParam[t],{deckType:this._currentDeckType,deckId:this._currentDeckId})}.bind(this)),this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),e,i)},transitionShop:function(t,e,i,a,n){var o={ShopSelectSubRoot:{shopCategory:d.SHOP_CATEGORY.BOX}},r={DeckCharacterSelectSubRoot:{deckType:t,deckId:e,deckPosition:i,roleType:a,firstCharacterCd:n}};this.pushScene("ShopScene",this.getCurrentSceneName(),o,r)},setCurrentDeckType:function(t){this._currentDeckType=t},getCurrentDeckType:function(){return this._currentDeckType},setCurrentDeckId:function(t){this._currentDeckId=t},getCurrentDeckId:function(){return this._currentDeckId},getDeckArray:function(){return this.deckArray},getSelectedDeckIdByCurrentDeckType:function(){switch(this.getCurrentDeckType()){case c.DECK_TYPE.QUEST:return n.localData[p.SELECT_QUEST_DECK_ORDER];case c.DECK_TYPE.TOWER:return n.localData[p.SELECT_TOWER_DECK_ORDER];case c.DECK_TYPE.PVP:return 1}},_initUserCharacterModelMap:function(){this._userCharacterModelMap=o.createUserCharacterModelMap()},setSortAndFilterParam:function(t,e,i,a){if(a){u.saveLocalStorage(p.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,t),u.saveLocalStorage(p.LOCAL_STORAGE_KEY.SORT_ORDER_EQUIPMENT,e);for(var o=0;o<i.length;o+=1)n.localData[p.FILTER.TWELVE.EQUIPMENT][o]=i[o],this._currentFilterCheckList[o]=i[o]}else{u.saveLocalStorage(p.LOCAL_STORAGE_KEY.SORT_TYPE_CHARACTER,t),u.saveLocalStorage(p.LOCAL_STORAGE_KEY.SORT_ORDER_CHARACTER,e);for(o=0;o<i.length;o+=1)n.localData[p.FILTER.THIRTEEN.CHARACTER][o]=i[o],this._currentFilterCheckList[o]=i[o]}},getCurrentSortType:function(t){return t?u.loadLocalStorage(p.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,m.SORT_TYPE.GETTING,p.LOCAL_STORAGE_GET_TYPE.INTEGER):u.loadLocalStorage(p.LOCAL_STORAGE_KEY.SORT_TYPE_CHARACTER,g.SORT_TYPE.GETTING,p.LOCAL_STORAGE_GET_TYPE.INTEGER)},getCurrentSortOrder:function(t){return t?u.loadLocalStorage(p.LOCAL_STORAGE_KEY.SORT_ORDER_EQUIPMENT,s.SORT_ORDER.ASC,p.LOCAL_STORAGE_GET_TYPE.BOOLEAN):u.loadLocalStorage(p.LOCAL_STORAGE_KEY.SORT_ORDER_CHARACTER,s.SORT_ORDER.ASC,p.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},getCurrentFilterCheckList:function(){return this._currentFilterCheckList},setCurrentCharacterCd:function(t){this._currentCharacterCd=t+""},getCurrentCharacterCd:function(){return this._currentCharacterCd},getCurrentCharacterModel:function(){return this._userCharacterModelMap||this._initUserCharacterModelMap(),this._userCharacterModelMap[this.getCurrentCharacterCd()]},_convertResetDeckEquipmentParam:function(t){if(t){for(var e=[],i=Object.keys(t),a=0;a<i.length;a+=1)e.push({position:a+s.DECK_ID_ORIGIN,roleType:c.ROLE_TYPE.MAIN,characterCd:t[i[a]][c.ROLE_TYPE.MAIN].getCharacterCd(),equipmentWeapons:[],equipmentProtectors:[]}),t[i[a]][c.ROLE_TYPE.SUPPORT]&&e.push({position:a+s.DECK_ID_ORIGIN,roleType:c.ROLE_TYPE.SUPPORT,characterCd:t[i[a]][c.ROLE_TYPE.SUPPORT].getCharacterCd(),equipmentWeapons:[],equipmentProtectors:[]});return e}}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckUtils:"DeckUtils",DeckViewSetting:"DeckViewSetting",EquipmentSortConst:"EquipmentSortConst",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],DeckRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"22c33TbHHlLC7FV6pdQ2H2P","DeckRootUtils");t("GameConst");var a=t("DeckUtils"),n=t("CharacterUtils");e.exports={openDeckSelectSubRoot:function(t,e){if(cc.log("openDeckSelectSubRoot"),cc.log(e),!t.deckSelectSubRoot){t.deckSelectSubRoot=cc.instantiate(t.deckSelectSubRootPrefab).getComponent("DeckSelectSubRoot"),t.setCurrentDeckType(e.deckType),t.setCurrentDeckId(e.deckId),t.deckArray=a.getDeckArrayByDeckTypes([e.deckType]);var i=a.convertDeckTypeToDeckCountMax(e.deckType);t.deckSelectSubRoot.initDeckSelectSubRoot(t,t.deckArray,e.deckType,e.deckId,i),t.subRootParent.addChild(t.deckSelectSubRoot.node)}},closeDeckSelectSubRoot:function(t,e){t.deckSelectSubRoot&&(t.deckSelectSubRoot.node.destroy(),t.deckSelectSubRoot=null)},openDeckCharacterSelectSubRoot:function(t,e){if(cc.log("openDeckCharacterSelectSubRoot"),cc.log(e),!t.deckCharacterSelectSubRoot){var i=e.deckType,a=e.deckId,o=e.deckPosition,r=e.roleType,s=n.getCharacterModelByCharacterCd(e.firstCharacterCd),c=n.getCharacterModelByCharacterCd(e.targetCharacterCd);t.deckCharacterSelectSubRoot=cc.instantiate(t.deckCharacterSelectSubRootPrefab).getComponent("DeckCharacterSelectSubRoot"),t.deckCharacterSelectSubRoot.initDeckCharacterSelectSubRoot(t,i,a,o,r,s,c),t.subRootParent.addChild(t.deckCharacterSelectSubRoot.node)}},closeDeckCharacterSelectSubRoot:function(t,e){cc.log("closeDeckCharacterSelectSubRoot"),cc.log(e),t.deckCharacterSelectSubRoot&&(t.deckCharacterSelectSubRoot.node.destroy(),t.deckCharacterSelectSubRoot=null)}},cc._RF.pop()},{CharacterUtils:"CharacterUtils",DeckUtils:"DeckUtils",GameConst:"GameConst"}],DeckRoot:[function(t,e,i){"use strict";cc._RF.push(e,"14c491II+ZHOqJL6aV1l1Sc","DeckRoot");var a=t("DeckRootBase"),n=t("Singleton"),o=t("DeckUtils"),r=t("LocalDataConst"),s=(t("PopupUtils"),t("GameConst"),t("DeckConst")),c=(t("CharacterUtils"),t("CommonUtils"),t("TowerUtils"),t("QuestUtils"),t("ResourceConst")),l=t("DeckViewSetting");cc.Class({extends:a,properties:{deckSelectSubRootPrefab:cc.Prefab,deckCharacterSelectSubRootPrefab:cc.Prefab,deckSwapSelectCharacterPopupPrefab:cc.Prefab,deckSwapReleaseCharacterPopupPrefab:cc.Prefab},_deckSwapSelectCharacterPopup:null,_deckSwapReleaseCharacterPopup:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,l.DECK_SETTING)},initData:function(){this._initUserCharacterModelMap(),this._currentCharacterCd="",this._currentFilterCheckList=n.localData[r.FILTER.THIRTEEN.CHARACTER],this.reload()},initResource:function(){this._super(),this.requestRes(c.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_BASE,cc.Prefab)},initialize:function(){this.initOutGameRootBase();var t={DeckSelectSubRoot:{deckType:s.DECK_TYPE.QUEST,deckId:n.localData[r.SELECT_QUEST_DECK_ORDER]}};this._initOpenFirstView(t)},createPreViewParam:function(){var t={};if(this.deckSelectSubRoot&&(t=this._createDeckSelectPreViewParam(this.getCurrentDeckType(),this.getSelectedDeckIdByCurrentDeckType())),this.deckCharacterSelectSubRoot){var e=this.deckCharacterSelectSubRoot.getCharacterSelectData();t.DeckCharacterSelectSubRoot={deckType:e.deckType,deckId:e.deckId,deckPosition:e.deckPosition,roleType:e.roleType,firstCharacterCd:e.firstCharacterCd,targetCharacterCd:this.getCurrentCharacterCd()}}return t},_deckUpdateCallbackEvent:function(){this.deckArray=o.getDeckArrayByDeckTypes([this._currentDeckType]),this.deckSelectSubRoot&&(this.deckSelectSubRoot.setDeckArray(this.deckArray),this.deckSelectSubRoot.redrawDeckSelectSubRoot())},openDeckSwapSelectCharacterPopup:function(t,e,i){this.closeDeckSwapSelectCharacterPopup(),this._deckSwapSelectCharacterPopup=cc.instantiate(this.deckSwapSelectCharacterPopupPrefab).getComponent("DeckSwapSelectCharacterPopup"),this._deckSwapSelectCharacterPopup.openDeckSwapSelectCharacterPopup(e.firstCharacterCd,t,function(){this.requestDeckUpdate(e.deckType,e.deckId,e.deckPosition,e.roleType,t,this.popScene.bind(this))}.bind(this),i)},closeDeckSwapSelectCharacterPopup:function(){this._deckSwapSelectCharacterPopup&&(this._deckSwapSelectCharacterPopup.close(),this._deckSwapSelectCharacterPopup=null)},openDeckSwapReleaseCharacterPopup:function(t,e,i){this.closeDeckSwapReleaseCharacterPopup(),this._deckSwapReleaseCharacterPopup=cc.instantiate(this.deckSwapReleaseCharacterPopupPrefab).getComponent("DeckSwapReleaseCharacterPopup"),this._deckSwapReleaseCharacterPopup.openDeckSwapReleaseCharacterPopup(t,function(){this.requestDeckUpdate(e.deckType,e.deckId,e.deckPosition,e.roleType,t,this.popScene.bind(this))}.bind(this),i)},closeDeckSwapReleaseCharacterPopup:function(){this._deckSwapReleaseCharacterPopup&&(this._deckSwapReleaseCharacterPopup.close(),this._deckSwapReleaseCharacterPopup=null)}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckRootBase:"DeckRootBase",DeckUtils:"DeckUtils",DeckViewSetting:"DeckViewSetting",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceConst:"ResourceConst",Singleton:"Singleton",TowerUtils:"TowerUtils"}],DeckSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"c2fb2/WH/JG5ZuWznos1RH0","DeckSelectSubRoot");var a=t("WindowBase"),n=t("DeckUtils"),o=t("GameConst"),r=t("DeckTypeSwitchView");cc.Class({extends:a,properties:{deckTypeSwitchView:r,deckTabViewParentNode:cc.Node,deckTabViewPrefab:cc.Prefab},_root:null,_deckTabView:null,initDeckSelectSubRoot:function(t,e,i,a,n){this._root=t,t._uiHeader.setTitle("\u7de8\u6210"),this._initDeckTypeSwitchView(t,i),this._initDeckTabView(t,e,i,a,n)},redrawDeckSelectSubRoot:function(){this._deckTabView.redraw()},_initDeckTypeSwitchView:function(t,e){this.deckTypeSwitchView.initDeckTypeSwitchView(t,e,this._callbackToDeckTypeSwitch.bind(this))},_initDeckTabView:function(t,e,i,a,n){this._deckTabView||(this._deckTabView=cc.instantiate(this.deckTabViewPrefab).getComponent("DeckTabView"),this.deckTabViewParentNode.addChild(this._deckTabView.node)),this._deckTabView.initDeckTabView(t,e,i,a,n)},_callbackToDeckTypeSwitch:function(t){cc.log("_callbackToDeckTypeSwitch"),cc.log(t),this._root.setCurrentDeckType(t),this._root.reload(),this.setDeckArray(this._root.deckArray),this._initDeckTabView(this._root,this._root.deckArray,t,o.DECK_ID_ORIGIN,n.convertDeckTypeToDeckCountMax(t))},setDeckArray:function(t){this._deckTabView.setDeckArray(t)}});cc._RF.pop()},{DeckTypeSwitchView:"DeckTypeSwitchView",DeckUtils:"DeckUtils",GameConst:"GameConst",WindowBase:"WindowBase"}],DeckService:[function(t,e,i){"use strict";cc._RF.push(e,"56cf4JNnEdH45gMpRa0tDOf","DeckService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,update:function(t,e,i,a,o,r){var s={deckType:t,deckId:e,position:i,roleType:a,characterCd:o};this._requestCallApi(n.UPDATE_DECKS,s,function(t,e){return r(t?void 0:e)})},updateAll:function(t,e,i,a){var o=[];t=parseInt(t);for(var r=0;r<10;r++){var s=parseInt(r%5)+1,c=parseInt(r/5)+1;if(i[r]){var l={deckType:t,deckId:e,position:s,roleType:c,characterCd:i[r].getCharacterCd()};o.push(l)}}var u={decks:o};this._requestCallApi(n.UPDATE_DECKS_ALL,u,function(t,e){return a(t?void 0:e)})},updateDeckWithEquip:function(t,e,i,a){var o={deckType:t,deckId:e,decks:i};this._requestCallApi(n.UPDATE_DECK_WITH_EQUIP,o,function(t,e){return a(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],DeckSortConst:[function(t,e,i){"use strict";cc._RF.push(e,"84616563xlNAKCahQdqp3cz","DeckSortConst");cc.Class({statics:{CHARACTER_SORT_TYPE:cc.Enum({TOTAL:0,HP:1,ATK:2,DEF:3}),CHARACTER_SORT_FUNC_NAME:{TOTAL:"getTotalBasePower",HP:"getHp",ATK:"getAtk",DEF:"getDef"},CHARACTER_SUM_SORT_FUNC_NAME:{TOTAL:"getTotalPower",HP:"getTotalHp",ATK:"getTotalAtk",DEF:"getTotalDef"},EQUIPMENT_SORT_TYPE:cc.Enum({TOTAL:0,HP:1,ATK:2,DEF:3}),EQUIPMENT_SORT_FUNC_NAME:{TOTAL:"getTotalPower",HP:"getHp",ATK:"getAtk",DEF:"getDef"}}});cc._RF.pop()},{}],DeckSwapReleaseCharacterPopup:[function(t,e,i){"use strict";cc._RF.push(e,"287a6t2YQ5Iu5/qtC8W29bX","DeckSwapReleaseCharacterPopup");var a=t("PopupBase"),n=(t("Singleton"),t("CommonButton")),o=(t("ResourceUtils"),t("CharacterUtils")),r=t("CharacterSortConst");cc.Class({extends:a,properties:{deckMatrixThumbnailPrefab:cc.Prefab,matrixThumbnailParentNode:cc.Node,executionBtn:n,cancelBtn:n},openDeckSwapReleaseCharacterPopup:function(t,e,i){this.executionBtn.setTapEvent(function(){e(),this.close()}.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.setCloseCallBack(i),this._setParameter(t),this.open()},_setParameter:function(t){var e=o.getCharacterModelByCharacterCd(t),i=cc.instantiate(this.deckMatrixThumbnailPrefab).getComponent("DeckMatrixThumbnail");i.node.setPosition(cc.v2(0,0));var a=r.SORT_TYPE.LEVEL;i.initDeckMatrixThumbnail(e.getCharacterMainMaster(),e.getExceedLimit(),o.getSortParameter(e,a),a),i.setSelectedNodeActive(!1),this.matrixThumbnailParentNode.addChild(i.node)}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],DeckSwapSelectCharacterPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e4e24yxkHVCJYdhILZ+Dr/X","DeckSwapSelectCharacterPopup");var a=t("PopupBase"),n=(t("Singleton"),t("CommonButton")),o=(t("ResourceUtils"),t("CharacterUtils")),r=t("CharacterSortConst");cc.Class({extends:a,properties:{deckMatrixThumbnailPrefab:cc.Prefab,beforeMatrixThumbnailParentNode:cc.Node,afterMatrixThumbnailParentNode:cc.Node,executionBtn:n,cancelBtn:n},openDeckSwapSelectCharacterPopup:function(t,e,i,a){this.executionBtn.setTapEvent(function(){i(),this.close()}.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.setCloseCallBack(a),this._setParameter(t,e),this.open()},_setParameter:function(t,e){this._setMatrixThumbnail(t,this.beforeMatrixThumbnailParentNode),this._setMatrixThumbnail(e,this.afterMatrixThumbnailParentNode)},_setMatrixThumbnail:function(t,e){var i=o.getCharacterModelByCharacterCd(t),a=cc.instantiate(this.deckMatrixThumbnailPrefab).getComponent("DeckMatrixThumbnail");a.node.setPosition(cc.v2(0,0));var n=r.SORT_TYPE.LEVEL;a.initDeckMatrixThumbnail(i.getCharacterMainMaster(),i.getExceedLimit(),o.getSortParameter(i,n),n),a.setSelectedNodeActive(!1),e.addChild(a.node)}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],DeckTabSimpleView:[function(t,e,i){"use strict";cc._RF.push(e,"539ac72zZRIvapQBkDChDvY","DeckTabSimpleView");t("Singleton"),t("LocalDataConst");var a=t("DeckTabViewBase");t("GameConst"),cc.Class({extends:a,properties:{totalLabel:cc.Label},initDeckTabSimpleView:function(t,e,i,a,n,o){this._initDeckTabViewBase(t,e,i,a,n,o)},_onTapLeftBtn:function(){this._setCurrentTabForLoopAdjust(this.getCurrentTab()-1),this._setDeckUnitMap(this.getCurrentTab(),!1)},_onTapRightBtn:function(){this._setCurrentTabForLoopAdjust(this.getCurrentTab()+1),this._setDeckUnitMap(this.getCurrentTab(),!0)}});cc._RF.pop()},{DeckTabViewBase:"DeckTabViewBase",GameConst:"GameConst",LocalDataConst:"LocalDataConst",Singleton:"Singleton"}],DeckTabViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"19319LnrABJg7dQzFkmqlsx","DeckTabViewBase");var a=t("VariableTabViewBase"),n=t("GameConst"),o=t("DeckConst"),r=t("Singleton"),s=t("CommonButton"),c=t("LocalDataConst"),l=t("DeckUtils"),u=t("DeckUnitListViewBase");cc.Class({extends:a,properties:{leftBtn:s,rightBtn:s,deckUnitListView:u},_root:null,_deckInfoArray:null,onLoad:function(){this.leftBtn.setTapEvent(this._onTapLeftBtn.bind(this),s.SE_NAME.COUNT),this.rightBtn.setTapEvent(this._onTapRightBtn.bind(this),s.SE_NAME.COUNT)},_initDeckTabViewBase:function(t,e,i,a,n,o){this._root=t,this.windowNode.zIndex=0,this.setDeckArray(e);var r=this._createDeckTabButtons(e,n);this.initVariableTabViewBase(t,r),this.deckUnitListView.initDeckUnitListView(this._root,o),this._iCurrentTab=this.getTabIndexByDeckId(i,a),this._setDeckUnitMap(this._iCurrentTab),this._initArrowButtons()},getTabIndexByDeckId:function(t,e){for(var i=0;i<this._deckInfoArray.length;i+=1)if(this._deckInfoArray[i].deckType===t&&this._deckInfoArray[i].deckId===e)return i;return 0},_getDeckIdByTabIndex:function(t){return this._deckInfoArray[t].deckId},_getDeckTypeByTabIndex:function(t){return this._deckInfoArray[t].deckType},_createDeckTabButtons:function(t,e){var i=[];if(e<=1)return i;for(var a=o.DECK_TYPE.QUEST,r=n.DECK_ID_ORIGIN,s=0;s<e;s+=1){var c=t[s],u=cc.instantiate(this.getTabButtonPrefab(s,e)).getComponent("TabButton");c?(i.push(u),a=c.deckType,r=c.deckId):c={deckType:a,deckId:r+=1},u.initTabButton(l.createDeckName(c.deckType,c.deckId),c.isReleased),c.isReleased&&this.setTabBtn(u,s)}return i},setDeckArray:function(t){this._deckInfoArray=t},redraw:function(){this.deckUnitListView.initDeckUnitListView(this._root),this._setDeckUnitMap(this._iCurrentTab)},_tabEvent:function(t,e,i){this._setDeckUnitMap(e)},_setDeckUnitMap:function(t,e){switch(this._resetSelectedDeckTab(),this._setSelectedDeckTab(t),this._getDeckTypeByTabIndex(t)){case o.DECK_TYPE.QUEST:r.localData[c.SELECT_QUEST_DECK_ORDER]=this._getDeckIdByTabIndex(t);break;case o.DECK_TYPE.TOWER:r.localData[c.SELECT_TOWER_DECK_ORDER]=this._getDeckIdByTabIndex(t);break;case o.DECK_TYPE.PVP:r.localData[c.SELECT_PVP_DECK_ORDER]=this._getDeckIdByTabIndex(t)}void 0===e&&(e=!1),this.deckUnitListView.setDeckInfo(this._deckInfoArray[t],e)},_setSelectedDeckTab:function(t){this.tabBtnArray[t]&&this.tabBtnArray[t].switchBtnImage(!0)},_resetSelectedDeckTab:function(){for(var t=0;t<this.tabBtnArray.length;t+=1)this.tabBtnArray[t].switchBtnImage(!1)},_initArrowButtons:function(){this.tabBtnArray.length>1?(this.leftBtn.node.active=!0,this.rightBtn.node.active=!0):(this.leftBtn.node.active=!1,this.rightBtn.node.active=!1)},_onTapLeftBtn:function(){this._setCurrentTabForLoopAdjust(this.getCurrentTab()-1),this._setDeckUnitMap(this.getCurrentTab(),!1)},_onTapRightBtn:function(){this._setCurrentTabForLoopAdjust(this.getCurrentTab()+1),this._setDeckUnitMap(this.getCurrentTab(),!0)},_setCurrentTabForLoopAdjust:function(t){for(;t<0;)t+=this.tabBtnArray.length;t=parseInt(t%this.tabBtnArray.length),this._setCurrentTab(t)},getCurrentDeck:function(){return this._deckInfoArray&&this._deckInfoArray[this._iCurrentTab]?this._deckInfoArray[this._iCurrentTab].deck:null}});cc._RF.pop()},{CommonButton:"CommonButton",DeckConst:"DeckConst",DeckUnitListViewBase:"DeckUnitListViewBase",DeckUtils:"DeckUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",Singleton:"Singleton",VariableTabViewBase:"VariableTabViewBase"}],DeckTabView:[function(t,e,i){"use strict";cc._RF.push(e,"ca41adQP7lI2qClnl8LZlul","DeckTabView");var a=t("DeckTabViewBase"),n=(t("GameConst"),t("DeckConst"));t("CommonButton"),t("PopupUtils");cc.Class({extends:a,properties:{deckDescriptionLabel:cc.Label},onLoad:function(){this._super()},initDeckTabView:function(t,e,i,a,n){this._initDeckTabViewBase(t,e,i,a,n),this._drawDeckDescriptonLabel(i)},switchActiveExecuteDeckEditBtn:function(t){this.deckUnitListView.switchActiveExecuteDeckEditBtn(t)},_drawDeckDescriptonLabel:function(t){var e="";switch(t){case n.DECK_TYPE.QUEST:e="\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u306f\u901a\u5e38\u306e\u4e2d\u304b\u3089\u6311\u6226\u3059\u308b\u7de8\u6210\u3092\u9078\u629e\u3057\u307e\u3059\u3002";break;case n.DECK_TYPE.PVP:e="\u30a2\u30ea\u30fc\u30ca\u7de8\u6210\u306f\u4ed6\u6a5f\u80fd\u7528\u306e\u7de8\u6210\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u30e6\u30cb\u30c3\u30c8\u3082\u9078\u629e\u51fa\u6765\u307e\u3059\u3002";break;case n.DECK_TYPE.TOWER:e="\u30bf\u30ef\u30fc\u6311\u6226\u306b\u306f\u7de8\u62101\u306e\u30e6\u30cb\u30c3\u30c8\u8a2d\u5b9a\u30921\u30e6\u30cb\u30c3\u30c8\u4ee5\u4e0a\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"}this.deckDescriptionLabel.string=e}}),cc._RF.pop()},{CommonButton:"CommonButton",DeckConst:"DeckConst",DeckTabViewBase:"DeckTabViewBase",GameConst:"GameConst",PopupUtils:"PopupUtils"}],DeckTypeSwitchView:[function(t,e,i){"use strict";cc._RF.push(e,"629bb1MrVNIi7+9soNmSNN0","DeckTypeSwitchView");var a=t("WindowBase"),n=t("CommonButton"),o={0:{type:1,text:"\u901a\u5e38"},1:{type:2,text:"\u30a2\u30ea\u30fc\u30ca"},2:{type:4,text:"\u30bf\u30ef\u30fc"}};cc.Class({extends:a,properties:{switchBtn:n,pullDownBtn:n,currentDeckTypeActiveLabel:cc.Label,currentDeckTypeInActiveLabel:cc.Label,otherDeckTypeLabelArray:[cc.Label],otherDeckTypeBtnArray:[n],pullDownAnimation:cc.Animation},_currentIndex:0,_callbackToDeckTypeSwitch:null,onLoad:function(){this.switchBtn.setTapEvent(this._onTapSwitchBtn.bind(this)),this.pullDownBtn&&this.pullDownBtn.setTapEvent(this._onTapPullDownBtn.bind(this),n.SE_NAME.COUNT);for(var t=0;t<this.otherDeckTypeBtnArray.length;t+=1)this.otherDeckTypeBtnArray[t].node.name=""+t,this.otherDeckTypeBtnArray[t].setTapEvent(function(t){this._onTapOtherDeckTypeBtn(t)}.bind(this))},initDeckTypeSwitchView:function(t,e,i){this._currentIndex=this._convertDeckTypeToIndex(e),this._callbackToDeckTypeSwitch=i,this.pullDownBtn&&this.pullDownBtn.switchBtnImage(!1),this._setCurrentDeckTypeText(this._convertIndexToDeckText(this._currentIndex))},_switchDeckType:function(){this._currentIndex=this._adjustCurrentIndex(this._currentIndex+1),this._eventAfterSwitch()},_eventAfterSwitch:function(){this._setCurrentDeckTypeText(this._convertIndexToDeckText(this._currentIndex)),this._callbackToDeckTypeSwitch&&this._callbackToDeckTypeSwitch(this._convertIndexToDeckType(this._currentIndex))},_setCurrentDeckTypeText:function(t){this.currentDeckTypeActiveLabel.string=t,this.currentDeckTypeInActiveLabel.string=t},_onTapSwitchBtn:function(){return this.pullDownBtn&&this.pullDownBtn.getBtnImageSwitchState()?this._switchPullDown():this._switchDeckType()},_onTapPullDownBtn:function(){this._switchPullDown()},_onTapOtherDeckTypeBtn:function(t){var e=parseInt(t.target.name);this._currentIndex=this._convertOtherIndexToIndex(e),this._switchPullDown(),this._eventAfterSwitch()},_switchPullDown:function(){if(this.pullDownBtn.switchBtnImage(!this.pullDownBtn.getBtnImageSwitchState()),this.switchBtn.switchBtnImage(!this.pullDownBtn.getBtnImageSwitchState()),this.pullDownBtn.getBtnImageSwitchState()){this.pullDownAnimation.play().wrapMode=cc.WrapMode.Normal;for(var t=0;t<this.otherDeckTypeBtnArray.length;t+=1){var e=this._convertIndexToDeckText(this._convertOtherIndexToIndex(t));this.otherDeckTypeLabelArray[t].string=e}}else this.pullDownAnimation.play().wrapMode=cc.WrapMode.Reverse},_adjustCurrentIndex:function(t){return t%Object.keys(o).length},_convertIndexToDeckType:function(t){return o[t].type},_convertIndexToDeckText:function(t){return o[t].text},_convertOtherIndexToIndex:function(t){var e=Object.keys(o).length;return t+=this._currentIndex+1,t%=e},_convertDeckTypeToIndex:function(t){var e=0;for(var i in o)o[i].type===t&&(e=parseInt(i));return e}});cc._RF.pop()},{CommonButton:"CommonButton",WindowBase:"WindowBase"}],DeckUnitEquipmentListView:[function(t,e,i){"use strict";cc._RF.push(e,"aa697Ruo4dDmI7p6nsnPpCS","DeckUnitEquipmentListView");var a=t("CharacterEquipmentListView");cc.Class({extends:cc.Component,properties:{mainCharacterEquipmentListView:a,supportCharacterEquipmentListView:a},initDeckUnitEquipmentListView:function(t,e){this.mainCharacterEquipmentListView.initCharacterEquipmentListView(t.mainDeckCharacterInfo.characterModel,e),this.supportCharacterEquipmentListView.initCharacterEquipmentListView(t.supportDeckCharacterInfo.characterModel,e)}});cc._RF.pop()},{CharacterEquipmentListView:"CharacterEquipmentListView"}],DeckUnitListSimpleView:[function(t,e,i){"use strict";cc._RF.push(e,"64999v+qiFOjY5tG2GvjaJp","DeckUnitListSimpleView");t("GameConst");var a=t("DeckUtils"),n=t("DeckUnitListViewBase");cc.Class({extends:n,properties:{},_bIsDeckLock:!1,initDeckUnitListView:function(t,e){this._bIsDeckLock=e,this._super(t)},_initDeckUnitThumbnail:function(t,e,i,n){var o=a.createDeckUnitInfo(this._deckType,this._deckId,e,i,n);return t.initDeckUnitThumbnail(o,this._callbackToSelectBtn.bind(this),this._callbackToDetailBtn.bind(this)),t},_callbackToSelectBtn:function(t){this._bIsDeckLock||this._root.pushDeckSelectSubRoot(t.deckType,t.deckId)}});cc._RF.pop()},{DeckUnitListViewBase:"DeckUnitListViewBase",DeckUtils:"DeckUtils",GameConst:"GameConst"}],DeckUnitListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"17d959PaMxMP49Vpzg5f7t6","DeckUnitListViewBase");var a=t("GameConst"),n=t("DeckConst"),o=t("DeckUtils");cc.Class({extends:cc.Component,properties:{deckUnitThumbnailViewPrefab:cc.Prefab,deckBackNode:cc.Node,deckUnitStartPos:cc.v2(0,0),deckUnitSpaceX:0,totalPowerLabel:cc.Label},_root:null,_deckType:0,_deckId:0,_deckUnitThumbnailViewArray:null,initDeckUnitListView:function(t){this._initDeckUnitListViewBase(t)},_initDeckUnitThumbnail:function(t,e,i,a){return cc.error("_initDeckUnitThumbnail() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),t},_initDeckUnitListViewBase:function(t){this._root=t,this._initDeckUnitThumbnailViewArray(t)},_initDeckUnitThumbnailViewArray:function(t){this._deckUnitThumbnailViewArray=[],this.deckBackNode.destroyAllChildren();for(var e=0;e<n.DECK_UNIT_COUNT_MAX;e++){var i=cc.instantiate(this.deckUnitThumbnailViewPrefab).getComponent("DeckUnitThumbnailBase"),a=cc.v2(this.deckUnitStartPos.x+e*this.deckUnitSpaceX,this.deckUnitStartPos.y);i.node.name="DeckUnitThumbnail_"+(e+1),i.node.setPosition(a),this._deckUnitThumbnailViewArray[e]=i,this.deckBackNode.addChild(i.node)}},_resetDeckUnitThumbnailViewArray:function(){for(var t=0;t<this._deckUnitThumbnailViewArray.length;t++){var e=t+1,i=o.createDeckUnitInfo(this._deckType,this._deckId,e,void 0,void 0);this._deckUnitThumbnailViewArray[t].initDeckUnitThumbnail(i,this._callbackToSelectBtn.bind(this),null,null,null)}},_callbackToSelectBtn:function(t){var e=t.deckType,i=t.deckId,a=t.deckPosition,n=t.roleType,o=t.characterModel;this._root.pushDeckCharacterSelectSubRoot(e,i,a,n,o)},_callbackToDetailBtn:function(t){this._root.setCurrentCharacterCd(t.characterModel.getCharacterCd()),this._root.openDeckCharacterDetailPopup(t.characterModel,t.roleType)},setDeckInfo:function(t,e){this._deckUnitMap=t.deck,this._deckType=t.deckType,this._root.setCurrentDeckType(this._deckType),this._deckId=t.deckId,this._root.setCurrentDeckId(this._deckId),this._resetDeckUnitThumbnailViewArray(),this._moveTargetArray=[];for(var i=0;i<a.QUEST_DECK_MAX;i+=1){var r=this._deckUnitThumbnailViewArray[i];this._deckUnitMap&&this._deckUnitMap[i+a.DECK_ID_ORIGIN]&&(r=this._initDeckUnitThumbnail(r,i+a.DECK_ID_ORIGIN,this._deckUnitMap[i+a.DECK_ID_ORIGIN][n.ROLE_TYPE.MAIN],this._deckUnitMap[i+a.DECK_ID_ORIGIN][n.ROLE_TYPE.SUPPORT])),r.node.stopAllActions();var s=this.deckUnitStartPos.x+i*this.deckUnitSpaceX,c=null,l=null;e?(r.node.setPosition(cc.v2(s+30,this.deckUnitStartPos.y)),c=cc.sequence(cc.delayTime(.015*(a.QUEST_DECK_MAX-i)),cc.moveTo(.4,cc.v2(s,this.deckUnitStartPos.y)).easing(cc.easeOut(3))),l=cc.sequence(cc.delayTime(.05*(a.QUEST_DECK_MAX-i)),cc.fadeIn(.3))):(r.node.setPosition(cc.v2(s-30,this.deckUnitStartPos.y)),c=cc.sequence(cc.delayTime(.015*(i+1)),cc.moveTo(.4,cc.v2(s,this.deckUnitStartPos.y)).easing(cc.easeOut(3))),l=cc.sequence(cc.delayTime(.05*(i+1)),cc.fadeIn(.3))),r.node.runAction(c),r.node.opacity=0,r.node.runAction(l)}this.totalPowerLabel&&(this.totalPowerLabel.string=o.getDeckTotalPower(this._deckUnitMap))}}),cc._RF.pop()},{DeckConst:"DeckConst",DeckUtils:"DeckUtils",GameConst:"GameConst"}],DeckUnitListView:[function(t,e,i){"use strict";cc._RF.push(e,"a11543I145OnLU+myHVXc+S","DeckUnitListView");var a=t("DeckUnitListViewBase"),n=t("CommonButton"),o=t("Singleton"),r=t("PopupUtils"),s=t("CharacterUtils"),c=t("DeckUtils"),l=t("DeckAutoUtils"),u=t("CommonUtils"),h=t("EquipmentUtils"),d=(t("GameConst"),t("DeckSortConst")),p=t("CharacterFilterConst"),m=t("ItemConst"),g=t("LocalDataConst"),C=t("DeckConst");cc.Class({extends:a,properties:{switchDisplayDeckUnitThumbnailBtn:n,switchDisplayDeckUnitThumbnailBtnLabel:cc.Label,resetDeckBtn:n,resetDeckEquipmentBtn:n,autoDeckEditBtn:n,executeDeckEditBtn:n,grayBackNode:cc.Node},_isEquipmentDisplay:null,onLoad:function(){this._isEquipmentDisplay=!1,this.switchDisplayDeckUnitThumbnailBtn.setTapEvent(this._onTapSwitchDisplayDeckUnitThumbnailBtn.bind(this),n.SE_NAME.EQUIP),this.resetDeckBtn.setTapEvent(this._onTapResetDeckBtn.bind(this),n.SE_NAME.CANCEL),this.resetDeckEquipmentBtn.setTapEvent(this._onTapResetDeckEquipmentBtn.bind(this),n.SE_NAME.CANCEL),this.autoDeckEditBtn.setTapEvent(this._onTapAutoDeckEditBtn.bind(this)),this.executeDeckEditBtn.setTapEvent(this._onTapExecuteDeckEditBtn.bind(this)),this._initModalGrayBack(),this._setModalGrayBack()},initDeckUnitListView:function(t){this._super(t)},switchActiveExecuteDeckEditBtn:function(t){this.executeDeckEditBtn.node.active=t},_initDeckUnitThumbnail:function(t,e,i,a){this._moveTargetArray.push(t);var n=c.createDeckUnitInfo(this._deckType,this._deckId,e,i,a);return t.initDeckUnitThumbnail(n,this._callbackToSelectBtn.bind(this),this._callbackToDetailBtn.bind(this),this._callbackToSelectBtnMove.bind(this),this._callbackToSelectBtnMoveEnd.bind(this)),this._isEquipmentDisplay&&t.setEquipmentDisplay(),t},_setNormalDisplay:function(){for(var t in this._moveTargetArray){this._moveTargetArray[t].setNormalDisplay()}},_setEquipmentDisplay:function(){for(var t in this._moveTargetArray){this._moveTargetArray[t].setEquipmentDisplay()}},_initModalGrayBack:function(){this.grayBackNode&&(this.grayBackNode.on("touchstart",function(t){t.stopPropagation()}),this.grayBackNode.on("touchend",function(t){t.stopPropagation()})),this.grayBackNode.active=!1},_setModalGrayBack:function(){switch(this.grayBackNode.active=!1,this._deckType){case C.DECK_TYPE.TOWER:o.dao.towerSession.isDeckEditEnabled()||(this.grayBackNode.zIndex=1,this.grayBackNode.active=!0)}},setDeckInfo:function(t,e){this._super(t,e),this._setModalGrayBack(),this._isEquipmentDisplay?this._setEquipmentDisplay():this._setNormalDisplay()},_requestAutoDeckUpdate:function(t,e){t.requestDeckUpdateAll(this._deckType,this._deckId,e)},_createCharacterModelArrayForDeckUpdateAll:function(t){for(var e=[],i=0;i<C.DECK_UNIT_COUNT_MAX;i++)t[i]?e.push(t[i].getMainCharacterModel()):e.push(null);for(var a=[],n=0;n<t.length;n++)t[n].getSupportCharacterModel()?a.push(t[n].getSupportCharacterModel()):a.push(null);return e.concat(a)},_filterCharacters:function(t,e,i){t=this._filterByDeckType(t,this._deckType),t=this._filterByTargetDeck(t,i);var a=[];return u.isFilterActive(e)&&(a=this._createFilterConditions(e)),u.filterModels(t,a)},_filterByTargetDeck:function(t,e){return e[C.AUTO_DECK_EDIT.FILTER_TYPE.MAIN]||(t=this._filterByRoleType(t,C.ROLE_TYPE.MAIN)),e[C.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT]||(t=this._filterByRoleType(t,C.ROLE_TYPE.SUPPORT)),t},_filterByRoleType:function(t,e){var i=_.filter(o.dao[o.USER_DECK],function(t){return t.getRoleType()===e&&t.getDeckType()===this._deckType&&t.getDeckId()===this._deckId}.bind(this));return _.filter(t,function(t){return!_.some(i,function(e){return t.getCharacterCd()===e.getCharacterCd()})})},_filterByDeckType:function(t,e){switch(e){case C.DECK_TYPE.TOWER:var i=c.createDeckCharacterModelMapByDeckType(e);t=t.filter(function(t){var e=i[t.getCharacterCd()];return!e||e.getDeckId()===this._deckId}.bind(this))}return t},_createFilterConditions:function(t){for(var e=[],i=p.PROPERTY_NAME,a=0;a<t.length;a+=1)t[a]||e.push({propertyName:i,getterName:p.AUTO_DECK_FILTER_FUNC_NAME[Object.keys(p.AUTO_DECK_FILTER_TYPE)[a]]});return e},_sortCharacters:function(t,e,i){var a=this._createSortConditions(e,i);return t=u.sortModels(t,a)},_createSortConditions:function(t,e){var i=[];return e?i.push({getterName:d.CHARACTER_SUM_SORT_FUNC_NAME[Object.keys(d.CHARACTER_SORT_TYPE)[t]],order:"desc"}):i.push({getterName:d.CHARACTER_SORT_FUNC_NAME[Object.keys(d.CHARACTER_SORT_TYPE)[t]],order:"desc"}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_onTapSwitchDisplayDeckUnitThumbnailBtn:function(){this._isEquipmentDisplay=!this._isEquipmentDisplay,this._isEquipmentDisplay?(this.switchDisplayDeckUnitThumbnailBtnLabel.string="\u30e6\u30cb\u30c3\u30c8",this._setEquipmentDisplay()):(this.switchDisplayDeckUnitThumbnailBtnLabel.string="\u88c5\u5099",this._setNormalDisplay())},_onTapAutoDeckEditBtn:function(){var t=u.loadLocalStorage(g.LOCAL_STORAGE_KEY.SORT_TYPE_DECK,0,g.LOCAL_STORAGE_GET_TYPE.INTEGER);this._root.openAutoDeckEditPopup(t,o.localData[g.FILTER.SIX.AUTO_DECK_EDIT_ATTRIBUTE],o.localData[g.FILTER.FOUR.AUTO_DECK_EDIT_TARGET],o.localData[g.FILTER.THREE.AUTO_DECK_EDIT_EQUIPMENT],this._callbackToAutoDeckEdit.bind(this))},_onTapResetDeckBtn:function(){if(!this._deckUnitMap)return r.openSimpleMessageWindow("\u89e3\u9664\u3067\u304d\u308b\u30e6\u30cb\u30c3\u30c8\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002");r.openCommonPopupYesNo("\u4e00\u62ec\u89e3\u9664\u78ba\u8a8d","\u7de8\u6210\u3055\u308c\u3066\u3044\u308b\u30e6\u30cb\u30c3\u30c8\u3092\n\u5168\u3066\u89e3\u9664\u3057\u307e\u3059\u3002\n\u203b1\u67a0\u76ee\u306e\u307f\u6b8b\u308a\u307e\u3059\u3002","",!1,function(){var t=[this._deckUnitMap[1][C.ROLE_TYPE.MAIN]];this._requestAutoDeckUpdate(this._root,t)}.bind(this),null,"OK","\u30ad\u30e3\u30f3\u30bb\u30eb")},_onTapResetDeckEquipmentBtn:function(){this._root.openEquipmentAllRemoveConfirmPopup(this._deckType,this._deckId,this._deckUnitMap)},_onTapExecuteDeckEditBtn:function(){this._deckUnitMap?this._root.popScene():r.openCommonPopupOk("","\u30e6\u30cb\u30c3\u30c8\u3092\uff11\u4f53\u4ee5\u4e0a\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002","",!1,function(){})},_callbackToSelectBtnMove:function(t,e){for(var i in this._moveTargetArray=this._moveTargetArray.sort(function(t,e){var i=t.node.getPosition().x,a=e.node.getPosition().x;return u.sortFunc(i,a)}),this._deckUnitMap){var a=i-1,n=this._moveTargetArray[a];if(i!==n.getDeckPosition()){var o=cc.v2(210*a-420,0);t!==n?(n.node.stopAllActions(),n.node.runAction(cc.moveTo(.2,o).easing(cc.easeSineOut()))):t.setRecentPosition(o),n._deckPosition=i,this._isDeckUpdate=!0}}},_callbackToSelectBtnMoveEnd:function(t,e){if(this._isDeckUpdate){this._isDeckUpdate=!1;for(var i=[],a=0;a<5;a++)this._moveTargetArray[a]?i.push(this._moveTargetArray[a].getMainCharacterModel()):i.push(null);for(var n=[],o=0;o<this._moveTargetArray.length;o++)this._moveTargetArray[o].getSupportCharacterModel()?n.push(this._moveTargetArray[o].getSupportCharacterModel()):n.push(null);var r=i.concat(n);u.getRoot().requestDeckUpdateAll(this._deckType,this._deckId,r)}else e&&e()},_filterEquipments:function(t,e,i,a,n,o){var r=_.find(this._root.deckArray,function(t){return t.deckType===this._deckType&&t.deckId===this._deckId}.bind(this)),c=[],u=[];return t[C.AUTO_DECK_EDIT.FILTER_TYPE.MAIN_EQUIP]?Array.prototype.push.apply(u,l.getDeckCharacterEquipments(n)):Array.prototype.push.apply(c,l.getDeckCharacterEquipmentsByRoleType(r,C.ROLE_TYPE.MAIN)),t[C.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT_EQUIP]?Array.prototype.push.apply(u,l.getDeckCharacterEquipments(o)):Array.prototype.push.apply(c,l.getDeckCharacterEquipmentsByRoleType(r,C.ROLE_TYPE.SUPPORT)),c.length>0&&(i=_.filter(i,function(t){return!_.some(c,function(e){return e===t.getEquipmentCd()})})),e[C.AUTO_DECK_EDIT.EQUIPMENT_FILTER_TYPE.FORCE_CHANGE]?i:_.filter(i,function(t){return!!_.find(u,function(e){return e===t.getEquipmentCd()})||!s.getCharacterModelByEquipmentCd(t.getEquipmentCd(),a)})},_callbackToAutoDeckEdit:function(t,e,i,a){o.localData[g.FILTER.SIX.AUTO_DECK_EDIT_ATTRIBUTE]=e.slice(),o.localData[g.FILTER.FOUR.AUTO_DECK_EDIT_TARGET]=i.slice(),o.localData[g.FILTER.THREE.AUTO_DECK_EDIT_EQUIPMENT]=a.slice();var n=s.getPlayableUserCharacterModelArray(),r=this._filterCharacters(n.slice(),e,i);r=this._sortCharacters(r,t,!i[C.AUTO_DECK_EDIT.FILTER_TYPE.MAIN_EQUIP]);var c=l.createDeckCharacterInfoArray(this._root.deckArray,this._deckType,this._deckId,C.ROLE_TYPE.MAIN,t,e,i,r);i[C.AUTO_DECK_EDIT.FILTER_TYPE.MAIN_EQUIP]!==i[C.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT_EQUIP]&&(r=this._sortCharacters(r,t,!i[C.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT_EQUIP]));var u=l.createDeckCharacterInfoArray(this._root.deckArray,this._deckType,this._deckId,C.ROLE_TYPE.SUPPORT,t,e,i,r,c),d=h.getEquipmentModelArrayByEquipmentType(m.EQUIPMENT_TYPE.ATK);d=this._filterEquipments(i,a,d,n.slice(),c,u),d=l.sortEquipments(d,t);var p=l.createDeckParamArray(c,d,a,t,i[C.AUTO_DECK_EDIT.FILTER_TYPE.MAIN_EQUIP]),_=l.createDeckParamArray(u,d,a,t,i[C.AUTO_DECK_EDIT.FILTER_TYPE.SUPPORT_EQUIP]);0!==p.length&&(Array.prototype.push.apply(p,_),this._root.requestUpdateDeckWithEquip(this._deckType,this._deckId,p))}});cc._RF.pop()},{CharacterFilterConst:"CharacterFilterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DeckAutoUtils:"DeckAutoUtils",DeckConst:"DeckConst",DeckSortConst:"DeckSortConst",DeckUnitListViewBase:"DeckUnitListViewBase",DeckUtils:"DeckUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",Singleton:"Singleton"}],DeckUnitListWithGaugeSimpleView:[function(t,e,i){"use strict";cc._RF.push(e,"be3c0uzdmRO44OCrsArAGRX","DeckUnitListWithGaugeSimpleView");var a=t("DeckUtils"),n=t("DeckUnitListSimpleView");cc.Class({extends:n,properties:{},_characterStatusArray:null,initDeckUnitListView:function(t,e,i){this._characterStatusArray=[],Array.isArray(i)&&i.length>0&&(this._characterStatusArray=i),this._super(t,e)},_initDeckUnitThumbnail:function(t,e,i,n){var o=a.createDeckUnitInfo(this._deckType,this._deckId,e,i,n),r=this._getMainCharacterStatus(i);return t.initDeckUnitThumbnail(o,function(){this._bIsDeckLock||this._callbackToSelectBtn()}.bind(this),this._callbackToDetailBtn.bind(this),r),t},_getMainCharacterStatus:function(t){return this._characterStatusArray.find(function(e){return e.characterCd===t.getCharacterCd()})}});cc._RF.pop()},{DeckUnitListSimpleView:"DeckUnitListSimpleView",DeckUtils:"DeckUtils"}],DeckUnitSimpleThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"e7058f23SlHwpkDd6uosYdu","DeckUnitSimpleThumbnail");var a=t("ResourceUtils"),n=t("CommonUtils"),o=(t("EventUtils"),t("CharacterConst")),r=t("DeckUnitThumbnailBase"),s=t("DeckUnitSupportThumbnail");cc.Class({extends:r,properties:{totalPowerLabel:cc.Label,emptyLabel:cc.Label,deckUnitSupportThumbnail:s},_deckUnitInfo:null,initDeckUnitThumbnail:function(t,e,i){this._deckUnitInfo=t,this._super(t.mainDeckCharacterInfo,e,i),this.deckUnitSupportThumbnail.initDeckUnitThumbnail(t.supportDeckCharacterInfo,e,i),this._initMainCharacter(t.mainDeckCharacterInfo.characterModel),this._initBattleParameter(t)},_getEmptyText:function(){return"EMPTY"},_initMainCharacter:function(t){this.emptyLabel.string="",t?(a.addSprite(this.characterImageSprite,a.getFileNameCharacterMainDeck(t.getCharacterId())),a.addSprite(this.rarityFrameSprite,a.getFileNameRarityFrame(t.getRarity()))):this.emptyLabel.string="EMPTY"},_initBattleParameter:function(t){var e=t.mainDeckCharacterInfo.characterModel;if(e){var i=e.getTotalPower(),a=t.supportDeckCharacterInfo.characterModel;a&&(i+=Math.floor(a.getTotalPower()*o.SUPPORT_CHARA_PARAMETER_RATIO)),this.totalPowerLabel.string=n.convertToCommaDelimited(i)}},setDeckPosition:function(t){this._deckUnitInfo.deckPosition=t},getDeckPosition:function(){return this._deckUnitInfo.deckPosition},getMainCharacterModel:function(){return this._deckUnitInfo.mainDeckCharacterInfo.characterModel},getSupportCharacterModel:function(){return this._deckUnitInfo.supportDeckCharacterInfo.characterModel}});cc._RF.pop()},{CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",DeckUnitSupportThumbnail:"DeckUnitSupportThumbnail",DeckUnitThumbnailBase:"DeckUnitThumbnailBase",EventUtils:"EventUtils",ResourceUtils:"ResourceUtils"}],DeckUnitSupportThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"1b553ouVypKfL/l3Tq+fQCV","DeckUnitSupportThumbnail");var a=t("ResourceUtils"),n=t("DeckUnitThumbnailBase");cc.Class({extends:n,properties:{emptyNode:cc.Node},initDeckUnitThumbnail:function(t,e,i){this._super(t,e,i),this._initSupportThumbnail(t.characterModel)},_initSupportThumbnail:function(t){t?(this.emptyNode.active=!1,a.addSprite(this.characterImageSprite,a.getFileNameCharacterSupportThumbnail(t.getCharacterId())),a.addSprite(this.rarityFrameSprite,a.getFileNameRaritySubFrame(t.getRarity()))):this.emptyNode.active=!0}});cc._RF.pop()},{DeckUnitThumbnailBase:"DeckUnitThumbnailBase",ResourceUtils:"ResourceUtils"}],DeckUnitThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"862faGe0KhEjbZWClWmFa/Y","DeckUnitThumbnailBase");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{selectBtn:a,detailBtn:a,attributeIconSprite:cc.Sprite,attributeFrameImageSprite:cc.Sprite,rarityFrameSprite:cc.Sprite,natureIconSprite:cc.Sprite,characterImageSprite:cc.Sprite,characterLevelLabel:cc.Label,characterDisplayNode:cc.Node,boostDispNode:cc.Node,exceedLimitIconNodeArray:[cc.Node],exceedLimitFrameSpriteArray:[cc.Sprite]},_deckCharacterInfo:null,_callbackToSelectBtn:null,_callbackToDetailBtn:null,onLoad:function(){this.selectBtn.setTapEvent(this._onTapSelectBtn.bind(this)),this.detailBtn.setTapEvent(this._onTapDetailBtn.bind(this))},initDeckUnitThumbnail:function(t,e,i){this._deckCharacterInfo=t,this._initDeckCharacter(t.characterModel),this._initCallbacks(e,i)},getTapEvent:function(){return this.selectBtn.getTapEvent()},setTapEvent:function(t){this.selectBtn.setTapEvent(t)},setTouchEnable:function(t){this.selectBtn.setTouchEnable(t)},getDeckCharacterInfo:function(){return this._deckCharacterInfo},_setBoostDispNode:function(t){this.boostDispNode.active=t.getEventBoost()},_initDeckCharacter:function(t){t?(n.addSprite(this.attributeIconSprite,n.getFileNameAttributeIcon(t.getAttribute())),n.addSprite(this.attributeFrameImageSprite,n.getFileNameRarityRing(t.getRarity())),this.characterLevelLabel.string=""+t.getLevel(),this.characterDisplayNode.active=!0,this._setExceedLimit(t.getExceedLimit(),t.getExceedLimitMaxCount(),t.getRarity()),this._setBoostDispNode(t)):this.characterDisplayNode.active=!1},_resetExceedLimit:function(){var t=0;for(t=0;t<this.exceedLimitIconNodeArray.length;t+=1)this.exceedLimitIconNodeArray[t].active=!1;for(t=0;t<this.exceedLimitFrameSpriteArray.length;t+=1)this.exceedLimitFrameSpriteArray[t].node.active=!1},_setExceedLimit:function(t,e,i){this._resetExceedLimit();var a=0;for(a=0;a<t;a+=1)this.exceedLimitIconNodeArray[a]&&(this.exceedLimitIconNodeArray[a].active=!0);for(a=0;a<e;a+=1)this.exceedLimitFrameSpriteArray[a]&&(this.exceedLimitFrameSpriteArray[a].node.active=!0,n.addSprite(this.exceedLimitFrameSpriteArray[a],n.getFileNameRarityExceedLimitFrame(i)))},_initCallbacks:function(t,e){this._callbackToSelectBtn=t,this._callbackToDetailBtn=e},_onTapSelectBtn:function(){this._callbackToSelectBtn&&this._callbackToSelectBtn(this._deckCharacterInfo)},_onTapDetailBtn:function(){this._callbackToDetailBtn&&this._callbackToDetailBtn(this._deckCharacterInfo)}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],DeckUnitThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"366f6ZQ2lFCjLt+4QCJuoX1","DeckUnitThumbnail");var a=t("ResourceUtils"),n=(t("CommonUtils"),t("DeckUnitThumbnailBase")),o=t("DeckUnitSupportThumbnail"),r=t("BattleParameterView"),s=t("DeckUnitEquipmentListView"),c=t("StaticResourceConst"),l=t("CharacterConst");cc.Class({extends:n,properties:{battleParameterView:r,deckUnitSupportThumbnail:o,deckUnitEquipmentListView:s,switchDisplayTargetNode:cc.Node,emptyLabel:cc.Label,blinkNode:cc.Node},_deckUnitInfo:null,_callbackToSelectBtnMove:null,_callbackToSelectBtnMoveEnd:null,_deckUnitEquipmentListNode:null,onLoad:function(){this._super(),this.selectBtn.setTouchMoveEvent(this._onTouchMoveSelectBtn.bind(this)),this.selectBtn.setTouchMoveEndEvent(this._onTouchMoveEndSelectBtn.bind(this)),this.selectBtn.setTouchCancelEvent(this._onTouchMoveEndSelectBtn.bind(this))},initDeckUnitThumbnail:function(t,e,i,a,n){this._deckUnitInfo=t,this._super(t.mainDeckCharacterInfo,e,i),this.deckUnitSupportThumbnail.initDeckUnitThumbnail(t.supportDeckCharacterInfo,e,i),this._initMainCharacter(t.mainDeckCharacterInfo.characterModel),this._initBattleParameterView(t),this._callbackToSelectBtnMove=a,this._callbackToSelectBtnMoveEnd=n},_getEmptyText:function(){return"\u30e6\u30cb\u30c3\u30c8\n\u9078\u629e"},_initMainCharacter:function(t){this.emptyLabel.string="",t?(a.addSprite(this.characterImageSprite,a.getFileNameCharacterMainDeck(t.getCharacterId())),a.addSprite(this.rarityFrameSprite,a.getFileNameRarityFrame(t.getRarity()))):this.emptyLabel.string="\u30e6\u30cb\u30c3\u30c8\n\u9078\u629e"},_initBattleParameterView:function(t){var e=t.mainDeckCharacterInfo.characterModel;if(e){var i=e.getTotalHp(),a=e.getTotalAtk(),n=e.getTotalDef(),o=e.getTotalPower(),r=t.supportDeckCharacterInfo.characterModel;r&&(i+=Math.floor(r.getTotalHp()*l.SUPPORT_CHARA_PARAMETER_RATIO),a+=Math.floor(r.getTotalAtk()*l.SUPPORT_CHARA_PARAMETER_RATIO),n+=Math.floor(r.getTotalDef()*l.SUPPORT_CHARA_PARAMETER_RATIO),o+=Math.floor(r.getTotalPower()*l.SUPPORT_CHARA_PARAMETER_RATIO)),this.battleParameterView.initBattleParameterView(i,a,n,o)}},setNormalDisplay:function(){this.switchDisplayTargetNode.active=!0,this.selectBtn.setTouchEnable(!0),this._deckUnitEquipmentListNode&&(this._deckUnitEquipmentListNode.active=!1)},setEquipmentDisplay:function(){this._deckUnitEquipmentListNode||(this._deckUnitEquipmentListNode=this.deckUnitEquipmentListView.node),this.deckUnitEquipmentListView.initDeckUnitEquipmentListView(this._deckUnitInfo,this._callbackToCreateThumbnailNode.bind(this)),this._deckUnitEquipmentListNode.active=!0,this.switchDisplayTargetNode.active=!1,this.selectBtn.setTouchEnable(!1)},_callbackToCreateThumbnailNode:function(t,e,i){var n;e?(n=e.getComponent("EquipmentMatrixThumbnail")).resetEquipmentMatrixThumbnail():n=cc.instantiate(a.getResource(c.EQUIPMENT_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("EquipmentMatrixThumbnail");var o=t.equipmentModel;o?(n.switchEmptyNodeActive(!1),n.initEquipmentMatrixThumbnail(o.getEquipmentId(),o.getAttribute(),o.getRarity(),void 0)):n.switchEmptyNodeActive(!0);this._deckUnitInfo.deckType,this._deckUnitInfo.deckId;return n.setCallbackToThumbnailBtn(void 0),e?void 0:n.node},setDeckPosition:function(t){this._deckUnitInfo.deckPosition=t},getDeckPosition:function(){return this._deckUnitInfo.deckPosition},setRecentPosition:function(t){this._recentPosition=t},getRecentPosition:function(){return this._recentPosition},getMainCharacterModel:function(){return this._deckUnitInfo.mainDeckCharacterInfo.characterModel},getSupportCharacterModel:function(){return this._deckUnitInfo.supportDeckCharacterInfo.characterModel},_dragStart:function(t){this._bChangePos=!0,this._recentPosition=this.node.getPosition();var e=this.node.parent.convertToNodeSpace(t.getLocation()).x;this.node.setPosition(cc.v2(e,10)),this.node.zIndex=1,this.startBlink()},_onTouchMoveSelectBtn:function(t){if(this.getMainCharacterModel()&&(this._bChangePos||this._dragStart(t),this._bChangePos)){var e=this.node.parent.convertToNodeSpace(t.getLocation()).x;e>440?e=440:e<-440&&(e=-440),this.node.setPosition(cc.v2(e,10)),this._callbackToSelectBtnMove&&this._callbackToSelectBtnMove(this,t)}},_onTouchMoveEndSelectBtn:function(t){this.getMainCharacterModel()&&this._callbackToSelectBtnMoveEnd&&this._callbackToSelectBtnMoveEnd(this,function(){this.stopBlink(),this._bChangePos&&this.node.setPosition(this._recentPosition),this._bChangePos=!1,this.node.zIndex=0}.bind(this))},_createBlinkAction:function(){var t=cc.fadeTo(1,100).easing(cc.easeSineOut()),e=cc.fadeOut(1).easing(cc.easeSineIn()),i=cc.sequence(t,e);return cc.repeatForever(i)},startBlink:function(){this.blinkNode.stopAllActions(),this.blinkNode.runAction(this._createBlinkAction())},stopBlink:function(){this.blinkNode.stopAllActions(),this.blinkNode.opacity=0}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",DeckUnitEquipmentListView:"DeckUnitEquipmentListView",DeckUnitSupportThumbnail:"DeckUnitSupportThumbnail",DeckUnitThumbnailBase:"DeckUnitThumbnailBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],DeckUnitWithGaugeSimpleThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"5d084rKEKpFg5koYv3ivPmk","DeckUnitWithGaugeSimpleThumbnail");var a=t("CharacterConst"),n=t("DeckUnitSimpleThumbnail");cc.Class({extends:n,properties:{hpGaugeProgressBar:cc.ProgressBar,spGaugeProgressBar:cc.ProgressBar,grayNode:cc.Node},_characterStatus:null,initDeckUnitThumbnail:function(t,e,i,a){this._characterStatus=a,this._super(t,e,i)},_initBattleParameter:function(t){var e=t.mainDeckCharacterInfo.characterModel;if(e){var i=e.getTotalPower(),n=e.getTotalHp(),o=t.supportDeckCharacterInfo.characterModel;o&&(i+=Math.floor(o.getTotalPower()*a.SUPPORT_CHARA_PARAMETER_RATIO),n+=Math.floor(o.getTotalHp()*a.SUPPORT_CHARA_PARAMETER_RATIO)),this.totalPowerLabel.string=""+i,this._setStatusGauge(this._characterStatus,n)}},_setStatusGauge:function(t,e){this._setGrayActive(!1);var i=1,a=1;t&&(i=t.hp/e,a=t.skillGauge/100,0===t.hp&&this._setGrayActive(!0)),this.hpGaugeProgressBar.progress=i,this.spGaugeProgressBar.progress=a},_setGrayActive:function(t){this.grayNode.active=t}});cc._RF.pop()},{CharacterConst:"CharacterConst",DeckUnitSimpleThumbnail:"DeckUnitSimpleThumbnail"}],DeckUtils:[function(t,e,i){"use strict";cc._RF.push(e,"a8007WrMulJpJAcHBqHZ4xn","DeckUtils");var a=t("Singleton"),n=(t("GameConst"),t("DeckConst")),o=t("CharacterConst");function r(t){switch(t){case n.DECK_TYPE.QUEST:return n.DECK_COUNT_MAX.QUEST;case n.DECK_TYPE.PVP:return n.DECK_COUNT_MAX.PVP;case n.DECK_TYPE.EXPEDITION:return n.DECK_COUNT_MAX.EXPEDITION;case n.DECK_TYPE.TOWER:return n.DECK_COUNT_MAX.TOWER}return 0}function s(t,e){var i,o=[],s=r(e);switch(e){case n.DECK_TYPE.TOWER:i=a.dao[a.USER].getMaxTowerDeck();break;default:i=s}for(var c=0;c<s;c+=1){var l=c<i,u=parseInt(c+1),h={isReleased:l,deckType:e,deckId:u,deck:t[u]};o.push(h)}return o}function c(){return l(a.dao[a.USER_CHARACTER],a.dao[a.USER_DECK])}function l(t,e){var i={},a={};for(var o in t)a[t[o].getCharacterCd()]=t[o];for(var r in e){var s=e[r];switch(s.getDeckType()){case n.DECK_TYPE.EXPEDITION:break;default:i[s.getDeckType()]||(i[s.getDeckType()]={}),i[s.getDeckType()][s.getDeckId()]||(i[s.getDeckType()][s.getDeckId()]={},Object.defineProperty(i[s.getDeckType()][s.getDeckId()],"getTotalPower",{value:function(){return u(this)},configurable:!1,enumerable:!1})),i[s.getDeckType()][s.getDeckId()][s.getPosition()]||(i[s.getDeckType()][s.getDeckId()][s.getPosition()]={}),i[s.getDeckType()][s.getDeckId()][s.getPosition()][s.getRoleType()]||(i[s.getDeckType()][s.getDeckId()][s.getPosition()][s.getRoleType()]={}),i[s.getDeckType()][s.getDeckId()][s.getPosition()][s.getRoleType()]=a[s.getCharacterCd()]}}return i}function u(t){var e=0,i=0;for(var a in t)t[a][n.ROLE_TYPE.MAIN]&&(e+=t[a][n.ROLE_TYPE.MAIN].getTotalStatus()),t[a][n.ROLE_TYPE.SUPPORT]&&(i+=Math.floor(t[a][n.ROLE_TYPE.SUPPORT].getTotalStatus()*o.SUPPORT_CHARA_PARAMETER_RATIO));return e+i}function h(t){return a.dao[a.USER_DECK].find(function(e){return e.getCharacterCd()===t})}function d(t,e,i,a,n){return{deckType:t,deckId:e,deckPosition:i,roleType:a,characterModel:n}}e.exports={convertDeckTypeToDeckCountMax:r,getDeckArrayByDeckTypes:function(t){for(var e=c(),i=[],a=0;a<t.length;a+=1){var n=t[a];e[n]||(e[n]={}),Array.prototype.push.apply(i,s(e[n],n))}return i},createDeckMap:c,createDeckMapByModels:l,getDeckTotalPower:u,isDeckUnit:function(t){for(var e=a.dao[a.USER_DECK],i=0;i<e.length;i+=1)if(e[i].getCharacterCd()===t)return!0;return!1},getDeckModelByCharacterCd:h,getDeckModelByDeckType:function(t,e){return a.dao[a.USER_DECK].find(function(i){return i.getCharacterCd()===t&&i.getDeckType()===e})},getDeckOrganizedText:function(t){var e=h(t);if(!e)return"";switch(e.getDeckType()){case n.DECK_TYPE.QUEST:return"\u7b2c"+e.getDeckId()+"\u30d1\u30fc\u30c6\u30a3\n\u7de8\u6210\u4e2d";case n.DECK_TYPE.PVP:return"\u30a2\u30ea\u30fc\u30ca\n\u7de8\u6210\u4e2d";case n.DECK_TYPE.TOWER:return"\u7b2c"+e.getDeckId()+"\u30bf\u30ef\u30fc\n\u7de8\u6210\u4e2d"}return""},createDeckName:function(t,e){switch(t){case n.DECK_TYPE.PVP:return"\u30a2\u30ea\u30fc\u30ca"+e;case n.DECK_TYPE.TOWER:return"\u30bf\u30ef\u30fc"+e;default:return"\u901a\u5e38"+e}},createDeckCharacterModelMapByDeckType:function(t){var e=a.dao[a.USER_DECK],i={};for(var n in e){var o=e[n];o.getDeckType()===t&&(i[o.getCharacterModel().getCharacterCd()]=o)}return i},createDeckCharacterInfo:d,createDeckUnitInfo:function(t,e,i,a,o){return{deckType:t,deckId:e,deckPosition:i,mainDeckCharacterInfo:d(t,e,i,n.ROLE_TYPE.MAIN,a),supportDeckCharacterInfo:d(t,e,i,n.ROLE_TYPE.SUPPORT,o)}}},cc._RF.pop()},{CharacterConst:"CharacterConst",DeckConst:"DeckConst",GameConst:"GameConst",Singleton:"Singleton"}],DeckViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"89171PwtNFKhYxejK4Of0kD","DeckViewSetting");var a=t("DeckRootUtils");e.exports={DECK_SETTING:{DeckSelectSubRoot:{open:a.openDeckSelectSubRoot,close:a.closeDeckSelectSubRoot},DeckCharacterSelectSubRoot:{open:a.openDeckCharacterSelectSubRoot,close:a.closeDeckCharacterSelectSubRoot}}},cc._RF.pop()},{DeckRootUtils:"DeckRootUtils"}],DeckWithGaugeTabSimpleView:[function(t,e,i){"use strict";cc._RF.push(e,"8fa55KRAO1AGoLUCNWICbFM","DeckWithGaugeTabSimpleView");var a=t("DeckTabSimpleView");cc.Class({extends:a,properties:{},initDeckWithGaugeTabSimpleView:function(t,e,i,a,n,o,r){this._initDeckTabViewBase(t,e,i,a,n,o,r)},_initDeckTabViewBase:function(t,e,i,a,n,o,r){this._root=t,this.windowNode.zIndex=0,this.setDeckArray(e);var s=this._createDeckTabButtons(e,n);this.initVariableTabViewBase(t,s),this.deckUnitListView.initDeckUnitListView(this._root,o,r),this._iCurrentTab=this.getTabIndexByDeckId(i,a),this._setDeckUnitMap(this.getCurrentTab()),this._initArrowButtons()}}),cc._RF.pop()},{DeckTabSimpleView:"DeckTabSimpleView"}],DevelopmentUtils:[function(t,e,i){"use strict";cc._RF.push(e,"7d275xapsZFy5N9t9Ox6XR8","DevelopmentUtils");var a=t("PopupUtils"),n=(t("SceneConst"),cc.Enum({}));function o(t){var e;for(var i in e=t||cc.director.getScene().name,n)if(e===n[i])return!0;return!1}function r(){var t=new cc.Node("developmentText").addComponent(cc.Label);t.string="\u958b\u767a\u4e2d",t.fontSize=20,t.lineHeight=35,t.horizontalAlign=cc.Label.HorizontalAlign.CENTER,t.verticalAlign=cc.Label.VerticalAlign.CENTER,t.node.color=cc.color(255,0,0),t.node.setAnchorPoint(0,1);var e=t.node.addComponent(cc.LabelOutline);return e.width=5,e.color=cc.color(255,255,255),t}function s(){a.openSimpleMessageWindow("\u958b\u767a\u4e2d")}e.exports={checkDevelopmentScene:o,showDevelopmentScene:function(t){var e=o(void 0);if(e){var i=new cc.Node("development").addComponent(cc.Label);i.string="\u958b\u767a\u4e2d\u3067\u3059",i.fontSize=50,i.lineHeight=75,i.horizontalAlign=cc.Label.HorizontalAlign.CENTER,i.verticalAlign=cc.Label.VerticalAlign.CENTER,i.node.color=cc.color(255,0,0),i.node.setAnchorPoint(.5,.5),i.node.setPosition(0,0);var a=i.node.addComponent(cc.LabelOutline);return a.width=5,a.color=cc.color(255,255,255),cc.director.getScene().getChildByName("Canvas").addChild(i.node),e}return t(),e},setButtonDevelopmentText:function(t,e,i,a,n){if(o(t)){var s=r(),c=-e.node.width/2+i,l=e.node.height/2+a;s.node.setPosition(c,l),e.node.addChild(s.node)}else n()},getDevelopmentLabel:r,setDevelopmentPopupEvent:function(t){t.setTapEvent(function(){s()})},openDevelopmentPopup:s},cc._RF.pop()},{PopupUtils:"PopupUtils",SceneConst:"SceneConst"}],DmmAndroidJsToJava:[function(t,e,i){"use strict";cc._RF.push(e,"a3037PG5mdFXKygIhth1JZL","DmmAndroidJsToJava");var a=t("Singleton"),n=t("SingletonConst"),o=t("ErrorCode");e.exports={getDmmAndroidLoginInfo:function(t){var e=a[n.ENVIRONMENT];if(e.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID){var i=jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","getDmmAndroidLoginInfo","()Ljava/lang/String;");return""==i?a[n.ERROR_MANAGER].throwError(o.TYPE_ERROR):t(JSON.parse(i))}return t(null)},getDmmAndroidResourceVersion:function(t){var e=a[n.ENVIRONMENT];if(e.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID){var i=jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","getDmmMakeRequest","(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;",e.getApiHost()+"/"+e.getApiPrefix()+"auth/getDmmAndroidResourceVersion",JSON.stringify({forcePost:"1"}));return""==i?a[n.ERROR_MANAGER].throwError(o.TYPE_ERROR):t(JSON.parse(i))}return t(null)},getDmmAndroidRequestToken:function(t){var e=a[n.ENVIRONMENT];if(e.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID){var i=jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","getDmmMakeRequest","(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;",e.getApiHost()+"/"+e.getApiPrefix()+"auth/getDmmAndroidRequestToken",JSON.stringify({forcePost:"1"}));return""==i?a[n.ERROR_MANAGER].throwError(o.TYPE_ERROR):t(JSON.parse(i))}return t(null)},requestDmmAndroidPayment:function(t,e,i){var r=a[n.ENVIRONMENT];if(r.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID){var s=jsb.reflection.callStaticMethod(r.getAndroidDomain()+"NativeMethod","requestDmmAndroidPayment","(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;",t,JSON.stringify(e));return""==s?a[n.ERROR_MANAGER].throwError(o.TYPE_ERROR):i(JSON.parse(s))}return i(null)},openDmmAndroidPayment:function(){var t=a[n.ENVIRONMENT];t.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod(t.getAndroidDomain()+"NativeMethod","openDmmAndroidPayment","()V")},dmpSpend:function(t){var e=a[n.ENVIRONMENT];e.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","dmpSpend","(I)V",_.toInteger(t))},requestUserTextData:function(t,e){var i=a[n.ENVIRONMENT];if(i.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID){var r=jsb.reflection.callStaticMethod(i.getAndroidDomain()+"NativeMethod","requestUserTextData","(Ljava/lang/String;)Ljava/lang/String;",t);return""==r?a[n.ERROR_MANAGER].throwError(o.TYPE_ERROR):e(JSON.parse(r))}return e(null)},updateUserTextData:function(t,e,i){var r=a[n.ENVIRONMENT];if(r.isDmmPlatform()&&cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID){var s=jsb.reflection.callStaticMethod(r.getAndroidDomain()+"NativeMethod","updateUserTextData","(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;",t,e);return""==s?a[n.ERROR_MANAGER].throwError(o.TYPE_ERROR):i(JSON.parse(s))}return i(null)}},cc._RF.pop()},{ErrorCode:"ErrorCode",Singleton:"Singleton",SingletonConst:"SingletonConst"}],DmmModel:[function(t,e,i){"use strict";cc._RF.push(e,"9c893aNi05FBLO9HiLevKdG","DmmModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSkuId:function(){if(this._isKeyFieldAvailable("skuId"))return this._data.skuId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skuId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getIconName:function(){if(this._isKeyFieldAvailable("iconName"))return this._data.iconName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: iconName")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getPrice:function(){if(this._isKeyFieldAvailable("price"))return this._data.price;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: price")},getPurchaseType:function(){if(this._isKeyFieldAvailable("purchaseType"))return this._data.purchaseType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: purchaseType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],DownManifestManager:[function(t,e,i){"use strict";cc._RF.push(e,"e71981kNU9BT6i5EmmzYwZV","DownManifestManager");var a=t("FileLoaderConsts"),n=t("Singleton"),o=t("SingletonConst"),r=t("CommonUtils"),s=t("LocalDataConst"),c=t("GameConst"),l=(t("MemoryManager"),t("TimeUtils")),u=cc.Class({properties:{_serverDownManifest:null,_serverManifestKeys:null,downloader:null,_curDownLoadTime:0,_maxDownLoadTime:0},statics:{instance:null},ctor:function(){u.instance=this,this._maxDownLoadTime=2},checkNewVersion:function(t){n[o.ENVIRONMENT].getPlainDynamicFileFlg()?t(!1):this.loadDownloadVersion(function(e,i){e?t(e,null):this.compareVersion(i,function(e){t(null,e)})}.bind(this))},compareVersion:function(t,e){this.getManifestVersion(function(i){for(var a=t.split("."),n=i.split("."),o=0;o<a.length;++o){var r=parseInt(a[o]),s=parseInt(n[o]||0);if(r!==s)return void e(r-s)}n.length<a.length?e(!0):e(!1)})},loadDownloadVersion:function(e){var i,r="",l=n.localData[s.RES_QUALITY];if(cc.sys.isNative){switch(l){case c.RESOURCE_QUALITY.LOW:r=a.DOWNLOAD_GAME_ANDROID+a.DOWNLOAD_GAME_LD+"version.manifest",i=a.DOWNLOAD_GAME_ANDROID+"ld_version.manifest";break;case c.RESOURCE_QUALITY.HIGH:r=a.DOWNLOAD_GAME_ANDROID+a.DOWNLOAD_GAME_HD+"version.manifest",i=a.DOWNLOAD_GAME_ANDROID+"hd_version.manifest"}var u=jsb.fileUtils.getWritablePath()+i;cc.loader.release(u);var h=n[o.ENVIRONMENT].getDynamicResourceUrl()+r;this.downloader||(this.downloader=new jsb.Downloader({countOfMaxProcessingTasks:1,timeoutInSeconds:5,tempFileNameSuffix:".tmp"})),this.downloader.createDownloadFileTask(h,u),this.downloader.setOnTaskProgress(function(t,e,i,a){cc.log("setOnTaskProgress..."+e)}),this.downloader.setOnFileTaskSuccess(function(t){cc.log("loadDownLoadMainfest version success... "+u),cc.loader.load(u,function(t,i){var a=JSON.parse(i);e(null,a.version)})}),this.downloader.setOnTaskError(function(i,a,o,r){-1===r.indexOf(c.SPACE_NOT_ENOUGH_ERR1)&&-1===r.indexOf(c.SPACE_NOT_ENOUGH_ERR2)?(cc.log("loadDownLoadMainfest version failed... "),e("error",null)):(cc.log("loadDownloadVersion:"+n.localData[s.IS_CAPACITY_FULL]),n.localData[s.IS_CAPACITY_FULL]||(n.localData[s.IS_CAPACITY_FULL]=!0,window.setIntervalId&&(clearInterval(window.setIntervalId),n.localData[s.NOW_DATETIME]=null),t("PopupUtils").openSystemPopup("\u78ba\u8a8d","\u5bb9\u91cf\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093","",!1,function(){cc.game.end()})),e(r,null,u))})}},loadDownLoadMainfest:function(e,i){if(n[o.ENVIRONMENT].getPlainDynamicFileFlg())return e?e():void 0;var u="",h="",d=r.loadLocalStorage(s.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,s.LOCAL_STORAGE_GET_TYPE.INTEGER);if(n.localData[s.RES_QUALITY]=d,i&&(d=i),cc.sys.isNative)switch(d){case c.RESOURCE_QUALITY.LOW:u=a.DOWNLOAD_GAME_ANDROID+a.DOWNLOAD_GAME_LD+"download_res_hash.manifest",h=a.DOWNLOAD_GAME_ANDROID+"ld_download_res_hash.manifest";break;case c.RESOURCE_QUALITY.HIGH:u=a.DOWNLOAD_GAME_ANDROID+a.DOWNLOAD_GAME_HD+"download_res_hash.manifest",h=a.DOWNLOAD_GAME_ANDROID+"hd_download_res_hash.manifest"}else switch(d){case c.RESOURCE_QUALITY.LOW:u="download_game_ld/download_res_hash.manifest";break;case c.RESOURCE_QUALITY.HIGH:u="download_game_hd/download_res_hash.manifest"}var p=this,m=n[o.ENVIRONMENT].getDynamicResourceUrl()+u+"?deeponetime="+l.getNowDateTime();if(cc.log("loadDownLoadMainfest from: "+m),cc.sys.isNative){var _=jsb.fileUtils.getWritablePath()+h;jsb.fileUtils.isFileExist(_)&&(jsb.fileUtils.removeFile(_),cc.loader.release()),this.downloader||(this.downloader=new jsb.Downloader({countOfMaxProcessingTasks:1,timeoutInSeconds:5,tempFileNameSuffix:".tmp"})),this.downloader.createDownloadFileTask(m,_),this.downloader.setOnTaskProgress(function(t,e,i,a){cc.log("setOnTaskProgress..."+e)}),this.downloader.setOnFileTaskSuccess(function(t){cc.log("loadDownLoadMainfest success... "+_),cc.loader.load(_,function(t,e){p._serverDownManifest=JSON.parse(e),p._serverManifestKeys=Object.keys(p._serverDownManifest.assets)}),e(null)});p=this;this.downloader.setOnTaskError(function(i,a,o,r){(cc.log("loadDownLoadMainfest failed... "),-1===r.indexOf(c.SPACE_NOT_ENOUGH_ERR1)&&-1===r.indexOf(c.SPACE_NOT_ENOUGH_ERR2))?p._curDownLoadTime<p._maxDownLoadTime?(p._curDownLoadTime++,p.downloader.createDownloadFileTask(m,_)):(p._curDownLoadTime=0,p.downloader=null,e("\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057")):(cc.log("loadDownLoadMainfest:"+n.localData[s.IS_CAPACITY_FULL]),n.localData[s.IS_CAPACITY_FULL]||(n.localData[s.IS_CAPACITY_FULL]=!0,window.setIntervalId&&(clearInterval(window.setIntervalId),n.localData[s.NOW_DATETIME]=null),t("PopupUtils").openSystemPopup("\u78ba\u8a8d","\u5bb9\u91cf\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093","",!1,function(){cc.game.end()})),e(r,null,_))})}else cc.loader.load(m,function(t,i){t?(e("\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057"),cc.log("Failed to load: "+m)):(p._serverDownManifest=JSON.parse(i),p._serverManifestKeys=Object.keys(p._serverDownManifest.assets),e(null))})},getServerFileMd5ByName:function(t){if(null==this._serverDownManifest)return"";var e=this._serverDownManifest.assets[t];return e?e.md5:(cc.log("cannot find md5:"+t),null)},getServerFileIsEtcByName:function(t){if(null==this._serverDownManifest)return"";var e=this._serverDownManifest.assets[t];return e?e.etc:(cc.log("cannot find etctype:"+t),null)},getFileInfo:function(t){var e=t.replace("download/","");return this._serverDownManifest.assets[e]},getFileScaleData:function(t){return null==this._serverDownManifest||n[o.ENVIRONMENT].getDebugResource()||!t.startsWith("download/")?1:((t=t.replace("download/","")).endsWith(".jpg")||t.endsWith(".png")||(null==this.getFileInfo(t+".png")?t+=".jpg":t+=".png"),void 0!=this._serverDownManifest.assets[t]&&void 0!=this._serverDownManifest.assets[t].s?this._serverDownManifest.assets[t].s:1)},getNeedCapacity:function(){var t,e,i,a;return this._serverDownManifest.zipcapacity?(t=this._serverDownManifest.zipcapacity.ld_zip,e=this._serverDownManifest.unzipcapacity.ld_unzip,i=this._serverDownManifest.zipcapacity.hd_zip,a=this._serverDownManifest.unzipcapacity.hd_unzip):(t=0,e=0,i=0,a=0),[parseFloat(t)+parseFloat(e),parseFloat(i)+parseFloat(a)]},getManifestKeys:function(){return this._serverManifestKeys},getManifestVersion:function(t){var e;switch(n.localData[s.RES_QUALITY]){case c.RESOURCE_QUALITY.LOW:e=jsb.fileUtils.getWritablePath()+a.DOWNLOAD_GAME_ANDROID+a.DOWNLOAD_GAME_LD+"version.manifest";break;case c.RESOURCE_QUALITY.HIGH:e=jsb.fileUtils.getWritablePath()+a.DOWNLOAD_GAME_ANDROID+a.DOWNLOAD_GAME_HD+"version.manifest"}cc.loader.release(e),cc.loader.load(e,function(e,i){if(e)t("");else{var a=JSON.parse(i);t(a.version)}})}});e.exports=u,cc._RF.pop()},{CommonUtils:"CommonUtils",FileLoaderConsts:"FileLoaderConsts",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",PopupUtils:"PopupUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",TimeUtils:"TimeUtils"}],DummyLogin:[function(t,e,i){"use strict";cc._RF.push(e,"da069sAdzlP57gi9XH3y8OY","DummyLogin");var a=t("Singleton"),n=t("SingletonConst"),o=t("CommonUtils");cc.Class({extends:cc.Component,properties:{loginBtn:cc.Button,idEditBox:cc.EditBox},onLoad:function(){var t=a[n.ENVIRONMENT],e=o.loadLocalStorage("id",t.getAuthDummyUserId());this.idEditBox.string=e,this._setLoginButton()},_setLoginButton:function(){this.loginBtn.setTapEvent(this._loginButtonEvent.bind(this))},_loginButtonEvent:function(){this.idEditBox.string&&(a[n.OAUTH].set("user_id",this.idEditBox.string),o.saveLocalStorage("id",this.idEditBox.string),a[n.ENVIRONMENT].getDebugTestScene()?cc.director.loadScene("TestScene.fire"):cc.director.loadScene("TitleScene.fire"))}}),cc._RF.pop()},{CommonUtils:"CommonUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EffectEnd:[function(t,e,i){"use strict";cc._RF.push(e,"d62f1e6PbVEYo11guLn7AZw","EffectEnd"),cc.Class({extends:cc.Component,properties:{endAction:{default:null}},reuse:function(t){this.pool=t},doEffectEnd:function(){void 0!==this.pool&&this.pool.put(this.node),null!=this.endAction&&this.endAction()}}),cc._RF.pop()},{}],EnemyMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"31dccCaCWhDG76MGYECBct8","EnemyMatrixThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("MatrixThumbnailBase");t("CharacterSortConst"),cc.Class({extends:o,properties:{mainImageSprite:cc.Sprite,attributeImageSprite:cc.Sprite,attributeFrameImageSprite:cc.Sprite,levelLabel:cc.Label,hpProgressParentNode:cc.Node,hpProgressBar:cc.ProgressBar,skillProgressParentNode:cc.Node,skillProgressBar:cc.ProgressBar,thumbnailBtn:a},initEnemyMatrixThumbnail:function(t,e,i){n.addSprite(this.mainImageSprite,t),n.addSprite(this.attributeImageSprite,e),n.addSprite(this.attributeFrameImageSprite,i)},setSelectedNodeActive:function(t){},setSelectedOrder:function(t){},setActive:function(t){},setProtected:function(t){},getProtected:function(){return!1},setCallbackToThumbnailBtn:function(t){this.thumbnailBtn.setTapEvent(t,"")},setLevel:function(t){this.levelLabel.node.parent.active=!0,this.levelLabel.string=""+t},setHpProgress:function(t,e){this.hpProgressParentNode.active=!0,this.hpProgressBar.progress=t/e},setSkillProgress:function(t,e){this.skillProgressParentNode.active=!0,this.skillProgressBar.progress=t/e},switchActivePrgoress:function(t){this.hpProgressParentNode.active=t,this.skillProgressParentNode.active=t}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CommonButton:"CommonButton",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils"}],EntryRaidBattleListView:[function(t,e,i){"use strict";cc._RF.push(e,"af8402AdwJCF6eY5Wd9wt8j","EntryRaidBattleListView");var a=t("RaidBattleListViewBase"),n=t("Singleton"),o=t("PopupUtils");t("TimeUtils"),t("LocalDataConst"),cc.Class({extends:a,_getBattleSessions:function(t){return t.getUnfinishedRaidBattleSessions()},_addThumbnailParameter:function(t,e){var i=this._root.getRaidBattleMasterMap()[e.stageId];return t.setCostPoint(i.getBattlePoint()),t.switchActiveRescueBand(e.discovererId!==n.dao[n.USER].getUserCd()),t.setCallbackToInfoBtn(function(){this._root.requestGetDetail(e.sessionId)}.bind(this)),t.setCallbackToRescueBtn(function(){this._root.openRaidSendRescueConfirmPopup(this._root.getNextRescueEnableDate(e.sessionId),this._root.getRaidBattleTypeMasterMap()[i.getRaidBattleType()],function(t){this._root.requestSendRescue(e.sessionId,this._callbackToSendRescue.bind(this,t))}.bind(this))}.bind(this)),t.setCallbackToStartBtn(function(){this._root.pushRaidBattleStartConfirmSubRoot(e.stageId,e,"RaidScene",{RaidBattleSelectSubRoot:{tabIndex:1}})}.bind(this)),t},_callbackToSendRescue:function(t){o.openCommonPopupOk("\u6551\u63f4\u4f9d\u983c\u5b8c\u4e86","\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u6551\u63f4\u4f9d\u983c\u3092\u9001\u308a\u307e\u3057\u305f\u3002")},_getEmptyText:function(){return"\u53c2\u52a0\u4e2d\u306e\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002"}});cc._RF.pop()},{LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",RaidBattleListViewBase:"RaidBattleListViewBase",Singleton:"Singleton",TimeUtils:"TimeUtils"}],EnumTypes:[function(t,e,i){"use strict";cc._RF.push(e,"41c21OJEo9OvJ/0/0PJmtPR","EnumTypes");var a=cc.Enum({IDLE:0,ATTACK:1,USE_SKILL:2,ABILITY_ATTACK:3}),n=cc.Enum({NO_DATA:0,ATTACK:101,BUFF_MIN_VALUE:200,BUFF_MAX_VALUE:300,HEAL:301,HP_DRAIN:401,CANCEL_BUFF:501,CANCEL_DEBUFF:502,RESURRECTION:601,INCREASE_SKILL_RATE:701,IMMORTAL_ACTION:801}),o=cc.Enum({ENEMY_ONE:1,ENEMY_ALL:2,OUR_SIDE_ONE:3,OUR_SIDE_ALL:4,ME:5,OUR_SIDE_DEAD_ONE:10,OUR_SIDE_DEAD_ALL:11,OUR_SIDE_BY_ELEMENT:12,OUR_SIDE_BY_CHARA_TYPE:13,ENEMY_SIDE_DEAD_ONE:20,ENEMY_SIDE_DEAD_ALL:21,ENEMY_SIDE_BY_ELEMENT:22,ENEMY_SIDE_BY_CHARA_TYPE:23,ME_BY_ELEMENT:32,ME_BY_CHARA_TYPE:33}),r=cc.Enum({FIX:1,PER_BY_ATK:2,PER_BY_DEF:3,PER_BY_DAMAGE:4,CHANGE_TO:5,MIN_MAX_LIMIT_RANDOM:6,CONDITION_BURN:7}),s=cc.Enum({STORY_QUEST:1,EVENT:2,TOWER:3,RAID:4,ARENA_PVP:10}),c=cc.Enum({QUEST_START_BATTLE:1,FROM_BATTLE_TRANSACTION:2,FROM_CONTINUE:3}),l=cc.Enum({PLAYER_UNIT:1,MONSTER:2}),u=cc.Enum({NOT_END:0,PLAYER_WIN:1,ENEMY_WIN:2,DRAW:3}),h=cc.Enum({NO_DATA:0,ATTACK_ANI_END:1,FROM_ATTACK_START_TIME:2}),d=cc.Enum({NO_DATA:0,SPINE_ANI_SHOW:1,FULL_SPINE_EFFECT_BY_SPINE_EVENT:4}),p=cc.Enum({WAVE_START:1,GENERAL_TURN_START:2,GENERAL_TURN_END:3,MY_TURN_START:4,MY_TURN_END:5,ENEMY_TURN_START:6,ENEMY_TURN_END:7,BOSS_WAVE_START:8,ON_ATTACK:11,ON_NORMAL_ATTACK:12,ON_SKILL_ATTACK:13,ON_UNISON_ATTACK:14,ON_ATTACK_OUR_UNIT:15,ON_KILL_ENEMY:16,ON_SKILL:17,ON_SKILL_OUR_UNIT:18,ON_SKILL_ENEMY_UNIT:19,ON_ATTACK_CRITICAL:20,ON_ATTACK_BY_ELEMENT:21,ON_ATTACK_ON_MAX_SKILL_RATE:22,ON_ATTACK_MORE_THAN_HP:31,ON_ATTACK_LESS_THAN_HP:32,ON_ATTACK_BAD_CONDITION:33,ON_LESS_THAN_HP:42,ON_CATCH_BAD_CONDITION_ENEMY:43,IN_BATTLE_ALL_TIMES:100,BE_ATTACK_BEFORE_TIMING:411,BE_ATTACK_AFTER_TIMING:412,BE_ATTACKED_OUR_UNIT:413,BE_ATTACKED_BY_ELEMENT:421,BE_ATTACKED_ON_MAX_SKILL_RATE:422,BE_ATTACKED_BY_ALL_TARGET_ATTACK:423,BE_ATTACKED_COUNTER_IN_TURN:424,BE_ATTACKED_MORE_THAN_HP:431,BE_ATTACKED_LESS_THAN_HP:432,BE_ATTACKED_MORTAL:433,BE_KILLED_OUR_UNIT:441,BE_CATCH_BAD_CONDITION:442}),m=cc.Enum({NO_CONDITION:0,NO_CONDITION_1:1,RANDOM_PERCENT:2,BASE_ON_CASTER_CHANCE:3,RANDOM_PERCENT_AND_BASE_ON_CASTER_CHANCE:4,SPECIFY_ATTRIBUTE:10,SPECIFY_CHARA_TYPE:11,SPECIFY_BUFF:12,BUFF_TARGET_TYPE_ALL:101,BUFF_TARGET_TYPE_ONE_BY_FROM_RECENT:102,BUFF_TARGET_TYPE_PARTICULAR:103,ON_BUFF_END_INVOKE:201}),_=cc.Enum({ATK_CHANGE:201,DEF_CHANGE:202,HP_CHANGE:203,LUK_CHANGE:204,ATK_CHANGE_STOCKABEL:205,DEF_CHANGE_STOCKABLE:206,HP_CHANGE_STOCKABLE:207,LUK_CHANGE_STOCKABLE:208,LOW_HP_ATK_UP:211,LOW_HP_DEF_UP:212,ATK_CHANGE_BY_ELEMENT:213,PLUS_UNISON_ATTACK_CHANCE:221,PLUS_CAST_BAD_CONDITION_CHANCE:222,RECOVERY_POWER_UP:223,RECOVERY_LIMIT_UP:224,CRITICAL_CHANCE_UP:225,PLUS_SKILL_RATE:226,IMMUNE_BAD_CONDITION:227,PREVENT_BAD_CONDITION:228,PLUS_UNISON_ATTACK_POWER:229,DAMAGE_CHANGE:231,DAMAGE_CHANGE_BY_ELEMENT:232,DAMAGE_CHANGE_BY_CHARA_TYPE:233,DAMAGE_BARRIER:234,IMMORTAL:235,SKILL_DAMAGE_UP:236,NORMAL_ATTACK_COUNTER:241,NORMAL_ATTACK_EVASION:242,NORMAL_ATTACK_HP_DRAIN:243,ALL_COUNTER:244,REGENERATION:250,AUTO_PLUS_SKILL_RATE:251,ADJUST_HATE_WEIGHT_FROM_ENEMY:252,ITEM_DROP_RATE_UP:253,GOLD_DROP_RATE_UP:254,GET_EXP_RATE_UP:255,POISON:281,PARALYSIS:282,STUN:283,SLEEP:284,CONFUSE:285,DARKNESS_ON_NORMAL_ATTK:286,DARKNESS_ON_ALL:287,ADD_DEBUFF_TURN:288,ZOMBIE:289,CURSE:290,DEATH_SENTENCE:291,SEAL_SKILL:292,SEAL_PLUS_SKILL_RATE:293,HP_CHANGE_FOR_EQUIPMENT:801,ATK_CHANGE_FOR_EQUIPMENT:802,DEF_CHANGE_FOR_EQUIPMENT:803,INVOKED_ABILITY:901,INVOKED_EQUIPMENT:902}),g=cc.Enum({MIN:281,MAX:293}),C=cc.Enum({ONCE:0,WAVE_START:1,GENERAL_TURN_START:2,GENERAL_TURN_END:3,MY_TURN_START:4,MY_TURN_END:5,ENEMY_TURN_START:6,ENEMY_TURN_END:7,ON_INVOKE:301,BOTH_ON_INVOKE_GENERAL_TURN_END:304,BE_ATTACKED:401,BE_ATTACKED_CHECK_CHANCE:402,DAMAGE_COUNT:501,STATIC_BUFF:900,NO_END:999}),f=cc.Enum({NORMAL:1,ABILITY:2,SKILL:3,EQUIPMENT:4}),E=cc.Enum({NO_CONDITION:0,LIMIT_INVOKE_TIMES:1}),T=cc.Enum({NONE:0,WEAK:1,RESIST:2}),S=cc.Enum({NORMAL_ATTACK:1,SKILL:2}),R=cc.Enum({END:0,CONTINUE:1});e.exports={CommandType:a,ActionType:n,TargetRange:o,PowerType:r,BattleType:s,BattleLoadType:c,UnitType:l,GameResult:u,NormalAttackShowType:h,SkillEffectShowType:d,TriggerType:p,EffectConditionType:m,BuffType:_,BadConditionBuffRange:g,BuffEndType:C,BuffClass:f,TriggerConditionType:E,DamageType:T,EnemyActionType:S,EnemyActionContinue:R},cc._RF.pop()},{}],EnvironmentConst:[function(t,e,i){"use strict";cc._RF.push(e,"118d68FZxZChJJZ3/qLcpzG","EnvironmentConst"),e.exports={AUTH:"auth",AUTH_TYPE:"type",AUTH_TYPE_VALUES:{DEVELOP:"develop",DMM:"dmm"},AUTH_CONSUMER_KEY:"consumerKey",AUTH_CONSUMER_SECRET:"consumerSecret",AUTH_DUMMY_USER_ID:"userId",API:"api",API_HOST:"host",API_PREFIX:"prefix",API_TIMEOUT:"timeout"},cc._RF.pop()},{}],Environment:[function(t,e,i){"use strict";cc._RF.push(e,"c2fd3dawh5OrbFWqMV8B/xg","Environment"),cc.Class({_data:void 0,ctor:function(){this._data=arguments[0]},set:function(t,e){this._data[t]=e},getAuthType:function(){return this._data.auth.type},getAuthConsumerKey:function(){return this._data.auth.consumerKey},getAuthConsumerSecret:function(){return this._data.auth.consumerSecret},getAuthSignatureMethod:function(){return this._data.auth.signatureMethod},getAuthDummyUserId:function(){return this._data.auth.userId},getApiHost:function(){return this._data.api.host},getApiPrefix:function(){return this._data.api.prefix},getApiTimeout:function(){return this._data.api.timeout},isDmmPlatform:function(){return"dmm"===this.getAuthType()},getAndroidDomain:function(){return this._data.android.domain},getStaticServerHost:function(){return this._data.static.host},getDebugQueue:function(){if(this._data.debug)return this._data.debug.queue},getDebugAdult:function(){if(this._data.debug)return this._data.debug.adult},getDebugContentsRelease:function(){if(this._data.debug)return this._data.debug.contentsRelease},getDebugTestScene:function(){if(this._data.debug)return this._data.debug.testScene},getDebugTutorialSkip:function(){if(this._data.debug)return this._data.debug.tutorialSkip},getDebugEnctypt:function(){return!!this._data.debug&&this._data.debug.noEncrypt},getDebugResource:function(){return!!this._data.debug&&this._data.debug.noResourceHash},getDmmAppId:function(){return this._data.dmmAppId?this._data.dmmAppId:0},getAdultFlg:function(){return this._data.adultFlg},getNVersionAppIds:function(){return this._data.nVersionAppIds},getRVersion:function(){return!this.getNVersionAppIds().some(function(t){return this.getDmmAppId()===t}.bind(this))},getDynamicResourceUrl:function(){if(this._data.dynamic)return this._data.dynamic.resourceUrl},getPaymentImageUrl:function(){return this._data.payment.imageUrl},getNewsUrl:function(){return this._data.newsUrl},getResourceVersion:function(){return this._data.resourceVersion},getDebugInspection:function(){if(this._data.debug)return this._data.debug.userNameInspection},getHotUpdateSkip:function(){if(this._data.debug)return this._data.debug.jumpHotUpdate},getPlainDynamicFileFlg:function(){return!!this._data.debug&&(!!this._data.debug.plainDynamicFile&&this._data.debug.plainDynamicFile)}}),cc._RF.pop()},{}],EquipmentAbilityListView:[function(t,e,i){"use strict";cc._RF.push(e,"d20e3ctHDxHhoVk0aogbOn6","EquipmentAbilityListView");var a=t("ItemConst"),n=t("PopupUtils"),o=t("EquipmentUtils"),r=t("GameConst"),s=t("ListViewBase");cc.Class({extends:s,properties:{},initListView:function(t){this.resetListView(),this._setListContent([t.getEquipmentEffectInfoMap()[a.EQUIPMENT_BOOST_TYPE.NORMAL][t.getRarity()],t.getEquipmentEffectInfoMap()[a.EQUIPMENT_BOOST_TYPE.BOOST][t.getRarity()]],t.getRarity()),this.node.active=!0,this.thumbnailParentNode.active=!0},_setListContent:function(t,e){for(var i=0;i<t.length;i+=1)this._addThumbnail(t[i],i+1,e)},_addThumbnail:function(t,e,i){if(t){var a=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentSelectSideEquipmentAbilityThumbnail");a.setAbilityOrder(e),t.releaseRarity<=i?(a.switchActive(!0),a.setAbilityDescription(r.RICH_TEXT_TAG_STATE.NORMAL.START+t.effectTextArray.join("\n")+r.RICH_TEXT_TAG_STATE.NORMAL.END)):(a.switchActive(!1),a.setAbilityDescription(r.RICH_TEXT_TAG_STATE.GRAY.START+t.effectTextArray.join("\n")+r.RICH_TEXT_TAG_STATE.GRAY.END),a.setThumbnailTapEvent(function(){n.openSimpleMessageWindow("\u30a2\u30d3\u30ea\u30c6\u30a3"+e+"\u306f["+o.convertRarityText(t.releaseRarity)+"]\u3067\u958b\u653e\u3055\u308c\u307e\u3059\u3002")})),this.thumbnailParentNode.addChild(a.node)}}});cc._RF.pop()},{EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ListViewBase:"ListViewBase",PopupUtils:"PopupUtils"}],EquipmentAlertPopup:[function(t,e,i){"use strict";cc._RF.push(e,"b7b29H5kZhLF6QBOYEk7ZQM","EquipmentAlertPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("EquipmentConst");cc.Class({extends:a,properties:{fortifyNode:cc.Node,limitNode:cc.Node,sellNode:cc.Node,fortifyBtn:n,limitBtn:n,sellBtn:n,cancelBtn:n},onLoad:function(){this.fortifyBtn.setTapEvent(this._onTapExecuteBtn.bind(this),n.SE_NAME.FORTIFY),this.limitBtn.setTapEvent(this._onTapExecuteBtn.bind(this),n.SE_NAME.FORTIFY),this.sellBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},_materialModelArray:null,_callbackToExecuteBtn:null,openEquipmentAlertPopup:function(t,e,i){switch(this._materialModelArray=t,this._callbackToExecuteBtn=i,this.fortifyNode.active=!1,this.limitNode.active=!1,this.sellNode.active=!1,e){case o.ALERT_TYPE.FORTIFY:this.fortifyNode.active=!0;break;case o.ALERT_TYPE.LIMIT:this.limitNode.active=!0;break;case o.ALERT_TYPE.SELL:this.sellNode.active=!0}this.open()},_onTapExecuteBtn:function(){this.close(),this._callbackToExecuteBtn(this._materialModelArray)},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentConst:"EquipmentConst",PopupBase:"PopupBase"}],EquipmentAllRemoveConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"14733JDCFdLZ6yhCWCRyEny","EquipmentAllRemoveConfirmPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{executeBtn:n,cancelBtn:n,targetToggleContainer:cc.ToggleContainer},_deckType:0,_deckId:0,_deckUnitMap:null,_callbackToExecute:null,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this))},openEquipmentAllRemoveConfirmPopup:function(t,e,i,a){this._deckType=t,this._deckId=e,this._deckUnitMap=i,this._callbackToExecute=a,this.open()},_getSelectedIndex:function(){for(var t=0,e=0;e<this.targetToggleContainer.toggleItems.length;e+=1){if(this.targetToggleContainer.toggleItems[e].isChecked){t=e;break}}return t},_onTapExecuteBtn:function(){this._callbackToExecute&&this._callbackToExecute(this._getSelectedIndex(),this._deckType,this._deckId,this._deckUnitMap,this.close.bind(this))},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],EquipmentApis:[function(t,e,i){"use strict";cc._RF.push(e,"24a28HbJvZLeaaE9BpkplSr","EquipmentApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.EQUIPMENT_GET_MASTER_DATA,path:"equipment/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.EQUIPMENT_GET_USER_DATA,path:"equipment/getUserData",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_SELL,path:"equipment/sell",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_SELL_WAREHOUSE,path:"equipment/sellWarehouse",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_FORTIFY,path:"equipment/fortify",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_FORTIFY_WAREHOUSE,path:"equipment/fortifyWarehouse",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_EXCEED_LIMIT,path:"equipment/exceedLimit",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_EXCEED_LIMIT_WAREHOUSE,path:"equipment/exceedLimitWarehouse",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_CREATE,path:"equipment/create",method:"POST"}),a.RESTClient.graft({name:n.EQUIPMENT_CHANGE_PROTECT,path:"equipment/changeProtect",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],EquipmentConst:[function(t,e,i){"use strict";cc._RF.push(e,"ed79aNJZ8JOAJr8BoXIRcdY","EquipmentConst");cc.Class({statics:{PROMOTE_TYPE:cc.Enum({STATUS:0,FORTIFY:1,EXCEED_LIMIT:2}),EQUIPMENT_TYPE:{NORMAL:1,FORTIFY_MATERIAL:3,EXCEED_LIMIT_MATERIAL:4},RARITY:cc.Enum({N:1,R:2,SR:3,SSR:4}),RARITY_MAX:4,EFFECT_TYPE:cc.Enum({HP_RATE:801,ATK_RATE:802,DEF_RATE:803}),BOOST_RATE:1.2,ALERT_TYPE:cc.Enum({FORTIFY:1,LIMIT:2,SELL:3}),EQUIPMENT_BUFF_POWER_MAX_PERCENTAGE:100,SAME_ATTRIBUTE_MATERIAL_BONUS_RATE:1.2,EQUIPMENT_FORTIFY_GRANT_RATE:1.2}});cc._RF.pop()},{}],EquipmentController:[function(t,e,i){"use strict";cc._RF.push(e,"12189sKiXJIdqN/yUKEO9au","EquipmentController");var a=t("BattleData"),n=(t("CommonFunction"),t("EnumTypes")),o=t("GameEffectQueue").GameEffectQueue,r=t("GameEffectQueue").EffectQuery,s=t("GameEffectQueue").EffectData,c=t("BattleFunction"),l=t("Buff"),u=cc.Class({properties:{},initAllTimeBuff:function(t){if(t.unitType==n.UnitType.PLAYER_UNIT&&a.battleLoadType!==n.BattleLoadType.FROM_BATTLE_TRANSACTION){var e=new Array;e=e.concat(t.deckUnit.mainChara.myEquipmentList),this._addBuffFromSubAction(t,e,!1)}},_addBuffFromSubAction:function(t,e,i){var o=a.GM.actionController;for(var r in e){var s=e[r];if(s.getTriggerType()==n.TriggerType.IN_BATTLE_ALL_TIMES){var l=s.getBattleActionList();if(!l)continue;for(var u in l){var h,d,p=l[u];h=c.getUnitList(t.isEnemy),d=c.getUnitList(!t.isEnemy);var m=c.getTargetList(p.getTargetType(),p,t,h,d,null,i);for(var _ in m){var g=m[_],C=100*s.getEquipmentId()+10*r+p.getIndex();o.addBuffFromSubAction(p,t,g,C,n.BuffClass.EQUIPMENT)}}}}},checkEquipmentTriggerInAction:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!1;if(t.unitType!=n.UnitType.PLAYER_UNIT)return!1;var o=new Array;for(var r in o=o.concat(t.deckUnit.mainChara.myEquipmentList)){var s=o[r];if(this.checkTiming(s,e,t,i)){this.excuteEquipmentEffect(t,s,r,!1)&&(a=!0)}}return a},checkEquipmentTriggerInActionBySupport:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!1;if(t.unitType!=n.UnitType.PLAYER_UNIT)return!1;var o=new Array;for(var r in t.deckUnit.supportChara&&(o=o.concat(t.deckUnit.supportChara.myEquipmentList)),o){var s=o[r];if(this.checkTiming(s,e,t,i)){this.excuteEquipmentEffect(t,s,r,!0)&&(a=!0)}}return a},excuteEquipmentEffect:function(t,e,i,u){var h=a.GM.actionController,d=!1;if(null==e||void 0==e)return!1;var p=e.getBattleActionList();if(!p)return!1;for(var m=0;m<p.length;m++){var _=p[m];if(h.checkInvoke(_)){d=!0;var g,C,f=new r;g=c.getUnitList(t.isEnemy),C=c.getUnitList(!t.isEnemy);var E=c.getTargetList(_.getTargetType(),_,t,g,C);for(var T in E){var S=E[T],R=(new r,new Map),A=new o,b=100*e.getEquipmentId()+10*i+_.getIndex();h.excuteSubAction(A,_,t,S,b,n.BuffClass.EQUIPMENT,u),(R=new Map).effectQueue=A,f.addAction(new s(R,h.playEffectqueue.bind(h)))}h.addQueryToWaitQueryList(f)}}if(d){var M=e.getTriggerConditionType();if(M&&M==n.TriggerConditionType.LIMIT_INVOKE_TIMES){var v=e.getEquipmentId(),P=new l(t,v,n.BuffType.INVOKED_EQUIPMENT,0,0,n.BuffClass.EQUIPMENT,n.BuffEndType.NO_END,0);t.addBuff(P)}}return!!d},checkTiming:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=t.getTriggerType(),s=t.getTriggerValue(),c=t.getTriggerConditionType();if(r==e){if(c&&c==n.TriggerConditionType.LIMIT_INVOKE_TIMES){var l=Number(t.getTriggerConditionValue());if(l=0===l?1:l,i.buffList.filter(function(e){return e.type===n.BuffType.INVOKED_EQUIPMENT&&e.buffId===t.getEquipmentId()}).length>=l)return!1}if(e==n.TriggerType.WAVE_START){var u=Number(s);return-1==u||u==a.cur_waveCount+1}if(e==n.TriggerType.ON_ATTACK_BY_ELEMENT){var h=Number(s);if(!o)return!1;for(var d in o){if(h==o[d].getAttribute())return!0}return!1}if(e==n.TriggerType.BE_ATTACKED_BY_ELEMENT){var p=Number(s);if(!o)return!1;for(var d in o){if(p==o[d].getAttribute())return!0}return!1}if(e==n.TriggerType.BE_ATTACKED_COUNTER_IN_TURN)return Number(s)==i.beAttackCounterInTurn;if(e==n.TriggerType.ON_ATTACK_MORE_THAN_HP||e==n.TriggerType.ON_ATTACK_LESS_THAN_HP||e==n.TriggerType.BE_ATTACKED_MORE_THAN_HP||e==n.TriggerType.BE_ATTACKED_LESS_THAN_HP||e==n.TriggerType.ON_LESS_THAN_HP){var m=Number(s),_=i.getCurHp()/i.getMaxHp()*100;return e==n.TriggerType.ON_ATTACK_MORE_THAN_HP||e==n.TriggerType.BE_ATTACKED_MORE_THAN_HP?_>=m:_<=m}if(e==n.TriggerType.ON_ATTACK_BAD_CONDITION){var g=Number(s);if(!o)return!1;for(var d in o){if(o[d].hasBuff(g))return!0}return!1}return!0}return!1}});e.exports=u,cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",Buff:"Buff",CommonFunction:"CommonFunction",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue"}],EquipmentDetailExceedLimitListView:[function(t,e,i){"use strict";cc._RF.push(e,"0f261X2I0xLVbrblb76GUSE","EquipmentDetailExceedLimitListView");var a=t("ItemConst"),n=t("EquipmentConst"),o=t("EquipmentDetailViewBase");cc.Class({extends:o,properties:{arrowPrefab:cc.Prefab,thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node},_setContent:function(t){this.thumbnailParentNode.destroyAllChildren();for(var e=1;e<=n.RARITY.SSR;e+=1){var i=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentDetailExceedLimitThumbnail");if(i.initEquipmentDetailExceedLimitThumbnail(t.getEquipmentMainMaster(),e,t.getEquipmentEffectInfoMap()[a.EQUIPMENT_BOOST_TYPE.NORMAL][e],t.getEquipmentEffectInfoMap()[a.EQUIPMENT_BOOST_TYPE.BOOST][e]),this.thumbnailParentNode.addChild(i.node),e<n.RARITY.SSR){var o=cc.instantiate(this.arrowPrefab);this.thumbnailParentNode.addChild(o)}}},getHeaderText:function(){return"\u88c5\u5099\u60c5\u5831"}});cc._RF.pop()},{EquipmentConst:"EquipmentConst",EquipmentDetailViewBase:"EquipmentDetailViewBase",ItemConst:"ItemConst"}],EquipmentDetailExceedLimitThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"e155biOzehPr6ETLmkg+m+p","EquipmentDetailExceedLimitThumbnail");var a=t("EquipmentUtils"),n=t("GameConst"),o=t("CommonUtils"),r=t("BattleParameterView");cc.Class({extends:cc.Component,properties:{matrixThumbnailPrefab:cc.Prefab,matrixThumbnailParentNode:cc.Node,abilityThumbnailPrefab:cc.Prefab,abilityThumbnailParentNode:cc.Node,totalPowerLabel:cc.Label,battleParameterView:r},_matrixThumbnail:null,initEquipmentDetailExceedLimitThumbnail:function(t,e,i,a){this._drawMatrixThumbnail(t,e),this._drawBattlePrameterView(t,e),this.abilityThumbnailParentNode.destroyAllChildren(),this._drawAbility(1,i,e),this._drawAbility(2,a,e)},_drawMatrixThumbnail:function(t,e){this._matrixThumbnail||(this._matrixThumbnail=cc.instantiate(this.matrixThumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.matrixThumbnailParentNode.addChild(this._matrixThumbnail.node)),this._matrixThumbnail.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),e,void 0),this._matrixThumbnail.setParameter("Lv.",a.getEquipmentMaxLevel(t,e))},_drawBattlePrameterView:function(t,e){var i=a.createEquipmentBattleParameter(t,e,a.getEquipmentMaxLevel(t,e));this.totalPowerLabel.string=o.convertToCommaDelimited(i.hp+i.atk+i.def),this.battleParameterView.initBattleParameterView(i.hp,i.atk,i.def)},_drawAbility:function(t,e,i){if(!(e.releaseRarity>i)){var a=cc.instantiate(this.abilityThumbnailPrefab).getComponent("EquipmentSelectSideEquipmentAbilityThumbnail");a.setAbilityOrder(t),a.setAbilityDescription(n.RICH_TEXT_TAG_STATE.BLACK.START+e.effectTextArray.join("")+n.RICH_TEXT_TAG_STATE.BLACK.END),this.abilityThumbnailParentNode.addChild(a.node)}}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst"}],EquipmentDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"aadb5qEINVC34oqhTaQTf4z","EquipmentDetailPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("EquipmentDetailTabView");cc.Class({extends:a,properties:{detailTabView:o,okBtn:n},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openEquipmentDetailPopup:function(t,e){this.open(function(){this.detailTabView.initEquipmentDetailTabView(t,e)}.bind(this))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentDetailTabView:"EquipmentDetailTabView",PopupBase:"PopupBase"}],EquipmentDetailStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"5fe4fL7/TxGu6JKlhlHb9yF","EquipmentDetailStatusView");var a=t("CommonUtils"),n=(t("EquipmentUtils"),t("ItemConst"),t("GameConst"),t("EquipmentConst"),t("EquipmentDetailViewBase")),o=t("BattleParameterView");cc.Class({extends:n,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,abilityThambnailPrefab:cc.Prefab,abilityParentNode:cc.Node,totalPowerLabel:cc.Label,battleParameterView:o,addTotalPowerLabel:cc.Label,addParameterView:o},_thumbnail:null,_setContent:function(t,e){this._drawEquipmentThumbnail(t),this._drawBattleParameter(t,e),this._drawAbility(t)},_drawEquipmentThumbnail:function(t){this._thumbnail||(this._thumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.thumbnailParentNode.addChild(this._thumbnail.node)),this._thumbnail.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),this._thumbnail.setProtected(t.getIsProtect()),this._thumbnail.setParameter("Lv.",t.getLevel())},_drawBattleParameter:function(t,e){var i=t.getHp(),n=t.getAtk(),o=t.getDef();if(e){var r=[e],s=e.characterModel,c=s.getEquipmentStatus(r),l=s.getEquipmentEffect(s.getHp()+c.hp,s.getAtk()+c.atk,s.getDef()+c.def,r),u=c.hp+l.hp-i,h=c.atk+l.atk-n,d=c.def+l.def-o;i=c.hp+l.hp,n=c.atk+l.atk,o=c.def+l.def,this.addTotalPowerLabel.string="(+"+a.convertToCommaDelimited(u+h+d)+")",this.addTotalPowerLabel.node.active=!0,this.addParameterView.initBattleParameterView(u,h,d),this.addParameterView.setPrefix("(+"),this.addParameterView.setSuffix(")"),this.addParameterView.setActive(!0)}this.totalPowerLabel.string=a.convertToCommaDelimited(i+n+o),this.battleParameterView.initBattleParameterView(i,n,o)},_drawAbility:function(t){this.abilityParentNode.destroyAllChildren(),this._drawAbilityThumbnail(1,t.getEffectTextForNormal(),t.getEquipmentEffectMaster().length>0),this._drawAbilityThumbnail(2,t.getEffectTextForBoost(),t.getEquipmentEffectMaster().length>0)},_drawAbilityThumbnail:function(t,e,i){var a=cc.instantiate(this.abilityThambnailPrefab).getComponent("EquipmentSelectSideEquipmentAbilityThumbnail");a.setAbilityOrder(t),a.setAbilityDescription(e),a.switchActiveGrayOutNode(!i),this.abilityParentNode.addChild(a.node)},getHeaderText:function(){return"\u88c5\u5099\u8a73\u7d30"}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentDetailViewBase:"EquipmentDetailViewBase",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst"}],EquipmentDetailTabView:[function(t,e,i){"use strict";cc._RF.push(e,"d38a6zEU0JAMrIDvJaStuKU","EquipmentDetailTabView");var a=t("TabViewBase"),n=t("EquipmentDetailViewBase");cc.Class({extends:a,properties:{headerLabel:cc.Label,equipmentNameLabel:cc.Label,equipmentDetailViewArray:[n]},initEquipmentDetailTabView:function(t,e){this._equipmentModel=t,this._characterEquipmentInfo=e,this.equipmentNameLabel.string=t.getName(),this.initTabViewBase(),this._setCurrentTab(0),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetListView(),this.equipmentDetailViewArray[t].initEquipmentDetailStatusView(this._equipmentModel,this._characterEquipmentInfo),this.headerLabel.string=this.equipmentDetailViewArray[t].getHeaderText()},_resetListView:function(){for(var t in this.equipmentDetailViewArray)this.equipmentDetailViewArray[t].node.active=!1}});cc._RF.pop()},{EquipmentDetailViewBase:"EquipmentDetailViewBase",TabViewBase:"TabViewBase"}],EquipmentDetailViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"e25904MGT9EL6uO5PlYaf7L","EquipmentDetailViewBase");cc.Class({extends:cc.Component,properties:{},initEquipmentDetailStatusView:function(t,e){this.node.active=!0,this._setContent(t,e)},_setContent:function(t){cc.error("_setContent(equipmentModel)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},getHeaderText:function(){return cc.error("getHeaderText()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),""}});cc._RF.pop()},{}],EquipmentEffectModel:[function(t,e,i){"use strict";cc._RF.push(e,"5564a97RYZDGJ6q8yKr3sis","EquipmentEffectModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEquipmentId:function(){if(this._isKeyFieldAvailable("equipmentId"))return this._data.equipmentId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentId")},getBoostType:function(){if(this._isKeyFieldAvailable("boostType"))return this._data.boostType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: boostType")},getRarity:function(){if(this._isKeyFieldAvailable("rarity"))return this._data.rarity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rarity")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getActionType:function(){if(this._isKeyFieldAvailable("actionType"))return this._data.actionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: actionType")},getEffectType:function(){if(this._isKeyFieldAvailable("effectType"))return this._data.effectType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectType")},getEffectValue:function(){if(this._isKeyFieldAvailable("effectValue"))return this._data.effectValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectValue")},getEffectLimit:function(){if(this._isKeyFieldAvailable("effectLimit"))return this._data.effectLimit;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectLimit")},getEffectConditionType:function(){if(this._isKeyFieldAvailable("effectConditionType"))return this._data.effectConditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectConditionType")},getEffectConditionValue:function(){if(this._isKeyFieldAvailable("effectConditionValue"))return this._data.effectConditionValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectConditionValue")},getOccurrenceRate:function(){if(this._isKeyFieldAvailable("occurrenceRate"))return this._data.occurrenceRate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: occurrenceRate")},getSuccessRate:function(){if(this._isKeyFieldAvailable("successRate"))return this._data.successRate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: successRate")},getTargetType:function(){if(this._isKeyFieldAvailable("targetType"))return this._data.targetType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetType")},getTargetValue:function(){if(this._isKeyFieldAvailable("targetValue"))return this._data.targetValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: targetValue")},getEndType:function(){if(this._isKeyFieldAvailable("endType"))return this._data.endType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endType")},getEndValue:function(){if(this._isKeyFieldAvailable("endValue"))return this._data.endValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endValue")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EquipmentExceedLimitAbilityThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"b27a5mVazBPnJNjigSRkE/x","EquipmentExceedLimitAbilityThumbnail");var a=t("GameConst"),n=t("ViewUtils");t("ItemConst"),cc.Class({extends:cc.Component,properties:{beforeAbilityNode:cc.Node,afterAbilityNode:cc.Node,beforeInactiveNode:cc.Node,afterInactiveNode:cc.Node,beforeAbilityOrderName:cc.Label,afterAbilityOrderName:cc.Label,beforeAbilityDescriptionRichText:cc.RichText,afterAbilityDescriptionRichText:cc.RichText},setAbilityActive:function(t,e){this.beforeAbilityNode.active=t,this.afterAbilityNode.active=e},setAbilityOrder:function(t){this.beforeAbilityOrderName.string="\u30a2\u30d3\u30ea\u30c6\u30a3"+t,this.afterAbilityOrderName.string="\u30a2\u30d3\u30ea\u30c6\u30a3"+t},setAbilityDescription:function(t,e,i,o){this.beforeInactiveNode.active=!1,t[e][i].releaseRarity>i?(this.beforeInactiveNode.active=!0,this.beforeAbilityOrderName.node.color=a.COLOR_STATE.GRAY,this.beforeAbilityDescriptionRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+a.RICH_TEXT_TAG_STATE.GRAY.START+t[e][i].effectTextArray.join("")+a.RICH_TEXT_TAG_STATE.GRAY.END):this.beforeAbilityDescriptionRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+a.RICH_TEXT_TAG_STATE.NORMAL.START+t[e][i].effectTextArray.join("")+a.RICH_TEXT_TAG_STATE.NORMAL.END,this.afterInactiveNode.active=!1,t[e][o].releaseRarity>o?(this.afterInactiveNode.active=!0,this.afterAbilityOrderName.node.color=a.COLOR_STATE.GRAY,this.afterAbilityDescriptionRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+a.RICH_TEXT_TAG_STATE.GRAY.START+t[e][o].effectTextArray.join("")+a.RICH_TEXT_TAG_STATE.GRAY.END):t[e][i].releaseRarity>i?this.afterAbilityDescriptionRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+a.RICH_TEXT_TAG_STATE.PLUS.START+t[e][o].effectTextArray.join("")+a.RICH_TEXT_TAG_STATE.PLUS.END:this.afterAbilityDescriptionRichText.string=n.insertDiffTag("\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+t[e][i].effectTextArray.join(""),"\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+t[e][o].effectTextArray.join(""),a.RICH_TEXT_TAG_STATE.WHITE.START,a.RICH_TEXT_TAG_STATE.WHITE.END,a.RICH_TEXT_TAG_STATE.PLUS.START,a.RICH_TEXT_TAG_STATE.PLUS.END)}});cc._RF.pop()},{GameConst:"GameConst",ItemConst:"ItemConst",ViewUtils:"ViewUtils"}],EquipmentExceedLimitCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"5ac243DVw1PO70T1F+5OewN","EquipmentExceedLimitCompletePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("ViewUtils"),s=t("UnlockEffectUtils"),c=t("BattleParameterView"),l=t("GameConst");cc.Class({extends:a,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,beforeRaritySprite:cc.Sprite,afterRaritySprite:cc.Sprite,beforeBattleParameterView:c,afterBattleParameterView:c,abilityThumbnailPrefab:cc.Prefab,abilityThumbnailParentNode:cc.Node,resultAnimation:cc.Animation,okBtn:n},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},_callbackToOkBtn:null,openEquipmentExceedLimitCompletePopup:function(t,e,i){this.setCloseCallBack(i),this._initThumbnail(e),this._drawRarityImage(t,e),this.beforeBattleParameterView.initBattleParameterView(t.getHp(),t.getAtk(),t.getDef(),t.getHp()+t.getAtk()+t.getDef()),this.afterBattleParameterView.initBattleParameterView(e.getHp(),e.getAtk(),e.getDef(),e.getHp()+e.getAtk()+e.getDef()),this.afterBattleParameterView.setColor(r.getParamChangeColor(t.getHp(),e.getHp()),r.getParamChangeColor(t.getAtk(),e.getAtk()),r.getParamChangeColor(t.getDef(),e.getDef()),r.getParamChangeColor(t.getHp()+t.getAtk()+t.getDef(),e.getHp()+e.getAtk()+e.getDef())),this.afterBattleParameterView.playAnimation(),this.abilityThumbnailParentNode.active=!1,this.open(this._drawAbilityList.bind(this,t,e))},_initThumbnail:function(t){this.thumbnailParentNode.destroyAllChildren();var e=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail");this.thumbnailParentNode.addChild(e.node),e.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),e.setParameter("Lv.",1)},_drawRarityImage:function(t,e){o.addSprite(this.beforeRaritySprite,o.getFileNameRarityStrIcon(t.getRarity())),o.addSprite(this.afterRaritySprite,o.getFileNameRarityStrIcon(e.getRarity()))},_drawAbilityList:function(t,e){this.resultAnimation.play(),this.abilityThumbnailParentNode.destroyAllChildren(),this._drawAbilityThumbnail(1,t.getEffectTextForNormal().join(""),e.getEffectTextForNormal().join(""),e.getEquipmentEffectMaster().length>0,t.getEquipmentEffectMaster().length<=0&&e.getEquipmentEffectMaster().length>0),this._drawAbilityThumbnail(2,t.getEffectTextForBoost().join(""),e.getEffectTextForBoost().join(""),e.getEquipmentEffectMaster().length>0,t.getEquipmentEffectMaster().length<=0&&e.getEquipmentEffectMaster().length>0),this.abilityThumbnailParentNode.active=!0},_drawAbilityThumbnail:function(t,e,i,a,n){var o=cc.instantiate(this.abilityThumbnailPrefab).getComponent("EquipmentSelectSideEquipmentAbilityThumbnail");o.setAbilityOrder(t),o.switchActiveGrayOutNode(!a),n&&s.playUnLockEffectAnimationNormal(o.getLockIconNode(),function(){}),o.setAbilityDescription(r.insertDiffTag(e,i,l.RICH_TEXT_TAG_STATE.WHITE.START,l.RICH_TEXT_TAG_STATE.WHITE.END,l.RICH_TEXT_TAG_STATE.PLUS.START,l.RICH_TEXT_TAG_STATE.PLUS.END)),this.abilityThumbnailParentNode.addChild(o.node)},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonButton:"CommonButton",GameConst:"GameConst",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",UnlockEffectUtils:"UnlockEffectUtils",ViewUtils:"ViewUtils"}],EquipmentExceedLimitConfirmMaterialView:[function(t,e,i){"use strict";cc._RF.push(e,"3563cH+G5pCCq9wzKL2k+zS","EquipmentExceedLimitConfirmMaterialView");var a=t("EquipmentUtils"),n=t("CommonUtils"),o=t("ItemUtils"),r=t("GameConst");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailListNode:cc.Node,priceLabel:cc.Label,currentGoldLabel:cc.Label},initEquipmentExceedLimitConfirmMaterialView:function(t,e){this._initThumbnail(e);var i=a.calcExceedLimitPrice(t,e),s=o.getUserItemCount(r.ITEM_ID_GOLD);this.priceLabel.string=n.convertToCommaDelimited(i),this.currentGoldLabel.string=n.convertToCommaDelimited(s)},_initThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail");this.thumbnailListNode.addChild(e.node),e.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),e.setParameter("Lv.",t.getLevel())}});cc._RF.pop()},{CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemUtils:"ItemUtils"}],EquipmentExceedLimitConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"bbb6bXFQVZA5KJTvUNu1Wym","EquipmentExceedLimitConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("EquipmentExceedLimitDifferenceView"),r=t("EquipmentExceedLimitConfirmMaterialView");cc.Class({extends:a,properties:{exceedLimitDifferenceView:o,exceedLimitConfirmMaterialView:r,executeBtn:n,cancelBtn:n},onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},_callbackToExecuteBtn:null,openEquipmentExceedLimitConfirmPopup:function(t,e,i){this._callbackToExecuteBtn=i,this.exceedLimitDifferenceView.node.active=!1,this.exceedLimitConfirmMaterialView.node.active=!1,this.exceedLimitDifferenceView.initEquipmentExceedLimitReferenceView(t),this.exceedLimitConfirmMaterialView.initEquipmentExceedLimitConfirmMaterialView(t,e),this.open(function(){this.exceedLimitDifferenceView.node.active=!0,this.exceedLimitConfirmMaterialView.node.active=!0}.bind(this))},_onTapExecuteBtn:function(){this.close(),this._callbackToExecuteBtn(this._materialModelArray)},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentExceedLimitConfirmMaterialView:"EquipmentExceedLimitConfirmMaterialView",EquipmentExceedLimitDifferenceView:"EquipmentExceedLimitDifferenceView",PopupBase:"PopupBase"}],EquipmentExceedLimitDifferenceView:[function(t,e,i){"use strict";cc._RF.push(e,"64b42KR5aZLRZTvfVLGGNc4","EquipmentExceedLimitDifferenceView");t("ResourceUtils"),t("CommonUtils");var a=t("EquipmentUtils"),n=(t("GameConst"),t("ItemConst")),o=t("TotalBattleParameterView");cc.Class({extends:cc.Component,properties:{equipmentThumbnailPrefab:cc.Prefab,beforeThumbnailParentNode:cc.Node,afterThumbnailParentNode:cc.Node,beforeParameterView:o,afterParameterView:o,exceedLimitAbilityThumbnailParentNode:cc.Node,exceedLimitAbilityThumbnailPrefab:cc.Prefab},initEquipmentExceedLimitReferenceView:function(t){this._initEquipmentThumbnail(t),this._setParameter(t),this._drawAbilityList(t)},_initEquipmentThumbnail:function(t){var e=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");this.beforeThumbnailParentNode.addChild(e.node),e.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),e.setParameter("Lv.",t.getMaxLevel());var i=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");this.afterThumbnailParentNode.addChild(i.node),i.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity()+1,t),i.setParameter("Lv.",a.getEquipmentMaxLevel(t.getEquipmentMainMaster(),t.getRarity()+1))},_setParameter:function(t){var e=a.createEquipmentBattleParameter(t.getEquipmentMainMaster(),t.getRarity(),t.getMaxLevel());this.beforeParameterView.initBattleParameterView(e.hp,e.atk,e.def,e.hp+e.atk+e.def);var i=a.createEquipmentBattleParameter(t.getEquipmentMainMaster(),t.getRarity()+1,a.getEquipmentMaxLevel(t.getEquipmentMainMaster(),t.getRarity()+1));this.afterParameterView.initBattleParameterView(i.hp,i.atk,i.def,i.hp+i.atk+i.def)},_drawAbilityList:function(t){this.exceedLimitAbilityThumbnailParentNode.destroyAllChildren();var e=t.getEquipmentEffectInfoMap();this._drawAbilityThumbnail(1,e,n.EQUIPMENT_BOOST_TYPE.NORMAL,t.getRarity(),t.getRarity()+1),this._drawAbilityThumbnail(2,e,n.EQUIPMENT_BOOST_TYPE.BOOST,t.getRarity(),t.getRarity()+1)},_drawAbilityThumbnail:function(t,e,i,a,n){var o=cc.instantiate(this.exceedLimitAbilityThumbnailPrefab).getComponent("EquipmentExceedLimitAbilityThumbnail");this.exceedLimitAbilityThumbnailParentNode.addChild(o.node),o.setAbilityOrder(t),o.setAbilityDescription(e,i,a,n)}});cc._RF.pop()},{CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ResourceUtils:"ResourceUtils",TotalBattleParameterView:"TotalBattleParameterView"}],EquipmentExceedLimitMaterialSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"462a0EmlhVKA7gXHZut8N7f","EquipmentExceedLimitMaterialSelectListView");var a=t("Singleton"),n=t("CommonButton"),o=t("EquipmentUtils"),r=t("WarehouseUtils"),s=t("WarehouseConvertUtils"),c=t("CommonUtils"),l=t("ResourceUtils"),u=t("EquipmentMultipleSelectListWithSideViewBase"),h=t("MatrixMultipleSelectCountUpPageView"),d=t("WarehouseConst"),p=t("ResourceConst"),m=t("LocalDataConst"),g=t("GameConst");cc.Class({extends:u,properties:{dataTypeLabel:cc.Label,warehouseSwitchBtn:n,countUpMatrixMaterialPageView:h},onLoad:function(){this.warehouseSwitchBtn.setTapEvent(this._onTapWarehouseSwitchBtn.bind(this))},resetListView:function(){this._super(),this.node.active=!1,this.countUpMatrixMaterialPageView.node.active=!1},initListView:function(t){switch(this.node.active=!0,this._root=t,this._resetActiveListView(),t.materialDataType){case d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this._drawDataType(this._root.materialDataType),this.matrixPageView.content.active=!0,this.matrixPageView.node.active=!0,this._super(t);break;default:this.mainNode.active=!0,this.initWarehouseMaterialListView(t)}},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView("getEquipmentCd",o.getExceedLimitMaterialEquipmentModelArray(this._root.getTargetEquipmentModel()),a.dao.userBasicData.getEquipmentMaxCount(),[],this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToRedraw:function(t){this.matrixPageView.initMatrixPageView("getEquipmentCd",o.getExceedLimitMaterialEquipmentModelArray(this._root.getTargetEquipmentModel()),a.dao.userBasicData.getEquipmentMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)},_callbackToMaterialThumbnail:function(t){var e=this.matrixPageView.getCheckedModelArray().filter(function(e){return e.getEquipmentCd()!==t.getEquipmentCd()});this.matrixPageView.initMatrixPageView("getEquipmentCd",o.getExceedLimitMaterialEquipmentModelArray(this._root.getTargetEquipmentModel()),a.dao.userBasicData.getEquipmentMaxCount(),e,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(e)},_getCheckLimit:function(){return 1},_callbackToSideExecute:function(t){this._root.openEquipmentExceedLimitConfirmPopup(this._root.getTargetEquipmentModel(),t[0])},_onTapWarehouseSwitchBtn:function(){switch(this._toggleDataType(),this._resetActiveListView(),this._root.materialDataType){case d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this.initListView(this._root);break;case d.WAREHOUSE_STORAGE_TYPE.MATERIAL:this.initWarehouseMaterialListView(this._root)}},_toggleDataType:function(){switch(this._root.materialDataType){case d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this._root.materialDataType=d.WAREHOUSE_STORAGE_TYPE.MATERIAL;break;case d.WAREHOUSE_STORAGE_TYPE.MATERIAL:this._root.materialDataType=d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT}},_drawDataType:function(t){switch(t){case d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this.dataTypeLabel.string="\u88c5\u5099";break;case d.WAREHOUSE_STORAGE_TYPE.MATERIAL:this.dataTypeLabel.string="\u5009\u5eab"}},_resetActiveListView:function(){this._root.warehouseCountInfoArray=[],this.matrixPageView.node.active=!1,this.matrixPageView.content.active=!1,this.countUpMatrixMaterialPageView.node.active=!1},initWarehouseMaterialListView:function(t){this._drawDataType(t.materialDataType),this.countUpMatrixMaterialPageView.node.active=!0,this.countUpMatrixMaterialPageView.setCallBackToIsImageActive(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToThumbnail(this._callbackToWarehouseThumbnail.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopupForWarehouseMaterial.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToConvertSortText(r.convertSortTypeToTextForMaterial),this.countUpMatrixMaterialPageView.setCallBackToCreateSortConditions(r.createSortConditionsForEquipment),this.countUpMatrixMaterialPageView.setCallBackToCreateFilterConditions(r.createFilterConditionsForMaterial),this.countUpMatrixMaterialPageView.setSortParam(this._getCurrentSortTypeForWarehouseMaterial(),this._getCurrentSortOrderForWarehouseMaterial()),this.countUpMatrixMaterialPageView.setFilterCheckList(this._getCurrentFilterCheckListForWarehouseMaterial()),this.countUpMatrixMaterialPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilterForWarehouseMaterial.bind(this)),this.countUpMatrixMaterialPageView.initMatrixPageView("getEquipmentCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getEquipmentMaxCount(),[],this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.equipmentSelectSideView.initEquipmentSelectSideView(t,this._callbackToRedrawForWarehouse.bind(this),this._callbackToSideExecute.bind(this)),this.equipmentSelectSideView.setCallbackToResetBtn(this._callbackToSideResetBtnForWarehouseMaterial.bind(this)),this.equipmentSelectSideView.setCallbackToMaterialThumbnail(this._callbackToSideThumbnailForWarehouseMaterial.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView([])},_callbackToRedrawForWarehouse:function(t){var e=s.convertEquipmentsToWarehouseModelCountInfoArray(t,d.WAREHOUSE_STORAGE_TYPE.MATERIAL);this._root.warehouseCountInfoArray=e,this.countUpMatrixMaterialPageView.initMatrixPageView("getMaterialCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getEquipmentMaxCount(),e,this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)},_getWarehouseMaterialModelArray:function(){return r.getEquipmentExceedLimitMaterials(this._root.getTargetEquipmentModel(),d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT)},_callbackIsWarehouseThumbnailEnabled:function(t,e){return _.sumBy(e,function(t){return t.count})<this._getCheckLimit()},_callbackToCreateWarehouseMaterialThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("EquipmentMatrixThumbnail")).resetEquipmentMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),i.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),void 0),i.setParameter("x",t.getCount()),i.node},_callbackToWarehouseThumbnail:function(t,e){this._root.warehouseCountInfoArray=this.countUpMatrixMaterialPageView.getCountInfoArray(),this.equipmentSelectSideView.drawEquipmentSelectSideView(s.convertWarehouseModelCountInfoArrayToEquipments(this.countUpMatrixMaterialPageView.getCountInfoArray(),d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT))},_callbackToCreateSortFilterPopupForWarehouseMaterial:function(){return cc.instantiate(l.getResource(p.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_EQUIPMENT_WAREHOUSE)).getComponent("SortFilterPopup")},_getCurrentSortTypeForWarehouseMaterial:function(){return c.loadLocalStorage(m.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_EQUIPMENT,d.WAREHOUSE_STORAGE_SORT_TYPE.UPDATING,m.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrderForWarehouseMaterial:function(){return c.loadLocalStorage(m.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_EQUIPMENT,g.SORT_ORDER.ASC,m.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_getCurrentFilterCheckListForWarehouseMaterial:function(){return a.localData[m.FILTER.TEN.WAREHOUSE_STORAGE_EQUIPMENT]},_callbackToSortAndFilterForWarehouseMaterial:function(t,e,i){c.saveLocalStorage(m.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_EQUIPMENT,t),c.saveLocalStorage(m.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_EQUIPMENT,e)},_callbackToSideResetBtnForWarehouseMaterial:function(){this._root.warehouseCountInfoArray=[],this.countUpMatrixMaterialPageView.clearCountInfoArray(),this.countUpMatrixMaterialPageView.redraw(),this.equipmentSelectSideView.drawEquipmentSelectSideView([])},_callbackToSideThumbnailForWarehouseMaterial:function(t,e){e=_.filter(e,function(e){return e.getEquipmentCd()!==t.getEquipmentCd()}),this._setRecommendSelectMaterialsForWarehouseMaterial(e)},_setRecommendSelectMaterialsForWarehouseMaterial:function(t){var e=this.countUpMatrixMaterialPageView.getPageIndex(),i=s.convertEquipmentsToWarehouseModelCountInfoArray(t,d.WAREHOUSE_STORAGE_TYPE.EQUIPMENT);this._root.warehouseCountInfoArray=i,this.countUpMatrixMaterialPageView.initMatrixPageView("getEquipmentCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getEquipmentMaxCount(),i,this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.countUpMatrixMaterialPageView.redraw(),this.countUpMatrixMaterialPageView.switchPageContent(e),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentMultipleSelectListWithSideViewBase:"EquipmentMultipleSelectListWithSideViewBase",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MatrixMultipleSelectCountUpPageView:"MatrixMultipleSelectCountUpPageView",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",WarehouseConst:"WarehouseConst",WarehouseConvertUtils:"WarehouseConvertUtils",WarehouseUtils:"WarehouseUtils"}],EquipmentExceedLimitMaterialSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"dbbd3dH9nNKkJL63fa5wwRB","EquipmentExceedLimitMaterialSelectSideView");t("CommonUtils");var a=t("EquipmentUtils"),n=t("ItemUtils"),o=t("GameConst"),r=t("EquipmentConst"),s=t("EquipmentMultipleSelectSideViewBase"),c=t("EquipmentExceedLimitProgressView");cc.Class({extends:s,properties:{equipmentExceedLimitProgressView:c},initEquipmentSelectSideView:function(t,e,i){this._super(t,e,i),this.equipmentProgressView.drawEquipmentSimpleProgressView(this._root.getTargetEquipmentModel(),r.PROMOTE_TYPE.EXCEED_LIMIT),this.equipmentExceedLimitProgressView.initEquipmentExceedLimitProgressView(t.getTargetEquipmentModel())},drawEquipmentSelectSideView:function(t){this._super(t),this.equipmentExceedLimitProgressView.drawEquipmentExceedLimitProgressView(t),this.equipmentProgressView.drawEquipmentProgressView(r.PROMOTE_TYPE.EXCEED_LIMIT,t)},_getPriceTextColor:function(t){if(t[0]){var e=a.calcExceedLimitPrice(this._root.getTargetEquipmentModel(),t[0]);if(n.getUserItemCount(o.ITEM_ID_GOLD)<e)return o.COLOR_STATE.MINUS}return o.COLOR_STATE.NORMAL},_getPriceText:function(t){return t[0]?a.calcExceedLimitPrice(this._root.getTargetEquipmentModel(),t[0]):0}});cc._RF.pop()},{CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentExceedLimitProgressView:"EquipmentExceedLimitProgressView",EquipmentMultipleSelectSideViewBase:"EquipmentMultipleSelectSideViewBase",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemUtils:"ItemUtils"}],EquipmentExceedLimitModel:[function(t,e,i){"use strict";cc._RF.push(e,"24a66c37tROG5289OKgFL4c","EquipmentExceedLimitModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getExceedLimitType:function(){if(this._isKeyFieldAvailable("exceedLimitType"))return this._data.exceedLimitType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimitType")},getRarity:function(){if(this._isKeyFieldAvailable("rarity"))return this._data.rarity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rarity")},getMaterialRarity:function(){if(this._isKeyFieldAvailable("materialRarity"))return this._data.materialRarity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialRarity")},getExceedLimitPrice:function(){if(this._isKeyFieldAvailable("exceedLimitPrice"))return this._data.exceedLimitPrice;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimitPrice")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EquipmentExceedLimitProgressView:[function(t,e,i){"use strict";cc._RF.push(e,"bf8e8a6chtOSocTjOjtD4Oz","EquipmentExceedLimitProgressView");var a=t("ResourceUtils"),n=t("GameConst"),o=t("ItemConst"),r=t("EquipmentUtils"),s=t("ViewUtils"),c=t("EquipmentSelectSideEquipmentAbilityThumbnail");cc.Class({extends:cc.Component,properties:{beforeRarityImageSprite:cc.Sprite,afterRarityImageSprite:cc.Sprite,beforeTotalParamLabel:cc.Label,afterTotalParamLabel:cc.Label,isNewReleaseDiplayNode:cc.Node,abilityThumbnail1:c,abilityThumbnail2:c},_targetEquipmentModel:null,_thumbnail:null,initEquipmentExceedLimitProgressView:function(t){this._targetEquipmentModel=t,a.addSprite(this.beforeRarityImageSprite,a.getFileNameRarityStrSIcon(t.getRarity())),a.addSprite(this.afterRarityImageSprite,a.getFileNameRarityStrSIcon(t.getRarity())),this.beforeTotalParamLabel.string=t.getTotalPower()+"",this.afterTotalParamLabel.string=t.getTotalPower()+"",this.afterTotalParamLabel.node.color=n.COLOR_STATE.NORMAL,this._drawAbilityList(this._targetEquipmentModel.getRarity())},drawEquipmentExceedLimitProgressView:function(t){var e=this._targetEquipmentModel.getTotalPower(),i=this._targetEquipmentModel.getRarity();if(t.length>0){i=this._targetEquipmentModel.getRarity()+1,a.addSprite(this.afterRarityImageSprite,a.getFileNameRarityStrSIcon(i));var n=r.createEquipmentBattleParameter(this._targetEquipmentModel.getEquipmentMainMaster(),i,1);e=n.hp+n.atk+n.def}else a.addSprite(this.afterRarityImageSprite,a.getFileNameRarityStrSIcon(this._targetEquipmentModel.getRarity()));this.afterTotalParamLabel.string=e+"",this.afterTotalParamLabel.node.color=s.getParamChangeColor(this._targetEquipmentModel.getTotalPower(),e),this._drawAbilityList(i)},_drawAbilityList:function(t){this.isNewReleaseDiplayNode.active=!1,this._drawAbilityThumbnail(this.abilityThumbnail1,1,o.EQUIPMENT_BOOST_TYPE.NORMAL,t,this._targetEquipmentModel.getEquipmentEffectInfoMap()),this._drawAbilityThumbnail(this.abilityThumbnail2,2,o.EQUIPMENT_BOOST_TYPE.BOOST,t,this._targetEquipmentModel.getEquipmentEffectInfoMap())},_drawAbilityThumbnail:function(t,e,i,a,o){t.node.active=!1,t.setAbilityOrder(e),this._targetEquipmentModel.getRarity()!==a&&(o[i][this._targetEquipmentModel.getRarity()].releaseRarity<=this._targetEquipmentModel.getRarity()?(t.setAbilityDescription(s.insertDiffTag(o[i][this._targetEquipmentModel.getRarity()].effectTextArray.join(""),o[i][a].effectTextArray.join(""),n.RICH_TEXT_TAG_STATE.WHITE.START,n.RICH_TEXT_TAG_STATE.WHITE.END,n.RICH_TEXT_TAG_STATE.PLUS.START,n.RICH_TEXT_TAG_STATE.PLUS.END)),t.node.active=!0):o[i][a].releaseRarity<=a&&(t.setAbilityDescription(n.RICH_TEXT_TAG_STATE.PLUS.START+o[i][a].effectTextArray.join("")+n.RICH_TEXT_TAG_STATE.PLUS.END),this.isNewReleaseDiplayNode.active=!0,t.node.active=!0))}});cc._RF.pop()},{EquipmentSelectSideEquipmentAbilityThumbnail:"EquipmentSelectSideEquipmentAbilityThumbnail",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],EquipmentExceedLimitTargetSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"379abXGWUtJ7oPDXU12REDH","EquipmentExceedLimitTargetSelectListView");var a=t("EquipmentUtils"),n=t("EquipmentSortConst"),o=t("ViewUtils"),r=t("EquipmentSingleSelectListWithSideViewBase"),s={POSITION:cc.v2(52,-52),SCALE:cc.v2(1,1)};cc.Class({extends:r,properties:{},initListView:function(t){this.matrixPageView.setCallBackToIsImageActive(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsThumbnailEnabled.bind(this)),this._super(t)},_callbackToCreateThumbnailNode:function(t,e){var i=this._super(t,e);return a.isCanExceedLimitEquipment(t)&&a.getExceedLimitMaterialEquipmentModelArray(t).length>0&&(i?o.addNoticeBadge(i,s.POSITION,s.SCALE):e&&o.addNoticeBadge(e,s.POSITION,s.SCALE)),i},_callbackIsThumbnailEnabled:function(t){return a.isCanExceedLimitEquipment(t)},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:"isCanExceedLimit",order:"desc"}),i.push({getterName:"getIsLevelMax",order:"desc"}),i.push({getterName:n.SORT_FUNC_NAME[Object.keys(n.SORT_TYPE)[t]],order:e}),i.push({getterName:"getEquipmentId"}),i.push({getterName:"getEquipmentCd"}),i}});cc._RF.pop()},{EquipmentSingleSelectListWithSideViewBase:"EquipmentSingleSelectListWithSideViewBase",EquipmentSortConst:"EquipmentSortConst",EquipmentUtils:"EquipmentUtils",ViewUtils:"ViewUtils"}],EquipmentExceedLimitTargetSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"8c9ac3JLHBMgI0yIKR3kWWR","EquipmentExceedLimitTargetSelectSideView");t("EquipmentUtils");var a=t("PopupUtils"),n=t("EquipmentSingleSelectSideViewBase"),o=t("EquipmentConst");cc.Class({extends:n,properties:{},drawEquipmentSelectSideView:function(t){this._super(t),this.executeBtn.switchBtnImage(!0)},_onTapExecuteBtn:function(){this._equipmentModel.getRarity()>=o.RARITY.SSR?a.openSimpleMessageWindow("\u3053\u308c\u4ee5\u4e0a\u9032\u5316\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093"):this._equipmentModel.getLevel()<this._equipmentModel.getMaxLevel()?a.openCommonPopupYesNo("\u88c5\u5099\u30ec\u30d9\u30eb\u78ba\u8a8d","\u30ec\u30d9\u30ebMax\u306e\u88c5\u5099\u306e\u307f\u9032\u5316\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059","",!1,function(){this._root.setSelectedTab(0),this._root.pushEquipmentSelectSubRoot(!0)}.bind(this),function(){},"\u5f37\u5316\u3059\u308b","\u30ad\u30e3\u30f3\u30bb\u30eb",!0):this._callbackToExecuteBtn&&this._callbackToExecuteBtn(this._equipmentModel)}});cc._RF.pop()},{EquipmentConst:"EquipmentConst",EquipmentSingleSelectSideViewBase:"EquipmentSingleSelectSideViewBase",EquipmentUtils:"EquipmentUtils",PopupUtils:"PopupUtils"}],EquipmentFilterConst:[function(t,e,i){"use strict";cc._RF.push(e,"b184a8fw8pC2LAywyemnQdd","EquipmentFilterConst");cc.Class({statics:{PROPERTY_NAME:"EquipmentFilter",FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9,MATERIAL:10,EQUIPMENT:11}),FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",MATERIAL:"getFilterFlgByMaterial",EQUIPMENT:"getFilterFlgByEquipment"},EQUIP_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9}),EQUIP_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4"},FILTER_GROUP_END:{ATTRIBUTE:5,RARITY:9,TYPE:11},SELL_FILTER_TYPE:{RARITY_1:0,RARITY_2:1,RARITY_3:2,RARITY_4:3,MATERIAL:4,EQUIPMENT:5},SELL_FILTER_FUNC_NAME:{RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",MATERIAL:"getFilterFlgByMaterial",EQUIPMENT:"getFilterFlgByEquipment"},MATERIAL_FILTER_RARITY_COUNT:4,MATERIAL_FILTER_TYPE:cc.Enum({RARITY_1:0,RARITY_2:1,RARITY_3:2,RARITY_4:3,EQUIPMENT:4}),MATERIAL_FILTER_FUNC_NAME:{RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",EQUIPMENT:"getFilterFlgByEquipment"},WAREHOUSE_PROPERTY_NAME:"WarehouseEquipmentFilter",WAREHOUSE_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9}),WAREHOUSE_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",MATERIAL:"getFilterFlgByMaterial",EQUIPMENT:"getFilterFlgByEquipment"},WAREHOUSE_FILTER_GROUP_END:{ATTRIBUTE:5,RARITY:9}}});cc._RF.pop()},{}],EquipmentFortifyCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"08d0b21n+BCB4b2rcl66ICY","EquipmentFortifyCompletePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("EquipmentUtils"),r=t("EquipmentFortifyProgressView"),s=t("GameConst"),c=t("EquipmentConst"),l=cc.Enum({NORMAL:0,GREAT:1});cc.Class({extends:a,properties:{fortifyProgressView:r,abilityThumbnailPrefab:cc.Prefab,abilityThumbnailParentNode:cc.Node,resultAnimation:cc.Animation,skipBtn:n,okBtn:n},_totalExp:0,_currentExp:0,_expPerFrame:0,_targetModel:null,_callbackToOkBtn:null,onLoad:function(){this.skipBtn.setTapEvent(this._onTapSkipBtn.bind(this)),this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.resultAnimation.on("finished",this._onEndStartingAnimation.bind(this),this)},openEquipmentFortifyCompletePopup:function(t,e,i,a){this._targetModel=t,this.setCloseCallBack(a),this.fortifyProgressView.initEquipmentFortifyProgressView(t),this._currentExp=t.getExp();var n=o.calcTotalMaterialExp(e,t.getEquipmentMainMaster());n=i?Math.floor(n*c.EQUIPMENT_FORTIFY_GRANT_RATE):n,this._totalExp=t.getExp()+n,this._expPerFrame=Math.max(parseInt(.005*(this._totalExp-this._currentExp)),1),this.abilityThumbnailParentNode.active=!1,this.open(this._drawAbilityList.bind(this,i))},update:function(){this._currentExp+=this._expPerFrame,this._currentExp>=this._totalExp&&(this._currentExp=this._totalExp,this.skipBtn.node.active=!1),this.fortifyProgressView.drawEquipmentFortifyProgressViewWithAnimation(this._currentExp)},_drawAbilityList:function(t){t?this.resultAnimation.play(this.resultAnimation.getClips()[l.GREAT].name):this.resultAnimation.play(this.resultAnimation.getClips()[l.NORMAL].name),this.abilityThumbnailParentNode.destroyAllChildren(),this._drawAbilityThumbnail(1,this._targetModel.getEffectTextForNormal().join(""),this._targetModel.getEquipmentEffectMaster().length>0),this._drawAbilityThumbnail(2,this._targetModel.getEffectTextForBoost().join(""),this._targetModel.getEquipmentEffectMaster().length>0),this.abilityThumbnailParentNode.active=!0},_drawAbilityThumbnail:function(t,e,i){var a=cc.instantiate(this.abilityThumbnailPrefab).getComponent("EquipmentSelectSideEquipmentAbilityThumbnail");a.setAbilityOrder(t),a.setAbilityDescription(s.RICH_TEXT_TAG_STATE.NORMAL.START+e+s.RICH_TEXT_TAG_STATE.NORMAL.END),a.switchActiveGrayOutNode(!i),this.abilityThumbnailParentNode.addChild(a.node)},_onTapSkipBtn:function(){this._currentExp=this._totalExp,this.skipBtn.node.active=!1},_onEndStartingAnimation:function(){},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentConst:"EquipmentConst",EquipmentFortifyProgressView:"EquipmentFortifyProgressView",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",PopupBase:"PopupBase"}],EquipmentFortifyConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"7a6d2TonbdCdJxhyCezfihY","EquipmentFortifyConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=t("ItemUtils"),s=t("EquipmentUtils"),c=t("TotalBattleParameterView"),l=t("GameConst");cc.Class({extends:a,properties:{materialParentNode:cc.Node,materialThumbnailPrefab:cc.Prefab,beforeParameterView:c,afterParameterView:c,abilityThumbnailParentNode:cc.Node,abilityThumbnailPrefab:cc.Prefab,priceNameLabel:cc.Label,currentGoldNameLabel:cc.Label,priceLabel:cc.Label,currentGoldLabel:cc.Label,executeBtn:n,cnacelBtn:n},_callbackToExecuteBtn:null,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this),n.SE_NAME.CANCEL),this.cnacelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openEquipmentFortifyConfirmPopup:function(t,e,i){this._callbackToExecuteBtn=i,this.open(this._initEquipmentFortifyConfirmPopup.bind(this,t,e))},_initEquipmentFortifyConfirmPopup:function(t,e){this._drawMaterials(e),this._drawParameter(t,e),this._drawAbility(t),this._drawPrice(t,e)},_drawMaterials:function(t){for(var e in this.materialParentNode.destroyAllChildren(),t){var i=cc.instantiate(this.materialThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");i.initEquipmentMatrixThumbnail(t[e].getEquipmentId(),t[e].getAttribute(),t[e].getRarity(),t[e]),i.setParameter("Lv.",t[e].getLevel()),this.materialParentNode.addChild(i.node)}},_drawParameter:function(t,e){this.beforeParameterView.initBattleParameterView(t.getHp(),t.getAtk(),t.getDef(),t.getHp()+t.getAtk()+t.getDef());var i=s.calcTotalMaterialExp(e,t.getEquipmentMainMaster())+t.getExp(),a=s.createEquipmentBattleParameter(t.getEquipmentMainMaster(),t.getRarity(),s.getEquipmentLevelByTotalExp(i,t.getMaxLevel(),t.getRarity()));this.afterParameterView.initBattleParameterView(a.hp,a.atk,a.def,a.hp+a.atk+a.def)},_drawAbility:function(t){this.abilityThumbnailParentNode.active=!1,this.abilityThumbnailParentNode.destroyAllChildren(),this._drawAbilityThumbnail(1,t.getEffectTextForNormal(),t.getEquipmentEffectMaster().length>0),this._drawAbilityThumbnail(2,t.getEffectTextForBoost(),t.getEquipmentEffectMaster().length>0),this.abilityThumbnailParentNode.active=!0},_drawAbilityThumbnail:function(t,e,i){var a=cc.instantiate(this.abilityThumbnailPrefab).getComponent("EquipmentSelectSideEquipmentAbilityThumbnail");a.setAbilityOrder(t),a.setAbilityDescription(l.RICH_TEXT_TAG_STATE.NORMAL.START+e+l.RICH_TEXT_TAG_STATE.NORMAL.END),a.switchActiveGrayOutNode(!i),this.abilityThumbnailParentNode.addChild(a.node)},_drawPrice:function(t,e){var i=r.getItemMaster(l.ITEM_ID_GOLD);this.priceNameLabel.string="\u5fc5\u8981["+i.getName()+"]",this.currentGoldNameLabel.string="\u6240\u6301["+i.getName()+"]",this.priceLabel.string=o.convertToCommaDelimited(s.calcFortifyPrice(t,e)),this.currentGoldLabel.string=o.convertToCommaDelimited(r.getUserItemCount(l.ITEM_ID_GOLD))},_onTapExecuteBtn:function(){this.close(),this._callbackToExecuteBtn()},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",TotalBattleParameterView:"TotalBattleParameterView"}],EquipmentFortifyMaterialSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"f9cdbCXUFVCt5qsBr9I7YVX","EquipmentFortifyMaterialSelectListView");var a=t("Singleton"),n=t("CommonButton"),o=t("CommonUtils"),r=t("EquipmentUtils"),s=t("ItemUtils"),c=t("PopupUtils"),l=t("ResourceUtils"),u=t("WarehouseUtils"),h=t("WarehouseConvertUtils"),d=t("EquipmentMultipleSelectListWithSideViewBase"),p=t("MatrixMultipleSelectCountUpPageView"),m=t("GameConst"),g=t("ResourceConst"),C=t("EquipmentConst"),f=t("WarehouseConst"),E=t("LocalDataConst"),T=t("ItemConst"),S=t("StaticResourceConst");cc.Class({extends:d,properties:{countLabel:cc.Label,maxCountLabel:cc.Label,materialCountLabel:cc.Label,materialMaxCountLabel:cc.Label,dataTypeLabel:cc.Label,warehouseSwitchBtn:n,countUpMatrixMaterialPageView:p},onLoad:function(){this.warehouseSwitchBtn.setTapEvent(this._onTapWarehouseSwitchBtn.bind(this))},resetListView:function(){this._super(),this.node.active=!1,this.countUpMatrixMaterialPageView.node.active=!1},initListView:function(t){switch(this.node.active=!0,this._root=t,this._resetActiveListView(),t.materialDataType){case f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this._drawDataType(this._root.materialDataType),this.matrixPageView.content.active=!0,this.matrixPageView.node.active=!0,this._super(t);break;default:this.mainNode.active=!0,this.initWarehouseMaterialListView(t)}},_initMatrixPageView:function(){this.countLabel.string=""+this._getEquipments().length,this.maxCountLabel.string=""+a.dao[a.USER].getEquipmentMaxCount(),this.materialCountLabel.string=""+this._getMaterials().length,this.materialMaxCountLabel.string=""+m.MAX_MATERIAL_COUNT,this.matrixPageView.initMatrixPageView("getEquipmentCd",this._getUsableMaterials(),a.dao.userBasicData.getEquipmentMaxCount(),[],this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToRedraw:function(t){this.matrixPageView.initMatrixPageView("getEquipmentCd",this._getUsableMaterials(),a.dao.userBasicData.getEquipmentMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)},_getUsableMaterials:function(){return r.getMaterialEquipmentModelArray(this._root.getTargetEquipmentCd())},_getEquipments:function(){return r.getEquipmentModelArrayByEquipmentTypes([C.EQUIPMENT_TYPE.NORMAL])},_getMaterials:function(){return r.getEquipmentModelArrayByEquipmentTypes([C.EQUIPMENT_TYPE.FORTIFY_MATERIAL,C.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL])},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(l.getResource(g.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_FORTIFY)).getComponent("SortFilterPopup")},_callbackToSideExecute:function(t){var e=r.calcFortifyPrice(this._root.getTargetEquipmentModel(),t);s.getUserItemCount(m.ITEM_ID_GOLD)>=e?r.isEquipmentAlert(t)?this._root.openEquipmentAlertPopup(t,C.ALERT_TYPE.FORTIFY,function(){this._root.openEquipmentFortifyConfirmPopup(this._root.getTargetEquipmentModel(),t)}.bind(this)):this._root.openEquipmentFortifyConfirmPopup(this._root.getTargetEquipmentModel(),t):c.openSimpleMessageWindow("\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u5f37\u5316\u3067\u304d\u307e\u305b\u3093\u3002")},_callbackIsThumbnailEnabled:function(t,e){return!((t.getIsProtect()||r.getEquipmentLevelByTotalExp(this._root.getTargetEquipmentModel().getExp()+r.calcTotalMaterialExp(e,this._root.getTargetEquipmentModel().getEquipmentMainMaster()),this._root.getTargetEquipmentModel().getMaxLevel(),this._root.getTargetEquipmentModel().getRarity())>=this._root.getTargetEquipmentModel().getMaxLevel())&&!e.find(function(e){return e.getEquipmentCd()===t.getEquipmentCd()}))&&!(e.length>=this._getCheckLimit()&&!e.find(function(e){return e.getEquipmentCd()===t.getEquipmentCd()}))},_onTapWarehouseSwitchBtn:function(){switch(this._toggleDataType(),this._resetActiveListView(),this._root.materialDataType){case f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this.initListView(this._root);break;case f.WAREHOUSE_STORAGE_TYPE.MATERIAL:this.initWarehouseMaterialListView(this._root)}},_toggleDataType:function(){switch(this._root.materialDataType){case f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this._root.materialDataType=f.WAREHOUSE_STORAGE_TYPE.MATERIAL;break;case f.WAREHOUSE_STORAGE_TYPE.MATERIAL:this._root.materialDataType=f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT}},_drawDataType:function(t){switch(t){case f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this.dataTypeLabel.string="\u88c5\u5099";break;case f.WAREHOUSE_STORAGE_TYPE.MATERIAL:this.dataTypeLabel.string="\u5009\u5eab"}},_resetActiveListView:function(){this._root.warehouseCountInfoArray=[],this.matrixPageView.node.active=!1,this.matrixPageView.content.active=!1,this.countUpMatrixMaterialPageView.node.active=!1},initWarehouseMaterialListView:function(t){this._drawDataType(t.materialDataType),this.countUpMatrixMaterialPageView.node.active=!0,this.countUpMatrixMaterialPageView.setCallBackToIsImageActive(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToThumbnail(this._callbackToWarehouseThumbnail.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopupForWarehouseMaterial.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToConvertSortText(u.convertSortTypeToTextForMaterial),this.countUpMatrixMaterialPageView.setCallBackToCreateSortConditions(u.createSortConditionsForEquipment),this.countUpMatrixMaterialPageView.setCallBackToCreateFilterConditions(u.createFilterConditionsForEquipment),this.countUpMatrixMaterialPageView.setSortParam(this._getCurrentSortTypeForWarehouseMaterial(),this._getCurrentSortOrderForWarehouseMaterial()),this.countUpMatrixMaterialPageView.setFilterCheckList(this._getCurrentFilterCheckListForWarehouseMaterial()),this.countUpMatrixMaterialPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilterForWarehouseMaterial.bind(this)),this.countUpMatrixMaterialPageView.initMatrixPageView("getEquipmentCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getEquipmentMaxCount(),[],this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.equipmentSelectSideView.initEquipmentSelectSideView(t,this._callbackToRedrawForWarehouse.bind(this),this._callbackToSideExecute.bind(this)),this.equipmentSelectSideView.setCallbackToResetBtn(this._callbackToSideResetBtnForWarehouseMaterial.bind(this)),this.equipmentSelectSideView.setCallbackToMaterialThumbnail(this._callbackToSideThumbnailForWarehouseMaterial.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView([])},_callbackToRedrawForWarehouse:function(t){var e=[];Array.prototype.push.apply(e,h.convertEquipmentsToWarehouseModelCountInfoArray(t,f.WAREHOUSE_STORAGE_TYPE.MATERIAL)),Array.prototype.push.apply(e,h.convertEquipmentsToWarehouseModelCountInfoArray(t,f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT)),this._root.warehouseCountInfoArray=e,this.countUpMatrixMaterialPageView.initMatrixPageView("getEquipmentCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getEquipmentMaxCount(),e,this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)},_getWarehouseMaterialModelArray:function(){var t=[];return Array.isArray(a.dao.warehouseEquipments)&&Array.prototype.push.apply(t,_.filter(a.dao.warehouseEquipments,function(t){return t.getCount()>0})),Array.isArray(a.dao.warehouseMaterials)&&Array.prototype.push.apply(t,_.filter(a.dao.warehouseMaterials,function(t){return t.getCount()>0&&t.getItemType()===T.ITEM_TYPE.EQUIPMENT&&t.getMaterialType()===C.EQUIPMENT_TYPE.FORTIFY_MATERIAL})),t},_callbackIsWarehouseThumbnailEnabled:function(t,e){var i=_.sumBy(e,function(t){return t.count}),a=h.convertWarehouseModelCountInfoArrayToEquipments(e,f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT);return i<this._getCheckLimit()&&r.getEquipmentLevelByTotalExp(this._root.getTargetEquipmentModel().getExp()+r.calcTotalMaterialExp(a,this._root.getTargetEquipmentModel().getEquipmentMainMaster()),this._root.getTargetEquipmentModel().getMaxLevel(),this._root.getTargetEquipmentModel().getRarity())<this._root.getTargetEquipmentModel().getMaxLevel()},_callbackToCreateWarehouseMaterialThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("EquipmentMatrixThumbnail")).resetEquipmentMatrixThumbnail():i=cc.instantiate(l.getResource(S.EQUIPMENT_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("EquipmentMatrixThumbnail"),i.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),void 0),i.setParameter("x",t.getCount()),i.node},_callbackToWarehouseThumbnail:function(t,e){this._root.warehouseCountInfoArray=this.countUpMatrixMaterialPageView.getCountInfoArray(),this.equipmentSelectSideView.drawEquipmentSelectSideView(h.convertWarehouseModelCountInfoArrayToEquipments(this.countUpMatrixMaterialPageView.getCountInfoArray(),f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT))},_callbackToCreateSortFilterPopupForWarehouseMaterial:function(){return cc.instantiate(l.getResource(g.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_EQUIPMENT_WAREHOUSE)).getComponent("SortFilterPopup")},_getCurrentSortTypeForWarehouseMaterial:function(){return o.loadLocalStorage(E.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_EQUIPMENT,f.WAREHOUSE_STORAGE_SORT_TYPE.UPDATING,E.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrderForWarehouseMaterial:function(){return o.loadLocalStorage(E.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_EQUIPMENT,m.SORT_ORDER.ASC,E.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_getCurrentFilterCheckListForWarehouseMaterial:function(){return a.localData[E.FILTER.TEN.WAREHOUSE_STORAGE_EQUIPMENT]},_callbackToSortAndFilterForWarehouseMaterial:function(t,e,i){o.saveLocalStorage(E.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_EQUIPMENT,t),o.saveLocalStorage(E.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_EQUIPMENT,e)},_callbackToSideResetBtnForWarehouseMaterial:function(){this._root.warehouseCountInfoArray=[],this.countUpMatrixMaterialPageView.clearCountInfoArray(),this.countUpMatrixMaterialPageView.redraw(),this.equipmentSelectSideView.drawEquipmentSelectSideView([])},_callbackToSideThumbnailForWarehouseMaterial:function(t,e){e=_.filter(e,function(e){return e.getEquipmentCd()!==t.getEquipmentCd()}),this._setRecommendSelectMaterialsForWarehouseMaterial(e)},_setRecommendSelectMaterialsForWarehouseMaterial:function(t){var e=this.countUpMatrixMaterialPageView.getPageIndex(),i=[];Array.prototype.push.apply(i,h.convertEquipmentsToWarehouseModelCountInfoArray(t,f.WAREHOUSE_STORAGE_TYPE.MATERIAL)),Array.prototype.push.apply(i,h.convertEquipmentsToWarehouseModelCountInfoArray(t,f.WAREHOUSE_STORAGE_TYPE.EQUIPMENT)),this._root.warehouseCountInfoArray=i,this.countUpMatrixMaterialPageView.initMatrixPageView("getEquipmentCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getEquipmentMaxCount(),i,this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.countUpMatrixMaterialPageView.redraw(),this.countUpMatrixMaterialPageView.switchPageContent(e),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentMultipleSelectListWithSideViewBase:"EquipmentMultipleSelectListWithSideViewBase",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",MatrixMultipleSelectCountUpPageView:"MatrixMultipleSelectCountUpPageView",PopupUtils:"PopupUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",WarehouseConst:"WarehouseConst",WarehouseConvertUtils:"WarehouseConvertUtils",WarehouseUtils:"WarehouseUtils"}],EquipmentFortifyMaterialSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"ef1acMrtCJLhIeOlMGTl3Jb","EquipmentFortifyMaterialSelectSideView");var a=t("CommonButton"),n=t("CommonUtils"),o=t("EquipmentUtils"),r=t("ItemUtils"),s=t("ResourceUtils"),c=t("GameConst"),l=t("EquipmentConst"),u=t("StaticResourceConst"),h=t("ItemSourceConst"),d=t("EquipmentMultipleSelectSideViewBase");cc.Class({extends:d,properties:{expLabel:cc.Label,expOverBalloonNode:cc.Node,expOverLabel:cc.Label,recommendSelectBtn:a,sourceSearchBtn:a},onLoad:function(){this._super(),this.recommendSelectBtn.setTapEvent(this._onTapRecommendSelectBtn.bind(this)),this.sourceSearchBtn.setTapEvent(this._onTapSourceSearchBtn.bind(this))},initEquipmentSelectSideView:function(t,e,i){this._super(t,e,i),this.equipmentProgressView.drawEquipmentSimpleProgressView(this._root.getTargetEquipmentModel(),l.PROMOTE_TYPE.FORTIFY),this.expLabel.string=this._getExpText([]),this._expOver(),this._switchRecommendSelectBtn()},drawEquipmentSelectSideView:function(t){this._super(t),this.expLabel.string=this._getExpText(t),this.equipmentProgressView.drawEquipmentProgressView(l.PROMOTE_TYPE.FORTIFY,t),this._expOver()},_getPriceTextColor:function(t){if(this._root.getTargetEquipmentModel()){var e=o.calcFortifyPrice(this._root.getTargetEquipmentModel(),t);if(r.getUserItemCount(c.ITEM_ID_GOLD)<e)return c.COLOR_STATE.MINUS}return c.COLOR_STATE.NORMAL},_getPriceText:function(t){return this._root.getTargetEquipmentModel()?n.convertToCommaDelimited(o.calcFortifyPrice(this._root.getTargetEquipmentModel(),t)):"0"},_getExpText:function(t){return n.convertToCommaDelimited(o.calcTotalMaterialExp(t,this._root.getTargetEquipmentModel().getEquipmentMainMaster()))},_onTapRecommendSelectBtn:function(){this._root.openRecommendedFortifyMaterialSelectPopup("\u4ee5\u4e0a\u306e\u6761\u4ef6\u3067\u3001\u5f37\u5316\u7d20\u6750\u306b\u3059\u308b\u88c5\u5099/\u7d20\u6750\u3092\n\u6700\u5927"+this._checkLimit+"\u500b\u9078\u629e\u3057\u307e\u3059\u3002",this._checkLimit,this._root.getTargetEquipmentModel().getAttribute(),this._callbackToRedraw.bind(this))},_onTapSourceSearchBtn:function(){cc.instantiate(s.getResource(u.ITEM_SOURCE_LIST_POPUP_PREFAB_PATH)).getComponent("ItemSourceListPopup").openItemSourceListPopup(r.getItemMaster(h.SOURCE_ITEM_ID.EQUIPMENT_FORTIFY_MATERIAL),this._root.getCurrentSceneName(),this._root.sceneParam)},_expOver:function(){var t=o.calcRemainingExpForMaxLevelByMaxLevelAndTotalExp(this._root.getTargetEquipmentModel().getMaxLevel(),this._root.getTargetEquipmentModel().getExp(),this._root.getTargetEquipmentModel().getRarity()),e=o.calcTotalMaterialExp(this._checkedModelArray,this._root.getTargetEquipmentModel())-t;e>0?(this.expOverBalloonNode.active=!0,this.expOverLabel.string=n.convertToCommaDelimited(e)):this.expOverBalloonNode.active=!1},_switchRecommendSelectBtn:function(){this._root.getTargetEquipmentModel().getLevel()<this._root.getTargetEquipmentModel().getMaxLevel()?(this.recommendSelectBtn.switchBtnImage(!0),this.recommendSelectBtn.setTouchEnable(!0)):(this.recommendSelectBtn.switchBtnImage(!1),this.recommendSelectBtn.setTouchEnable(!1))}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentMultipleSelectSideViewBase:"EquipmentMultipleSelectSideViewBase",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemSourceConst:"ItemSourceConst",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],EquipmentFortifyProgressView:[function(t,e,i){"use strict";cc._RF.push(e,"cb9ecbsinBOHbYTHXsMtolX","EquipmentFortifyProgressView");var a=t("GameConst"),n=t("EquipmentUtils"),o=t("ViewUtils"),r=t("TotalBattleParameterView");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,equipmentNameLabel:cc.Label,beforeLevelLabel:cc.Label,afterLevelLabel:cc.Label,afterLevelAnimation:cc.Animation,levelUpAnimation:cc.Animation,maxLevelLabel:cc.Label,needExpNumLabel:cc.Label,beforeExpProgressBar:cc.ProgressBar,afterExpProgressBar:cc.ProgressBar,beforeBattleParameterView:r,afterBattleParameterView:r},_targetEquipmentModel:null,_thumbnail:null,_recentLevel:0,initEquipmentFortifyProgressView:function(t){this._targetEquipmentModel=t,this._recentLevel=t.getLevel(),this._initThumbnail(t),this._drawEquipmentName(t.getName()),this._drawBeforeLevel(t.getLevel()),this._drawAfterLevel(t.getLevel()),this._drawBeforeExpProgress(t),this._drawAfterExpProgress(t.getExp(),t.getLevel(),!0),this._drawNeedExp(t.getExp()),this.maxLevelLabel.string=t.getMaxLevel()+"",this.beforeBattleParameterView&&this.beforeBattleParameterView.initBattleParameterView(this._targetEquipmentModel.getHp(),this._targetEquipmentModel.getAtk(),this._targetEquipmentModel.getDef(),this._targetEquipmentModel.getHp()+this._targetEquipmentModel.getAtk()+this._targetEquipmentModel.getDef()),this.afterBattleParameterView&&(this.afterBattleParameterView.initBattleParameterView(this._targetEquipmentModel.getHp(),this._targetEquipmentModel.getAtk(),this._targetEquipmentModel.getDef(),this._targetEquipmentModel.getHp()+this._targetEquipmentModel.getAtk()+this._targetEquipmentModel.getDef()),this.afterBattleParameterView.setColor(a.COLOR_STATE.NORMAL,a.COLOR_STATE.NORMAL,a.COLOR_STATE.NORMAL,a.COLOR_STATE.NORMAL))},drawEquipmentFortifyProgressView:function(t){var e=this._targetEquipmentModel.getExp()+n.calcTotalMaterialExp(t,this._targetEquipmentModel.getEquipmentMainMaster()),i=n.getEquipmentLevelByTotalExp(e,this._targetEquipmentModel.getMaxLevel(),this._targetEquipmentModel.getRarity());if(this._drawAfterLevel(i),this._drawAfterExpProgress(e,i,!0),this._drawNeedExp(e),this.afterBattleParameterView){var a=n.createEquipmentBattleParameter(this._targetEquipmentModel.getEquipmentMainMaster(),this._targetEquipmentModel.getRarity(),i);this.afterBattleParameterView.initBattleParameterView(a.hp,a.atk,a.def,a.hp+a.atk+a.def),this.afterBattleParameterView.setColor(o.getParamChangeColor(this._targetEquipmentModel.getHp(),a.hp),o.getParamChangeColor(this._targetEquipmentModel.getAtk(),a.atk),o.getParamChangeColor(this._targetEquipmentModel.getDef(),a.def),o.getParamChangeColor(this._targetEquipmentModel.getHp()+this._targetEquipmentModel.getAtk()+this._targetEquipmentModel.getDef(),a.hp+a.atk+a.def))}},drawEquipmentFortifyProgressViewWithAnimation:function(t){var e=n.getEquipmentLevelByTotalExp(t,this._targetEquipmentModel.getMaxLevel(),this._targetEquipmentModel.getRarity());if(this._drawAfterExpProgress(t,e,!1),this._drawNeedExp(t),!(e<=this._recentLevel)&&(this.beforeExpProgressBar.node.active=!1,this._recentLevel=e,this._drawAfterLevel(e),this.afterLevelAnimation.play(),this.levelUpAnimation.play(),this.afterBattleParameterView)){var i=n.createEquipmentBattleParameter(this._targetEquipmentModel.getEquipmentMainMaster(),this._targetEquipmentModel.getRarity(),e);this.afterBattleParameterView.setColor(o.getParamChangeColor(this._targetEquipmentModel.getHp(),i.hp),o.getParamChangeColor(this._targetEquipmentModel.getAtk(),i.atk),o.getParamChangeColor(this._targetEquipmentModel.getDef(),i.def),o.getParamChangeColor(this._targetEquipmentModel.getHp()+this._targetEquipmentModel.getAtk()+this._targetEquipmentModel.getDef(),i.hp+i.atk+i.def)),this.afterBattleParameterView.initBattleParameterView(i.hp,i.atk,i.def,i.hp+i.atk+i.def),this.afterBattleParameterView.playAnimation()}},_initThumbnail:function(t){this.thumbnailParentNode&&(this._thumbnail||(this.thumbnailParentNode.destroyAllChildren(),this._thumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.thumbnailParentNode.addChild(this._thumbnail.node)),this._thumbnail.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),this._thumbnail.setParameter("Lv.",t.getLevel()),this._thumbnail.setProtected(t.getIsProtect()))},_drawEquipmentName:function(t){this.equipmentNameLabel&&(this.equipmentNameLabel.string=t)},_drawBeforeLevel:function(t){this.beforeLevelLabel&&(this.beforeLevelLabel.string=t+"")},_drawAfterLevel:function(t){this.afterLevelLabel&&(this.afterLevelLabel.node.color=o.getParamChangeColor(this._targetEquipmentModel.getLevel(),t),this.afterLevelLabel.string=t+"")},_drawBeforeExpProgress:function(t){this.beforeExpProgressBar.progress=n.calcExpRateForNextLevelByTotalExp(t.getExp(),t.getMaxLevel(),t.getRarity())},_drawAfterExpProgress:function(t,e,i){i&&e>this._targetEquipmentModel.getLevel()?this.afterExpProgressBar.progress=1:e===this._targetEquipmentModel.getMaxLevel()?this.afterExpProgressBar.progress=1:this.afterExpProgressBar.progress=n.calcExpRateForNextLevelByTotalExp(t,this._targetEquipmentModel.getMaxLevel(),this._targetEquipmentModel.getRarity())},_drawNeedExp:function(t){this.needExpNumLabel.string=n.calcNeedExpForNextLevelByTotalExp(t,this._targetEquipmentModel.getMaxLevel(),this._targetEquipmentModel.getRarity())+""}});cc._RF.pop()},{EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",TotalBattleParameterView:"TotalBattleParameterView",ViewUtils:"ViewUtils"}],EquipmentFortifyTargetSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"315d05vgtJF8oQFt1EM0VTR","EquipmentFortifyTargetSelectListView");var a=t("EquipmentUtils"),n=t("PopupUtils"),o=t("EquipmentSingleSelectListWithSideViewBase");cc.Class({extends:o,properties:{},_callbackToSideExecute:function(t){a.isCanFortifyEquipment(t)?this._root.pushEquipmentSelectSubRoot(!0):n.openSimpleMessageWindow("\u6700\u5927\u30ec\u30d9\u30eb\u306b\u9054\u3057\u3066\u3044\u307e\u3059\u3002")}});cc._RF.pop()},{EquipmentSingleSelectListWithSideViewBase:"EquipmentSingleSelectListWithSideViewBase",EquipmentUtils:"EquipmentUtils",PopupUtils:"PopupUtils"}],EquipmentFortifyTargetSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"7b2e7tR2plI6I59Mxb1xTiF","EquipmentFortifyTargetSelectSideView");var a=t("EquipmentUtils"),n=t("EquipmentSingleSelectSideViewBase");cc.Class({extends:n,properties:{},drawEquipmentSelectSideView:function(t){this._super(t),this.executeBtn.switchBtnImage(a.isCanFortifyEquipment(t))}});cc._RF.pop()},{EquipmentSingleSelectSideViewBase:"EquipmentSingleSelectSideViewBase",EquipmentUtils:"EquipmentUtils"}],EquipmentLevelModel:[function(t,e,i){"use strict";cc._RF.push(e,"83581XtnRNA/5ot4OWReGUz","EquipmentLevelModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getExpType:function(){if(this._isKeyFieldAvailable("expType"))return this._data.expType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: expType")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getTotalExp:function(){if(this._isKeyFieldAvailable("totalExp"))return this._data.totalExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: totalExp")},getNextLevelExp:function(){if(this._isKeyFieldAvailable("nextLevelExp"))return this._data.nextLevelExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: nextLevelExp")},getFortifyPrice:function(){if(this._isKeyFieldAvailable("fortifyPrice"))return this._data.fortifyPrice;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fortifyPrice")},getSalePrice:function(){if(this._isKeyFieldAvailable("salePrice"))return this._data.salePrice;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: salePrice")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EquipmentListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"40380iwTqdHxYm5pdziKE6I","EquipmentListViewBase");var a=t("ListViewBase"),n=t("MatrixPageViewBase"),o=(t("Singleton"),t("GameConst"),t("EquipmentSortConst")),r=t("EquipmentFilterConst"),s=t("EquipmentUtils"),c=t("ViewUtils"),l=t("CommonUtils"),u=t("LocalDataConst"),h=t("ResourceUtils"),d=t("ResourceConst");t("EquipmentSelectSideViewBase"),cc.Class({extends:a,properties:{matrixPageView:n},resetListView:function(){this.matrixPageView.node.active=!1},initListView:function(t){this.matrixPageView.setCallBackToConvertSortText(s.convertSortTypeToText),this.matrixPageView.setCallBackToThumbnail(this._callbackToThumbnail.bind(this)),this.matrixPageView.setCallBackToCreateSortConditions(this._callbackToCreateSortConditions.bind(this)),this.matrixPageView.setCallBackToCreateFilterConditions(this._callbackToCreateFilterConditions.bind(this)),this.matrixPageView.setSortParam(t.getCurrentSortType(!0),t.getCurrentSortOrder(!0)),this.matrixPageView.setFilterCheckList(t.getCurrentFilterCheckList()),this.matrixPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilter.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this._super(t),this.matrixPageView.node.active=!0},_setListContent:function(t){this._initMatrixPageView()},_initMatrixPageView:function(){cc.error("_initMatrixPageView()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(h.getResource(d.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_BASE)).getComponent("SortFilterPopup")},_callbackToCreateThumbnailNode:function(t,e){var i;e?(i=e.getComponentInChildren("EquipmentMatrixThumbnail")).resetEquipmentMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),c.hideNoticeBadge(i.node),i.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),i.setProtected(t.getIsProtect());var a=s.createSortViewParams(l.loadLocalStorage(u.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,0,u.LOCAL_STORAGE_GET_TYPE.INTEGER),t);return i.setParameter(a.prefix,a.value),i.node},_resetActiveThumbnails:function(){var t=this.matrixPageView.content.getComponentsInChildren("EquipmentMatrixThumbnail");for(var e in t)t[e].setSelectedNodeActive(!1)},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:o.SORT_FUNC_NAME[Object.keys(o.SORT_TYPE)[t]],order:e}),i.push({getterName:"getEquipmentId"}),i.push({getterName:"getEquipmentCd"}),i},_callbackToCreateFilterConditions:function(t){for(var e=[],i=r.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:r.FILTER_FUNC_NAME[Object.keys(r.FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(r.FILTER_GROUP_END).indexOf(t)>=0},_callbackToSortAndFilter:function(t,e,i){this._root.setSortAndFilterParam(t,e,i,!0)},_callbackToThumbnail:function(){cc.error("_callbackToThumbnail(arguments)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")}});cc._RF.pop()},{CommonUtils:"CommonUtils",EquipmentFilterConst:"EquipmentFilterConst",EquipmentSelectSideViewBase:"EquipmentSelectSideViewBase",EquipmentSortConst:"EquipmentSortConst",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ListViewBase:"ListViewBase",LocalDataConst:"LocalDataConst",MatrixPageViewBase:"MatrixPageViewBase",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],EquipmentListWithSideViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"405a95km1xAy4ICo2XTM5h5","EquipmentListWithSideViewBase");t("Singleton"),t("GameConst");var a=t("EquipmentListViewBase"),n=t("EquipmentSelectSideViewBase");cc.Class({extends:a,properties:{mainNode:cc.Node,equipmentSelectSideView:n},resetListView:function(){this._super(),this.mainNode.active=!1,this.equipmentSelectSideView.resetEquipmentSelectSideView()},initListView:function(t){this._super(t),this.mainNode.active=!0,this._initSideView(t)},_initSideView:function(t){this.equipmentSelectSideView.initEquipmentSelectSideView(t,this._callbackToRedraw.bind(this),this._callbackToSideExecute.bind(this))},_callbackToRedraw:function(){cc.error("_callbackToRedraw()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_callbackToSideExecute:function(){cc.error("_callbackToSideExecute(arguments)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")}});cc._RF.pop()},{EquipmentListViewBase:"EquipmentListViewBase",EquipmentSelectSideViewBase:"EquipmentSelectSideViewBase",GameConst:"GameConst",Singleton:"Singleton"}],EquipmentMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"0c3a5Cfhp9Dnpi1Kkt/X/Ba","EquipmentMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEquipmentId:function(){if(this._isKeyFieldAvailable("equipmentId"))return this._data.equipmentId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentId")},getEquipmentType:function(){if(this._isKeyFieldAvailable("equipmentType"))return this._data.equipmentType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentType")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getRarity:function(){if(this._isKeyFieldAvailable("rarity"))return this._data.rarity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rarity")},getAttribute:function(){if(this._isKeyFieldAvailable("attribute"))return this._data.attribute;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: attribute")},getMaterialType:function(){if(this._isKeyFieldAvailable("materialType"))return this._data.materialType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialType")},getExceedLimitType:function(){if(this._isKeyFieldAvailable("exceedLimitType"))return this._data.exceedLimitType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimitType")},getMaxLevel1:function(){if(this._isKeyFieldAvailable("maxLevel1"))return this._data.maxLevel1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel1")},getMaxLevel2:function(){if(this._isKeyFieldAvailable("maxLevel2"))return this._data.maxLevel2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel2")},getMaxLevel3:function(){if(this._isKeyFieldAvailable("maxLevel3"))return this._data.maxLevel3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel3")},getMaxLevel4:function(){if(this._isKeyFieldAvailable("maxLevel4"))return this._data.maxLevel4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxLevel4")},getMinHp1:function(){if(this._isKeyFieldAvailable("minHp1"))return this._data.minHp1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minHp1")},getMinHp2:function(){if(this._isKeyFieldAvailable("minHp2"))return this._data.minHp2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minHp2")},getMinHp3:function(){if(this._isKeyFieldAvailable("minHp3"))return this._data.minHp3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minHp3")},getMinHp4:function(){if(this._isKeyFieldAvailable("minHp4"))return this._data.minHp4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minHp4")},getMaxHp1:function(){if(this._isKeyFieldAvailable("maxHp1"))return this._data.maxHp1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp1")},getMaxHp2:function(){if(this._isKeyFieldAvailable("maxHp2"))return this._data.maxHp2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp2")},getMaxHp3:function(){if(this._isKeyFieldAvailable("maxHp3"))return this._data.maxHp3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp3")},getMaxHp4:function(){if(this._isKeyFieldAvailable("maxHp4"))return this._data.maxHp4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxHp4")},getMinAtk1:function(){if(this._isKeyFieldAvailable("minAtk1"))return this._data.minAtk1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minAtk1")},getMinAtk2:function(){if(this._isKeyFieldAvailable("minAtk2"))return this._data.minAtk2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minAtk2")},getMinAtk3:function(){if(this._isKeyFieldAvailable("minAtk3"))return this._data.minAtk3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minAtk3")},getMinAtk4:function(){if(this._isKeyFieldAvailable("minAtk4"))return this._data.minAtk4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minAtk4")},getMaxAtk1:function(){if(this._isKeyFieldAvailable("maxAtk1"))return this._data.maxAtk1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk1")},getMaxAtk2:function(){if(this._isKeyFieldAvailable("maxAtk2"))return this._data.maxAtk2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk2")},getMaxAtk3:function(){if(this._isKeyFieldAvailable("maxAtk3"))return this._data.maxAtk3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk3")},getMaxAtk4:function(){if(this._isKeyFieldAvailable("maxAtk4"))return this._data.maxAtk4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxAtk4")},getMinDef1:function(){if(this._isKeyFieldAvailable("minDef1"))return this._data.minDef1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minDef1")},getMinDef2:function(){if(this._isKeyFieldAvailable("minDef2"))return this._data.minDef2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minDef2")},getMinDef3:function(){if(this._isKeyFieldAvailable("minDef3"))return this._data.minDef3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minDef3")},getMinDef4:function(){if(this._isKeyFieldAvailable("minDef4"))return this._data.minDef4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: minDef4")},getMaxDef1:function(){if(this._isKeyFieldAvailable("maxDef1"))return this._data.maxDef1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef1")},getMaxDef2:function(){if(this._isKeyFieldAvailable("maxDef2"))return this._data.maxDef2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef2")},getMaxDef3:function(){if(this._isKeyFieldAvailable("maxDef3"))return this._data.maxDef3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef3")},getMaxDef4:function(){if(this._isKeyFieldAvailable("maxDef4"))return this._data.maxDef4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxDef4")},getTriggerType:function(){if(this._isKeyFieldAvailable("triggerType"))return this._data.triggerType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerType")},getTriggerValue:function(){if(this._isKeyFieldAvailable("triggerValue"))return this._data.triggerValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerValue")},getTriggerConditionType:function(){if(this._isKeyFieldAvailable("triggerConditionType"))return this._data.triggerConditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerConditionType")},getTriggerConditionValue:function(){if(this._isKeyFieldAvailable("triggerConditionValue"))return this._data.triggerConditionValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerConditionValue")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EquipmentMaterialModel:[function(t,e,i){"use strict";cc._RF.push(e,"1c17deSPldF7JYkZYmENvmE","EquipmentMaterialModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getMaterialType:function(){if(this._isKeyFieldAvailable("materialType"))return this._data.materialType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: materialType")},getAddExp:function(){if(this._isKeyFieldAvailable("addExp"))return this._data.addExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addExp")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EquipmentMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"219d1ecbExMSodJokLah8BL","EquipmentMatrixThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("EquipmentUtils"),r=t("MatrixThumbnailBase");cc.Class({extends:r,properties:{mainImageSprite:cc.Sprite,rarityImageSprite:cc.Sprite,attributeImageSprite:cc.Sprite,attributeFrameImageSprite:cc.Sprite,mainNode:cc.Node,equipedDispNode:cc.Node,plainNode:cc.Node,emptyNode:cc.Node,isProtectNode:cc.Node,isLimitedNode:cc.Node,isSelectedNode:cc.Node,plusDispNode:cc.Node,grayDispNode:cc.Node,selectedOrderNode:cc.Node,selectedOrderLabel:cc.Label,paramPrefixLabel:cc.Label,paramValueLabel:cc.Label,centerLabel:cc.Label,popVeilNode:cc.Node,popAnim:cc.Animation,thumbnailBtn:a},initEquipmentMatrixThumbnail:function(t,e,i,a){i=isNaN(i)?0:i,n.addSprite(this.mainImageSprite,n.getFileNameEquipmentThumbNail(t)),n.addSprite(this.rarityImageSprite,n.getFileNameRarityEquipmentFrame(i)),isNaN(e)||(n.addSprite(this.attributeImageSprite,n.getFileNameAttributeIcon(e)),n.addSprite(this.attributeFrameImageSprite,n.getFileNameRarityRing(i))),a&&this.setEquiped(!!o.getCharacterModelByEquipmentCd(a.getEquipmentCd()))},resetEquipmentMatrixThumbnail:function(){this.mainImageSprite.spriteFrame=null,this.rarityImageSprite.spriteFrame=null,this.attributeImageSprite.spriteFrame=null,this.attributeFrameImageSprite.spriteFrame=null,this.setCenterLabel(""),this.setEquiped(!1),this.setSelectedOrder(-1)},setEquiped:function(t){this.equipedDispNode.active=t,this.equipedDispNode.stopAllActions(),t&&this.equipedDispNode.runAction(cc.repeatForever(cc.sequence(cc.fadeIn(.5),cc.delayTime(1),cc.fadeOut(.5),cc.delayTime(3))))},setParameter:function(t,e){this.paramPrefixLabel.string=t+"",this.paramValueLabel.string=e+""},setCallbackToThumbnailBtn:function(t){this.thumbnailBtn.setTapEvent(t,"")},switchEmptyNodeActive:function(t){t&&this.setEquiped(!1),this.emptyNode.active=t,this.mainNode.active=!t},switchPlainNodeActive:function(t){this.plainNode.active=t,this.mainNode.active=!t},switchPlusNodeActive:function(t){this.plusDispNode.active=t},setActive:function(t){this.grayDispNode.active=!t},setProtected:function(t){this.isProtectNode.active=t},getProtected:function(){return this.isProtectNode.active},setLimited:function(t){this.isLimitedNode.active=t},setSelectedNodeActive:function(t){this.isSelectedNode.active=t},setSelectedOrder:function(t){var e=parseInt(t)>0;this.setSelectedNodeActive(e),this.selectedOrderNode.active=e,this.selectedOrderLabel.string=t},setCenterLabel:function(t,e){this.centerLabel.node.active=!!t,this.centerLabel.string=t,e&&(this.centerLabel.node.color=e)},playPopAnim:function(t){this.popVeilNode.active=!0,this.popAnim.play(),t&&this.popAnim.on("finished",function(e,i){if(i.name===this.popAnim.getClips()[0].name)return t()},this)}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentUtils:"EquipmentUtils",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils"}],EquipmentModel:[function(t,e,i){"use strict";cc._RF.push(e,"aa2e5VYQ1NJY4lscgL6DImB","EquipmentModel");var a=t("UserEquipmentModel"),n=(t("CommonUtils"),t("Singleton")),o=t("EquipmentConst"),r=t("ItemConst"),s=t("EquipmentUtils");cc.Class({userData:void 0,_equipmentMainMaster:void 0,_equipmentLevelMaster:void 0,_equipmentMaterialMaster:void 0,_equipmentEffectInfoMap:void 0,_equipmentEffectMaster:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t)},getEquipmentMaterialMaster:function(){return this._equipmentMaterialMaster||(this._equipmentMaterialMaster=n.dao.EquipmentMaterialMasters.find(function(t){return t.getMaterialType()===this.getMaterialType()}.bind(this))),this._equipmentMaterialMaster},getEquipmentMainMaster:function(){return this._equipmentMainMaster||(this._equipmentMainMaster=n.dao.EquipmentMainMasters.find(function(t){return t.getEquipmentId()===this.userData.getEquipmentId()}.bind(this))),this._equipmentMainMaster},getEquipmentEffectInfoMap:function(){return this._equipmentEffectInfoMap||(this._equipmentEffectInfoMap=s.createEquipmentEffectInfoMapByEquipmentId(this.getEquipmentId())),this._equipmentEffectInfoMap},getEquipmentLevelMaster:function(){return this._equipmentLevelMaster||(this._equipmentLevelMaster=_.find(n.dao.EquipmentLevelMasters,function(t){return t.getLevel()===this.getLevel()&&t.getExpType()===this.getRarity()}.bind(this))),this._equipmentLevelMaster},getEquipmentId:function(){return this.getEquipmentMainMaster().getEquipmentId()},getEquipmentCd:function(){return this.userData.getEquipmentCd()},getMaterialType:function(){return this.getEquipmentMainMaster().getMaterialType()},getName:function(){return this.getEquipmentMainMaster().getName()},getMaxHp:function(){var t=Math.max(Math.min(this.getRarity(),o.RARITY.SSR),o.RARITY.N);return this.getEquipmentMainMaster()["getMaxHp"+t].apply(this.getEquipmentMainMaster())},getMaxAtk:function(){var t=Math.max(Math.min(this.getRarity(),o.RARITY.SSR),o.RARITY.N);return this.getEquipmentMainMaster()["getMaxAtk"+t].apply(this.getEquipmentMainMaster())},getMaxDef:function(){var t=Math.max(Math.min(this.getRarity(),o.RARITY.SSR),o.RARITY.N);return this.getEquipmentMainMaster()["getMaxDef"+t].apply(this.getEquipmentMainMaster())},getMinHp:function(){var t=Math.max(Math.min(this.getRarity(),o.RARITY.SSR),o.RARITY.N);return this.getEquipmentMainMaster()["getMinHp"+t].apply(this.getEquipmentMainMaster())},getMinAtk:function(){var t=Math.max(Math.min(this.getRarity(),o.RARITY.SSR),o.RARITY.N);return this.getEquipmentMainMaster()["getMinAtk"+t].apply(this.getEquipmentMainMaster())},getMinDef:function(){var t=Math.max(Math.min(this.getRarity(),o.RARITY.SSR),o.RARITY.N);return this.getEquipmentMainMaster()["getMinDef"+t].apply(this.getEquipmentMainMaster())},getMaxLevel:function(){return s.getEquipmentMaxLevel(this.getEquipmentMainMaster(),this.getRarity())},getFortifyMaxLevel:function(){return this.getMaxLevel()-1},getHp:function(t){var e=this.getMaxHp(),i=this.getMinHp(),a=this.getFortifyLevel()/this.getFortifyMaxLevel(),n=Math.floor((e-i)*a+i);return t===this.getAttribute()&&(n=Math.floor(n*o.BOOST_RATE)),n},getHpEffect:function(t,e){return this._getEffectBonus(e,t,[o.EFFECT_TYPE.HP_RATE])},getAtk:function(t){var e=this.getMaxAtk(),i=this.getMinAtk(),a=this.getFortifyLevel()/this.getFortifyMaxLevel(),n=Math.floor((e-i)*a+i);return t===this.getAttribute()&&(n=Math.floor(n*o.BOOST_RATE)),n},getAtkEffect:function(t,e){return this._getEffectBonus(e,t,[o.EFFECT_TYPE.ATK_RATE])},getDef:function(t){var e=this.getMaxDef(),i=this.getMinDef(),a=this.getFortifyLevel()/this.getFortifyMaxLevel(),n=Math.floor((e-i)*a+i);return t===this.getAttribute()&&(n=Math.floor(n*o.BOOST_RATE)),n},getDefEffect:function(t,e){return this._getEffectBonus(e,t,[o.EFFECT_TYPE.DEF_RATE])},getTotalPower:function(t,e,i,a){var n=this.getHp(t),o=this.getHpEffect(t,e+n),r=this.getAtk(t),s=this.getAtkEffect(t,i+r),c=this.getDef(t);return n+o+r+s+c+this.getDefEffect(t,a+c)},_getEffectBonus:function(t,e,i){if(t){var a=[];a=e===this.getAttribute()?this._getEffectMasterArrayByBuffType(r.EQUIPMENT_BOOST_TYPE.BOOST,i):this._getEffectMasterArrayByBuffType(r.EQUIPMENT_BOOST_TYPE.NORMAL,i);var n=_.reduce(a,function(t,e){return t+.01*e.getEffectValue()},0);return Math.floor(t*n)}return 0},getAttribute:function(){return this.getEquipmentMainMaster().getAttribute()},getText:function(){return this.getEquipmentMainMaster().getText()},getLevel:function(){return this.userData.getLevel()},getIsLevelMax:function(){return this.getLevel()===this.getMaxLevel()},getFortifyLevel:function(){return this.userData.getLevel()-1},getIsProtect:function(){return this.userData.getIsProtect()},getIsCharacterEquipment:function(){return!!s.getCharacterModelByEquipmentCd(this.getEquipmentCd())},getNeedMaterials:function(){var t={};return this.getEquipmentMaterialMaster().getItemId1()&&(t[this.getEquipmentMaterialMaster().getItemId1()]=this.getEquipmentMaterialMaster().getItemCount1()),this.getEquipmentMaterialMaster().getItemId2()&&(t[this.getEquipmentMaterialMaster().getItemId2()]=this.getEquipmentMaterialMaster().getItemCount2()),this.getEquipmentMaterialMaster().getItemId3()&&(t[this.getEquipmentMaterialMaster().getItemId3()]=this.getEquipmentMaterialMaster().getItemCount3()),this.getEquipmentMaterialMaster().getItemId4()&&(t[this.getEquipmentMaterialMaster().getItemId4()]=this.getEquipmentMaterialMaster().getItemCount4()),this.getEquipmentMaterialMaster().getItemId5()&&(t[this.getEquipmentMaterialMaster().getItemId5()]=this.getEquipmentMaterialMaster().getItemCount5()),t},getFortifyPrice:function(){return this.getEquipmentLevelMaster().getFortifyPrice()},getAddExp:function(){return this.getEquipmentMaterialMaster().getAddExp()},getExp:function(){return this.userData.getExp()},getExceedLimit:function(){return this.userData.getExceedLimit()},getRarity:function(){return Math.min(this.getEquipmentMainMaster().getRarity()+this.getExceedLimit(),o.RARITY.SSR)},getSalePrice:function(){return this.getEquipmentLevelMaster().getSalePrice()},getEquipmentType:function(){return this.getEquipmentMainMaster().getEquipmentType()},getExceedLimitType:function(){return this.getEquipmentMainMaster().getExceedLimitType()},getEquipmentEffectMaster:function(){return this._equipmentEffectMaster||(this._equipmentEffectMaster=n.dao.EquipmentEffectMasters.filter(function(t){return t.getEquipmentId()===this.getEquipmentId()&&t.getRarity()===this.getRarity()}.bind(this))),this._equipmentEffectMaster},_getEffectMasterArrayByBuffType:function(t,e){if(this.getEquipmentEffectInfoMap()[t][this.getRarity()]&&this.getEquipmentEffectInfoMap()[t][this.getRarity()].releaseRarity<=this.getRarity()){var i=this.getEquipmentEffectInfoMap()[t][this.getRarity()].effectMasterArray;return i=_.filter(i,function(t){return _.some(e,function(e){return e===t.getActionType()})})}return[]},getEffectTextForNormal:function(){return this.getEquipmentEffectInfoMap()[r.EQUIPMENT_BOOST_TYPE.NORMAL][this.getRarity()]?this.getEquipmentEffectInfoMap()[r.EQUIPMENT_BOOST_TYPE.NORMAL][this.getRarity()].effectTextArray:[]},getEffectTextForBoost:function(){return this.getEquipmentEffectInfoMap()[r.EQUIPMENT_BOOST_TYPE.BOOST][this.getRarity()]?this.getEquipmentEffectInfoMap()[r.EQUIPMENT_BOOST_TYPE.BOOST][this.getRarity()].effectTextArray:[]},isCanExceedLimit:function(){return s.isCanExceedLimitEquipment(this)}});cc._RF.pop()},{CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",Singleton:"Singleton",UserEquipmentModel:"UserEquipmentModel"}],EquipmentMultipleSelectListWithSideViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"329a84bPzRDVZ9e17tadpt4","EquipmentMultipleSelectListWithSideViewBase");var a=t("Singleton"),n=t("EquipmentUtils"),o=t("EquipmentListWithSideViewBase");cc.Class({extends:o,properties:{},initListView:function(t){this.matrixPageView.setCallBackToIsImageActive(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsThumbnailEnabled.bind(this)),this.equipmentSelectSideView.setCallbackToResetBtn(this._callbackToResetBtn.bind(this)),this.equipmentSelectSideView.setCallbackToMaterialThumbnail(this._callbackToMaterialThumbnail.bind(this)),this.equipmentSelectSideView.setCheckLimit(this._getCheckLimit()),this._super(t)},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView("getEquipmentCd",n.getMaterialEquipmentModelArray(this._root.getTargetEquipmentCd()),a.dao.userBasicData.getEquipmentMaxCount(),[],this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToThumbnail:function(t){this.equipmentSelectSideView.drawEquipmentSelectSideView(t)},_callbackIsThumbnailEnabled:function(t,e){return!t.getIsProtect()&&!(e.length>=this._getCheckLimit()&&!e.find(function(e){return e.getEquipmentCd()===t.getEquipmentCd()}))},_getCheckLimit:function(){return 10},_callbackToRedraw:function(t){this.matrixPageView.initMatrixPageView("getEquipmentCd",n.getMaterialEquipmentModelArray(this._root.getTargetEquipmentCd()),a.dao.userBasicData.getEquipmentMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)},_callbackToSideExecute:function(t){cc.error("_callbackToSideExecute(checkedModelArray)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_callbackToResetBtn:function(){this.matrixPageView.clearCheckedModelArray(),this.matrixPageView.redraw(),this.equipmentSelectSideView.drawEquipmentSelectSideView([])},_callbackToMaterialThumbnail:function(t){var e=this.matrixPageView.getCheckedModelArray().filter(function(e){return e.getEquipmentCd()!==t.getEquipmentCd()});this.matrixPageView.initMatrixPageView("getEquipmentCd",n.getMaterialEquipmentModelArray(this._root.getTargetEquipmentCd()),a.dao.userBasicData.getEquipmentMaxCount(),e,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(e)}});cc._RF.pop()},{EquipmentListWithSideViewBase:"EquipmentListWithSideViewBase",EquipmentUtils:"EquipmentUtils",Singleton:"Singleton"}],EquipmentMultipleSelectSideViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"2a8f9nnnEpB6KUeC9fjsff3","EquipmentMultipleSelectSideViewBase");var a=t("CommonButton"),n=(t("EquipmentUtils"),t("GameConst")),o=t("EquipmentSelectSideViewBase"),r=t("EquipmentProgressSimpleView");cc.Class({extends:o,properties:{equipmentProgressView:r,materialThumbnailPrefab:cc.Prefab,materialParentNode:cc.Node,priceLabel:cc.Label,resetBtn:a},_checkLimit:null,_callbackToResetBtn:null,_callbackToMaterialThumbnail:null,_checkedModelArray:null,onLoad:function(){this._super(),this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL)},initEquipmentSelectSideView:function(t,e,i){this._super(t,e,i),this._checkedModelArray=[],this._drawMaterials([]),this._switchButtonsActive(!1),this.equipmentProgressView.resetEquipmentSimpleProgressView(),this.equipmentProgressView.setCallbackToInfoBtn(this._callbackToInfoBtn.bind(this))},drawEquipmentSelectSideView:function(t){this._switchButtonsActive(t.length>0),this._checkedModelArray=t,this._drawMaterials(t)},_switchButtonsActive:function(t){this.executeBtn.setTouchEnable(t),this.executeBtn.switchBtnImage(t),this.resetBtn.setTouchEnable(t),this.resetBtn.switchBtnImage(t)},setCheckLimit:function(t){this._checkLimit=t},setCallbackToResetBtn:function(t){this._callbackToResetBtn=t},setCallbackToMaterialThumbnail:function(t){this._callbackToMaterialThumbnail=t},_drawMaterials:function(t){this.materialParentNode.destroyAllChildren();for(var e=0;e<this._checkLimit;e+=1){var i=cc.instantiate(this.materialThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");t[e]?(i.initEquipmentMatrixThumbnail(t[e].getEquipmentId(),t[e].getAttribute(),t[e].getRarity(),t[e]),i.setParameter("Lv.",t[e].getLevel()+""),i.switchPlainNodeActive(!1),this._callbackToMaterialThumbnail&&i.setCallbackToThumbnailBtn(this._callbackToMaterialThumbnail.bind(this,t[e],t))):i.switchPlainNodeActive(!0),this.materialParentNode.addChild(i.node)}this.priceLabel.node.color=this._getPriceTextColor(t),this.priceLabel.string=this._getPriceText(t)},_getPriceTextColor:function(t){return cc.error("_getPriceTextColor(checkedModelArray)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),n.COLOR_STATE.NORMAL},_getPriceText:function(t){return cc.error("_getPriceText(checkedModelArray)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),t.length+""},_callbackToInfoBtn:function(t){t&&this._root.openEquipmentDetailPopup(t)},_onTapExecuteBtn:function(){this._callbackToExecuteBtn&&this._callbackToExecuteBtn(this._checkedModelArray)},_onTapResetBtn:function(){this._checkedModelArray=[],this._callbackToResetBtn&&this._callbackToResetBtn()}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentProgressSimpleView:"EquipmentProgressSimpleView",EquipmentSelectSideViewBase:"EquipmentSelectSideViewBase",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst"}],EquipmentProgressSimpleView:[function(t,e,i){"use strict";cc._RF.push(e,"4fbf3eNPgJErqKGfHwnMyIp","EquipmentProgressSimpleView");var a=t("CommonButton"),n=t("EquipmentUtils"),o=(t("ViewUtils"),t("EquipmentConst"));cc.Class({extends:cc.Component,properties:{infoBtn:a,equipmentNameLabel:cc.Label,thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,levelProgressViewPrefab:cc.Prefab,levelProgressViewParentNode:cc.Node},_matrixThumbnail:void 0,_levelProgressView:void 0,_equipmentModel:void 0,_callbackToInfoBtn:null,onLoad:function(){this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),"")},resetEquipmentSimpleProgressView:function(){this._equipmentModel=void 0,this._drawEquipmentName(void 0),this._drawEquipmentThumbnail(void 0),this._addLevelProgress(),this.drawEquipmentProgressView(o.PROMOTE_TYPE.STATUS,[])},drawEquipmentSimpleProgressView:function(t,e){this._equipmentModel=t,this._drawEquipmentName(t),this._drawEquipmentThumbnail(t),this._addLevelProgress(t),this.drawEquipmentProgressView(e,[])},getEquipmentModel:function(){return this._equipmentModel},setCallbackToInfoBtn:function(t){this._callbackToInfoBtn=t},_onTapInfoBtn:function(){this._callbackToInfoBtn&&this._callbackToInfoBtn(this._equipmentModel)},_drawEquipmentName:function(t){this.equipmentNameLabel.string=t?t.getName():"\u672a\u9078\u629e"},_drawEquipmentThumbnail:function(t){this._matrixThumbnail||(this._matrixThumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.thumbnailParentNode.addChild(this._matrixThumbnail.node)),t?(this._matrixThumbnail.switchPlainNodeActive(!1),this._matrixThumbnail.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),this._matrixThumbnail.setParameter("Lv.",t.getLevel())):this._matrixThumbnail.switchPlainNodeActive(!0)},_addLevelProgress:function(){this._levelProgressView||(this._levelProgressView=cc.instantiate(this.levelProgressViewPrefab).getComponent("CharacterLevelProgressView"),this.levelProgressViewParentNode.addChild(this._levelProgressView.node))},_setInfoButton:function(t){this.infoBtn.transition=t?cc.Button.Transition.NONE:cc.Button.Transition.COLOR,this.infoBtn.interactable=t,this.infoBtn.setTouchEnable(t)},drawEquipmentProgressView:function(t,e){if(!this._equipmentModel)return this.levelProgressViewParentNode.active=!1,void this._setInfoButton(!1);this._setInfoButton(this._equipmentModel.getEquipmentMainMaster().getEquipmentType()===o.EQUIPMENT_TYPE.NORMAL),this.levelProgressViewParentNode.active=!0;var i=this._equipmentModel.getLevel(),a=this._equipmentModel.getLevel(),r=this._equipmentModel.getMaxLevel(),s=this._equipmentModel.getMaxLevel(),c=n.calcNeedExpForNextLevelByTotalExp(this._equipmentModel.getExp(),this._equipmentModel.getMaxLevel(),this._equipmentModel.getRarity()),l=n.calcExpRateForNextLevelByTotalExp(this._equipmentModel.getExp(),this._equipmentModel.getMaxLevel(),this._equipmentModel.getRarity()),u=0,h=0;if(Array.isArray(e)&&e.length>0)switch(t){case o.PROMOTE_TYPE.FORTIFY:var d=this._equipmentModel.getExp()+n.calcTotalMaterialExp(e,this._equipmentModel.getEquipmentMainMaster());a=n.getEquipmentLevelByTotalExp(d,this._equipmentModel.getMaxLevel(),this._equipmentModel.getRarity()),c=n.calcNeedExpForNextLevelByTotalExp(d,this._equipmentModel.getMaxLevel(),this._equipmentModel.getRarity()),u=n.calcExpRateForNextLevelByTotalExp(d,this._equipmentModel.getMaxLevel(),this._equipmentModel.getRarity()),u=i<a?1:u;break;case o.PROMOTE_TYPE.EXCEED_LIMIT:i=1,h=e.length,s=n.getEquipmentMaxLevel(this._equipmentModel.getEquipmentMainMaster(),this._equipmentModel.getRarity()+h)}this._levelProgressView.initCharacterLevelProgressView(t,i,a,r,s,c,l,u)}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentConst:"EquipmentConst",EquipmentUtils:"EquipmentUtils",ViewUtils:"ViewUtils"}],EquipmentProtectSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"b27afNfS+VJ54+f+YlezzZi","EquipmentProtectSelectListView");var a=t("Singleton"),n=t("EquipmentUtils"),o=t("EquipmentListViewBase"),r=t("ItemConst"),s=t("EquipmentFilterConst");cc.Class({extends:o,properties:{},_setListContent:function(t){this.matrixPageView.initMatrixPageView(n.getEquipmentModelArrayByEquipmentType(r.EQUIPMENT_TYPE.ATK),a.dao.userBasicData.getEquipmentMaxCount(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToThumbnail:function(t,e){this._root.requestEquipmentProtect(e,function(){this.matrixPageView.setDataList(n.getEquipmentModelArrayByEquipmentType(r.EQUIPMENT_TYPE.ATK)),this.matrixPageView.sortAndFilter(),this.matrixPageView.redrawSimply()}.bind(this))},_callbackToCreateFilterConditions:function(t){for(var e=[],i=s.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1){var r=s.EQUIP_FILTER_FUNC_NAME[Object.keys(s.EQUIP_FILTER_TYPE)[o]];r&&(t[o]?a=!1:n.push({propertyName:i,getterName:r}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]))}return e}});cc._RF.pop()},{EquipmentFilterConst:"EquipmentFilterConst",EquipmentListViewBase:"EquipmentListViewBase",EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",Singleton:"Singleton"}],EquipmentRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"ac6ebw3SNJKMJhFYf6erfiZ","EquipmentRootUtils"),e.exports={openEquipmentSelectSubRoot:function(t,e){cc.log("openEquipmentSelectSubRoot"),cc.log(e),t.equipmentSelectSubRoot||(t.equipmentSelectSubRoot=cc.instantiate(t.equipmentSelectSubRootPrefab).getComponent("EquipmentSelectSubRoot"),t.subRootParent.addChild(t.equipmentSelectSubRoot.node)),t.setSelectedTab(e.tabIndex),e.isMaterialSelect&&!t.getTargetEquipmentCd()&&t.setTargetEquipmentCd(e.equipmentCd),t.setIsMaterialSelect(e.isMaterialSelect),t.equipmentSelectSubRoot.initEquipmentSelectSubRoot(t,t.getSelectedTab())},closeEquipmentSelectSubRoot:function(t,e){cc.log("closeEquipmentSelectSubRoot"),cc.log(e),t.equipmentSelectSubRoot&&(t.equipmentSelectSubRoot.node.destroy(),t.equipmentSelectSubRoot=null)}},cc._RF.pop()},{}],EquipmentRoot:[function(t,e,i){"use strict";cc._RF.push(e,"f4cf3VanipD64dnvWc/HRn9","EquipmentRoot");var a=t("OutGameRootBase"),n=t("EquipmentUtils"),o=t("Singleton"),r=t("CommonUtils"),s=t("ItemUtils"),c=t("PopupUtils"),l=t("WarehouseConvertUtils"),u=t("AnimationUtils"),h=t("EquipmentViewSetting"),d=t("GameConst"),p=t("EquipmentConst"),m=t("EquipmentSortConst"),g=t("EquipmentFilterConst"),C=t("LocalDataConst"),f=t("ItemConst"),E=t("ResourceConst"),T=t("WarehouseConst");cc.Class({extends:a,properties:{equipmentSelectSubRootPrefab:cc.Prefab,equipmentRecommendedFortifyMaterialSelectPopupPrefab:cc.Prefab,equipmentRecommendedSellMaterialSelectPopupPrefab:cc.Prefab,equipmentSellConfirmPopupPrefab:cc.Prefab,equipmentSellCompletePopupPrefab:cc.Prefab,equipmentAlertPopupPrefab:cc.Prefab,equipmentFortifyConfirmPopupPrefab:cc.Prefab,equipmentFortifyCompletePopupPrefab:cc.Prefab,equipmentDetailPopupPrefab:cc.Prefab,equipmentExceedLimitConfirmPopup:cc.Prefab,equipmentExceedLimitCompletePopup:cc.Prefab,equipmentRemoveConfirmPopupPrefab:cc.Prefab},materialDataType:0,warehouseCountInfoArray:null,_isMaterialSelect:!1,_equipmentModelMap:null,_targetEquipmentCd:null,_selectedTab:0,_currentSortType:0,_currentSortOrder:0,_currentFilterCheckList:0,_equipmentRecommendedFortifyMaterialSelectPopup:null,_equipmentRecommendedSellMaterialSelectPopup:null,_equipmentSellConfirmPopup:null,_equipmentSellCompletePopup:null,_equipmentAlertPopup:null,_equipmentFortifyConfirmPopup:null,_equipmentFortifyCompletePopup:null,_equipmentDetailPopup:null,_equipmentExceedLimitConfirmPopup:null,_equipmentExceedLimitCompletePopup:null,_equipmentRemoveConfirmPopup:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,h.EQUIPMENT_SETTING)},initData:function(){this.reload(),this._isMaterialSelect=!1,this._currentSortType=m.SORT_TYPE.GETTING,this._currentSortOrder=d.SORT_ORDER.ASC,this._currentFilterCheckList=o.localData[C.FILTER.TWELVE.EQUIPMENT],this.materialDataType=T.WAREHOUSE_STORAGE_TYPE.EQUIPMENT,this.warehouseCountInfoArray=[]},initResource:function(){this._super(),this.requestRes(E.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_BASE,cc.Prefab),this.requestRes(E.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_FORTIFY,cc.Prefab),this.requestRes(E.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_EQUIPMENT_WAREHOUSE,cc.Prefab)},initialize:function(){this.initOutGameRootBase();this._initOpenFirstView({EquipmentSelectSubRoot:{tabIndex:0}})},reload:function(){this._equipmentModelMap=n.getEquipmentModelMap()},redraw:function(){this.equipmentSelectSubRoot&&this.equipmentSelectSubRoot.initEquipmentSelectSubRoot(this,this.getSelectedTab()),this.redrawUIHeader()},pushEquipmentSelectSubRoot:function(t){var e={EquipmentSelectSubRoot:{tabIndex:this.getSelectedTab(),isMaterialSelect:t,equipmentCd:this.getTargetEquipmentCd()}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),e,this.createPreViewParam())},transitionShop:function(){var t={ShopSelectSubRoot:{shopCategory:f.SHOP_CATEGORY.BOX}};this.pushScene("ShopScene",this.getCurrentSceneName(),t,this.createPreViewParam())},createPreViewParam:function(){var t={};return this.equipmentSelectSubRoot&&(t.EquipmentSelectSubRoot={tabIndex:this.getSelectedTab(),isMaterialSelect:this.getIsMaterialSelect(),equipmentCd:this.getTargetEquipmentCd()}),t},openRecommendedFortifyMaterialSelectPopup:function(t,e,i,a){this.closeRecommendedFortifyMaterialSelectPopup(),this._equipmentRecommendedFortifyMaterialSelectPopup=cc.instantiate(this.equipmentRecommendedFortifyMaterialSelectPopupPrefab).getComponent("RecommendedMaterialSelectPopup"),this._equipmentRecommendedFortifyMaterialSelectPopup.openRecommendedMaterialSelectPopup(t,o.localData[C.FILTER.SIX.EQUIPMENT_FORTIFY_RECOMMEND],function(t){o.localData[C.FILTER.SIX.EQUIPMENT_FORTIFY_RECOMMEND]=t,a(this._createRecommendFortifyMaterialArray(t,e,i))}.bind(this))},closeRecommendedFortifyMaterialSelectPopup:function(){this._equipmentRecommendedFortifyMaterialSelectPopup&&(this._equipmentRecommendedFortifyMaterialSelectPopup.close(),this._equipmentRecommendedFortifyMaterialSelectPopup=null)},openRecommendedSellMaterialSelectPopup:function(t,e,i){this.closeRecommendedSellMaterialSelectPopup(),this._equipmentRecommendedSellMaterialSelectPopup=cc.instantiate(this.equipmentRecommendedSellMaterialSelectPopupPrefab).getComponent("RecommendedMaterialSelectPopup"),this._equipmentRecommendedSellMaterialSelectPopup.openRecommendedMaterialSelectPopup(t,o.localData[C.FILTER.SIX.EQUIPMENT_SELL_RECOMMEND],function(t){o.localData[C.FILTER.SIX.EQUIPMENT_SELL_RECOMMEND]=t.slice(),i(this._createRecommendSellMaterialArray(t,e))}.bind(this))},closeRecommendedSellMaterialSelectPopup:function(){this._equipmentRecommendedSellMaterialSelectPopup&&(this._equipmentRecommendedSellMaterialSelectPopup.close(),this._equipmentRecommendedSellMaterialSelectPopup=null)},openEquipmentSellConfirmPopup:function(t){this.closeEquipmentSellConfirmPopup(),this._equipmentSellConfirmPopup=cc.instantiate(this.equipmentSellConfirmPopupPrefab).getComponent("EquipmentSellConfirmPopup"),this._equipmentSellConfirmPopup.openEquipmentSellConfirmPopup(t,function(e){this.requestEquipmentSell(t)}.bind(this))},closeEquipmentSellConfirmPopup:function(){this._equipmentSellConfirmPopup&&(this._equipmentSellConfirmPopup.close(),this._equipmentSellConfirmPopup=null)},openEquipmentSellCompletePopup:function(t){this.closeEquipmentSellCompletePopup(),this._equipmentSellCompletePopup=cc.instantiate(this.equipmentSellCompletePopupPrefab).getComponent("EquipmentSellCompletePopup"),this._equipmentSellCompletePopup.openEquipmentSellCompletePopup(t,function(){this.reload(),this.redraw()}.bind(this))},closeEquipmentSellCompletePopup:function(){this._equipmentSellCompletePopup&&(this._equipmentSellCompletePopup.close(),this._equipmentSellCompletePopup=null)},openEquipmentAlertPopup:function(t,e,i){this.closeEquipmentAlertPopup(),this._equipmentAlertPopup=cc.instantiate(this.equipmentAlertPopupPrefab).getComponent("EquipmentAlertPopup"),this._equipmentAlertPopup.openEquipmentAlertPopup(t,e,i)},closeEquipmentAlertPopup:function(){this._equipmentAlertPopup&&(this._equipmentAlertPopup.close(),this._equipmentAlertPopup=null)},openEquipmentFortifyConfirmPopup:function(t,e){this.closeEquipmentFortifyConfirmPopup(),this._equipmentFortifyConfirmPopup=cc.instantiate(this.equipmentFortifyConfirmPopupPrefab).getComponent("EquipmentFortifyConfirmPopup"),this._equipmentFortifyConfirmPopup.openEquipmentFortifyConfirmPopup(t,e,this.requestFortifyEquipment.bind(this,t,e))},closeEquipmentFortifyConfirmPopup:function(){this._equipmentFortifyConfirmPopup&&(this._equipmentFortifyConfirmPopup.close(),this._equipmentFortifyConfirmPopup=null)},openEquipmentFortifyCompletePopup:function(t,e,i){this.closeEquipmentFortifyCompletePopup(),this._equipmentFortifyCompletePopup=cc.instantiate(this.equipmentFortifyCompletePopupPrefab).getComponent("EquipmentFortifyCompletePopup");var a=this._equipmentFortifyCompletePopup.openEquipmentFortifyCompletePopup.bind(this._equipmentFortifyCompletePopup,t,e,i,function(){this.reload(),this.redraw()}.bind(this));i?u.playResultRibbonAnimation(d.RESULT_RIBBON_ANIM_IDX.FORTIFY_GREAT,a):u.playResultRibbonAnimation(d.RESULT_RIBBON_ANIM_IDX.FORTIFY_NORMAL,a)},closeEquipmentFortifyCompletePopup:function(){this._equipmentFortifyCompletePopup&&(this._equipmentFortifyCompletePopup.close(),this._equipmentFortifyCompletePopup=null)},openEquipmentDetailPopup:function(t){this.closeEquipmentDetailPopup(),this._equipmentDetailPopup=cc.instantiate(this.equipmentDetailPopupPrefab).getComponent("EquipmentDetailPopup"),this._equipmentDetailPopup.openEquipmentDetailPopup(t)},closeEquipmentDetailPopup:function(){this._equipmentDetailPopup&&(this._equipmentDetailPopup.close(),this._equipmentDetailPopup=null)},openEquipmentExceedLimitCompletePopup:function(t,e){this.closeEquipmentExceedLimitCompletePopup(),this._equipmentExceedLimitCompletePopup=cc.instantiate(this.equipmentExceedLimitCompletePopup).getComponent("EquipmentExceedLimitCompletePopup"),u.playResultRibbonAnimation(d.RESULT_RIBBON_ANIM_IDX.EXCEED_EQUIP,this._equipmentExceedLimitCompletePopup.openEquipmentExceedLimitCompletePopup.bind(this._equipmentExceedLimitCompletePopup,t,e,function(){this.reload(),this.redraw()}.bind(this)))},closeEquipmentExceedLimitCompletePopup:function(){this._equipmentExceedLimitCompletePopup&&(this._equipmentExceedLimitCompletePopup.close(),this._equipmentExceedLimitCompletePopup=null)},openEquipmentExceedLimitConfirmPopup:function(t,e){var i=n.calcExceedLimitPrice(t,e);s.getUserItemCount(d.ITEM_ID_GOLD)>=i?(this.closeEquipmentExceedLimitConfirmPopup(),this._equipmentExceedLimitConfirmPopup=cc.instantiate(this.equipmentExceedLimitConfirmPopup).getComponent("EquipmentExceedLimitConfirmPopup"),this._equipmentExceedLimitConfirmPopup.openEquipmentExceedLimitConfirmPopup(t,e,function(){this.requestExceedLimitEquipment(t,e)}.bind(this))):c.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},closeEquipmentExceedLimitConfirmPopup:function(){this._equipmentExceedLimitConfirmPopup&&(this._equipmentExceedLimitConfirmPopup.close(),this._equipmentExceedLimitConfirmPopup=null)},openEquipmentRemoveConfirmPopup:function(t,e){this.closeEquipmentRemoveConfirmPopup(),this._equipmentRemoveConfirmPopup=cc.instantiate(this.equipmentRemoveConfirmPopupPrefab).getComponent("ThumbnailTextPopup"),this._equipmentRemoveConfirmPopup.openThumbnailTextPopup(cc.instantiate(t),"\u88c5\u5099\u89e3\u9664\u78ba\u8a8d","\u88c5\u5099\u3092\u306f\u305a\u3057\u307e\u3059\u304b\uff1f",function(){this.requestCharacterEquip(this.createReleaseCharactersEquipmentParameter(e))}.bind(this),function(){},"\u88c5\u5099\u3092\u306f\u305a\u3059","\u30ad\u30e3\u30f3\u30bb\u30eb")},closeEquipmentRemoveConfirmPopup:function(){this._equipmentRemoveConfirmPopup&&(this._equipmentRemoveConfirmPopup.close(),this._equipmentRemoveConfirmPopup=null)},requestEquipmentSell:function(t){o.EquipmentService.sell(this._createEquipmentCds(t),function(){this.openEquipmentSellCompletePopup(t)}.bind(this))},_createEquipmentCds:function(t){var e=[];for(var i in t)e.push(t[i].getEquipmentCd());return e},requestEquipmentProtect:function(t,e){o.EquipmentService.changeProtect([t.getEquipmentCd()],function(){this.reload(),e&&e()}.bind(this))},requestCharacterEquip:function(t,e){o.CharacterService.equip(t,function(){this.reload(),this.redraw(),e&&e()}.bind(this))},requestFortifyEquipment:function(t,e,i){switch(this.materialDataType){case T.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this._requestFortifyEquipmentNormal(t,e,i);break;default:this._requestFortifyEquipmentWarehouse(t,e,i)}},_requestFortifyEquipmentNormal:function(t,e,i){o.EquipmentService.fortify(t.getEquipmentCd(),this._createEquipmentCds(e),function(i){this.openEquipmentFortifyCompletePopup(t,e,i.isGreatSuccess)}.bind(this))},_requestFortifyEquipmentWarehouse:function(t,e,i){o.EquipmentService.fortifyWarehouse(t.getEquipmentCd(),this._createParameterForMaterialWarehouseTypeParameter(this.warehouseCountInfoArray),function(i){this.openEquipmentFortifyCompletePopup(t,e,i.isGreatSuccess)}.bind(this))},_createParameterForMaterialWarehouseTypeParameter:function(t){return _.map(t,function(t){var e="",i=0;switch(t.model.getWarehouseType()){case T.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:e=t.model.getEquipmentCd(),i=T.WAREHOUSE_STORAGE_TYPE.EQUIPMENT;break;case T.WAREHOUSE_STORAGE_TYPE.MATERIAL:e=t.model.getMaterialCd(),i=T.WAREHOUSE_STORAGE_TYPE.MATERIAL}return{code:e,count:t.count,warehouseType:i}})},requestExceedLimitEquipment:function(t,e){switch(this.materialDataType){case T.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this._requestExceedLimitEquipmentNormal(t,e);break;default:this._requestExceedLimitEquipmentWarehouse(t,e)}},_requestExceedLimitEquipmentNormal:function(t,e){o.EquipmentService.exceedLimit(t.getEquipmentCd(),e.getEquipmentCd(),function(){this.setIsMaterialSelect(!1),this.openEquipmentExceedLimitCompletePopup(t,n.getEquipmentModelMap()[t.getEquipmentCd()])}.bind(this))},_requestExceedLimitEquipmentWarehouse:function(t,e){if(!(e=this.warehouseCountInfoArray[0].model)||e.getCount()<=0)return c.openSimpleMessageWindow("\u9032\u5316\u7d20\u6750\u304c\u3042\u308a\u307e\u305b\u3093\u3001");o.EquipmentService.exceedLimitWarehouse(t.getEquipmentCd(),e.getEquipmentCd(),e.getWarehouseType(),function(){this.setIsMaterialSelect(!1),this.openEquipmentExceedLimitCompletePopup(t,n.getEquipmentModelMap()[t.getEquipmentCd()])}.bind(this))},setIsMaterialSelect:function(t){this._isMaterialSelect=t},getIsMaterialSelect:function(){return this._isMaterialSelect},getEquipmentModelMap:function(){return this._equipmentModelMap},setTargetEquipmentCd:function(t){this._targetEquipmentCd=t},getTargetEquipmentCd:function(){return this._targetEquipmentCd},getTargetEquipmentModel:function(){return this._equipmentModelMap[this._targetEquipmentCd]},setSelectedTab:function(t){this._selectedTab=parseInt(t)},getSelectedTab:function(){return this._selectedTab},setSortAndFilterParam:function(t,e,i){r.saveLocalStorage(C.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,t),r.saveLocalStorage(C.LOCAL_STORAGE_KEY.SORT_ORDER_EQUIPMENT,e);for(var a=0;a<i.length;a+=1)o.localData[C.FILTER.TWELVE.EQUIPMENT][a]=i[a],this._currentFilterCheckList[a]=i[a]},getCurrentSortType:function(t){return r.loadLocalStorage(C.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,m.SORT_TYPE.GETTING,C.LOCAL_STORAGE_GET_TYPE.INTEGER)},getCurrentSortOrder:function(t){return r.loadLocalStorage(C.LOCAL_STORAGE_KEY.SORT_ORDER_EQUIPMENT,d.SORT_ORDER.ASC,C.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},getCurrentFilterCheckList:function(){return this._currentFilterCheckList},_createRecommendFortifyMaterialArray:function(t,e,i){var a=t.slice(),o=a.pop();switch(this.materialDataType){case T.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:this._recommendMaterialArray=r.filterModels(n.getMaterialEquipmentModelArray(this._targetEquipmentCd),this.createFortifyMaterialFilterConditions(a));break;default:this._recommendMaterialArray=[],Array.prototype.push.apply(this._recommendMaterialArray,l.convertWarehouseModelsToEquipments(T.WAREHOUSE_STORAGE_TYPE.EQUIPMENT,p.EQUIPMENT_TYPE.NORMAL)),Array.prototype.push.apply(this._recommendMaterialArray,l.convertWarehouseModelsToEquipments(T.WAREHOUSE_STORAGE_TYPE.MATERIAL,p.EQUIPMENT_TYPE.FORTIFY_MATERIAL)),this._recommendMaterialArray=r.filterModels(this._recommendMaterialArray,this.createFortifyMaterialFilterConditions(a))}var s=[];s.push({getterName:"getAddExp",order:"desc"}),this._recommendMaterialArray=r.sortModels(this._recommendMaterialArray,s);var c,u=_.filter(this._recommendMaterialArray,function(t){return t.getAttribute()===i}),h=_.filter(this._recommendMaterialArray,function(t){return t.getAttribute()!==i}),d=0;h.length>0&&(c=h[h.length-1],d=c.getAddExp()),u.length>0&&(c=u[u.length-1],(d<=0||d>c.getAddExp()*p.SAME_ATTRIBUTE_MATERIAL_BONUS_RATE)&&(d=c.getAddExp()*p.SAME_ATTRIBUTE_MATERIAL_BONUS_RATE)),o&&(this._recommendMaterialArray=u.concat(h));var m=n.getEuqipmentLevelMasterByLevel(this.getTargetEquipmentModel().getMaxLevel(),this.getTargetEquipmentModel().getEquipmentLevelMaster().getExpType()).getTotalExp(),g=[];return this._recommendMaterialArray=_.filter(this._recommendMaterialArray,function(t){return g.push(t),n.calcTotalMaterialExp(g,this.getTargetEquipmentModel())+this.getTargetEquipmentModel().getExp()<=m+d||(g.pop(),!1)}.bind(this)),this._recommendMaterialArray.length>e&&(this._recommendMaterialArray.length=e),this._recommendMaterialArray},createFortifyMaterialFilterConditions:function(t){for(var e=[],i=g.PROPERTY_NAME,a=0;a<t.length;a+=1)this._isFilteringOn(a,t[a])&&e.push({propertyName:i,getterName:g.MATERIAL_FILTER_FUNC_NAME[Object.keys(g.MATERIAL_FILTER_TYPE)[a]]});return e},_createRecommendSellMaterialArray:function(t,e){return this._recommendMaterialArray=r.filterModels(n.getSellMaterialEquipmentModelArray(),this.createMaterialSellFilterConditions(t)),this._recommendMaterialArray.length>e&&(this._recommendMaterialArray.length=e),this._recommendMaterialArray},createMaterialSellFilterConditions:function(t){for(var e=[],i=g.PROPERTY_NAME,a=0;a<t.length;a+=1)t[a]||e.push({propertyName:i,getterName:g.SELL_FILTER_FUNC_NAME[Object.keys(g.SELL_FILTER_TYPE)[a]]});return e},_isFilteringOn:function(t,e){return t<g.MATERIAL_FILTER_RARITY_COUNT&&!e||t>=g.MATERIAL_FILTER_RARITY_COUNT&&e},createReleaseCharactersEquipmentParameter:function(t){var e=t.characterModel.getCharacterEquipmentInfoArray(),i=_.map(e,function(t){return t.equipmentModel?t.equipmentModel.getEquipmentCd():void 0});return i=_.filter(i,function(e){return e&&e!==t.equipmentModel.getEquipmentCd()}),[this.createCharacterEquipmentParameter(t.characterModel.getCharacterCd(),_.uniq(i),[])]},createCharacterEquipmentParameter:function(t,e,i){return{characterCd:t,equipmentWeaponCds:e,equipmentProtectorCds:i}}});cc._RF.pop()},{AnimationUtils:"AnimationUtils",CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentFilterConst:"EquipmentFilterConst",EquipmentSortConst:"EquipmentSortConst",EquipmentUtils:"EquipmentUtils",EquipmentViewSetting:"EquipmentViewSetting",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",ResourceConst:"ResourceConst",Singleton:"Singleton",WarehouseConst:"WarehouseConst",WarehouseConvertUtils:"WarehouseConvertUtils"}],EquipmentSelectSideCharacterStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"9bf72rs2L9NaouyhmbbpD7f","EquipmentSelectSideCharacterStatusView");t("ResourceUtils");var a=t("CharacterSortConst"),n=t("CommonUtils");cc.Class({extends:cc.Component,properties:{characterThumbnailPrefab:cc.Prefab,characterThumbnailParentNode:cc.Node,equipmentThumbnailPrefab:cc.Prefab,equipmentThumbnailParentNode:cc.Node},_characterThumbnail:null,drawEquipmentSelectSideCharacterStatusView:function(t,e){t?(this.node.active=!0,this._drawCharacter(t,e)):this.node.active=!1},_drawCharacter:function(t,e){this._characterThumbnail||(this._characterThumbnail=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.characterThumbnailParentNode.addChild(this._characterThumbnail.node)),this._characterThumbnail.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),t.getLevel(),a.SORT_TYPE.LEVEL),this._characterThumbnail.setCallbackToThumbnailBtn(this._onTapCharacterThumbnail.bind(this,this._characterThumbnail.node,t,e))},_drawCharacterEquipmentInfoArray:function(t){for(var e in this.equipmentThumbnailParentNode.destroyAllChildren(),t){var i=t[e],a=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");a.setLimited(!i.isReleased),i.equipmentModel?(a.initEquipmentMatrixThumbnail(i.equipmentModel.getEquipmentId(),i.equipmentModel.getAttribute(),i.equipmentModel.getRarity(),i.equipmentModel),a.setParameter("Lv.",i.equipmentModel.getLevel()+"")):a.switchEmptyNodeActive(!0),this.equipmentThumbnailParentNode.addChild(a.node)}},_onTapCharacterThumbnail:function(t,e,i){var a=n.getRoot();if(a.openEquipmentRemoveConfirmPopup){var o=_.find(e.getCharacterEquipmentInfoArray(),function(t){return t.equipmentModel.getEquipmentCd()===i.getEquipmentCd()});o&&a.openEquipmentRemoveConfirmPopup(t,o)}}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CommonUtils:"CommonUtils",ResourceUtils:"ResourceUtils"}],EquipmentSelectSideEquipmentAbilityThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"d32eemJuPxAoIrZoqpHBX6E","EquipmentSelectSideEquipmentAbilityThumbnail");var a=t("GameConst"),n=t("CommonButton");cc.Class({extends:cc.Component,properties:{abilityOrderName:cc.Label,abilityDescriptionRichText:cc.RichText,inactiveNode:cc.Node,thumbnailBtn:n},getLockIconNode:function(){return this.inactiveNode},switchActiveGrayOutNode:function(t){this.inactiveNode.active=t},setAbilityOrder:function(t){this.abilityOrderName.string="\u30a2\u30d3\u30ea\u30c6\u30a3"+t},setAbilityDescription:function(t){this.abilityDescriptionRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+t},switchActive:function(t){this.inactiveNode.active=!t,this.abilityOrderName.node.color=t?a.COLOR_STATE.NORMAL:a.COLOR_STATE.GRAY},setThumbnailTapEvent:function(t){this.thumbnailBtn.node.active=!0,this.thumbnailBtn.setTapEvent(t)}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst"}],EquipmentSelectSideEquipmentStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"b478alz0Q1NNKZGyFlttI1Y","EquipmentSelectSideEquipmentStatusView");var a=t("CommonButton"),n=(t("CommonUtils"),t("BattleParameterView")),o=t("EquipmentAbilityListView");cc.Class({extends:cc.Component,properties:{equipmentThumbnailPrefab:cc.Prefab,equipmentThumbnailParentNode:cc.Node,equipmentNameLabal:cc.Label,levelLabel:cc.Label,infoBtn:a,protectBtn:a,battleParameterView:n,abilityListView:o},_listEquipmentThumbnail:null,_equipmentThumbnail:null,_equipmentModel:null,_callbackToInfoBtn:null,onLoad:function(){this.protectBtn.setTapEvent(this._onTapProtectBtn.bind(this),a.SE_NAME.EQUIP),this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this))},setCallbackToProtectBtn:function(t){this._callbackToProtectBtn=t},setCallbackToInfoBtn:function(t){this._callbackToInfoBtn=t},_onTapInfoBtn:function(){this._callbackToInfoBtn&&this._callbackToInfoBtn(this._equipmentModel)},drawEquipmentSelectSideEquipmentStatusView:function(t){this._equipmentModel=t,this._drawEquipmentThumbnail(t),t?(this.equipmentNameLabal.string=t.getName(),this.levelLabel.string=t.getLevel(),this.protectBtn.node.active=!0,this.protectBtn.switchBtnImage(t.getIsProtect()),this.battleParameterView.initBattleParameterView(t.getHp(),t.getAtk(),t.getDef()),this.abilityListView.initListView(t),this.abilityListView.node.active=!0):(this.equipmentNameLabal.string="-",this.levelLabel.string="-",this.protectBtn.node.active=!1,this.battleParameterView.initBattleParameterView("-","-","-"),this._drawEquipmentThumbnail(null),this.abilityListView.node.active=!1)},_drawEquipmentThumbnail:function(t){this._equipmentThumbnail||(this._equipmentThumbnail=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.equipmentThumbnailParentNode.addChild(this._equipmentThumbnail.node)),t?(this._equipmentThumbnail.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),this._equipmentThumbnail.setParameter("Lv.",t.getLevel()+""),this._equipmentThumbnail.switchEmptyNodeActive(!1)):this._equipmentThumbnail.switchEmptyNodeActive(!0)},_onTapProtectBtn:function(){this._callbackToProtectBtn(this._equipmentModel)}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentAbilityListView:"EquipmentAbilityListView"}],EquipmentSelectSideViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"ecf90PvZd5PFrhJAawh8vCe","EquipmentSelectSideViewBase");var a=t("CommonButton");cc.Class({extends:cc.Component,properties:{windowNode:cc.Node,executeBtn:a},_root:null,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},_callbackToRedraw:null,_callbackToExecuteBtn:null,resetEquipmentSelectSideView:function(){this.node.active=!1,this.windowNode.active=!1},initEquipmentSelectSideView:function(t,e,i){this._root=t,this._callbackToRedraw=e,this._callbackToExecuteBtn=i,this.node.active=!0,this.windowNode.active=!0},drawEquipmentSelectSideView:function(){cc.error("drawEquipmentSelectSideView(arguments)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044",arguments)},_onTapExecuteBtn:function(){cc.error("_onTapExecuteBtn()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3078\u6e21\u3059\u5f15\u6570\u3092\u8abf\u6574"),this._callbackToExecuteBtn&&this._callbackToExecuteBtn()}});cc._RF.pop()},{CommonButton:"CommonButton"}],EquipmentSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"67464cczwdOrqIeaaDeEiC8","EquipmentSelectSubRoot");var a=t("EquipmentSelectTabView");cc.Class({extends:cc.Component,properties:{equipmentSelectTabView:a},initEquipmentSelectSubRoot:function(t,e){this.equipmentSelectTabView.initEquipmentSelectTabView(t,e)}});cc._RF.pop()},{EquipmentSelectTabView:"EquipmentSelectTabView"}],EquipmentSelectTabView:[function(t,e,i){"use strict";cc._RF.push(e,"5f156hJxBJI8KslWdDG0Hs5","EquipmentSelectTabView");var a=t("TabViewBase"),n=t("NoticeBadgeCheckUtils"),o=t("ViewUtils"),r=t("EquipmentListViewBase"),s={POSITION:cc.v2(57,18),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{equipmentLiseViewArray:[r]},_root:null,initEquipmentSelectTabView:function(t,e){this._root=t,this.initTabViewBase(),this._setCurrentTab(e),this._activateTab(this.getCurrentTab()),n.hasExceedableEquipment()?o.addNoticeBadge(this.tabBtnArray[1].node,s.POSITION,s.SCALE):o.hideNoticeBadge(this.tabBtnArray[1].node)},_tabEvent:function(t,e,i){this._root.getIsMaterialSelect()&&(this._root.setIsMaterialSelect(!1),this._root.popScene(!0)),this._root.setTargetEquipmentCd(null),this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._root.setSelectedTab(t),this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetListView(),this.equipmentLiseViewArray[t].initListView(this._root)},_resetListView:function(){for(var t in this.equipmentLiseViewArray)this.equipmentLiseViewArray[t].resetListView()}});cc._RF.pop()},{EquipmentListViewBase:"EquipmentListViewBase",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",TabViewBase:"TabViewBase",ViewUtils:"ViewUtils"}],EquipmentSellCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"6412aldUpFOIpPyVd+b2Udr","EquipmentSellCompletePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("EquipmentUtils"),r=t("CommonUtils"),s=t("ItemUtils"),c=t("GameConst");cc.Class({extends:a,properties:{topCurrencyNameLabel:cc.Label,centerCurrencyNameLabel:cc.Label,getCurrencyCountLabel:cc.Label,beforeCurrencyCountLabel:cc.Label,afterCurrencyCountLabel:cc.Label,okBtn:n},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},_callbackToOkBtn:null,openEquipmentSellCompletePopup:function(t,e){this.setCloseCallBack(e),this._initEquipmentSellCompletePopup(t),this.open()},_initEquipmentSellCompletePopup:function(t){var e=s.getItemMaster(c.ITEM_ID_GOLD),i=s.getUserItemCount(c.ITEM_ID_GOLD),a=o.calcSellPrice(t);this.topCurrencyNameLabel.string="["+e.getName()+"]x",this.centerCurrencyNameLabel.string="\u6240\u6301["+e.getName()+"]",this.getCurrencyCountLabel.string=r.convertToCommaDelimited(a),this.beforeCurrencyCountLabel.string=r.convertToCommaDelimited(i-a),this.afterCurrencyCountLabel.string=r.convertToCommaDelimited(i)},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],EquipmentSellConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"4fd7blJLa9D3rnamWx+irDB","EquipmentSellConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("EquipmentUtils"),r=t("CommonUtils"),s=t("ItemUtils"),c=t("GameConst");cc.Class({extends:a,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,currencyNameLabel:cc.Label,priceLabel:cc.Label,executeBtn:n,cancelBtn:n},onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},_materialModelArray:null,_callbackToExecuteBtn:null,openEquipmentSellConfirmPopup:function(t,e){this._materialModelArray=t,this._callbackToExecuteBtn=e,this.currencyNameLabel.string="["+s.getItemMaster(c.ITEM_ID_GOLD).getName()+"]x",this.priceLabel.string=r.convertToCommaDelimited(o.calcSellPrice(t)),this._drawThumbnailList(t),this.open()},_drawThumbnailList:function(t){for(var e in this.thumbnailParentNode.destroyAllChildren(),t){var i=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail");i.initEquipmentMatrixThumbnail(t[e].getEquipmentId(),t[e].getAttribute(),t[e].getRarity(),t[e]),i.setParameter("Lv.",t[e].getLevel()+""),this.thumbnailParentNode.addChild(i.node)}},_onTapExecuteBtn:function(){this.close(),this._callbackToExecuteBtn(this._materialModelArray)},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],EquipmentSellSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"a16b5ZC6CBOSbTHnbkqeDHu","EquipmentSellSelectListView");var a=t("GameConst"),n=t("EquipmentUtils"),o=t("Singleton"),r=t("ResourceUtils"),s=t("ResourceConst"),c=t("EquipmentConst"),l=t("EquipmentSortConst"),u=t("EquipmentMultipleSelectListWithSideViewBase");cc.Class({extends:u,properties:{countLabel:cc.Label,maxCountLabel:cc.Label,materialCountLabel:cc.Label,materialMaxCountLabel:cc.Label},initListView:function(t){this._super(t)},_initMatrixPageView:function(){this.countLabel.string=""+this._getEquipments().length,this.maxCountLabel.string=""+o.dao[o.USER].getEquipmentMaxCount(),this.materialCountLabel.string=""+this._getMaterials().length,this.materialMaxCountLabel.string=""+a.MAX_MATERIAL_COUNT,this.matrixPageView.initMatrixPageView("getEquipmentCd",this._getSellableMaterials(),o.dao.userBasicData.getEquipmentMaxCount(),[],this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackIsThumbnailEnabled:function(t,e){return!t.getIsProtect()&&!n.getCharacterModelByEquipmentCd(t.getEquipmentCd())&&!(e.length>=this._getCheckLimit()&&!e.find(function(e){return e.getEquipmentCd()===t.getEquipmentCd()}))},_getSellableMaterials:function(){return n.getEquipmentModelArrayByEquipmentTypes([c.EQUIPMENT_TYPE.NORMAL,c.EQUIPMENT_TYPE.FORTIFY_MATERIAL,c.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL])},_getEquipments:function(){return n.getEquipmentModelArrayByEquipmentTypes([c.EQUIPMENT_TYPE.NORMAL])},_getMaterials:function(){return n.getEquipmentModelArrayByEquipmentTypes([c.EQUIPMENT_TYPE.FORTIFY_MATERIAL,c.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL])},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:"getIsProtect"}),i.push({getterName:"getIsCharacterEquipment"}),i.push({getterName:l.SORT_FUNC_NAME[Object.keys(l.SORT_TYPE)[t]],order:e}),i.push({getterName:"getEquipmentId"}),i.push({getterName:"getEquipmentCd"}),i},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(r.getResource(s.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_FORTIFY)).getComponent("SortFilterPopup")},_callbackToRedraw:function(t){this.matrixPageView.initMatrixPageView("getEquipmentCd",this._getSellableMaterials(),o.dao.userBasicData.getEquipmentMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(t)},_getCheckLimit:function(){return 20},_callbackToSideExecute:function(t){this._root.openEquipmentSellConfirmPopup(t)},_callbackToMaterialThumbnail:function(t){var e=this.matrixPageView.getCheckedModelArray().filter(function(e){return e.getEquipmentCd()!==t.getEquipmentCd()});this.matrixPageView.initMatrixPageView("getEquipmentCd",n.getSellMaterialEquipmentModelArray(),o.dao.userBasicData.getEquipmentMaxCount(),e,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.equipmentSelectSideView.drawEquipmentSelectSideView(e)}});cc._RF.pop()},{EquipmentConst:"EquipmentConst",EquipmentMultipleSelectListWithSideViewBase:"EquipmentMultipleSelectListWithSideViewBase",EquipmentSortConst:"EquipmentSortConst",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],EquipmentSellSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"a965cAPRWtCDqnC6HQDHlKn","EquipmentSellSelectSideView");var a=t("CommonButton"),n=t("CommonUtils"),o=t("EquipmentUtils"),r=t("PopupUtils"),s=t("GameConst"),c=t("EquipmentConst"),l=t("EquipmentMultipleSelectSideViewBase");cc.Class({extends:l,properties:{recommendSelectBtn:a},onLoad:function(){this._super(),this.recommendSelectBtn.setTapEvent(this._onTapRecommendSelectBtn.bind(this))},_switchButtonsActive:function(t){this.executeBtn.switchBtnImage(t),this.resetBtn.setTouchEnable(t),this.resetBtn.switchBtnImage(t)},drawEquipmentSelectSideView:function(t){this._super(t),t.length>0?this.equipmentProgressView.drawEquipmentSimpleProgressView(t[t.length-1],c.PROMOTE_TYPE.STATUS):this.equipmentProgressView.resetEquipmentSimpleProgressView()},_getPriceTextColor:function(t){return s.COLOR_STATE.NORMAL},_getPriceText:function(t){return n.convertToCommaDelimited(o.calcSellPrice(t))},_onTapRecommendSelectBtn:function(){this._root.openRecommendedSellMaterialSelectPopup("\u4ee5\u4e0a\u306e\u6761\u4ef6\u3067\u3001\u58f2\u5374\u3059\u308b\u88c5\u5099\u3092\n\u6700\u5927"+this._checkLimit+"\u500b\u9078\u629e\u3057\u307e\u3059\u3002",this._checkLimit,this._callbackToRedraw.bind(this))},_onTapExecuteBtn:function(){this.executeBtn.getBtnImageSwitchState()?this._callbackToExecuteBtn&&this._callbackToExecuteBtn(this._checkedModelArray):r.openSimpleMessageWindow("\u58f2\u5374\u7d20\u6750\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentMultipleSelectSideViewBase:"EquipmentMultipleSelectSideViewBase",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",PopupUtils:"PopupUtils"}],EquipmentService:[function(t,e,i){"use strict";cc._RF.push(e,"f9b53QRpFBAOa+nrrdvTJ8s","EquipmentService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,sell:function(t,e){var i={materials:t.join(",")};this._requestCallApi(n.EQUIPMENT_SELL,i,function(t,i){return e(t?void 0:i)})},sellWarehouse:function(t,e,i,a){var o={equipmentCd:t,count:e,warehouseType:i};this._requestCallApi(n.EQUIPMENT_SELL_WAREHOUSE,o,function(t,e){return a(t?void 0:e)})},fortify:function(t,e,i){var a={equipmentCd:t,materials:e.join(",")};this._requestCallApi(n.EQUIPMENT_FORTIFY,a,function(t,e){return i(t?void 0:e)})},fortifyWarehouse:function(t,e,i){var a={equipmentCd:t,materials:e};this._requestCallApi(n.EQUIPMENT_FORTIFY_WAREHOUSE,a,function(t,e){return i(t?void 0:e)})},exceedLimit:function(t,e,i){var a={equipmentCd:t,materialCd:e};this._requestCallApi(n.EQUIPMENT_EXCEED_LIMIT,a,function(t,e){return i(t?void 0:e)})},exceedLimitWarehouse:function(t,e,i,a){var o={equipmentCd:t,materialCd:e,materialWarehouseType:i};this._requestCallApi(n.EQUIPMENT_EXCEED_LIMIT_WAREHOUSE,o,function(t,e){return a(t?void 0:e)})},create:function(t,e){var i={recipeId:t};this._requestCallApi(n.EQUIPMENT_CREATE,i,function(t,i){return e(t?void 0:i)})},changeProtect:function(t,e){var i={equipmentCd:t.join(",")};this._requestCallApi(n.EQUIPMENT_CHANGE_PROTECT,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],EquipmentSingleSelectListWithSideViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"ec742S0c5xOO7tUUtL37Fot","EquipmentSingleSelectListWithSideViewBase");var a=t("Singleton"),n=t("CommonButton"),o=(t("PopupUtils"),t("EquipmentUtils")),r=t("EquipmentListWithSideViewBase"),s=t("EquipmentMultipleSelectListWithSideViewBase"),c=t("ItemConst"),l=t("EquipmentFilterConst");cc.Class({extends:r,properties:{purchaseBtn:n,materialSelectListView:s},onLoad:function(){this.purchaseBtn.setTapEvent(this._onTapPurchaseBtn.bind(this))},resetListView:function(){this._super(),this.materialSelectListView.resetListView()},initListView:function(t){this._super(t),t.getIsMaterialSelect()&&this._switchMaterialSelectListView(t.getTargetEquipmentModel())},_initSideView:function(t){this.equipmentSelectSideView.initEquipmentSelectSideView(t,this._callbackToRedraw.bind(this),this._callbackToSideExecute.bind(this),this._callbackToSideProtect.bind(this))},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView(o.getEquipmentModelArrayByEquipmentType(c.EQUIPMENT_TYPE.ATK),a.dao.userBasicData.getEquipmentMaxCount(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToThumbnail:function(t,e){this._resetActiveThumbnails(),this._root.setTargetEquipmentCd(e.getEquipmentCd()),t.setSelectedNodeActive(!0),this.equipmentSelectSideView.drawEquipmentSelectSideView(e)},_callbackToCreateFilterConditions:function(t){for(var e=[],i=l.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1){var r=l.EQUIP_FILTER_FUNC_NAME[Object.keys(l.EQUIP_FILTER_TYPE)[o]];r&&(t[o]?a=!1:n.push({propertyName:i,getterName:r}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]))}return e},_callbackToSideProtect:function(t){this._root.requestEquipmentProtect(t,function(){this.matrixPageView.setDataList(o.getEquipmentModelArrayByEquipmentType(c.EQUIPMENT_TYPE.ATK)),this.matrixPageView.sortAndFilter(),this.matrixPageView.redrawSimply(),this.equipmentSelectSideView.drawEquipmentSelectSideView(this._root.getTargetEquipmentModel())}.bind(this))},_callbackToSideExecute:function(t){this._root.pushEquipmentSelectSubRoot(!0)},_switchMaterialSelectListView:function(t){this.resetListView(),this.materialSelectListView.initListView(this._root)},_onTapPurchaseBtn:function(){this._root.transitionShop()}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentFilterConst:"EquipmentFilterConst",EquipmentListWithSideViewBase:"EquipmentListWithSideViewBase",EquipmentMultipleSelectListWithSideViewBase:"EquipmentMultipleSelectListWithSideViewBase",EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",PopupUtils:"PopupUtils",Singleton:"Singleton"}],EquipmentSingleSelectSideViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"d43e5ilUMdJNLdwoleXhUJ1","EquipmentSingleSelectSideViewBase");t("CommonButton");var a=t("EquipmentUtils"),n=t("EquipmentSelectSideViewBase"),o=t("EquipmentSelectSideEquipmentStatusView"),r=t("EquipmentSelectSideCharacterStatusView");cc.Class({extends:n,properties:{activeNode:cc.Node,inactiveNode:cc.Node,equipmentStatusView:o,characterStatusView:r},_equipmentModel:null,initEquipmentSelectSideView:function(t,e,i,a){this._super(t,e,i),this._equipmentModel=null,this.activeNode.active=!1,this.inactiveNode.active=!0,this.equipmentStatusView.setCallbackToInfoBtn(this._callbackToInfoBtn.bind(this)),this.equipmentStatusView.setCallbackToProtectBtn(a),this.equipmentStatusView.drawEquipmentSelectSideEquipmentStatusView(null),this.characterStatusView.drawEquipmentSelectSideCharacterStatusView(null)},drawEquipmentSelectSideView:function(t){this._equipmentModel=t,this.activeNode.active=!0,this.inactiveNode.active=!1,this.equipmentStatusView.drawEquipmentSelectSideEquipmentStatusView(t),this.characterStatusView.drawEquipmentSelectSideCharacterStatusView(a.getCharacterModelByEquipmentCd(t.getEquipmentCd()),t)},_callbackToInfoBtn:function(t){t&&this._root.openEquipmentDetailPopup(t)},_onTapExecuteBtn:function(){this._callbackToExecuteBtn&&this._callbackToExecuteBtn(this._equipmentModel)}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentSelectSideCharacterStatusView:"EquipmentSelectSideCharacterStatusView",EquipmentSelectSideEquipmentStatusView:"EquipmentSelectSideEquipmentStatusView",EquipmentSelectSideViewBase:"EquipmentSelectSideViewBase",EquipmentUtils:"EquipmentUtils"}],EquipmentSortConst:[function(t,e,i){"use strict";cc._RF.push(e,"9cdb7v78GNF+rHo2oOjtIDd","EquipmentSortConst");cc.Class({statics:{SORT_TYPE:cc.Enum({GETTING:0,LEVEL:1,ATTRIBUTE:2,RARE:3,TOTAL:4,HP:5,ATK:6,DEF:7}),SORT_FUNC_NAME:{GETTING:"getEquipmentCd",LEVEL:"getLevel",ATTRIBUTE:"getAttribute",RARE:"getRarity",TOTAL:"getTotalPower",HP:"getHp",ATK:"getAtk",DEF:"getDef"},WAREHOUSE_SORT_TYPE:cc.Enum({NUMBER:0,ATTRIBUTE:1}),WAREHOUSE_SORT_PROPERTY_NAME:{NUMBER:"number",ATTRIBUTE:"attribute"}}});cc._RF.pop()},{}],EquipmentUtils:[function(t,e,i){"use strict";cc._RF.push(e,"43bdaIzOttEXIs99X6XRLqn","EquipmentUtils");var a=t("Singleton"),n=t("ItemConst"),o=t("CommonUtils"),r=t("EquipmentConst"),s=t("EquipmentSortConst");function c(){var t={},e=a.dao[a.USER_EQUIPMENT];for(var i in e){var n=e[i];t[n.getEquipmentCd()]=n}return t}function l(){var t={},e=a.dao.EquipmentExceedLimitMasters;for(var i in e){var n=e[i].getExceedLimitType();t[n]||(t[n]={});var o=e[i].getRarity();t[n][o]||(t[n][o]={});var r=e[i].getMaterialRarity();t[n][o][r]=e[i]}return t}function u(t){return a.dao.userEquipments.filter(function(e){return e.getEquipmentType()===t})}function h(t){return _.filter(a.dao.userEquipments,function(e){return _.some(t,function(t){return e.getEquipmentType()===t})})}function d(t,e){return e=e||1,a.dao.EquipmentLevelMasters.find(function(i){return i.getLevel()===t&&i.getExpType()===e})}function p(t,e,i){return i=i||1,_.minBy(_.filter(a.dao.EquipmentLevelMasters,function(a){return m(a,i,t,e)}),function(t){return t.getLevel()})}function m(t,e,i,a){return t.getExpType()===e&&(t.getTotalExp()<=i&&t.getTotalExp()+t.getNextLevelExp()>i||t.getLevel()===a)}function g(t){switch(t.getEquipmentType()){case n.EQUIPMENT_TYPE.ATK:case n.EQUIPMENT_TYPE.DEF:if(t.getIsProtect()||C(t.getEquipmentCd()))return!1;break;case n.EQUIPMENT_TYPE.FORTIFY_MATERIAL:return!t.getIsProtect();default:return!1}return!0}function C(t){return a.dao[a.USER_CHARACTER].find(function(e){var i=e.getEquipmentWeaponCds();if(i)for(var a=0;a<i.length;a++)if(i[a]===t)return!0;var n=e.getEquipmentProtectorCds();if(n)for(var o=0;o<n.length;o++)if(n[o]===t)return!0;return!1})}function f(t){return a.dao.EquipmentMainMasters.find(function(e){return e.getEquipmentId()===t})}function E(t){return o.sortModels(a.dao.EquipmentEffectMasters.filter(function(e){return e.getEquipmentId()===t}),[{getterName:"getIndex"}])}function T(t){return{releaseRarity:t[0].getRarity(),effectMasterArray:t,effectTextArray:R(t)}}function S(t,e,i,a){return parseInt((a-1)/(i-1)*(e-t)+t)}function R(t){for(var e=[],i=0;i<t.length;i+=1)e.push(t[i].getText().replace("{0}",Math.abs(t[i].getEffectValue())));return e}e.exports={getEquipmentModelMap:function(){return c()},getEquipmentModelArrayByEquipmentType:u,getEquipmentModelArrayByEquipmentTypes:h,getPlayableUserEquipmentModelArray:function(){return u(n.EQUIPMENT_TYPE.ATK)},getNonPlayableUserEquipmentModelArray:function(){return h([n.EQUIPMENT_TYPE.FORTIFY_MATERIAL,n.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL])},getEuqipmentLevelMasterByLevel:d,getEquipmentLevelMasterByTotalExp:p,getEquipmentLevelByTotalExp:function(t,e,i){return p(t,e,i).getLevel()},getMaterialEquipmentModelArray:function(t){return a.dao.userEquipments.filter(function(e){return!e.getIsProtect()&&e.getEquipmentCd()!==t&&!C(e.getEquipmentCd())})},getExceedLimitMaterialEquipmentModelArray:function(t){var e=l();return a.dao.userEquipments.filter(function(i){return!(i.getIsProtect()||i.getEquipmentId()!==t.getEquipmentId()||i.getEquipmentCd()===t.getEquipmentCd()||i.getEquipmentType()!==n.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL&&!e[t.getExceedLimitType()][t.getRarity()][i.getRarity()]||C(i.getEquipmentCd()))})},getSellMaterialEquipmentModelArray:function(){return _.filter(a.dao.userEquipments,function(t){return g(t)})},getEquipmentModelByEquipmentCd:function(t){return a.dao.userEquipments.find(function(e){return e.getEquipmentCd()===t})},getCharacterModelByEquipmentCd:C,getEquipmentMainModelByEquipmentId:f,getEquipmentEffectMasterArrayByEquipmentId:E,createEquipmentEffectInfoMapByEquipmentId:function(t){var e,i,a=E(t),n={},o=r.RARITY.SSR;for(e in _.forEach(a,function(t){e=t.getBoostType(),i=t.getRarity(),o=Math.min(o,i),n[e]||(n[e]={}),n[e][i]||(n[e][i]=[]),n[e][i].push(t)}),n)for(i=1;i<=r.RARITY.SSR;i+=1)a=n[e][i]?n[e][i]:n[e][o],n[e][i]=T(a);return n},createEquipmentBattleParameter:function(t,e,i){return{hp:S(t["getMinHp"+(e=Math.max(Math.min(e,r.RARITY.SSR),r.RARITY.N))].apply(t),t["getMaxHp"+e].apply(t),t["getMaxLevel"+e].apply(t),i),atk:S(t["getMinAtk"+e].apply(t),t["getMaxAtk"+e].apply(t),t["getMaxLevel"+e].apply(t),i),def:S(t["getMinDef"+e].apply(t),t["getMaxDef"+e].apply(t),t["getMaxLevel"+e].apply(t),i)}},getEquipmentMaxLevel:function(t,e){return t["getMaxLevel"+(e=Math.max(Math.min(e,r.RARITY.SSR),r.RARITY.N))].apply(t)},convertEquipmentTypeToText:function(t,e){var i="";switch(t){case n.EQUIPMENT_TYPE.ATK:i="\u88c5\u5099\u67a0";break;case n.EQUIPMENT_TYPE.DEF:i="\u9632\u5177\u67a0"}return i+e},convertSortTypeToText:function(t){switch(t){case s.SORT_TYPE.GETTING:return"\u5165\u624b\u9806";case s.SORT_TYPE.LEVEL:return"Lv\u9806";case s.SORT_TYPE.ATTRIBUTE:return"\u5c5e\u6027\u9806";case s.SORT_TYPE.RARE:return"\u30ec\u30a2\u9806";case s.SORT_TYPE.TOTAL:return"\u6226\u529b\u9806";case s.SORT_TYPE.HP:return"Hp\u9806";case s.SORT_TYPE.ATK:return"Atk\u9806";case s.SORT_TYPE.DEF:return"Def\u9806"}return""},convertRarityText:function(t){switch(t){case r.RARITY.N:return"N";case r.RARITY.R:return"R";case r.RARITY.SR:return"SR";case r.RARITY.SSR:return"SSR"}return""},createSortViewParams:function(t,e){switch(t){case s.SORT_TYPE.GETTING:case s.SORT_TYPE.LEVEL:case s.SORT_TYPE.ATTRIBUTE:return{prefix:"Lv.",value:e.getLevel()};case s.SORT_TYPE.RARE:return{prefix:"\u2605",value:e.getRarity()};case s.SORT_TYPE.TOTAL:return{prefix:"\u6226\u529b",value:e.getTotalPower()};case s.SORT_TYPE.HP:return{prefix:"Hp",value:e.getHp()};case s.SORT_TYPE.ATK:return{prefix:"Atk",value:e.getAtk()};case s.SORT_TYPE.DEF:return{prefix:"Def",value:e.getDef()};default:return{prefix:"",value:0}}},calcSellPrice:function(t){var e=0;for(var i in t)e+=t[i].getSalePrice();return e},calcFortifyPrice:function(t,e){return t.getFortifyPrice()*e.length},calcExceedLimitPrice:function(t,e){var i=l();return i[t.getEquipmentType()]&&i[t.getEquipmentType()][t.getRarity()]&&i[t.getEquipmentType()][t.getRarity()][e.getRarity()]?i[t.getEquipmentType()][t.getRarity()][e.getRarity()].getExceedLimitPrice():0},calcTotalMaterialExp:function(t,e){var i=0;for(var a in t)t[a].getAttribute()===e.getAttribute()?i+=t[a].getAddExp()*r.SAME_ATTRIBUTE_MATERIAL_BONUS_RATE:i+=t[a].getAddExp();return i},calcExpRateForNextLevelByTotalExp:function(t,e,i){var a=p(t,e,i);return(t-a.getTotalExp())/a.getNextLevelExp()},calcNeedExpForNextLevelByTotalExp:function(t,e,i){var a=p(t,e,i);return e&&a.getLevel()>=e?0:a.getNextLevelExp()-(t-a.getTotalExp())},calcRemainingExpForMaxLevelByMaxLevelAndTotalExp:function(t,e,i){return d(t,i).getTotalExp()-e},isEquipmentAlert:function(t){return t.some(function(t){return t.getRarity()>=r.RARITY.R||!!C(t.getEquipmentCd())})},isCanFortifyEquipment:function(t){return t.getLevel()<t.getMaxLevel()},isCanExceedLimitEquipment:function(t){return!(t.getLevel()<t.getMaxLevel()||t.getRarity()>=r.RARITY.SSR)},getRarityByEquipmentIdAndExceedLimit:function(t,e){var i=f(t);return Math.min(i.getRarity()+e,r.RARITY.SSR)}},cc._RF.pop()},{CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentSortConst:"EquipmentSortConst",ItemConst:"ItemConst",Singleton:"Singleton"}],EquipmentViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"6373eKuiAtFIa3d800X371J","EquipmentViewSetting");var a=t("EquipmentRootUtils");e.exports={EQUIPMENT_SETTING:{EquipmentSelectSubRoot:{open:a.openEquipmentSelectSubRoot,close:a.closeEquipmentSelectSubRoot}}},cc._RF.pop()},{EquipmentRootUtils:"EquipmentRootUtils"}],ErrorCode:[function(t,e,i){"use strict";cc._RF.push(e,"2723ctNQH1L8I3sLDZYM/U8","ErrorCode"),e.exports={INVALID_PARAMETER:11,NOT_FOUND_MODEL_PROPERTY:12,SESSION_ERROR:13,TYPE_ERROR:14,NETWORK_ERROR:21,CLIENT_TIME_OUT:22,NETWORK_WIFI_INACCESSIBLE:23,NETWORK_DISABLE:24,API_METHOD_NOT_SUPPORTED:25,NODE_CHILD_NOT_FOUND:26,JSON_EXCEPTION:27,PROPERTY_NOT_FOUND:28,UNEXPECTED_ERROR:29,OUTGAME_SPINE_ERROR:31,INGAME_SPINE_ERROR:32,DYNAMIC_RES_ERROR:33,SERVER_ERROR:100,SERVER_401_ERROR:102,SERVER_404_ERROR:105,SERVER_500_ERROR:201,SERVER_501_ERROR:202,SERVER_502_ERROR:203,SERVER_503_ERROR:204,SERVER_504_ERROR:205,SERVER_505_ERROR:206,MINIGAME_MASTER_ERROR:10026,USER_DISABLED:99991,HOT_UPDATE:99998,MAINTENANCE:99999},cc._RF.pop()},{}],ErrorManager:[function(t,e,i){"use strict";cc._RF.push(e,"c1d156Tbt5PYJ5xpn39XXTQ","ErrorManager");var a=t("Singleton"),n=t("EventManager"),o=t("ErrorCode"),r=t("PopupUtils"),s=t("SceneConst"),c=t("CommonUtils"),l=t("LocalDataConst"),u=cc.Enum({NON:0,POPUP:1,TITLE:2,RETRY:3,MAINTENANCE:4,APK_UPDATE:5,MASTER_UPDATE:6,PC_UPDATE:7,SP_UPDATE:8,APK_HOT_UPDATE:9,PLANE_POPUP:10});cc.Class({_master:void 0,_event:void 0,retryApi:null,_isError:null,_retryApiList:null,ctor:function(){this._master=arguments[0],this._event=new n,this._isError=!1,this._retryApiList=[]},cleanup:function(){this._event.cleanup(),this._isError=!1},setErrorMaster:function(t){this._master=t},throwError:function(t,e,i,n){if(void 0!==n){var o=this.getErrorInfo(t);if(o)throw o;throw n}var h=this.getError(t);if(!h)return cc.log("[error] undefined error code : "+t),cc.sys.isBrowser?r.openSystemPopupPlane("\u30b2\u30fc\u30e0\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u753b\u9762\u306e\u30ea\u30ed\u30fc\u30c9\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002","\u672a\u5b9a\u7fa9\u306e\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9\uff1a"+t):r.openSystemPopup("\u672a\u5b9a\u7fa9\u306e\u30a8\u30e9\u30fc","\u30b2\u30fc\u30e0\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u53d6\u5f97\u306e\u305f\u3081\u30bf\u30a4\u30c8\u30eb\u753b\u9762\u3078\u9077\u79fb\u3057\u307e\u3059\u3002","\u672a\u5b9a\u7fa9\u306e\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9\uff1a"+t,!0,function(){c.restartGame()});e?this._retryApiList.push(e):h._data.handlingType===u.RETRY&&(h._data.handlingType=u.TITLE);var d=h.getHandlingType();if(d!==u.MAINTENANCE)d===u.APK_UPDATE&&(a.localData[l.APP_STORE_URL]=i.url),this._isError=!0,this._event.rise(this,h);else{var p=cc.director.getScene().name;s.INGAME_MAINTENANCE_SCENE[p]?r.openCommonPopupOk("\u304a\u77e5\u3089\u305b",s.INGAME_MAINTENANCE_SCENE[p],"",!1,function(){c.getRoot().pushScene("MaintenanceScene",void 0,{MaintenanceSubRoot:i},void 0)},void 0):c.getRoot().pushScene("MaintenanceScene",void 0,{MaintenanceSubRoot:i},void 0)}},throwModelPropertyNotFoundError:function(t){cc.log(t),this.throwError(o.NOT_FOUND_MODEL_PROPERTY)},throwParameterInvalidError:function(t){cc.log(t),this.throwError(o.NOT_FOUND_MODEL_PROPERTY)},subscribe:function(t,e){this._event.subscribe(t,!1,e)},getError:function(t){var e=null;for(var i in this._master)if(this._master[i].getErrorCode()===t){e=this._master[i];break}return e},getMessage:function(t){return this.getError(t).getMessage()},isError:function(){return this._isError},setErrorHandling:function(t,e){if(this.cleanup(),this.subscribe(t,this._openErrorPopup.bind(this)),e)return e()},_openErrorPopup:function(t,e){if(!a.localData[l.IS_OPEN_SYSTEM_POPUP]){var i=this,n=e.getMessage(),o="\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9\uff1a"+e.getErrorCode();switch(e.getHandlingType()){case u.NON:case u.POPUP:r.openSystemPopup("",n,o,!0,function(){var t=cc.director.getScene().name;s.NEED_BACK_SCENE_ON_ERROR[t]&&c.getRoot().popScene()});break;case u.TITLE:r.openSystemPopup("",n,o,!0,function(){c.restartGame()});break;case u.RETRY:r.openSystemPopupYesNo("",n,o,!0,function(){if(i._isError=!1,a.localData[l.IS_OPEN_SYSTEM_POPUP]=!1,t._retryApiList.length>0){var e=!0,n=!1,o=void 0;try{for(var r,s=t._retryApiList[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){(0,r.value)()}}catch(t){n=!0,o=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw o}}t._retryApiList=[]}},function(){cc.sys.isBrowser&&cc.sys.isMobile?r.openSystemPopupPlane("\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u304c\u3001SP\u7248\u306e\u5834\u5408\u306f\u3001\n\u753b\u9762\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):c.restartGame()},"\u30ea\u30c8\u30e9\u30a4");break;case u.MAINTENANCE:r.openSystemPopup("",n,o,!0,function(){});break;case u.APK_UPDATE:r.openSystemPopup("",n,void 0,!1,function(){cc.sys.openURL(a.localData[l.APP_STORE_URL]),c.restartGame()});break;case u.PC_UPDATE:case u.SP_UPDATE:case u.PLANE_POPUP:r.openSystemPopupPlane(n);break;case u.MASTER_UPDATE:case u.APK_HOT_UPDATE:r.openSystemPopup("",n,void 0,!1,function(){c.restartGame()})}}},getErrorInfo:function(t){return{errorCode:t}}}),cc._RF.pop()},{CommonUtils:"CommonUtils",ErrorCode:"ErrorCode",EventManager:"EventManager",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",SceneConst:"SceneConst",Singleton:"Singleton"}],ErrorModel:[function(t,e,i){"use strict";cc._RF.push(e,"88f90oVCE9Hra9ypyR2MfCO","ErrorModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getErrorCode:function(){if(this._isKeyFieldAvailable("errorCode"))return this._data.errorCode;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: errorCode")},getMessage:function(){if(this._isKeyFieldAvailable("message"))return this._data.message;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: message")},getHandlingType:function(){if(this._isKeyFieldAvailable("handlingType"))return this._data.handlingType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: handlingType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventApis:[function(t,e,i){"use strict";cc._RF.push(e,"37821D1rDlNaJnvvWLNnl4r","EventApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.EVENT_GET_MASTER_DATA,path:"event/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.EVENT_GET_USER_DATA,path:"event/getUserData",method:"POST"}),a.RESTClient.graft({name:n.EVENT_QUEST_START_BATTLE,path:"event/startBattle",method:"POST"}),a.RESTClient.graft({name:n.EVENT_QUEST_END_BATTLE,path:"event/endBattle",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],EventBoostCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"8b9b3mLTq9AgKfHaaFQO+nl","EventBoostCharacterModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getEffectGroupId:function(){if(this._isKeyFieldAvailable("effectGroupId"))return this._data.effectGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectGroupId")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getSubEffectGroupId:function(){if(this._isKeyFieldAvailable("subEffectGroupId"))return this._data.subEffectGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: subEffectGroupId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventBoostEffectModel:[function(t,e,i){"use strict";cc._RF.push(e,"1cc10kMmpxIvoDr67F0Z/nl","EventBoostEffectModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getGroupId:function(){if(this._isKeyFieldAvailable("groupId"))return this._data.groupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: groupId")},getEffectType:function(){if(this._isKeyFieldAvailable("effectType"))return this._data.effectType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectType")},getAddType:function(){if(this._isKeyFieldAvailable("addType"))return this._data.addType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: addType")},getConditionType:function(){if(this._isKeyFieldAvailable("conditionType"))return this._data.conditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionType")},getConditionId:function(){if(this._isKeyFieldAvailable("conditionId"))return this._data.conditionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionId")},getValue1:function(){if(this._isKeyFieldAvailable("value1"))return this._data.value1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: value1")},getValue2:function(){if(this._isKeyFieldAvailable("value2"))return this._data.value2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: value2")},getValue3:function(){if(this._isKeyFieldAvailable("value3"))return this._data.value3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: value3")},getValue4:function(){if(this._isKeyFieldAvailable("value4"))return this._data.value4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: value4")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"c6239m8h1FCT5Q78XnlDmuZ","EventCharacterModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventHelpModel:[function(t,e,i){"use strict";cc._RF.push(e,"b035dI6Sm1LwZ4isnKvg1+v","EventHelpModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getFileName:function(){if(this._isKeyFieldAvailable("fileName"))return this._data.fileName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fileName")},getDescriptionText:function(){if(this._isKeyFieldAvailable("descriptionText"))return this._data.descriptionText;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: descriptionText")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventItemModel:[function(t,e,i){"use strict";cc._RF.push(e,"baa69eqd3VPXq9wmbSg05+b","EventItemModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"95672AddBhHnr4+Hu3zIpqa","EventMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getEventType:function(){if(this._isKeyFieldAvailable("eventType"))return this._data.eventType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventType")},getWorldId:function(){if(this._isKeyFieldAvailable("worldId"))return this._data.worldId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: worldId")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getMaxUnlockCount:function(){if(this._isKeyFieldAvailable("maxUnlockCount"))return this._data.maxUnlockCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxUnlockCount")},getConditionType:function(){if(this._isKeyFieldAvailable("conditionType"))return this._data.conditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionType")},getConditionFrom:function(){if(this._isKeyFieldAvailable("conditionFrom"))return this._data.conditionFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionFrom")},getConditionTo:function(){if(this._isKeyFieldAvailable("conditionTo"))return this._data.conditionTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionTo")},getGachaId:function(){if(this._isKeyFieldAvailable("gachaId"))return this._data.gachaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventManager:[function(t,e,i){"use strict";cc._RF.push(e,"a00c6Vxpc1PlI5tUnPzXvbj","EventManager"),cc.Class({properties:{_subscriptions:[]},ctor:function(){this.cleanup()},cleanup:function(){this._subscriptions=[]},subscribe:function(t,e,i){return this._subscribe(t,e,i)},rise:function(t,e){var i,a,n=[];for(a=0;a<this._subscriptions.length;a+=1)(i=this._subscriptions[a]).handler.call(i.context,t,e),i.isOnce&&n.push(i);for(a=0;a<n.length;a+=1)this._unsubscribe(n[a])},_subscribe:function(t,e,i){if("function"!=typeof i)throw new Error("Invalid handler argument");var a=this,n={context:t,handler:i,isOnce:e};return this._subscriptions.push(n),{unsubscribe:function(){a._unsubscribe(n),this.unsubscribe=function(){}}}},_unsubscribe:function(t){var e=this._subscriptions.indexOf(t);e>=0&&this._subscriptions.splice(e,1)}}),cc._RF.pop()},{}],EventPointRewardModel:[function(t,e,i){"use strict";cc._RF.push(e,"39e3b5pN3tOi7Oy1LoThhtQ","EventPointRewardModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getPoint:function(){if(this._isKeyFieldAvailable("point"))return this._data.point;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: point")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],EventQuestConst:[function(t,e,i){"use strict";cc._RF.push(e,"3474fXJe+dBhairen8Gtj3l","EventQuestConst"),e.exports={EVENT_TYPE:cc.Enum({POINT:1,ITEM:2,RAID:3,ADVENT_WAR:4,EQUIPMENT_FORTIFY:5}),WINDOW_FRAME_TYPE:cc.Enum({POINT:0,ITEM:1}),DIFFICULT:cc.Enum({NORMAL:0,HARD:1}),BOOST_EFFECT_TYPE:cc.Enum({DROP:1}),BOOST_ADD_TYPE:cc.Enum({RATE:1,ADD:2})},cc._RF.pop()},{}],EventQuestDifficultyUnlockPopup:[function(t,e,i){"use strict";cc._RF.push(e,"4d5a2EHHG9Hg7tA7tkDttVl","EventQuestDifficultyUnlockPopup");var a=t("PopupBase"),n=t("CommonButton");t("CommonUtils");cc.Class({extends:a,properties:{eventQuestNameLabel:cc.Label,okBtn:n},_eventMainMaster:null,openEventQuestDifficultyUnlockPopup:function(t,e){this.setCloseCallBack(e),this._setParameter(t),this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.open()},_setParameter:function(t){var e=t.getName();this.eventQuestNameLabel.string="\u3010"+e+"\u3011"}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",PopupBase:"PopupBase"}],EventQuestFrameThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"96b0bJNnONJ3qm81taXBKOG","EventQuestFrameThumbnailBase");t("MatrixThumbnail");var a=t("ItemUtils"),n=(t("ResourceUtils"),t("GameConst")),o=t("CommonUtils"),r=t("MatrixThumbnailUtils");cc.Class({extends:cc.Component,properties:{thumbnailParentNode:cc.Node,detailPopupPrefab:cc.Prefab},initWindowFrame:function(){cc.error("initWindowFrame\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u4e0b\u3055\u3044")},_initItemThumbnail:function(t,e,i){var a;i&&(a={prefix:"x",count:i});var n=r.createMatrixThumbnailByItemType(e,t,a);n&&(n.setCallbackToThumbnailBtn(this._onTapItemBtn.bind(this,n.node,t,e)),this.thumbnailParentNode.addChild(n.node))},_onTapItemBtn:function(t,e,i){if(this.detailPopupPrefab){var r=cc.instantiate(this.detailPopupPrefab).getComponent("ModelDetailPopup"),s=cc.instantiate(t),c=cc.instantiate(t),l=t.convertToWorldSpaceAR(cc.v2(0,0)),u=o.getRoot().node.convertToNodeSpaceAR(l);o.getRoot().node.addChild(c,n.Z_ORDER.POPUP),c.setPosition(u);var h=a.getItemInfo(e,i);r.openModelDetailPopup(s,h.name,h.text,function(){c.destroy()})}}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",MatrixThumbnail:"MatrixThumbnail",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils"}],EventQuestHowToPlayPopup:[function(t,e,i){"use strict";cc._RF.push(e,"fe852XnEUZOZ6YZE2aLeXfi","EventQuestHowToPlayPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("CommonScrollView"),t("Singleton"),t("EventUtils")),r=t("ResourceUtils");t("HistoryUtils"),t("CommonUtils"),t("ItemUtils"),cc.Class({extends:a,properties:{pageView:cc.PageView,indicatorParentNode:cc.Node,indicatorPrefab:cc.Prefab,pageDescriptionTextLabel:cc.Label,rightAllowBtn:n,leftAllowBtn:n,closeBtn:n},_eventId:null,_eventHelpMasterArray:null,_indicatorArray:null,openEventQuestHowToPlayPopup:function(t,e){this.setCloseCallBack(e),this._setParameter(t),this._initPageViewContent(),this._initIndicator(),this._initButton(),this.closeBtn.setTapEvent(function(){this.close()}.bind(this),n.SE_NAME.CANCEL),this.open(this.openCallback.bind(this))},openCallback:function(){this.pageView.node.active=!0,this._redraw(),this.pageView.node.on("scroll-ended",this._redraw,this)},_redraw:function(){this.redrawIndicator(),this.redrawVisibleButton(),this.redrawDescriptionText()},_setParameter:function(t){this._eventId=t,this._eventHelpMasterArray=o.getEventHelpMasterGroupByEventId()[t]},_initPageViewContent:function(){for(var t=null,e=0;e<this._eventHelpMasterArray.length;e+=1)t=(new cc.Node).addComponent(cc.Sprite),r.addSprite(t,r.getDirectoryHelpByEventId(this._eventId)+this._eventHelpMasterArray[e].getFileName()),this.pageView.addPage(t.node);this.pageView.node.active=!1},_initIndicator:function(){var t=this._eventHelpMasterArray.length;this._indicatorArray=[];for(var e=-25*(t-1)/2,i=0;i<t;i+=1){var a=cc.instantiate(this.indicatorPrefab);a.getChildByName("IndicatorEnable").active=!1,a.getChildByName("IndicatorBase").active=!0;var n=e+25*i;a.position=cc.v2(n,a.position.y+5),this.indicatorParentNode.addChild(a),this._indicatorArray.push(a)}},_initButton:function(){this.rightAllowBtn.setTapEvent(this.rightAllowBtnEvent.bind(this),n.SE_NAME.COUNT),this.leftAllowBtn.setTapEvent(this.leftAllowBtnEvent.bind(this),n.SE_NAME.COUNT)},rightAllowBtnEvent:function(){var t=this.pageView.getCurrentPageIndex();t<this._eventHelpMasterArray.length-1&&this.pageView.setCurrentPageIndex(t+1)},leftAllowBtnEvent:function(){var t=this.pageView.getCurrentPageIndex();t>0&&this.pageView.setCurrentPageIndex(t-1)},redrawIndicator:function(){for(var t=0;t<this._indicatorArray.length;t++)this._indicatorArray[t].getChildByName("IndicatorEnable").active=!1;this._indicatorArray.length>0&&(this._indicatorArray[this.pageView.getCurrentPageIndex()].getChildByName("IndicatorEnable").active=!0)},redrawDescriptionText:function(){this.pageDescriptionTextLabel.string=this._eventHelpMasterArray[this.pageView.getCurrentPageIndex()].getDescriptionText()},redrawVisibleButton:function(){this.rightAllowBtn.node.active=!0,this.leftAllowBtn.node.active=!0;var t=this.pageView.getCurrentPageIndex();0===t&&(this.leftAllowBtn.node.active=!1),t===this._eventHelpMasterArray.length-1&&(this.rightAllowBtn.node.active=!1)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",EventUtils:"EventUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],EventQuestItemFrameThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"026e8svd8hBUbuaAQKjpfl1","EventQuestItemFrameThumbnail");var a=t("EventQuestFrameThumbnailBase"),n=t("CommonUtils"),o=t("ItemUtils"),r=t("EventUtils");cc.Class({extends:a,properties:{},initWindowFrame:function(){this.thumbnailParentNode.destroyAllChildren();for(var t=r.getEventItemMasterGroupByEventId()[n.getRoot().getEventId()],e=0;e<3;e+=1){var i=o.getUserItemCount(t[e].getItemId());this._initItemThumbnail(t[e].getItemType(),t[e].getItemId(),i)}}}),cc._RF.pop()},{CommonUtils:"CommonUtils",EventQuestFrameThumbnailBase:"EventQuestFrameThumbnailBase",EventUtils:"EventUtils",ItemUtils:"ItemUtils"}],EventQuestNormalExTabView:[function(t,e,i){"use strict";cc._RF.push(e,"7ef0e7pZqxMaLKK9dndcRbn","EventQuestNormalExTabView");t("TabViewBase"),t("QuestUtils"),t("GameConst");var a=t("QuestNormalExTabView");cc.Class({extends:a,properties:{},_tabEvent:function(t,e,i){this._root.switchSelectAreaId(),this._activateTab(e)}});cc._RF.pop()},{GameConst:"GameConst",QuestNormalExTabView:"QuestNormalExTabView",QuestUtils:"QuestUtils",TabViewBase:"TabViewBase"}],EventQuestPointFrameThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"28a35jtM41P8Jd0QMBSFpkf","EventQuestPointFrameThumbnail");var a=t("EventQuestFrameThumbnailBase"),n=t("CommonUtils"),o=t("ItemUtils"),r=t("EventUtils");cc.Class({extends:a,properties:{totalEventPointNameLabel:cc.Label,totalEventPointNumLabel:cc.Label,nextEventRewardRemainingPointNumLabel:cc.Label,nextEventRewardNameLabel:cc.Label,nextEventRewardNumPrefixNode:cc.Node,nextEventRewardNumLabel:cc.Label},_eventPointRewardMaster:null,initWindowFrame:function(){r.hasEventPointMaster(n.getRoot().getEventId())?(this._setEventPointLabel(),this._setEventReward()):this.node.active=!1},_setEventPointLabel:function(){var t=r.getEventItemMasterGroupByEventId()[n.getRoot().getEventId()][0].getItemId();this.totalEventPointNameLabel.string=o.getItemMaster(t).getName();var e=r.getTotalEventPointByEventIdAndItemId(n.getRoot().getEventId(),t);this._eventPointRewardMaster=r.getNextEventPointRewardMaster(n.getRoot().getEventId(),e);var i=this._eventPointRewardMaster?parseInt(this._eventPointRewardMaster.getPoint(),10):0,a=i?i-e:0;this.totalEventPointNumLabel.string=n.convertToCommaDelimited(e),this.nextEventRewardRemainingPointNumLabel.string=n.convertToCommaDelimited(a)},_setEventReward:function(){if(!this._eventPointRewardMaster)return this.nextEventRewardNameLabel.node.active=!1,this.nextEventRewardNumPrefixNode.active=!1,void(this.nextEventRewardNumLabel.node.active=!1);var t=this._eventPointRewardMaster.getItemType(),e=this._eventPointRewardMaster.getItemId(),i=o.getItemInfo(t,e).name,a=this._eventPointRewardMaster.getCount();this.nextEventRewardNameLabel.string=i,this.thumbnailParentNode.destroyAllChildren(),this._initItemThumbnail(t,e),this.nextEventRewardNumLabel.string=a}}),cc._RF.pop()},{CommonUtils:"CommonUtils",EventQuestFrameThumbnailBase:"EventQuestFrameThumbnailBase",EventUtils:"EventUtils",ItemUtils:"ItemUtils"}],EventQuestPointRewardListPopup:[function(t,e,i){"use strict";cc._RF.push(e,"bb1e8Rpiy5FB4aJSQlV4yDu","EventQuestPointRewardListPopup");var a=t("PopupBase"),n=(t("Singleton"),t("CommonButton")),o=t("CommonScrollView"),r=t("EventUtils"),s=(t("ResourceUtils"),t("HistoryUtils"),t("CommonUtils"));t("ItemUtils"),cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,commonScrollView:o,totalEventPointNumLabel:cc.Label,haveRewardNumLabel:cc.Label,maxRewardNumLabel:cc.Label,eventQuestPointRewardListThumbnailPrefab:cc.Prefab,closeBtn:n},_eventPointRewardMasterArray:null,_receivedRewardMasterArray:null,_notReceivedRewardMasterArray:null,openEventQuestPointRewardListPopup:function(t,e){this.setCloseCallBack(e),this._setParameter(t),this._setScrollViewContent(),this.closeBtn.setTapEvent(function(){this.close()}.bind(this),n.SE_NAME.CANCEL),this.open(this.openCallback.bind(this))},_setParameter:function(t){var e=r.getEventItemMasterGroupByEventId()[t][0].getItemId(),i=r.getTotalEventPointByEventIdAndItemId(t,e);this.totalEventPointNumLabel.string=s.convertToCommaDelimited(i);var a=r.getEventPointRewardMasterGroupByEventId()[t];this._notReceivedRewardMasterArray=a.filter(function(t){return!r.isReceivedRewardMaster(t,i)}),this._receivedRewardMasterArray=a.filter(function(t){return r.isReceivedRewardMaster(t,i)}),this.haveRewardNumLabel.string=s.convertToCommaDelimited(this._receivedRewardMasterArray.length),this.maxRewardNumLabel.string=s.convertToCommaDelimited(a.length)},_setScrollViewContent:function(){this.itemThumbnailParentNode.destroyAllChildren();for(var t=null,e=0;e<this._notReceivedRewardMasterArray.length;e+=1)(t=cc.instantiate(this.eventQuestPointRewardListThumbnailPrefab).getComponent("EventQuestPointRewardListThumbnail")).init(this._notReceivedRewardMasterArray[e],!1),this.itemThumbnailParentNode.addChild(t.node);for(e=0;e<this._receivedRewardMasterArray.length;e+=1)(t=cc.instantiate(this.eventQuestPointRewardListThumbnailPrefab).getComponent("EventQuestPointRewardListThumbnail")).init(this._receivedRewardMasterArray[e],!0),this.itemThumbnailParentNode.addChild(t.node);this.commonScrollView.node.active=!1},openCallback:function(){this.commonScrollView.node.active=!0,this.commonScrollView.scrollToTop()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",EventUtils:"EventUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],EventQuestPointRewardListThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"8bd49+28R9L1IpBnEWu44oA","EventQuestPointRewardListThumbnail");t("MatrixThumbnail");var a=t("CommonUtils"),n=(t("ResourceUtils"),t("ItemUtils")),o=t("MatrixThumbnailUtils");cc.Class({extends:cc.Component,properties:{thumbnailParentNode:cc.Node,needEventPointNumLabel:cc.Label,itemNameLabel:cc.Label,itemQuantityNumLabel:cc.Label,itemDescriptionLabel:cc.Label,clearedNode:cc.Node},init:function(t,e){this._setParameter(t,e)},_setParameter:function(t,e){var i=n.getItemInfo(t.getItemType(),t.getItemId());this._initItemThumbnail(t.getItemType(),t.getItemId()),this.needEventPointNumLabel.string=a.convertToCommaDelimited(t.getPoint()),this.itemNameLabel.string=i.name,this.itemQuantityNumLabel.string=a.convertToCommaDelimited(t.getCount()),this.itemDescriptionLabel.string=i.text,this.clearedNode.active=e},_initItemThumbnail:function(t,e){this.thumbnailParentNode.destroyAllChildren();var i=o.createMatrixThumbnailByItemType(e,t);this.thumbnailParentNode.addChild(i.node)}}),cc._RF.pop()},{CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",MatrixThumbnail:"MatrixThumbnail",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils"}],EventQuestRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"8e524EJrJtIpI4fygB7t7eQ","EventQuestRootBase");var a=t("QuestRootBase"),n=t("Singleton"),o=t("UserProgressUtils"),r=t("CommonUtils"),s=t("QuestUtils"),c=(t("EventUtils"),t("ResourceUtils")),l=t("ExtensionAdvUtils"),u=t("ExtensionAdvUtils"),h=t("UnlockEffectUtils"),d=(t("GameConst"),t("DeckConst")),p=t("LocalDataConst"),m=t("BattleFunction");t("BattleData"),cc.Class({extends:a,properties:{},_eventId:0,initialize:function(){o.isUnreadEventHelp(this.getEventId())&&(this.openEventQuestHowToPlayPopup(),o.setReadEventHelp(this.getEventId()))},_setEventId:function(t){this._eventId=parseInt(t)},pushBattleStartConfirmSubRoot:function(t,e,i){var a={BattleStartConfirmSubRoot:{stageId:t,hideSkip:!0,eventId:this._eventId}},n={EventQuestStageSelectSubRoot:{eventId:this._eventId,worldId:this.selectWorldId,areaId:this.selectAreaId,stageId:0,difficult:this.selectDifficult}};t&&e?(cc.log(this.getCurrentSceneName()),this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),a,n)):cc.error("stageId\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},requestStartBattle:function(t,e,i,a,o){var r=n.localData[p.SELECT_QUEST_DECK_ORDER];n.EventService.startBattle(t,r,i,function(t){cc.log("startBattle : \u901a\u4fe1\u5b8c\u4e86");var i=e.getQuestStartUserStoryModel();if(!i||i.getIsRead())this.transitionBattleScene(e,t,a,o);else{var n=i.getStoryGroupId(),r=i.getStoryId(),s=i.getResourceId();this.requestReedStory(r,function(){u.startAdv(r,0,[l.createAdvTextInfo(r,c.getFileNameStoryEventScript(n,s),c.getFileNameStoryEventSynopsis(n,s))],null,null,function(){this.transitionBattleScene(e,t,a,o)}.bind(this))}.bind(this))}}.bind(this))},requestEndBattle:function(t,e,i){var a=n.dao.userQuests,o=_.find(n.dao.userQuests,function(t){return t.getStageId()===e});n.EventService.endBattle(t,function(t){h.saveUnLockEffectForExtraQuest(o,a),i&&i(t)})},requestAutoBattle:function(t,e,i,a,o,r){n.EventService.startBattle(t,i,a,function(t){var i=t.session;m.setEventStartBattleData(e,t.stage,m.createSessionObjectData(i.sessionId,i.stageId,i.deckId,i.deckType),null),n.soundManager.bgmStop(),o&&"function"==typeof o&&o(),cc.director.loadScene("battleLoading.fire",function(){r&&"function"==typeof r&&r()})})},transitionEventForEndBattle:function(t){var e=s.createUserStageFlatMap()[t].getQuestEndUserStoryModel();if(!e||e.getIsRead())r.getRoot().popScene();else{var i=e.getStoryGroupId(),a=e.getStoryId(),o=e.getResourceId();n.StoryService.readStory(a,function(){u.startAdv(a,0,[l.createAdvTextInfo(a,c.getFileNameStoryEventScript(i,o),c.getFileNameStoryEventSynopsis(i,o))],null,null,function(){r.getRoot().popScene()})})}},transitionBattleScene:function(t,e,i,a){m.setEventStartBattleData(t,e.stage,m.createSessionObjectData(e.session.sessionId,e.session.stageId,e.session.deckId,d.DECK_TYPE.QUEST),m.createBattleCallbacks(this.requestSaveBattleTransaction,this.requestEndBattle,this.requestEndBattle,this.transitionEventForEndBattle.bind(this),this.requestAutoBattle)),n.soundManager.bgmStop(),i&&"function"==typeof i&&i();this.pushScene("battleLoading",void 0,{},void 0),a&&"function"==typeof a&&a()}});cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",CommonUtils:"CommonUtils",DeckConst:"DeckConst",EventUtils:"EventUtils",ExtensionAdvUtils:"ExtensionAdvUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",QuestRootBase:"QuestRootBase",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",UnlockEffectUtils:"UnlockEffectUtils",UserProgressUtils:"UserProgressUtils"}],EventQuestRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"229e6cC5NNIFYbkBmATzeez","EventQuestRootUtils");var a=t("Singleton"),n=t("EventQuestTopSubRoot"),o=t("EventQuestStageSelectSubRoot"),r=t("BattleStartConfirmSubRoot");e.exports={openEventQuestTopSubRoot:function(t,e){cc.log("openEventQuestTopSubRoot"),cc.log(e),t.setListViewParam(e.worldId,e.areaId,e.stageId,t.selectDifficult),void 0===t._eventQuestTopSubRoot||null===t._eventQuestTopSubRoot?(t._eventQuestTopSubRoot=cc.instantiate(t.eventQuestTopSubRootPrefab).getComponent(n),t.subRootParent.addChild(t._eventQuestTopSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),t.setBackButtonCallBack(null),t._eventQuestTopSubRoot.initEventQuestTopSubRoot(e.eventId)},closeEventQuestTopSubRoot:function(t,e){cc.log("closeEventQuestTopSubRoot"),cc.log(e),t._eventQuestTopSubRoot&&(t._eventQuestTopSubRoot.node.destroy(),t._eventQuestTopSubRoot=null)},openEventQuestStageSelectSubRoot:function(t,e){cc.log("openEventQuestStageSelectSubRoot"),cc.log(e);var i=e.difficult?e.difficult:t.selectDifficult;t.setListViewParam(e.worldId,e.areaId,e.stageId,i),void 0===t._eventQuestStageSelectSubRoot||null===t._eventQuestStageSelectSubRoot?(t._eventQuestStageSelectSubRoot=cc.instantiate(t.eventQuestStageSelectSubRootPrefab).getComponent(o),t.subRootParent.addChild(t._eventQuestStageSelectSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),t.setBackButtonCallBack(t.popEventQuestAnimation),t._eventQuestStageSelectSubRoot.initEventQuestStageSelectSubRoot(e.eventId)},closeEventQuestStageSelectSubRoot:function(t,e){cc.log("closeEventQuestStageSelectSubRoot"),cc.log(e),t._eventQuestStageSelectSubRoot&&(t._eventQuestStageSelectSubRoot.node.destroy(),t._eventQuestStageSelectSubRoot=null)},openBattleStartConfirmSubRoot:function(t,e){cc.log("openBattleStartConfirmSubRoot"),cc.log(e),t.setListViewParam(t.selectWorldId,t.selectAreaId,e.stageId,t.selectDifficult);for(var i=parseInt(e.stageId,10),n=0;n<a.dao.userQuests.length;n++)if(a.dao.userQuests[n].userData._data.stageId===i){t.openStageQuestModel=a.dao.userQuests[n];break}void 0===t.battleStartConfirmSubRoot||null===t.battleStartConfirmSubRoot?(t.battleStartConfirmSubRoot=cc.instantiate(t.battleStartConfirmSubRootPrefab).getComponent(r),t.battleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,t.openStageQuestModel,e.hideSkip),t.subRootParent.addChild(t.battleStartConfirmSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),t.setBackButtonCallBack(null)},closeBattleStartConfirmSubRoot:function(t,e){cc.log("closeBattleStartConfirmSubRoot"),cc.log(e),t.battleStartConfirmSubRoot&&(t.battleStartConfirmSubRoot.node.destroy(),t.battleStartConfirmSubRoot=null)}},cc._RF.pop()},{BattleStartConfirmSubRoot:"BattleStartConfirmSubRoot",EventQuestStageSelectSubRoot:"EventQuestStageSelectSubRoot",EventQuestTopSubRoot:"EventQuestTopSubRoot",Singleton:"Singleton"}],EventQuestRoot:[function(t,e,i){"use strict";cc._RF.push(e,"308baaQ9iRGu5hp1gM8P+EF","EventQuestRoot");var a=t("EventQuestRootBase"),n=t("EventQuestViewSetting"),o=(t("Singleton"),t("EventUtils")),r=t("QuestUtils"),s=(t("CommonUtils"),t("PopupUtils")),c=t("CharacterUtils"),l=t("ResourceUtils"),u=t("ExchangeUtils"),h=t("AnimationUtils"),d=t("SceneConst"),p=t("GameConst"),m=(t("LocalDataConst"),t("EventQuestConst"));t("UnlockEffectConst"),cc.Class({extends:a,properties:{eventQuestTopSubRootPrefab:cc.Prefab,eventQuestStageSelectSubRootPrefab:cc.Prefab,eventQuestPointRewardListPopupPrefab:cc.Prefab,eventQuestHowToPlayPopupPrefab:cc.Prefab,eventQuestDifficultyUnlockPopupPrefab:cc.Prefab},_eventQuestTopSubRoot:null,_eventQuestStageSelectSubRoot:null,_eventQuestPointRewardListPopup:null,_eventQuestHowToPlayPopup:null,_eventQuestDifficultyUnlockPopup:null,_eventMainMaster:null,_eventAreaIdArray:null,initData:function(){if(this.sceneParam){var t=JSON.parse(this.sceneParam),e=t[Object.keys(t)[0]];this.initEventInfo(e.eventId)}},initResource:function(){this._super();var t=this.getEventId();t||(t=1);var e=o.getEventCharacterMasterGroupByEventId()[t],i=c.getCharacterSkillMainMasterMapIndexBySkillId();e.forEach(function(t){var e=c.getCharacterMainModelByCharacterId(t.getCharacterId()),a=i[e.getSkillId()],n=a.getSpineName(),o=l.getDirectoryIngameSkillSpine(a.getSpineDirectoryPath()),r=a.getHitEffectName(),s=l.getDirectoryIngameHitSpine(a.getSpineDirectoryPath());this.requestRes(o+n,sp.SkeletonData,this._requestEventsSpineRes.bind(this,n,o,r,s))}.bind(this))},_requestEventsSpineRes:function(t,e,i,a){var n=e+t,o=this.getResource(n);o&&_.forEach(o.skeletonJson.animations.home.events,function(t){if(0!==t.name.indexOf("gr_se_")&&0!==t.name.indexOf("se_")&&0!==t.name.indexOf("vo_"))switch(t.name){case i:this.requestRes(a+t.name,sp.SkeletonData);break;default:this.requestRes(e+t.name,sp.SkeletonData)}}.bind(this))},initialize:function(){this._initOpenFirstView({EventQuestTopSubRoot:{eventId:1}}),this._super()},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,n.EVENT_QUEST_SETTING)},createPreViewParam:function(){var t=this.getListViewParam(),e={eventId:this.getEventId(),worldId:t.worldId,areaId:t.areaId,stageId:t.stageId,difficult:t.difficult},i={};return this._eventQuestTopSubRoot&&(i.EventQuestTopSubRoot=e),this._eventQuestStageSelectSubRoot&&(i.EventQuestStageSelectSubRoot=e),this.battleStartConfirmSubRoot&&(i.BattleStartConfirmSubRoot=this.sceneParam.BattleStartConfirmSubRoot),i},initEventInfo:function(t){if(!o.isExistEvent(t))return cc.error("\u5b58\u5728\u3057\u306a\u3044EventId"),this.popScene();void 0!==this.getEventMainMaster()&&null!==this.getEventMainMaster()||(this._setEventId(t),this._setEventMainMaster(),this._initEventAreaIdArray(),this.redrawBackGround(this.getEventMainMaster().getWorldId()))},getEventId:function(){return this._eventId},_setEventMainMaster:function(t){this._eventMainMaster=o.getEventMainMasterMap()[this._eventId]},getEventMainMaster:function(){return this._eventMainMaster},_initEventAreaIdArray:function(){var t=this.getEventMainMaster().getWorldId();this._eventAreaIdArray=[];var e=parseInt(Object.keys(r.getUserQuestDifficultMapByWorldId(t,p.QUEST_DIFFICULT.NORMAL.NORMAL))[0],10);this._eventAreaIdArray.push(e);var i=parseInt(Object.keys(r.getUserQuestDifficultMapByWorldId(t,p.QUEST_DIFFICULT.NORMAL.EX))[0],10);this._eventAreaIdArray.push(i)},switchSelectAreaId:function(){this.selectAreaId===this._eventAreaIdArray[m.DIFFICULT.NORMAL]?this.selectAreaId=this._eventAreaIdArray[m.DIFFICULT.HARD]:this.selectAreaId=this._eventAreaIdArray[m.DIFFICULT.NORMAL]},popEventQuestAnimation:function(t){var e=p.DIRECTION_TYPE.LEFT;h.startSlideInAnimation(.5,e,cc.Color.BLACK,function(){if(h.startSlideOutAnimation(.5,e,cc.Color.BLACK),t)return t()})},pushEventQuestStageSelectSubRoot:function(){if(!o.isEventOpenByEventId(this._eventId))return s.openSimpleMessageWindow("\u30a4\u30d9\u30f3\u30c8\u306f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002");var t=p.DIRECTION_TYPE.RIGHT;h.startSlideInAnimation(.5,t,cc.Color.BLACK,function(){var e=this.getEventMainMaster().getWorldId(),i=p.QUEST_DIFFICULT.NORMAL.NORMAL,a=this._eventAreaIdArray[m.DIFFICULT.NORMAL];this.selectDifficult&&this.selectDifficult===p.QUEST_DIFFICULT.NORMAL.EX&&(i=p.QUEST_DIFFICULT.NORMAL.EX,a=this._eventAreaIdArray[m.DIFFICULT.HARD]);var n={EventQuestStageSelectSubRoot:{eventId:this._eventId,worldId:e,areaId:a,stageId:0,difficult:i}},o={EventQuestTopSubRoot:{eventId:this._eventId}};this.pushScene(d.SCENE.FILE_NAME.EVENT,d.SCENE.FILE_NAME.EVENT,n,o),h.startSlideOutAnimation(.5,t,cc.Color.BLACK)}.bind(this))},transitionExchangeScene:function(){var t={ExchangeSubRoot:{exchangeId:u.getExchangeIdByEventId(this._eventId)}},e={EventQuestTopSubRoot:{eventId:this._eventId}};this.pushScene("ExchangeScene",this.getCurrentSceneName(),t,e)},transitionMissionScene:function(){var t={MissionTabView:{selectedTab:3}},e={EventQuestTopSubRoot:{eventId:this._eventId}};this.pushScene("MissionScene",this.getCurrentSceneName(),t,e)},openEventQuestPointRewardListPopup:function(){this.closeEventQuestPointRewardListPopup(),this._eventQuestPointRewardListPopup=cc.instantiate(this.eventQuestPointRewardListPopupPrefab).getComponent("EventQuestPointRewardListPopup"),this._eventQuestPointRewardListPopup.openEventQuestPointRewardListPopup(this.getEventId())},closeEventQuestPointRewardListPopup:function(){this._eventQuestPointRewardListPopup&&(this._eventQuestPointRewardListPopup.close(),this._eventQuestPointRewardListPopup=null)},openEventQuestHowToPlayPopup:function(){this.closeEventQuestHowToPlayPopup(),this._eventQuestHowToPlayPopup=cc.instantiate(this.eventQuestHowToPlayPopupPrefab).getComponent("EventQuestHowToPlayPopup"),this._eventQuestHowToPlayPopup.openEventQuestHowToPlayPopup(this.getEventId())},closeEventQuestHowToPlayPopup:function(){this._eventQuestHowToPlayPopup&&(this._eventQuestHowToPlayPopup.close(),this._eventQuestHowToPlayPopup=null)},openQuestDifficultyUnlockPopup:function(){this.closeQuestDifficultyUnlockPopup(),this._eventQuestDifficultyUnlockPopup=cc.instantiate(this.eventQuestDifficultyUnlockPopupPrefab).getComponent("EventQuestDifficultyUnlockPopup"),this._eventQuestDifficultyUnlockPopup.openEventQuestDifficultyUnlockPopup(this.getEventMainMaster())},closeQuestDifficultyUnlockPopup:function(){this._eventQuestDifficultyUnlockPopup&&(this._eventQuestDifficultyUnlockPopup.close(),this._eventQuestDifficultyUnlockPopup=null)}});cc._RF.pop()},{AnimationUtils:"AnimationUtils",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",EventQuestConst:"EventQuestConst",EventQuestRootBase:"EventQuestRootBase",EventQuestViewSetting:"EventQuestViewSetting",EventUtils:"EventUtils",ExchangeUtils:"ExchangeUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",UnlockEffectConst:"UnlockEffectConst"}],EventQuestStageSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"fe3e2R8HrhJm55OuNev8X1o","EventQuestStageSelectSubRoot");var a=t("QuestAreaStageSelectSubRoot"),n=t("EventQuestFrameThumbnailBase"),o=(t("CommonButton"),t("QuestUtils")),r=t("EventUtils"),s=t("CommonUtils"),c=t("TimeUtils"),l=(t("ViewUtils"),t("ResourceUtils")),u=t("GameConst"),h=(t("CharacterConst"),t("EventQuestConst"));cc.Class({extends:a,properties:{logoImageSprite:cc.Sprite,endDateLabel:cc.Label,eventQuestFrameThumbnailArray:[n]},_root:null,_eventType:null,_eventCharacterMasterArray:null,initEventQuestStageSelectSubRoot:function(t){cc.log("initEventQuestStageSelectSubRoot"),this._root=s.getRoot(),this._root.initEventInfo(t),this._initEventWindowInfo(),this._initEventCharacterInfo(),this._initStageListView()},_initStageListView:function(){this._selectedWorldId=this._root.getEventMainMaster().getWorldId(),this._setInitQuestData(this._selectedWorldId),this._questNormalExTabView||(this._questNormalExTabView=cc.instantiate(this.questNormalExTabViewPrefab).getComponent("EventQuestNormalExTabView"),this.node.addChild(this._questNormalExTabView.node));var t=o.getUserQuestDifficultMapByWorldId(this._selectedWorldId,u.QUEST_DIFFICULT.NORMAL.EX),e=Object.keys(t).length>0,i=o.isAreaDifficultByWorldId(this._selectedWorldId,u.QUEST_DIFFICULT.NORMAL.EX);this._questNormalExTabView.initQuestNormalExTabView(this._root,i,e)},_initEventWindowInfo:function(){this._setEventType(),this._initLogo(),this._initEndDate(),this._initWindowFrame()},_setEventType:function(){this._eventType=parseInt(this._root.getEventMainMaster().getEventType())},_initLogo:function(){l.addSprite(this.logoImageSprite,l.getFileNameLogoByEventId(this._root.getEventMainMaster().getEventId()))},_initEndDate:function(){var t="\u7d42\u4e86\u65e5\u6642\uff1a"+c.parseTimeToYmdhm(this._root.getEventMainMaster().getToDate())+" \u307e\u3067";this.endDateLabel.string=t},_initWindowFrame:function(){switch(this.eventQuestFrameThumbnailArray.forEach(function(t){t.node.active=!1}),this._eventType){case h.EVENT_TYPE.POINT:this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.POINT].node.active=!0,this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.POINT].initWindowFrame();break;case h.EVENT_TYPE.ITEM:this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.ITEM].node.active=!0,this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.ITEM].initWindowFrame()}},_reloadCharacterStandImage:function(){var t=s.getRandom(0,this._eventCharacterMasterArray.length-1);this._characterStandView.setCharacterStandImage(this._eventCharacterMasterArray[t].getCharacterId())},_initEventCharacterInfo:function(){this._initCharacterStandView(),this._eventCharacterMasterArray=r.getEventCharacterMasterGroupByEventId()[this._root.getEventId()],this._reloadCharacterStandImage()}}),cc._RF.pop()},{CharacterConst:"CharacterConst",CommonButton:"CommonButton",CommonUtils:"CommonUtils",EventQuestConst:"EventQuestConst",EventQuestFrameThumbnailBase:"EventQuestFrameThumbnailBase",EventUtils:"EventUtils",GameConst:"GameConst",QuestAreaStageSelectSubRoot:"QuestAreaStageSelectSubRoot",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils",ViewUtils:"ViewUtils"}],EventQuestTopSubRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"fd66d++PBxDM7OL3KzfIQ2U","EventQuestTopSubRootBase");var a=t("WindowBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("TimeUtils"),s=t("EventUtils"),c=t("CharacterUtils"),l=t("ExtensionAdvUtils"),u=t("CharacterConst");cc.Class({extends:a,properties:{characterAvatar:sp.Skeleton,logoImageSprite:cc.Sprite,endDateLabel:cc.Label,missionBtn:n,howToPlayBtn:n,eventStageSelectBtn:n},_root:null,_eventCharacterMasterArray:null,onLoad:function(){this.missionBtn.setTapEvent(this._onTapMissionBtn.bind(this)),this.howToPlayBtn.setTapEvent(this._onTapHowToPlayBtn.bind(this)),this.eventStageSelectBtn.setTapEvent(this._onTapEventStageSelectBtn.bind(this))},_initEventCharacterInfo:function(){this._eventCharacterMasterArray=s.getEventCharacterMasterGroupByEventId()[this._root.getEventId()]},_initLogo:function(){o.addSprite(this.logoImageSprite,o.getFileNameLogoByEventId(this._root.getEventId()))},_initEndDate:function(){var t="\u7d42\u4e86\u65e5\u6642\uff1a"+r.parseTimeToYmdhm(this._root.getEventMainMaster().getToDate())+" \u307e\u3067";this.endDateLabel.string=t},_onTapMissionBtn:function(){cc.error("_onTapMissionBtn() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_onTapHowToPlayBtn:function(){cc.error("_onTapHowToPlayBtn() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_onTapEventStageSelectBtn:function(){cc.error("_onTapEventStageSelectBtn() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_setCharacterAvatar:function(){var t=this,e=this._eventCharacterMasterArray[0].getCharacterId(),i=c.getCharacterSkillMainMasterMapIndexBySkillId(),a=c.getCharacterMainModelByCharacterId(e),n=i[a.getSkillId()],r=i[a.getSkillId()].getSpineName(),s=o.getDirectoryIngameSkillSpine(n.getSpineDirectoryPath());this.characterAvatar.skeletonData=o.getResource(s+r);if(null===this._layerNodeList)this._layerNodeList=[];else{for(var h in this._layerNodeList)this._layerNodeList[h].destroy();this._layerNodeList=[]}if(0===this._layerNodeList.length)for(var d=0;d<10;d+=1){var p=new cc.Node;p.parent=this.characterAvatar.node.parent,p.setPosition(cc.v2(0,0));var m=9-d;p.zIndex=m,this._layerNodeList.push(p)}if(this.characterAvatar.setEventListener(function(i,a){var n=a.data.name.split(","),o=n[0],r=(n.length>=2&&n[1],a.stringValue?a.stringValue.split(","):[]),c=r.length>=3?r[2]-1:null,h=s+o,d=c,p=t._layerNodeList[d],m=new cc.Node,_=m.addComponent(sp.Skeleton);if(_.skeletonData=t._root.getResource(h),_.timeScale=1,m.parent=p,m.setPosition(cc.v2(0,0)),l.setFadeIn(m,.2),!_.setAnimation(0,u.ROOM_SPINE_ANIM_TYPE.HOME,!0))throw new Error(e+" character spine `"+u.ROOM_SPINE_ANIM_TYPE.HOME+"` animation not found")}),this.characterAvatar.setCompleteListener(function(t,e){this.characterAvatar.setEventListener(null),this.characterAvatar.setCompleteListener(null)}.bind(this)),!this.characterAvatar.setAnimation(0,u.ROOM_SPINE_ANIM_TYPE.HOME,!0))throw new Error(e+" character spine `"+u.ROOM_SPINE_ANIM_TYPE.HOME+"` animation not found")}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",EventUtils:"EventUtils",ExtensionAdvUtils:"ExtensionAdvUtils",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils",WindowBase:"WindowBase"}],EventQuestTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"43149XQKqlJHqrB5V+ytFlp","EventQuestTopSubRoot");var a=t("EventQuestTopSubRootBase"),n=t("EventQuestFrameThumbnailBase"),o=t("Singleton"),r=t("CommonButton"),s=(t("EventUtils"),t("CommonUtils")),c=(t("ViewUtils"),t("CharacterUtils"),t("ResourceUtils")),l=t("ExtensionAdvUtils"),u=t("LocalDataConst"),h=(t("CharacterConst"),t("EventQuestConst")),d=t("SingletonConst"),p=t("ErrorCode");cc.Class({extends:a,properties:{characterImageSprite:cc.Sprite,avatarBackground:cc.Node,eventQuestFrameThumbnailArray:[n],rewardBtn:r,exchangeBtn:r},_eventType:null,_bSpineInit:null,_bSpineEnd:null,_subRootAnimation:null,_layerNodeList:null,onLoad:function(){this._super(),this._bSpineInit=!0,this._bSpineEnd=!1,this._subRootAnimation=cc.director.getScene().getChildByName("Canvas").getChildByName("SubRootParent").getComponent(cc.Animation)},update:function(t){try{this._bSpineInit&&!this._subRootAnimation.getAnimationState("SubRoot_Start").isPlaying&&Array.isArray(this._eventCharacterMasterArray)&&(this._bSpineInit=!this._bSpineInit,this._initSpineCharacter()),!this._bSpineEnd&&this._subRootAnimation.getAnimationState("SubRoot_End").isPlaying&&(this._bSpineEnd=!this._bSpineEnd,l.setFadeOutAll(this.avatarBackground,2))}catch(t){this._openThrowError(t)}},_openThrowError:function(t){cc.error(t),this.changeSprite(this.characterImageSprite),o[d.ERROR_MANAGER]&&o[d.ERROR_MANAGER].throwError(p.OUTGAME_SPINE_ERROR)},initEventQuestTopSubRoot:function(t){s.loadLocalStorage(u.LOCAL_STORAGE_KEY.EVENT_FIRST_LOOK+t,!1,u.LOCAL_STORAGE_GET_TYPE.BOOLEAN)||s.saveLocalStorage(u.LOCAL_STORAGE_KEY.EVENT_FIRST_LOOK+t,!0),this._root=s.getRoot(),this._root.initEventInfo(t),this._setEventType(),this._initLogo(),this._initEndDate(),this._initWindowFrame(),this._initEventCharacterInfo(),this._initButton()},_setEventType:function(){this._eventType=parseInt(this._root.getEventMainMaster().getEventType())},_initWindowFrame:function(){switch(this.eventQuestFrameThumbnailArray.forEach(function(t){t.node.active=!1}),this._eventType){case h.EVENT_TYPE.POINT:this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.POINT].node.active=!0,this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.POINT].initWindowFrame();break;case h.EVENT_TYPE.ITEM:this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.ITEM].node.active=!0,this.eventQuestFrameThumbnailArray[h.WINDOW_FRAME_TYPE.ITEM].initWindowFrame()}},changeSprite:function(t){t.node.setPosition(cc.v2(0,0)),c.addSprite(t,c.getFileNameCharacterStand(this._eventCharacterMasterArray[0].getCharacterId()))},_initButton:function(){switch(this.rewardBtn.node.active=!1,this.exchangeBtn.node.active=!1,this._eventType){case h.EVENT_TYPE.POINT:this.rewardBtn.node.active=!0,this.rewardBtn.setTapEvent(this._onTapRewardBtn.bind(this));break;case h.EVENT_TYPE.ITEM:this.exchangeBtn.node.active=!0,this.exchangeBtn.setTapEvent(this._onTapExchangeBtn.bind(this))}},_onTapRewardBtn:function(){this._root.openEventQuestPointRewardListPopup()},_onTapExchangeBtn:function(){this._root.transitionExchangeScene()},_onTapMissionBtn:function(){this._root.transitionMissionScene()},_onTapHowToPlayBtn:function(){this._root.openEventQuestHowToPlayPopup()},_onTapEventStageSelectBtn:function(){this._root.pushEventQuestStageSelectSubRoot()},_initSpineCharacter:function(){this.avatarBackground.opacity=255,this._setCharacterAvatar()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ErrorCode:"ErrorCode",EventQuestConst:"EventQuestConst",EventQuestFrameThumbnailBase:"EventQuestFrameThumbnailBase",EventQuestTopSubRootBase:"EventQuestTopSubRootBase",EventUtils:"EventUtils",ExtensionAdvUtils:"ExtensionAdvUtils",LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",ViewUtils:"ViewUtils"}],EventQuestViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"87c2cT0hBNNbqytGCksoprN","EventQuestViewSetting");var a=t("EventQuestRootUtils");e.exports={EVENT_QUEST_SETTING:{EventQuestTopSubRoot:{open:a.openEventQuestTopSubRoot,close:a.closeEventQuestTopSubRoot},EventQuestStageSelectSubRoot:{open:a.openEventQuestStageSelectSubRoot,close:a.closeEventQuestStageSelectSubRoot},BattleStartConfirmSubRoot:{open:a.openBattleStartConfirmSubRoot,close:a.closeBattleStartConfirmSubRoot}}},cc._RF.pop()},{EventQuestRootUtils:"EventQuestRootUtils"}],EventRegularQuestAdventWarStageListView:[function(t,e,i){"use strict";cc._RF.push(e,"7d604ckFaBJo4uFI+I1x4vy","EventRegularQuestAdventWarStageListView");var a=t("CommonButton"),n=t("CommonScrollView"),o=t("QuestUtils"),r=t("ResourceUtils"),s="detailStatus",c="detailAchieve";cc.Class({extends:cc.Component,properties:{stageThumbnailPrefab:cc.Prefab,scrollView:n,switchThumbnailImageBtn:a},_root:null,onLoad:function(){this.switchThumbnailImageBtn.setTapEvent(this._onTapSwitchThumbnailImageBtn.bind(this),a.SE_NAME.COUNT)},redraw:function(){this._setListContent()},iniStageListView:function(t){this._root=t,this._setListContent()},_setListContent:function(){this.scrollView.content.destroyAllChildren();var t=o.getUserQuestMapByWorldId(this._root.getEventMainMaster().getWorldId());Object.keys(t).forEach(function(e){Object.keys(t[e]).forEach(function(i){this._addThumbnail(t[e][i])}.bind(this))}.bind(this)),this._thumbImageType||(this._thumbImageType=s),this._redrawListView()},_addThumbnail:function(t){var e=cc.instantiate(this.stageThumbnailPrefab).getComponent("EventRegularQuestAdventWarStageThumbnail");e.setStageName(t.getStageName()),e.setThumbnailImage(r.getFileNameAreaThumbnail(t.getAreaId())),e.setAttributeImage(r.getFileNameAreaImage(t.getAreaId())),e.setDifficult(t.getAreaDifficult(),t.getAreaName()),e.setConsumeCountLabel(t.getStamina()),e.setUserData(t),t.getMaxClearCount()&&t.getMaxClearCount()<=t.getClearCount()?(e.setGrayOut(!0),e.setCallbackToThumbnail(null)):(e.setGrayOut(!1),e.setCallbackToThumbnail(function(){this._root.pushBattleStartConfirmSubRoot(t.getStageId(),t.getAreaId(),t.getAreaDifficult())}.bind(this))),this.scrollView.content.addChild(e.node)},_callbackToThumbnail:function(t){var e=t.getStageId(),i=t.getAreaId();this._root.pushBattleStartConfirmSubRoot(e,i,this._root.selectDifficult)},_onTapSwitchThumbnailImageBtn:function(){this._switchThumbnailImage()},_switchThumbnailImage:function(){switch(this._thumbImageType||(this._thumbImageType=s),this._thumbImageType){case s:this._thumbImageType=c;break;case c:this._thumbImageType=s}this._redrawListView()},_redrawListView:function(){for(var t in this.scrollView.content.children)this.scrollView.content.children[t].getComponent("EventRegularQuestAdventWarStageThumbnail").setDisplayMode(this._thumbImageType)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils"}],EventRegularQuestAdventWarStageThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"ad865U8pp9MQbDJtx3NdFRH","EventRegularQuestAdventWarStageThumbnail");var a=t("CommonButton"),n=t("CommonScrollLabel"),o=t("ResourceUtils"),r=t("QuestUtils"),s=t("GameConst"),c="detailStatus",l="detailAchieve",u={EASY:cc.color(30,53,165,255),NORMAL:cc.color(125,53,9,255),HARD:cc.color(134,19,33,255),EXTREME:cc.color(29,82,127,255),CHALLENGE:cc.color(72,31,122,255)};cc.Class({extends:cc.Component,properties:{stageNameLabel:cc.Label,grayOutNode:cc.Node,thumbnailBtn:a,attributeImageSprite:cc.Sprite,thumbnailImageSprite:cc.Sprite,difficultBackImageSprite:cc.Sprite,difficultIconImageSprite:cc.Sprite,difficultIconLabel:cc.Label,consumeCountLabel:cc.Label,questStatusNode:cc.Node,questAchieveNode:cc.Node,questStageNewSprite:cc.Sprite,questStageCompleteSprite:cc.Sprite,questAchieveLabel1:n,questAchieveLabel2:n,questAchieveLabel3:n,questAchieveNode1:cc.Node,questAchieveNode2:cc.Node,questAchieveNode3:cc.Node,questStatusAchieveNodeParent:cc.Node,questStatusAchieveNode1:cc.Node,questStatusAchieveNode2:cc.Node,questStatusAchieveNode3:cc.Node},_callbackThumbnailBtn:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this))},setStageName:function(t){this.stageNameLabel.string=t},setGrayOut:function(t){this.grayOutNode.active=t},setCallbackToThumbnail:function(t){this._callbackThumbnailBtn=t},_onTapThumbnailBtn:function(){this._callbackThumbnailBtn&&this._callbackThumbnailBtn()},setThumbnailImage:function(t){o.addSprite(this.thumbnailImageSprite,t)},setAttributeImage:function(t){o.addSprite(this.attributeImageSprite,t)},setDifficult:function(t,e){o.addSprite(this.difficultBackImageSprite,o.getFileNameDifficultThumbnailBack(t)),o.addSprite(this.difficultIconImageSprite,o.getFileNameDifficultIcon(t)),this.difficultIconLabel.node.getComponent(cc.LabelOutline).color=this._convertDifficultToColor(t),this.difficultIconLabel.string=e},setDifficultText:function(t){this.difficultIconLabel.string=t},setConsumeCountLabel:function(t){this.consumeCountLabel.string=t+""},_convertDifficultToColor:function(t){switch(t){case s.QUEST_DIFFICULT.EVENT_ADVENT.EASY:return u.EASY;case s.QUEST_DIFFICULT.EVENT_ADVENT.NORMAL:return u.NORMAL;case s.QUEST_DIFFICULT.EVENT_ADVENT.HARD:return u.HARD;case s.QUEST_DIFFICULT.EVENT_ADVENT.EXTREME:return u.EXTREME;case s.QUEST_DIFFICULT.EVENT_ADVENT.CHALLENGE:return u.CHALLENGE}return cc.color(0,0,0,255)},setUserData:function(t){this.questStatusAchieveNode1.active=t.getIsClearMission1(),this.questStatusAchieveNode2.active=t.getIsClearMission2(),this.questStatusAchieveNode3.active=t.getIsClearMission3(),this.questAchieveLabel1.setString(t.getQuestAchieveMaster1().getText()),this.questAchieveLabel2.setString(t.getQuestAchieveMaster2().getText()),this.questAchieveLabel3.setString(t.getQuestAchieveMaster3().getText()),this.questAchieveNode1.active=t.getIsClearMission1(),this.questAchieveNode2.active=t.getIsClearMission2(),this.questAchieveNode3.active=t.getIsClearMission3();var e=r.getStageStatus(t);this.questStageNewSprite.node.active=e.newLabel,this.questStageCompleteSprite.node.active=e.completeLabel,e.newLabel||e.completeLabel?this.questStatusAchieveNodeParent.active=!1:this.questStatusAchieveNodeParent.active=!0},setDisplayMode:function(t){switch(this.questStatusNode.active=!1,this.questAchieveNode.active=!1,t){case c:this.questStatusNode.active=!0;break;case l:this.questAchieveNode.active=!0}}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollLabel:"CommonScrollLabel",GameConst:"GameConst",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils"}],EventRegularQuestEquipmentAutoDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"cfab5VGYwNO6Jc0qxymldR0","EventRegularQuestEquipmentAutoDetailPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonCountView"),s=t("BattleData"),c=t("QuestUtils"),l=t("ItemUtils"),u=t("PopupUtils"),h=t("CampaignUtils"),d=0,p=1;cc.Class({extends:a,properties:{costNameLabel:cc.Label,consumeCostNameLabel:cc.Label,costNum:cc.Label,consumeCostBaseNum:cc.Label,consumeCostAfterNum:cc.Label,countViewSpace:r,cancelBtn:o,decisionBtn:o},_root:null,_questModel:null,_autoDetailMode:null,_consumeCostBaseNum:null,_costNum:null,_consumeCostNum:null,_sortiesCount:null,_sortiesMaxCount:null,openAutoDetailPopup:function(t,e){this._root=t,this._questModel=e,this._setAutoDetailMode(),this._setParameter(e),this.cancelBtn.setTapEvent(this._closeBtnEvent.bind(this),o.SE_NAME.CANCEL),this.decisionBtn.setTapEvent(this._onTapDecisionBtn.bind(this)),this.open()},_setAutoDetailMode:function(){this._autoDetailMode=d,this._root.getTodayEventWorldPlayCount()>=this._root.getTodayEventWorldMaxPlayCountWithAp()&&(this._autoDetailMode=p)},_setParameter:function(t){switch(this._autoDetailMode){case d:this.costNameLabel.string="\u6d88\u8cbbAP",this.consumeCostNameLabel.string="AP",this._consumeCostBaseNum=n.dao[n.USER].getCurrentStaminaInfo().currentStamina,this._costNum=t.getStamina();var e=c.getCampaignAPValueByStageId(t.getQuestStageMaster().getStageId());e&&(this._costNum=Math.ceil(this._costNum*e/1e3)),this._sortiesMaxCount=(this._consumeCostBaseNum-this._consumeCostBaseNum%this._costNum)/this._costNum,this._questModel.getMaxDayPlayCount()>0&&(this._sortiesMaxCount=Math.min(this._sortiesMaxCount,h.getMaxDayPlayCount(this._questModel.getQuestStageMaster())-this._questModel.getTodayPlayCount())),this._sortiesMaxCount=Math.min(this._sortiesMaxCount,this._root.getTodayEventWorldMaxPlayCountWithAp()-this._root.getTodayEventWorldPlayCount());break;case p:this.costNameLabel.string="\u6d88\u8cbb\u958b\u653e\u9375",this.consumeCostNameLabel.string="\u958b\u653e\u9375";var i=0,a=0,o=c.getItemQuestLockMasterByQuestId(this._questModel.getAreaId());if(o){var r=l.getItemMaster(o.getItemId());i=r.getItemType(),a=r.getItemId()}this._consumeCostBaseNum=l.getUserItemCount(a,i),this._costNum=1,this._sortiesMaxCount=this._consumeCostBaseNum+1,this._sortiesMaxCount=Math.min(this._sortiesMaxCount,this._root.getTodayEventWorldMaxPlayCount()-this._root.getTodayEventWorldPlayCount())}var s=Math.max(0,Math.min(1,this._sortiesMaxCount));this.consumeCostBaseNum.string=this._consumeCostBaseNum,this.costNum.string=this._costNum,this.countViewSpace.initCommonCountView(this.redraw.bind(this),s,this._sortiesMaxCount),this._sortiesCount=this.countViewSpace.getCountNum(),this._updateReductionAfter()},redraw:function(){switch(this._sortiesCount=this.countViewSpace.getCountNum(),this._autoDetailMode){case d:this.costNum.string=this._costNum*this._sortiesCount;break;case p:this.costNum.string=this._costNum*(this._sortiesCount-1)}this._updateReductionAfter()},_requestStartBattle:function(t){this._root.requestStartBattle(this._questModel.userData._data.stageId,this._questModel,s.isAuto,t>1?function(){s.isAuto=!0,s.autoBattleResultDropItemMap=null,s.autoBattleResultEventItemMap=null,s.maxAutoCount=t,s.autoCount=t}:null)},_onTapDecisionBtn:function(){var t=this._sortiesCount;switch(this._autoDetailMode){case d:this._requestStartBattle(t);break;case p:t>1?u.openCommonPopupYesNo("\u958b\u653e\u9375\u6d88\u8cbb\u78ba\u8a8d","\u958b\u653e\u9375\u3092\u6d88\u8cbb\u3057\u3066\u81ea\u52d5\u5468\u56de\u3092\u884c\u3044\u307e\u3059\u304b\uff1f","2\u5468\u76ee\u304b\u3089\u958b\u653e\u9375\u304c\u6d88\u8cbb\u3055\u308c\u307e\u3059\u3002",!0,this._requestStartBattle.bind(this,t),function(){},"\u6c7a\u5b9a","\u30ad\u30e3\u30f3\u30bb\u30eb",!0):this._requestStartBattle(t)}},_closeBtnEvent:function(){this.close()},_updateReductionAfter:function(){switch(this._autoDetailMode){case d:this.consumeCostAfterNum.string=this._consumeCostBaseNum-this._costNum*this._sortiesCount;break;case p:this.consumeCostAfterNum.string=this._consumeCostBaseNum-this._costNum*(this._sortiesCount-1)}}});cc._RF.pop()},{BattleData:"BattleData",CampaignUtils:"CampaignUtils",CommonButton:"CommonButton",CommonCountView:"CommonCountView",ItemUtils:"ItemUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",Singleton:"Singleton"}],EventRegularQuestEquipmentBattleStartConfirmSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"2775b50OkNFP5cbTacmRD+w","EventRegularQuestEquipmentBattleStartConfirmSubRoot");var a=t("BattleStartConfirmSubRootBase"),n=t("GameConst"),o=(t("QuestConst"),t("SceneConst"),t("CommonButton")),r=t("Singleton"),s=t("PopupUtils"),c=(t("TimeUtils"),t("BattleData")),l=(t("CharacterUtils"),t("ItemConst")),u=t("QuestUtils"),h=t("QuestConditionUtils");t("UserUtils"),cc.Class({extends:a,properties:{subMissionPopupPrefab:cc.Prefab,consumeApLabel:cc.Label,currentApLabel:cc.Label,afterConsumeApLabel:cc.Label,haveTicketLabel:cc.Label,skipGroupNode:cc.Node,questAchieveNode1:cc.Node,questAchieveNode2:cc.Node,questAchieveNode3:cc.Node,infoBtn:o,skipBtn:o},_questModel:null,_skipFlag:null,_userStaminaValue:null,_childContinuousSortieBtn:null,initBattleStartConfirmSubRoot:function(t,e,i){this._questModel=e,t.setSelectedQuestId(u.getWorldMasterByStageId(e.getQuestStageMaster().getStageId()).getCategory(),e.getQuestStageMaster().getWorldId(),e.getQuestStageMaster().getAreaId(),e.getQuestStageMaster().getStageId()),this._super(t,e.getQuestStageMaster()),this.questAchieveNode1.active=this._questModel.getIsClearMission1(),this.questAchieveNode2.active=this._questModel.getIsClearMission2(),this.questAchieveNode3.active=this._questModel.getIsClearMission3(),this.questAchieveNode1.active&&this.questAchieveNode2.active&&this.questAchieveNode3.active?(this.skipBtn.switchBtnImage(h.isTotalClearCountEnabled(this._questModel)&&h.isTodaySkipCountEnabled(this._questModel,1)),this._skipFlag=!0):(this.skipBtn.switchBtnImage(!1),this._skipFlag=!1),this._setButtonEvent(),i&&this._hideSkipGroupNode(),c.isAuto&&this.scheduleOnce(this._autoBattle.bind(this),3),this._switchActiveApGroupNode(this._root.getTodayEventWorldPlayCount()<this._root.getTodayEventWorldMaxPlayCountWithAp()),this._root.redrawBackGround(e.getWorldId())},redraw:function(){this._questModel=r.dao.userQuests.find(function(t){return t.userData.getStageId()===this._questModel.userData.getStageId()}.bind(this)),this._super();var t=u.getCampaignAPValueByStageId(this._stageId),e=this._questModel.getStamina();t&&(e=Math.ceil(e*t/1e3)),this._userStaminaValue=r.dao[r.USER].getCurrentStaminaInfo().currentStamina,this.consumeApLabel.string=e,this.currentApLabel.string=this._userStaminaValue,this.afterConsumeApLabel.string=this._userStaminaValue-e,this._switchActiveApGroupNode(this._root.getTodayEventWorldPlayCount()<this._root.getTodayEventWorldMaxPlayCountWithAp());var i=r.dao.userItems.find(function(t){return t.getItemId()===l.NORMAL_QUEST_SKIP_TICKET});this.haveTicketLabel.string=i?i.getCount():0},_initBattleBtn:function(){this.battleBtn.switchBtnImage(!1),this._root.executeByCondition(0,function(){this.battleBtn.switchBtnImage(!0)}.bind(this)),this.battleBtn.setTapEvent(this._onTapBattleBtn.bind(this))},_setButtonEvent:function(){this.skipBtn.setTapEvent(this._onTapSkipBtn.bind(this)),this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),"")},_hideSkipGroupNode:function(){this.skipGroupNode.active=!1},_switchActiveApGroupNode:function(t){this.consumeApLabel.node.parent.active=t,this.currentApLabel.node.parent.active=t},_autoBattle:function(){this._root.startBattleByCondition(0,function(){this._root.requestStartBattle(this._stageId,this._questModel,c.isAuto)}.bind(this))},_onTapBattleBtn:function(){this._root.startBattleByCondition(0,function(){this._skipFlag?this._root.openEventRegularQuestEquipmentAutoDetailPopup(this._questModel):(this._root.requestStartBattle(this._stageId,this._questModel,c.isAuto),this.battleBtn.setTouchEnable(!1))}.bind(this))},_onTapSkipBtn:function(){this._skipFlag?this._root.startBattleByCondition(1,function(){"0"===this.haveTicketLabel.string?s.openSimpleMessageWindow("\u30c1\u30b1\u30c3\u30c8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059"):this._root.openSkipDetailPopup(this._questModel)}.bind(this)):cc.log("skipBtn")},_onTapInfoBtn:function(){var t=[this.infoBtn.node,this.questAchieveNode1.parent,this.questAchieveNode2.parent,this.questAchieveNode3.parent],e=[];for(var i in t){var a=cc.instantiate(t[i]),o=t[i].convertToWorldSpaceAR(cc.v2(0,0)),r=this._root.node.convertToNodeSpaceAR(o);this._root.node.addChild(a,n.Z_ORDER.POPUP),a.setPosition(r),e.push(a)}var s=u.getStageMasterByStageId(this._questModel.getStageId()),c=cc.instantiate(this.subMissionPopupPrefab).getComponent("QuestSubMissionPopup");c.setCloseCallBack(function(){for(var t in e)e[t].destroy()}),c.openQuestSubMissionPopup(s,this._questModel)}});cc._RF.pop()},{BattleData:"BattleData",BattleStartConfirmSubRootBase:"BattleStartConfirmSubRootBase",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",GameConst:"GameConst",ItemConst:"ItemConst",PopupUtils:"PopupUtils",QuestConditionUtils:"QuestConditionUtils",QuestConst:"QuestConst",QuestUtils:"QuestUtils",SceneConst:"SceneConst",Singleton:"Singleton",TimeUtils:"TimeUtils",UserUtils:"UserUtils"}],EventRegularQuestEquipmentItemUnlockPopup:[function(t,e,i){"use strict";cc._RF.push(e,"74585PmPwJA34SELrVQRm96","EventRegularQuestEquipmentItemUnlockPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("QuestUtils"),t("ResourceUtils")),r=(t("PopupUtils"),t("ItemUtils"));t("ItemConst"),cc.Class({extends:a,properties:{itemSprite:cc.Sprite,releaseMainLabel1Node:cc.Node,releaseMainLabel2Node:cc.Node,keyShortageMainLabel1Node:cc.Node,possessionBaseNum:cc.Label,possessionAfterNum:cc.Label,challengeBtn:n,challengeBtnLabel:cc.Label,cancelBtn:n,remainingReleaseCountNumLabel:cc.Label},_root:null,_questType:null,_questId:null,_unlockType:null,_itemId:null,_callFunc:null,_userItemCount:null,_remainingReleaseCount:null,onLoad:function(){this.challengeBtn.setTapEvent(this._onTapChallengeBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openEventRegularQuestEquipmentItemUnlockPopup:function(t,e,i,a,n,o,r){this._initEventRegularQuestEquipmentItemUnlockPopup(t,e,i,a,n,o,r),this.open()},_initEventRegularQuestEquipmentItemUnlockPopup:function(t,e,i,a,n,r,s){this._setParameter(t,e,i,a,n,r,s),this.releaseMainLabel1Node.active=!1,this.releaseMainLabel2Node.active=!1,this.keyShortageMainLabel1Node.active=!1,this._userItemCount>0?(this.possessionBaseNum.string=this._userItemCount.toString(),this.possessionAfterNum.string=(this._userItemCount-1).toString(),this.releaseMainLabel1Node.active=!0,this.releaseMainLabel2Node.active=!0,this.challengeBtnLabel.string="\u958b\u653e"):(this.possessionBaseNum.string=0,this.possessionAfterNum.string=0,this.keyShortageMainLabel1Node.active=!0,this.challengeBtnLabel.string="\u30b7\u30e7\u30c3\u30d7\u3078"),this.remainingReleaseCountNumLabel.string=this._remainingReleaseCount.toString(),o.addSprite(this.itemSprite,o.getFileNameItemThumbnail(n))},_setParameter:function(t,e,i,a,n,o,s){this._root=t,this._questType=e,this._questId=i,this._unlockType=a,this._itemId=n,this._userItemCount=r.getUserItemCount(this._itemId),this._remainingReleaseCount=o,this._callFunc=s},_onTapChallengeBtn:function(){this._userItemCount<=0?this._root.transitionShopScene():(this._root.requestUnlockQuest(this._questType,this._questId,this._unlockType,this._itemId,this._callFunc.bind(this)),this.close())},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils"}],EventRegularQuestEquipmentListView:[function(t,e,i){"use strict";cc._RF.push(e,"a8332bfA7pFfp+5j82ADj42","EventRegularQuestEquipmentListView");var a=t("CommonButton"),n=t("CommonScrollView"),o=t("QuestUtils"),r=t("ResourceUtils"),s=t("GameConst"),c=t("PopupUtils"),l=t("TimeUtils"),u=t("ItemUtils"),h="detailStatus",d="detailAchieve";cc.Class({extends:cc.Component,properties:{stageThumbnailPrefab:cc.Prefab,scrollView:n,switchThumbnailImageBtn:a,apRemainingCountLabel:cc.Label,apMaxCountLabel:cc.Label,apRecoveryRemainingTimeLabel:cc.Label},_root:null,onLoad:function(){this.switchThumbnailImageBtn.setTapEvent(this._onTapSwitchThumbnailImageBtn.bind(this),a.SE_NAME.COUNT)},redraw:function(){this._setListContent(),this._setApRemainingCountLabel(),this._setApRecoveryRemainingTimeLabel()},iniStageListView:function(t){this._root=t,this._setListContent(),this._setApRemainingCountLabel(),this._setApRecoveryRemainingTimeLabel()},_setListContent:function(){this.scrollView.content.destroyAllChildren();var t=o.getUserQuestMapByWorldId(this._root.getEventMainMaster().getWorldId());Object.keys(t).forEach(function(e){Object.keys(t[e]).forEach(function(i){this._addThumbnail(t[e][i])}.bind(this))}.bind(this)),this._thumbImageType||(this._thumbImageType=h),this._redrawListView()},_addThumbnail:function(t){var e=cc.instantiate(this.stageThumbnailPrefab).getComponent("EventRegularQuestEquipmentThumbnail");if(e.setStageName(t.getStageName()),e.setThumbnailImage(r.getFileNameAreaThumbnail(t.getAreaId())),e.hideAttributeImage(),e.setDifficult(t.getAreaDifficult(),t.getAreaName()),e.setUserData(t),this._root.getTodayEventWorldPlayCount()<this._root.getTodayEventWorldMaxPlayCountWithAp())e.setConsumeCountLabel(t.getStamina()),e.setRemainingNode(!1,0),e.setItemUnlockNode(!1,null),e.setCallbackToThumbnail(function(){this._root.pushEventRegularQuestEquipmentBattleStartConfirmSubRoot(t.getStageId(),t.getAreaId(),t.getAreaDifficult())}.bind(this));else if(this._root.getTodayEventWorldPlayCount()<this._root.getTodayEventWorldMaxPlayCount()&&this._root.getTodayEventWorldPlayCount()+this._root.getTodayEventWorldUserBoostCount()<=this._root.getTodayEventWorldMaxPlayCount()){if(e.hideConsumeCountNode(),o.getTodayUnlockUserBoostByQuestId(s.QUEST_TYPE.AREA,parseInt(t.getAreaId()),[s.BOOST_TYPE.QUEST_UNLOCK]).nowUnlockUserBoost)e.setCallbackToThumbnail(function(){this._root.pushEventRegularQuestEquipmentBattleStartConfirmSubRoot(t.getStageId(),t.getAreaId(),t.getAreaDifficult())}.bind(this)),e.setRemainingNode(!1,0),e.setItemUnlockNode(!1,null);else{var i=0,a=o.getItemQuestLockMasterByQuestId(t.getAreaId());if(a){var n=u.getItemMaster(a.getItemId());i=n.getItemId()}e.setLock(this._root.getTodayEventWorldMaxPlayCount()-(this._root.getTodayEventWorldPlayCount()+this._root.getTodayEventWorldUserBoostCount()),function(){this._root.openEventRegularQuestEquipmentItemUnlockPopup(s.QUEST_TYPE.AREA,t.getAreaId(),s.UNLOCK_TYPE.ITEM,i,function(t){this._openUnlockRequestEndPopup(t)}.bind(this))}.bind(this))}}else e.setConsumeCountLabel(t.getStamina()),e.setLock(0,null),e.setCallbackToThumbnail(function(){c.openSimpleMessageWindow("\u672c\u65e5\u306e\u56de\u6570\u4e0a\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002")});this.scrollView.content.addChild(e.node)},_openUnlockRequestEndPopup:function(t){var e="\u958b\u653e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002";t&&(e="\u958b\u653e\u3057\u307e\u3057\u305f\u3002"),c.openSimpleMessageWindow(e,function(){this._root.redrawUIHeader(),this.redraw()}.bind(this))},_setApRemainingCountLabel:function(){var t=this._root.getTodayEventWorldMaxPlayCountWithAp();this.apMaxCountLabel.string=t,this._root.getTodayEventWorldPlayCount()<this._root.getTodayEventWorldMaxPlayCountWithAp()?t-=this._root.getTodayEventWorldPlayCount():t=0,this.apRemainingCountLabel.string=t.toString()},_setApRecoveryRemainingTimeLabel:function(){var t=l.parseMsToHour(l.getDiffMS(l.getNowDate()+"235959"));this.apRecoveryRemainingTimeLabel.string=t.toString()},_onTapSwitchThumbnailImageBtn:function(){this._switchThumbnailImage()},_switchThumbnailImage:function(){switch(this._thumbImageType||(this._thumbImageType=h),this._thumbImageType){case h:this._thumbImageType=d;break;case d:this._thumbImageType=h}this._redrawListView()},_redrawListView:function(){for(var t in this.scrollView.content.children)this.scrollView.content.children[t].getComponent("EventRegularQuestEquipmentThumbnail").setDisplayMode(this._thumbImageType)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils"}],EventRegularQuestEquipmentThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"ff4db+SlcJGjq/aq5iRl7Sw","EventRegularQuestEquipmentThumbnail");var a=t("CommonButton"),n=t("CommonScrollLabel"),o=t("ResourceUtils"),r=t("QuestUtils"),s=t("GameConst"),c="detailStatus",l="detailAchieve",u={EASY:cc.color(30,53,165,255),NORMAL:cc.color(125,53,9,255),HARD:cc.color(134,19,33,255),EXTREME:cc.color(29,82,127,255)};cc.Class({extends:cc.Component,properties:{stageNameLabel:cc.Label,grayOutNode:cc.Node,thumbnailBtn:a,attributeImageSprite:cc.Sprite,thumbnailImageSprite:cc.Sprite,difficultBackImageSprite:cc.Sprite,difficultIconImageSprite:cc.Sprite,difficultIconLabel:cc.Label,consumeCountLabel:cc.Label,questStatusNode:cc.Node,questAchieveNode:cc.Node,questStageNewSprite:cc.Sprite,questStageCompleteSprite:cc.Sprite,questAchieveLabel1:n,questAchieveLabel2:n,questAchieveLabel3:n,questAchieveNode1:cc.Node,questAchieveNode2:cc.Node,questAchieveNode3:cc.Node,questStatusAchieveNodeParent:cc.Node,questStatusAchieveNode1:cc.Node,questStatusAchieveNode2:cc.Node,questStatusAchieveNode3:cc.Node,remainingNode:cc.Node,remainingLabel:cc.Label,itemUnlockNode:cc.Node,itemUnlockBtn:a},_callbackThumbnailBtn:null,setStageName:function(t){this.stageNameLabel.string=t},setGrayOut:function(t){this.grayOutNode.active=t,this.thumbnailBtn.setTouchEnable(!t)},setCallbackToThumbnail:function(t){this._callbackThumbnailBtn=t,this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this))},_onTapThumbnailBtn:function(){this._callbackThumbnailBtn&&this._callbackThumbnailBtn()},setThumbnailImage:function(t){o.addSprite(this.thumbnailImageSprite,t)},setAttributeImage:function(t){this.attributeImageSprite.node.parent.active=!0,o.addSprite(this.attributeImageSprite,t)},hideAttributeImage:function(){this.attributeImageSprite.node.parent.active=!1},setDifficult:function(t,e){o.addSprite(this.difficultBackImageSprite,o.getFileNameDifficultThumbnailBack(t)),o.addSprite(this.difficultIconImageSprite,o.getFileNameDifficultIcon(t)),this.difficultIconLabel.node.getComponent(cc.LabelOutline).color=this._convertDifficultToColor(t),this.difficultIconLabel.string=e},setDifficultText:function(t){this.difficultIconLabel.string=t},setConsumeCountLabel:function(t){this.consumeCountLabel.string=t+""},hideConsumeCountNode:function(){this.consumeCountLabel.node.parent.active=!1},_convertDifficultToColor:function(t){switch(t){case s.QUEST_DIFFICULT.EVENT_EQUIPMENT.EASY:return u.EASY;case s.QUEST_DIFFICULT.EVENT_EQUIPMENT.NORMAL:return u.NORMAL;case s.QUEST_DIFFICULT.EVENT_EQUIPMENT.HARD:return u.HARD;case s.QUEST_DIFFICULT.EVENT_EQUIPMENT.EXTREME:return u.EXTREME}return cc.color(0,0,0,255)},setUserData:function(t){this.questStatusAchieveNode1.active=t.getIsClearMission1(),this.questStatusAchieveNode2.active=t.getIsClearMission2(),this.questStatusAchieveNode3.active=t.getIsClearMission3(),this.questAchieveLabel1.setString(t.getQuestAchieveMaster1().getText()),this.questAchieveLabel2.setString(t.getQuestAchieveMaster2().getText()),this.questAchieveLabel3.setString(t.getQuestAchieveMaster3().getText()),this.questAchieveNode1.active=t.getIsClearMission1(),this.questAchieveNode2.active=t.getIsClearMission2(),this.questAchieveNode3.active=t.getIsClearMission3();var e=r.getStageStatus(t);this.questStageNewSprite.node.active=e.newLabel,this.questStageCompleteSprite.node.active=e.completeLabel,e.newLabel||e.completeLabel?this.questStatusAchieveNodeParent.active=!1:this.questStatusAchieveNodeParent.active=!0},hideUserData:function(){this.questStageNewSprite.node.active=!1,this.questStageCompleteSprite.node.active=!1,this.questStatusAchieveNodeParent.active=!1},setDisplayMode:function(t){switch(this.questStatusNode.active=!1,this.questAchieveNode.active=!1,t){case c:this.questStatusNode.active=!0;break;case l:this.questAchieveNode.active=!0}},setRemainingNode:function(t,e){this.remainingNode.active=t,this.remainingLabel.string=e.toString()},setItemUnlockNode:function(t,e){this.itemUnlockNode.active=t,this.itemUnlockBtn.setTapEvent(e)},setLock:function(t,e){this.setGrayOut(!0),this.hideConsumeCountNode(),t>0&&this.hideUserData(),this.setRemainingNode(t>0,t),this.setItemUnlockNode(t>0,e)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollLabel:"CommonScrollLabel",GameConst:"GameConst",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils"}],EventRegularQuestRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"31388z1BetAoq6pzGiisbyd","EventRegularQuestRootUtils");var a=t("Singleton");e.exports={openEventRegularQuestTopSubRoot:function(t,e){cc.log("openEventRegularQuestTopSubRoot"),cc.log(e),void 0===t._eventRegularQuestTopSubRoot||null===t._eventRegularQuestTopSubRoot?(t._eventRegularQuestTopSubRoot=cc.instantiate(t.eventRegularQuestTopSubRootPrefab).getComponent("EventRegularQuestTopSubRoot"),t.subRootParent.addChild(t._eventRegularQuestTopSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),t._eventRegularQuestTopSubRoot.initEventRegularQuestTopSubRoot(t,e.eventId)},closeEventRegularQuestTopSubRoot:function(t,e){cc.log("closeEventRegularQuestTopSubRoot"),cc.log(e),t._eventRegularQuestTopSubRoot&&(t._eventRegularQuestTopSubRoot.node.destroy(),t._eventRegularQuestTopSubRoot=null)},openBattleStartConfirmSubRoot:function(t,e){cc.log("openBattleStartConfirmSubRoot"),cc.log(e),t.setListViewParam(e.worldId,e.areaId,e.stageId,t.selectDifficult);for(var i=parseInt(e.stageId,10),n=0;n<a.dao.userQuests.length;n++)if(a.dao.userQuests[n].userData._data.stageId===i){t.openStageQuestModel=a.dao.userQuests[n];break}void 0===t.battleStartConfirmSubRoot||null===t.battleStartConfirmSubRoot?(t.battleStartConfirmSubRoot=cc.instantiate(t.battleStartConfirmSubRootPrefab).getComponent("BattleStartConfirmSubRoot"),t.battleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,t.openStageQuestModel,e.hideSkip),t.subRootParent.addChild(t.battleStartConfirmSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002")},closeBattleStartConfirmSubRoot:function(t,e){cc.log("closeBattleStartConfirmSubRoot"),cc.log(e),t.battleStartConfirmSubRoot&&(t.battleStartConfirmSubRoot.node.destroy(),t.battleStartConfirmSubRoot=null)},openEventRegularQuestEquipmentBattleStartConfirmSubRoot:function(t,e){cc.log("openEventRegularQuestEquipmentBattleStartConfirmSubRoot"),cc.log(e),t.setListViewParam(e.worldId,e.areaId,e.stageId,t.selectDifficult);for(var i=parseInt(e.stageId,10),n=0;n<a.dao.userQuests.length;n++)if(a.dao.userQuests[n].userData._data.stageId===i){t.openStageQuestModel=a.dao.userQuests[n];break}t.eventRegularQuestEquipmentBattleStartConfirmSubRoot?cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(t.eventRegularQuestEquipmentBattleStartConfirmSubRoot=cc.instantiate(t.eventRegularQuestEquipmentBattleStartConfirmSubRootPrefab).getComponent("EventRegularQuestEquipmentBattleStartConfirmSubRoot"),t.eventRegularQuestEquipmentBattleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,t.openStageQuestModel,e.hideSkip),t.subRootParent.addChild(t.eventRegularQuestEquipmentBattleStartConfirmSubRoot.node))},closeEventRegularQuestEquipmentBattleStartConfirmSubRoot:function(t,e){cc.log("closeEventRegularQuestEquipmentBattleStartConfirmSubRoot"),cc.log(e),t.eventRegularQuestEquipmentBattleStartConfirmSubRoot&&(t.eventRegularQuestEquipmentBattleStartConfirmSubRoot.node.destroy(),t.eventRegularQuestEquipmentBattleStartConfirmSubRoot=null)}},cc._RF.pop()},{Singleton:"Singleton"}],EventRegularQuestRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ff599fazOlIobUIE2FbzadY","EventRegularQuestRoot");var a=t("EventQuestRootBase"),n=t("EventRegularQuestViewSetting"),o=t("Singleton"),r=t("EventUtils"),s=t("QuestUtils"),c=t("QuestConditionUtils"),l=(t("CommonUtils"),t("PopupUtils")),u=(t("CharacterUtils"),t("ResourceUtils"),t("ExchangeUtils")),h=(t("AnimationUtils"),t("EquipmentUtils"),t("SceneConst")),d=t("ItemConst"),p=t("GameConst"),m=t("QuestConst"),_=t("MissionConst"),g=(t("LocalDataConst"),t("EventQuestConst"));cc.Class({extends:a,properties:{eventRegularQuestTopSubRootPrefab:cc.Prefab,eventQuestHowToPlayPopupPrefab:cc.Prefab,eventRegularQuestEquipmentBattleStartConfirmSubRootPrefab:cc.Prefab,eventRegularQuestEquipmentItemUnlockPopupPrefab:cc.Prefab,eventRegularQuestEquipmentAutoDetailPopupPrefab:cc.Prefab},_eventRegularQuestTopSubRoot:null,_eventQuestHowToPlayPopup:null,_eventRegularQuestEquipmentItemUnlockPopup:null,_eventMainMaster:null,initData:function(){if(this.sceneParam){var t=JSON.parse(this.sceneParam),e=t[Object.keys(t)[0]];this.initEventInfo(e.eventId)}},initialize:function(){this._initOpenFirstView({EventRegularQuestTopSubRoot:{eventId:1}}),this._super()},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,n.EVENT_REGULAR_QUEST_SETTING)},createPreViewParam:function(){var t={};if(this._eventRegularQuestTopSubRoot&&(t.EventRegularQuestTopSubRoot={eventId:this.getEventId()}),this.battleStartConfirmSubRoot){var e=this.getListViewParam(),i={eventId:this.getEventId(),worldId:e.worldId,areaId:e.areaId,stageId:e.stageId,difficult:e.difficult,hideSkip:!0};t.BattleStartConfirmSubRoot=i}if(this.eventRegularQuestEquipmentBattleStartConfirmSubRoot){e=this.getListViewParam(),i={eventId:this.getEventId(),worldId:e.worldId,areaId:e.areaId,stageId:e.stageId,difficult:e.difficult,hideSkip:!0};t.EventRegularQuestEquipmentBattleStartConfirmSubRoot=i}return t},initEventInfo:function(t){if(!r.isExistEvent(t))return cc.error("\u5b58\u5728\u3057\u306a\u3044EventId"),this.popScene();void 0!==this.getEventMainMaster()&&null!==this.getEventMainMaster()||(this._setEventId(t),this._setEventMainMaster(),this.redrawBackGround(this.getEventMainMaster().getWorldId()),this._initEventListViewParam())},getEventId:function(){return this._eventId},_setEventMainMaster:function(t){this._eventMainMaster=r.getEventMainMasterMap()[this._eventId]},getEventMainMaster:function(){return this._eventMainMaster},getTodayEventWorldPlayCount:function(){return s.getTodayUserStageClearCountByWorldId(this.getEventMainMaster().getWorldId())},getTodayEventWorldUserBoostCount:function(){return s.getTodayActiveUserBoostCountByWorldId(this.getEventMainMaster().getWorldId())},getTodayEventWorldMaxPlayCount:function(){return s.getWorldMasterByWorldId(this.getEventMainMaster().getWorldId()).getMaxBattleCount()},getTodayEventWorldMaxPlayCountWithAp:function(){return s.getWorldMasterByWorldId(this.getEventMainMaster().getWorldId()).getMaxBattleCount()-this.getEventMainMaster().getMaxUnlockCount()},startBattleByCondition:function(t,e){switch(this.getEventMainMaster().getEventType()){case g.EVENT_TYPE.EQUIPMENT_FORTIFY:this.executeByCondition(t,e);break;default:this._super(t,e)}},executeByCondition:function(t,e){switch(c.getStageConditionState(this.selectStageId,t,this._eventId)){case m.STAGE_CONDITION_STATE.ENABLED:if(this.getTodayEventWorldPlayCount()<this.getTodayEventWorldMaxPlayCountWithAp()){if(this.openStageQuestModel.getStamina()>o.dao[o.USER].getCurrentStaminaInfo().currentStamina)return void l.openSimpleMessageWindow("\u30b9\u30bf\u30df\u30ca\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002")}else if(!s.getTodayUnlockUserBoostByQuestId(p.QUEST_TYPE.AREA,parseInt(this.selectAreaId),[p.BOOST_TYPE.QUEST_UNLOCK,p.BOOST_TYPE.QUEST_LIMITED_UNLOCK]).nowUnlockUserBoost)return void l.openSimpleMessageWindow("\u30af\u30a8\u30b9\u30c8\u304c\u958b\u653e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");if(!this._checkStartBattleByUserItemsCondition())return;e?e():cc.error("\u5b9f\u884c\u95a2\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");break;case m.STAGE_CONDITION_STATE.OUT_RANGE_PERIOD:l.openCommonPopupOk("\u958b\u50ac\u671f\u9593\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002","\u5bfe\u8c61\u306e\u30b9\u30c6\u30fc\u30b8\u306f\u73fe\u5728\u958b\u50ac\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",void 0,!1,function(){this.clearScene(),this.pushScene(h.SCENE.FILE_NAME.QUEST,h.SCENE.FILE_NAME.HOME)}.bind(this),void 0);break;case m.STAGE_CONDITION_STATE.TOTAL_OVER_LIMIT:l.openSimpleMessageWindow("\u4e0a\u9650\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f\u3002");break;case m.STAGE_CONDITION_STATE.TODAY_OVER_LIMIT:case m.STAGE_CONDITION_STATE.TODAY_SKIP_OVER_LIMIT:l.openSimpleMessageWindow("\u672c\u65e5\u306e\u4e0a\u9650\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f\u3002");break;default:l.openSimpleMessageWindow("\u30b9\u30c6\u30fc\u30b8\u304c\u958b\u653e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")}},_initEventListViewParam:function(){var t=this.getEventMainMaster().getWorldId();this.setListViewParam(t,void 0,void 0,void 0)},pushBattleStartConfirmSubRoot:function(t,e,i){var a={BattleStartConfirmSubRoot:{eventId:this._eventId,worldId:this.selectWorldId,areaId:e,stageId:t,difficult:i,hideSkip:!0}},n={EventRegularQuestTopSubRoot:{eventId:this._eventId}};t&&e?(cc.log(this.getCurrentSceneName()),this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),a,n)):cc.error("stageId\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},pushEventRegularQuestEquipmentBattleStartConfirmSubRoot:function(t,e,i){var a={EventRegularQuestEquipmentBattleStartConfirmSubRoot:{eventId:this._eventId,worldId:this.selectWorldId,areaId:e,stageId:t,difficult:i,hideSkip:!0}},n={EventRegularQuestTopSubRoot:{eventId:this._eventId}};t&&e?(cc.log(this.getCurrentSceneName()),this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),a,n)):cc.error("stageId\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},transitionExchangeScene:function(){var t={ExchangeSubRoot:{exchangeId:u.getExchangeIdByEventId(this._eventId)}},e={EventRegularQuestTopSubRoot:{eventId:this._eventId}};this.pushScene("ExchangeScene",this.getCurrentSceneName(),t,e)},transitionMissionScene:function(){var t={MissionTabView:{selectedTab:_.MISSION_TAB.EVENT}},e={EventRegularQuestTopSubRoot:{eventId:this._eventId}};this.pushScene("MissionScene",this.getCurrentSceneName(),t,e)},transitionShopScene:function(){var t={ShopSelectSubRoot:{shopCategory:d.SHOP_CATEGORY.NORMAL}},e={EventRegularQuestTopSubRoot:{eventId:this._eventId}};this.pushScene("ShopScene",this.getCurrentSceneName(),t,e)},openEventQuestHowToPlayPopup:function(){this.closeEventQuestHowToPlayPopup(),this._eventQuestHowToPlayPopup=cc.instantiate(this.eventQuestHowToPlayPopupPrefab).getComponent("EventQuestHowToPlayPopup"),this._eventQuestHowToPlayPopup.openEventQuestHowToPlayPopup(this.getEventId())},closeEventQuestHowToPlayPopup:function(){this._eventQuestHowToPlayPopup&&(this._eventQuestHowToPlayPopup.close(),this._eventQuestHowToPlayPopup=null)},openEventRegularQuestEquipmentItemUnlockPopup:function(t,e,i,a,n){this.closeEventRegularQuestEquipmentItemUnlockPopup(),this._eventRegularQuestEquipmentItemUnlockPopup=cc.instantiate(this.eventRegularQuestEquipmentItemUnlockPopupPrefab).getComponent("EventRegularQuestEquipmentItemUnlockPopup"),this._eventRegularQuestEquipmentItemUnlockPopup.openEventRegularQuestEquipmentItemUnlockPopup(this,t,e,i,a,this.getTodayEventWorldMaxPlayCount()-(this.getTodayEventWorldPlayCount()+this.getTodayEventWorldUserBoostCount()),n)},closeEventRegularQuestEquipmentItemUnlockPopup:function(){this._eventRegularQuestEquipmentItemUnlockPopup&&(this._eventRegularQuestEquipmentItemUnlockPopup.close(),this._eventRegularQuestEquipmentItemUnlockPopup=null)},openEventRegularQuestEquipmentAutoDetailPopup:function(t){this.closeAutoDetailPopup(),this._autoDetailPopup=cc.instantiate(this.eventRegularQuestEquipmentAutoDetailPopupPrefab).getComponent("EventRegularQuestEquipmentAutoDetailPopup"),this._autoDetailPopup.openAutoDetailPopup(this,t)},closeEventRegularQuestEquipmentAutoDetailPopup:function(){this._autoDetailPopup&&(this._autoDetailPopup.close(),this._autoDetailPopup=null)}});cc._RF.pop()},{AnimationUtils:"AnimationUtils",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",EventQuestConst:"EventQuestConst",EventQuestRootBase:"EventQuestRootBase",EventRegularQuestViewSetting:"EventRegularQuestViewSetting",EventUtils:"EventUtils",ExchangeUtils:"ExchangeUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",MissionConst:"MissionConst",PopupUtils:"PopupUtils",QuestConditionUtils:"QuestConditionUtils",QuestConst:"QuestConst",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton"}],EventRegularQuestTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"f4ec3SMP1VE474uXpHU0jJG","EventRegularQuestTopSubRoot");var a=t("Singleton"),n=t("CommonButton"),o=t("EventUtils"),r=t("CommonUtils"),s=t("TimeUtils"),c=t("ViewUtils"),l=t("ResourceUtils"),u=t("LocalDataConst"),h=t("GameConst"),d=(t("CharacterConst"),t("EventQuestConst"));cc.Class({extends:cc.Component,properties:{missionBtn:n,howToPlayBtn:n,characterStandViewParentNode:cc.Node,logoImageSprite:cc.Sprite,endDateLabel:cc.Label,eventRegularQuestAdventWarStageListView:cc.Prefab,eventRegularQuestEquipmentListView:cc.Prefab},_root:null,_eventType:null,_eventCharacterMasterArray:null,_characterStandView:null,_stageListView:null,onLoad:function(){this.missionBtn.setTapEvent(this._onTapMissionBtn.bind(this)),this.howToPlayBtn.setTapEvent(this._onTapHowToPlayBtn.bind(this))},initEventRegularQuestTopSubRoot:function(t,e){r.loadLocalStorage(u.LOCAL_STORAGE_KEY.EVENT_FIRST_LOOK+e,!1,u.LOCAL_STORAGE_GET_TYPE.BOOLEAN)||r.saveLocalStorage(u.LOCAL_STORAGE_KEY.EVENT_FIRST_LOOK+e,!0),this._root=t,this._root.initEventInfo(e),this._initEventWindowInfo(),this._initEventCharacterInfo(),this._initStageListView()},_onTapMissionBtn:function(){this._root.transitionMissionScene()},_onTapHowToPlayBtn:function(){this._root.openEventQuestHowToPlayPopup()},_initStageListView:function(){if(!this._stageListView){switch(this._root.getEventMainMaster().getEventType()){case d.EVENT_TYPE.ADVENT_WAR:this._stageListView=cc.instantiate(this.eventRegularQuestAdventWarStageListView).getComponent("EventRegularQuestAdventWarStageListView");break;case d.EVENT_TYPE.EQUIPMENT_FORTIFY:this._stageListView=cc.instantiate(this.eventRegularQuestEquipmentListView).getComponent("EventRegularQuestEquipmentListView")}this.node.addChild(this._stageListView.node),this._stageListView.iniStageListView(this._root)}},redrawStageListView:function(){this._stageListView.redraw()},_initEventWindowInfo:function(){this._setEventType(),this._setActiveButtons(),this._initLogo(),this._initEndDate()},_setEventType:function(){this._eventType=parseInt(this._root.getEventMainMaster().getEventType())},_setActiveButtons:function(){var t=this._root.getEventMainMaster();this.missionBtn.node.active=a.dao.MissionMainMasters.some(function(e){return e.getEventId()===t.getEventId()}),this.howToPlayBtn.node.active=a.dao.EventHelpMasters.some(function(e){return e.getEventId()===t.getEventId()})},_initLogo:function(){l.addSprite(this.logoImageSprite,l.getFileNameLogoByEventId(this._root.getEventMainMaster().getEventId()))},_initEndDate:function(){var t=this._root.getEventMainMaster(),e=t.getToDate();if(t.getConditionType()===h.OPEN_CONDITION_TYPE.REGISTER_DATE){var i=a.dao.userBasicData;e=s.addMinute(i.getTutorialEndDate(),t.getConditionTo())}var n=s.parseTimeToYmdhm(e);this.endDateLabel.string="\u7d42\u4e86\u65e5\u6642\uff1a"+n+" \u307e\u3067"},_initEventCharacterInfo:function(){this._initCharacterStandView(),this._eventCharacterMasterArray=o.getEventCharacterMasterGroupByEventId()[this._root.getEventId()],this._reloadCharacterStandImage()},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=c.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_reloadCharacterStandImage:function(){var t=r.getRandom(0,this._eventCharacterMasterArray.length-1);this._characterStandView.setCharacterStandImage(this._eventCharacterMasterArray[t].getCharacterId())}});cc._RF.pop()},{CharacterConst:"CharacterConst",CommonButton:"CommonButton",CommonUtils:"CommonUtils",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",ViewUtils:"ViewUtils"}],EventRegularQuestViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"51672b8+CZM+pmp0Jx2Kd+1","EventRegularQuestViewSetting");var a=t("EventRegularQuestRootUtils");e.exports={EVENT_REGULAR_QUEST_SETTING:{EventRegularQuestTopSubRoot:{open:a.openEventRegularQuestTopSubRoot,close:a.closeEventRegularQuestTopSubRoot},BattleStartConfirmSubRoot:{open:a.openBattleStartConfirmSubRoot,close:a.closeBattleStartConfirmSubRoot},EventRegularQuestEquipmentBattleStartConfirmSubRoot:{open:a.openEventRegularQuestEquipmentBattleStartConfirmSubRoot,close:a.closeEventRegularQuestEquipmentBattleStartConfirmSubRoot}}},cc._RF.pop()},{EventRegularQuestRootUtils:"EventRegularQuestRootUtils"}],EventService:[function(t,e,i){"use strict";cc._RF.push(e,"63b63SlhK5A2Z9iAukL7FEY","EventService");var a=t("BaseService"),n=t("ApiConstants");t("PopupUtils"),t("QuestConst"),cc.Class({extends:a,startBattle:function(t,e,i,a){var o={stageId:t,deckId:e,isAutoBattle:i};this._requestCallApi(n.EVENT_QUEST_START_BATTLE,o,function(t,e){return a(t?void 0:e)})},endBattle:function(t,e){var i={parameter:t};this._requestCallApi(n.EVENT_QUEST_END_BATTLE,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService",PopupUtils:"PopupUtils",QuestConst:"QuestConst"}],EventUtils:[function(t,e,i){"use strict";cc._RF.push(e,"f3c5c4/3ypC1ooD96iRlE0S","EventUtils");var a=t("Singleton"),n=t("CommonUtils"),o=t("CharacterUtils"),r=t("TimeUtils"),s=t("UserUtils"),c=t("GameConst"),l=t("SceneConst"),u=t("EventQuestConst");function h(){return a.dao.EventMainMasters.filter(function(t){return E(t)&&s.checkOpenCondition(t.getConditionType(),t.getConditionFrom(),t.getConditionTo())})}function d(){for(var t={},e=a.dao.EventMainMasters,i=0;i<e.length;i+=1){t[e[i].getEventId()]=e[i]}return t}function p(){for(var t={},e=a.dao.EventCharacterMasters,i=0;i<e.length;i+=1){var n=e[i].getEventId();t[n]||(t[n]=[]),t[n].push(e[i])}return t}function m(){for(var t={},e=a.dao.EventPointRewardMasters,i=0;i<e.length;i+=1){var n=e[i].getEventId();t[n]||(t[n]=[]),t[n].push(e[i])}return t}function _(t){return void 0!==d()[t]}function g(t,e){return!!t.find(function(t){var i=a.dao.EventBoostEffectMasters.find(function(e){return e.getGroupId()===t.getSubEffectGroupId()});if(!i)return!1;switch(i.getAddType()){case u.BOOST_ADD_TYPE.RATE:return C(i,e);case u.BOOST_ADD_TYPE.ADD:return f(i,e);default:return!1}})}function C(t,e){switch(e){case c.RARITY.N:return t.getValue1()>1e3;case c.RARITY.R:return t.getValue2()>1e3;case c.RARITY.SR:return t.getValue3()>1e3;case c.RARITY.SSR:return t.getValue4()>1e3}}function f(t,e){switch(e){case c.RARITY.N:return t.getValue1()>0;case c.RARITY.R:return t.getValue2()>0;case c.RARITY.SR:return t.getValue3()>0;case c.RARITY.SSR:return t.getValue4()>0}}function E(t){var e=t.getFromDate(),i=t.getToDate();return r.isRangeOfDate(e,i)}function T(t,e){var i=parseInt(e,10);return parseInt(t.getPoint(),10)<=i}e.exports={isEventOpen:function(){return!!a.dao.EventMainMasters.find(function(t){return E(t)&&s.checkOpenCondition(t.getConditionType(),t.getConditionFrom(),t.getConditionTo())})},isEventOpenByEventId:function(t){if(_(t)){var e=d()[t];return E(e)&&s.checkOpenCondition(e.getConditionType(),e.getConditionFrom(),e.getConditionTo())}return!1},getEventMainMaterByEventId:function(t){return a.dao.EventMainMasters.find(function(e){return e.getEventId()===t})},getOpenEventMainMasterArray:h,getEventMainMasterMap:d,getTransitionEventSceneData:function(t){var e,i;switch(d()[t].getEventType()){case u.EVENT_TYPE.RAID:e=l.SCENE.FILE_NAME.RAID;break;case u.EVENT_TYPE.POINT:case u.EVENT_TYPE.ITEM:e=l.SCENE.FILE_NAME.EVENT,i={EventQuestTopSubRoot:{eventId:t}};break;case u.EVENT_TYPE.ADVENT_WAR:case u.EVENT_TYPE.EQUIPMENT_FORTIFY:e=l.SCENE.FILE_NAME.EVENT_REGULAR,i={EventRegularQuestTopSubRoot:{eventId:t}};break;default:e=l.SCENE.FILE_NAME.EVENT,cc.error("\u5b58\u5728\u3057\u306a\u3044\u30a4\u30d9\u30f3\u30c8\u30bf\u30a4\u30d7\u3067\u3059")}return{sceneName:e,sceneParam:i}},getEventItemMasterGroupByEventId:function(){for(var t={},e=a.dao.EventItemMasters,i=0;i<e.length;i+=1){var n=e[i].getEventId();t[n]||(t[n]=[]),t[n].push(e[i])}return t},getEventCharacterMasterGroupByEventId:p,getEventHelpMasterGroupByEventId:function(){for(var t={},e=a.dao.EventHelpMasters,i=0;i<e.length;i+=1){var n=e[i].getEventId();t[n]||(t[n]=[]),t[n].push(e[i])}return t},getEventPointRewardMasterGroupByEventId:m,isExistEvent:_,isBoostCharacter:function(t,e,i){var n=h(),r=(a.dao.EventBoostEffectMasters,a.dao.EventBoostCharacterMasters.filter(function(t){return!!n.find(function(e){return t.getEventId()===e.getEventId()})}).filter(function(i){return 0!==i.getCharacterId()&&(i.getCharacterId()===e||o.getCharacterMainModelByCharacterId(i.getCharacterId()).getCharacterGroupId()===t)}));return!(r.length<=0)&&(!!r.find(function(t){return t.getCharacterId()===e})||g(r,i))},checkInOfTerm:E,isReceivedRewardMaster:T,getNextEventPointRewardMaster:function(t,e){var i=m()[t];if(!i)return null;var a=i.filter(function(t){return!T(t,e)});return a.sort(function(t,e){return n.sortFunc(parseInt(t.getPoint(),10),parseInt(e.getPoint(),10))}),a[0]},hasEventPointMaster:function(t){return!!m()[t]},getEventMainMasterByItemId:function(t){var e=a.dao.EventItemMasters.find(function(e){return parseInt(e.getItemId(),10)===parseInt(t,10)});if(e)return d()[e.getEventId()]},getEventMainMasterByWorldId:function(t){return a.dao.EventMainMasters.find(function(e){return parseInt(e.getWorldId(),10)===parseInt(t,10)})},getNextReceivedEventRewardMasterArrayByEventIdAndEventPoint:function(t,e,i){var a=parseInt(e,10),n=parseInt(i,10);return m()[t].filter(function(t){var e=T(t,a)||T(t,n),i=T(t,a)&&T(t,n);return e&&!i})},getEventCharacterMasterGroupByEventOpen:function(){for(var t=[],e=h(),i=p(),a=0;a<e.length;a+=1)t=t.concat(i[e[a].getEventId()]);return t},getTotalEventPointByEventIdAndItemId:function(t,e){var i=a.dao.userEventItem.find(function(i){return i.getEventId()===t&&i.getItemId()===e});return i?i.getCount():0}},cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",EventQuestConst:"EventQuestConst",GameConst:"GameConst",SceneConst:"SceneConst",Singleton:"Singleton",TimeUtils:"TimeUtils",UserUtils:"UserUtils"}],ExchangeConst:[function(t,e,i){"use strict";cc._RF.push(e,"72177zyZI1D7K0vyiLyNIw5","ExchangeConst"),e.exports={EXCHANGE_TYPE:cc.Enum({POINT_CONSUME:1,ITEM_CONSUME:2}),MAX_TAB_COUNT:7,EXCHANGE_TAB_TYPE:cc.Enum({GOLD:1,PVP:2,TOWER:3,R_L_YEH:4,RAID:5}),EXCHANGE_COST_ID:cc.Enum({GOLD:201001,ARENA:801003,TOWER:801004,RAID:801005,R_L_YEH:801011}),EXCHANGE_COST_GROUP_TYPE:cc.Enum({COIN_GROUP:0,TEXT_GROUP:1,ITEM_GROUP:2}),EXCHANGE_MAX_COUNT_TYPE:cc.Enum({NON:0,DAILY:1,WEEKLY:2,MONTHLY:3}),NORMAL_COLOR:cc.color(0,0,0,255),CONSUME_COLOR:cc.color(111,233,255,255),CONSUME_OUT_LINE_COLOR:cc.color(0,0,0,255),COST_OVER_COLOR:cc.color(255,0,69,255),COST_OVER_OUT_LINE_COLOR:cc.color(255,255,255,255)},cc._RF.pop()},{}],ExchangeCurrencyShortagePopup:[function(t,e,i){"use strict";cc._RF.push(e,"a9f3dSGwNVFoYpN39JuCrob","ExchangeCurrencyShortagePopup");var a=t("PopupBase"),n=(t("Singleton"),t("CommonButton")),o=t("ResourceUtils"),r=t("ExchangeUtils"),s=t("ExchangeConst"),c=t("CommonUtils"),l=t("ItemUtils");cc.Class({extends:a,properties:{currencyTitleNameLabel:cc.Label,mainTextLabel:cc.Label,needCurrencySprite:cc.Sprite,needCurrencyNameLabel:cc.Label,needCurrencyNumLabel:cc.Label,haveCurrencySprite:cc.Sprite,haveCurrencyNameLabel:cc.Label,haveCurrencyNumLabel:cc.Label,transitionBtn:n,transitionNameLabel:cc.Label,cancelBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listIds:null,_selectedItemMap:null,_userHavePoint:0,openExchangeCurrencyShortagePopup:function(t,e,i,a){this._exchangeId=t,this._exchangeMainMaster=r.getExchangeMainMasterMap()[this._exchangeId],this._listIds=Object.keys(e),this._selectedItemMap=e,this.transitionBtn.setTapEvent(i),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.setCloseCallBack(a),this._setParameter(),this.open()},_setParameter:function(){var t=this._exchangeMainMaster.getCostId(),e=l.getItemMaster(t);switch(this._userHavePoint=l.getUserItemCount(t),this.currencyTitleNameLabel.string="["+e.getName()+"]\u4e0d\u8db3",this.mainTextLabel.string="\u4ea4\u63db\u306b\u5fc5\u8981\u306a["+e.getName()+"]\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002",this.needCurrencySprite.node.active=!1,this.haveCurrencySprite.node.active=!1,parseInt(this._exchangeId,10)){case s.EXCHANGE_TAB_TYPE.GOLD:case s.EXCHANGE_TAB_TYPE.PVP:this.needCurrencySprite.node.active=!0,o.addSprite(this.needCurrencySprite,o.getFileNameItemImage(t)),this.haveCurrencySprite.node.active=!0,o.addSprite(this.haveCurrencySprite,o.getFileNameItemImage(t)),this.needCurrencyNameLabel.string="\u5fc5\u8981\u30b3\u30a4\u30f3",this.haveCurrencyNameLabel.string="\u6240\u6301\u30b3\u30a4\u30f3";break;default:this.needCurrencyNameLabel.string="\u5fc5\u8981"+e.getName(),this.haveCurrencyNameLabel.string="\u6240\u6301"+e.getName()}switch(parseInt(this._exchangeId,10)){case s.EXCHANGE_TAB_TYPE.GOLD:this.transitionNameLabel.string="\u30b7\u30e7\u30c3\u30d7\u3078";break;case s.EXCHANGE_TAB_TYPE.R_L_YEH:this.transitionNameLabel.string="\u30ac\u30c1\u30e3\u3078";break;default:this.transitionNameLabel.string=this._exchangeMainMaster.getName()+"\u30d8"}this.needCurrencyNumLabel.string=c.convertToCommaDelimited(r.getSelectedItemTotalCostCount(this._exchangeId,this._selectedItemMap)),this.haveCurrencyNumLabel.string=c.convertToCommaDelimited(this._userHavePoint)}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"c15a6Yi1/FFSb6PZpiIwaWS","ExchangeItemConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("Singleton"),r=t("ResourceUtils"),s=t("HistoryUtils"),c=t("PopupUtils"),l=t("CommonCountView");cc.Class({extends:a,properties:{itemImage:cc.Sprite,itemName:cc.Label,itemNum:cc.Label,countViewSpace:l,NumExchangeLimit:cc.Label,exchangeItemNodeArray:[cc.Node],costItemSpriteArray:[cc.Sprite],costItemHaveArray:[cc.Label],costItemArray:[cc.Label],exchangeBtn:n,cancelBtn:n,closeBtn:n},_costIdArray:null,_costCountArray:null,_iUserHaveItemArray:null,_exchangeItemMaxCount:0,_exchangeItemSelectCount:0,_needItemCnt:0,initPopup:function(t,e,i,a){this._root=t,this._subRoot=e,this._contentView=i,this._exchangeDetail=a,this._setParameter(),this._setUseItemInfo(),this._setButtonEvents(),this._exchangeItemSelectCount=this.countViewSpace.getCountNum(),this.cancelBtn.setTapEvent(this._closeBtnEvent.bind(this),n.SE_NAME.CANCEL),this.closeBtn.setTapEvent(this._closeBtnEvent.bind(this),n.SE_NAME.CANCEL),this.countViewSpace.initCommonCountView(this.redraw.bind(this),1,this._exchangeItemMaxCount)},redraw:function(){for(var t=this.countViewSpace.getCountNum(),e=0;e<this._needItemCnt;e++)this.costItemArray[e].string=(this._iUserHaveItemArray[e]-this._costCountArray[e]*t).toString()},_setParameter:function(){this._setNeedItemArray(),r.addSprite(this.itemImage,r.getFileNameItemThumbnail(this._exchangeDetail.getItemId())),this.itemName.string=this._exchangeDetail.getName(),this.NumExchangeLimit.string=this._exchangeDetail.getText();var t=o.dao.userItems;this._needItemCnt=0;for(var e=0;e<this.costItemSpriteArray.length;e++)0!==this._costIdArray[e]?(this.costItemSpriteArray[e].node.active=!0,r.addSprite(this.costItemSpriteArray[e],r.getFileNameItemThumbnail(this._costIdArray[e])),this._needItemCnt++):this.exchangeItemNodeArray[e].active=!1;cc.log(t,this._exchangeDetail),this._iUserHaveItemArray=[];for(e=0;e<t.length;e++){for(var i=0;i<this._needItemCnt;i++)t[e].getItemId()===this._costIdArray[i]&&(this._iUserHaveItemArray[i]=t[e].getCount(),this.costItemHaveArray[i].string=t[e].getCount(),this.costItemArray[i].string=(this._iUserHaveItemArray[i]-this._costCountArray[i]).toString());t[e].getItemId()===this._exchangeDetail.getItemId()&&(this.itemNum.string=t[e].getCount())}},_setNeedItemArray:function(){this._costIdArray=[],this._costIdArray.push(this._exchangeDetail.getCostId1()),this._costIdArray.push(this._exchangeDetail.getCostId2()),this._costIdArray.push(this._exchangeDetail.getCostId3()),this._costIdArray.push(this._exchangeDetail.getCostId4()),this._costIdArray.push(this._exchangeDetail.getCostId5()),this._costCountArray=[],this._costCountArray.push(this._exchangeDetail.getCostCount1()),this._costCountArray.push(this._exchangeDetail.getCostCount2()),this._costCountArray.push(this._exchangeDetail.getCostCount3()),this._costCountArray.push(this._exchangeDetail.getCostCount4()),this._costCountArray.push(this._exchangeDetail.getCostCount5())},_setButtonEvents:function(){this.exchangeBtn.setTapEvent(function(){var t=!1,e=o.dao.userItems;if(this._exchangeItemSelectCount=this.countViewSpace.getCountNum(),this._exchangeItemSelectCount<=0)c.openSimpleMessageWindow("\u4ea4\u63db\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059");else{for(var i=0;i<this._needItemCnt;i++){for(var a=0;a<e.length;a++)if(e[a].getItemId()===this._costIdArray[i]&&e[a].getCount()>=this._costCountArray[i]){0===i?t=!0:t&=!0;break}if(!t)break}if(t){var n=this._exchangeDetail.getExchangeId(),r=this._exchangeDetail.getListId(),s=this.countViewSpace.getCountNum();this._root.requestExchange(n,r,s,this._contentView,function(){this._subRoot.exchangeConfirmPopup(this._exchangeDetail),this._closeBtnEvent()}.bind(this))}else c.openSimpleMessageWindow("\u30a2\u30a4\u30c6\u30e0\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059")}}.bind(this))},_closeBtnEvent:function(){this.close()},_setUseItemInfo:function(){this._exchangeItemMaxCount=s.getRemainingCount("exchange",this._exchangeDetail.getListId(),this._exchangeDetail.getMaxCount());for(var t=1;t<=this._exchangeItemMaxCount;t++)for(var e=0;e<this._costCountArray.length;e++)if(this._iUserHaveItemArray[e]-this._costCountArray[e]*t<0)return void(this._exchangeItemMaxCount=t-1)}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",HistoryUtils:"HistoryUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemDetailModel:[function(t,e,i){"use strict";cc._RF.push(e,"d8160GmKPJNJaDA2EdYAXw0","ExchangeItemDetailModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getExchangeId:function(){if(this._isKeyFieldAvailable("exchangeId"))return this._data.exchangeId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exchangeId")},getListId:function(){if(this._isKeyFieldAvailable("listId"))return this._data.listId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: listId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getMaxCount:function(){if(this._isKeyFieldAvailable("maxCount"))return this._data.maxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCount")},getMaxCountType:function(){if(this._isKeyFieldAvailable("maxCountType"))return this._data.maxCountType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCountType")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getCostType1:function(){if(this._isKeyFieldAvailable("costType1"))return this._data.costType1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType1")},getCostId1:function(){if(this._isKeyFieldAvailable("costId1"))return this._data.costId1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId1")},getCostCount1:function(){if(this._isKeyFieldAvailable("costCount1"))return this._data.costCount1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount1")},getCostType2:function(){if(this._isKeyFieldAvailable("costType2"))return this._data.costType2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType2")},getCostId2:function(){if(this._isKeyFieldAvailable("costId2"))return this._data.costId2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId2")},getCostCount2:function(){if(this._isKeyFieldAvailable("costCount2"))return this._data.costCount2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount2")},getCostType3:function(){if(this._isKeyFieldAvailable("costType3"))return this._data.costType3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType3")},getCostId3:function(){if(this._isKeyFieldAvailable("costId3"))return this._data.costId3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId3")},getCostCount3:function(){if(this._isKeyFieldAvailable("costCount3"))return this._data.costCount3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount3")},getCostType4:function(){if(this._isKeyFieldAvailable("costType4"))return this._data.costType4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType4")},getCostId4:function(){if(this._isKeyFieldAvailable("costId4"))return this._data.costId4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId4")},getCostCount4:function(){if(this._isKeyFieldAvailable("costCount4"))return this._data.costCount4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount4")},getCostType5:function(){if(this._isKeyFieldAvailable("costType5"))return this._data.costType5;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType5")},getCostId5:function(){if(this._isKeyFieldAvailable("costId5"))return this._data.costId5;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId5")},getCostCount5:function(){if(this._isKeyFieldAvailable("costCount5"))return this._data.costCount5;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount5")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ExchangeItemDetailThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"20ba95wOQhJRamIj8ebKlKV","ExchangeItemDetailThumbnail");var a=t("CommonUtils"),n=t("MatrixThumbnailUtils");cc.Class({extends:cc.Component,properties:{matrixThumbnailNode:cc.Node,itemNameLabel:cc.Label,itemCountLabel:cc.Label,itemDescriptionLabel:cc.Label},initExchangeItemDetailThumbnail:function(t){var e=n.createMatrixThumbnailByItemType(t.itemId,t.itemType);this.matrixThumbnailNode.addChild(e.node),this.itemNameLabel.string=t.name,this.itemCountLabel.string=a.convertToCommaDelimited(t.count),this.itemDescriptionLabel.string=""+t.text}});cc._RF.pop()},{CommonUtils:"CommonUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils"}],ExchangeItemEventItemConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"8311fhlOXJLQKIIfgb4yTy0","ExchangeItemEventItemConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("Singleton"),t("ResourceUtils")),r=t("ExchangeUtils"),s=t("ExchangeConst"),c=t("HistoryUtils"),l=t("CommonCountView"),u=t("CommonUtils"),h=t("ItemUtils");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,countViewSpace:l,headerLabelLineArray:[cc.Node],headerPunctuationNodeArray:[cc.Node],currencyNameLabelArray:[cc.Label],currencyNumLabelArray:[cc.Label],currencySpriteArray:[cc.Sprite],userCurrencyNumLabelArray:[cc.Label],afterUserCurrencyNumLabel:[cc.Label],exchangeItemWideThumbnailPrefab:cc.Prefab,exchangeBtn:n,cancelBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listId:0,_exchangeDetailMaster:null,_costMap:null,_costCurrencyItemIdMap:null,_userHaveExchangeItemCount:0,_exchangeItemMaxCount:0,_exchangeSelectItemCount:0,_exchangeItemThumbnail:0,_executeExchangeCallback:null,openExchangeItemEventItemConfirmPopup:function(t,e,i){this._exchangeId=t,this._listId=e,this._exchangeMainMaster=r.getExchangeMainMasterMap()[this._exchangeId],this._exchangeDetailMaster=r.getExchangeDetailMasterMap()[this._exchangeId][this._listId],this._costMap=r.getCostMapByExchangeItemDetailMaster(this._exchangeDetailMaster),this._costCurrencyItemIdMap=u.getRoot()._costCurrencyItemIdMap,this._executeExchangeCallback=i,this._setParameter(),this._setUseItemInfo(),this._setButtonEvents(),this._exchangeItemThumbnail=cc.instantiate(this.exchangeItemWideThumbnailPrefab).getComponent("ExchangeItemWideThumbnail"),this._exchangeItemThumbnail.initExchangeItemWideThumbnail(this._exchangeId,this._listId),this.itemThumbnailParentNode.addChild(this._exchangeItemThumbnail.node),this.cancelBtn.setTapEvent(this._cancelBtnEvent.bind(this),n.SE_NAME.CANCEL),this.countViewSpace.initCommonCountView(this.redraw.bind(this),1,this._exchangeItemMaxCount),this._exchangeItemSelectCount=this.countViewSpace.getCountNum(),this._exchangeItemThumbnail.setItemInfo(this._exchangeItemSelectCount),this.open()},redraw:function(){var t=this.countViewSpace.getCountNum();this._exchangeItemThumbnail.setItemInfo(t),this._setHeader(t),this._setFooter(t)},_setParameter:function(){this._setHeader(),this._setFooter()},_setHeader:function(t){t||(t=1);var e=Object.keys(this._costMap);switch(e.length){case 1:this.headerLabelLineArray[1].active=!1,this.headerPunctuationNodeArray.forEach(function(t){t.active=!1}),this.currencyNameLabelArray[0].string="["+h.getItemMaster(parseInt(e[0])).getName()+"]x",this.currencyNumLabelArray[0].string=u.convertToCommaDelimited(this._costMap[e[0]]*t),this.currencyNameLabelArray[1].node.active=!1,this.currencyNumLabelArray[1].node.active=!1;break;case 2:this.headerLabelLineArray[1].active=!1,this.headerPunctuationNodeArray[1].active=!1;for(var i=0;i<e.length;i+=1)this.currencyNameLabelArray[i].string="["+h.getItemMaster(parseInt(e[i])).getName()+"]x",this.currencyNumLabelArray[i].string=u.convertToCommaDelimited(this._costMap[e[i]]*t);break;case 3:for(var a=0;a<e.length;a+=1)this.currencyNameLabelArray[a].string="["+h.getItemMaster(parseInt(e[a])).getName()+"]x",this.currencyNumLabelArray[a].string=u.convertToCommaDelimited(this._costMap[e[a]]*t)}},_setFooter:function(t){t||(t=1);for(var e=Object.keys(this._costCurrencyItemIdMap),i=0;i<e.length;i+=1)o.addSprite(this.currencySpriteArray[i],o.getFileNameItemImage(parseInt(e[i]))),this.userCurrencyNumLabelArray[i].string=u.convertToCommaDelimited(this._costCurrencyItemIdMap[e[i]]),this._costMap[e[i]]?(this.afterUserCurrencyNumLabel[i].string=u.convertToCommaDelimited(this._costCurrencyItemIdMap[e[i]]-this._costMap[e[i]]*t),this._costCurrencyItemIdMap[e[i]]-this._costMap[e[i]]*t>0?(this.afterUserCurrencyNumLabel[i].node.color=s.CONSUME_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.CONSUME_OUT_LINE_COLOR):(this.afterUserCurrencyNumLabel[i].node.color=s.COST_OVER_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.COST_OVER_OUT_LINE_COLOR)):(this.afterUserCurrencyNumLabel[i].string=u.convertToCommaDelimited(this._costCurrencyItemIdMap[e[i]]),this._costCurrencyItemIdMap[e[i]]>0?(this.afterUserCurrencyNumLabel[i].node.color=s.CONSUME_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.CONSUME_OUT_LINE_COLOR):(this.afterUserCurrencyNumLabel[i].node.color=s.COST_OVER_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.COST_OVER_OUT_LINE_COLOR))},_setButtonEvents:function(){this.exchangeBtn.setTapEvent(this._executeExchange.bind(this))},_setUseItemInfo:function(){var t=Object.keys(this._costMap);this._exchangeItemMaxCount=c.getRemainingCount("exchange",this._exchangeDetailMaster.getListId(),this._exchangeDetailMaster.getMaxCount());for(var e=1;e<=this._exchangeItemMaxCount;e+=1)for(var i=0;i<t.length;i+=1)if(this._costCurrencyItemIdMap[t[i]]-this._costMap[t[i]]*e<0)return void(this._exchangeItemMaxCount=e-1)},_executeExchange:function(){this._executeExchangeCallback(this.countViewSpace.getCountNum()),this.close()},_cancelBtnEvent:function(){this.close()}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemEventItemPopup:[function(t,e,i){"use strict";cc._RF.push(e,"46711aKARNHeak6vRsUeS+I","ExchangeItemEventItemPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("Singleton"),t("ResourceUtils")),r=t("ExchangeUtils"),s=t("ExchangeConst"),c=(t("HistoryUtils"),t("CommonCountView"),t("CommonUtils")),l=t("ItemUtils");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,headerLabelLineArray:[cc.Node],headerPunctuationNodeArray:[cc.Node],currencyNameLabelArray:[cc.Label],currencyNumLabelArray:[cc.Label],currencySpriteArray:[cc.Sprite],userCurrencyNumLabelArray:[cc.Label],afterUserCurrencyNumLabel:[cc.Label],exchangeItemWideThumbnailPrefab:cc.Prefab,okBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listId:0,_exchangeDetailMaster:null,_costMap:null,_costCurrencyItemIdMap:null,_exchangeItemThumbnail:0,openExchangeItemEventItemPopup:function(t,e,i){var a=Object.keys(e);this._exchangeId=t,this._listId=a[0],this._count=parseInt(e[a[0]],10),this.setCloseCallBack(i),this._exchangeMainMaster=r.getExchangeMainMasterMap()[this._exchangeId],this._exchangeDetailMaster=r.getExchangeDetailMasterMap()[this._exchangeId][this._listId],this._costMap=r.getCostMapByExchangeItemDetailMaster(this._exchangeDetailMaster),this._costCurrencyItemIdMap=c.getRoot()._costCurrencyItemIdMap,this._setParameter(),this._exchangeItemThumbnail=cc.instantiate(this.exchangeItemWideThumbnailPrefab).getComponent("ExchangeItemWideThumbnail"),this._exchangeItemThumbnail.initExchangeItemWideThumbnail(this._exchangeId,this._listId),this.itemThumbnailParentNode.addChild(this._exchangeItemThumbnail.node),this._exchangeItemThumbnail.setFinishItemInfo(e[a[0]]),this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.open()},_setParameter:function(){this._setHeader(this._count),this._setFooter(this._count)},_setHeader:function(t){t||(t=1);var e=Object.keys(this._costMap);switch(e.length){case 1:this.headerLabelLineArray[1].active=!1,this.headerPunctuationNodeArray.forEach(function(t){t.active=!1}),this.currencyNameLabelArray[0].string="["+l.getItemMaster(parseInt(e[0])).getName()+"]x",this.currencyNumLabelArray[0].string=c.convertToCommaDelimited(this._costMap[e[0]]*t),this.currencyNameLabelArray[1].node.active=!1,this.currencyNumLabelArray[1].node.active=!1;break;case 2:this.headerLabelLineArray[1].active=!1,this.headerPunctuationNodeArray[1].active=!1;for(var i=0;i<e.length;i+=1)this.currencyNameLabelArray[i].string="["+l.getItemMaster(parseInt(e[i])).getName()+"]x",this.currencyNumLabelArray[i].string=c.convertToCommaDelimited(this._costMap[e[i]]*t);break;case 3:for(var a=0;a<e.length;a+=1)this.currencyNameLabelArray[a].string="["+l.getItemMaster(parseInt(e[a])).getName()+"]x",this.currencyNumLabelArray[a].string=c.convertToCommaDelimited(this._costMap[e[a]]*t)}},_setFooter:function(t){t||(t=1);for(var e=Object.keys(this._costCurrencyItemIdMap),i=0;i<e.length;i+=1)o.addSprite(this.currencySpriteArray[i],o.getFileNameItemImage(parseInt(e[i]))),this.userCurrencyNumLabelArray[i].string=c.convertToCommaDelimited(this._costCurrencyItemIdMap[e[i]]),this._costMap[e[i]]?(this.afterUserCurrencyNumLabel[i].string=c.convertToCommaDelimited(this._costCurrencyItemIdMap[e[i]]-this._costMap[e[i]]*t),this._costCurrencyItemIdMap[e[i]]-this._costMap[e[i]]*t>0?(this.afterUserCurrencyNumLabel[i].node.color=s.CONSUME_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.CONSUME_OUT_LINE_COLOR):(this.afterUserCurrencyNumLabel[i].node.color=s.COST_OVER_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.COST_OVER_OUT_LINE_COLOR)):(this.afterUserCurrencyNumLabel[i].string=c.convertToCommaDelimited(this._costCurrencyItemIdMap[e[i]]),this._costCurrencyItemIdMap[e[i]]>0?(this.afterUserCurrencyNumLabel[i].node.color=s.CONSUME_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.CONSUME_OUT_LINE_COLOR):(this.afterUserCurrencyNumLabel[i].node.color=s.COST_OVER_COLOR,this.afterUserCurrencyNumLabel[i].node.getComponent(cc.LabelOutline).color=s.COST_OVER_OUT_LINE_COLOR))}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemListConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"dc980pBuDpKk4FDwSw1YBZ7","ExchangeItemListConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=(t("Singleton"),t("ResourceUtils")),s=t("ExchangeUtils"),c=t("ExchangeConst"),l=(t("HistoryUtils"),t("CommonUtils")),u=t("ItemUtils");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,commonScrollView:o,mainCurrencyNameLabel:cc.Label,subCurrencySprite:cc.Sprite,subCurrencyNameLabel:cc.Label,needCurrencyNumLabel:cc.Label,haveCurrencyNumLabel:cc.Label,afterHaveCurrencyNumLabel:cc.Label,exchangeItemWideThumbnailPrefab:cc.Prefab,exchangeBtn:n,cancelBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listIds:null,_selectedItemMap:null,_userHaveCurrency:0,_userHaveExchangeItemCount:0,_exchangeItemMaxCount:0,_exchangeSelectItemCount:0,_exchangeItemThumbnail:0,_executeExchangeCallback:null,openExchangeItemListConfirmPopup:function(t,e,i){this._exchangeId=t,this._listIds=Object.keys(e),this._selectedItemMap=e,this._executeExchangeCallback=i,this._setParameter(),this._setButtonEvents(),this.cancelBtn.setTapEvent(this._cancelBtnEvent.bind(this),n.SE_NAME.CANCEL),this.open(this.openCallback.bind(this))},_setParameter:function(){this._exchangeMainMaster=s.getExchangeMainMasterMap()[this._exchangeId];var t=this._exchangeMainMaster.getCostId(),e=u.getItemMaster(t);switch(this._userHaveCurrency=u.getUserItemCount(t),this.mainCurrencyNameLabel.string=e.getName()+"x",this.subCurrencyNameLabel.string="\u6240\u6301"+e.getName(),this.subCurrencySprite.node.active=!1,s.getCostGroupTypeByExchangeId(this._exchangeId)){case c.EXCHANGE_COST_GROUP_TYPE.COIN_GROUP:this.subCurrencySprite.node.active=!0,r.addSprite(this.subCurrencySprite,r.getFileNameItemImage(t))}this.subCurrencyNameLabel.string="\u6240\u6301"+e.getName(),this.haveCurrencyNumLabel.string=l.convertToCommaDelimited(this._userHaveCurrency);var i=s.getSelectedItemTotalCostCount(this._exchangeId,this._selectedItemMap);this.afterHaveCurrencyNumLabel.string=l.convertToCommaDelimited(this._userHaveCurrency-i),this.needCurrencyNumLabel.string=l.convertToCommaDelimited(i)},openCallback:function(){for(var t=null,e=0;e<this._listIds.length;e+=1)(t=cc.instantiate(this.exchangeItemWideThumbnailPrefab).getComponent("ExchangeItemWideThumbnail")).initExchangeItemWideThumbnail(this._exchangeId,this._listIds[e]),t.setItemInfo(this._selectedItemMap[this._listIds[e]]),this.itemThumbnailParentNode.addChild(t.node);this.commonScrollView.scrollToTop()},_setButtonEvents:function(){this.exchangeBtn.setTapEvent(this._executeExchange.bind(this))},_executeExchange:function(){this._executeExchangeCallback(),this.close()},_cancelBtnEvent:function(){this.close()}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemListDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e313d1SX1VBka50PqmrzLM2","ExchangeItemListDetailPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=t("ExchangeUtils");cc.Class({extends:a,properties:{titleLabel:cc.Label,normalItemDescriptionLabel:cc.Label,randomSetItemDescriptionNode:cc.Node,randomSetItemDescriptionCountLabel:cc.Label,exchangeItemDetailThumbnailPrefab:cc.Prefab,scrollView:o,okBtn:n},openExchangeItemListDetailPopup:function(t){var e=r.getExchangeDetailInfo(t);this.titleLabel.string=e.exchangeDetailMaster.getName(),this.normalItemDescriptionLabel.node.active=!1,this.randomSetItemDescriptionNode.active=!1,e.exchangeItemSetCount>0?e.exchangeItemSetCount===e.exchangeItemInfoArray.length?this.normalItemDescriptionLabel.node.active=!0:(this.randomSetItemDescriptionNode.active=!0,this.randomSetItemDescriptionCountLabel.string=""+e.exchangeItemSetCount):this.normalItemDescriptionLabel.node.active=!0,this._setThumbnailPrefab(e.exchangeItemInfoArray),this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.open()},_setThumbnailPrefab:function(t){this.scrollView.content.destroyAllChildren();for(var e=0;e<t.length;e+=1){var i=cc.instantiate(this.exchangeItemDetailThumbnailPrefab).getComponent("ExchangeItemDetailThumbnail");i.initExchangeItemDetailThumbnail(t[e]),this.scrollView.content.addChild(i.node)}}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",ExchangeUtils:"ExchangeUtils",PopupBase:"PopupBase"}],ExchangeItemListPopup:[function(t,e,i){"use strict";cc._RF.push(e,"969d0F1uYNJBpQAycF3Zrwu","ExchangeItemListPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=(t("Singleton"),t("ResourceUtils")),s=t("ExchangeUtils"),c=t("ExchangeConst"),l=(t("HistoryUtils"),t("CommonUtils")),u=t("ItemUtils");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,commonScrollView:o,mainCurrencyNameLabel:cc.Label,subCurrencySprite:cc.Sprite,subCurrencyNameLabel:cc.Label,needCurrencyNumLabel:cc.Label,haveCurrencyNumLabel:cc.Label,afterHaveCurrencyNumLabel:cc.Label,exchangeItemWideThumbnailPrefab:cc.Prefab,okBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listIds:null,_selectedItemMap:null,_userHaveCurrency:0,_userHaveExchangeItemCount:0,_exchangeItemMaxCount:0,_exchangeSelectItemCount:0,_rewards:null,openExchangeItemListPopup:function(t,e,i,a){this._exchangeId=t,this._listIds=Object.keys(e),this._selectedItemMap=e,this._rewards=i,this.setCloseCallBack(a),this._setParameter(),this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.open(this.openCallback.bind(this))},_setParameter:function(){this._exchangeMainMaster=s.getExchangeMainMasterMap()[this._exchangeId];var t=this._exchangeMainMaster.getCostId(),e=u.getItemMaster(t);switch(this._userHaveCurrency=u.getUserItemCount(t),this.mainCurrencyNameLabel.string=e.getName()+"x",this.subCurrencySprite.node.active=!1,s.getCostGroupTypeByExchangeId(this._exchangeId)){case c.EXCHANGE_COST_GROUP_TYPE.COIN_GROUP:this.subCurrencySprite.node.active=!0,r.addSprite(this.subCurrencySprite,r.getFileNameItemImage(t))}this.subCurrencyNameLabel.string="\u6240\u6301"+e.getName();var i=s.getSelectedItemTotalCostCount(this._exchangeId,this._selectedItemMap);this.haveCurrencyNumLabel.string=l.convertToCommaDelimited(this._userHaveCurrency+i),this.afterHaveCurrencyNumLabel.string=l.convertToCommaDelimited(this._userHaveCurrency),this.needCurrencyNumLabel.string=l.convertToCommaDelimited(i)},openCallback:function(){for(var t=null,e=0;e<this._rewards.length;e+=1)(t=cc.instantiate(this.exchangeItemWideThumbnailPrefab).getComponent("ExchangeItemWideThumbnail")).initExchangeItemWideThumbnailByItemId(this._rewards[e].itemType,this._rewards[e].itemId,this._rewards[e].count),t.setFinishItemInfo(this._rewards[e].count),this.itemThumbnailParentNode.addChild(t.node);this.commonScrollView.scrollToTop()}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemShortagePopup:[function(t,e,i){"use strict";cc._RF.push(e,"51c0cB5rHpDOaRxlXzsThnj","ExchangeItemShortagePopup");var a=t("PopupBase"),n=(t("Singleton"),t("CommonButton")),o=(t("ResourceUtils"),t("ExchangeUtils")),r=t("ExchangeConst");t("CommonUtils"),t("ItemUtils");cc.Class({extends:a,properties:{transitionBtn:n,transitionNameLabel:cc.Label,cancelBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listIds:null,_selectedItemMap:null,_userHavePoint:0,openExchangeItemShortagePopup:function(t,e,i){this._exchangeId=t,this._exchangeMainMaster=o.getExchangeMainMasterMap()[this._exchangeId],this.transitionBtn.setTapEvent(e),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.setCloseCallBack(i),this._setParameter(),this.open()},_setParameter:function(){parseInt(this._exchangeId,10)===r.EXCHANGE_TAB_TYPE.GOLD?this.transitionNameLabel.string="\u30b7\u30e7\u30c3\u30d7\u3078":this.transitionNameLabel.string=this._exchangeMainMaster.getName()+"\u30d8"}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemSingleConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"29dd8so6uxMVaG5j2GvfVdq","ExchangeItemSingleConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("ExchangeUtils"),s=t("ExchangeConst"),c=t("CommonCountView"),l=t("CommonUtils"),u=t("ItemUtils");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,countViewSpace:c,mainCurrencyNameLabel:cc.Label,subCurrencySprite:cc.Sprite,subCurrencyNameLabel:cc.Label,costCurrencyNumLabel:cc.Label,userCurrencyNumLabel:cc.Label,afterUserCurrencyNumLabel:cc.Label,exchangeItemWideThumbnailPrefab:cc.Prefab,exchangeBtn:n,cancelBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listId:0,_exchangeDetailMaster:null,_userHavePoint:0,_userHaveExchangeItemCount:0,_exchangeItemMaxCount:0,_exchangeSelectItemCount:0,_exchangeItemThumbnail:0,_executeExchangeCallback:null,openExchangeItemSingleConfirmPopup:function(t,e,i){this._exchangeId=t,this._listId=e,this._executeExchangeCallback=i,this._setParameter(),this._setUseItemInfo(),this._setButtonEvents(),this._exchangeItemThumbnail=cc.instantiate(this.exchangeItemWideThumbnailPrefab).getComponent("ExchangeItemWideThumbnail"),this._exchangeItemThumbnail.initExchangeItemWideThumbnail(this._exchangeId,this._listId),this.itemThumbnailParentNode.addChild(this._exchangeItemThumbnail.node),this.cancelBtn.setTapEvent(this._cancelBtnEvent.bind(this),n.SE_NAME.CANCEL),this.countViewSpace.initCommonCountView(this.redraw.bind(this),1,this._exchangeItemMaxCount),this._exchangeItemSelectCount=this.countViewSpace.getCountNum(),this._exchangeItemThumbnail.setItemInfo(this._exchangeItemSelectCount),this.open()},redraw:function(){var t=this.countViewSpace.getCountNum();this._exchangeItemThumbnail.setItemInfo(t);var e=this._userHavePoint-this._exchangeDetailMaster.getCostCount()*t;e>0?(this.afterUserCurrencyNumLabel.string=l.convertToCommaDelimited(e),this.afterUserCurrencyNumLabel.node.color=s.CONSUME_COLOR,this.afterUserCurrencyNumLabel.node.getComponent(cc.LabelOutline).color=s.CONSUME_OUT_LINE_COLOR):(this.afterUserCurrencyNumLabel.string=0,this.afterUserCurrencyNumLabel.node.color=s.COST_OVER_COLOR,this.afterUserCurrencyNumLabel.node.getComponent(cc.LabelOutline).color=s.COST_OVER_OUT_LINE_COLOR),this.costCurrencyNumLabel.string=l.convertToCommaDelimited(this._exchangeDetailMaster.getCostCount()*t)},_setParameter:function(){this._exchangeMainMaster=r.getExchangeMainMasterMap()[this._exchangeId],this._exchangeDetailMaster=r.getExchangeDetailMasterMap()[this._exchangeId][this._listId];var t=this._exchangeMainMaster.getCostId(),e=u.getItemMaster(t);switch(this._userHavePoint=u.getUserItemCount(t),this.mainCurrencyNameLabel.string=e.getName()+"x",this.subCurrencySprite.node.active=!1,r.getCostGroupTypeByExchangeId(this._exchangeId)){case s.EXCHANGE_COST_GROUP_TYPE.COIN_GROUP:this.subCurrencySprite.node.active=!0,o.addSprite(this.subCurrencySprite,o.getFileNameItemImage(t))}this.subCurrencyNameLabel.string="\u6240\u6301"+e.getName(),this._userHaveExchangeItemCount=u.getUserItemCount(this._exchangeDetailMaster.getItemId(),this._exchangeDetailMaster.getItemType()),this.userCurrencyNumLabel.string=l.convertToCommaDelimited(this._userHavePoint),this.afterUserCurrencyNumLabel.string=l.convertToCommaDelimited(this._userHavePoint-this._exchangeDetailMaster.getCostCount()),this._userHavePoint-this._exchangeDetailMaster.getCostCount()>0?(this.afterUserCurrencyNumLabel.node.color=s.CONSUME_COLOR,this.afterUserCurrencyNumLabel.node.getComponent(cc.LabelOutline).color=s.CONSUME_OUT_LINE_COLOR):(this.afterUserCurrencyNumLabel.node.color=s.COST_OVER_COLOR,this.afterUserCurrencyNumLabel.node.getComponent(cc.LabelOutline).color=s.COST_OVER_OUT_LINE_COLOR),this.costCurrencyNumLabel.string=l.convertToCommaDelimited(this._exchangeDetailMaster.getCostCount())},_setButtonEvents:function(){this.exchangeBtn.setTapEvent(this._executeExchange.bind(this))},_setUseItemInfo:function(){this._exchangeItemMaxCount=Math.min(Math.floor(this._userHavePoint/this._exchangeDetailMaster.getCostCount()),r.getRemainingCount(this._exchangeId,this._exchangeDetailMaster.getListId()));for(var t=0;t<this._exchangeItemMaxCount;t++)if(this._userHavePoint-this._exchangeDetailMaster.getCostCount()*t<0)return void(this._exchangeItemMaxCount=t-1)},_executeExchange:function(){this._executeExchangeCallback(this.countViewSpace.getCountNum()),this.close()},_cancelBtnEvent:function(){this.close()}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],ExchangeItemSinglePopup:[function(t,e,i){"use strict";cc._RF.push(e,"60a9dwLwFpDAbcSMeuehvKl","ExchangeItemSinglePopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("Singleton"),t("ResourceUtils")),r=t("ExchangeUtils"),s=t("ExchangeConst"),c=(t("HistoryUtils"),t("CommonUtils")),l=t("ItemUtils");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,mainCurrencyNameLabel:cc.Label,subCurrencySprite:cc.Sprite,subCurrencyNameLabel:cc.Label,needCurrencyNumLabel:cc.Label,haveCurrencyNumLabel:cc.Label,afterHaveCurrencyNumLabel:cc.Label,exchangeItemWideThumbnailPrefab:cc.Prefab,okBtn:n},_exchangeId:0,_exchangeMainMaster:null,_listId:0,_exchangeDetailMaster:null,_userHaveCurrency:0,_userHaveExchangeItemCount:0,_exchangeSelectItemCount:0,_exchangeItemThumbnail:0,openExchangeItemSinglePopup:function(t,e,i,a){var n=Object.keys(e);this._exchangeId=t,this._listId=n[0],this._count=parseInt(e[n[0]],10),this.setCloseCallBack(a),this._setParameter(),this._exchangeItemThumbnail=cc.instantiate(this.exchangeItemWideThumbnailPrefab).getComponent("ExchangeItemWideThumbnail"),this._exchangeItemThumbnail.initExchangeItemWideThumbnail(this._exchangeId,this._listId,i.itemType,i.itemId,i.count),this._exchangeItemThumbnail.setFinishItemInfo(e[n[0]]),this.itemThumbnailParentNode.addChild(this._exchangeItemThumbnail.node),this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.open()},_setParameter:function(){this._exchangeMainMaster=r.getExchangeMainMasterMap()[this._exchangeId],this._exchangeDetailMaster=r.getExchangeDetailMasterMap()[this._exchangeId][this._listId];var t=this._exchangeMainMaster.getCostId(),e=l.getItemMaster(t);switch(this._userHaveCurrency=l.getUserItemCount(t),this.mainCurrencyNameLabel.string=e.getName()+"x",this.subCurrencySprite.node.active=!1,r.getCostGroupTypeByExchangeId(this._exchangeId)){case s.EXCHANGE_COST_GROUP_TYPE.COIN_GROUP:this.subCurrencySprite.node.active=!0,o.addSprite(this.subCurrencySprite,o.getFileNameItemImage(t))}this.subCurrencyNameLabel.string="\u6240\u6301"+e.getName(),this._userHaveExchangeItemCount=l.getUserItemCount(this._exchangeDetailMaster.getItemId()),this.haveCurrencyNumLabel.string=c.convertToCommaDelimited(this._userHaveCurrency+this._exchangeDetailMaster.getCostCount()*this._count),this.afterHaveCurrencyNumLabel.string=c.convertToCommaDelimited(this._userHaveCurrency),this.needCurrencyNumLabel.string=c.convertToCommaDelimited(this._exchangeDetailMaster.getCostCount()*this._count)}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ExchangeItemThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"af7f4RrmRtG/6qUb23/OMek","ExchangeItemThumbnail");var a=t("CommonButton"),n=t("ExchangeUtils"),o=t("CommonUtils"),r=t("ItemUtils"),s=t("MatrixThumbnailUtils"),c=t("ExchangeConst");cc.Class({extends:cc.Component,properties:{thumbnailParentNode:cc.Node,checkBoxBtn:a,checkSprite:cc.Sprite,thumbnailSpriteOutline:cc.Sprite,itemNameLabel:cc.Label,remainingNode:cc.Node,remainingNumLabel:cc.Label,possessionNode:cc.Node,possessionNumLabel:cc.Label,currencyParentNode:cc.Node,currencyThumbnailPrefab:cc.Prefab,pointCurrencyThumbnailPrefab:cc.Prefab,grayOutSprite:cc.Sprite,limitedSprite:cc.Sprite,soldOutSprite:cc.Sprite,exchangeBtn:a,infoBtn:a},_root:null,_exchangeId:null,_listId:null,_exchangeMain:null,_exchangeDetail:null,isChecked:!1,_currencyThumbnail:null,init:function(t,e){this._root=t,this._exchangeId=this._root.getSelectedExchangeId(),this._listId=e,this._exchangeMain=n.getExchangeMainMasterMap()[this._exchangeId],this._exchangeDetail=n.getExchangeDetailMasterMap()[this._exchangeId][this._listId],this._initCheckBox(),this._initItemThumbnail(),this._initSoldOutOrBtnEvent()},_initCheckBox:function(){this.isChecked=!1,this.checkSprite.node.active=this.isChecked,this._exchangeMain.getExchangeType()===c.EXCHANGE_TYPE.ITEM_CONSUME&&(this.checkBoxBtn.node.active=!1)},_initItemThumbnail:function(){this.itemNameLabel.string=this._exchangeDetail.getName();var t=s.createMatrixThumbnailByItemType(this._exchangeDetail.getItemId(),this._exchangeDetail.getItemType());switch(this.thumbnailParentNode.addChild(t.node),""!==this._exchangeDetail.getFromDate()?this.limitedSprite.node.active=!0:this.limitedSprite.node.active=!1,this.thumbnailSpriteOutline.node.active=!1,n.getExchangeDetailInfo(this._exchangeDetail).exchangeItemSetCount>0?this.possessionNode.active=!1:(this.possessionNode.active=!0,this.possessionNumLabel.string=r.getUserItemCount(this._exchangeDetail.getItemId(),this._exchangeDetail.getItemType())),this._exchangeMain.getExchangeType()){case c.EXCHANGE_TYPE.POINT_CONSUME:this._currencyThumbnail=cc.instantiate(this.pointCurrencyThumbnailPrefab).getComponent("PointCurrencyThumbnail");var e={itemId:this._exchangeMain.getCostId(),count:this._exchangeDetail.getCostCount()};this._currencyThumbnail.initPointCurrencyThumbnail(e,this._exchangeDetail);break;case c.EXCHANGE_TYPE.ITEM_CONSUME:this._currencyThumbnail=cc.instantiate(this.currencyThumbnailPrefab).getComponent("CurrencyThumbnail");var i=n.getCostMapByExchangeItemDetailMaster(this._exchangeDetail),a=[];Object.keys(i).forEach(function(t){a.push({itemId:t,count:i[t]})}),this._currencyThumbnail.initCurrencyThumbnail(this._exchangeId,a)}this.currencyParentNode.addChild(this._currencyThumbnail.node),this._setRemainingCount()},_setRemainingCount:function(){n.isLimitedExchangeItem(this._exchangeId,this._listId)?n.getRemainingCount(this._exchangeId,this._listId)<=0?(this.remainingNumLabel.string="0",this._initSoldOutOrBtnEvent()):this.remainingNumLabel.string=o.convertToCommaDelimited(n.getRemainingCount(this._exchangeId,this._listId)):this.remainingNode.active=!1},_isSoldOut:function(){return!!(n.isLimitedExchangeItem(this._exchangeId,this._listId)&&n.getRemainingCount(this._exchangeId,this._listId)<=0)},_initSoldOutOrBtnEvent:function(){this._isSoldOut()?(this.checkBoxBtn.setTouchEnable(!1),this.grayOutSprite.node.active=!0,this.soldOutSprite.node.active=!0,this.limitedSprite.node.active=!1):this._setButtonEvent()},redraw:function(){if(this._isSoldOut())return this.grayOutSprite.node.active=!0,this.soldOutSprite.node.active=!0,void(this.limitedSprite.node.active=!1);this.grayOutSprite.node.active=!1,this.exchangeBtn.setTouchEnable(!0),this.checkBoxBtn.setTouchEnable(!0),this._root.getSelectedItemCount(this._listId)?(this.checkSprite.node.active=!0,this.isChecked=!0):(this.checkSprite.node.active=!1,this.isChecked=!1),this.isChecked?this.thumbnailSpriteOutline.node.active=!0:(this.thumbnailSpriteOutline.node.active=!1,this._root.isNextCostOver(this._listId)&&(this.grayOutSprite.node.active=!0,this.exchangeBtn.setTouchEnable(!1),this.checkBoxBtn.setTouchEnable(!1))),this._setRemainingCount(),this._currencyThumbnail.redraw()},_setButtonEvent:function(){this.exchangeBtn.setTapEvent(this.exchangeBtnEvent.bind(this)),this.checkBoxBtn.setTapEvent(this.checkBoxBtnEvent.bind(this),a.SE_NAME.COUNT),this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),"")},exchangeBtnEvent:function(){switch(this._root.setSelectedItem(this._listId,1),this._exchangeMain.getExchangeType()){case c.EXCHANGE_TYPE.POINT_CONSUME:this._root.isCostOver()?this._root.openExchangeCurrencyShortagePopup(function(){this.isChecked||(this._root.deleteSelectedItem(this._listId),this._root.redraw())}.bind(this)):this._root.openExchangeItemSingleConfirmPopup(this._listId);break;case c.EXCHANGE_TYPE.ITEM_CONSUME:this._root.isCostOver()?this._root.openExchangeItemShortagePopup(function(){this.isChecked||(this._root.deleteSelectedItem(this._listId),this._root.redraw())}.bind(this)):this._root.openExchangeItemEventItemConfirmPopup(this._listId)}},checkBoxBtnEvent:function(){this._root.setSelectedItemsByCheckBoxBtn(this._listId,!this.isChecked)},_onTapInfoBtn:function(){this._root.openExchangeItemListDetailPopup(this._exchangeDetail)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils"}],ExchangeItemWideThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"e4e67HU/kdA44YaXlZ4Ed8a","ExchangeItemWideThumbnail");var a=t("ExchangeUtils"),n=t("CommonUtils"),o=t("ItemUtils"),r=(t("ResourceUtils"),t("MatrixThumbnailUtils"));cc.Class({extends:cc.Component,properties:{itemThumbnailParentNode:cc.Node,itemNameLabel:cc.Label,limitedSprite:cc.Sprite,remainingNode:cc.Node,remainingNumLabel:cc.Label,possessionNode:cc.Node,possessionNumLabel:cc.Label,boxAttentionLabel:cc.Label},_exchangeId:0,_listId:0,_itemType:0,_itemId:0,_count:0,_haveItemNum:0,_exchangeMain:null,_exchangeDetail:null,initExchangeItemWideThumbnail:function(t,e,i,n,o){this._exchangeId=t,this._listId=e,this._exchangeMain=a.getExchangeMainMasterMap()[t],this._exchangeDetail=a.getExchangeDetailMasterMap()[t][e],i&&n&&o?(this._itemType=i,this._itemId=n,this._count=o):(this._itemType=this._exchangeDetail.getItemType(),this._itemId=this._exchangeDetail.getItemId(),this._count=this._exchangeDetail.getCount()),this._initItemThumbnail()},initExchangeItemWideThumbnailByItemId:function(t,e,i){this._exchangeId=void 0,this._listId=void 0,this._exchangeDetail=void 0,this._exchangeMain=void 0,this._itemType=t,this._itemId=e,this._count=i,this._initItemThumbnail()},_initItemThumbnail:function(){this.itemNameLabel.string=o.getItemInfo(this._itemType,this._itemId).name;var t=r.createMatrixThumbnailByItemType(this._itemId,this._itemType);if(this.itemThumbnailParentNode.addChild(t.node),this.limitedSprite.node.active=!1,this.boxAttentionLabel.node.active=!1,this.remainingNode.active=!1,this._exchangeDetail){""!==this._exchangeDetail.getFromDate()&&(this.limitedSprite.node.active=!0),a.isLimitedExchangeItem(this._exchangeId,this._listId)&&(this.remainingNode.active=!0);var e=a.getExchangeDetailInfo(this._exchangeDetail);e.exchangeItemSetCount>0?e.exchangeItemSetCount===e.exchangeItemInfoArray.length?(this.possessionNode.active=!0,this.boxAttentionLabel.node.active=!1):(this.possessionNode.active=!1,this.boxAttentionLabel.node.active=!0):this.possessionNode.active=!0}this._haveItemNum=o.getUserItemCount(this._itemId,this._itemType),this.possessionNumLabel.string=n.convertToCommaDelimited(this._haveItemNum),this.setItemInfo(0)},setItemInfo:function(t){this._exchangeDetail&&a.isLimitedExchangeItem(this._exchangeId,this._listId)&&(this.remainingNumLabel.string=n.convertToCommaDelimited(a.getRemainingCount(this._exchangeId,this._listId)-t))},setFinishItemInfo:function(t){this._exchangeDetail&&(this.boxAttentionLabel.string=this._exchangeDetail.getName()+"\u4ea4\u63db\u3067\u7372\u5f97\u3057\u307e\u3057\u305f\u3002",a.isLimitedExchangeItem(this._exchangeId,this._listId)&&(this.remainingNumLabel.string=n.convertToCommaDelimited(a.getRemainingCount(this._exchangeId,this._listId))))}});cc._RF.pop()},{CommonUtils:"CommonUtils",ExchangeUtils:"ExchangeUtils",ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils"}],ExchangeListSwitchView:[function(t,e,i){"use strict";cc._RF.push(e,"4e082CdRiZH06+JXysbdM6t","ExchangeListSwitchView");t("CommonButton"),t("QuestUtils"),t("GameConst");var a=t("ExchangeListViewBase");cc.Enum({AREA_NORMAL:0,AREA_WEEK:1,STAGE_NORMAL:2,STAGE_WEEK:3}),cc.Class({extends:cc.Component,properties:{ExchangeListViewArray:[a]},_root:null,_subRoot:null,_currentExchangeListView:null,_callbackToSwitchThumbnailImage:null,initExchangeListSwitchView:function(t,e){this._root=t,this._subRoot=e,this._switchListViewContent()},redrawExchangeListSwitchView:function(){this._root.isSwitchTab()?this.redrawAfterRequest():(this._currentExchangeListView.redrawListViewBtn(),this._currentExchangeListView.redrawContent())},redrawAfterRequest:function(){this._root.initCostCurrency(),this._root.resetAllSelectedItem(),this._currentExchangeListView.initListView(this._root),this._currentExchangeListView.redrawListViewBtn(),this._currentExchangeListView.redrawScrollView()},_switchListViewContent:function(){this._resetListView(),this._currentExchangeListView=this._getExchangeListView(),this._currentExchangeListView.initListView(this._root),this._currentExchangeListView.initListViewBtn(),this._currentExchangeListView.redrawListViewBtn()},_resetListView:function(){this._currentExchangeListView&&this._currentExchangeListView.resetListView()},_getExchangeListView:function(){return this.ExchangeListViewArray[0]}});cc._RF.pop()},{CommonButton:"CommonButton",ExchangeListViewBase:"ExchangeListViewBase",GameConst:"GameConst",QuestUtils:"QuestUtils"}],ExchangeListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"e0441J6sopKfICUsmOWM+UY","ExchangeListViewBase");var a=t("ListViewBase"),n=t("CommonButton"),o=t("CommonScrollView");cc.Class({extends:a,properties:{noticeDateLabel:cc.Label,commonScrollView:o,eventBtn:n,eventBtnLabel:cc.Label,resetBtn:n,exchangeBtn:n,exchangeBtnCurrencySprite:cc.Sprite,exchangeBtnCurrencyNameLabel:cc.Label,exchangeBtnCurrencyNumLabel:cc.Label},_root:null,_setListContent:function(t){this._root=t,cc.error("_setListContent(root) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("ExchangeItemThumbnail");e.init(this._root,t),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){cc.error("_callbackToThumbnail(data) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")},initListViewBtn:function(){this._initListViewBtn(),this._setListViewBtnEvent()},redrawListViewBtn:function(){cc.error("redrawListViewBtn() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")},redrawContent:function(){for(var t=0;t<this.thumbnailParentNode.childrenCount;t+=1)this.thumbnailParentNode.children[t].getComponent("ExchangeItemThumbnail").redraw()},redrawScrollView:function(){this.commonScrollView.scrollToTop()},_initListViewBtn:function(){this.eventBtn.node.active=!1,this.resetBtn.node.active=!1,this.exchangeBtn.node.active=!1,this.exchangeBtnCurrencySprite.node.active=!1,this.exchangeBtnCurrencyNameLabel.node.active=!1},_setListViewBtnEvent:function(){this.eventBtn.setTapEvent(this.eventBtnEvent.bind(this)),this.resetBtn.setTapEvent(this.resetBtnEvent.bind(this),n.SE_NAME.CANCEL),this.exchangeBtn.setTapEvent(this.exchangeBtnEvent.bind(this))},eventBtnEvent:function(){this._root.transitionScene()},resetBtnEvent:function(){this._root.resetAllSelectedItem(),this._root.redraw()},exchangeBtnEvent:function(){this._root.isCostOver()?this._root.openExchangeCurrencyShortagePopup():this._root.openExchangeItemListConfirmPopup()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",ListViewBase:"ListViewBase"}],ExchangeListView:[function(t,e,i){"use strict";cc._RF.push(e,"cccb4muDWJDZqRTYdHElsMB","ExchangeListView");var a=t("TimeUtils"),n=t("ExchangeUtils"),o=t("ResourceUtils"),r=t("CommonUtils"),s=t("ItemUtils"),c=t("Singleton"),l=t("ExchangeListViewBase"),u=(t("ExchangeItemThumbnail"),t("ExchangeConst")),h=t("GameConst");cc.Class({extends:l,_setListContent:function(t){this._root=t;for(var e=this._getListContentArrayByType(),i=0;i<e.length;i+=1)for(var a=0;a<e[i].length;a+=1)this._addThumbnail(e[i][a])},_getListContentArrayByType:function(){var t=[[],[],[]],e=n.getExchangeDetailMasterMap()[this._root.getSelectedExchangeId()];for(var i in e){var o=!1;n.isLimitedExchangeItem(this._root.getSelectedExchangeId(),i)&&n.getRemainingCount(this._root.getSelectedExchangeId(),i)<=0&&(t[2].push(i),o=!0),""===e[i].getFromDate()||o||(a.isDateInRange(a.getNowDateTime(),e[i].getFromDate(),e[i].getToDate())?(t[0].push(i),o=!0):o=!0),o||t[1].push(i)}return t},_callbackToThumbnail:function(t){},redrawListViewBtn:function(){this._initListViewBtn();var t=parseInt(this._root.getSelectedExchangeId(),10),e=n.getExchangeMainMasterMap()[t];switch(this._setNoticeDateText(e),n.getCostGroupTypeByExchangeId(t)){case u.EXCHANGE_COST_GROUP_TYPE.COIN_GROUP:this.exchangeBtnCurrencySprite.node.active=!0,o.addSprite(this.exchangeBtnCurrencySprite,o.getFileNameItemImage(e.getCostId()));break;case u.EXCHANGE_COST_GROUP_TYPE.TEXT_GROUP:this.exchangeBtnCurrencyNameLabel.node.active=!0}switch(t){case u.EXCHANGE_TAB_TYPE.GOLD:break;case u.EXCHANGE_TAB_TYPE.PVP:case u.EXCHANGE_TAB_TYPE.TOWER:case u.EXCHANGE_TAB_TYPE.RAID:this.eventBtnLabel.string=e.getName()+"\u3078",this.eventBtn.node.active=!0;break;case u.EXCHANGE_TAB_TYPE.R_L_YEH:this.eventBtnLabel.string="\u30ac\u30c1\u30e3\u3078",this.eventBtn.node.active=!0;break;default:if(e.getEventId()){var i=_.find(c.dao.EventItemMasters,function(t){return t.getEventId()===e.getEventId()&&t.getItemType()===e.getCostType()&&t.getItemId()===e.getCostId()});this.eventBtnLabel.string=i?e.getName()+"\u3078":"\u30a4\u30d9\u30f3\u30c8\u3078"}else this.eventBtnLabel.string="\u30ac\u30c1\u30e3\u3078";this.eventBtn.node.active=!0}this._root.isSelectedItem()&&(this.resetBtn.node.active=!0,this.exchangeBtn.node.active=!0,this.exchangeBtnCurrencyNameLabel.string=s.getItemMaster(e.getCostId()).getName(),this.exchangeBtnCurrencyNumLabel.string=r.convertToCommaDelimited(this._root.getSelectedItemTotalCostCount()))},_setNoticeDateText:function(t){switch(t.getCostId()){case h.ITEM_ID_PVP:this.noticeDateLabel.string="\u30e9\u30a4\u30f3\u30ca\u30c3\u30d7\u306f\u30a2\u30ea\u30fc\u30ca\u306e\u6226\u679c\u30ea\u30bb\u30c3\u30c8\n\u3068\u540c\u6642\u306b\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002";break;case h.ITEM_ID_GOLD:this.noticeDateLabel.string="\u30e9\u30a4\u30f3\u30ca\u30c3\u30d7\u306f\u6bce\u65e5 00:00 \u306b\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002";break;case h.ITEM_ID_TOWER:this.noticeDateLabel.string="\u30e9\u30a4\u30f3\u30ca\u30c3\u30d7\u306f\u6bce\u67081\u65e5\u306e 00:00 \u306b\n\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002";break;case h.ITEM_ID_R_L_YEH_COIN:var e=_.filter(c.dao.ExchangePointDetailMasters,function(t){return t.getExchangeId()===u.EXCHANGE_TAB_TYPE.R_L_YEH&&t.getToDate()&&a.isRangeOfDate(t.getFromDate(),t.getToDate())}),i=_.minBy(e,function(t){return t.getToDate()});if(i&&i.getToDate()){var n=a.addSecond(i.getToDate());this.noticeDateLabel.string="\u30e9\u30a4\u30f3\u30ca\u30c3\u30d7\u306f "+a.parseTimeToYmdhm(n)+" \u306b\n\u66f4\u65b0\u3055\u308c\u307e\u3059"}else this.noticeDateLabel.string="";break;default:this.noticeDateLabel.string="\u4ea4\u63db\u671f\u9650 "+a.parseTimeToYmdhm(t.getToDate())+" \u307e\u3067"}}});cc._RF.pop()},{CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeItemThumbnail:"ExchangeItemThumbnail",ExchangeListViewBase:"ExchangeListViewBase",ExchangeUtils:"ExchangeUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],ExchangeMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"f5ad8xdMzxJ+53PdyAbVZID","ExchangeMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getExchangeId:function(){if(this._isKeyFieldAvailable("exchangeId"))return this._data.exchangeId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exchangeId")},getExchangeType:function(){if(this._isKeyFieldAvailable("exchangeType"))return this._data.exchangeType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exchangeType")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getCostType:function(){if(this._isKeyFieldAvailable("costType"))return this._data.costType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType")},getCostId:function(){if(this._isKeyFieldAvailable("costId"))return this._data.costId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId")},getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ExchangePointDetailModel:[function(t,e,i){"use strict";cc._RF.push(e,"c9d7eTQnEtN56TAgZFBnErl","ExchangePointDetailModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getExchangeId:function(){if(this._isKeyFieldAvailable("exchangeId"))return this._data.exchangeId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exchangeId")},getListId:function(){if(this._isKeyFieldAvailable("listId"))return this._data.listId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: listId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getCostCount:function(){if(this._isKeyFieldAvailable("costCount"))return this._data.costCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount")},getMaxCount:function(){if(this._isKeyFieldAvailable("maxCount"))return this._data.maxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCount")},getMaxCountType:function(){if(this._isKeyFieldAvailable("maxCountType"))return this._data.maxCountType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCountType")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getIsToDateDisplayFlg:function(){if(this._isKeyFieldAvailable("isToDateDisplayFlg"))return this._data.isToDateDisplayFlg;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isToDateDisplayFlg")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ExchangeRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"399bfWvDhpBhKEllV/6yqdI","ExchangeRootUtils");var a=t("ExchangeSubRoot");e.exports={openExchangeSubRoot:function(t,e){cc.log("openExchangeSubRoot"),cc.log(e),null===t._exchangeSubRoot||void 0===t._exchangeSubRoot?(t._exchangeSubRoot=cc.instantiate(t.exchangeSubRootPrefab).getComponent(a),t._exchangeSubRoot.initExchangeSubRoot(t,e.exchangeId),t.subRootParent.addChild(t._exchangeSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002")},closeExchangeSubRoot:function(t,e){cc.log("closeExchangeSubRoot"),cc.log(e),null!==t._exchangeSubRoot&&(t._exchangeSubRoot.node.destroy(),t._exchangeSubRoot=null)}},cc._RF.pop()},{ExchangeSubRoot:"ExchangeSubRoot"}],ExchangeRoot:[function(t,e,i){"use strict";cc._RF.push(e,"918be6BQ/JF1p0fxPfnGWgt","ExchangeRoot");var a=t("Singleton"),n=t("OutGameRootBase"),o=t("ExchangeViewSetting"),r=t("CommonUtils"),s=t("PopupUtils"),c=(t("ItemUtils"),t("ExchangeUtils")),l=t("EventUtils"),u=(t("NoticeBadgeCheckUtils"),t("TimeUtils"),t("GameConst")),h=t("ExchangeConst"),d=t("SceneConst");t("LocalDataConst"),cc.Class({extends:n,properties:{exchangeSubRootPrefab:cc.Prefab,exchangeItemSingleConfirmPopupPrefab:cc.Prefab,exchangeItemSinglePopupPrefab:cc.Prefab,exchangeItemEventItemConfirmPopupPrefab:cc.Prefab,exchangeItemEventItemPopupPrefab:cc.Prefab,exchangeItemListConfirmPopupPrefab:cc.Prefab,exchangeItemListPopupPrefab:cc.Prefab,exchangeCurrencyShortagePopupPrefab:cc.Prefab,exchangeItemShortagePopupPrefab:cc.Prefab,exchangeItemListDetailPopupPrefab:cc.Prefab},_exchangeSubRoot:null,_exchangeItemSingleConfirmPopup:null,_exchangeItemSinglePopup:null,_exchangeItemEventItemConfirmPopup:null,_exchangeItemEventItemPopup:null,_exchangeItemListConfirmPopup:null,_exchangeItemListPopup:null,_exchangeCurrencyShortagePopup:null,_exchangeItemShortagePopup:null,_exchangeIds:null,_costCurrencyItemIdMap:null,_selectedTab:null,_recentTab:null,_isRequest:null,_selectedItemMap:null,onLoad:function(){this._super(),this._uiHeader.hideUserPointStats()},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,o.EXCHANGE_SETTING)},initialize:function(){this._exchangeInit();var t={ExchangeSubRoot:{exchangeId:h.EXCHANGE_TAB_TYPE.GOLD}};this._initOpenFirstView(t)},redraw:function(){this._exchangeSubRoot.redrawExchangeSubRoot(),this.redrawUIHeader()},redrawAfterRequest:function(){this._exchangeSubRoot.redrawAfterRequest(),this.redrawUIHeader()},_exchangeInit:function(){this._setExchangeIds(),this._selectedItemMap={}},initCostCurrency:function(){this._costCurrencyItemIdMap=c.getCostItemIdMapByExchangeId(this.getSelectedExchangeId());var t=Object.keys(this._costCurrencyItemIdMap);t.sort(function(t,e){return r.sortFunc(parseInt(e),parseInt(t))}),t.unshift(u.ITEM_ID_FREE_GEM);for(var e=[],i=0;i<t.length;i+=1)e.push({itemId:t[i],callback:this.transitionScene.bind(this)});this.setUIHeaderCurrencyInfo(e)},_setExchangeIds:function(){var t=Object.keys(c.getExchangeMainMasterMap());this._exchangeIds=[];for(var e=0;e<t.length;e++)c.checkInOfTerm(c.getExchangeMainMasterMap()[t[e]])&&this._exchangeIds.push(t[e]);this._exchangeIds.sort(function(t,e){return r.sortFunc(parseInt(t,10),parseInt(e,10))}),this._exchangeIds.length>h.MAX_TAB_COUNT&&(this._exchangeIds=this._exchangeIds.splice(0,7))},getExchangeIds:function(){return this._exchangeIds},getSelectedExchangeId:function(){return this._exchangeIds[this.getSelectedTab()]},setSelectedTab:function(t){this._selectedTab=t},initRecentTab:function(){this._recentTab=this._selectedTab},getSelectedTab:function(){return this._selectedTab},isSwitchTab:function(){return this._selectedTab!==this._recentTab&&(this._recentTab=this._selectedTab,!0)},requestExchange:function(t){this._isRequest=!0;var e=this._createRequestData(),i=this.getSelectedItemMap(!0);a.ShopService.exchange(this.getSelectedExchangeId(),e.listIds,e.counts,function(e){if(cc.log("exchangeRes =",e),e)return t(e.addRewards,i);s.openSimpleMessageWindow("\u4ea4\u63db\u306b\u5931\u6557\u3057\u307e\u3057\u305f")})},_createRequestData:function(){var t=[],e=[],i=this.getSelectedItemMap();for(var a in i)t.push(a),e.push(i[a]);return{listIds:t,counts:e}},requestSingleExchange:function(t,e){switch(this.setSelectedItem(t,e),c.getExchangeMainMasterMap()[this.getSelectedExchangeId()].getExchangeType()){case h.EXCHANGE_TYPE.POINT_CONSUME:this.requestExchange(this.openExchangeItemSinglePopup.bind(this));break;case h.EXCHANGE_TYPE.ITEM_CONSUME:this.requestExchange(this.openExchangeItemEventItemPopup.bind(this))}},requestMultipleExchange:function(){this.requestExchange(this.openExchangeItemListPopup.bind(this))},finishExchangeRequest:function(){this.resetAllSelectedItem(),this.redrawAfterRequest()},transitionScene:function(){var t=null,e=d.SCENE.FILE_NAME.HOME,i=parseInt(this.getSelectedExchangeId(),10),n=_.find(a.dao.ExchangeMainMasters,function(t){return t.getExchangeId()===i});if(!n)return s.openSimpleMessageWindow("\u30a4\u30d9\u30f3\u30c8\u306f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002");switch(n.getCostId()){case h.EXCHANGE_COST_ID.GOLD:e=d.SCENE.FILE_NAME.SHOP;break;case h.EXCHANGE_COST_ID.ARENA:e=d.SCENE.FILE_NAME.PVP;break;case h.EXCHANGE_COST_ID.TOWER:e=d.SCENE.FILE_NAME.TOWER;break;case h.EXCHANGE_COST_ID.R_L_YEH:e=d.SCENE.FILE_NAME.GACHA;break;case h.EXCHANGE_COST_ID.RAID:e=d.SCENE.FILE_NAME.RAID;break;default:var o=c.getExchangeMainMasterMap()[this.getSelectedExchangeId()].getEventId();if(o){if(!l.isEventOpenByEventId(o))return s.openSimpleMessageWindow("\u30a4\u30d9\u30f3\u30c8\u306f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002");var r=l.getTransitionEventSceneData(o);e=r.sceneName,t=r.sceneParam}else e=d.SCENE.FILE_NAME.GACHA}var u={ExchangeSubRoot:{exchangeId:this.getSelectedExchangeId()}};this.pushScene(e,this.getCurrentSceneName(),t,u)},getSelectedItemMap:function(t){return t?_.assign({},this._selectedItemMap):this._selectedItemMap},isSelectedItem:function(){return Object.keys(this.getSelectedItemMap()).length>0},setSelectedItem:function(t,e){this._selectedItemMap[t]=e},getSelectedItemCount:function(t){return this._selectedItemMap[t]},getSelectedItemTotalCostCount:function(){return c.getSelectedItemTotalCostCount(this.getSelectedExchangeId(),this.getSelectedItemMap())},deleteSelectedItem:function(t){this._selectedItemMap[t]&&delete this._selectedItemMap[t]},setSelectedItemsByCheckBoxBtn:function(t,e){e?(this.setSelectedItem(t,1),this.isCostOver()&&this.deleteSelectedItem(t)):this.deleteSelectedItem(t),this.redraw()},resetAllSelectedItem:function(){for(var t=Object.keys(this._selectedItemMap),e=0;e<t.length;e+=1)this.deleteSelectedItem(t[e])},isCostOver:function(){return c.isCostOver(this.getSelectedExchangeId(),this._costCurrencyItemIdMap,this.getSelectedItemMap())},isNextCostOver:function(t){return c.isNextCostOver(this.getSelectedExchangeId(),t,this._costCurrencyItemIdMap,this.getSelectedItemMap())},openExchangeItemSingleConfirmPopup:function(t){this.closeExchangeItemSingleConfirmPopup(),this._exchangeItemSingleConfirmPopup=cc.instantiate(this.exchangeItemSingleConfirmPopupPrefab).getComponent("ExchangeItemSingleConfirmPopup"),this.resetAllSelectedItem(),this._exchangeItemSingleConfirmPopup.openExchangeItemSingleConfirmPopup(this.getSelectedExchangeId(),t,function(e){this.requestSingleExchange(t,e)}.bind(this))},closeExchangeItemSingleConfirmPopup:function(){this._exchangeItemSingleConfirmPopup&&(this._exchangeItemSingleConfirmPopup.close(),this._exchangeItemSingleConfirmPopup=null)},openExchangeItemEventItemConfirmPopup:function(t){this.closeExchangeItemEventItemConfirmPopup(),this._exchangeItemEventItemConfirmPopup=cc.instantiate(this.exchangeItemEventItemConfirmPopupPrefab).getComponent("ExchangeItemEventItemConfirmPopup"),this.resetAllSelectedItem(),this._exchangeItemEventItemConfirmPopup.openExchangeItemEventItemConfirmPopup(this.getSelectedExchangeId(),t,function(e){this.requestSingleExchange(t,e)}.bind(this))},closeExchangeItemEventItemConfirmPopup:function(){this._exchangeItemEventItemConfirmPopup&&(this._exchangeItemEventItemConfirmPopup.close(),this._exchangeItemEventItemConfirmPopup=null)},openExchangeItemSinglePopup:function(t,e){t.length>1?this.openExchangeItemListPopup(t,e):(this.closeExchangeItemSinglePopup(),this._exchangeItemSinglePopup=cc.instantiate(this.exchangeItemSinglePopupPrefab).getComponent("ExchangeItemSinglePopup"),this._exchangeItemSinglePopup.openExchangeItemSinglePopup(this.getSelectedExchangeId(),e,t[0],this.finishExchangeRequest.bind(this)))},closeExchangeItemSinglePopup:function(){this._exchangeItemSinglePopup&&(this._exchangeItemSinglePopup.close(),this._exchangeItemSinglePopup=null)},openExchangeItemEventItemPopup:function(t,e){this.closeExchangeItemEventItemPopup(),this._exchangeItemEventItemPopup=cc.instantiate(this.exchangeItemEventItemPopupPrefab).getComponent("ExchangeItemEventItemPopup"),this._exchangeItemEventItemPopup.openExchangeItemEventItemPopup(this.getSelectedExchangeId(),e,this.finishExchangeRequest.bind(this))},closeExchangeItemEventItemPopup:function(){this._exchangeItemEventItemPopup&&(this._exchangeItemEventItemPopup.close(),this._exchangeItemEventItemPopup=null)},openExchangeItemListConfirmPopup:function(){this.closeExchangeItemListConfirmPopup(),this._exchangeItemListConfirmPopup=cc.instantiate(this.exchangeItemListConfirmPopupPrefab).getComponent("ExchangeItemListConfirmPopup"),this._exchangeItemListConfirmPopup.openExchangeItemListConfirmPopup(this.getSelectedExchangeId(),this.getSelectedItemMap(),this.requestMultipleExchange.bind(this))},closeExchangeItemListConfirmPopup:function(){this._exchangeItemListConfirmPopup&&(this._exchangeItemListConfirmPopup.close(),this._exchangeItemListConfirmPopup=null)},openExchangeItemListPopup:function(t,e){t.length<=1?this.openExchangeItemSinglePopup(t,e):(this.closeExchangeItemListPopup(),this._exchangeItemListPopup=cc.instantiate(this.exchangeItemListPopupPrefab).getComponent("ExchangeItemListPopup"),this._exchangeItemListPopup.openExchangeItemListPopup(this.getSelectedExchangeId(),e,t,this.finishExchangeRequest.bind(this)))},closeExchangeItemListPopup:function(){this._exchangeItemListPopup&&(this._exchangeItemListPopup.close(),this._exchangeItemListPopup=null)},openExchangeCurrencyShortagePopup:function(t){this.closeExchangeCurrencyShortagePopup(),this._exchangeCurrencyShortagePopup=cc.instantiate(this.exchangeCurrencyShortagePopupPrefab).getComponent("ExchangeCurrencyShortagePopup"),this._exchangeCurrencyShortagePopup.openExchangeCurrencyShortagePopup(this.getSelectedExchangeId(),this.getSelectedItemMap(),this.transitionScene.bind(this),t)},closeExchangeCurrencyShortagePopup:function(){this._exchangeCurrencyShortagePopup&&(this._exchangeCurrencyShortagePopup.close(),this._exchangeCurrencyShortagePopup=null)},openExchangeItemShortagePopup:function(t){this.closeExchangeItemShortagePopup(),this._exchangeItemShortagePopup=cc.instantiate(this.exchangeItemShortagePopupPrefab).getComponent("ExchangeItemShortagePopup"),this._exchangeItemShortagePopup.openExchangeItemShortagePopup(this.getSelectedExchangeId(),this.transitionScene.bind(this),t)},closeExchangeItemShortagePopup:function(){this._exchangeItemShortagePopup&&(this._exchangeItemShortagePopup.close(),this._exchangeItemShortagePopup=null)},openExchangeItemListDetailPopup:function(t){this.closeExchangeItemListDetailPopup(),this._exchangeItemListDetailPopup=cc.instantiate(this.exchangeItemListDetailPopupPrefab).getComponent("ExchangeItemListDetailPopup"),this._exchangeItemListDetailPopup.openExchangeItemListDetailPopup(t)},closeExchangeItemListDetailPopup:function(){this._exchangeItemListDetailPopup&&(this._exchangeItemListDetailPopup.close(),this._exchangeItemListDetailPopup=null)}});cc._RF.pop()},{CommonUtils:"CommonUtils",EventUtils:"EventUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",ExchangeViewSetting:"ExchangeViewSetting",GameConst:"GameConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",SceneConst:"SceneConst",Singleton:"Singleton",TimeUtils:"TimeUtils"}],ExchangeSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"9befftvCnFPTqEC0bMZJhfN","ExchangeSubRoot");var a=t("WindowBase"),n=(t("Singleton"),t("CommonButton"),t("ExchangeTabView")),o=t("ExchangeListSwitchView");t("ExchangeConst");cc.Class({extends:a,properties:{exchangeTabView:n,exchangeListSwitchView:o},_root:null,initExchangeSubRoot:function(t,e){this._root=t,this._initTabView(e),this._initListSwitchView()},_initTabView:function(t){for(var e=0,i=this._root.getExchangeIds(),a=0;a<i.length;a+=1)if(i[a]===String(t)){e=a;break}this._root.setSelectedTab(e),this._root.initRecentTab(),this._root.initCostCurrency(),this.exchangeTabView.initExchangeTabView(this._root,this,e)},_initListSwitchView:function(){this.exchangeListSwitchView.initExchangeListSwitchView(this._root,this)},redrawExchangeSubRoot:function(){this.exchangeListSwitchView.redrawExchangeListSwitchView()},redrawAfterRequest:function(){this.exchangeListSwitchView.redrawAfterRequest()}}),cc._RF.pop()},{CommonButton:"CommonButton",ExchangeConst:"ExchangeConst",ExchangeListSwitchView:"ExchangeListSwitchView",ExchangeTabView:"ExchangeTabView",Singleton:"Singleton",WindowBase:"WindowBase"}],ExchangeTabButton:[function(t,e,i){"use strict";cc._RF.push(e,"2546eaIrFhHApABBcrurIfQ","ExchangeTabButton");var a=t("TabButton"),n=t("ExchangeUtils"),o=t("ExchangeConst"),r=t("ResourceUtils");cc.Class({extends:a,properties:{iconSpriteArray:[cc.Sprite]},_exchangeMainMaster:null,initExchangeTabButton:function(t,e){switch(this._exchangeMainMaster=n.getExchangeMainMasterMap()[t],this.iconSpriteArray.forEach(function(t){t.node.parent.active=!1}),n.getCostGroupTypeByExchangeId(parseInt(t,10))){case o.EXCHANGE_COST_GROUP_TYPE.COIN_GROUP:for(var i=0;i<this.iconSpriteArray.length;i++)this.iconSpriteArray[i].node.parent.active=!0,r.addSprite(this.iconSpriteArray[i],r.getFileNameItemImage(n.getExchangeMainMasterMap()[t].getCostId()));break;case o.EXCHANGE_COST_GROUP_TYPE.TEXT_GROUP:}this.initTabButton(this._exchangeMainMaster.getName(),e)},getExchangeMainMaster:function(){return this._exchangeMainMaster}});cc._RF.pop()},{ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",ResourceUtils:"ResourceUtils",TabButton:"TabButton"}],ExchangeTabView:[function(t,e,i){"use strict";cc._RF.push(e,"a6a572cnAdBkbneRdV7LKlR","ExchangeTabView");var a=t("VariableTabViewBase"),n=(t("ExchangeUtils"),t("NoticeBadgeCheckUtils")),o=t("ViewUtils"),r=t("CommonUtils"),s=t("TimeUtils"),c=t("LocalDataConst"),l=1,u=2,h={POSITION:cc.v2(57,18),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{},_root:null,_subRoot:null,_tabBtnArray:null,initExchangeTabView:function(t,e,i){this._root=t,this._subRoot=e,this._tabBtnArray=this._createExchangeTabButtons(),this.initVariableTabViewBase(t,this._tabBtnArray),this._setCurrentTab(i),this._activateTab(i),this.setCallbackToTabEvent(this.exchangeTabEvent.bind(this))},_createExchangeTabButtons:function(){for(var t=[],e=this._root.getExchangeIds(),i=0;i<e.length;i+=1){var a=this.getTabButtonPrefab(i,this._root.getExchangeIds().length),n=cc.instantiate(a).getComponent("ExchangeTabButton");t.push(n),n.initExchangeTabButton(e[i],!0),this._setNoticeBadge(n.node,e[i])}return t},_setNoticeBadge:function(t,e){switch(parseInt(e)){case l:n.hasNewDailyExchangeItem()&&o.addNoticeBadge(t,h.POSITION,h.SCALE);break;case u:n.hasNewArenaExchangeItem()&&o.addNoticeBadge(t,h.POSITION,h.SCALE);break;default:n.hasNewMonthlyExchangeItem()&&o.addNoticeBadge(t,h.POSITION,h.SCALE)}},_saveExchangeLookFlg:function(t,e){switch(e){case l:n.hasNewDailyExchangeItem()&&r.saveLocalStorage(c.LOCAL_STORAGE_KEY.EXCHANGE_DAILY_LOOK,Math.floor(parseInt(s.getNowDate())));break;case u:n.hasNewArenaExchangeItem()&&r.saveLocalStorage(c.LOCAL_STORAGE_KEY.EXCHANGE_ARENA_LOOK,parseInt(s.getNowDateTime()));break;default:n.hasNewMonthlyExchangeItem()&&r.saveLocalStorage(c.LOCAL_STORAGE_KEY.EXCHANGE_MONTHLY_LOOK,Math.floor(.01*parseInt(s.getNowDate())))}},exchangeTabEvent:function(t,e,i){this._root.setSelectedTab(e),this._activateTab(e),this._root.redraw()},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._saveExchangeLookFlg(this.tabBtnArray[t].node,this.tabBtnArray[t].getExchangeMainMaster().getExchangeId()),o.hideNoticeBadge(this.tabBtnArray[t].node)}});cc._RF.pop()},{CommonUtils:"CommonUtils",ExchangeUtils:"ExchangeUtils",LocalDataConst:"LocalDataConst",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",TimeUtils:"TimeUtils",VariableTabViewBase:"VariableTabViewBase",ViewUtils:"ViewUtils"}],ExchangeUtils:[function(t,e,i){"use strict";cc._RF.push(e,"10494r26Q5A14TWTZP4OqUs","ExchangeUtils");var a=t("Singleton"),n=t("TimeUtils"),o=t("ItemUtils"),r=t("HistoryUtils"),s=t("ExchangeConst"),c=t("ItemConst");function l(){for(var t={},e=a.dao.ExchangeMainMasters,i=0;i<e.length;i+=1){t[e[i].getExchangeId()]=e[i]}return t}function u(){var t={},e=l();for(var i in e)t[i]=h(e[i]);return t}function h(t){var e=a.dao.ExchangePointDetailMasters,i=a.dao.ExchangeItemDetailMasters,n=null,o={};switch(t.getExchangeType()){case s.EXCHANGE_TYPE.POINT_CONSUME:n=e;break;case s.EXCHANGE_TYPE.ITEM_CONSUME:n=i}for(var r=0;r<n.length;r+=1){if(n[r].getExchangeId()===t.getExchangeId())o[n[r].getListId()]=n[r]}return o}function d(t){return o.getUserItemCount(parseInt(t))}function p(t){var e={};return 0!==parseInt(t.getCostId1())&&(e[t.getCostId1()]=parseInt(t.getCostCount1())),0!==parseInt(t.getCostId2())&&(e[t.getCostId2()]=parseInt(t.getCostCount2())),0!==parseInt(t.getCostId3())&&(e[t.getCostId3()]=parseInt(t.getCostCount3())),0!==parseInt(t.getCostId4())&&(e[t.getCostId4()]=parseInt(t.getCostCount4())),0!==parseInt(t.getCostId5())&&(e[t.getCostId5()]=parseInt(t.getCostCount5())),e}function m(t,e,i,a){var n=0;for(var o in i)n+=u()[t][o].getCostCount()*i[o];if(n<=0)return!1;if(a){if(e<n+u()[t][a].getCostCount())return!0}else if(e<n)return!0;return!1}function g(t,e,i,a){var n={},o={};for(var r in i)for(var s in n=p(u()[t][r]))o[s]?o[s]+=n[s]:o[s]=n[s];if(Object.keys(o).length<=0)return!1;if(a){var c=p(u()[t][a]),l=0;for(var h in o){if(c[h]&&(l=c[h]),e[h]<o[h]+l)return!0;l=0}}else for(var d in o)if(e[d]<o[d])return!0;return!1}function C(t,e,i){var n="",o="";switch(t){case c.ITEM_TYPE.CHARACTER:var r=(s=_.find(a.dao.CharacterMainMasters,function(t){return t.getCharacterId()===e})).getSkinName()?"["+s.getSkinName()+"]":"";n=s.getName()+r,o=s.getShortText();break;case c.ITEM_TYPE.EQUIPMENT:n=(s=_.find(a.dao.EquipmentMainMasters,function(t){return t.getEquipmentId()===e})).getName(),o=s.getText();break;default:var s;n=(s=_.find(a.dao.ItemMainMasters,function(t){return t.getItemId()===e})).getName(),o=s.getText()}return{itemType:t,itemId:e,name:n,text:o,count:i}}function f(t){if(t)return _.find(t.coinPresent,function(t){return t.itemType===c.ITEM_TYPE.EXCHANGE_POINT})}e.exports={getExchangeMainMasterMap:l,getExchangeDetailMasterMap:u,getExchangeIdByListId:function(t){for(var e=null,i=u(),a=Object.keys(i),n=0;n<a.length;n+=1)for(var o in i[a[n]])o===t&&(e=a[n]);return e},getCostGroupTypeByExchangeId:function(t){switch(parseInt(t)){case s.EXCHANGE_TAB_TYPE.GOLD:case s.EXCHANGE_TAB_TYPE.PVP:case s.EXCHANGE_TAB_TYPE.TOWER:case s.EXCHANGE_TAB_TYPE.R_L_YEH:case s.EXCHANGE_TAB_TYPE.RAID:return s.EXCHANGE_COST_GROUP_TYPE.COIN_GROUP;default:return s.EXCHANGE_COST_GROUP_TYPE.ITEM_GROUP}},getCostItemIdMapByExchangeId:function(t){var e={},i=l()[t];if(i.getExchangeType()===s.EXCHANGE_TYPE.POINT_CONSUME){var a=i.getCostId();return e[a]=d(a),e}var n=u()[t];for(var o in n){var r=p(n[o]);for(var c in r)e[c]=d(c)}return e},getCostMapByExchangeItemDetailMaster:p,checkInOfTerm:function(t){var e=t.getFromDate(),i=t.getToDate();return n.isRangeOfDate(e,i)},getSelectedItemTotalCostCount:function(t,e){var i=0;for(var a in e)i+=e[a]*u()[t][a].getCostCount();return i},isLimitedExchangeItem:function(t,e){return 0!==parseInt(u()[t][e].getMaxCount(),10)},getRemainingCount:function(t,e){var i=0,a=u()[t][e].getMaxCount();switch(u()[t][e].getMaxCountType()){case s.EXCHANGE_MAX_COUNT_TYPE.NON:i=r.getRemainingCount("exchange",parseInt(e,10),a);break;case s.EXCHANGE_MAX_COUNT_TYPE.DAILY:i=r.getRemainingCountOfToday("exchange",parseInt(e,10),a);break;case s.EXCHANGE_MAX_COUNT_TYPE.WEEKLY:i=r.getRemainingCountOfWeek("exchange",parseInt(e,10),a);break;case s.EXCHANGE_MAX_COUNT_TYPE.MONTHLY:i=r.getRemainingCountOfMonth("exchange",parseInt(e,10),a)}return i},isCostOver:function(t,e,i){var a=l()[t];switch(a.getExchangeType()){case s.EXCHANGE_TYPE.POINT_CONSUME:return m(t,e[a.getCostId()],i);case s.EXCHANGE_TYPE.ITEM_CONSUME:return g(t,e,i)}},isNextCostOver:function(t,e,i,a){var n=l()[t];switch(n.getExchangeType()){case s.EXCHANGE_TYPE.POINT_CONSUME:return m(t,i[n.getCostId()],a,e);case s.EXCHANGE_TYPE.ITEM_CONSUME:return g(t,i,a,e)}},getExchangeIdByEventId:function(t){return a.dao.ExchangeMainMasters.find(function(e){return parseInt(e.getEventId(),10)===t}).getExchangeId()},getExchangeDetailInfo:function(t){var e=[],i=0;switch(t.getItemType()){case c.ITEM_TYPE.SET_ITEM:var a=o.getItemSetMasterArrayBySetItemId(t.getItemId()),n=[];for(var r in a)e.push(C(a[r].getItemType(),a[r].getItemId(),a[r].getCount())),n.push(a[r].getSetId());i=_.uniq(n).length;break;default:e.push(C(t.getItemType(),t.getItemId(),t.getCount()))}return{exchangeDetailMaster:t,exchangeItemInfoArray:e,exchangeItemSetCount:i}},convertCostItemToExchangeId:function(t,e){var i=_.find(a.dao.ExchangeMainMasters,function(i){return i.getCostType()===t&&i.getCostId()===e});return i?i.getExchangeId():0},getExchangePointByUserGacha:function(t){for(var e,i=0;i<t.getButtons().length&&!(e=f(t.getButtons()[i]));i+=1);return e}},cc._RF.pop()},{ExchangeConst:"ExchangeConst",HistoryUtils:"HistoryUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],ExchangeViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"c6261qJ61ZK8LxNv8P0yUJv","ExchangeViewSetting");var a=t("ExchangeRootUtils");e.exports={EXCHANGE_SETTING:{ExchangeSubRoot:{open:a.openExchangeSubRoot,close:a.closeExchangeSubRoot}}},cc._RF.pop()},{ExchangeRootUtils:"ExchangeRootUtils"}],ExtensionAdvRoot:[function(t,e,i){"use strict";cc._RF.push(e,"51b2cDKmp1M0LaALZ1qRd3J","ExtensionAdvRoot");var a=t("AdvRoot"),n=t("AdvSingleton"),o=t("AdvLocalDataConst"),r=t("ExtensionAdvUtils"),s=(t("AdvStaticResourceConst"),t("AdvSingletonConst")),c=(t("BattleConstants"),t("CommonUtils")),l=t("Environment"),u=t("SingletonConst"),h=t("FileLoaderManager"),d=t("MemoryManager"),p=t("GameConst"),m=t("SceneConst"),g=t("TutorialUtils"),C=t("Singleton"),f=t("LocalDataConst"),E=t("ResourceUtils"),T=t("ViewUtils"),S=(t("PopupUtils"),t("StaticResourceConst")),R=t("DownManifestManager"),A={SIMPLE:[S.LOADING_SIMPLE_PREFAB_PATH],PROGRESS:[S.LOADING_PROGRESS_TIPS_PREFAB_PATH]};cc.Class({extends:a,properties:{},_isInitialized:void 0,_storyId:0,_adult:0,initAdvRoot:function(t,e,i,a,n,o,r){cc.log("AdvRoot:initAdvRoot"),this._storyId=t,this._adult=e||0,this._super(i,a,n,o,r)},initData:function(){if(n.fileLoaderManager||(C.fileLoaderManager?(n.fileLoaderManager=C.fileLoaderManager,n.memoryManager=C.memoryManager,n.downManifestManager=C.downManifestManager):(n.fileLoaderManager=new h,C.memoryManager=new d,n.downManifestManager=new R)),C[u.ENVIRONMENT]){if(!C[u.ENVIRONMENT].getPlainDynamicFileFlg()){var t=_.map(this._advTextInfoArray,function(t){return t.storyId});this.requestURLCount++,C.StoryService.getStoryResource(t,this._adult,function(t){cc.log("getStoryResource response = ",t),n.fileLoaderManager.setAdvResMap(t.resource),this.requestURLCount--}.bind(this))}}else{this.requestURLCount+=1,cc.loader.loadRes("system/environment",function(t,e){if(null===t){var i=new l(e.json);C[u.ENVIRONMENT]=i,n[s.ENVIRONMENT]=i,this.requestURLCount-=1}else cc.log("ERROR: Not Fround Environment File")}.bind(this))}},initResource:function(){cc.log("MemoryManager start release ExtensionAdvRoot.initResource..."),d.instance.release(),this._includeStaticResource();for(var t=n.fileLoaderManager.getAdvResMap(),e=Object.keys(t),i=0;i<e.length;i++)this.requestRes(e[i],null,null);this._super()},_includeStaticResource:function(){for(var t in C.staticRes[S.SIMPLE_TEX_PATH]||this.requestRes(S.SIMPLE_TEX_PATH,cc.SpriteFrame,this._setStaticResource.bind(this,S.SIMPLE_TEX_PATH)),C.staticRes[S.LOADING_PROGRESS_TIPS_PREFAB_PATH]||this.requestRes(S.LOADING_PROGRESS_TIPS_PREFAB_PATH,cc.Prefab,this._setStaticResource.bind(this,S.LOADING_PROGRESS_TIPS_PREFAB_PATH)),C.staticRes[S.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH]||this.requestRes(S.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH,cc.AnimationClip,this._setStaticResource.bind(this,S.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH)),C.staticRes[S.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH]||this.requestRes(S.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH,cc.AnimationClip,this._setStaticResource.bind(this,S.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH)),C.staticRes[S.POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH]||this.requestRes(S.POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH,cc.AnimationClip,this._setStaticResource.bind(this,S.POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH)),S.SE)S.SE[t]&&(C.staticRes[S.SE[t]]||this.requestRes(S.SE[t],cc.AudioClip,this._setStaticResource.bind(this,S.SE[t])))},_setStaticResource:function(t){C.staticRes[t]=n.res[t]},initialize:function(){cc.log("ExtensionAdvRoot:initialize"),cc.log("MemoryManager start release ExtensionAdvRoot.initialize..."),this._super(),T.addEdgeBand(this.node),this._initLoading(1)},requestRes:function(t,e,i){if(n.res[t])return cc.log("this file is already loaded { "+t+" }"),void(i&&i());this._requestResList[t]=e,this._resourceRemainLoadCount+=1,cc.log("extensionadvroot requestRes loadFile:"+t),n.fileLoaderManager.loadFile(t,e,function(a,n){this._onLoadedRes(t,e,i,a,n)}.bind(this))},pushScene:function(t,e,i,a){if(g.isTutorialTransition(this))g.initTutorialForTransition(this);else{var s,c;if(i&&(s=JSON.stringify(i)),a&&(c=JSON.stringify(a)),e){var l=e+";"+c;n.localData[o.SCENE_TRANSITION_TARGETS].push(l)}if(t===this.getCurrentSceneName()){var u=r.getRoot();u.sceneParam=""===s||null===s||void 0===s?void 0:s,u.callSceneTargetListener(),u.callSceneStackListener()}else{var h=!1;this._changeScene(function(){h||(h=!0,cc.director.loadScene(t+".fire",function(){cc.log("MemoryManager start release extensionAdvRoot.pushscene..."),d.instance.release(),C.persistNode&&(C.persistNode.isEffecte=!0),h=!1;var t=r.getRoot();t&&(t.sceneParam=""===s||null===s||void 0===s?void 0:s,t.callSceneStackListener())}))})}}},popScene:function(t,e){if(g.isTutorialTransition(this))g.initTutorialForTransition(this);else{var i=c.getRoot(),a=C.localData[f.SCENE_TRANSITION_TARGETS].pop();if(t||!a)return i&&i.callSceneStackListener(),e?e():void 0;var n=a.split(";");if(n[0]===this.getCurrentSceneName()){if(i&&(i.callSceneTargetListener(n[1]),i.callSceneStackListener()),e)return e()}else{var o=!1;this._changeScene(function(){o||(o=!0,cc.director.loadScene(n[0]+".fire",function(){cc.log("MemoryManager start release extensionAdvRoot.popscene..."),d.instance.release(),C.persistNode&&(C.persistNode.isEffecte=!0),cc.log("popScene:loadScene\u6642\u306e\u7b2c2\u5f15\u6570",n),o=!1;var t=c.getRoot();Array.isArray(n)&&n.length>1&&("undefined"===n[1]||void 0===n[1]||null===n[1]?t.sceneParam=void 0:t.sceneParam=n[1]),t.callSceneStackListener()}))})}}},_initLoading:function(t){t>0?(this._addLoading(),this._activeLoading(),this._initLoadProgress(),this._loadCountMax=t):(this._hideLoading(),this._loadCountMax=1),this._recentRemainLoadCount=this._loadCountMax},_addLoading:function(){var t=this.getCurrentSceneName(),e=m.LOADING_TYPE[t];if(e&&!this._loadView){var i=Math.floor(Math.random()*A[e].length),a=null;C.staticRes[A[e][i]]&&(T.removeModalLayer(),this.node.active=!1,E.getResource(A[e][i])&&(a=cc.instantiate(E.getResource(A[e][i]))),a&&(this._loadView=a.getComponent("LoadSimpleView"),this.node.addChild(this._loadView.node,p.Z_ORDER.LOADING)),this.node.active=!0)}},_activeLoading:function(){this._loadView&&this._loadView.showLoading()},_hideLoading:function(){this._loadView&&this._isInitialized&&this._setDelayLoading(function(){this._loadView.hideLoading(),this._loadView=null}.bind(this))},_setDelayLoading:function(t){var e=this.getCurrentSceneName();return m.LOADING_TYPE[e]&&this._loadView?void this._loadView.setDelayLoading(t):t()},_initLoadProgress:function(){this._loadView&&this._loadView.initLoadProgress()},_setLoadProgress:function(t){this._loadView&&this._loadView.setLoadProgress(t)},_calcLoadProgress:function(t){var e=(this._loadCountMax-t)/this._loadCountMax;return e<0&&(e=0),e>100&&(e=100),e},_callbackVisibleAdvSubRoot:function(){this._isInitialized=!0,this._hideLoading()},_callbackLoadingAdvRes:function(t,e){this._setLoadProgress(t/e)},_changeScene:function(t){var e=cc.director.getScene().getChildByName("Canvas"),i=e.getChildByName("HeaderParent"),a=e.getChildByName("SideMenuParent"),n=e.getChildByName("SubRootParent"),o=!1;if(i&&i.children[0]&&(i.children[0].getComponent(cc.Animation).play("GlobalHeader_End"),o=!0),a&&a.children[0]&&(a.children[0].getComponent(cc.Animation).play("SideMenu_End"),o=!0),n){var r=n.getComponent(cc.Animation);r&&(r.play("SubRoot_End"),o=!0)}if(cc.log("MemoryManager start release extensionAdvRoot._changeScene..."),!o)return this._activeLoading(),t();cc.director.getScheduler().schedule(function(){this._activeLoading(),t()},this,.2)},_endSceneEvent:function(t,e){n.soundManager.stopAll(),cc.log("MemoryManager start release ExtensionAdvRoot._endSceneEvent..."),d.instance.release(),n.res={},cc.log("cc.loader._cache",cc.loader._cache),this._endCallFunc?this._endCallFunc(t,e):cc.director.loadScene(this.returnSceneName)}});cc._RF.pop()},{AdvLocalDataConst:"AdvLocalDataConst",AdvRoot:"AdvRoot",AdvSingleton:"AdvSingleton",AdvSingletonConst:"AdvSingletonConst",AdvStaticResourceConst:"AdvStaticResourceConst",BattleConstants:"BattleConstants",CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",Environment:"Environment",ExtensionAdvUtils:"ExtensionAdvUtils",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst",StaticResourceConst:"StaticResourceConst",TutorialUtils:"TutorialUtils",ViewUtils:"ViewUtils"}],ExtensionAdvUtils:[function(t,e,i){"use strict";cc._RF.push(e,"b1d25vP5oNIiqE39hQxN+Sf","ExtensionAdvUtils");var a=t("Singleton"),n=(t("CommonUtils"),t("PopupUtils")),o=t("ResourceUtils"),r=t("StaticResourceConst"),s=t("SingletonConst"),c=t("GameConst"),l=t("AdvUtils"),u=t("AdvSingleton"),h=(t("MemoryManager"),t("ViewUtils"));function d(t){return function(e,i){i?n.openSimpleMessageWindow("\u518d\u751f\u306b\u5931\u6557\u3057\u307e\u3057\u305f",function(){p(e,function(){t()})}):p(e,function(){t()})}}function p(t,e){var i=a.dao.userBasicData.getBattleSpeed(),n=a.dao.userBasicData.getIsSkillAuto();a.UserService.updateSetting(t.bgmVolume,t.seVolume,t.voiceVolume,t.seMute,t.bgmMute,t.voiceMute,i,n,function(){cc.log("updateSetting : \u901a\u4fe1\u5b8c\u4e86"),a.soundManager.setSoundConfig(t),a.soundManager.bgmResume(),e&&e()})}e.exports={createTutorial:function(t,e,i,n,l,p,m){p||(p=o.getResource(r.ADV_SUB_ROOT_PREFAB_PATH));var _=a.soundManager.getSoundConfig(),g=cc.instantiate(p).getComponent("AdvSubRootBase");return g.node.name="TutorialAdvSubRoot",u.fileLoaderManager=a.fileLoaderManager,u.memoryManager=a.memoryManager,u.downManifestManager=a.downManifestManager,a[s.ENVIRONMENT].getPlainDynamicFileFlg()?g.initTutorialSubRoot(n,l,_,d(m)):a.StoryService.getStoryResource([e],i,function(t){u.fileLoaderManager.setAdvResMap(t.resource),cc.log("MemoryManager start release ExtensionAdvUtils.createTutorial..."),u.memoryManager.releaseAdvRes(),g.initTutorialSubRoot(n,l,_,d(m))}),t.node.addChild(g.node,c.Z_ORDER.TUTORIAL_SUB_ROOT),h.addEdgeBand(g.node),g},startAdv:function(t,e,i,n,o,r){cc.log("MemoryManager start release ExtensionAdvUtils.startAdv..., rescount:"+Object.keys(u.res).length),a.soundManager.bgmPause(),a.soundManager.voiceStop();var s=a.soundManager.getSoundConfig();o||(o="adv/prefab/window/AdvSubRoot"),u.soundManager&&u.soundManager.bgmStop(),cc.director.loadScene("AdvScene",function(){cc.log(i),cc.director.getScene().getChildByName("Canvas").getComponent("ExtensionAdvRoot").initAdvRoot(t,e,i,n,s,o,d(r))})},getRoot:function(){var t=cc.director.getScene().getChildByName("Canvas").getComponent("AdvGameRootBase");return t||((t=cc.director.getScene().getChildByName("Canvas").getComponent("GameRootBase"))?t:(t=cc.director.getScene().getChildByName("Canvas").getComponent(cc.Canvas))||void 0)},saveLocalStorage:l.saveLocalStorage,loadLocalStorage:l.loadLocalStorage,getResource:l.getResource,getRandom:l.getRandom,getRandomForFloat:l.getRandomForFloat,setFadeIn:l.setFadeIn,setFadeOut:l.setFadeOut,setFadeOutAll:l.setFadeOutAll,createAdvTextInfo:function(t,e,i){return{storyId:t,storyFilePathName:e,synopsisFilePathName:i}}},cc._RF.pop()},{AdvSingleton:"AdvSingleton",AdvUtils:"AdvUtils",CommonUtils:"CommonUtils",GameConst:"GameConst",MemoryManager:"MemoryManager",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",StaticResourceConst:"StaticResourceConst",ViewUtils:"ViewUtils"}],FileLoaderConsts:[function(t,e,i){"use strict";cc._RF.push(e,"ccafa+Q90JBDZ5txzu+T7WN","FileLoaderConsts"),cc.Class({statics:{REMOTE_RES_URL:"http://192.168.2.104/",FILE_TYPE:cc.Enum({PNG:0,JPG:1,MP3:2,SPINE_TEX:3,ATLAS:4,JSON:5}),FIELD_AFL:"FIELD_AFL",FIELD_CALLBACK_ARR:"FIELD_CALLBACK_ARR",DOWNLOAD_GAME_ANDROID:"download_game_android/",DOWNLOAD_GAME_WEB:"",DOWNLOAD_GAME_LD:"download_game_ld/",DOWNLOAD_GAME_HD:"download_game_hd/",DOWNLOAD_GAME_ZIP:"download_game_zip/",DOWNLOAD_LD_ZIP:"download_game_ld.zip",DOWNLOAD_HD_ZIP:"download_game_hd.zip",CURRENT_ALL_RES_TYPE:"current_all_res_type",CURRENT_HD_ALL_RES_VERSION:"current_hd_all_res_version",CURRENT_LD_ALL_RES_VERSION:"current_ld_all_res_version",ALL_RES_VERSION:cc.Enum({NONE:0,ZIP:1})}}),cc._RF.pop()},{}],FileLoaderManager:[function(t,e,i){"use strict";cc._RF.push(e,"85709C42/hPVbjl5E6/i9Qx","FileLoaderManager");var a=t("AsyncFileLoader"),n=t("FileLoaderConsts"),o=t("MemoryManager"),r=t("DownManifestManager"),s=t("Singleton"),c=t("SingletonConst"),l=t("CommonUtils"),u=t("LocalDataConst"),h=t("GameConst"),d=t("GenerateMd5"),p=t("ResLoader"),m=t("ErrorCode"),_=cc.Class({properties:{loadingFilesMap:null,loadedFilesMap:null,_downloadUnitsMap:null,_downloadQueue:null,_maxConcurrentTask:2,_totalWaitToDownload:0,_progressIndex:0,_advResMap:null,hasAsyncFileError:!1,hasResLoaderError:!1},statics:{instance:null},ctor:function(){_.instance=this,this.loadingFilesMap={},this.loadedFilesMap={},this._downloadUnitsMap={},this._downloadQueue=[],this._advResMap={},this._asyncFileLoaderArray=[];for(var t=0;t<this._maxConcurrentTask;t+=1)this._asyncFileLoaderArray.push({afl:new a,isUsed:!1})},queueDowload:function(){var t=this;if(this._totalWaitToDownload=this._downloadQueue.length,0!=this._totalWaitToDownload)for(var e=function(){var e=t._downloadQueue.pop(),r=t._downloadUnitsMap[e];i=r.aiName,(a=t._asyncFileLoaderArray.find(function(t){return!t.isUsed})).isUsed=!0,t.loadingFilesMap[i][n.FIELD_AFL]=a,a.afl.setQuality(s.localData[u.RES_QUALITY]),o=t,r.isAdv?a.afl.loadAdvFileEx(r.fullName,r.filePath,r.fileMd5,function(t,e,i){o.onLoadFinishCallback(t,e,r.aiName,i)}):a.afl.loadFileEx(r.aiName,r.aiType,function(t,e,i,a){o.onLoadFinishCallback(t,e,i,a)})};this._asyncFileLoaderArray.some(function(t){return!t.isUsed})&&this._downloadQueue.length>0;){var i,a,o;e()}},retryAllFailed:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=this._asyncFileLoaderArray[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var o=a.value;o.afl.isWaitingRetry&&o.afl.retry()}}catch(t){e=!0,i=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw i}}this.hasAsyncFileError=!1},loadDirFile:function(e,i,a){var n=this,o=[],l=[],u=[];if(!s[c.ENVIRONMENT].getDebugResource()&&e.startsWith("download/")){var h=e.replace("download/","");r.instance.getManifestKeys().forEach(function(t){if(t.startsWith(h)&&-1==t.substring(h.length+1).indexOf("/")){var e=t.lastIndexOf(".");u.push(t.substr(0,e))}});var d=u.length,_=0;u.forEach(function(t){t="download/"+t,this.loadFile(t,i,function(e,i){e||(o.push(i),l.push(t)),++_==d&&(0==o.length?a("loadDirFile error",o,l):a(null,o,l))})}.bind(this))}else{p.loader.loadResDir(e,function i(o,r,l){if(o){var u=t("FileLoaderManager");if(!n.hasResLoaderError)return u.instance.hasResLoaderError=!0,s[c.ERROR_MANAGER].throwError(m.DYNAMIC_RES_ERROR,function(){u.instance.hasResLoaderError=!1,p.loader.loadResDir(e,i)})}else a(o,r,l)})}},loadFile:function(e,i,a){var o=this;if(s[c.ENVIRONMENT].getDebugResource()||!e.startsWith("download/")&&!e.startsWith("/download/")){p.loader.loadRes(e,i,function n(r,l){if(!r)return a(r,l);cc.error(r);var u=t("FileLoaderManager");return o.hasResLoaderError?void 0:(u.instance.hasResLoaderError=!0,s[c.ERROR_MANAGER].throwError(m.DYNAMIC_RES_ERROR,function(){u.instance.hasResLoaderError=!1,p.loader.loadRes(e,i,n)}))})}else{var r=e;if(null!=this.loadingFilesMap[r])return void this.loadingFilesMap[r][n.FIELD_CALLBACK_ARR].push(a);this.loadingFilesMap[r]={},this.loadingFilesMap[r][n.FIELD_CALLBACK_ARR]=[],this.loadingFilesMap[r][n.FIELD_CALLBACK_ARR].push(a);var l=!1,u=null;if(this._advResMap[r]&&(l=!0,u=this._advResMap[r]),l){var h=u.fileName,d=u.path,_=u.md5;this._downloadUnitsMap[r]={aiName:r,isAdv:!0,aiCallback:a,filePath:d,fileMd5:_,fullName:h}}else this._downloadUnitsMap[r]={aiName:e,aiType:i,isAdv:!1,aiCallback:a};this._downloadQueue.push(r),this.queueDowload()}},onLoadFinishCallback:function(t,e,i,a){for(var r=0;r<this.loadingFilesMap[i][n.FIELD_CALLBACK_ARR].length;r++){var s=this.loadingFilesMap[i][n.FIELD_CALLBACK_ARR][r];s&&s(t,e,i),t||o.instance.storeDynamicRes([i,a])}this.loadingFilesMap[i][n.FIELD_CALLBACK_ARR]=null,this.loadingFilesMap[i][n.FIELD_AFL].isUsed=!1,delete this.loadingFilesMap[i],delete this._downloadUnitsMap[i],this.queueDowload()},setAdvResMap:function(t){if(this._advResMap={},t&&t.length>0)for(var e=0;e<t.length;e++){var i=t[e].fileName;i.endsWith(".txt")&&(i=i.substring(0,i.length-4)),this._advResMap[i]=t[e]}},getAdvResMap:function(){return this._advResMap},downloadAllResoure:function(t){var e,i=l.loadLocalStorage(u.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,u.LOCAL_STORAGE_GET_TYPE.INTEGER);switch(s.localData[u.RES_QUALITY]=i,i){case h.RESOURCE_QUALITY.LOW:e=cc.sys.localStorage.getItem(n.CURRENT_LD_ALL_RES_VERSION);break;case h.RESOURCE_QUALITY.HIGH:e=cc.sys.localStorage.getItem(n.CURRENT_HD_ALL_RES_VERSION)}e==n.ALL_RES_VERSION.ZIP?this.compareMD5Download(i,t):this.startDownloadZipFile(i,t)},compareMD5Download:function(t,e){var i,o,s,c;switch(t){case h.RESOURCE_QUALITY.LOW:i=n.DOWNLOAD_GAME_ANDROID+n.DOWNLOAD_GAME_LD+"download_res_hash.manifest",o=n.DOWNLOAD_GAME_ANDROID+"ld_download_res_hash.manifest",c=n.DOWNLOAD_GAME_ANDROID+n.DOWNLOAD_GAME_LD+"version.manifest",s=n.DOWNLOAD_GAME_ANDROID+"ld_version.manifest";break;case h.RESOURCE_QUALITY.HIGH:i=n.DOWNLOAD_GAME_ANDROID+n.DOWNLOAD_GAME_HD+"download_res_hash.manifest",o=n.DOWNLOAD_GAME_ANDROID+"hd_download_res_hash.manifest",c=n.DOWNLOAD_GAME_ANDROID+n.DOWNLOAD_GAME_HD+"version.manifest",s=n.DOWNLOAD_GAME_ANDROID+"hd_version.manifest"}var l=jsb.fileUtils.getWritablePath()+i,u=jsb.fileUtils.getWritablePath()+o,d=jsb.fileUtils.getWritablePath()+c,p=jsb.fileUtils.getWritablePath()+s,m=[],_=0,g=this;function C(){if(m.length>0){var t=parseInt((_-m.length)/_*100);t>g._progressIndex&&(e(null,t-g._progressIndex),g._progressIndex=t);var i=m[0];m.splice(0,1);var n=new a;n.setIfDoLoadLogic(!1),n.loadFileExInner(i[0],i[1],null,i[2],function(){C()})}else jsb.fileUtils.removeDirectory(l),jsb.fileUtils.renameFile(u,l),jsb.fileUtils.renameFile(p,d),e(null,100)}cc.loader.load(l,function(t,i){if(t)cc.log("load zipLocalStoragePath error..."),e(null,100);else{for(var a=JSON.parse(i),n=r.instance.getManifestKeys(),o=0;o<n.length;o++){var s=r.instance.getServerFileMd5ByName(n[o]),c=a.assets[n[o]];if(c&&c.md5==s);else{var l=n[o].lastIndexOf("."),u=n[o].substr(l+1,n[o].length-1);n[o].endsWith(".atlas.txt")&&(u="atlas"),m.push([n[o],u,s])}}_=m.length,C()}})},startDownloadZipFile:function(e,i){this._progressIndex=0;var a="",o=n.DOWNLOAD_GAME_ANDROID+n.DOWNLOAD_GAME_ZIP;if(cc.sys.isNative)switch(e){case h.RESOURCE_QUALITY.LOW:a=n.DOWNLOAD_GAME_ANDROID+n.DOWNLOAD_GAME_ZIP+n.DOWNLOAD_LD_ZIP;break;case h.RESOURCE_QUALITY.HIGH:a=n.DOWNLOAD_GAME_ANDROID+n.DOWNLOAD_GAME_ZIP+n.DOWNLOAD_HD_ZIP}var r=d.instance.MD5(a),l=d.instance.getFolderPath(r)+r+".zip",p=s[c.ENVIRONMENT].getDynamicResourceUrl()+o+l,m=jsb.fileUtils.getWritablePath()+a;this.downloader||(this.downloader=new jsb.Downloader({countOfMaxProcessingTasks:6,timeoutInSeconds:5400,tempFileNameSuffix:".tmp"})),this.downloader.createDownloadFileTask(p,m),this.downloader.setOnTaskProgress(function(t,e,a,n){parseInt(a/n*100)>this._progressIndex&&this._progressIndex<99&&(i(null,1),this._progressIndex++)}.bind(this)),this.downloader.setOnFileTaskSuccess(function(t){this.decompressionZip(m,i)}.bind(this)),this.downloader.setOnTaskError(function(e,a,n,o){(cc.log("download zip failed... "),cc.log("errorStr = "+o),-1!==o.indexOf(h.SPACE_NOT_ENOUGH_ERR1)||-1!==o.indexOf(h.SPACE_NOT_ENOUGH_ERR2))?(cc.log("startDownloadZipFile:"+s.localData[u.IS_CAPACITY_FULL]),s.localData[u.IS_CAPACITY_FULL]||(s.localData[u.IS_CAPACITY_FULL]=!0,window.setIntervalId&&(clearInterval(window.setIntervalId),s.localData[u.NOW_DATETIME]=null),t("PopupUtils").openSystemPopup("\u78ba\u8a8d","\u5bb9\u91cf\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093","",!1,function(){cc.game.end()}))):i("error",0);jsb.fileUtils.removeFile(m)})},decompressionZip:function(t,e){this._progressIndex=0,e(null,-99);var i,a="",o="",r=l.loadLocalStorage(u.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,u.LOCAL_STORAGE_GET_TYPE.INTEGER);switch(s.localData[u.RES_QUALITY]=r,r){case h.RESOURCE_QUALITY.LOW:o="download_game_ld",i=n.CURRENT_LD_ALL_RES_VERSION,a=n.DOWNLOAD_GAME_LD;break;case h.RESOURCE_QUALITY.HIGH:o="download_game_hd",i=n.CURRENT_HD_ALL_RES_VERSION,a=n.DOWNLOAD_GAME_HD}var d=jsb.fileUtils.getWritablePath()+n.DOWNLOAD_GAME_ANDROID,p=s[c.ENVIRONMENT];jsb.reflection.callStaticMethod(p.getAndroidDomain()+"NativeMethod","decompressionZip","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",t,d,a);var m=this;window.resultAndroidUnZip=function(a){"0"==a?(jsb.fileUtils.removeDirectory(d+o)&&(jsb.fileUtils.renameFile(d+"temp_"+o,d+o),cc.sys.localStorage.setItem(i,n.ALL_RES_VERSION.ZIP),jsb.fileUtils.removeFile(t)),cc.log("un zip over..."),e(null,1),window.resultAndroidUnZip=null):"1"==a?m._progressIndex<99&&(m._progressIndex++,e(null,1)):(jsb.fileUtils.removeDirectory(d+"temp_"+o),jsb.fileUtils.removeFile(t),cc.log("un zip failed..."),e("error",0),window.resultAndroidUnZip=null)}}});e.exports=_,cc._RF.pop()},{AsyncFileLoader:"AsyncFileLoader",CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",ErrorCode:"ErrorCode",FileLoaderConsts:"FileLoaderConsts",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",GenerateMd5:"GenerateMd5",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",PopupUtils:"PopupUtils",ResLoader:"ResLoader",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FileLoader:[function(t,e,i){"use strict";cc._RF.push(e,"b9f005H+QRKz44g71MPPMe3","FileLoader");var a=t("WrapAsyncFileLoad"),n=cc.Class({properties:{fileList:[],loadList:[],errorCount:0,connectStartFlg:!1,retryCnt:0,loadedFiles:null},statics:{instance:null},ctor:function(){n.instance=this,this.fileList=new Array,this.loadList=new Array,this.errorCount=0,this.retryCnt=0,this.connectStartFlg=!0,this.loadedFiles=new Array},addLoadFile:function(t,e){if(void 0!==t){for(var i=0;i<this.loadList.length;i++){var n=this.loadList[i];if(0==t.compare(n.getFilepath()))return void cc.log("\u8981\u6c42\u6e08\u307f\u306e\u5834\u5408: "+t)}(n=new a).setEncodeFlg(e),n.setFilePath(t),this.loadList.push(n)}else cc.log("skipp addLoadFile:"+t)},update:function(){if(this.connectStartFlg&&!this.isError())for(var t=0,e=0;e<this.loadList.length;e++){var i=this.loadList[e];if(!i.isFinished()){if(cc.sys.platform===cc.sys.IOS){if(t>10)break;if(t>2)break}i.isConnect()?t++:(i.loadFile(),t++)}}},count:function(){return this.loadList.length},finishCount:function(){for(var t=0,e=0;e<this.loadList.length;e++){this.loadList[e].isFinished()&&t++}return t},retry:function(){for(var t=0;t<this.loadList.length;t++){var e=this.loadList[t];e.isError()&&(cc.log("retrying:"+e.filePath),e.retry())}this.errorCount=0,this.retryCnt++},isError:function(){for(var t=0;t<this.loadList.length;t++){if(this.loadList[t].isError())return!0}return!1},isFinished:function(t){var e=!0;if(void 0===t){for(var i=0;i<this.loadList.length;i++)if(!this.loadList[i].isFinished()){e=!1;break}}else e=this.getNode(t).isFinished();return e},isImage:function(t){return this.getNode(t).isImage()},isConnect:function(){for(var t=0;t<this.loadList.length;t++){if(this.loadList[t].isConnect())return!0}return!1},getNode:function(t){return this.loadList[t]},clear:function(){for(var t=0;t<this.loadList.length;t++){var e=this.loadList[t];e.abort(),e.release()}this.fileList.splice(0,this.fileList.length),this.loadList.splice(0,this.loadList.length),this.errorCount=0,this.retryCnt=0,this.connectStartFlg=!0},setConnectStartFlg:function(t){this.connectStartFlg=t},getRetryCnt:function(){return this.retryCnt},addToLoadedFiles:function(t){for(var e=0;e<this.loadedFiles.length;e++)if(this.loadedFiles[e]==t)return;this.loadedFiles.push(t)},isFileLoaded:function(t){for(var e=0;e<this.loadedFiles.length;e++)if(this.loadedFiles[e]==t)return!1;return!0},isAllLoaded:function(){for(var t=0;t<this.loadList.length;t++){var e=this.loadList[t];for(t=0;t<this.loadedFiles.length;t++)if(this.loadedFiles[t]==e.filePath)return!1}return!0}});e.exports=n,cc._RF.pop()},{WrapAsyncFileLoad:"WrapAsyncFileLoad"}],FilterPopup:[function(t,e,i){"use strict";cc._RF.push(e,"1de86xpjFZMgJcNpuyvs6CY","FilterPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{okBtn:n,checkAllBtn:n,clearAllBtn:n,checkBoxToggleArray:[cc.Toggle]},_callbackToOkBtn:null,openFilterPopup:function(t,e){this._initFilterPopup(t,e),this.open()},_initFilterPopup:function(t,e){this._setFilter(t),this._initButtons(e)},_setFilter:function(t){for(var e=0;e<this.checkBoxToggleArray.length;e++)this.checkBoxToggleArray[e].isChecked=t[e]},_initButtons:function(t){this._setCallbackToOkBtn(t),this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.checkAllBtn.setTapEvent(function(){this._checkAll(!0)}.bind(this)),this.clearAllBtn.setTapEvent(function(){this._checkAll(!1)}.bind(this),n.SE_NAME.CANCEL)},_checkAll:function(t){for(var e=0;e<this.checkBoxToggleArray.length;e+=1)this.checkBoxToggleArray[e].isChecked=t},_getCheckList:function(){for(var t=[],e=0;e<this.checkBoxToggleArray.length;e++)t[e]=this.checkBoxToggleArray[e].isChecked;return t},_setCallbackToOkBtn:function(t){this._callbackToOkBtn=t},_onTapOkBtn:function(){for(var t=[],e=0;e<this.checkBoxToggleArray.length;e+=1)t.push(this.checkBoxToggleArray[e].isChecked);this._callbackToOkBtn&&this._callbackToOkBtn(this._getCheckList()),this.close()}}),cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],FilterUtils:[function(t,e,i){"use strict";cc._RF.push(e,"51973fqfkpPNLy8t+fLia85","FilterUtils");var a=t("GameConst"),n=t("WarehouseConst"),o=t("EquipmentConst"),r={getFilterFlgByReadingNameAToS:function(t){return!!t.getReadingName()[0].match(/^[\u3042-\u305d]*$/)},getFilterFlgByReadingNameTToH:function(t){return!!t.getReadingName()[0].match(/^[\u305f-\u307b]*$/)},getFilterFlgByReadingNameMToW:function(t){return!!t.getReadingName()[0].match(/^[\u307e-\u3092]*$/)},getFilterFlgByUnionA:function(t){return t.getUnion()===a.UNION.A},getFilterFlgByUnionB:function(t){return t.getUnion()===a.UNION.B},getFilterFlgByUnionC:function(t){return t.getUnion()===a.UNION.C}},s={getFilterFlgByAttributeFire:function(t){return t.getAttribute()===a.ATTRIBUTE.FIRE},getFilterFlgByAttributeWater:function(t){return t.getAttribute()===a.ATTRIBUTE.WATER},getFilterFlgByAttributeThunder:function(t){return t.getAttribute()===a.ATTRIBUTE.THUNDER},getFilterFlgByAttributeWind:function(t){return t.getAttribute()===a.ATTRIBUTE.WIND},getFilterFlgByAttributeDark:function(t){return t.getAttribute()===a.ATTRIBUTE.DARK},getFilterFlgByAttributeLight:function(t){return t.getAttribute()===a.ATTRIBUTE.LIGHT},getFilterFlgByRarity1:function(t){return 1===t.getRarity()},getFilterFlgByRarity2:function(t){return 2===t.getRarity()},getFilterFlgByRarity3:function(t){return 3===t.getRarity()},getFilterFlgByRarity4:function(t){return 4===t.getRarity()},getFilterFlgByRarity5:function(t){return 5===t.getRarity()},getFilterFlgByFortifyMaterial:function(t){return 2===t.getCharacterType()},getFilterFlgBySkillMaterial:function(t){return 5===t.getCharacterType()},getFilterFlgBySellMaterial:function(t){return 4===t.getCharacterType()},getFilterFlgByUnit:function(t){return 1===t.getCharacterType()},getFilterFlgByMaterial:function(t){return 2===t.getCharacterType()||3===t.getCharacterType()||5===t.getCharacterType()||6===t.getCharacterType()},getFilterFlgByLevelMax:function(t){return t.getLevel()!==t.getMaxLevel()},getFilterFlgByLevel1:function(t){return 1!==t.getLevel()},getFilterFlgByExp0:function(t){return t.getCharacterExp()>0}},c={getFilterFlgByAttributeFire:function(t){return t.getAttribute()===a.ATTRIBUTE.FIRE},getFilterFlgByAttributeWater:function(t){return t.getAttribute()===a.ATTRIBUTE.WATER},getFilterFlgByAttributeThunder:function(t){return t.getAttribute()===a.ATTRIBUTE.THUNDER},getFilterFlgByAttributeWind:function(t){return t.getAttribute()===a.ATTRIBUTE.WIND},getFilterFlgByAttributeDark:function(t){return t.getAttribute()===a.ATTRIBUTE.DARK},getFilterFlgByAttributeLight:function(t){return t.getAttribute()===a.ATTRIBUTE.LIGHT},getFilterFlgByRarity1:function(t){return 1===t.getRarity()},getFilterFlgByRarity2:function(t){return 2===t.getRarity()},getFilterFlgByRarity3:function(t){return 3===t.getRarity()},getFilterFlgByRarity4:function(t){return 4===t.getRarity()}},l={getFilterFlgByAttributeFire:function(t){return t.getAttribute()===a.ATTRIBUTE.FIRE},getFilterFlgByAttributeWater:function(t){return t.getAttribute()===a.ATTRIBUTE.WATER},getFilterFlgByAttributeThunder:function(t){return t.getAttribute()===a.ATTRIBUTE.THUNDER},getFilterFlgByAttributeWind:function(t){return t.getAttribute()===a.ATTRIBUTE.WIND},getFilterFlgByAttributeDark:function(t){return t.getAttribute()===a.ATTRIBUTE.DARK},getFilterFlgByAttributeLight:function(t){return t.getAttribute()===a.ATTRIBUTE.LIGHT},getFilterFlgByRarity1:function(t){return 1===t.getRarity()},getFilterFlgByRarity2:function(t){return 2===t.getRarity()},getFilterFlgByRarity3:function(t){return 3===t.getRarity()},getFilterFlgByRarity4:function(t){return 4===t.getRarity()||5===t.getRarity()},getFilterFlgByMaterial:function(t){return!l.getFilterFlgByEquipment(t)},getFilterFlgByEquipment:function(t){return 1===t.getEquipmentType()||2===t.getEquipmentType()},getFilterFlgByLevelMax:function(t){return t.getLevel()!==t.getMaxLevel()},getFilterFlgByExp0:function(t){return t.getExp()>0},getFilterFlgByLevel1:function(t){return t.getLevel()>1}},u={getFilterFlgByAttributeFire:function(t){return t.master.getAttribute()===a.ATTRIBUTE.FIRE},getFilterFlgByAttributeWater:function(t){return t.master.getAttribute()===a.ATTRIBUTE.WATER},getFilterFlgByAttributeWind:function(t){return t.master.getAttribute()===a.ATTRIBUTE.WIND},getFilterFlgByAttributeThunder:function(t){return t.master.getAttribute()===a.ATTRIBUTE.THUNDER},getFilterFlgByAttributeDark:function(t){return t.master.getAttribute()===a.ATTRIBUTE.DARK},getFilterFlgByAttributeLight:function(t){return t.master.getAttribute()===a.ATTRIBUTE.LIGHT},getFilterFlgByRarity1:function(t){return 1===t.master.getRarity()},getFilterFlgByRarity2:function(t){return 2===t.master.getRarity()},getFilterFlgByRarity3:function(t){return 3===t.master.getRarity()},getFilterFlgByRarity4:function(t){return 4===t.master.getRarity()||5===t.master.getRarity()}},h={getFilterFlgByAttributeFire:function(t){return t.getAttribute()===a.ATTRIBUTE.FIRE},getFilterFlgByAttributeWater:function(t){return t.getAttribute()===a.ATTRIBUTE.WATER},getFilterFlgByAttributeWind:function(t){return t.getAttribute()===a.ATTRIBUTE.WIND},getFilterFlgByAttributeThunder:function(t){return t.getAttribute()===a.ATTRIBUTE.THUNDER},getFilterFlgByAttributeDark:function(t){return t.getAttribute()===a.ATTRIBUTE.DARK},getFilterFlgByAttributeLight:function(t){return t.getAttribute()===a.ATTRIBUTE.LIGHT},getFilterFlgByRarity1:function(t){return t.getRarity()===a.RARITY.N},getFilterFlgByRarity2:function(t){return t.getRarity()===a.RARITY.R},getFilterFlgByRarity3:function(t){return t.getRarity()===a.RARITY.SR},getFilterFlgByRarity4:function(t){return t.getRarity()===a.RARITY.SSR}},d={getFilterFlgByAttributeFire:function(t){return t.getAttribute()===a.ATTRIBUTE.FIRE},getFilterFlgByAttributeWater:function(t){return t.getAttribute()===a.ATTRIBUTE.WATER},getFilterFlgByAttributeWind:function(t){return t.getAttribute()===a.ATTRIBUTE.WIND},getFilterFlgByAttributeThunder:function(t){return t.getAttribute()===a.ATTRIBUTE.THUNDER},getFilterFlgByAttributeDark:function(t){return t.getAttribute()===a.ATTRIBUTE.DARK},getFilterFlgByAttributeLight:function(t){return t.getAttribute()===a.ATTRIBUTE.LIGHT},getFilterFlgByRarity1:function(t){return t.getRarity()===o.RARITY.N},getFilterFlgByRarity2:function(t){return t.getRarity()===o.RARITY.R},getFilterFlgByRarity3:function(t){return t.getRarity()===o.RARITY.SR},getFilterFlgByRarity4:function(t){return t.getRarity()===o.RARITY.SSR}},p={getFilterFlgByAttributeFire:function(t){return t.getAttribute()===a.ATTRIBUTE.FIRE},getFilterFlgByAttributeWater:function(t){return t.getAttribute()===a.ATTRIBUTE.WATER},getFilterFlgByAttributeWind:function(t){return t.getAttribute()===a.ATTRIBUTE.WIND},getFilterFlgByAttributeThunder:function(t){return t.getAttribute()===a.ATTRIBUTE.THUNDER},getFilterFlgByAttributeDark:function(t){return t.getAttribute()===a.ATTRIBUTE.DARK},getFilterFlgByAttributeLight:function(t){return t.getAttribute()===a.ATTRIBUTE.LIGHT},getFilterFlgByRarity1:function(t){return t.getRarity()===a.RARITY.N},getFilterFlgByRarity2:function(t){return t.getRarity()===a.RARITY.R},getFilterFlgByRarity3:function(t){return t.getRarity()===a.RARITY.SR},getFilterFlgByRarity4:function(t){return t.getRarity()===a.RARITY.SSR},getFilterFlgByCategoryCharacter:function(t){return t.getCategory()===n.MATERIAL_CATEGORY.CHARACTER},getFilterFlgByCategoryEquipment:function(t){return t.getCategory()===n.MATERIAL_CATEGORY.EQUIPMENT}};e.exports={CharacterGroupFilter:r,CharacterFilter:s,PictureBookDetailFilter:c,EquipmentFilter:l,WarehouseEquipmentFilter:u,WarehouseStorageCharacterFilter:h,WarehouseStorageEquipmentFilter:d,WarehouseStorageMaterialFilter:p},cc._RF.pop()},{EquipmentConst:"EquipmentConst",GameConst:"GameConst",WarehouseConst:"WarehouseConst"}],FinishedRaidBattleListView:[function(t,e,i){"use strict";cc._RF.push(e,"ebb59bp5+lH3IRgpNfXv1nr","FinishedRaidBattleListView");var a=t("RaidBattleListViewBase"),n=t("RaidConst");cc.Class({extends:a,_getBattleSessions:function(t){return t.getFinishedRaidBattleSessions()},_addThumbnailParameter:function(t,e){return t.setResult(e.finishStatus),e.finishStatus===n.RAID_FINISH_STATUS.WIN?t.setCallbackToReceiveBtn(function(){this._root.requestReceiveResult(e.sessionId)}.bind(this)):t.setCallbackToResultBtn(function(){this._root.requestReceiveResult(e.sessionId)}.bind(this)),t},_getEmptyText:function(){return"\u7d50\u679c\u3092\u78ba\u8a8d\u3067\u304d\u308b\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002"}});cc._RF.pop()},{RaidBattleListViewBase:"RaidBattleListViewBase",RaidConst:"RaidConst"}],FirstLoginAfterRoot:[function(t,e,i){"use strict";cc._RF.push(e,"08d624/VQRFMYvS65TA7n5u","FirstLoginAfterRoot");var a=t("GameRootBase"),n=t("Singleton"),o=t("PopupUtils"),r=t("FirstLoginViewSetting"),s=t("LocalDataConst"),c=t("TutorialConst");t("GameConst"),cc.Class({extends:a,properties:{firstLoginSubRootPrefab:cc.Prefab},_movieView:null,updateChild:function(t){},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,r.FIRST_LOGIN_SETTING)},initialize:function(){n.soundManager.bgmStop();this._initOpenFirstView({FirstLoginSubRoot:{}})},openMovieSkipConfirmPopup:function(t,e){o.openCommonPopupYesNo("\u30b9\u30ad\u30c3\u30d7\u78ba\u8a8d","\u52d5\u753b\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u304b\uff1f","",!1,t,e,"\u30b9\u30ad\u30c3\u30d7\u3059\u308b","\u30ad\u30e3\u30f3\u30bb\u30eb",!0)},openScenarioSkipConfirmPopup:function(){o.openCommonPopupYesNo("\u30b7\u30ca\u30ea\u30aa\u518d\u751f\u78ba\u8a8d","\u30b7\u30ca\u30ea\u30aa\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u304b\uff1f","\u30b7\u30ca\u30ea\u30aa\u306f\u3001\u753b\u9762\u53f3\u4e0a\u306e\u8a2d\u5b9a\u304b\u3089\u3044\u3064\u3067\u3082\u30b9\u30ad\u30c3\u30d7\u53ef\u80fd\u3067\u3059\u3002",!0,this._onTapScenarioSkip.bind(this),this._onTapScenarioPlay.bind(this),"\u30b9\u30ad\u30c3\u30d7\u3059\u308b","\u518d\u751f\u3059\u308b",!0)},requestUpdateTutorialStep:function(t,e){n.TutorialService.updateTutorialStep(t,this._transitionNextTutorialScene.bind(this,e))},_transitionNextTutorialScene:function(t){n.localData[s.TUTORIAL_SUB_STEP]=c.SUB_STEP_DISABLE,this.pushScene(t)},_onTapScenarioSkip:function(){this.requestUpdateTutorialStep(3,"AdvScene")},_onTapScenarioPlay:function(){this.requestUpdateTutorialStep(2,"QuestScene")}});cc._RF.pop()},{FirstLoginViewSetting:"FirstLoginViewSetting",GameConst:"GameConst",GameRootBase:"GameRootBase",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",Singleton:"Singleton",TutorialConst:"TutorialConst"}],FirstLoginRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"b268bJaW49Nw4iX5WXgtFqt","FirstLoginRootUtils"),e.exports={openFirstLoginSubRoot:function(t,e){cc.log("openFirstLoginSubRoot"),cc.log(e),t.firstLoginSubRoot||(t.firstLoginSubRoot=cc.instantiate(t.firstLoginSubRootPrefab).getComponent("FirstLoginSubRoot"),t.firstLoginSubRoot.initFirstLoginSubRoot(t),t.node.addChild(t.firstLoginSubRoot.node))},closeFirstLoginSubRoot:function(t,e){cc.log("closeFirstLoginSubRoot"),cc.log(e),t.firstLoginSubRoot&&(t.firstLoginSubRoot.node.destroy(),t.firstLoginSubRoot=null)}},cc._RF.pop()},{}],FirstLoginRoot:[function(t,e,i){"use strict";cc._RF.push(e,"2babav7CqNHd7H4maX6yA0d","FirstLoginRoot");var a=t("GameRootBase"),n=t("Singleton"),o=t("PopupUtils"),r=t("CommonUtils"),s=(t("FirstLoginViewSetting"),t("LocalDataConst")),c=(t("GameConst"),t("TutorialUtils"));cc.Class({extends:a,properties:{allResourceDownloadConfirmPopupPrefab:cc.Prefab},initialize:function(){n.soundManager.bgmStop(),c.isTutorialEnded()?this._openAllResourceDownloadConfirmPopup():this.openUserRenamePopup()},updateChild:function(t){},openUserRenamePopup:function(){o.openUserRenamePopup(this._onExecuteUserRename.bind(this),this._onCloseUserRenamePopup.bind(this),!0)},_openAllResourceDownloadConfirmPopup:function(){if(cc.sys.isNative){var t=cc.instantiate(this.allResourceDownloadConfirmPopupPrefab).getComponent("AllResourceDownloadConfirmPopup"),e=r.loadLocalStorage(s.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,s.LOCAL_STORAGE_GET_TYPE.INTEGER);n.localData[s.RES_QUALITY]=e,t.openAllResourceDownloadConfirmPopup(e,this._onConfirmAllResourceDownload.bind(this),this._onCancelAllResourceDownload.bind(this))}else this._onCancelAllResourceDownload()},_onConfirmAllResourceDownload:function(){n.localData[s.IS_CAPACITY_FULL]?o.openCommonPopupOk("\u78ba\u8a8d","\u5bb9\u91cf\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093","",!1,function(){this.pushScene("ResourceDownloadScene")}.bind(this)):this.pushScene("ResourceDownloadScene")},_onCancelAllResourceDownload:function(){this.pushScene("ResourceDownloadScene")},_onExecuteUserRename:function(){this._openAllResourceDownloadConfirmPopup()},_onCloseUserRenamePopup:function(){}});cc._RF.pop()},{CommonUtils:"CommonUtils",FirstLoginViewSetting:"FirstLoginViewSetting",GameConst:"GameConst",GameRootBase:"GameRootBase",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",Singleton:"Singleton",TutorialUtils:"TutorialUtils"}],FirstLoginSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"91685qCgqJNnYcLcoeXpcQV","FirstLoginSubRoot");t("PopupUtils");var a=t("Singleton"),n=t("SingletonConst"),o=t("MovieController"),r=t("LocalDataConst"),s=t("CommonUtils"),c=t("GameConst");cc.Class({extends:cc.Component,properties:{movieCtrl:o,movieCtrlR:o},_root:null,_movieCtrl:null,onLoad:function(){(this.movieCtrl.node.active=!1,this.movieCtrlR.node.active=!1,a[n.ENVIRONMENT]&&a[n.ENVIRONMENT].getAdultFlg()?(this._movieCtrl=this.movieCtrlR,this.movieCtrlR.node.active=!0):(this._movieCtrl=this.movieCtrl,this.movieCtrl.node.active=!0),this._movieCtrl.setTapEvent(this._onTapMovie.bind(this)),this._movieCtrl.setCompleteListener(this._onEndMovie.bind(this)),cc.sys.isBrowser&&cc.sys.isMobile)?this._onEndMovie(this._movieCtrl,null):s.loadLocalStorage(r.LOCAL_STORAGE_KEY.ALL_RES_POP_TYPE,1,r.LOCAL_STORAGE_GET_TYPE.INTEGER)==c.ALL_RES_POP_TYPE.POP&&this._onEndMovie(this._movieCtrl,null)},initFirstLoginSubRoot:function(t){this._root=t},_onTapMovie:function(t,e){e.isPlaying()&&(t.pauseVideo(),this._root.openMovieSkipConfirmPopup(this._onTapMovieSkip.bind(this,t,e),this._onTapMovieResume.bind(this,t,e)))},_onTapMovieSkip:function(t,e){this._onEndMovie(t,e)},_onTapMovieResume:function(t,e){t.resumeVideo()},_onEndMovie:function(t,e){t.removeVideo(),t.node.destroy(),this._root.openScenarioSkipConfirmPopup()}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MovieController:"MovieController",PopupUtils:"PopupUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FirstLoginViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"6920bJrI75D+ad079eHvXy+","FirstLoginViewSetting");var a=t("FirstLoginRootUtils");e.exports={FIRST_LOGIN_SETTING:{FirstLoginSubRoot:{open:a.openFirstLoginSubRoot,close:a.closeFirstLoginSubRoot}}},cc._RF.pop()},{FirstLoginRootUtils:"FirstLoginRootUtils"}],FixedTimeScheduler:[function(t,e,i){"use strict";cc._RF.push(e,"83db08ZPztHoJkbnX/RCxMs","FixedTimeScheduler"),cc.Class({ctor:function(){this._tasks=[]},start:function(){cc.director.getScheduler().scheduleUpdateForTarget(this,0,!1)},stop:function(t){cc.director.getScheduler().scheduleUpdateForTarget(this,0,!1),t&&(this._tasks=[])},update:function(){var t,e,i,a=Date.now(),n=[];for(t=0;t<this._tasks.length;t+=1)a>=(e=this._tasks[t]).expires&&n.push(e);for(n.sort(this._compareByExpiry),t=0;t<n.length;t+=1)null!==(i=(e=n[t]).func)&&(e.isInterval?e.expires=a+e.delay:e.func=null,i());for(t=0;t<this._tasks.length;t+=1)(e=this._tasks[t]).func||(this._tasks.splice(t,1),t-=1)},setTimeout:function(t,e){return this._setTask(t,e,!1)},setInterval:function(t,e){return this._setTask(t,e,!0)},_setTask:function(t,e,i){if("function"!=typeof t||"number"!=typeof e||e<=0)return-1;var a=this._uniqueId;return this._uniqueId+=1,this._tasks.push({id:a,func:t,isInterval:i,delay:e,expires:Date.now()+e}),a},clearTimeout:function(t){var e;if("number"==typeof t)for(e=0;e<this._tasks.length;e+=1)if(this._tasks[e].id===t){this._tasks.splice(e,1);break}},clearInterval:function(t){this.clearTimeout(t)},_compareByExpiry:function(t,e){return t.expires-e.expires}}),cc._RF.pop()},{}],FriendshipItemThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"f330ahxkNZHNpJA00baGXzT","FriendshipItemThumbnail");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{effectValueNumLabel:cc.Label,countNumLabel:cc.Label,mainImageSprite:cc.Sprite,grayImageSprite:cc.Sprite,thumbnailBtn:a},_callbackToThumbnail:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this))},initFriendshipItemThumbnail:function(t,e,i){n.addSprite(this.mainImageSprite,t),n.addSprite(this.grayImageSprite,t),this.effectValueNumLabel.string=e,this.countNumLabel.string=i},setCallbackToThumbnailBtn:function(t){this._callbackToThumbnail=t},setActive:function(t){this.grayImageSprite.node.active=!t},_onTapThumbnailBtn:function(){this._callbackToThumbnail&&this._callbackToThumbnail()}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],FurnitureCategoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"8dcc24AKehAZL54YIu3jH20","FurnitureCategoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getFurnitureCategory:function(){if(this._isKeyFieldAvailable("furnitureCategory"))return this._data.furnitureCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureCategory")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FurnitureCollectModel:[function(t,e,i){"use strict";cc._RF.push(e,"2f6c88qyP9Ph48vVf76Wyq7","FurnitureCollectModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")},getRewardId:function(){if(this._isKeyFieldAvailable("rewardId"))return this._data.rewardId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FurnitureCostModel:[function(t,e,i){"use strict";cc._RF.push(e,"ab024CIeYhHQ7Ab45EKrdDl","FurnitureCostModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCostCount:function(){if(this._isKeyFieldAvailable("costCount"))return this._data.costCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount")},getCostId:function(){if(this._isKeyFieldAvailable("costId"))return this._data.costId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId")},getFurnitureId:function(){if(this._isKeyFieldAvailable("furnitureId"))return this._data.furnitureId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureId")},getCostType:function(){if(this._isKeyFieldAvailable("costType"))return this._data.costType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FurnitureMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"bdafbHEgalBi5WUC7UubeHj","FurnitureMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getFurnitureId:function(){if(this._isKeyFieldAvailable("furnitureId"))return this._data.furnitureId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureId")},getFurnitureCategory:function(){if(this._isKeyFieldAvailable("furnitureCategory"))return this._data.furnitureCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureCategory")},getFurnitureType:function(){if(this._isKeyFieldAvailable("furnitureType"))return this._data.furnitureType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureType")},getMapCategory:function(){if(this._isKeyFieldAvailable("mapCategory"))return this._data.mapCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: mapCategory")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getDescription:function(){if(this._isKeyFieldAvailable("description"))return this._data.description;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: description")},getSpineName:function(){if(this._isKeyFieldAvailable("spineName"))return this._data.spineName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: spineName")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getMaxCount:function(){if(this._isKeyFieldAvailable("maxCount"))return this._data.maxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCount")},getSizeX:function(){if(this._isKeyFieldAvailable("sizeX"))return this._data.sizeX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sizeX")},getSizeY:function(){if(this._isKeyFieldAvailable("sizeY"))return this._data.sizeY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sizeY")},getSizeZ:function(){if(this._isKeyFieldAvailable("sizeZ"))return this._data.sizeZ;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sizeZ")},getAnchorX:function(){if(this._isKeyFieldAvailable("anchorX"))return this._data.anchorX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: anchorX")},getAnchorY:function(){if(this._isKeyFieldAvailable("anchorY"))return this._data.anchorY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: anchorY")},getCharacterAnimation:function(){if(this._isKeyFieldAvailable("characterAnimation"))return this._data.characterAnimation;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterAnimation")},getFurnitureAnimation:function(){if(this._isKeyFieldAvailable("furnitureAnimation"))return this._data.furnitureAnimation;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureAnimation")},getAnimationPositionX:function(){if(this._isKeyFieldAvailable("animationPositionX"))return this._data.animationPositionX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: animationPositionX")},getAnimationPositionY:function(){if(this._isKeyFieldAvailable("animationPositionY"))return this._data.animationPositionY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: animationPositionY")},getCollectTime:function(){if(this._isKeyFieldAvailable("collectTime"))return this._data.collectTime;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: collectTime")},getRewardId:function(){if(this._isKeyFieldAvailable("rewardId"))return this._data.rewardId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FurnitureModel:[function(t,e,i){"use strict";cc._RF.push(e,"f7e8fXiecBF7YOrEbuySJk0","FurnitureModel");var a=t("UserFurnitureModel"),n=t("Singleton");t("StoryUtils"),cc.Class({userData:void 0,_furnitureMainMaster:void 0,_furnitureCostMaster:void 0,_furnitureCategoryMaster:void 0,_furnitureTypeMaster:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._furnitureMainMaster=null,this._furnitureCostMaster=null,this._furnitureCategoryMaster=null,this._furnitureTypeMaster=null},getFurnitureMainMaster:function(){return this._furnitureMainMaster||(this._furnitureMainMaster=n.dao.FurnitureMainMasters.find(function(t){return t.getFurnitureId()===this.userData.getFurnitureId()}.bind(this))),this._furnitureMainMaster},getFurnitureCostMaster:function(){return this._furnitureCostMaster||(this._furnitureCostMaster=n.dao.FurnitureCostMasters.find(function(t){return t.getFurnitureId()===this.userData.getFurnitureId()}.bind(this))),this._furnitureCostMaster},getFurnitureCategoryMaster:function(){if(!this._furnitureCategoryMaster)return this._furnitureCategoryMaster=n.dao.FurnitureCategoryMasters.find(function(t){return t.getFurnitureCategory()===this.getFurnitureMainMaster().getFurnitureCategory()}.bind(this)),this._furnitureCategoryMaster},getFurnitureTypeMaster:function(){if(!this._furnitureTypeMaster)return this._furnitureTypeMaster=n.dao.FurnitureTypeMasters.find(function(t){return t.getFurnitureType()===this.getFurnitureMainMaster().getFurnitureType()}.bind(this)),this._furnitureTypeMaster},getFurnitureName:function(){return this.getFurnitureMainMaster().getName()},getFurnitureDescription:function(){return this.getFurnitureMainMaster().getDescription()},getFurnitureId:function(){return this.userData.getFurnitureId()},getFurnitureCd:function(){return this.userData.getFurnitureCd()},getIsBuyFurniture:function(){return this.userData.getIsBuyFurniture()},getFurnitureCategory:function(){return this._furnitureMainMaster||(this._furnitureMainMaster=n.dao.FurnitureMainMasters.find(function(t){return t.getFurnitureId()===this.userData.getFurnitureId()}.bind(this))),this._furnitureMainMaster.getFurnitureCategory()},getFurnitureType:function(){return this.getFurnitureMainMaster().getFurnitureType()},getMapCategory:function(){return this._furnitureMainMaster||(this._furnitureMainMaster=n.dao.FurnitureMainMasters.find(function(t){return t.getFurnitureId()===this.userData.getFurnitureId()}.bind(this))),this._furnitureMainMaster.getMapCategory()},getAnimationPosition:function(){return cc.v2(this.getFurnitureMainMaster().getAnimationPositionX(),this.getFurnitureMainMaster().getAnimationPositionY())},getMaxCount:function(){return this.getFurnitureMainMaster().getMaxCount()},getFurnitureSize:function(){return{x:this.getFurnitureMainMaster().getSizeX(),y:this.getFurnitureMainMaster().getSizeY(),z:this.getFurnitureMainMaster().getSizeZ()}},getFurnitureAnchor:function(){var t=this.getFurnitureMainMaster().getAnchorX(),e=this.getFurnitureMainMaster().getAnchorY();return cc.v2(t,e)},isRoomFurniture:function(){return n.dao.userRoom.getRoomFurnitureList().find(function(t){return t.getFurnitureCd()===this.getFurnitureCd()}.bind(this))},getFurnitureCategoryName:function(){return this.getFurnitureCategoryMaster().getName()},getFurnitureTypeName:function(){return this.getFurnitureTypeMaster().getName()},getFurnitureAnimationName:function(){return this.getFurnitureMainMaster().getFurnitureAnimation()},getCharacterAnimationName:function(){return this.getFurnitureMainMaster().getCharacterAnimation()},getCollectTime:function(){return this.getFurnitureMainMaster().getCollectTime()}});cc._RF.pop()},{Singleton:"Singleton",StoryUtils:"StoryUtils",UserFurnitureModel:"UserFurnitureModel"}],FurnitureStoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"bc4418DaY9H2qzezyIiybEU","FurnitureStoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getTitle:function(){if(this._isKeyFieldAvailable("title"))return this._data.title;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: title")},getFurnitureId:function(){if(this._isKeyFieldAvailable("furnitureId"))return this._data.furnitureId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FurnitureTypeModel:[function(t,e,i){"use strict";cc._RF.push(e,"fe7b3xXuVdBT70c4SwjHZGV","FurnitureTypeModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getFurnitureType:function(){if(this._isKeyFieldAvailable("furnitureType"))return this._data.furnitureType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureType")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],FurnitureUtils:[function(t,e,i){"use strict";cc._RF.push(e,"08e79Z0/idA4omnnDawwn8q","FurnitureUtils");var a=t("Singleton");function n(t){t=Array.isArray(t)?t:a.dao.FurnitureMainMasters;var e={};for(var i in t){var n=t[i],o=n.getMapCategory();e[o]||(e[o]=[]),e[o].push(n)}return e}function o(t,e){var i=t.getFurnitureId(),n=c(i),o=a.dao.userRoom.getRoomFurnitureList().filter(function(t){return t.getFurnitureId()===i}),r=e.filter(function(t){return t.getIsBuyFurniture()});return{furnitureId:i,furnitureMainModel:t,furnitureCostMaster:n,userFurnitureModelArray:e,userBuyFurnitureModelArray:r,roomFurnitureModelArray:o}}function r(t,e){return e||(e=a.dao.userFurniture),e.filter(function(e){return e.getFurnitureId()===t})}function s(t){return a.dao.userFurniture.filter(function(e){return e.getMapCategory()===t})}function c(t){return a.dao.FurnitureCostMasters.find(function(e){return e.getFurnitureId()===t})}e.exports={createFurnitureInfo:o,createMasterFurnitureMap:n,createAllFurnitureMap:function(){var t=n(),e={};for(var i in t){var a=parseInt(i),c=s(a);for(var l in e[a]||(e[a]=[]),t[i]){var u=t[i][l],h=o(u,r(u.getFurnitureId(),c.slice()));e[a].push(h)}}return e},createUserFurnitureMap:function(){var t=n(),e={};for(var i in t){var a=parseInt(i),c=s(a);for(var l in e[a]||(e[a]=[]),t[i]){var u=t[i][l],h=r(u.getFurnitureId(),c.slice());if(h.length>0){var d=o(u,h);e[a].push(d)}}}return e},createShopFurnitureMap:function(t){var e=n(t),i={};for(var a in e){var c=parseInt(a),l=s(c);for(var u in i[c]||(i[c]=[]),e[a]){var h=e[a][u];if(0===h.getEventId()){var d=o(h,r(h.getFurnitureId(),l.slice()));i[c].push(d)}}}return i},getUserFurnitureModelArrayByFurnitureId:r,getFurnitureCostMaster:c,getFurnitureMainMasterByFurnitureId:function(t){return a.dao.FurnitureMainMasters.find(function(e){return e.getFurnitureId()===t})}},cc._RF.pop()},{Singleton:"Singleton"}],GachaAnimationCharacterDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"da4f4LyjkJB+p39bKUQ++lx","GachaAnimationCharacterDetailPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("PromoteCharacterDetailPopupStatusView");cc.Class({extends:a,properties:{characterNameLabel:cc.Label,characterSkinNameLabel:cc.Label,characterLevelLabel:cc.Label,attributeIconImageSprite:cc.Sprite,rarityIconImageSprite:cc.Sprite,natureIconImageSprite:cc.Sprite,characterImageSprite:cc.Sprite,promoteCharacterDetailPopupStatusView:r,okBtn:n},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openGachaAnimationCharacterDetailPopup:function(t,e,i){var a=i?i.getLevel():1;this._initLabels(e,a),this._initSprites(e),this.promoteCharacterDetailPopupStatusView.initPromoteCharacterDetailStatusView(t,e,i),this.open()},_initLabels:function(t,e){this.characterNameLabel.string=t.getShortName(),this.characterSkinNameLabel.string="["+t.getSkinName()+"]",this.characterLevelLabel.string=""+e},_initSprites:function(t){o.addSprite(this.rarityIconImageSprite,o.getFileNameRarityStrIcon(t.getRarity())),o.addSprite(this.attributeIconImageSprite,o.getFileNameAttributeIcon(t.getAttribute())),o.addSprite(this.characterImageSprite,o.getFileNameCharacterMainMid(t.getCharacterId()))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",PromoteCharacterDetailPopupStatusView:"PromoteCharacterDetailPopupStatusView",ResourceUtils:"ResourceUtils"}],GachaAnimationConst:[function(t,e,i){"use strict";cc._RF.push(e,"713ac9+d/FMFaYm4rxXVtHy","GachaAnimationConst");cc.Class({statics:{ANIM_NAME:{START:{START:"start",IDLE:"idle",BLUE:"blue",YELLOW:"yellow",RED:"red"},ANOTHER_WORLD:{START:"start",LOOP:"loop"},CARD:{START_BLUE:"startBlue",START_YELLOW:"startYellow",START_RED:"startRed",IDLE_BLUE:"idleBlue",IDLE_YELLOW:"idleYellow",IDLE_RED:"idleRed",PROMOTE_B_TO_Y:"promoteBtoY",PROMOTE_B_TO_R:"promoteBtoR",PROMOTE_Y_TO_R:"promoteYtoR",OPEN_BLUE:"openBlue",OPEN_YELLOW:"openYellow",OPEN_RED:"openRed",END_SECOND:"end_second",WHITE_IN:"white_in",WHITE_OUT:"white_out"},HOME:"home",SKILL:"animation"},RARITY_TO_ANIM_COLOR_NAME:{0:"blue",1:"blue",2:"blue",3:"yellow",4:"red",5:"red"},ANIM_COLOR_NAME:{BLUE:"blue",YELLOW:"yellow",RED:"red"},PROMOTE_RARITY_RATE:100,CARD_CONTENT_SIZE:{W:256,H:144},GACHA_SOUND:{SE_GACHA_001:"se_gacha_001",SE_GACHA_002:"se_gacha_002",SE_GACHA_003:"se_gacha_003",SE_GACHA_004:"se_gacha_004",SE_GACHA_005:"se_gacha_005",SE_GACHA_006:"se_gacha_006",SE_GACHA_007:"se_gacha_007",SE_GACHA_008:"se_gacha_008",SE_GACHA_009:"se_gacha_009",SE_GACHA_010:"se_gacha_010",SE_GACHA_011:"se_gacha_011",SE_GACHA_012:"se_gacha_012",SE_GACHA_013:"se_gacha_013",SE_GACHA_014:"se_gacha_014",SE_GACHA_015:"se_gacha_015"},CHARACTER_HOME_SPINE_BGM_RATE:.5}});cc._RF.pop()},{}],GachaAnimationRollView:[function(t,e,i){"use strict";cc._RF.push(e,"52650Md79hGnbndE4gT63Cc","GachaAnimationRollView");var a=t("LoopRollView");cc.Class({extends:a,properties:{subsequentScale:.75,centerScale:1,circleRadius:cc.Vec2},_circleRadius:null,_diffAngle:0,_currentIndex:0,_currentDiffAngle:0,_contentNodeArray:null,_callbackToSwitchContent:null,onLoad:function(){},initCircleRollView:function(){this.initBase(),this._circleRadius=cc.v2(1,1),this._contentNodeArray=[];for(var t=0;t<this.content.childrenCount;t++)this._contentNodeArray.push(this.content.children[t]);this._adjustDiffSpace(),this._currentIndex=0,this._currentDiffAngle=0,this._drawContentByIndex(!1),this._calcRadius()},addContent:function(t){t.isChildOf(this.content)||(this.content.addChild(t),this._contentNodeArray.push(t),this._addContentEvent(t),this._adjustDiffSpace())},_calcRadius:function(){this._circleRadius.x=Math.max(this.circleRadius.x,this._circleRadius.x),this._circleRadius.y=Math.max(this.circleRadius.y,this._circleRadius.y)},update:function(t){if(0!==this._currentDiffAngle){var e=.07*this._diffAngle;this._currentDiffAngle>0?(this._currentDiffAngle-=e,this._currentDiffAngle<0&&(this._currentDiffAngle=0)):this._currentDiffAngle<0&&(this._currentDiffAngle+=e,this._currentDiffAngle>0&&(this._currentDiffAngle=0));for(var i=0;i<this._contentNodeArray.length;i++){var a=this._diffAngle*i+270-this._diffAngle*this._currentIndex;for(a+=this._currentDiffAngle;a<0;)a+=360;a%=360,this._setContentNodeProperties(i,this._contentNodeArray[i],a,!1)}}},redraw:function(){this._drawContentByIndex(!1)},getSelectedNo:function(){return this._currentIndex},setSelectedNo:function(t){this._currentIndex=t},setCallbackToSwitchContent:function(t){this._callbackToSwitchContent=t},moveToRight:function(){this._currentIndex++,this._currentIndex=this._currentIndex%this.content.childrenCount,this._currentDiffAngle+=this._diffAngle,this._drawContentByIndex(!0)},getCircleRadius:function(){return this._circleRadius},_adjustDiffSpace:function(){this._contentNodeArray.length>0?this._diffAngle=360/this._contentNodeArray.length:this._diffAngle=360},_adjustContent:function(){var t=this._contentNodeArray[0];this._currentIndex=0;for(var e=0;e<this._contentNodeArray.length;e++){Math.abs(t.rollPosition-270)>Math.abs(this._contentNodeArray[e].rollPosition-270)&&(t=this._contentNodeArray[e],this._currentIndex=e)}},_switchContentEvent:function(){this._recentCenterContent!==this._currentCenterContent&&this._callbackToSwitchContent&&this._callbackToSwitchContent(this._currentCenterContent,this._currentIndex)},_drawContentByIndex:function(t){for(var e=0;e<this._contentNodeArray.length;e++){for(var i=this._diffAngle*e+270-this._diffAngle*this._currentIndex;i<0;)i+=360;i%=360,this._setContentNodeProperties(e,this._contentNodeArray[e],i,t)}this._recentCenterContent=null,this._currentCenterContent=this._contentNodeArray[this._currentIndex],this._switchContentEvent()},_drawContentByPosition:function(t){if(!(this.content.childrenCount<=1)){this._recentCenterContent=this._currentCenterContent;var e=t.x;e/=this._contentNodeArray.length;for(var i=0;i<this._contentNodeArray.length;i++){var a=this._contentNodeArray[i],n=a.rollPosition;for(n+=e;n<0;)n+=360;n%=360,(!this._currentCenterContent||a.scale>this._currentCenterContent.scale)&&(this._currentCenterContent=a,this._currentIndex=i),this._setContentNodeProperties(i,a,n,!1)}this._switchContentEvent()}},_setContentNodeProperties:function(t,e,i,a){e.rollPosition=i;var n=this._circleRadius.x*Math.cos(i*(Math.PI/180)),o=this._circleRadius.y*Math.sin(i*(Math.PI/180)),r=this._getDiffIdx(t),s=this._createNodeProperties(n,o,r);if(e.zIndex=s.zIndex,a){if(0!==this._currentDiffAngle)return;e.stopAllActions(),e.runAction(cc.moveTo(.2,cc.v2(n,o))),e.runAction(cc.scaleTo(.2,s.scale))}else e.setPosition(cc.v2(n,o)),e.scale=s.scale},_createNodeProperties:function(t,e,i){var a=255-i,n=this.node.getPosition().y-this._circleRadius.y,o=this.node.getPosition().y+this._circleRadius.y,r=this.centerScale,s=this.subsequentScale,c=Math.abs(o-n)+1,l=s+(r-s)*((Math.abs(o-e)+1)/c);return{zIndex:a,scale:l=l>1?1:l}},_getDiffIdx:function(t){var e=.5*this._contentNodeArray.length,i=Math.abs(this._currentIndex-t);return i>e?this._contentNodeArray.length-i:i},_convertIdxToPosition:function(t){var e=this._diffAngle*t+270,i=this._circleRadius.x*Math.cos(e*(Math.PI/180)),a=this._circleRadius.y*Math.sin(e*(Math.PI/180));return cc.v2(i,a)}});cc._RF.pop()},{LoopRollView:"LoopRollView"}],GachaAnimationRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"65316aSzMBM7KjpMrFoC29C","GachaAnimationRootUtils");var a=t("GachaAnimationSubRoot");e.exports={openGachaAnimationSubRoot:function(t,e){cc.log("openGachaAnimationSubRoot"),cc.log(e),t._gachaType=e.gachaType,t._gachaPlayCardData=e.gachaPlayCardData,t._gachaAnimationSubRoot=cc.instantiate(t.gachaAnimationSubRootPrefab).getComponent(a),t._gachaAnimationSubRoot.initGachaAnimationSubRoot(t),t.subRootParent.addChild(t._gachaAnimationSubRoot.node)},closeGachaAnimationSubRoot:function(t,e){cc.log("closeGachaAnimationSubRoot"),cc.log(e),null!==t._gachaAnimationSubRoot&&(t._gachaAnimationSubRoot.node.destroy(),t._gachaAnimationSubRoot=null)}},cc._RF.pop()},{GachaAnimationSubRoot:"GachaAnimationSubRoot"}],GachaAnimationRoot:[function(t,e,i){"use strict";cc._RF.push(e,"30029zHLoJMTaIxm5c1bi0K","GachaAnimationRoot");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("PopupUtils"),r=(t("GachaAnimationSubRoot"),t("GachaAnimationViewSetting"));cc.Class({extends:a,properties:{gachaAnimationSubRootPrefab:cc.Prefab,gachaAnimationCharacterDetailPopupPrefab:cc.Prefab},_gachaType:0,_gachaAnimationSubRoot:null,_gachaPlayCardData:void 0,_gachaAnimationCharacterDetailPopup:null,onLoad:function(){this._setErrorHandling(),this._addBand()},initResource:function(){},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,r.GACHAANIMATION_SETTING)},initialize:function(){this.initOutGameRootBase();this._initOpenFirstView({})},transitionGachaRoot:function(){this.popScene()},transitionGachaLoadingRoot:function(){var t={gachaType:this.getGachaType(),buttonData:this._gachaPlayCardData.afterButtonData};this.pushScene("GachaLoadingScene",void 0,t,void 0,!0)},getGachaType:function(){return this._gachaType},getGachaPlayCardData:function(){return this._gachaPlayCardData},openGachaAnimationCharacterDetailPopup:function(t,e){this.closeGachaAnimationCharacterDetailPopup(),this._gachaAnimationCharacterDetailPopup=cc.instantiate(this.gachaAnimationCharacterDetailPopupPrefab).getComponent("GachaAnimationCharacterDetailPopup"),this._gachaAnimationCharacterDetailPopup.openGachaAnimationCharacterDetailPopup(this,t,e)},closeGachaAnimationCharacterDetailPopup:function(){this._gachaAnimationCharacterDetailPopup&&(this._gachaAnimationCharacterDetailPopup.close(),this._gachaAnimationCharacterDetailPopup=null)},replay:function(){var t={gachaType:this.getGachaType(),isReplay:!0,buttonData:this._gachaPlayCardData.afterButtonData};this.pushScene("GachaLoadingScene",void 0,t,void 0,!0)},decide:function(){n.GachaService.decide(function(t){t?this.popScene():o.openCommonPopupOk("","\u78ba\u5b9a\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f","",!1,function(){this.popScene()}.bind(this))}.bind(this))}});cc._RF.pop()},{GachaAnimationSubRoot:"GachaAnimationSubRoot",GachaAnimationViewSetting:"GachaAnimationViewSetting",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",Singleton:"Singleton"}],GachaAnimationSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"fb7244b761PUI9nKnwBb9nl","GachaAnimationSubRoot"),cc.Class({extends:cc.Component,properties:{gachaAnimationViewPrefab:cc.Prefab},_root:null,initGachaAnimationSubRoot:function(t){this._root=t;var e=cc.instantiate(this.gachaAnimationViewPrefab).getComponent("GachaAnimationView");e.initGachaAnimationView(t),this.node.addChild(e.node)}}),cc._RF.pop()},{}],GachaAnimationViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"27fa94QrilNFqCRXlq1EoPK","GachaAnimationViewSetting");var a=t("GachaAnimationRootUtils");e.exports={GACHAANIMATION_SETTING:{GachaAnimationSubRoot:{open:a.openGachaAnimationSubRoot,close:a.closeGachaAnimationSubRoot}}},cc._RF.pop()},{GachaAnimationRootUtils:"GachaAnimationRootUtils"}],GachaAnimationView:[function(t,e,i){"use strict";cc._RF.push(e,"2584eAueGNMPpobItGNeAEj","GachaAnimationView");var a=t("GachaAnimationConst"),n=t("CommonButton"),o=t("GachaAnimationRollView"),r=t("Async"),s=t("Singleton"),c=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{gachaCardThumbnailPrefab:cc.Prefab,gachaStartSkeleton:sp.Skeleton,gachaAnotherWorldSkeleton:sp.Skeleton,gachaFullScreenTapBtn:n,gachaSkipBtn:n,circleRollView:o,gachaResultCardViewPrefab:cc.Prefab,gachaFadeNode:cc.Node},_root:null,_gachaPlayCardData:void 0,_cardThumbnailArray:null,_gachaBaseAnimTasks:null,_gachaCardAnimTasks:null,_gachaNewCardAnimTasks:null,_isSkipMode:!1,_se002ObjectId:0,_se008ObjectId:0,_isTapEventProtect:!1,initGachaAnimationView:function(t){this._root=t,this._gachaPlayCardData=this._root._gachaPlayCardData,this._isSkipMode=!1,this._initAnimation(),this._initButton(),this._initCircleRollView(),this._initGachaCardAnimTasks(),this._initGachaNewCardAnimTasks(),this._initGachaStartBaseAnimTasks()},_initAnimation:function(){this.gachaStartSkeleton.node.active=!1,this.gachaStartSkeleton.defaultAnimation=a.ANIM_NAME.START.START,this.gachaAnotherWorldSkeleton.node.active=!1,this.gachaAnotherWorldSkeleton.defaultAnimation=a.ANIM_NAME.ANOTHER_WORLD.START},_initButton:function(){this.gachaFullScreenTapBtn.node.active=!1,this.gachaSkipBtn.setTapEvent(this._onTapSkipEvent.bind(this)),this.gachaFadeNode.active=!1,this.gachaSkipBtn.node.active=!1},_initCircleRollView:function(){this._cardThumbnailArray=[],this.circleRollView.node.active=!1,this.circleRollView.content.destroyAllChildren(),this.circleRollView.initCircleRollView();for(var t=0;t<this._gachaPlayCardData.cardList.length;t+=1){var e=cc.instantiate(this.gachaCardThumbnailPrefab).getComponent("GachaCardThumbnail");e.initGachaCardThumbnail(this._root,this._gachaPlayCardData.cardList[t],t,this.circleRollView.getCircleRadius()),this.circleRollView.addContent(e.node),this._cardThumbnailArray.push(e)}this.circleRollView.setSelectedNo(0),this.circleRollView.redraw()},_initGachaCardAnimTasks:function(){this._gachaCardAnimTasks=[],this._gachaCardAnimTasks.push(this._playCardPromoteRarityAnimation.bind(this)),this._gachaCardAnimTasks.push(this._playCardOpenAnimation.bind(this)),this._gachaCardAnimTasks.push(this._showCardImage.bind(this)),this._gachaCardAnimTasks.push(this._playCardWhiteOutAnimation.bind(this)),this._gachaCardAnimTasks.push(this._setGachaFullScreenTapButtonEvent.bind(this)),this._gachaCardAnimTasks.push(this._stopVoice.bind(this)),this._gachaCardAnimTasks.push(this._hideCardImage.bind(this)),this._gachaCardAnimTasks.push(this._playNextCardChangeAnimation.bind(this)),this._gachaCardAnimTasks.push(this._playNextLoop.bind(this))},_initGachaNewCardAnimTasks:function(){this._gachaNewCardAnimTasks=[],this._gachaNewCardAnimTasks.push(this._playCardPromoteRarityAnimation.bind(this)),this._gachaNewCardAnimTasks.push(this._playCardOpenAnimation.bind(this)),this._gachaNewCardAnimTasks.push(this._showNewCardImage.bind(this)),this._gachaNewCardAnimTasks.push(this._playCardWhiteOutAnimation.bind(this)),this._gachaNewCardAnimTasks.push(this._playNewCardImage.bind(this)),this._gachaNewCardAnimTasks.push(this._stopVoice.bind(this)),this._gachaNewCardAnimTasks.push(this._playCardWhiteInAnimation.bind(this)),this._gachaNewCardAnimTasks.push(this._hideNewCardImage.bind(this)),this._gachaNewCardAnimTasks.push(this._playCardWhiteOutAnimation.bind(this)),this._gachaNewCardAnimTasks.push(this._playNextCardChangeAnimation.bind(this)),this._gachaNewCardAnimTasks.push(this._playNextLoop.bind(this))},_initGachaStartBaseAnimTasks:function(){this._gachaBaseAnimTasks=[],this._gachaBaseAnimTasks.push(this._playGachaStartAnimation.bind(this)),this._gachaBaseAnimTasks.push(this._setGachaFullScreenTapButtonEvent.bind(this)),this._gachaBaseAnimTasks.push(this._playGachaStartRarityAnimation.bind(this)),this._gachaBaseAnimTasks.push(this._playGachaAnotherWorldAnimation.bind(this)),this._gachaBaseAnimTasks.push(this._playCardStartAnimation.bind(this)),this._gachaBaseAnimTasks.push(this._playNextLoop.bind(this)),this._gachaBaseAnimTasks.push(this._showCardLayout.bind(this)),r.waterfall([].concat(this._gachaBaseAnimTasks))},_onTapSkipEvent:function(){this.unscheduleAllCallbacks(),this.gachaFullScreenTapBtn.node.active=!1,this.gachaSkipBtn.node.active=!1,this._isSkipMode=!0,this._playFadeIn(function(){this.gachaStartSkeleton.clearTracks(),this.gachaStartSkeleton.setCompleteListener(null),this.gachaStartSkeleton.node.active=!1,this.gachaAnotherWorldSkeleton.clearTracks(),this.gachaAnotherWorldSkeleton.setCompleteListener(null),this.gachaAnotherWorldSkeleton.node.active=!0,this.gachaAnotherWorldSkeleton.setAnimation(0,a.ANIM_NAME.ANOTHER_WORLD.LOOP,!0),this.circleRollView.node.active=!0,this._playSkipAnimation(function(){})}.bind(this)),s.soundManager.stopSeId(this._se002ObjectId),this._se002ObjectId=0,this._se008ObjectId||(this._se008ObjectId=s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_008)),!0))},_playSkipAnimation:function(t){for(var e=!1,i=this.circleRollView.getSelectedNo();i<this._cardThumbnailArray.length;i+=1){if(this._cardThumbnailArray[i].resetRarityColorName(),this._cardThumbnailArray[i].isNewCard()){this.circleRollView.setSelectedNo(i),this.circleRollView.redraw(),e=!0;break}this._cardThumbnailArray[i].node.active=!1}if(e){var a=[];a.push(function(t){this._cardThumbnailArray[this.circleRollView.getSelectedNo()].gachaCardSkeleton.node.active=!1,this._cardThumbnailArray[this.circleRollView.getSelectedNo()].showNewCardImage(t)}.bind(this)),a.push(function(t){this.gachaFullScreenTapBtn.node.active=!0,this.unscheduleAllCallbacks();var e=function(){this.unscheduleAllCallbacks(),this.gachaFullScreenTapBtn.node.active=!1,t()}.bind(this);this.gachaFullScreenTapBtn.setTapEvent(e),this._playFadeOut(t)}.bind(this)),a.push(function(t){this._cardThumbnailArray[this.circleRollView.getSelectedNo()].playNewCardImage(t)}.bind(this)),a.push(function(t){if(this._isTapEventProtect=!0,!this.gachaFullScreenTapBtn.node.active)return t();this.unscheduleAllCallbacks();var e=function(){this.unscheduleAllCallbacks(),t()}.bind(this);this.gachaFullScreenTapBtn.setTapEvent(e)}.bind(this)),a.push(function(t){this._isTapEventProtect=!1,this.gachaFullScreenTapBtn.node.active=!1,this._playFadeIn(t)}.bind(this)),a.push(function(t){this._cardThumbnailArray[this.circleRollView.getSelectedNo()].hideNewCardImage(t)}.bind(this)),a.push(this._stopVoice.bind(this)),a.push(function(t){this._cardThumbnailArray[this.circleRollView.getSelectedNo()].node.active=!1,this.circleRollView.setSelectedNo(this.circleRollView.getSelectedNo()+1),this.circleRollView.redraw(),this._playSkipAnimation(t)}.bind(this)),a.push(t),r.waterfall(a)}else{var n=cc.instantiate(this.gachaResultCardViewPrefab).getComponent("GachaResultCardView");n.initGachaResultCardView(this._root,this._gachaPlayCardData,function(){this.circleRollView.node.active=!1,this._playFadeOut(t)}.bind(this)),this.node.addChild(n.node)}},_playGachaStartAnimation:function(t){this.gachaStartSkeleton.setCompleteListener(function(){this.gachaStartSkeleton.setCompleteListener(null),this.gachaStartSkeleton.setAnimation(0,a.ANIM_NAME.START.IDLE,!0),this.gachaSkipBtn.node.active=!0,this._se002ObjectId=s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_002)),!0),t()}.bind(this)),this.gachaStartSkeleton.node.active=!0,this.gachaStartSkeleton.setAnimation(0,a.ANIM_NAME.START.START,!1),s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_001)),!1)},_stopVoice:function(t){this.gachaFullScreenTapBtn.node.active=!1,s.soundManager.voiceStop(),t()},_setGachaFullScreenTapButtonEvent:function(t){this._isSkipMode&&t(),this._isTapEventProtect||(this.gachaFullScreenTapBtn.node.active=!0,this.gachaFullScreenTapBtn.setTapEvent(function(){this.gachaFullScreenTapBtn.node.active=!1,t()}.bind(this)))},_playGachaStartRarityAnimation:function(t){this._isSkipMode&&t(),this.gachaStartSkeleton.node.active=!1,this.gachaStartSkeleton.setCompleteListener(function(){t()}),this.gachaStartSkeleton.node.active=!0,this.gachaStartSkeleton.setAnimation(0,this._getGachaStartRarityAnimationName(this._gachaPlayCardData.maxRarity),!1),this._playGachaStartRaritySe(this._gachaPlayCardData.maxRarity)},_playGachaStartRaritySe:function(t){switch(a.RARITY_TO_ANIM_COLOR_NAME[t]){case a.ANIM_COLOR_NAME.BLUE:s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_005)),!1);break;case a.ANIM_COLOR_NAME.YELLOW:s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_006)),!1);break;case a.ANIM_COLOR_NAME.RED:s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_007)),!1)}s.soundManager.stopSeId(this._se002ObjectId),this._se002ObjectId=0},_getGachaStartRarityAnimationName:function(t){switch(a.RARITY_TO_ANIM_COLOR_NAME[t]){case a.ANIM_COLOR_NAME.BLUE:return a.ANIM_NAME.START.BLUE;case a.ANIM_COLOR_NAME.YELLOW:return a.ANIM_NAME.START.YELLOW;case a.ANIM_COLOR_NAME.RED:return a.ANIM_NAME.START.RED}},_playGachaAnotherWorldAnimation:function(t){this._isSkipMode?t():(this.gachaAnotherWorldSkeleton.setCompleteListener(function(){this.gachaAnotherWorldSkeleton.setCompleteListener(null),this.gachaAnotherWorldSkeleton.setAnimation(0,a.ANIM_NAME.ANOTHER_WORLD.LOOP,!0),this._se008ObjectId=s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_008)),!0),t()}.bind(this)),this.gachaAnotherWorldSkeleton.node.active=!0,this.gachaAnotherWorldSkeleton.setAnimation(0,a.ANIM_NAME.ANOTHER_WORLD.START,!1))},_playCardStartAnimation:function(t){if(this._isSkipMode)t();else{this.circleRollView.node.active=!0;for(var e=[],i=0;i<this._cardThumbnailArray.length;i+=1)i===this._cardThumbnailArray.length-1?e.push(this._getCardStartSequenceAction(t,this._cardThumbnailArray[i],i)):e.push(this._getCardStartSequenceAction(function(){},this._cardThumbnailArray[i],i));1===e.length?this.node.runAction(e[0]):this.node.runAction(cc.spawn(e))}},_getCardStartSequenceAction:function(t,e,i){return cc.sequence(cc.delayTime(.1*i),cc.callFunc(function(){e.playCardStartAnimation(t),s.soundManager.playSE(c.getResource(c.getFileNameSE(a.GACHA_SOUND.SE_GACHA_009)),!1)}))},_playCardPromoteRarityAnimation:function(t){this._isSkipMode?t():this._cardThumbnailArray[this.circleRollView.getSelectedNo()].playCardPromoteRarityAnimation(function(){t()})},_playCardOpenAnimation:function(t){this._isSkipMode?t():this._cardThumbnailArray[this.circleRollView.getSelectedNo()].playCardOpenAnimation(function(){t()})},_playCardEndSecondAnimation:function(t){this._isSkipMode?t():(this._cardThumbnailArray[this.circleRollView.getSelectedNo()].playCardWhiteOutAnimation(),t())},_playCardWhiteInAnimation:function(t){this._isSkipMode?t():this._cardThumbnailArray[this.circleRollView.getSelectedNo()].playCardWhiteInAnimation(function(){t()})},_playCardWhiteOutAnimation:function(t){this._isSkipMode?t():(this._cardThumbnailArray[this.circleRollView.getSelectedNo()].playCardWhiteOutAnimation(function(){}),t())},_showNewCardImage:function(t){this._isSkipMode?t():this._cardThumbnailArray[this.circleRollView.getSelectedNo()].showNewCardImage(t)},_playNewCardImage:function(t){this._isSkipMode?t():(this.gachaFullScreenTapBtn.node.active=!0,this._cardThumbnailArray[this.circleRollView.getSelectedNo()].playNewCardImage(t),this.gachaFullScreenTapBtn.setTapEvent(function(){this.gachaFullScreenTapBtn.node.active=!1,t()}.bind(this)))},_hideNewCardImage:function(t){this._isSkipMode?t():this._cardThumbnailArray[this.circleRollView.getSelectedNo()].hideNewCardImage(t)},_showCardImage:function(t){this._isSkipMode?t():this._cardThumbnailArray[this.circleRollView.getSelectedNo()].showCardImage(t)},_hideCardImage:function(t){this._isSkipMode?t():(this._playCardEndSecondAnimation(t),this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){this._cardThumbnailArray[this.circleRollView.getSelectedNo()].hideCardImage(function(){})}.bind(this)))))},_playNextCardChangeAnimation:function(t){this._isSkipMode?t():(this._cardThumbnailArray[this.circleRollView.getSelectedNo()].node.active=!1,this.circleRollView.setCallbackToSwitchContent(t),this.circleRollView.moveToRight())},_playNextLoop:function(t){this._isSkipMode?t():this._cardThumbnailArray.some(function(t){return!0===t.node.active})?this._gachaPlayCardData.cardList[this.circleRollView.getSelectedNo()].newFlg?r.waterfall(this._gachaNewCardAnimTasks.concat([t])):r.waterfall(this._gachaCardAnimTasks.concat([t])):(this.gachaSkipBtn.node.active=!1,t())},_showCardLayout:function(t){if(this._isSkipMode)t();else{var e=cc.instantiate(this.gachaResultCardViewPrefab).getComponent("GachaResultCardView");e.initGachaResultCardView(this._root,this._gachaPlayCardData,t),this.node.addChild(e.node)}},_playFadeIn:function(t){this.gachaFadeNode.active=!0,this.gachaFadeNode.opacity=0,this.gachaFadeNode.runAction(cc.sequence(cc.fadeIn(.2),cc.callFunc(function(){t()})))},_playFadeOut:function(t){this.gachaFadeNode.runAction(cc.sequence(cc.fadeOut(.2),cc.callFunc(function(){this.gachaFadeNode.active=!1,t()},this)))}});cc._RF.pop()},{Async:"Async",CommonButton:"CommonButton",GachaAnimationConst:"GachaAnimationConst",GachaAnimationRollView:"GachaAnimationRollView",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],GachaApis:[function(t,e,i){"use strict";cc._RF.push(e,"5239ft4uBhCxLLLbO1Wx0BY","GachaApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.GACHA_GET_LIST,path:"gacha/getList",method:"POST"}),a.RESTClient.graft({name:n.GACHA_GET_DETAIL,path:"gacha/getDetail",method:"POST"}),a.RESTClient.graft({name:n.GACHA_PLAY,path:"gacha/play",method:"POST"}),a.RESTClient.graft({name:n.GACHA_REPLAY,path:"gacha/replay",method:"POST"}),a.RESTClient.graft({name:n.GACHA_DECIDE,path:"gacha/decide",method:"POST"}),a.RESTClient.graft({name:n.GACHA_LOAD_SESSION,path:"gacha/loadSession",method:"POST"}),a.RESTClient.graft({name:n.BOX_GACHA_DETAIL,path:"boxGacha/getBoxDetail",method:"POST"}),a.RESTClient.graft({name:n.BOX_GACHA_PLAY,path:"boxGacha/playBox",method:"POST"}),a.RESTClient.graft({name:n.BOX_GACHA_RESET,path:"boxGacha/resetBox",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],GachaCardLayoutHorizontalView:[function(t,e,i){"use strict";cc._RF.push(e,"1f4f8PgBHZFM4j7CdOlKzEt","GachaCardLayoutHorizontalView");cc.Class({extends:cc.Component,properties:{cardThumbnailPrefab:cc.Prefab,addThumbnailNode:cc.Node},_root:null,_cardDataArray:null,initGachaCardLayoutHorizontalView:function(t,e,i){this._root=t,this._cardDataArray=e;for(var a=0;a<e.length;a+=1){var n=cc.instantiate(this.cardThumbnailPrefab).getComponent("GachaCharacterCardThumbnail");a===this._cardDataArray.length-1?n.initGachaCharacterCardThumbnail(t,e[a],i):n.initGachaCharacterCardThumbnail(t,e[a],function(){}),this.addThumbnailNode.addChild(n.node)}}});cc._RF.pop()},{}],GachaCardThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"f0af47QBWFOAa5Wq1JCXKe6","GachaCardThumbnail");var a=t("GachaAnimationConst"),n=t("ResourceUtils"),o=t("CharacterUtils"),r=t("ItemConst"),s=t("Singleton"),c=t("PictureBookUtils"),l=t("CharacterConst");cc.Class({extends:cc.Component,properties:{gachaCardSkeleton:sp.Skeleton,homeSpineSkeleton:sp.Skeleton,mainSprite:cc.Sprite,cardNode:cc.Node,cardPrefab:cc.Prefab,standSprite:cc.Sprite,bgSprite:cc.Sprite},_root:null,_cardData:void 0,_index:0,_circleRadius:null,_tempBgmVol:0,_rarityColorName:"",_cardThumbnail:void 0,_se015ObjectId:0,initGachaCardThumbnail:function(t,e,i,n){this._root=t,this._cardData=e,this._index=i,this._circleRadius=n,this._tempBgmVol=s.soundManager.getSoundConfig().bgmVolume,this.gachaCardSkeleton.node.active=!1,this.gachaCardSkeleton.defaultAnimation=a.ANIM_NAME.CARD.START_BLUE,this.homeSpineSkeleton.node.active=!1,this.homeSpineSkeleton.node.parent.active=!1,this.mainSprite.node.active=!1,this.standSprite.node.active=!1,this._setBgSprite(),this.cardNode.active=!1,this.homeSpineSkeleton.node.parent.setPosition(cc.v2(0,0+this._circleRadius.y)),this.mainSprite.node.setPosition(cc.v2(0,0+this._circleRadius.y)),this.standSprite.node.setPosition(cc.v2(0,-125+this._circleRadius.y)),this.bgSprite.node.setPosition(cc.v2(0,0+this._circleRadius.y)),this.cardNode.setPosition(cc.v2(0,0+this._circleRadius.y)),this._cardThumbnail=cc.instantiate(this.cardPrefab).getComponent("GachaCharacterCardThumbnail"),this._cardThumbnail.node.scale=2*this._cardThumbnail.node.scale,this.cardNode.addChild(this._cardThumbnail.node),this._initPromoteRarity()},isNewCard:function(){return this._cardData.newFlg},_initPromoteRarity:function(){this._rarityColorName=a.RARITY_TO_ANIM_COLOR_NAME[this._cardData.rarity];var t=[];switch(this._rarityColorName){case a.ANIM_COLOR_NAME.BLUE:break;case a.ANIM_COLOR_NAME.YELLOW:t.push(a.ANIM_COLOR_NAME.BLUE);break;case a.ANIM_COLOR_NAME.RED:t.push(a.ANIM_COLOR_NAME.BLUE),t.push(a.ANIM_COLOR_NAME.YELLOW)}if(t.length>0&&Math.floor(1e3*Math.random())+1<=this._root.getGachaPlayCardData().beforeButtonData.advanceRate){var e=Math.floor(Math.random()*t.length);this._rarityColorName=t[e]}},playCardStartAnimation:function(t){this.gachaCardSkeleton.setCompleteListener(function(){this.gachaCardSkeleton.setCompleteListener(null),this.gachaCardSkeleton.setAnimation(0,this._getCardIdleRarityAnimationName(),!0),t()}.bind(this)),this.gachaCardSkeleton.node.active=!0,this.gachaCardSkeleton.setAnimation(0,this._getCardStartRarityAnimationName(),!1)},_getCardStartRarityAnimationName:function(){switch(this._rarityColorName){case a.ANIM_COLOR_NAME.BLUE:return a.ANIM_NAME.CARD.START_BLUE;case a.ANIM_COLOR_NAME.YELLOW:return a.ANIM_NAME.CARD.START_YELLOW;case a.ANIM_COLOR_NAME.RED:return a.ANIM_NAME.CARD.START_RED}},playCardIdleAnimation:function(){this.gachaCardSkeleton.node.active=!0,this.gachaCardSkeleton.setCompleteListener(null),this.gachaCardSkeleton.setAnimation(0,this._getCardIdleRarityAnimationName(),!0)},_getCardIdleRarityAnimationName:function(){switch(this._rarityColorName){case a.ANIM_COLOR_NAME.BLUE:return a.ANIM_NAME.CARD.IDLE_BLUE;case a.ANIM_COLOR_NAME.YELLOW:return a.ANIM_NAME.CARD.IDLE_YELLOW;case a.ANIM_COLOR_NAME.RED:return a.ANIM_NAME.CARD.IDLE_RED}},playCardPromoteRarityAnimation:function(t){this._checkPromoteRarity()?(this.gachaCardSkeleton.setCompleteListener(function(){this._rarityColorName=a.RARITY_TO_ANIM_COLOR_NAME[this._cardData.rarity],this.gachaCardSkeleton.setCompleteListener(null),t()}.bind(this)),this.gachaCardSkeleton.setAnimation(0,this._getCardPromoteRarityAnimationName(),!1),this.gachaCardSkeleton.node.runAction(cc.sequence(cc.callFunc(function(){s.soundManager.playSE(n.getResource(n.getFileNameSE(a.GACHA_SOUND.SE_GACHA_010)),!1)}),cc.delayTime(.4),cc.callFunc(function(){s.soundManager.playSE(n.getResource(n.getFileNameSE(a.GACHA_SOUND.SE_GACHA_011)),!1)})))):t()},_checkPromoteRarity:function(){var t=a.RARITY_TO_ANIM_COLOR_NAME[this._cardData.rarity];return this._rarityColorName!==t},_getCardPromoteRarityAnimationName:function(){var t=a.RARITY_TO_ANIM_COLOR_NAME[this._cardData.rarity];return this._rarityColorName===a.ANIM_COLOR_NAME.BLUE&&t===a.ANIM_COLOR_NAME.YELLOW?a.ANIM_NAME.CARD.PROMOTE_B_TO_Y:this._rarityColorName===a.ANIM_COLOR_NAME.BLUE&&t===a.ANIM_COLOR_NAME.RED?a.ANIM_NAME.CARD.PROMOTE_B_TO_R:this._rarityColorName===a.ANIM_COLOR_NAME.YELLOW&&t===a.ANIM_COLOR_NAME.RED?a.ANIM_NAME.CARD.PROMOTE_Y_TO_R:void 0},resetRarityColorName:function(){this._rarityColorName=a.RARITY_TO_ANIM_COLOR_NAME[this._cardData.rarity]},playCardOpenAnimation:function(t){this.gachaCardSkeleton.node.runAction(cc.sequence(cc.callFunc(function(){s.soundManager.playSE(n.getResource(n.getFileNameSE(a.GACHA_SOUND.SE_GACHA_012)),!1),this._se015ObjectId=s.soundManager.playSE(n.getResource(n.getFileNameSE(a.GACHA_SOUND.SE_GACHA_015)),!0)}.bind(this)),cc.moveTo(1,cc.v2(0,0+this._circleRadius.y)).easing(cc.easeInOut(5)),cc.callFunc(function(){this.gachaCardSkeleton.setCompleteListener(function(){this.gachaCardSkeleton.setCompleteListener(null),t()}.bind(this)),this.gachaCardSkeleton.setAnimation(0,this._getCardOpenRarityAnimationName(),!1),s.soundManager.playSE(n.getResource(n.getFileNameSE(a.GACHA_SOUND.SE_GACHA_013)),!1)}.bind(this))))},_getCardOpenRarityAnimationName:function(){switch(this._rarityColorName){case a.ANIM_COLOR_NAME.BLUE:return a.ANIM_NAME.CARD.OPEN_BLUE;case a.ANIM_COLOR_NAME.YELLOW:return a.ANIM_NAME.CARD.OPEN_YELLOW;case a.ANIM_COLOR_NAME.RED:return a.ANIM_NAME.CARD.OPEN_RED}},playCardEndSecondAnimation:function(t){this.gachaCardSkeleton.setCompleteListener(function(){this.gachaCardSkeleton.setCompleteListener(null),t()}.bind(this)),this.gachaCardSkeleton.setAnimation(0,a.ANIM_NAME.CARD.END_SECOND,!1)},playCardWhiteInAnimation:function(t){this.gachaCardSkeleton.setCompleteListener(function(){this.gachaCardSkeleton.setCompleteListener(null),t()}.bind(this)),this.gachaCardSkeleton.setAnimation(0,a.ANIM_NAME.CARD.WHITE_IN,!1),s.soundManager.playSE(n.getResource(n.getFileNameSE(a.GACHA_SOUND.SE_GACHA_014)),!1),s.soundManager.stopSeId(this._se015ObjectId)},playCardWhiteOutAnimation:function(t){this.gachaCardSkeleton.setCompleteListener(function(){this.gachaCardSkeleton.setCompleteListener(null),t&&t()}.bind(this)),this.gachaCardSkeleton.setAnimation(0,a.ANIM_NAME.CARD.WHITE_OUT,!1)},showNewCardImage:function(t){switch(this._rarityColorName){case a.ANIM_COLOR_NAME.BLUE:n.addSprite(this.standSprite,n.getFileNameCharacterStand(this._cardData.itemId),function(){this.bgSprite.node.active=!0,this.standSprite.node.active=!0,this.standSprite.node.scale=.9*this.standSprite.node.scale;var e=o.getCharacterMainModelByCharacterId(this._cardData.itemId);this.standSprite.node.position=e?cc.v2(e.getStandHeadPositionX(),e.getStandHeadPositionY()+200):cc.v2(0,0),this.standSprite.node.active=!1,t()}.bind(this));break;case a.ANIM_COLOR_NAME.YELLOW:case a.ANIM_COLOR_NAME.RED:this._showCharacterHomeSpine(t),t()}},_showCharacterHomeSpine:function(t){s.soundManager.setBGMVol(this._tempBgmVol*a.CHARACTER_HOME_SPINE_BGM_RATE);var e=o.getCharacterSkillMainMasterMapIndexBySkillId(),i=o.getCharacterMainModelByCharacterId(this._cardData.itemId),r=e[i.getSkillId()],c=e[i.getSkillId()].getSpineName(),l=n.getDirectoryIngameSkillSpine(r.getSpineDirectoryPath()),u=n.getDirectoryIngameSe(r.getSpineDirectoryPath());this.homeSpineSkeleton.skeletonData=n.getResource(l+c),this.homeSpineSkeleton.node.parent.active=!0,this.homeSpineSkeleton.node.active=!1,this._createHomeSpineLayer(),this.homeSpineSkeleton.setEventListener(this._onSpineEvent.bind(this,l,u))},playNewCardImage:function(t){switch(this._rarityColorName){case a.ANIM_COLOR_NAME.BLUE:this.standSprite.node.active=!0,this._playGachaResultVoice(),t();break;case a.ANIM_COLOR_NAME.YELLOW:case a.ANIM_COLOR_NAME.RED:this.homeSpineSkeleton.setCompleteListener(function(t,e){this.homeSpineSkeleton.setCompleteListener(function(){this.homeSpineSkeleton.setEventListener(null)}.bind(this)),this._playGachaResultVoice(),this.homeSpineSkeleton.setAnimation(0,a.ANIM_NAME.HOME,!0)}.bind(this)),this.homeSpineSkeleton.node.active=!0,this.homeSpineSkeleton.setAnimation(0,a.ANIM_NAME.SKILL,!1)}},_createHomeSpineLayer:function(){if(null===this._layerNodeList)this._layerNodeList=[];else{for(var t in this._layerNodeList)this._layerNodeList[t].destroy();this._layerNodeList=[]}if(0===this._layerNodeList.length)for(var e=0;e<10;e+=1){var i=new cc.Node;i.parent=this.homeSpineSkeleton.node.parent,i.setPosition(cc.v2(0,0));var a=9-e;i.zIndex=a,this._layerNodeList.push(i)}},_onSpineEvent:function(t,e,i,a){var o=a.data.name.split(",")[0];if(0===o.indexOf("gr_"));else if(0===o.indexOf("se_"))s.soundManager.playSE(n.getResource(e+o));else if(0===o.indexOf("vo_"))s.soundManager.playSE(n.getResource(e.replace("/se/","/sound/")+o.substr(3,o.length-3)));else{var r=a.stringValue?a.stringValue.split(","):[],c=r.length>=3?r[2]-1:null,l=""!==r[4]?r[4]:"animation",u="animation"!==l,h=t+o,d=this._layerNodeList[c],p=new cc.Node,m=p.addComponent(sp.Skeleton);m.skeletonData=this._root.getResource(h),m.timeScale=1,p.parent=d,p.setPosition(cc.v2(0,0)),u||m.setCompleteListener(function(){this.homeSpineSkeleton.node.active=!0,m.node.destroy(),s.soundManager.setBGMVol(this._tempBgmVol)}.bind(this)),m.setAnimation(0,l,u)}},hideNewCardImage:function(t){this.homeSpineSkeleton.node.active=!1,this.homeSpineSkeleton.node.parent.active=!1,this.mainSprite.node.active=!1,this.standSprite.node.active=!1,this.bgSprite.node.active=!1,t()},showCardImage:function(t){switch(this._playGachaResultVoice(),this._rarityColorName){case a.ANIM_COLOR_NAME.BLUE:case a.ANIM_COLOR_NAME.YELLOW:case a.ANIM_COLOR_NAME.RED:this._cardThumbnail.initGachaCharacterCardThumbnail(null,this._cardData,function(){this.cardNode.active=!0,t()}.bind(this))}},hideCardImage:function(t){this.cardNode.runAction(cc.sequence(cc.callFunc(function(){s.soundManager.playSE(n.getResource(n.getFileNameSE(a.GACHA_SOUND.SE_GACHA_014)),!1),s.soundManager.stopSeId(this._se015ObjectId)}.bind(this)),cc.fadeOut(.5),cc.callFunc(function(){this.cardNode.active=!1,t()}.bind(this))))},_setBgSprite:function(){n.addSprite(this.bgSprite,n.getFileNameBackGround("bg_10010417"),function(){this.bgSprite.node.active=!1}.bind(this))},_playGachaResultVoice:function(){if(this._isEnabledVoice()){var t=c.getCharacterTextMasterArray(this._cardData.itemId,l.TEXT_SCENE_TYPE.GACHA,l.TEXT_GROUP_TYPE.GACHA.GET),e=_.sample(t);e&&s.fileLoaderManager.loadFile(n.getFileNameCharacterSound(e.getCharacterId(),e.getVoiceFile()),cc.AudioClip,function(t,e){t?cc.error(t):s.soundManager.playVoice(e)})}},_isEnabledVoice:function(){switch(this._cardData.itemType){case r.ITEM_TYPE.CHARACTER:return!0;default:return!1}}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",GachaAnimationConst:"GachaAnimationConst",ItemConst:"ItemConst",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],GachaCautionModel:[function(t,e,i){"use strict";cc._RF.push(e,"06a8db4Dg5K9rLqDPW3ZEeA","GachaCautionModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getCautionId:function(){if(this._isKeyFieldAvailable("cautionId"))return this._data.cautionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: cautionId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaCharacterCardThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"be9efVEyApPXKuTPJ6zYrY2","GachaCharacterCardThumbnail");var a=t("ResourceUtils"),n=t("ItemConst"),o=t("CommonButton"),r=t("CharacterUtils");cc.Class({extends:cc.Component,properties:{cardRarityFrameSpriteArray:[cc.Sprite],cardSprite:cc.Sprite,cardButton:o},_root:null,_cardDataArray:null,initGachaCharacterCardThumbnail:function(t,e,i){this._root=t,this._setCardImage(e,i),t?this.cardButton.setTapEvent(function(){var i=t.getGachaPlayCardData().getCharacters.find(function(t){return t.characterId===e.itemId}),a=r.getCharacterMainModelByCharacterId(e.itemId);i&&r.getCharacterModelByCharacterCd(i.characterCd),t.openGachaAnimationCharacterDetailPopup(a,null)}):this.cardButton.setTapEvent(i)},_setCardImage:function(t,e){var i="";switch(t.itemType){case n.ITEM_TYPE.CHARACTER:i=a.getFileNameCharacterMainSmall(t.itemId);break;case n.ITEM_TYPE.EQUIPMENT:i=a.getFileNameEquipmentThumbNail(t.itemId);break;default:i=a.getFileNameItemThumbnail(t.itemId)}a.addSprite(this.cardSprite,i,e);for(var o=0;o<this.cardRarityFrameSpriteArray.length;o+=1)this.cardRarityFrameSpriteArray[o].node.active=t.rarity-1===o}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",ItemConst:"ItemConst",ResourceUtils:"ResourceUtils"}],GachaCharacterDetailPopupStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"bc89bfpQlZIYoGS9WP4utOx","GachaCharacterDetailPopupStatusView");var a=t("WindowBase"),n=t("CommonUtils"),o=t("CharacterParameterUtils"),r=t("GachaCharacterDetailStatusTabView"),s=(t("CharacterLevelProgressView"),t("CharacterExceedLimitProgressView"),t("BattleParameterView"));cc.Class({extends:a,properties:{gachaCharacterDetailStatusTabView:r,characterLevelProgressViewPrefab:cc.Prefab,characterLevelProgressViewParentNode:cc.Node,characterExceedLimitProgressViewPrefab:cc.Prefab,characterExceedLimitProgressViewParentNode:cc.Node,characterParameterView:s,totalPowerLabel:cc.Label},_root:null,_characterLevelProgressView:null,_characterExceedLimitProgressView:null,initGachaCharacterDetailPopupStatusView:function(t,e){this._root=t,this._addLevelProgressView(),this._addExceedLimitProgressView(),this._drawLevelProgress(e),this._drawExceedLimitProgress(e),this._drawCharacterParameter(e),this.gachaCharacterDetailStatusTabView.initGachaCharacterDetailStatusTabView(t,e)},_addLevelProgressView:function(){this._characterLevelProgressView||(this._characterLevelProgressView=cc.instantiate(this.characterLevelProgressViewPrefab).getComponent("CharacterLevelProgressView"),this.characterLevelProgressViewParentNode.addChild(this._characterLevelProgressView.node))},_drawLevelProgress:function(t){this._characterLevelProgressView.node.active=!0;var e=o.getMaxLevel(t);this._characterLevelProgressView.initCharacterLevelProgressView(0,e,0,e,0,0,0)},_addExceedLimitProgressView:function(){this._characterExceedLimitProgressView||(this._characterExceedLimitProgressView=cc.instantiate(this.characterExceedLimitProgressViewPrefab).getComponent("CharacterExceedLimitProgressView"),this.characterExceedLimitProgressViewParentNode.addChild(this._characterExceedLimitProgressView.node))},_drawExceedLimitProgress:function(t){var e=o.getMaxExceedLimit(t);this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(e,e,e)},_drawCharacterParameter:function(t){this.characterParameterView.node.active=!0;var e=o.getMaxTotalBattleParameter(t);this.totalPowerLabel.string=n.convertToCommaDelimited(e.total),this.characterParameterView.initBattleParameterView(e.hp,e.atk,e.def)}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CharacterExceedLimitProgressView:"CharacterExceedLimitProgressView",CharacterLevelProgressView:"CharacterLevelProgressView",CharacterParameterUtils:"CharacterParameterUtils",CommonUtils:"CommonUtils",GachaCharacterDetailStatusTabView:"GachaCharacterDetailStatusTabView",WindowBase:"WindowBase"}],GachaCharacterDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"c48acOTnd5GRpLg75S5jvL5","GachaCharacterDetailPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("CharacterUtils"),s=t("CharacterParameterUtils"),c=t("GachaCharacterDetailPopupStatusView");cc.Class({extends:a,properties:{characterNameLabel:cc.Label,characterSkinNameLabel:cc.Label,characterLevelLabel:cc.Label,characterCvNode:cc.Node,characterCvNameLabel:cc.Label,characterIllustratorNode:cc.Node,characterIllustratorNameLabel:cc.Label,notesMaxLevelLabel:cc.Label,attributeIconImageSprite:cc.Sprite,rarityIconImageSprite:cc.Sprite,characterImageSprite:cc.Sprite,gachaCharacterDetailPopupStatusView:c,okBtn:n},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openGachaCharacterDetailPopup:function(t,e){var i=r.getCharacterMainModelByCharacterId(e);this._initLabels(i),this._initSprites(i),this.gachaCharacterDetailPopupStatusView.initGachaCharacterDetailPopupStatusView(t,e),this.gachaCharacterDetailPopupStatusView.node.active=!1,this.open(function(){this.gachaCharacterDetailPopupStatusView.node.active=!0})},_initLabels:function(t){this.characterNameLabel.string=t.getShortName(),this.characterSkinNameLabel.string="["+t.getSkinName()+"]";var e=s.getMaxLevel(t.getCharacterId());this.characterLevelLabel.string=""+e,this.notesMaxLevelLabel.string=""+e,this.characterCvNameLabel.string=t.getVoiceActorName(),this.characterIllustratorNameLabel.string=t.getIllustratorName()},_initSprites:function(t){o.addSprite(this.rarityIconImageSprite,o.getFileNameRarityStrIcon(t.getRarity())),o.addSprite(this.attributeIconImageSprite,o.getFileNameAttributeIcon(t.getAttribute())),o.addSprite(this.characterImageSprite,o.getFileNameCharacterMainDetail(t.getCharacterId()))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CharacterParameterUtils:"CharacterParameterUtils",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",GachaCharacterDetailPopupStatusView:"GachaCharacterDetailPopupStatusView",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],GachaCharacterDetailStatusAbilityListView:[function(t,e,i){"use strict";cc._RF.push(e,"aa348VcX8BOnLwU4QhNSIBE","GachaCharacterDetailStatusAbilityListView");var a=t("GachaCharacterDetailStatusAppendListViewBase"),n=t("CharacterAbilityUtils"),o=t("CharacterParameterUtils"),r=t("CharacterUtils");cc.Class({extends:a,properties:{},initGachaCharacterDetailStatusAppendListView:function(t,e){this._super(t,e)},_initListContent:function(t,e){this.content.destroyAllChildren();var i=r.getCharacterMainModelByCharacterId(e);if(i){var a=n.createCharacterAbilityInfoArray(i.getAbilityGroupId(),i.getRarity(),o.getMaxExceedLimit(e),i.getExceedLimitType(),null,!0);for(var s in a){var c=this._createThumbnailNode(t,a[s]);this.content.addChild(c)}}},_createThumbnailNode:function(t,e){var i=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");return i.initPromoteCharacterDetailStatusAbilityThumbnail(e),i.node}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CharacterParameterUtils:"CharacterParameterUtils",CharacterUtils:"CharacterUtils",GachaCharacterDetailStatusAppendListViewBase:"GachaCharacterDetailStatusAppendListViewBase"}],GachaCharacterDetailStatusAppendListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"8aff8Qs9StJ5oazvztmPKUC","GachaCharacterDetailStatusAppendListViewBase");var a=t("WindowBase");cc.Class({extends:a,properties:{content:cc.Node,thumbnailPrefab:cc.Prefab},_root:null,_characterId:0,initGachaCharacterDetailStatusAppendListView:function(t,e){this._root=t,this._characterId=e,this._initListContent(t,e)},_initListContent:function(t,e){}});cc._RF.pop()},{WindowBase:"WindowBase"}],GachaCharacterDetailStatusSkillListView:[function(t,e,i){"use strict";cc._RF.push(e,"9bf32/0hz9DUbJKm4MK3EAK","GachaCharacterDetailStatusSkillListView");var a=t("GachaCharacterDetailStatusAppendListViewBase"),n=t("CharacterSkillUtils");cc.Class({extends:a,properties:{},initGachaCharacterDetailStatusAppendListView:function(t,e){this._super(t,e)},_initListContent:function(t,e){var i=[n.getMaxLevelSkillInfoByCharacterId(e)];for(var a in this.content.destroyAllChildren(),i){var o=this._createThumbnailNode(t,i[a]);this.content.addChild(o)}},_createThumbnailNode:function(t,e){var i=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");return i.initPromoteCharacterDetailStatusSkillThumbnail(e),i.node}});cc._RF.pop()},{CharacterSkillUtils:"CharacterSkillUtils",GachaCharacterDetailStatusAppendListViewBase:"GachaCharacterDetailStatusAppendListViewBase"}],GachaCharacterDetailStatusTabView:[function(t,e,i){"use strict";cc._RF.push(e,"d3e3boLiqNFVKVdhQfsydtx","GachaCharacterDetailStatusTabView");var a=t("TabViewBase"),n=t("GachaCharacterDetailStatusAppendListViewBase");cc.Class({extends:a,properties:{gachaCharacterDetailStatusAppendListViewArray:[n]},_root:null,_characterId:0,initGachaCharacterDetailStatusTabView:function(t,e){this._root=t,this._characterId=e,this.initTabViewBase(),this._setCurrentTab(0),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){for(var e in this.gachaCharacterDetailStatusAppendListViewArray)this.gachaCharacterDetailStatusAppendListViewArray[e].node.active=!1;this.gachaCharacterDetailStatusAppendListViewArray[t].node.active=!0,this.gachaCharacterDetailStatusAppendListViewArray[t].initGachaCharacterDetailStatusAppendListView(this._root,this._characterId)}});cc._RF.pop()},{GachaCharacterDetailStatusAppendListViewBase:"GachaCharacterDetailStatusAppendListViewBase",TabViewBase:"TabViewBase"}],GachaCharacterSummaryView:[function(t,e,i){"use strict";cc._RF.push(e,"85b953mkI9MTZLqYvG7fS9I","GachaCharacterSummaryView");var a=t("CommonFunction"),n=t("ResourceUtils"),o=t("CharacterUtils"),r=t("PictureBookUtils"),s=t("CharacterConst"),c=t("Singleton"),l=t("CommonButton"),u=t("FileLoaderManager");cc.Class({extends:cc.Component,properties:{characterRaritySprite:cc.Sprite,characterAttributeSprite:cc.Sprite,characterName:cc.Label,characterSkinName:cc.Label,characterCvName:cc.Label,bgChangeButton:l,voiceButton:l,characterDetailButton:l},_root:null,_banner:null,_voiceFileNameList:null,_currentVoiceListIndex:null,initGachaCharacterSummaryView:function(t,e,i){if(this._root=t,this._banner=e,e.characterId){var a=o.getCharacterMainModelByCharacterId(e.characterId);n.addSprite(this.characterRaritySprite,n.getFileNameRarityStrIcon(a.getRarity()),void 0),n.addSprite(this.characterAttributeSprite,n.getFileNameAttributeIcon(a.getAttribute()),void 0),this.characterName.string=a.getShortName(),this.characterSkinName.string="["+a.getSkinName()+"]",this.characterCvName.string=a.getVoiceActorName(),this.bgChangeButton.setTapEvent(i),this._setVoiceContent(e.characterId),this._voiceFileNameList.length>0?this.voiceButton.setTapEvent(this._onTapVoiceButton.bind(this),""):this.voiceButton.node.active=!1,this.characterDetailButton.setTapEvent(this._onTapCharacterDetailButton.bind(this))}},_setVoiceContent:function(t){this._voiceFileNameList=[],r.getCharacterTextMasterArray(t,s.TEXT_SCENE_TYPE.GACHA,0).forEach(function(t){this._voiceFileNameList.push(t.getVoiceFile())}.bind(this))},_onTapVoiceButton:function(){this._currentVoiceListIndex=a.getRandomInt(0,this._voiceFileNameList.length),this._playVoice()},_onTapCharacterDetailButton:function(){this._root.openGachaCharacterDetailPopup(this._banner.characterId)},_playVoice:function(){var t=this._voiceFileNameList[this._currentVoiceListIndex];u.instance.loadFile(n.getFileNameCharacterSound(this._banner.characterId,t),cc.AudioClip,function(t,e){t?cc.error(t):c.soundManager.playVoice(e,!0,1)})}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonFunction:"CommonFunction",FileLoaderManager:"FileLoaderManager",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],GachaConst:[function(t,e,i){"use strict";cc._RF.push(e,"0fe8cSlPHREyJgmeDyr12z8","GachaConst"),cc.Class({statics:{GACH_POSITION:cc.Enum({GACHA_ICON_RIGHT:234.5,GACHA_ICON_LEFT:-216,GACHA_NAME_Y:187,GACHA_SKILL_Y:-140}),GACHA_TYPE:cc.Enum({NORMAL:1,STEP_UP:2,TICKET:3}),BUTTON_TYPE:cc.Enum({NORMAL:1,DAILY:2}),BANNER_TYPE:cc.Enum({NON:0,LEFT:1,RIGHT:2,STEP_UP:3}),DISCOUNT_TYPE:cc.Enum({DISCOUNT_FIRST:1,DISCOUNT_DAY_FIRST:2,DISCOUNT_LAP:11,DISCOUNT_EVERY_LAP:12}),RATE_TYPE:cc.Enum({NORMAL_RATE:0,APPEARANCE_RATE:1,LIMITED_RATE:2})}}),cc._RF.pop()},{}],GachaContentsModel:[function(t,e,i){"use strict";cc._RF.push(e,"b7f37L/WMVFF4fisV1BN44k","GachaContentsModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCategory:function(){if(this._isKeyFieldAvailable("category"))return this._data.category;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: category")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getBannerFile:function(){if(this._isKeyFieldAvailable("bannerFile"))return this._data.bannerFile;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bannerFile")},getContentsId:function(){if(this._isKeyFieldAvailable("contentsId"))return this._data.contentsId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: contentsId")},getDescription_type:function(){if(this._isKeyFieldAvailable("description_type"))return this._data.description_type;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: description_type")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaCurrencyItemThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"c93d50RqnJP9oDE/BD+b5cl","GachaCurrencyItemThumbnail");var a=t("ItemUtils"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("Singleton"),s=t("GameConst");cc.Class({extends:cc.Component,properties:{currencyIconSprite:cc.Sprite,currencyNumLabel:cc.Label},_itemId:0,initGachaCurrencyItemThumbnail:function(t){this._itemId=t,this._setParameter()},redraw:function(){this._setParameter()},_setParameter:function(){this._setCurrencyIconSprite(this._itemId);var t=0;switch(this._itemId){case s.ITEM_ID_FREE_GEM:t=r.dao.userBasicData.getFreeGem();break;case s.ITEM_ID_PAID_GEM:t=r.dao.userBasicData.getPaidGem();break;default:t=a.getUserItemCount(this._itemId)}this._setCurrencyNumLabel(t)},_setCurrencyIconSprite:function(t){o.addSprite(this.currencyIconSprite,o.getFileNameItemImage(t),void 0)},_setCurrencyNumLabel:function(t){this.currencyNumLabel.string=n.convertToCommaDelimited(t)}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],GachaCurrencyThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"b1c5b9vLBJI/r5aPl5Ba5Kj","GachaCurrencyThumbnail");var a=t("ItemUtils"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("Singleton"),s=t("GameConst");cc.Class({extends:cc.Component,properties:{currencyIconSprite:cc.Sprite,currencyIconLabel:cc.Label,currencyNumLabel:cc.Label},_root:null,_itemId:0,_gemSuffixText:null,initGachaCurrencyThumbnail:function(t,e,i){this._root=t,this._itemId=e,this._gemSuffixText=i||"",this._setParameter()},_setParameter:function(){this._setCurrencyIconSprite(this._itemId);var t="",e=0;switch(this._itemId){case s.ITEM_ID_FREE_GEM:t="\u7121\u511f"+this._gemSuffixText,e=r.dao.userBasicData.getFreeGem();break;case s.ITEM_ID_PAID_GEM:t="\u6709\u511f"+this._gemSuffixText,e=r.dao.userBasicData.getPaidGem();break;default:t=a.getItemMaster(this._itemId).getName(),e=a.getUserItemCount(this._itemId)}this._setCurrencyIconLabel(t),this._setCurrencyNumLabel(e)},redraw:function(){this._setParameter()},_setCurrencyIconSprite:function(t){o.addSprite(this.currencyIconSprite,o.getFileNameItemImage(t))},_setCurrencyIconLabel:function(t){this.currencyIconLabel&&(this.currencyIconLabel.string=t)},_setCurrencyNumLabel:function(t){this.currencyNumLabel&&(this.currencyNumLabel.string=n.convertToCommaDelimited(t))}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],GachaDiscountModel:[function(t,e,i){"use strict";cc._RF.push(e,"0b0c3bhltpCzqDOOBKSplop","GachaDiscountModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getDiscountCondition:function(){if(this._isKeyFieldAvailable("discountCondition"))return this._data.discountCondition;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: discountCondition")},getDiscountTpe:function(){if(this._isKeyFieldAvailable("discountTpe"))return this._data.discountTpe;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: discountTpe")},getButtonId:function(){if(this._isKeyFieldAvailable("buttonId"))return this._data.buttonId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: buttonId")},getStep:function(){if(this._isKeyFieldAvailable("step"))return this._data.step;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: step")},getDiscountCost:function(){if(this._isKeyFieldAvailable("discountCost"))return this._data.discountCost;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: discountCost")},getGachaId:function(){if(this._isKeyFieldAvailable("gachaId"))return this._data.gachaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaFixGroupModel:[function(t,e,i){"use strict";cc._RF.push(e,"7ab34Ao9R1CKom9Asp9a5jA","GachaFixGroupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getFixLineupId:function(){if(this._isKeyFieldAvailable("fixLineupId"))return this._data.fixLineupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fixLineupId")},getFixRarity:function(){if(this._isKeyFieldAvailable("fixRarity"))return this._data.fixRarity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fixRarity")},getFixCount:function(){if(this._isKeyFieldAvailable("fixCount"))return this._data.fixCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fixCount")},getFixType:function(){if(this._isKeyFieldAvailable("fixType"))return this._data.fixType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fixType")},getFixGroupId:function(){if(this._isKeyFieldAvailable("fixGroupId"))return this._data.fixGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fixGroupId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaLineupModel:[function(t,e,i){"use strict";cc._RF.push(e,"d7a36dmMdNIepE8eJiSXPNc","GachaLineupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")},getIconType:function(){if(this._isKeyFieldAvailable("iconType"))return this._data.iconType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: iconType")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getLineupId:function(){if(this._isKeyFieldAvailable("lineupId"))return this._data.lineupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lineupId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaLoadingRoot:[function(t,e,i){"use strict";cc._RF.push(e,"124afu/qHRO6IJGAnpVxj6R","GachaLoadingRoot");var a=t("OutGameRootBase"),n=t("LocalDataConst"),o=t("Singleton"),r=t("ItemConst"),s=t("CharacterUtils"),c=t("EquipmentUtils"),l=t("ItemUtils"),u=t("GameConst"),h=t("ResourceUtils"),d=t("PopupUtils"),p=t("ViewUtils"),m=t("GachaAnimationConst");cc.Class({extends:a,properties:{},_gachaType:0,_gachaPlayCardData:void 0,onLoad:function(){this._setErrorHandling()},_getSceneBgmName:function(){return u.BGM.GACHA},initData:function(){var t=o.dao.pictureBookDetail,e=JSON.parse(this.sceneParam);if(this._gachaType=e.gachaType,e.isLoadSession)this.loadSession(function(e){this._gachaPlayCardData=this._getGachaPlayCardData(e,t,e.button)}.bind(this));else if(e.isPaymentResult)this.loadPaymentSession(function(e){this._gachaPlayCardData=this._getGachaPlayCardData(e,t,void 0)}.bind(this));else if(e.isReplay)this.replayGacha(function(i){this._gachaPlayCardData=this._getGachaPlayCardData(i,t,e.buttonData)}.bind(this));else{var i=e.buttonData;this.playGacha(i.gachaGroupId,i.gachaId,i.buttonId,1,i.skuId,function(e){this._gachaPlayCardData=this._getGachaPlayCardData(e,t,i)}.bind(this))}},initResource:function(){if(this._super(),this._gachaPlayCardData){var t=s.getCharacterSkillMainMasterMapIndexBySkillId();this._gachaPlayCardData.cardList.forEach(function(e){if(e.rarity>=u.RARITY.SR&&e.itemType===r.ITEM_TYPE.CHARACTER){var i=s.getCharacterMainModelByCharacterId(e.itemId),a=t[i.getSkillId()],n=t[i.getSkillId()].getSpineName(),o=h.getDirectoryIngameSkillSpine(a.getSpineDirectoryPath()),c=h.getDirectoryIngameSe(a.getSpineDirectoryPath()),l=a.getHitEffectName(),d=h.getDirectoryIngameHitSpine(a.getSpineDirectoryPath());this.requestRes(o+n,sp.SkeletonData,this.requestEventsSpineRes.bind(this,n,o,l,d,c))}}.bind(this)),this._requestGachaSoundRes()}},requestEventsSpineRes:function(t,e,i,a,n){var o=e+t,r=this.getResource(o);if(r)for(var s in r.skeletonJson.events)if(0===s.indexOf("gr_"));else if(0===s.indexOf("se_"))this.requestRes(n+s,cc.AudioClip);else if(0===s.indexOf("vo_"))this.requestRes(n.replace("/se/","/sound/")+s.substr(3,s.length-3),cc.AudioClip);else switch(s){case"spine_off":break;case i:this.requestRes(a+s,sp.SkeletonData);break;default:this.requestRes(e+s,sp.SkeletonData)}},_requestGachaSoundRes:function(){_.forEach(m.GACHA_SOUND,function(t){this.requestRes(h.getFileNameSE(t),cc.AudioClip,void 0)}.bind(this))},initialize:function(){if(this._isInitializedView=!0,this._gachaPlayCardData){var t={GachaAnimationSubRoot:{gachaType:this._gachaType,gachaPlayCardData:this._gachaPlayCardData}};this.pushScene("GachaAnimationScene",void 0,t,void 0)}},playGacha:function(t,e,i,a,n,r){this.requestURLCount++,o.GachaService.play(t,e,parseInt(i),a,n,function(t){if(this.requestURLCount--,r){if(t)return r(t);var e=n?"\u8cfc\u5165\u30a8\u30e9\u30fc":"",i=n?"\u8cfc\u5165\u51e6\u7406\u304c\u4e2d\u65ad\u3055\u308c\u307e\u3057\u305f":"\u30ac\u30c1\u30e3\u306b\u5931\u6557\u3057\u307e\u3057\u305f";d.openCommonPopupOk(e,i,"",!1,function(){this.popScene()}.bind(this),"OK")}}.bind(this))},replayGacha:function(t){this.requestURLCount++,o.GachaService.replay(function(e){if(this.requestURLCount--,t){if(e)return t(e);d.openCommonPopupOk("","\u30ac\u30c1\u30e3\u306e\u5f15\u304d\u76f4\u3057\u306b\u5931\u6557\u3057\u307e\u3057\u305f","",!1,function(){this.popScene()}.bind(this),"OK")}}.bind(this))},loadSession:function(t){this.requestURLCount++,o.GachaService.loadSession(function(e){if(this.requestURLCount--,t){if(e)return t(e);d.openCommonPopupOk("","\u30ac\u30c1\u30e3\u7d50\u679c\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f","",!1,function(){this.popScene()}.bind(this),"OK")}}.bind(this))},loadPaymentSession:function(t){p.addPaymentWaitLayer();var e=o.localData[n.PAYMENT_SESSION];this.requestURLCount++,o.PaymentService.getResult(e.paymentId,function(e){if(this.requestURLCount--,o.localData[n.PAYMENT_SESSION]=void 0,p.removePaymentWaitLayer(),e)return t(e);d.openCommonPopupOk("\u8cfc\u5165\u30a8\u30e9\u30fc","\u8cfc\u5165\u51e6\u7406\u304c\u4e2d\u65ad\u3055\u308c\u307e\u3057\u305f","",!1,function(){this.popScene()}.bind(this),"OK")}.bind(this))},_getGachaPlayCardData:function(t,e,i){for(var a={cardList:[],itemCardList:[],equipmentCardList:[],characterCardList:[],newCharacterCardList:[],addPresents:t.addPresents?t.addPresents:[],maxRarity:0,beforeButtonData:i,afterButtonData:t.button,getCharacters:t.getCharacters,isCanReplay:t.isCanReplay,remainReplayCount:t.remainReplayCount},n=0;n<t.cards.length;n++){var o={itemId:t.cards[n].itemId,itemType:t.cards[n].itemType,newFlg:!1,rarity:0};switch(t.cards[n].itemType){case r.ITEM_TYPE.CHARACTER:var u=s.getCharacterMainModelByCharacterId(t.cards[n].itemId);o.rarity=t.cards[n].rarity?t.cards[n].rarity:u.getRarity(),o.newFlg=this._checkNewCharacter(t.cards[n].itemId,a.newCharacterCardList,e),a.characterCardList.push(o),o.newFlg&&a.newCharacterCardList.push(o);break;case r.ITEM_TYPE.EQUIPMENT:var h=c.getEquipmentMainModelByEquipmentId(t.cards[n].itemId);o.rarity=t.cards[n].rarity?t.cards[n].rarity:h.getRarity(),a.equipmentCardList.push(o);break;default:var d=l.getItemMaster(t.cards[n].itemId);o.rarity=t.cards[n].rarity?t.cards[n].rarity:d.getRarity(),a.itemCardList.push(o)}a.cardList.push(o),a.maxRarity=a.maxRarity<o.rarity?o.rarity:a.maxRarity}return a},_checkNewCharacter:function(t,e,i){return!e.some(function(e){return e.itemId===t})&&!i.some(function(e){return e.getCharacterId()===t})}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",EquipmentUtils:"EquipmentUtils",GachaAnimationConst:"GachaAnimationConst",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],GachaMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"4ad2b0vLANMV5UFe4UZrD4C","GachaMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getButtonCount:function(){if(this._isKeyFieldAvailable("buttons"))return this._data.buttons.length;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: buttonCount")},getButtonList:function(){if(this._isKeyFieldAvailable("buttons"))return this._data.buttons;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: buttonList")},getBannerCount:function(){if(this._isKeyFieldAvailable("banners"))return this._data.banners.length;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bannerCount")},getBannerList:function(){if(this._isKeyFieldAvailable("banners"))return this._data.banners;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bannerList")},getWeekType:function(){if(this._isKeyFieldAvailable("weekType"))return this._data.weekType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: weekType")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getConditionFrom:function(){if(this._isKeyFieldAvailable("conditionFrom"))return this._data.conditionFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionFrom")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getConditionTo:function(){if(this._isKeyFieldAvailable("conditionTo"))return this._data.conditionTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionTo")},getConditionType:function(){if(this._isKeyFieldAvailable("conditionType"))return this._data.conditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionType")},getContentsId:function(){if(this._isKeyFieldAvailable("contentsId"))return this._data.contentsId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: contentsId")},getLineupButtonId:function(){if(this._isKeyFieldAvailable("lineupButtonId"))return this._data.lineupButtonId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lineupButtonId")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getGachaType:function(){if(this._isKeyFieldAvailable("gachaType"))return this._data.gachaType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaType")},getGachaId:function(){if(this._isKeyFieldAvailable("gachaId"))return this._data.gachaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaId")},getCautionId:function(){if(this._isKeyFieldAvailable("cautionId"))return this._data.cautionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: cautionId")},getLimitCount:function(){if(this._isKeyFieldAvailable("limitCount"))return this._data.limitCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: limitCount")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaNormalLogoView:[function(t,e,i){"use strict";cc._RF.push(e,"6254bEWbn1FY6nZpIC1c5Yl","GachaNormalLogoView");var a=t("ResourceUtils"),n=t("TimeUtils"),o=t("Singleton"),r=t("GameConst"),s=t("CommonButton");cc.Class({extends:cc.Component,properties:{gachaLogoSprite:cc.Sprite,exchangeButton:s,rateButton:s,precautionsButton:s,gachaEndDateNode:cc.Node,gachaEndDateLabel:cc.Label,gachaEndTimeNode:cc.Node,gachaEndTimeLabel:cc.Label},_root:null,_userGachaModel:null,initGachaNormalLogoView:function(t,e){this._root=t,this._userGachaModel=e,a.addSprite(this.gachaLogoSprite,a.getFileNameGachaLogo(e.getGachaId()),void 0),this._setEndDate(),this._root.isEnabledBonusCoinGacha(this._userGachaModel)?(this.exchangeButton.node.active=!0,this.exchangeButton.setTapEvent(this._onTapExchangeBtn.bind(this))):this.exchangeButton.node.active=!1,this.rateButton.setTapEvent(this._onTapRateButton.bind(this)),this.precautionsButton.setTapEvent(this._onTapPrecautionsButton.bind(this))},_setEndDate:function(){this.gachaEndDateNode.active=!1,this.gachaEndTimeNode.active=!1;var t=this._userGachaModel.getToDate();if(this._userGachaModel.getConditionType()===r.OPEN_CONDITION_TYPE.REGISTER_DATE){var e=o.dao.userBasicData;t=n.addMinute(e.getTutorialEndDate(),this._userGachaModel.getConditionTo())}if(t&&""!==t&&"99991231235959"!==t){var i=n.getDiffMS(t),a=n.parseMsToDay(i),s=n.parseMsToHour(i),c=n.parseMsToMinute(i);a>=1?(this.gachaEndDateNode.active=!0,this.gachaEndDateLabel.string=n.parseTimeToYmdhm(t)):s>=1?(this.gachaEndTimeNode.active=!0,c-=60*s,this.gachaEndTimeLabel.string=s+"\u6642\u9593"+c+"\u5206"):(this.gachaEndTimeNode.active=!0,this.gachaEndTimeLabel.string=c+"\u5206")}},_onTapExchangeBtn:function(){this._root.transitionExchangeScene(this._userGachaModel)},_onTapRateButton:function(){this._root.openGachaProvisionRatePopup(this._userGachaModel.getGachaId())},_onTapPrecautionsButton:function(){this._root.openGachaPrecautionsPopup(this._userGachaModel.getGachaId())}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],GachaNormalRollView:[function(t,e,i){"use strict";cc._RF.push(e,"8683c/yXktKx68DGncVG9Br","GachaNormalRollView");var a=t("GachaRollViewBase"),n=t("ExchangeUtils"),o=t("GameConst"),r=t("ItemConst");cc.Class({extends:a,properties:{gachaNormalStillViewPrefab:cc.Prefab,gachaNormalLogoViewPrefab:cc.Prefab,addGachaNormalLogoViewNode:cc.Node,gachaCurrencyThumbnailPrefab:cc.Prefab,bonusCoinCurrencyThumbnailNode:cc.Node,freeGemCurrencyThumbnailNode:cc.Node,paidGemCurrencyThumbnailNode:cc.Node,gachaNormalPlayBtnViewPrefab:cc.Prefab,gachaOneDayPlayBtnViewPrefab:cc.Prefab,gachaFreeOnlyPlayBtnViewPrefab:cc.Prefab,addGachaNormalPlayBtnViewNode:cc.Node},_gachaNormalStillViewArray:null,_gachaCurrencyThumbnailArray:null,initGachaView:function(t,e){this._super(t,e)},initGachaRollView:function(){this._gachaNormalStillViewArray=[],this._userGachaModel.getBanners().forEach(function(t){var e=cc.instantiate(this.gachaNormalStillViewPrefab).getComponent("GachaNormalStillView");e.initGachaNormalStillView(this._root,this._userGachaModel.getGachaId(),t),this.loopRollView.content.addChild(e.node),this._gachaNormalStillViewArray.push(e)}.bind(this)),this._userGachaModel.getButtons().forEach(function(t){switch(t.costType){case r.ITEM_TYPE.PAID_GEM:var e=cc.instantiate(this.gachaOneDayPlayBtnViewPrefab).getComponent("GachaPlayBtnView");this._initPlayButtonView(e,t);break;case r.ITEM_TYPE.ONLY_FREE_GEM:e=cc.instantiate(this.gachaFreeOnlyPlayBtnViewPrefab).getComponent("GachaPlayBtnView");this._initPlayButtonView(e,t);break;default:var i=cc.instantiate(this.gachaNormalPlayBtnViewPrefab).getComponent("GachaPlayBtnView");i.node.name="GachaPlayBtn_Normal",this._initPlayButtonView(i,t)}}.bind(this));var t=cc.instantiate(this.gachaNormalLogoViewPrefab).getComponent("GachaNormalLogoView");t.initGachaNormalLogoView(this._root,this._userGachaModel),this.addGachaNormalLogoViewNode.addChild(t.node),this._gachaCurrencyThumbnailArray=[],this._addCurrencyThumbnail(),this.redraw()},_initPlayButtonView:function(t,e){t.initGachaPlayBtnView(e,function(){this._root.openGachaPlayConfirmPopup(e)}.bind(this)),this.addGachaNormalPlayBtnViewNode.addChild(t.node)},_addCurrencyThumbnail:function(){var t=n.getExchangePointByUserGacha(this._userGachaModel);if(t){var e=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");e.initGachaCurrencyThumbnail(this._root,t.itemId),this.bonusCoinCurrencyThumbnailNode.addChild(e.node),this._gachaCurrencyThumbnailArray.push(e)}var i=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");i.initGachaCurrencyThumbnail(this._root,o.ITEM_ID_FREE_GEM),this.freeGemCurrencyThumbnailNode.addChild(i.node),this._gachaCurrencyThumbnailArray.push(i);var a=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");a.initGachaCurrencyThumbnail(this._root,o.ITEM_ID_PAID_GEM),this.paidGemCurrencyThumbnailNode.addChild(a.node),this._gachaCurrencyThumbnailArray.push(a)},redraw:function(){this._super(),this.loopRollView.setSelectedNo(0),this._gachaCurrencyThumbnailArray.forEach(function(t){t.redraw()}),this._gachaNormalStillViewArray.forEach(function(t){t.redraw()})}});cc._RF.pop()},{ExchangeUtils:"ExchangeUtils",GachaRollViewBase:"GachaRollViewBase",GameConst:"GameConst",ItemConst:"ItemConst"}],GachaNormalStillView:[function(t,e,i){"use strict";cc._RF.push(e,"601cdK9G7pC9ZUlQXqapTqp","GachaNormalStillView");var a=t("ResourceUtils"),n=t("Singleton"),o=t("SingletonConst"),r=t("ResourceConst"),s=t("GachaConst");cc.Class({extends:cc.Component,properties:{gachaBgSprite:cc.Sprite,gachaCharacterSummaryViewPrefab:cc.Prefab,addGachaCharacterSummaryViewLeftNode:cc.Node,addGachaCharacterSummaryViewRightNode:cc.Node},_root:null,_gachaId:0,_banner:0,_isStillBgActive:!1,initGachaNormalStillView:function(t,e,i){switch(this._root=t,this._gachaId=e,this._banner=i,i.bannerType){case s.BANNER_TYPE.LEFT:(a=cc.instantiate(this.gachaCharacterSummaryViewPrefab).getComponent("GachaCharacterSummaryView")).initGachaCharacterSummaryView(t,i,this._onTapBgChangeButton.bind(this)),this.addGachaCharacterSummaryViewLeftNode.addChild(a.node);break;case s.BANNER_TYPE.RIGHT:var a;(a=cc.instantiate(this.gachaCharacterSummaryViewPrefab).getComponent("GachaCharacterSummaryView")).initGachaCharacterSummaryView(t,i,this._onTapBgChangeButton.bind(this)),this.addGachaCharacterSummaryViewRightNode.addChild(a.node);break;case s.BANNER_TYPE.NON:}this.redraw()},redraw:function(){switch(this._isStillBgActive=!1,this._banner.bannerType){case s.BANNER_TYPE.LEFT:case s.BANNER_TYPE.RIGHT:this._banner.characterId&&(this._isStillBgActive=!0)}a.addSprite(this.gachaBgSprite,this._getFileNameForGachaBg(),void 0,!0)},_onTapBgChangeButton:function(){this._isStillBgActive=!this._isStillBgActive,a.addSprite(this.gachaBgSprite,this._getFileNameForGachaBg(),void 0,!0)},_getFileNameForGachaBg:function(){return this._isStillBgActive?n[o.ENVIRONMENT].getAdultFlg()?a.getFileNameGachaBg(this._gachaId,this._banner.bannerFile)+r.GACHA_BG_PATH_SUFFIX.STAND_BG_A:a.getFileNameGachaBg(this._gachaId,this._banner.bannerFile)+r.GACHA_BG_PATH_SUFFIX.STAND_BG_N:this._banner.characterId?a.getFileNameCharacterMain(this._banner.characterId):a.getFileNameGachaBg(this._gachaId,this._banner.bannerFile)}});cc._RF.pop()},{GachaConst:"GachaConst",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaOddsModel:[function(t,e,i){"use strict";cc._RF.push(e,"788f9Hc5VpLS5Ak+fw3zlpd","GachaOddsModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getOddsId:function(){if(this._isKeyFieldAvailable("oddsId"))return this._data.oddsId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: oddsId")},getRare4:function(){if(this._isKeyFieldAvailable("rare4"))return this._data.rare4;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rare4")},getRare1:function(){if(this._isKeyFieldAvailable("rare1"))return this._data.rare1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rare1")},getRare3:function(){if(this._isKeyFieldAvailable("rare3"))return this._data.rare3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rare3")},getRare2:function(){if(this._isKeyFieldAvailable("rare2"))return this._data.rare2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rare2")},getTotal:function(){if(this._isKeyFieldAvailable("total"))return this._data.total;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: total")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaPlayBtnViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"7343cvm78dFOaQZ/biWcCvk","GachaPlayBtnViewBase");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("GachaConst");cc.Class({extends:cc.Component,properties:{gachaPlayButton:a,costSpriteArray:[cc.Sprite],countLabelArray:[cc.Label],limitedLabelArray:[cc.Label],costLabelArray:[cc.Label]},initGachaPlayBtnViewBase:function(t){this.costSpriteArray.forEach(function(e){e&&n.addSprite(e,n.getFileNameItemImage(t.costId))}),this._drawCountLabels(t),this.costLabelArray.forEach(function(e){e&&(e.string=t.costCount)}),this.gachaPlayButton.setTouchEnable(t.isPlayGacha),this.gachaPlayButton.switchBtnImage(t.isPlayGacha)},_drawCountLabels:function(t){switch(t.buttonType){case o.BUTTON_TYPE.DAILY:this.countLabelArray.forEach(function(t){t&&(t.node.active=!1)}),this.limitedLabelArray.forEach(function(t){t&&(t.node.active=!0)});break;default:this.countLabelArray.forEach(function(e){e&&(e.node.active=!0,e.string=t.drawCount)}),this.limitedLabelArray.forEach(function(t){t&&(t.node.active=!1)})}},getTapEvent:function(){return this.gachaPlayButton.getTapEvent()},setTapEvent:function(t){this.gachaPlayButton.setTapEvent(t)},setTouchEnable:function(t){this.gachaPlayButton.setTouchEnable(t)}});cc._RF.pop()},{CommonButton:"CommonButton",GachaConst:"GachaConst",ResourceUtils:"ResourceUtils"}],GachaPlayBtnView:[function(t,e,i){"use strict";cc._RF.push(e,"02fe3VymNZAFbdzOpMVuapy","GachaPlayBtnView");var a=t("GachaPlayBtnViewBase"),n=(t("CommonButton"),t("ItemConst")),o=t("ResourceUtils");cc.Class({extends:a,properties:{currencyLabelArray:[cc.Label],bonusDisplayNode:cc.Node,bonusImageSprite:cc.Sprite,bonusCountLabel:cc.Label},initGachaPlayBtnView:function(t,e){this.setTapEvent(e),this.initGachaPlayBtnViewBase(t),t.costType===n.ITEM_TYPE.PAID_GEM&&this._setCurrencyLabelText("\u6709\u511f"),this._drawBonusItem(t)},_drawBonusItem:function(t){var e=this._getBonusCoin(t);e?(this.bonusDisplayNode.active=!0,this.bonusCountLabel.string=e.itemCount+"\u500b\u304a\u307e\u3051\u4ed8\u304d!",o.addSprite(this.bonusImageSprite,o.getFileNameItemImage(e.itemId))):this.bonusDisplayNode.active=!1},_getBonusCoin:function(t){if(t)return _.find(t.coinPresent,function(t){return t.itemType===n.ITEM_TYPE.EXCHANGE_POINT})},_setCurrencyLabelText:function(t){t?_.forEach(this.currencyLabelArray,function(e){e.node.active=!0,e.string=t}):_.forEach(this.currencyLabelArray,function(t){t.node.active=!1})}});cc._RF.pop()},{CommonButton:"CommonButton",GachaPlayBtnViewBase:"GachaPlayBtnViewBase",ItemConst:"ItemConst",ResourceUtils:"ResourceUtils"}],GachaPlayConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"a2e93t30QhBzLcbCYFRp4GE","GachaPlayConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=t("Singleton"),s=t("ItemConst");cc.Class({extends:a,properties:{titleLabel:cc.Label,costCountLabel:cc.Label,rotationCountLabel:cc.Label,paidGemCountLabel:cc.Label,paidGemNode:cc.Node,freeGemCountLabel:cc.Label,freeGemNode:cc.Node,noteCostTypeNameLabel:cc.Label,noteNode:cc.Node,playBtn:n,cancelBtn:n},_root:null,_buttonData:null,_userGachaModel:null,onLoad:function(){this.playBtn.setTapEvent(this._onTapPlayBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openGachaPlayConfirmPopup:function(t,e){switch(this._root=t,this._buttonData=e,this._userGachaModel=t.gachaUserData.find(function(t){return t.getGachaId()===e.gachaId}),this.titleLabel.string=this._userGachaModel.getGachaText(),this.costCountLabel.string=e.costCount,this.rotationCountLabel.string=e.drawCount,this.freeGemNode.active=!1,this.paidGemNode.active=!1,this.noteNode.active=!1,e.costType){case s.ITEM_TYPE.FREE_GEM:this.paidGemCountLabel.string=o.convertToCommaDelimited(r.dao.userBasicData.getPaidGem()),this.paidGemNode.active=!0,this.freeGemCountLabel.string=o.convertToCommaDelimited(r.dao.userBasicData.getFreeGem()),this.freeGemNode.active=!0,this.noteNode.active=!0;break;case s.ITEM_TYPE.PAID_GEM:this.paidGemCountLabel.string=o.convertToCommaDelimited(r.dao.userBasicData.getPaidGem()),this.paidGemNode.active=!0;break;case s.ITEM_TYPE.ONLY_FREE_GEM:this.freeGemCountLabel.string=o.convertToCommaDelimited(r.dao.userBasicData.getFreeGem()),this.freeGemNode.active=!0}this.open()},_onTapPlayBtn:function(){this._root.transitionGachaLoading(this._userGachaModel.getGachaType(),this._buttonData),this.close()},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ItemConst:"ItemConst",PopupBase:"PopupBase",Singleton:"Singleton"}],GachaPrecautionsPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e2b8bvfENZAubCPVEaK/AEQ","GachaPrecautionsPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("GachaPrecautionsTabView");cc.Class({extends:a,properties:{precautionsTabView:o,okBtn:n},_root:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openGachaPrecautionsPopup:function(t,e){this._root=t,this.precautionsTabView.initGachaPrecautionsTabView(t,e),this.precautionsTabView.node.active=!1,this.open(function(){this.precautionsTabView.node.active=!0}.bind(this))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",GachaPrecautionsTabView:"GachaPrecautionsTabView",PopupBase:"PopupBase"}],GachaPrecautionsTabView:[function(t,e,i){"use strict";cc._RF.push(e,"4efd73JFcFLZY4U5HqRyHOp","GachaPrecautionsTabView");var a=t("TabViewBase"),n=cc.Enum({DESCRIPTION:0,PRECAUTIONS:1,SPECIFIED_COMMERCE:2});cc.Class({extends:a,properties:{tabContentViewNodeArray:[cc.Node],descriptionIndexLabel:cc.Label,descriptionMainLabel:cc.Label,precautionsLabel:cc.Label},_root:null,initGachaPrecautionsTabView:function(t,e){this._root=t;for(var i=0;i<this.tabContentViewNodeArray.length;i+=1)switch(i){case n.DESCRIPTION:this.descriptionIndexLabel.string=e.description.title,this.descriptionMainLabel.string=e.description.text;break;case n.PRECAUTIONS:this.precautionsLabel.string=e.caution}this.initTabViewBase(),this._initPrecautionsCurrentTab(),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this.tabContentViewNodeArray.forEach(function(t){t.active=!1}),this.tabContentViewNodeArray[t].active=!0},_initPrecautionsCurrentTab:function(){var t=n.DESCRIPTION;(this.descriptionIndexLabel.string+this.descriptionMainLabel.string).length<=0&&(this.tabBtnArray[n.DESCRIPTION].node.active=!1,t=n.PRECAUTIONS),this._setCurrentTab(t)}});cc._RF.pop()},{TabViewBase:"TabViewBase"}],GachaPresentGroupModel:[function(t,e,i){"use strict";cc._RF.push(e,"e1b32HuPLVP3ozxsKtA7bA1","GachaPresentGroupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")},getPresentGroupId:function(){if(this._isKeyFieldAvailable("presentGroupId"))return this._data.presentGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: presentGroupId")},getItemCount:function(){if(this._isKeyFieldAvailable("itemCount"))return this._data.itemCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemCount")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaProbablityRollView:[function(t,e,i){"use strict";cc._RF.push(e,"54293EEIolK9JtXSl7DGAP5","GachaProbablityRollView");var a=t("GachaRollViewBase"),n=t("ExchangeUtils"),o=t("GameConst"),r=t("ItemConst");cc.Class({extends:a,properties:{gachaNormalStillViewPrefab:cc.Prefab,gachaNormalLogoViewPrefab:cc.Prefab,addGachaNormalLogoViewNode:cc.Node,gachaCurrencyThumbnailPrefab:cc.Prefab,bonusCoinCurrencyThumbnailNode:cc.Node,freeGemCurrencyThumbnailNode:cc.Node,paidGemCurrencyThumbnailNode:cc.Node,gachaNormalPlayBtnViewPrefab:cc.Prefab,gachaOneDayPlayBtnViewPrefab:cc.Prefab,gachaFreeOnlyPlayBtnViewPrefab:cc.Prefab,addGachaNormalPlayBtnViewNode:cc.Node,currentRateLabel:cc.Label},_gachaNormalStillViewArray:null,_gachaCurrencyThumbnailArray:null,initGachaView:function(t,e){this._super(t,e)},initGachaRollView:function(){this._gachaNormalStillViewArray=[],this._userGachaModel.getBanners().forEach(function(t){var e=cc.instantiate(this.gachaNormalStillViewPrefab).getComponent("GachaNormalStillView");e.initGachaNormalStillView(this._root,this._userGachaModel.getGachaId(),t),this.loopRollView.content.addChild(e.node),this._gachaNormalStillViewArray.push(e)}.bind(this)),this._userGachaModel.getButtons().forEach(function(t){switch(t.costType){case r.ITEM_TYPE.PAID_GEM:var e=cc.instantiate(this.gachaOneDayPlayBtnViewPrefab).getComponent("GachaPlayBtnView");this._initPlayButtonView(e,t);break;case r.ITEM_TYPE.ONLY_FREE_GEM:e=cc.instantiate(this.gachaFreeOnlyPlayBtnViewPrefab).getComponent("GachaPlayBtnView");this._initPlayButtonView(e,t);break;default:var i=cc.instantiate(this.gachaNormalPlayBtnViewPrefab).getComponent("GachaPlayBtnView");i.node.name="GachaPlayBtn_Normal",this._initPlayButtonView(i,t)}}.bind(this));var t=cc.instantiate(this.gachaNormalLogoViewPrefab).getComponent("GachaNormalLogoView");t.initGachaNormalLogoView(this._root,this._userGachaModel),this.addGachaNormalLogoViewNode.addChild(t.node),this._gachaCurrencyThumbnailArray=[],this._addCurrencyThumbnail(),this.redraw()},_drawCurrentRateDisplay:function(){this._root.getGachaDetailData(this._userGachaModel.getGachaId(),function(t){t&&Array.isArray(t.odds)&&t.odds.length>0?this.currentRateLabel.string=(t.odds[0].rarity4/10).toFixed(1)+"%":this.currentRateLabel.string="3%"}.bind(this))},_initPlayButtonView:function(t,e){t.initGachaPlayBtnView(e,function(){this._root.openGachaPlayConfirmPopup(e)}.bind(this)),this.addGachaNormalPlayBtnViewNode.addChild(t.node)},_addCurrencyThumbnail:function(){var t=n.getExchangePointByUserGacha(this._userGachaModel);if(t){var e=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");_.find(this._userGachaModel.getButtons(),function(t){return this._root.isEnabledBonusCoinBtn(t)}.bind(this));e.initGachaCurrencyThumbnail(this._root,t.itemId),this.bonusCoinCurrencyThumbnailNode.addChild(e.node),this._gachaCurrencyThumbnailArray.push(e)}var i=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");i.initGachaCurrencyThumbnail(this._root,o.ITEM_ID_FREE_GEM),this.freeGemCurrencyThumbnailNode.addChild(i.node),this._gachaCurrencyThumbnailArray.push(i);var a=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");a.initGachaCurrencyThumbnail(this._root,o.ITEM_ID_PAID_GEM),this.paidGemCurrencyThumbnailNode.addChild(a.node),this._gachaCurrencyThumbnailArray.push(a)},redraw:function(){this._super(),this.loopRollView.setSelectedNo(0),this._gachaCurrencyThumbnailArray.forEach(function(t){t.redraw()}),this._gachaNormalStillViewArray.forEach(function(t){t.redraw()}),this.node.active&&this._drawCurrentRateDisplay()}});cc._RF.pop()},{ExchangeUtils:"ExchangeUtils",GachaRollViewBase:"GachaRollViewBase",GameConst:"GameConst",ItemConst:"ItemConst"}],GachaProvisionRateMenuThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"b9c71Mrk/tIjYX/NWU4Ia/H","GachaProvisionRateMenuThumbnail");var a=t("CommonButton");cc.Class({extends:cc.Component,properties:{onMenuLabel:cc.Label,offMenuLabel:cc.Label,onNode:cc.Node,offNode:cc.Node,thumbnailBtn:a},_root:null,_popup:null,_index:0,_userGachaModel:null,initGachaProvisionRateMenuThumbnail:function(t,e,i,a,n){this._root=t,this._popup=e,this._index=i,this.onMenuLabel.string=a,this.offMenuLabel.string=a,this.thumbnailBtn.setTapEvent(function(){e.selectMenuIndex=i,n()}),this.redraw()},redraw:function(){this._popup.selectMenuIndex===this._index?(this.onNode.active=!0,this.offNode.active=!1,this.thumbnailBtn.setTouchEnable(!1)):(this.offNode.active=!0,this.onNode.active=!1,this.thumbnailBtn.setTouchEnable(!0))}});cc._RF.pop()},{CommonButton:"CommonButton"}],GachaProvisionRatePopup:[function(t,e,i){"use strict";cc._RF.push(e,"1488fgzLN5Hj7PuxoMwYJlc","GachaProvisionRatePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView");cc.Class({extends:a,properties:{provisionRateMenuScrollView:o,provisionRateMenuThumbnailPrefab:cc.Prefab,addProvisionRateScrollViewNode:cc.Node,provisionRateMenuScrollViewPrefab:cc.Prefab,okBtn:n},selectMenuIndex:0,_root:null,_gachaId:null,_provisionRateMenuThumbnailArray:null,_provisionRateMenuScrollViewArray:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openGachaProvisionRatePopup:function(t,e){this._root=t,this.selectMenuIndex=0,this._provisionRateMenuThumbnailArray=[],this._provisionRateMenuScrollViewArray=[],e.odds.forEach(function(e,i){var a=cc.instantiate(this.provisionRateMenuThumbnailPrefab).getComponent("GachaProvisionRateMenuThumbnail");a.initGachaProvisionRateMenuThumbnail(t,this,i,e.name,this._onTapProvisionRateMenuThumbnail.bind(this)),this.provisionRateMenuScrollView.content.addChild(a.node),this._provisionRateMenuThumbnailArray.push(a);var n=cc.instantiate(this.provisionRateMenuScrollViewPrefab).getComponent("GachaProvisionRateScrollView");n.initGachaProvisionRateScrollView(t,this,i,e),this.addProvisionRateScrollViewNode.addChild(n.node),this._provisionRateMenuScrollViewArray.push(n)}.bind(this)),this.provisionRateMenuScrollView.node.active=!1,this.addProvisionRateScrollViewNode.active=!1,this.open(function(){this.provisionRateMenuScrollView.node.active=!0,this.addProvisionRateScrollViewNode.active=!0}.bind(this))},_onTapProvisionRateMenuThumbnail:function(){this._provisionRateMenuThumbnailArray.forEach(function(t){t.redraw()}),this._provisionRateMenuScrollViewArray.forEach(function(t){t.redraw()})},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",PopupBase:"PopupBase"}],GachaProvisionRateScrollViewCharacterRateThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"28430zRHmBERK+Et8zZA+ka","GachaProvisionRateScrollViewCharacterRateThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("CharacterUtils"),r=t("GachaConst");cc.Class({extends:cc.Component,properties:{characterThumbnailSprite:cc.Sprite,attributeSprite:cc.Sprite,natureSprite:cc.Sprite,appearanceNode:cc.Node,characterNameLabel:cc.Label,skinNameLabel:cc.Label,rateLabel:cc.Label,detailBtn:a},_root:null,_characterMainMaster:null,initGachaProvisionRateScrollViewCharacterRateThumbnail:function(t,e,i){if(this._root=t,this._characterMainMaster=o.getCharacterMainModelByCharacterId(e.itemId),this._characterMainMaster){n.addSprite(this.characterThumbnailSprite,n.getFileNameCharacterThumbnail(this._characterMainMaster.getCharacterId()),void 0),n.addSprite(this.attributeSprite,n.getFileNameAttributeIcon(this._characterMainMaster.getAttribute()),void 0),this.appearanceNode.active=e.iconType===r.RATE_TYPE.APPEARANCE_RATE,this.characterNameLabel.string=this._characterMainMaster.getShortName(),this.skinNameLabel.string="["+this._characterMainMaster.getSkinName()+"]";var s=i*e.rate/10;this.rateLabel.string=""+(Math.floor(1e4*s)/1e4).toFixed(3),this.detailBtn.setTapEvent(this._onTapDetailBtn.bind(this),a.SE_NAME.SELECT)}},_onTapDetailBtn:function(){this._root.openGachaCharacterDetailPopup(this._characterMainMaster.getCharacterId())}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",GachaConst:"GachaConst",ResourceUtils:"ResourceUtils"}],GachaProvisionRateScrollViewRarityThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"7faedHygypKv5x3D5SYmbIo","GachaProvisionRateScrollViewRarityThumbnail");var a=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{raritySprite:cc.Sprite},_root:null,initGachaProvisionRateScrollViewRarityThumbnail:function(t,e){this._root=t,a.addSprite(this.raritySprite,a.getFileNameRarityStrSIcon(e),void 0)}});cc._RF.pop()},{ResourceUtils:"ResourceUtils"}],GachaProvisionRateScrollView:[function(t,e,i){"use strict";cc._RF.push(e,"a33f9MoIxNC9aDpfV9CvdEt","GachaProvisionRateScrollView");var a=t("CommonScrollView"),n="GachaProvisionRateScrollViewRarityThumbnail";cc.Class({extends:cc.Component,properties:{provisionRateMenuScrollView:a,provisionRateScrollViewRarityThumbnailPrefab:cc.Prefab,GachaProvisionRateScrollViewCharacterRateThumbnailPrefab:cc.Prefab,ssrRateLabel:cc.Label,srRateLabel:cc.Label,rRateLabel:cc.Label,nRateLabel:cc.Label},_root:null,_popup:null,_index:0,initGachaProvisionRateScrollView:function(t,e,i,a){this._root=t,this._popup=e,this._index=i,t.deleteUpdateCallbackKey(n+i,function(){this.provisionRateMenuScrollView.content.destroyAllChildren()}.bind(this));var o=_.cloneDeep(this._getSortLineup(a.lineup)),r=0,s=0;t.setUpdateCallback(function(){var e=o[r];if(!this.GachaProvisionRateScrollViewCharacterRateThumbnailPrefab||!this.provisionRateScrollViewRarityThumbnailPrefab)return!0;if(!e)return!0;if(0!==a["rarity"+e.rarity]){if(0===s){var i=cc.instantiate(this.provisionRateScrollViewRarityThumbnailPrefab).getComponent("GachaProvisionRateScrollViewRarityThumbnail");i.initGachaProvisionRateScrollViewRarityThumbnail(t,e.rarity),this.provisionRateMenuScrollView.content.addChild(i.node)}var n=e.items[s];if(n){var c=cc.instantiate(this.GachaProvisionRateScrollViewCharacterRateThumbnailPrefab).getComponent("GachaProvisionRateScrollViewCharacterRateThumbnail");c.initGachaProvisionRateScrollViewCharacterRateThumbnail(t,n,a["rarity"+e.rarity]),this.provisionRateMenuScrollView.content.addChild(c.node),s+=1}else s=0,r+=1}return!1}.bind(this),n+i),this.ssrRateLabel.string=""+(a.rarity4/10).toFixed(1),this.srRateLabel.string=""+(a.rarity3/10).toFixed(1),this.rRateLabel.string=""+(a.rarity2/10).toFixed(1),this.nRateLabel.string=""+(a.rarity1/10).toFixed(1),this.redraw()},redraw:function(){this.node.active=this._popup.selectMenuIndex===this._index},_getSortLineup:function(t){var e=t.slice();return e.sort(function(t,e){return t.rarity<e.rarity?1:-1}),e},onDestroy:function(){this._root&&this._root.deleteUpdateCallbackKey(n+this._index,null)}});cc._RF.pop()},{CommonScrollView:"CommonScrollView"}],GachaResultBtnViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"59af1AVNWRARKLcBCw/cy7z","GachaResultBtnViewBase");var a=t("Singleton"),n=t("CommonButton"),o=t("GameConst"),r=t("ItemConst"),s=t("CommonUtils"),c=t("LocalDataConst"),l=t("TutorialUtils"),u=t("TutorialConst");cc.Class({extends:cc.Component,properties:{againNode:cc.Node,gemReturnBtn:n,gemAgainBtn:n,gemCostLabelArray:[cc.Label],replayNode:cc.Node,replayCountLabel:cc.Label,replayBtn:n,decideBtn:n,otherNode:cc.Node,otherReturnBtn:n,gachaCurrencyThumbnailPrefab:cc.Prefab,gachaCurrencyThumbnailLayout:cc.Layout},_root:null,_isEnabledRequestBtns:!1,initGachaResultBtnView:function(t,e){this._root=t,this._inactiveAllBtnView(),this._removeCurrencyThumbnail(),e.isCanReplay?this._initReplayView(e):e.afterButtonData&&this._root.getGachaType()>0&&e.afterButtonData.isPlayGacha?this._initSwitchBtnView(e):this._initOtherView(),this._isEnabledRequestBtns=!0},_removeCurrencyThumbnail:function(){this.gachaCurrencyThumbnailLayout.node.destroyAllChildren()},_initCurrencyThumbnail:function(t){Array.isArray(t)&&t.forEach(function(t){this.gachaCurrencyThumbnailLayout.node.addChild(this._createCurrencyThumbnail(t).node)}.bind(this))},_createCurrencyThumbnail:function(t){var e=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");return e.initGachaCurrencyThumbnail(this._root,t),e},_inactiveAllBtnView:function(){cc.warn("_inactiveAllBtnView\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),this.againNode.active=!1,this.replayNode.active=!1,this.otherNode.active=!1},_initSwitchBtnView:function(t){switch(cc.warn("_initSwitchBtnView\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),t.afterButtonData.costType){case r.ITEM_TYPE.FREE_GEM:case r.ITEM_TYPE.PAID_GEM:this._initAgainView(t);break;default:this._initOtherView()}},_initAgainView:function(t){this.againNode.active=!0,this.gemReturnBtn.setTapEvent(this._onTapReturnEvent.bind(this)),this.gemAgainBtn.setTapEvent(function(){a.soundManager.stopLoopSe(),this._root.transitionGachaLoadingRoot()}.bind(this));var e=[o.ITEM_ID_PAID_GEM],i=0;t.afterButtonData.costType!==r.ITEM_TYPE.PAID_GEM?(e.unshift(o.ITEM_ID_FREE_GEM),i=a.dao.userBasicData.getGem()):i=a.dao.userBasicData.getPaidGem(),this._initCurrencyThumbnail(e),this.gemAgainBtn.switchBtnImage(i>=t.afterButtonData.costCount),this.gemAgainBtn.setTouchEnable(i>=t.afterButtonData.costCount),this.gemCostLabelArray.forEach(function(e){e.string=s.convertToCommaDelimited(t.afterButtonData.costCount)})},_initReplayView:function(t){this.replayNode.active=!0,this.replayCountLabel.string=t.remainReplayCount.toString(),this.replayBtn.setTapEvent(this._onTapReplayEvent.bind(this)),this.decideBtn.setTapEvent(this._onTapDecideEvent.bind(this)),l.isTutorialGachaReplayFirst()?(a.localData[c.TUTORIAL_SUB_STEP]=u.SUB_STEP_ORIGIN,l.startTutorialAdv()):a.localData[c.TUTORIAL_SUB_STEP]=u.SUB_STEP_DISABLE},_initOtherView:function(){this.otherNode.active=!0,this.otherReturnBtn.setTapEvent(this._onTapReturnEvent.bind(this))},_onTapReturnEvent:function(){this._isEnabledRequestBtns&&(this._isEnabledRequestBtns=!1,a.soundManager.stopLoopSe(),a.localData[c.IS_EXIST_GACHA_SESSION]=!1,this._root.popScene())},_onTapReplayEvent:function(){this._isEnabledRequestBtns&&(this._isEnabledRequestBtns=!1,a.soundManager.stopLoopSe(),a.localData[c.IS_EXIST_GACHA_SESSION]=!0,this._root.replay())},_onTapDecideEvent:function(){this._isEnabledRequestBtns&&(this._isEnabledRequestBtns=!1,a.soundManager.stopLoopSe(),a.localData[c.IS_EXIST_GACHA_SESSION]=!1,this._root.decide())}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",Singleton:"Singleton",TutorialConst:"TutorialConst",TutorialUtils:"TutorialUtils"}],GachaResultCardView:[function(t,e,i){"use strict";cc._RF.push(e,"b8241XzGYtGfaNLBtj1Ev3A","GachaResultCardView");t("CommonButton"),t("ItemConst"),t("ItemUtils"),t("CommonUtils");var a=t("Singleton"),n=t("PopupUtils"),o=t("GachaConst");cc.Class({extends:cc.Component,properties:{cardLayoutHorizontalViewPrefab:cc.Prefab,cardLayoutVerticalNode:cc.Node,btnViewNode:cc.Node,gachaResultNormalBtnViewPrefab:cc.Prefab,gachaResultStepUpBtnViewPrefab:cc.Prefab,gachaResultTicketBtnViewPrefab:cc.Prefab},_root:null,initGachaResultCardView:function(t,e,i){this._isLimitOver(e.getCharacters)&&n.openCommonPopupOk("\u30e6\u30cb\u30c3\u30c8\u30dc\u30c3\u30af\u30b9\u4e0a\u9650","\u30e6\u30cb\u30c3\u30c8\u30dc\u30c3\u30af\u30b9\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u305f\u305f\u3081\u3001\n\u4eca\u56de\u7372\u5f97\u3057\u305f\u30e6\u30cb\u30c3\u30c8\u306f\u5168\u3066\u30ae\u30d5\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u9001\u3089\u308c\u307e\u3057\u305f\u3002","\u53d7\u3051\u53d6\u308a\u671f\u9650\u306f\u7121\u671f\u9650\u3067\u3059\u3002",!0),this._root=t;for(var a=e.cardList.slice().reverse(),o=[],r=0;r<a.length;r+=4)o.unshift(a.slice(r,r+4).reverse());this.cardLayoutVerticalNode.active=!0;for(var s=0;s<o.length;s+=1){var c=cc.instantiate(this.cardLayoutHorizontalViewPrefab).getComponent("GachaCardLayoutHorizontalView");this.cardLayoutVerticalNode.addChild(c.node),s===o.length-1?c.initGachaCardLayoutHorizontalView(t,o[s],i):c.initGachaCardLayoutHorizontalView(t,o[s],function(){})}this._initResultBtnView(e)},_initResultBtnView:function(t){var e=null;switch(this._root.getGachaType()){case o.GACHA_TYPE.STEP_UP:e=cc.instantiate(this.gachaResultStepUpBtnViewPrefab).getComponent("GachaResultStepUpBtnView");break;case o.GACHA_TYPE.TICKET:e=cc.instantiate(this.gachaResultTicketBtnViewPrefab).getComponent("GachaResultTicketBtnView");break;case o.GACHA_TYPE.NORMAL:default:e=cc.instantiate(this.gachaResultNormalBtnViewPrefab).getComponent("GachaResultNormalBtnView")}e&&(e.initGachaResultBtnView(this._root,t),this.btnViewNode.addChild(e.node))},_isLimitOver:function(t){return!(t.length<=0)&&!_.find(a.dao.userCharacters,function(e){return e.getCharacterCd()===t[0].characterCd})}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GachaConst:"GachaConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupUtils:"PopupUtils",Singleton:"Singleton"}],GachaResultNormalBtnView:[function(t,e,i){"use strict";cc._RF.push(e,"ff3cahlKhRHgK4OHiMnflII","GachaResultNormalBtnView");var a=t("GachaResultBtnViewBase"),n=t("ItemConst");cc.Class({extends:a,properties:{},_inactiveAllBtnView:function(){this.againNode.active=!1,this.replayNode.active=!1,this.otherNode.active=!1},_initSwitchBtnView:function(t){switch(t.afterButtonData.costType){case n.ITEM_TYPE.FREE_GEM:case n.ITEM_TYPE.PAID_GEM:this._initAgainView(t);break;default:this._initOtherView()}}});cc._RF.pop()},{GachaResultBtnViewBase:"GachaResultBtnViewBase",ItemConst:"ItemConst"}],GachaResultStepUpBtnView:[function(t,e,i){"use strict";cc._RF.push(e,"33dffp2T95LO4xfYZDZrEG4","GachaResultStepUpBtnView");var a=t("GachaResultBtnViewBase"),n=t("ItemConst");cc.Class({extends:a,properties:{stepUpBalloon:cc.Node,stepUpCountLabel:cc.Label},_inactiveAllBtnView:function(){this.againNode.active=!1,this.replayNode.active=!1,this.otherNode.active=!1,this.stepUpBalloon.active=!1},_initSwitchBtnView:function(t){switch(t.afterButtonData.costType){case n.ITEM_TYPE.FREE_GEM:case n.ITEM_TYPE.PAID_GEM:this._initAgainView(t),this._initStepUpBalloonView(t);break;default:this._initOtherView()}},_initStepUpBalloonView:function(t){this.stepUpBalloon.active=!0,this.stepUpCountLabel.string=t.afterButtonData.step.toString()+" \u56de\u76ee"}});cc._RF.pop()},{GachaResultBtnViewBase:"GachaResultBtnViewBase",ItemConst:"ItemConst"}],GachaResultTicketBtnView:[function(t,e,i){"use strict";cc._RF.push(e,"50436ehhHZGXL3OFgjcU9XU","GachaResultTicketBtnView");var a=t("GachaResultBtnViewBase"),n=t("Singleton"),o=t("CommonButton"),r=t("ItemConst"),s=t("ItemUtils"),c=t("CommonUtils"),l=t("ResourceUtils");cc.Class({extends:a,properties:{ticketNode:cc.Node,ticketReturnBtn:o,ticketAgainBtn:o,ticketCostLabelArray:[cc.Label],ticketCostSpriteArray:[cc.Sprite],ticketLabel:cc.Label,ticketSprite:cc.Sprite},_inactiveAllBtnView:function(){this.againNode.active=!1,this.replayNode.active=!1,this.otherNode.active=!1,this.ticketNode.active=!1},_initSwitchBtnView:function(t){switch(t.afterButtonData.costType){case r.ITEM_TYPE.FREE_GEM:case r.ITEM_TYPE.PAID_GEM:this._initAgainView(t);break;case r.ITEM_TYPE.GACHA_TICKET:this._initTicketView(t);break;default:this._initOtherView()}},_initTicketView:function(t){this.ticketNode.active=!0;var e=s.getUserItemCount(t.afterButtonData.costId);this.ticketLabel.string=e,l.addSprite(this.ticketSprite,l.getFileNameItemImage(t.afterButtonData.costId),void 0),this.ticketReturnBtn.setTapEvent(this._onTapReturnEvent.bind(this)),this.ticketAgainBtn.setTapEvent(function(){n.soundManager.stopLoopSe(),this._root.transitionGachaLoadingRoot()}.bind(this)),this.ticketAgainBtn.switchBtnImage(e>=t.afterButtonData.costCount),this.ticketAgainBtn.setTouchEnable(e>=t.afterButtonData.costCount),this.ticketCostLabelArray.forEach(function(e){e.string=c.convertToCommaDelimited(t.afterButtonData.costCount)}),this.ticketCostSpriteArray.forEach(function(e){l.addSprite(e,l.getFileNameItemImage(t.afterButtonData.costId),void 0)})}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GachaResultBtnViewBase:"GachaResultBtnViewBase",ItemConst:"ItemConst",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],GachaRewardReceivePopup:[function(t,e,i){"use strict";cc._RF.push(e,"a0183jogPtEo5dhJk56f6/5","GachaRewardReceivePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=t("ItemUtils");cc.Class({extends:a,properties:{simpleThumbnailPrefab:cc.Prefab,scrollView:o,okBtn:n},_callback:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openGachaRewardReceivePopup:function(t,e){this.setCloseCallBack(e),this.scrollView.content.destroyAllChildren();for(var i=0;i<t.length;i+=1){var a=cc.instantiate(this.simpleThumbnailPrefab).getComponent("SimpleThumbnail"),n=r.getItemInfo(t[i].getItemType(),t[i].getItemId());a.initSimpleThumbnail(n.name,t[i].getCount()),this.scrollView.content.addChild(a.node)}this.scrollView.node.active=!1,this.open(function(){this.scrollView.node.active=!0})},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],GachaRollViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"ebb616J/jFCHq+v6jYo0Hbv","GachaRollViewBase");var a=t("CommonButton"),n=t("GachaViewBase"),o=t("LoopRollView");cc.Class({extends:n,properties:{loopRollView:o,leftButton:a,rightButton:a},initGachaView:function(t,e){this._super(t,e),this.initGachaRollView(),this.loopRollView.content.children.length>1?(this.leftButton.setTapEvent(this._onTapLeftBtn.bind(this),a.SE_NAME.COUNT),this.rightButton.setTapEvent(this._onTapRightBtn.bind(this),a.SE_NAME.COUNT)):(this.leftButton.node.active=!1,this.rightButton.node.active=!1)},initGachaRollView:function(){cc.warn("initGachaRollView()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_onTapLeftBtn:function(){this.loopRollView.moveToLeft()},_onTapRightBtn:function(){this.loopRollView.moveToRight()}});cc._RF.pop()},{CommonButton:"CommonButton",GachaViewBase:"GachaViewBase",LoopRollView:"LoopRollView"}],GachaRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"37656xybwpO/oxNkyr2S3XG","GachaRootUtils"),e.exports={openGachaTopSubRoot:function(t,e){cc.log("openGachaTopSubRoot"),cc.log(e),t.gachaTopSubRoot||(t.gachaTopSubRoot=cc.instantiate(t.gachaTopSubRootPrefab).getComponent("GachaTopSubRoot"),t.subRootParent.addChild(t.gachaTopSubRoot.node)),t.setSelectGachaId(e.selectGachaId),t.gachaTopSubRoot.initGachaTopSubRoot(t,e.isLoadSession)},closeGachaTopSubRoot:function(t,e){cc.log("closeGachaTopSubRoot"),cc.log(e),t.gachaTopSubRoot&&(t.gachaTopSubRoot.node.destroy(),t.gachaTopSubRoot=null)}},cc._RF.pop()},{}],GachaRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ca2b4Wm0CtH9qXcNBzIdNkt","GachaRoot");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("LocalDataConst"),r=t("ItemUtils"),s=t("ItemConst"),c=t("PopupUtils"),l=t("GameConst"),u=t("TimeUtils"),h=t("UserUtils"),d=t("ViewUtils"),p=t("GachaRootUtils"),m=t("GachaConst"),g=t("ExchangeUtils"),C=t("ExchangeConst"),f=t("CommonUtils"),E=t("GachaViewSetting");cc.Class({extends:a,properties:{gachaTopSubRootPrefab:cc.Prefab,characterDetailPopupPrefab:cc.Prefab,provisionRatePopupPrefab:cc.Prefab,precautionsPopupPrefab:cc.Prefab,gachaPlayConfirmPopupPrefab:cc.Prefab,gachaTicketPlayConfirmPopupPrefab:cc.Prefab},gachaUserData:null,selectGachaId:0,_gachaCharacterDetailPopup:null,_gachaProvisionRatePopup:null,_gachaPrecautionsPopup:null,_gachaPlayConfirmPopup:null,_gachaTicketPlayConfirmPopup:null,_gachaOddsMap:null,onLoad:function(){this._addBG(),this._addUIHeader(),this._addBackBtn(),this._addBand(),this._setTapEffect()},_getSceneBgmName:function(){return l.BGM.GACHA},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,E.GACHA_SETTING)},reload:function(t){this.requestURLCount++,this.getGachaList(function(){if(this.gachaUserData=this._filterSortGachaUserData(n.dao.userGacha),this.requestURLCount--,t)return t()}.bind(this))},redraw:function(){this.redrawUIHeader(),p.openGachaTopSubRoot(this,{selectGachaId:0})},initData:function(){this._gachaOddsMap={},this._initGachaRootData()},_initGachaRootData:function(){this.requestURLCount+=1,this.reload(function(){var t;if(this.sceneParam){var e=JSON.parse(this.sceneParam);t=e[Object.keys(e)[0]]}var i=0;if(t&&_.some(this.gachaUserData,function(e){return e.getGachaId()===t.selectGachaId}))i=t.selectGachaId;else{if(!(this.gachaUserData.length>0))return;i=this.gachaUserData[0].getGachaId()}this.getGachaDetailData(i,function(){this.requestURLCount-=1}.bind(this))}.bind(this))},initialize:function(){this.initOutGameRootBase(),this._checkPaymentSession()},_checkPaymentSession:function(){var t=n.localData[o.PAYMENT_SESSION];if(t){d.addPaymentWaitLayer();var e={GachaTopSubRoot:{selectGachaId:t.saveData.gachaId}};this._initOpenFirstView(e);this.pushScene("GachaLoadingScene",this.getCurrentSceneName(),{isPaymentResult:!0},e)}else this._initOpenFirstView({GachaTopSubRoot:{selectGachaId:0}})},setSelectGachaId:function(t){var e=this.gachaUserData.find(function(e){return e.getGachaId()===t});this.selectGachaId=e?e.getGachaId():this.gachaUserData[0].getGachaId()},transitionGachaLoading:function(t,e){var i={gachaType:t,buttonData:e},a={GachaTopSubRoot:{selectGachaId:e.gachaId}};this.pushScene("GachaLoadingScene",this.getCurrentSceneName(),i,a)},transitionShopScene:function(t){var e={ShopSelectSubRoot:{shopCategory:s.SHOP_CATEGORY.GEM}},i={GachaTopSubRoot:{selectGachaId:t}};this.pushScene("ShopScene",this.getCurrentSceneName(),e,i)},transitionExchangeScene:function(t){var e=g.getExchangePointByUserGacha(t),i={ExchangeSubRoot:{exchangeId:e?g.convertCostItemToExchangeId(e.itemType,e.itemId):C.EXCHANGE_TAB_TYPE.R_L_YEH}},a={GachaTopSubRoot:{selectGachaId:t.getGachaId()}};this.clearScene(),this.pushScene("ExchangeScene",this.getCurrentSceneName(),i,a)},openGachaCharacterDetailPopup:function(t){this._closeGachaCharacterDetailPopup(),this._gachaCharacterDetailPopup=cc.instantiate(this.characterDetailPopupPrefab).getComponent("GachaCharacterDetailPopup"),this._gachaCharacterDetailPopup.openGachaCharacterDetailPopup(this,t)},_closeGachaCharacterDetailPopup:function(){this._gachaCharacterDetailPopup&&(this._gachaCharacterDetailPopup.close(),this._gachaCharacterDetailPopup=null)},openGachaProvisionRatePopup:function(t){this.getGachaDetailData(t,function(t){this._closeGachaProvisionRatePopup(),this._gachaProvisionRatePopup=cc.instantiate(this.provisionRatePopupPrefab).getComponent("GachaProvisionRatePopup"),this._gachaProvisionRatePopup.openGachaProvisionRatePopup(this,t)}.bind(this))},_closeGachaProvisionRatePopup:function(){this._gachaProvisionRatePopup&&(this._gachaProvisionRatePopup.close(),this._gachaProvisionRatePopup=null)},openGachaPrecautionsPopup:function(t){this.getGachaDetailData(t,function(t){this._closeGachaPrecautionsPopup(),this._gachaPrecautionsPopup=cc.instantiate(this.precautionsPopupPrefab).getComponent("GachaPrecautionsPopup"),this._gachaPrecautionsPopup.openGachaPrecautionsPopup(this,t)}.bind(this))},_closeGachaPrecautionsPopup:function(){this._gachaPrecautionsPopup&&(this._gachaPrecautionsPopup.close(),this._gachaPrecautionsPopup=null)},openGachaPlayConfirmPopup:function(t){if(this._checkOpenCondition(t))if(this._checkCost(t)){if(!this._checkPayment(t))return this._closeGachaPlayConfirmPopup(),this._gachaPlayConfirmPopup=cc.instantiate(this.gachaPlayConfirmPopupPrefab).getComponent("GachaPlayConfirmPopup"),void this._gachaPlayConfirmPopup.openGachaPlayConfirmPopup(this,t);var e=this.gachaUserData.find(function(e){return e.getGachaId()===t.gachaId});this.transitionGachaLoading(e.getGachaType(),t)}else{var i=r.getItemMaster(t.costId),a="";if(i){switch(t.costType){case s.ITEM_TYPE.FREE_GEM:a="\u5e7b\u5922\u77f3";break;case s.ITEM_TYPE.PAID_GEM:a="\u5e7b\u5922\u77f3\uff08\u6709\u511f\uff09";break;case s.ITEM_TYPE.ONLY_FREE_GEM:a="\u5e7b\u5922\u77f3\uff08\u7121\u511f\uff09";break;default:a=i.getName()}a+="\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002"}else a="\u5fc5\u8981\u306a\u30a2\u30a4\u30c6\u30e0\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002";c.openCommonPopupYesNo("\u6240\u6301\u30a2\u30a4\u30c6\u30e0\u78ba\u8a8d",a,void 0,!1,function(){this.transitionShopScene(t.gachaId)}.bind(this),void 0,"\u30b7\u30e7\u30c3\u30d7\u3078","\u30ad\u30e3\u30f3\u30bb\u30eb")}else c.openCommonPopupOk("\u958b\u50ac\u671f\u9593\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002","\u5bfe\u8c61\u306e\u30ac\u30c1\u30e3\u306f\u73fe\u5728\u958b\u50ac\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",void 0,!1,function(){this.reload(this.redraw.bind(this))}.bind(this),void 0)},_closeGachaPlayConfirmPopup:function(){this._gachaPlayConfirmPopup&&(this._gachaPlayConfirmPopup.close(),this._gachaPlayConfirmPopup=null)},openGachaTicketPlayConfirmPopup:function(t){this._checkOpenCondition(t)?this._checkCost(t)?(this._closeGachaTicketPlayConfirmPopup(),this._gachaTicketPlayConfirmPopup=cc.instantiate(this.gachaTicketPlayConfirmPopupPrefab).getComponent("GachaTicketPlayConfirmPopup"),this._gachaTicketPlayConfirmPopup.openGachaTicketPlayConfirmPopup(this,t)):c.openCommonPopupOk("\u30a2\u30a4\u30c6\u30e0\u304c\u8db3\u308a\u307e\u305b\u3093",r.getItemMaster(t.costId).getName(),void 0,!1,function(){this.reload(this.redraw.bind(this))}.bind(this)):c.openCommonPopupOk("\u958b\u50ac\u671f\u9593\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002","\u5bfe\u8c61\u306e\u30ac\u30c1\u30e3\u306f\u73fe\u5728\u958b\u50ac\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",void 0,!1,function(){this.reload(this.redraw.bind(this))}.bind(this),void 0)},_closeGachaTicketPlayConfirmPopup:function(){this._gachaTicketPlayConfirmPopup&&(this._gachaTicketPlayConfirmPopup.close(),this._gachaTicketPlayConfirmPopup=null)},_checkCost:function(t){switch(t.costType){case s.ITEM_TYPE.DMM_POINT:return!0;case s.ITEM_TYPE.PAID_GEM:return n.dao.userBasicData.getPaidGem()>=t.costCount;case s.ITEM_TYPE.FREE_GEM:return n.dao.userBasicData.getGem()>=t.costCount;case s.ITEM_TYPE.ONLY_FREE_GEM:return n.dao.userBasicData.getFreeGem()>=t.costCount;default:return r.getUserItemCount(t.costId)>=t.costCount}},_checkOpenCondition:function(t){var e=this.gachaUserData.find(function(e){return e.getGachaId()===t.gachaId});return!!u.isRangeOfDate(e.getFromDate(),e.getToDate())&&h.checkOpenCondition(e.getConditionType(),e.getConditionFrom(),e.getConditionTo())},_checkPayment:function(t){return t.costType===s.ITEM_TYPE.DMM_POINT},getGachaList:function(t){n.GachaService.getList(function(e){if(t)return t()})},getGachaDetailData:function(t,e){if(this._gachaOddsMap[t]){if(e)return e(this._gachaOddsMap[t])}else n.GachaService.getDetail(t,function(i){if(this._gachaOddsMap[t]=i,e)return e(this._gachaOddsMap[t])}.bind(this))},isEnabledBonusCoinGacha:function(t){return!!t&&_.some(t.getButtons(),function(t){return this.isEnabledBonusCoinBtn(t)}.bind(this))},isEnabledBonusCoinBtn:function(t){return!!t&&_.some(t.coinPresent,function(t){return t.itemType===s.ITEM_TYPE.EXCHANGE_POINT})},loadGachaSession:function(){this.pushScene("GachaLoadingScene",this.getCurrentSceneName(),{isLoadSession:!0},{GachaTopSubRoot:{selectGachaId:0}})},_filterSortGachaUserData:function(t){return f.sortModels(_.filter(t,function(t){switch(t.getGachaType()){case m.GACHA_TYPE.TICKET:return this._existTicketGachaItem(t.getButtons());default:return!0}}.bind(this)),[{getterName:"getOrder"}])},_existTicketGachaItem:function(t){return t.some(function(t){return r.getUserItemCount(t.costId)>0})}});cc._RF.pop()},{CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ExchangeUtils:"ExchangeUtils",GachaConst:"GachaConst",GachaRootUtils:"GachaRootUtils",GachaViewSetting:"GachaViewSetting",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",UserUtils:"UserUtils",ViewUtils:"ViewUtils"}],GachaService:[function(t,e,i){"use strict";cc._RF.push(e,"c8194A1ELdFzoGqZVTTY7VK","GachaService");var a=t("BaseService"),n=t("ApiConstants"),o=(t("CommonUtils"),t("NetworkUtils"),t("Singleton")),r=t("SingletonConst");cc.Class({extends:a,getList:function(t){this._requestCallApi(n.GACHA_GET_LIST,{},function(e,i){return t(e?void 0:i)})},getDetail:function(t,e){var i={gachaId:t};this._requestCallApi(n.GACHA_GET_DETAIL,i,function(t,i){return e(t?void 0:i)})},play:function(t,e,i,a,s,c){var l=o[r.ENVIRONMENT];if(0!==s&&l.isDmmPlatform())this._requestPayment(s,a,function(t,e){return c(t?void 0:e)});else{var u={gachaGroupId:t,gachaId:e,buttonId:i,count:a};this._requestCallApi(n.GACHA_PLAY,u,function(t,e){return c(t?void 0:e)})}},replay:function(t){this._requestCallApi(n.GACHA_REPLAY,{},function(e,i){return t(e?void 0:i)})},decide:function(t){this._requestCallApi(n.GACHA_DECIDE,{},function(e,i){return t(e?void 0:i)})},loadSession:function(t){this._requestCallApi(n.GACHA_LOAD_SESSION,{},function(e,i){return t(e?void 0:i)})},getBoxDetail:function(t,e){var i={gachaId:t};this._requestCallApi(n.BOX_GACHA_DETAIL,i,function(t,i){return e(t?void 0:i)})},playBox:function(t,e,i,a,s,c){var l=o[r.ENVIRONMENT];if(0!==a&&l.isDmmPlatform())this._requestPayment(a,i,function(t,e){return c(t?void 0:e)});else{var u={gachaId:t,buttonId:e,count:i,isGetResetStop:s};this._requestCallApi(n.BOX_GACHA_PLAY,u,function(t,e){return c(t?void 0:e)})}},resetBox:function(t,e){var i={gachaId:t};this._requestCallApi(n.BOX_GACHA_RESET,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService",CommonUtils:"CommonUtils",NetworkUtils:"NetworkUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaSideBannerThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"a100e0j9RlDMrJmsC0O04CX","GachaSideBannerThumbnail");var a=t("Singleton"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("TimeUtils"),s=t("ViewUtils"),c=t("GameConst"),l=t("GachaConst"),u={POSITION:cc.v2(90,40),SCALE:cc.v2(1,1)};cc.Class({extends:cc.Component,properties:{bannerSprite:cc.Sprite,highlightNode:cc.Node,thumbnailBtn:n,remainingDateNode:cc.Node,remainingDateLabel:cc.Label,remainingTimeNode:cc.Node,remainingTimeLabel:cc.Label},_root:null,_userGachaModel:null,initGachaSideBannerThumbnail:function(t,e,i){this._root=t,this._userGachaModel=e,e.getGachaType()===l.GACHA_TYPE.TICKET&&s.addNoticeBadge(this.node,u.POSITION,u.SCALE),o.addSprite(this.bannerSprite,o.getFileNameGachaBanner(e.getGachaId()),void 0),this.thumbnailBtn.setTapEvent(function(){t.setSelectGachaId(e.getGachaId()),i(e)}),this.redraw()},redraw:function(){this._root.selectGachaId===this._userGachaModel.getGachaId()?(this.highlightNode.active=!0,this.thumbnailBtn.setTouchEnable(!1)):(this.highlightNode.active=!1,this.thumbnailBtn.setTouchEnable(!0)),this._setRemainingNode()},_setRemainingNode:function(){this.remainingDateNode.active=!1,this.remainingTimeNode.active=!1;var t=this._userGachaModel.getToDate();if(this._userGachaModel.getConditionType()===c.OPEN_CONDITION_TYPE.REGISTER_DATE){var e=a.dao.userBasicData;t=r.addMinute(e.getTutorialEndDate(),this._userGachaModel.getConditionTo())}if(t&&""!==t&&"99991231235959"!==t){var i=r.getDiffMS(t),n=r.parseMsToDay(i),o=r.parseMsToHour(i),s=r.parseMsToMinute(i);n>=1?(this.remainingDateNode.active=!0,this.remainingDateLabel.string="\u6b8b\u308a"+n+"\u65e5"):o>=1?(this.remainingTimeNode.active=!0,s-=60*o,this.remainingTimeLabel.string="\u6b8b\u308a"+o+"\u6642\u9593"+s+"\u5206"):(this.remainingTimeNode.active=!0,this.remainingTimeLabel.string="\u6b8b\u308a"+s+"\u5206")}}});cc._RF.pop()},{CommonButton:"CommonButton",GachaConst:"GachaConst",GameConst:"GameConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",ViewUtils:"ViewUtils"}],GachaStepModel:[function(t,e,i){"use strict";cc._RF.push(e,"4be779zq2dNHoX2j1PmKKu6","GachaStepModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getOddsId:function(){if(this._isKeyFieldAvailable("oddsId"))return this._data.oddsId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: oddsId")},getButtonId:function(){if(this._isKeyFieldAvailable("buttonId"))return this._data.buttonId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: buttonId")},getFixGroupId:function(){if(this._isKeyFieldAvailable("fixGroupId"))return this._data.fixGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fixGroupId")},getStep:function(){if(this._isKeyFieldAvailable("step"))return this._data.step;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: step")},getCost:function(){if(this._isKeyFieldAvailable("cost"))return this._data.cost;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: cost")},getLineupId:function(){if(this._isKeyFieldAvailable("lineupId"))return this._data.lineupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lineupId")},getGachaId:function(){if(this._isKeyFieldAvailable("gachaId"))return this._data.gachaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaId")},getPresentGroupId:function(){if(this._isKeyFieldAvailable("presentGroupId"))return this._data.presentGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: presentGroupId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],GachaStepUpPlayBtnView:[function(t,e,i){"use strict";cc._RF.push(e,"21ceeASNGFAtZrl0dZ355tt","GachaStepUpPlayBtnView");var a=t("GachaPlayBtnViewBase"),n=(t("CommonButton"),t("ResourceUtils")),o=t("ItemConst");cc.Class({extends:a,properties:{stepUpNumLabel:cc.Label,currencyLabelArray:[cc.Label],bonusDisplayNode:cc.Node,bonusImageSprite:cc.Sprite,bonusCountLabel:cc.Label},initGachaStepUpPlayBtnView:function(t,e,i){this.initGachaPlayBtnViewBase(e),this.setTapEvent(function(){t.openGachaPlayConfirmPopup(e)}),this.stepUpNumLabel.string=i.toString()+" \u56de\u76ee",e.costType===o.ITEM_TYPE.PAID_GEM&&this._setCurrencyLabelText("\u6709\u511f"),this._drawBonusItem(e)},_drawBonusItem:function(t){var e=this._getBonusCoin(t);e?(this.bonusDisplayNode.active=!0,this.bonusCountLabel.string=e.itemCount+"\u500b\u304a\u307e\u3051\u4ed8\u304d!",n.addSprite(this.bonusImageSprite,n.getFileNameItemImage(e.itemId))):this.bonusDisplayNode.active=!1},_getBonusCoin:function(t){if(t)return _.find(t.coinPresent,function(t){return t.itemType===o.ITEM_TYPE.EXCHANGE_POINT})},_setCurrencyLabelText:function(t){t?_.forEach(this.currencyLabelArray,function(e){e.node.active=!0,e.string=t}):_.forEach(this.currencyLabelArray,function(t){t.node.active=!1})}});cc._RF.pop()},{CommonButton:"CommonButton",GachaPlayBtnViewBase:"GachaPlayBtnViewBase",ItemConst:"ItemConst",ResourceUtils:"ResourceUtils"}],GachaStepUpRollView:[function(t,e,i){"use strict";cc._RF.push(e,"bbe85ilRqdI8Y7/AKjCrJ3I","GachaStepUpRollView");var a=t("GachaRollViewBase"),n=t("ExchangeUtils"),o=t("GachaConst"),r=t("GameConst"),s=t("ItemConst"),c=0,l=1;cc.Class({extends:a,properties:{gachaStillViewPrefabArray:[cc.Prefab],gachaNormalLogoViewPrefab:cc.Prefab,addGachaNormalLogoViewNode:cc.Node,gachaCurrencyThumbnailPrefab:cc.Prefab,bonusCoinCurrencyThumbnailNode:cc.Node,freeGemCurrencyThumbnailNode:cc.Node,paidGemCurrencyThumbnailNode:cc.Node,gachaStepUpPlayBtnViewPrefab:cc.Prefab,gachaStepUpUniquePlayBtnViewPrefab:cc.Prefab,addGachaStepUpPlayBtnNode:cc.Node},_gachaStillViewArray:null,_gachaCurrencyThumbnailArray:null,_stepUpButtonData:null,_currentStep:0,initGachaView:function(t,e){this._stepUpButtonData=e.getButtons()[0],this._currentStep=this._stepUpButtonData.step,this._super(t,e)},initGachaRollView:function(){this._addLogoView(),this._addCurrencyThumbnail(),this._addStillView(),this._addPlayBtnView(),this.redraw()},redraw:function(){this._super(),this.loopRollView.setSelectedNo(0),this._gachaCurrencyThumbnailArray.forEach(function(t){t.redraw()}),this._gachaStillViewArray.forEach(function(t){t.redraw()})},_addStillView:function(){this._gachaStillViewArray=[],this._userGachaModel.getBanners().forEach(function(t){var e=this._getStillView(t);this.loopRollView.content.addChild(e.node),this._gachaStillViewArray.push(e)}.bind(this))},_getStillView:function(t){switch(t.bannerType){case o.BANNER_TYPE.STEP_UP:return this._createStepUpStillView(t);case o.BANNER_TYPE.LEFT:case o.BANNER_TYPE.RIGHT:case o.BANNER_TYPE.NON:default:return this._createNormalStillView(t)}},_createNormalStillView:function(t){var e=cc.instantiate(this.gachaStillViewPrefabArray[c]).getComponent("GachaNormalStillView");return e.initGachaNormalStillView(this._root,this._userGachaModel.getGachaId(),t),e},_createStepUpStillView:function(t){var e=cc.instantiate(this.gachaStillViewPrefabArray[l]).getComponent("GachaStepUpStillView");return e.initGachaStepUpStillView(this._root,this._userGachaModel.getGachaId(),t,this._currentStep),e},_addLogoView:function(){var t=cc.instantiate(this.gachaNormalLogoViewPrefab).getComponent("GachaNormalLogoView");t.initGachaNormalLogoView(this._root,this._userGachaModel),this.addGachaNormalLogoViewNode.addChild(t.node)},_addPlayBtnView:function(){this._userGachaModel.getButtons().forEach(function(t){this._initGachaBtn(t)}.bind(this))},_initGachaBtn:function(t){switch(t.costType){case s.ITEM_TYPE.PAID_GEM:var e=cc.instantiate(this.gachaStepUpUniquePlayBtnViewPrefab).getComponent("GachaStepUpPlayBtnView");this._initStepUpPlayButtonView(e,t);break;case s.ITEM_TYPE.ONLY_FREE_GEM:default:e=cc.instantiate(this.gachaStepUpPlayBtnViewPrefab).getComponent("GachaStepUpPlayBtnView");this._initStepUpPlayButtonView(e,t)}},_initStepUpPlayButtonView:function(t,e){t.initGachaStepUpPlayBtnView(this._root,e,this._currentStep),this.addGachaStepUpPlayBtnNode.addChild(t.node)},_addCurrencyThumbnail:function(){this._gachaCurrencyThumbnailArray=[];var t=n.getExchangePointByUserGacha(this._userGachaModel);if(t){var e=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");e.initGachaCurrencyThumbnail(this._root,t.itemId),this.bonusCoinCurrencyThumbnailNode.addChild(e.node),this._gachaCurrencyThumbnailArray.push(e)}var i=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");i.initGachaCurrencyThumbnail(this._root,r.ITEM_ID_FREE_GEM),this.freeGemCurrencyThumbnailNode.addChild(i.node),this._gachaCurrencyThumbnailArray.push(i);var a=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyThumbnail");a.initGachaCurrencyThumbnail(this._root,r.ITEM_ID_PAID_GEM),this.paidGemCurrencyThumbnailNode.addChild(a.node),this._gachaCurrencyThumbnailArray.push(a)},_onTapExchangeBtn:function(){this._root.transitionExchangeScene(this._userGachaModel)}});cc._RF.pop()},{ExchangeUtils:"ExchangeUtils",GachaConst:"GachaConst",GachaRollViewBase:"GachaRollViewBase",GameConst:"GameConst",ItemConst:"ItemConst"}],GachaStepUpStillView:[function(t,e,i){"use strict";cc._RF.push(e,"160eej1hmZL7KojBxldTywZ","GachaStepUpStillView");var a=t("ResourceUtils"),n=(t("Singleton"),t("SingletonConst"),t("ResourceConst")),o=t("GachaConst"),r=t("GameConst"),s=t("ViewUtils");cc.Class({extends:cc.Component,properties:{gachaBgSprite:cc.Sprite,targetLayout:cc.Layout},_root:null,_gachaId:0,_banner:null,_currentStep:0,_stepUpThumbnailArray:null,initGachaStepUpStillView:function(t,e,i,a){this._root=t,this._gachaId=e,this._banner=i,this._currentStep=a,i.bannerType===o.BANNER_TYPE.STEP_UP&&(this._addGachaStillBg(),this._banner.stepFrom=i.stepFrom,this._banner.stepTo=i.stepTo,this.redraw())},redraw:function(){this.targetLayout.node.destroyAllChildren(),this._stepUpThumbnailArray=[];for(var t=this._banner.stepFrom;t<=this._banner.stepTo;t+=1){var e=this._addStepUpThumbnailSprite(t,this._banner.stepTo);this._stepUpThumbnailArray.push(e)}},_addGachaStillBg:function(){a.addSprite(this.gachaBgSprite,a.getFileNameGachaBg(this._gachaId,this._banner.bannerFile)+n.GACHA_BG_PATH_SUFFIX.NON,function(){})},_addStepUpThumbnailSprite:function(t,e){var i=new cc.Node("stepUpThumbnail_"+t).addComponent(cc.Sprite);i.node.anchorY=0,t<this._currentStep&&(i.node.color=r.COLOR_STATE.GRAY),this.targetLayout.node.addChild(i.node);var n=this._banner.bannerFile+("00"+t).slice(-2);return a.addSprite(i,a.getFileNameGachaStepUpThumbnail(this._gachaId,n),function(){s.setEquallySpacedHorizontalLayout(this.targetLayout)}.bind(this)),i}});cc._RF.pop()},{GachaConst:"GachaConst",GameConst:"GameConst",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",ViewUtils:"ViewUtils"}],GachaTicketPlayConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"d0f9aNnzE5H9ousTaIlA5LO","GachaTicketPlayConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ItemUtils"),r=t("ResourceUtils");cc.Class({extends:a,properties:{titleLabel:cc.Label,ticketNameLabel:cc.Label,costCountLabel:cc.Label,rotationCountLabel:cc.Label,ticketCountLabel:cc.Label,ticketIconSprite:cc.Sprite,playBtn:n,cancelBtn:n},_root:null,_buttonData:null,_userGachaModel:null,onLoad:function(){this.playBtn.setTapEvent(this._onTapPlayBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openGachaTicketPlayConfirmPopup:function(t,e){this._root=t,this._buttonData=e,this._userGachaModel=t.gachaUserData.find(function(t){return t.getGachaId()===e.gachaId}),this.titleLabel.string=this._userGachaModel.getGachaText(),this.costCountLabel.string=e.costCount,this.rotationCountLabel.string=e.drawCount,this.ticketNameLabel.string=""+o.getItemMaster(e.costId).getName(),this.ticketCountLabel.string=""+o.getUserItemCount(e.costId),r.addSprite(this.ticketIconSprite,r.getFileNameItemImage(e.costId),void 0),this.open()},_onTapPlayBtn:function(){this._root.transitionGachaLoading(this._userGachaModel.getGachaType(),this._buttonData),this.close()},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],GachaTicketRollView:[function(t,e,i){"use strict";cc._RF.push(e,"842c0HHLCZEP7hPH95573QQ","GachaTicketRollView");var a=t("GachaRollViewBase");t("CommonUtils"),t("Singleton"),t("GachaConst"),t("GameConst"),cc.Class({extends:a,properties:{gachaNormalStillViewPrefab:cc.Prefab,gachaNormalLogoViewPrefab:cc.Prefab,addGachaNormalLogoViewNode:cc.Node,gachaNormalPlayBtnViewPrefab:cc.Prefab,gachaOneDayPlayBtnViewPrefab:cc.Prefab,addGachaNormalPlayBtnViewNode:cc.Node,gachaCurrencyThumbnailPrefab:cc.Prefab,addCurrencyThumbnailNode:cc.Node},_gachaNormalStillViewArray:null,_gachaCurrencyThumbnailArray:null,initGachaView:function(t,e){this._super(t,e)},initGachaRollView:function(){this._gachaNormalStillViewArray=[],this._userGachaModel.getBanners().forEach(function(t){var e=cc.instantiate(this.gachaNormalStillViewPrefab).getComponent("GachaNormalStillView");e.initGachaNormalStillView(this._root,this._userGachaModel.getGachaId(),t),this.loopRollView.content.addChild(e.node),this._gachaNormalStillViewArray.push(e)}.bind(this)),this._userGachaModel.getButtons().forEach(function(t){var e=cc.instantiate(this.gachaNormalPlayBtnViewPrefab).getComponent("GachaPlayBtnView");e.node.name="GachaPlayBtn_Normal",this._initPlayButtonView(e,t)}.bind(this));var t=cc.instantiate(this.gachaNormalLogoViewPrefab).getComponent("GachaNormalLogoView");t.initGachaNormalLogoView(this._root,this._userGachaModel),this.addGachaNormalLogoViewNode.addChild(t.node),this._gachaCurrencyThumbnailArray=[],_.uniq(this._userGachaModel.getButtons().map(function(t){return t.costId})).forEach(function(t){var e=cc.instantiate(this.gachaCurrencyThumbnailPrefab).getComponent("GachaCurrencyItemThumbnail");e.initGachaCurrencyItemThumbnail(t),this.addCurrencyThumbnailNode.addChild(e.node),this._gachaCurrencyThumbnailArray.push(e)}.bind(this)),this.redraw()},_initPlayButtonView:function(t,e){t.initGachaPlayBtnView(e,function(){this._root.openGachaTicketPlayConfirmPopup(e)}.bind(this)),this.addGachaNormalPlayBtnViewNode.addChild(t.node)},redraw:function(){this._super(),this.loopRollView.setSelectedNo(0),this._gachaCurrencyThumbnailArray.forEach(function(t){t.redraw()}),this._gachaNormalStillViewArray.forEach(function(t){t.redraw()})}});cc._RF.pop()},{CommonUtils:"CommonUtils",GachaConst:"GachaConst",GachaRollViewBase:"GachaRollViewBase",GameConst:"GameConst",Singleton:"Singleton"}],GachaTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"d3302GNoiVLGKNSZRvq6jdP","GachaTopSubRoot");t("Singleton");var a=t("CommonScrollView");cc.Class({extends:cc.Component,properties:{gachaSideScrollView:a,addGachaViewNode:cc.Node,gachaSideBannerThumbnailPrefab:cc.Prefab,gachaViewPrefabArray:[cc.Prefab]},_root:null,_gachaSideBannerThumbnailMap:null,_gachaViewMap:null,initGachaTopSubRoot:function(t,e){this._root=t,e&&this._root.loadGachaSession(),this._gachaSideBannerThumbnailMap={},this._gachaViewMap={},this.gachaSideScrollView.content.destroyAllChildren(),this._root.gachaUserData.forEach(function(e){var i=cc.instantiate(this.gachaSideBannerThumbnailPrefab).getComponent("GachaSideBannerThumbnail");i.initGachaSideBannerThumbnail(t,e,this._onTapSideBannerThumbnail.bind(this)),this.gachaSideScrollView.content.addChild(i.node),this._gachaSideBannerThumbnailMap[e.getGachaId()]=i;var a=cc.instantiate(this.gachaViewPrefabArray[e.getGachaType()-1]).getComponent("GachaViewBase");a.initGachaView(t,e),this.addGachaViewNode.addChild(a.node),this._gachaViewMap[e.getGachaId()]=a}.bind(this))},_onTapSideBannerThumbnail:function(t){this._root.getGachaDetailData(t.getGachaId(),function(){this._root.gachaUserData.forEach(function(t){this._gachaSideBannerThumbnailMap[t.getGachaId()].redraw(),this._gachaViewMap[t.getGachaId()].redraw()}.bind(this))}.bind(this))}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",Singleton:"Singleton"}],GachaViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"a471bKJnZxBapVwsMz+mZF7","GachaViewBase");cc.Class({extends:cc.Component,properties:{},_root:null,_userGachaModel:null,initGachaView:function(t,e){this._root=t,this._userGachaModel=e},redraw:function(){this.node.active=this._root.selectGachaId===this._userGachaModel.getGachaId()}});cc._RF.pop()},{}],GachaViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"8120ejJZnhP8LAvfdZS3YUj","GachaViewSetting");var a=t("GachaRootUtils");e.exports={GACHA_SETTING:{GachaTopSubRoot:{open:a.openGachaTopSubRoot,close:a.closeGachaTopSubRoot}}},cc._RF.pop()},{GachaRootUtils:"GachaRootUtils"}],GameConst:[function(t,e,i){"use strict";cc._RF.push(e,"04de6tnZ4JC57L/Yb3gl2M1","GameConst"),cc.Class({statics:{SERVER_TIME_ZONE:"+0900",ACTIVATE_OPACITY:255,DEACTIVATE_OPACITY:128,DIRECTION_TYPE:cc.Enum({NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4}),USER_NOTICE_TYPE:{NONE:0,MESSAGE:1,POPUP:2,POPUP_TRANSITION:3},ATTRIBUTE:cc.Enum({FIRE:1,WATER:2,WIND:3,THUNDER:4,LIGHT:5,DARK:6}),RARITY:cc.Enum({N:1,R:2,SR:3,SSR:4}),NATURE:cc.Enum({DORMENT:1,CONCEPTION:2,MINION:3,INDEPENDENCE:4,STILL:5,MARIONETTE:6,PARASITISM:7}),UNION:cc.Enum({NONE:0,A:1,B:2,C:3}),SORT_ORDER:cc.Enum({ASC:!0,DESC:!1}),USER_PROGRESS:{TYPE:{NAVIGATOR:1,SCENE:2,USER_GUID:3},NAVIGATOR_GROUP:{NON:0,STAGE:1},SCENE_GROUP:{NON:0,STAGE:1}},ITEM_CATEGORY_NONE:0,ITEM_CATEGORY_RECIPE:1,ITEM_CATEGORY_EQUIPMENT:2,ITEM_CATEGORY_MATERIAL:3,ITEM_CATEGORY_USE_ITEM:4,ITEM_ID_FREE_GEM:101001,ITEM_ID_PAID_GEM:102001,ITEM_ID_GOLD:201001,ITEM_ID_PVP:801003,ITEM_ID_TOWER:801004,ITEM_ID_RAID:801005,ITEM_ID_ROOM:801010,ITEM_ID_R_L_YEH_COIN:801011,FORTIFY_MAX_MATERIAL:10,EXCEED_LIMIT_MAX_MATERIAL:1,SKILL_FORTIFY_MAX_MATERIAL:5,MAX_EXCEED_LIMIT_MAX_MATERIAL:2,SELL_MAX_MATERIAL:20,PROTECT_MAX_MATERIAL:16,EXPEDITION_MAX_MATERIAL:5,CHECK_STATE:cc.Enum({NONE:0,SELL:1,PROTECT:2,MATERIAL:3}),WORLD_CATEGORY:cc.Enum({NORMAL:1,WEEK:2,TOWER:3,RAID:4,EVENT:5}),DEFAULT_QUEST_BG:-1,Z_ORDER:cc.Enum({BG:-255,BACK_PARTICLE:-254,UI_HEADER:245,UI:246,UI_BACK_BUTTON:247,GRAY_BACK:248,SYSTEM_WINDOW:249,POPUP:250,TUTORIAL_SUB_ROOT:251,FRONT_PARTICLE:252,LOADING:253,SYSTEM_POPUP:254,BAND:255}),SIDE_BUTTON:cc.Enum({QUEST:"QuestScene",DECK:"DeckScene",GACHA:"GachaScene",PROMOTE:"PromoteCharacterSelectScene",ROOM:"RoomScene",MISSION:"MissionScene",EQUIPMENT:"EquipmentScene"}),QUEST_DECK_MIN:0,QUEST_DECK_MAX:5,DECK_ID_ORIGIN:1,TOWER_DIFFICULTY:{NORMAL:{difficulty:1,text:"Normal"},HARD:{difficulty:2,text:"Hard"},EXTREME:{difficulty:3,text:"Extreme"}},COLOR_STATE:{NORMAL:cc.color(255,255,255,255),PLUS:cc.color(111,255,111,255),MINUS:cc.color(111,233,255,255),ALERT:cc.color(255,111,111,255),GRAY:cc.color(100,100,100)},RICH_TEXT_TAG_STATE:{NORMAL:{START:'<color=white><outline color="black width=2.5">',END:"</outline></c>"},PLUS:{START:"<color=#6FFF6F>",END:"</c>"},MINUS:{START:"<color=#6FE9FF>",END:"</c>"},WHITE:{START:"<color=white>",END:"</c>"},BLACK:{START:"<color=#000000>",END:"</c>"},GRAY:{START:"<color=#646464>",END:"</c>"},GREEN:{START:"<color=#1CE00B>",END:"</c>"},BLUE:{START:"<color=#13178B>",END:"</c>"},RED:{START:"<color=#ff0000>",END:"</c>"},OUTLINE:{START:"<outline width=2.5>",END:"</outline>"}},MAX_USER_AP:999,MAX_MATERIAL_COUNT:300,MAX_SKILL_UP_RATE:100,MAX_SKILL_LEVEL:5,BOOST_TYPE:cc.Enum({USER_EXP:1,QUEST_UNLOCK:2,QUEST_LIMITED_UNLOCK:3}),QUEST_TYPE:cc.Enum({WORLD:1,AREA:2,STAGE:3}),QUEST_DIFFICULT:{NORMAL:cc.Enum({NORMAL:1,EX:2}),TOWER:cc.Enum({NORMAL:1,HARD:2,EX:3,EX_2:4,EX_3:5}),EVENT_ADVENT:cc.Enum({EASY:1,NORMAL:2,HARD:3,EXTREME:4,CHALLENGE:5}),EVENT_EQUIPMENT:cc.Enum({EASY:1,NORMAL:2,HARD:3,EXTREME:4})},QUEST_TEXT_GROUP:cc.Enum({NORMAL:0,WEEK:1,EVENT_SELECT:2}),CAMPAIGN_TARGET_TYPE:cc.Enum({WORLD:1,AREA:2,STAGE:3}),CAMPAIGN:{AP:{CATEGORY:1,LABEL:"\u6d88\u8cbbAP "},CAHRA_EXP:{CATEGORY:2,LABEL:"\u30e6\u30cb\u30c3\u30c8EXP "},DROP:{CATEGORY:3,LABEL:"\u30c9\u30ed\u30c3\u30d7 "},USER_EXP:{CATEGORY:4,LABEL:"\u30e6\u30fc\u30b6\u30fcEXP "},GOLD:{CATEGORY:5,LABEL:"\u30cd\u30e2\u7372\u5f97 "},UNLOCK:{CATEGORY:6,LABEL:""},LIMIT_COUNT:{CATEGORY:7,LABEL:"\u6311\u6226\u56de\u6570 + "}},UNLOCK_TYPE:cc.Enum({FREE:1,GEM:2,ITEM:3}),LOCK_STATE:cc.Enum({LOCK:1,FREE_LOCK:2,WEEK_UNLOCK:3,BOOST_UNLOCK:4}),PRESENT_CATEGORY:cc.Enum({UNIT:1,EQUIPMENT:2,ITEM:3,OTHER:4}),LOADING_TYPE:cc.Enum({COVER:1,CHARACTER:2,TIPS:3}),BGM:cc.Enum({TITLE:"OP_90sec",COMMON:"bgm002",HOME:"bgm022",GACHA:"bgm008",QUEST:"bgm003",ROOM:"bgm004"}),LOGIN_BONUS_TYPE:cc.Enum({NORMAL:1,SPECIAL:2}),RESULT_RIBBON_ANIM_IDX:cc.Enum({FORTIFY_NORMAL:0,FORTIFY_GREAT:1,EXCEED_EQUIP:2,EXCEED_CHARACTER:3,FORTIFY_FAILURE:4}),INSPECTION_STATUS_TYPE:{INSPECTING:0,OK:1,DELETE:2,NG:3,ERROR:-1},INSPECTION_TYPE:cc.Enum({GET:0,UPDATE:1}),OPEN_CONDITION_TYPE:cc.Enum({NON:0,RANK:1,REGISTER_DATE:2}),DEFAULT_RESOURCE_QUALITY:1,RESOURCE_QUALITY:{LOW:1,HIGH:2},RESOURCE_DL_TYPE:{NON:0,SINGLE:1,ALL:2},PAYMENT_TYPE:{SHOP:1,GACHA:2},ALL_RES_POP_TYPE:{UNPOP:1,POP:2},NEWS_TAB:{INFO:1,HOW_TO_PLAY:2},MAX_TEXTURE_SIZE:8192,THUMBNAIL_LARGE_FONT_SIZE:70,SPACE_NOT_ENOUGH_ERR1:"No space left on device",SPACE_NOT_ENOUGH_ERR2:"Can't create DownloadTask for",ADULT_TYPE:cc.Enum({NORMAL:0,ADULT:1,LIGHT_NORMAL:2,LIGHT_ADULT:3})}}),cc._RF.pop()},{}],GameEffectQueue:[function(t,e,i){"use strict";cc._RF.push(e,"04969DpeqdK2KbuN5KI/Sqg","GameEffectQueue");var a=t("BattleData"),n=t("Singleton"),o=t("SingletonConst"),r=t("TutorialUtils"),s=cc.Class({properties:{data:Map,action:null},ctor:function(){this.data=arguments[0],this.action=arguments[1]}}),c=cc.Class({properties:{effectList:Array},queryName:null,ctor:function(){this.queryName=arguments[0]?arguments[0]:"",this.effectList=arguments[1],void 0!=this.effectList&&null!=this.effectList||(this.effectList=new Array)},addAction:function(){arguments[0]instanceof s?this.effectList.push(arguments[0]):this.effectList.push(new s(new Map,arguments[0]))}}),l=cc.Class({properties:{},ctor:function(){this.queueName=arguments[0],this.effectQueue=new Array},addQuery:function(){if(n[o.ENVIRONMENT].getDebugQueue()&&this===a.GM.effectQueue){for(var t="add:",e=0;e<arguments[0].effectList.length;e++)t+=arguments[0].effectList[e].action.name+",";cc.log(t),this.printQueue()}this.effectQueue.push(arguments[0])},play:function(){this.callFunc=arguments[0],this.count=0,this.doPlay()},doPlay:function(){if(this.count--,this.count<=0)if(this.effectQueue.length>0){if(!a.isQueueStop&&!n[o.ENVIRONMENT].getDebugQueue()||this!==a.GM.effectQueue){var t=this.effectQueue.shift();this.count=t.effectList.length,r.isTutorialAdvByIngameEvent(t.queryName)?r.startBattleTutorialAdv(function(){0==this.count?this.doPlay():t.effectList.forEach(function(t){t.action(this.doPlay.bind(this),t.data)},this)}.bind(this)):0==this.count?this.doPlay():t.effectList.forEach(function(t){t.action(this.doPlay.bind(this),t.data)},this)}}else void 0!==this.callFunc&&this.callFunc()},nextQuery:function(){if(!(this.count>0)&&(!a.isQueueStop||n[o.ENVIRONMENT].getDebugQueue())){var t=this.effectQueue.shift();t&&Array.isArray(t.effectList)&&(this.count=t.effectList.length,0===this.count?this.doPlay():t.effectList.forEach(function(t){if(this===a.GM.effectQueue){var e="play:";e+=t.action.name,cc.log(e),this.printQueue()}t.action(this.doPlay.bind(this),t.data)},this))}},printQueue:function(){for(var t="current:",e=0;e<this.effectQueue.length;e++){t+=e+"[";for(var i=0;i<this.effectQueue[e].effectList.length;i++)t+=this.effectQueue[e].effectList[i].action.name+",";t+="],"}cc.log(t)}});e.exports={EffectData:s,EffectQuery:c,GameEffectQueue:l},cc._RF.pop()},{BattleData:"BattleData",Singleton:"Singleton",SingletonConst:"SingletonConst",TutorialUtils:"TutorialUtils"}],GameLoop:[function(t,e,i){"use strict";cc._RF.push(e,"23215sk0z1PVKFV34E4RSep","GameLoop");var a=cc.Class({properties:{action:null,nextGameNodes:null},ctor:function(){this.action=arguments[0],this.nextGameNodes=new Array}}),n=cc.Class({properties:{gameNodeList:null,nowGameNode:{default:null,type:a,serializable:!1,visible:!1}},ctor:function(){this.gameNodeList=new Array},addAction:function(){var t=arguments[0],e=this.findAction(t);e||(e=new a(t),this.gameNodeList.push(e));for(var i=Array(),n=1;n<arguments.length;n++)i.push(arguments[n]);for(var o=0;o<i.length;o++){var r=i[o],s=this.findAction(r);s||(s=new a(r),this.gameNodeList.push(s)),e.nextGameNodes.push(s)}},insertAction:function(t,e,i){var n=this.findAction(e),o=this.findAction(i),r=new a(t);this.gameNodeList.push(a);var s=this.findIdxByAction(n,o);n.nextGameNodes[s]=r,r.nextGameNodes.push(o)},changeAction:function(t,e,i){var n=this.findAction(t),o=this.findAction(i);o||(o=new a(i),this.gameNodeList.push(o));for(var r=0;r<n.nextGameNodes.length;r++)n.nextGameNodes[r].action.name==e.name&&(n.nextGameNodes[r]=o)},beginLoop:function(t){this.nowGameNode=this.findAction(t),this.nowGameNode.action()},nextAction:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.nowGameNode=this.nowGameNode.nextGameNodes[t],this.nowGameNode.action},callNextAction:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.nowGameNode=this.nowGameNode.nextGameNodes[t],this.nowGameNode.action()},nowAction:function(){return this.nowGameNode.action},callNowAction:function(){this.nowGameNode.action()},findAction:function(t){for(var e=0;e<this.gameNodeList.length;e++)if(t.name==this.gameNodeList[e].action.name)return this.gameNodeList[e];return null},findIdxByAction:function(t,e){for(var i=0;i<t.nextGameNodes.length;i++)if(t.nextGameNodes[i]==e)return i;return-1}});e.exports={GameNode:a,GameLoop:n},cc._RF.pop()},{}],GameRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"41ce1+Gun9Dr5aA0TMnOqbF","GameRootBase");var a=t("Singleton"),n=t("SingletonConst"),o=t("StaticResourceConst"),r=t("CommonUtils"),s=t("ResourceUtils"),c=t("GameConst"),l=t("SceneConst"),u=t("LocalDataConst"),h=t("DevelopmentUtils"),d=t("TutorialUtils"),p=t("ViewUtils"),m=t("UserUtils"),g=t("FileLoaderManager"),C=(t("BattleConstants"),t("MemoryManager")),f=(t("ResLoader"),l.SCENE_STATE),E={SIMPLE:[o.LOADING_SIMPLE_PREFAB_PATH],PROGRESS:[o.LOADING_PROGRESS_TIPS_PREFAB_PATH]};cc.Class({extends:cc.Component,_sceneState:0,_isCompleteData:!1,_requestResList:null,_requestStaticResList:null,requestURLCount:0,sceneTarget:null,sceneParam:void 0,_closeViewFunc:null,_closeViewParam:null,_viewFunc:null,_viewParam:null,_initOpenViewParam:null,tapEffectManager:null,_loadView:null,_loadCountMax:0,_recentRemainLoadCount:0,_isInitializedView:!1,_updateCallbackMap:null,ctor:function(){this._sceneState=f.INIT_DATA,this._requestResList={},this._requestStaticResList={},this._resourceRemainLoadCount=0,this.requestURLCount=0,this._loadCountMax=0,this._recentRemainLoadCount=0,this._isCompleteData=!1,this._isInitializedView=!1,Array.isArray(a.localData[u.SCENE_TRANSITION_TARGETS])||(a.localData[u.SCENE_TRANSITION_TARGETS]=[])},onLoad:function(){this._setErrorHandling(),this._setNoticeHandling(),this._addBand(),this._setTapEffect()},initData:function(){},initResource:function(){},initialize:function(){},update:function(t){switch(this._sceneState){case f.INIT_DATA:d.initTutorialForRoot(this),this._initData(),this._initLoading(this.requestURLCount),this._sceneState=f.LOOP_DATA;break;case f.LOOP_DATA:this.requestURLCount!==this._recentRemainLoadCount&&(this._recentRemainLoadCount=this.requestURLCount,this._setLoadProgress(this._calcLoadProgress(this.requestURLCount))),this.requestURLCount<=0&&(this._sceneState=f.INIT_RESOURCE);break;case f.INIT_RESOURCE:this.initResource(),this._initLoading(this._resourceRemainLoadCount),this._sceneState=f.LOOP_RESOURCE;break;case f.LOOP_RESOURCE:this._resourceRemainLoadCount!==this._recentRemainLoadCount&&(this._recentRemainLoadCount=this._resourceRemainLoadCount,this._setLoadProgress(this._calcLoadProgress(this._resourceRemainLoadCount))),this._resourceRemainLoadCount<=0&&(this._sceneState=f.INIT_SCENE);break;case f.INIT_SCENE:this._initScene(),this._sceneState=f.LOOP_SCENE;break;case f.LOOP_SCENE:this.callViewFunc(),this.updateChild(t),this._updateCallback(t)}},setUpdateCallback:function(t,e){this._updateCallbackMap||(this._updateCallbackMap={}),this._updateCallbackMap[e]=t},deleteUpdateCallbackKey:function(t,e){this._updateCallbackMap||(this._updateCallbackMap={}),this._updateCallbackMap=_.omit(this._updateCallbackMap,t),e&&e()},_updateCallback:function(t){this._updateCallbackMap||(this._updateCallbackMap={}),this._updateCallbackMap=_.omitBy(this._updateCallbackMap,function(e){return e(t)})},_initData:function(){h.checkDevelopmentScene(void 0)||this.initData()},_addMask:function(){this.node.addComponent(cc.Mask)},_initLoading:function(t){t>0?(this._addLoading(),this._activeLoading(),this._initLoadProgress(),this._loadCountMax=t):(this._hideLoading(),this._loadCountMax=1),this._recentRemainLoadCount=this._loadCountMax},_addLoading:function(){var t=this.getCurrentSceneName(),e=l.LOADING_TYPE[t];if(e&&!this._loadView){p.removeModalLayer(),this.node.active=!1;var i=Math.floor(Math.random()*E[e].length);this._loadView=cc.instantiate(s.getResource(E[e][i])).getComponent("LoadSimpleView"),this.node.addChild(this._loadView.node,c.Z_ORDER.LOADING),this.node.active=!0}},_activeLoading:function(){this._loadView&&this._loadView.showLoading()},_hideLoading:function(){this._loadView&&this._setDelayLoading(function(){this._loadView.hideLoading(),this._loadView=null}.bind(this))},_setDelayLoading:function(t){var e=this.getCurrentSceneName();return l.LOADING_TYPE[e]&&this._loadView?void this._loadView.setDelayLoading(t):t()},_initLoadProgress:function(){this._loadView&&this._loadView.initLoadProgress()},_setLoadProgress:function(t){this._loadView&&this._loadView.setLoadProgress(t)},isShowLoading:function(){return null!==this._loadView},_calcLoadProgress:function(t){var e=(this._loadCountMax-t)/this._loadCountMax;return e<0&&(e=0),e>100&&(e=100),e},callViewFunc:function(){if(Array.isArray(this._closeViewFunc)){for(var t=0;t<this._closeViewFunc.length;t++)this._closeViewFunc[t](this,this._closeViewParam[t]);this._closeViewFunc=null}if(Array.isArray(this._viewFunc)){for(t=0;t<this._viewFunc.length;t++)this._viewFunc[t](this,this._viewParam[t]);this._viewFunc=null}this._isInitializedView=!0},_initScene:function(){h.showDevelopmentScene(function(){this.initialize()}.bind(this)),this._hideLoading(),m.drawUserProgressNotice(this,m.getUserProgressNotice())},requestRes:function(t,e,i){if(a.res[t]||a.staticRes[t])i&&i();else{this._requestResList[t]=e,this._resourceRemainLoadCount+=1;var n=this;g.instance.loadFile(t,e,function(e,o){if(n._resourceRemainLoadCount-=1,null!==e)return n._requestResList&&delete n._requestResList[t],void cc.error(e);a.res[t]=o,n._requestResList&&delete n._requestResList[t],i&&i()})}},getResource:function(t){return a.res[t]},_addBand:function(){p.addEdgeBand(this.node)},isInitializedView:function(){return this._isInitializedView},pushScene:function(t,e,i,n,o){if(h.checkDevelopmentScene(t))h.openDevelopmentPopup();else if(d.isTutorialTransition(this))d.initTutorialForTransition(this);else{var s,c;if(this._isInitializedView=!1,i&&(s=JSON.stringify(i)),n&&(c=JSON.stringify(n)),e){var l=e+";"+c;a.localData[u.SCENE_TRANSITION_TARGETS].push(l)}if(t===this.getCurrentSceneName()){var p=r.getRoot();p.sceneParam=""===s||null===s||void 0===s?void 0:s,p.callSceneTargetListener(),p.callSceneStackListener()}else{var m=!1;this._changeScene(function(){m||(m=!0,cc.director.loadScene(t+".fire",function(){o&&C.instance.release(),a.persistNode.isEffecte=!0,m=!1;var t=r.getRoot();t&&(t.sceneParam=""===s||null===s||void 0===s?void 0:s,t.callSceneStackListener())}))})}}},popScene:function(t,e){if(d.isTutorialTransition(this))d.initTutorialForTransition(this);else{this._isInitializedView=!1;var i=r.getRoot(),n=a.localData[u.SCENE_TRANSITION_TARGETS].pop();if(t||!n)return i&&i.callSceneStackListener(),this._isInitializedView=!0,e?e():void 0;var o=n.split(";");if(o[0]===this.getCurrentSceneName()){if(i&&(i.callSceneTargetListener(o[1]),i.callSceneStackListener()),e)return this._isInitializedView=!0,e()}else{var s=!1;this._changeScene(function(){s||(s=!0,cc.director.loadScene(o[0]+".fire",function(){C.instance.release(),a.persistNode.isEffecte=!0,s=!1;var t=r.getRoot();Array.isArray(o)&&o.length>1&&("undefined"===o[1]||void 0===o[1]||null===o[1]?t.sceneParam=void 0:t.sceneParam=o[1]),t.callSceneStackListener()}))})}}},_changeScene:function(t){var e=cc.director.getScene().getChildByName("Canvas"),i=e.getChildByName("HeaderParent"),o=e.getChildByName("SideMenuParent"),r=e.getChildByName("SubRootParent"),s=e.getChildByName("BackButton"),c=!1;if(i&&i.children[0]&&(i.children[0].getComponent(cc.Animation).play("GlobalHeader_End"),c=!0),o&&o.children[0]&&(o.children[0].getComponent(cc.Animation).play("SideMenu_End"),c=!0),r){var l=r.getComponent(cc.Animation);l&&(l.play("SubRoot_End"),c=!0)}if(s){s.getComponent("BackButton").setTouchEnable(!1);var u=s.getComponent(cc.Animation);u.once("finished",function(){s.getComponent("BackButton").setTouchEnable(!1)}),u.play("BackBtn_End")}if(!c)return this._activeLoading(),t();a.soundManager.voiceStop(),a[n.NOTICE_MANAGER].changeSceneEvent(),cc.director.getScheduler().schedule(function(){this._activeLoading(),t()},this,.2)},getCurrentSceneName:function(){return cc.director.getScene().name},getCurrentSceneParam:function(){return this.sceneParam},clearScene:function(){a.localData[u.SCENE_TRANSITION_TARGETS]=[]},callSceneTargetListener:function(t){},callSceneTargetListenerBase:function(t,e){"undefined"!==t&&void 0!==t&&null!==t||(t=void 0);var i={};i=t?JSON.parse(t):this.sceneParam?JSON.parse(this.sceneParam):JSON.parse(this._initOpenViewParam),this.sceneParam=i,this.setViewFuncAndParam(i,e)},setViewFuncAndParam:function(t,e){this._closeViewFunc=[],this._closeViewParam=[],this._viewFunc=[],this._viewParam=[];for(var i=Object.keys(t),a=Object.keys(e),n=0;n<a.length;n++){for(var o=!0,r=0;r<i.length;r++)i[r]===a[n]&&(this._viewFunc.push(e[a[n]].open),this._viewParam.push(t[i[r]]),o=!1);o&&(this._closeViewFunc.push(e[a[n]].close),this._closeViewParam.push([]))}},checkSceneStack:function(){return a.localData[u.SCENE_TRANSITION_TARGETS].length>=1},callSceneStackListener:function(){},_initOpenFirstView:function(t){var e;this._initOpenViewParam=JSON.stringify(t),e=this.sceneParam?this.sceneParam:this._initOpenViewParam,this.callSceneTargetListener(e)},_setTapEffect:function(){s.getResource(o.TAP_EFFECT_PREFAB_PATH)&&(this.tapEffectManager=cc.instantiate(s.getResource(o.TAP_EFFECT_PREFAB_PATH)).getComponent("TapEffectManager"),this.tapEffectManager.init())},_setErrorHandling:function(t){var e=a[n.ERROR_MANAGER];e&&e.setErrorHandling(this,t)},_setNoticeHandling:function(t){var e=a[n.NOTICE_MANAGER];e&&e.setNoticeHandling(this,t)}}),cc._RF.pop()},{BattleConstants:"BattleConstants",CommonUtils:"CommonUtils",DevelopmentUtils:"DevelopmentUtils",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",ResLoader:"ResLoader",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst",StaticResourceConst:"StaticResourceConst",TutorialUtils:"TutorialUtils",UserUtils:"UserUtils",ViewUtils:"ViewUtils"}],GameRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ac51eb/I0JAIL2An9aW8gtG","GameRoot");var a=t("GameRootBase"),n=t("PoolManager"),o=t("CameraController"),r=t("BattleEventController"),s=t("BattleData"),c=cc.Class({extends:a,properties:{battleUIManagerNode:cc.Node,playerUnitLayout:cc.Node,playerAvatarNode:cc.Node,enemyUnitLayout:cc.Node,abilityCutinPrefab:cc.Prefab,abilityCutinNode:cc.Node,abilityCutinMessageNode:cc.Node,unisonCutinNode:cc.Node,skillCutinNode:cc.Node,skillCutinMessageNode:cc.Node,poolManager:n,cameraController:o,battleEventController:r,buttonDebugQueue:cc.Node,bgBattleNode:cc.Node,bgWhiteNode:cc.Node,frontWhiteNode:cc.Node},start:function(){},nextQuery:function(){s.GM.effectQueue.nextQuery()},updateChild:function(){}});e.exports=c,cc._RF.pop()},{BattleData:"BattleData",BattleEventController:"BattleEventController",CameraController:"CameraController",GameRootBase:"GameRootBase",PoolManager:"PoolManager"}],Game:[function(t,e,i){"use strict";cc._RF.push(e,"b3d53bfqj1E5K+57oGRR61U","Game"),cc.Class({extends:cc.Component,properties:{Cursol:{default:null,type:cc.Node}},onLoad:function(){this.node.on(cc.Node.EventType.MOUSE_MOVE,function(t){this.Cursol.x=t.getLocation().x-640,this.Cursol.y=t.getLocation().y-360},this),this.node.on(cc.Node.EventType.MOUSE_DOWN,function(t){this.Cursol.getComponent("Cursol").down()},this),this.node.on(cc.Node.EventType.MOUSE_UP,function(t){this.Cursol.getComponent("Cursol").up()},this)}}),cc._RF.pop()},{}],GenerateMd5:[function(t,e,i){"use strict";cc._RF.push(e,"94560r2UztHrIzAkGsqN4r9","GenerateMd5");var a=cc.Class({properties:{HEX_CHR:"0123456789abcdef",resKey:"zhimakaimen123"},statics:{instance:null},ctor:function(){a.instance=this},setResouceKey:function(t){this.resKey=t},rhex:function(t){for(var e="",i=0;i<=3;i++)e+=this.HEX_CHR.charAt(t>>8*i+4&15)+this.HEX_CHR.charAt(t>>8*i&15);return e},str2blks_MD5:function(t){for(var e=1+(t.length+8>>6),i=new Array(16*e),a=0;a<16*e;a++)i[a]=0;for(a=0;a<t.length;a++)i[a>>2]|=t.charCodeAt(a)<<a%4*8;return i[a>>2]|=128<<a%4*8,i[16*e-2]=8*t.length,i},add:function(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i},rol:function(t,e){return t<<e|t>>>32-e},cmn:function(t,e,i,a,n,o){return this.add(this.rol(this.add(this.add(e,t),this.add(a,o)),n),i)},ff:function(t,e,i,a,n,o,r){return this.cmn(e&i|~e&a,t,e,n,o,r)},gg:function(t,e,i,a,n,o,r){return this.cmn(e&a|i&~a,t,e,n,o,r)},hh:function(t,e,i,a,n,o,r){return this.cmn(e^i^a,t,e,n,o,r)},ii:function(t,e,i,a,n,o,r){return this.cmn(i^(e|~a),t,e,n,o,r)},MD5:function(t){t=this.resKey+t;for(var e=this.str2blks_MD5(t),i=1732584193,a=-271733879,n=-1732584194,o=271733878,r=0;r<e.length;r+=16){var s=i,c=a,l=n,u=o;i=this.ff(i,a,n,o,e[r+0],7,-680876936),o=this.ff(o,i,a,n,e[r+1],12,-389564586),n=this.ff(n,o,i,a,e[r+2],17,606105819),a=this.ff(a,n,o,i,e[r+3],22,-1044525330),i=this.ff(i,a,n,o,e[r+4],7,-176418897),o=this.ff(o,i,a,n,e[r+5],12,1200080426),n=this.ff(n,o,i,a,e[r+6],17,-1473231341),a=this.ff(a,n,o,i,e[r+7],22,-45705983),i=this.ff(i,a,n,o,e[r+8],7,1770035416),o=this.ff(o,i,a,n,e[r+9],12,-1958414417),n=this.ff(n,o,i,a,e[r+10],17,-42063),a=this.ff(a,n,o,i,e[r+11],22,-1990404162),i=this.ff(i,a,n,o,e[r+12],7,1804603682),o=this.ff(o,i,a,n,e[r+13],12,-40341101),n=this.ff(n,o,i,a,e[r+14],17,-1502002290),a=this.ff(a,n,o,i,e[r+15],22,1236535329),i=this.gg(i,a,n,o,e[r+1],5,-165796510),o=this.gg(o,i,a,n,e[r+6],9,-1069501632),n=this.gg(n,o,i,a,e[r+11],14,643717713),a=this.gg(a,n,o,i,e[r+0],20,-373897302),i=this.gg(i,a,n,o,e[r+5],5,-701558691),o=this.gg(o,i,a,n,e[r+10],9,38016083),n=this.gg(n,o,i,a,e[r+15],14,-660478335),a=this.gg(a,n,o,i,e[r+4],20,-405537848),i=this.gg(i,a,n,o,e[r+9],5,568446438),o=this.gg(o,i,a,n,e[r+14],9,-1019803690),n=this.gg(n,o,i,a,e[r+3],14,-187363961),a=this.gg(a,n,o,i,e[r+8],20,1163531501),i=this.gg(i,a,n,o,e[r+13],5,-1444681467),o=this.gg(o,i,a,n,e[r+2],9,-51403784),n=this.gg(n,o,i,a,e[r+7],14,1735328473),a=this.gg(a,n,o,i,e[r+12],20,-1926607734),i=this.hh(i,a,n,o,e[r+5],4,-378558),o=this.hh(o,i,a,n,e[r+8],11,-2022574463),n=this.hh(n,o,i,a,e[r+11],16,1839030562),a=this.hh(a,n,o,i,e[r+14],23,-35309556),i=this.hh(i,a,n,o,e[r+1],4,-1530992060),o=this.hh(o,i,a,n,e[r+4],11,1272893353),n=this.hh(n,o,i,a,e[r+7],16,-155497632),a=this.hh(a,n,o,i,e[r+10],23,-1094730640),i=this.hh(i,a,n,o,e[r+13],4,681279174),o=this.hh(o,i,a,n,e[r+0],11,-358537222),n=this.hh(n,o,i,a,e[r+3],16,-722521979),a=this.hh(a,n,o,i,e[r+6],23,76029189),i=this.hh(i,a,n,o,e[r+9],4,-640364487),o=this.hh(o,i,a,n,e[r+12],11,-421815835),n=this.hh(n,o,i,a,e[r+15],16,530742520),a=this.hh(a,n,o,i,e[r+2],23,-995338651),i=this.ii(i,a,n,o,e[r+0],6,-198630844),o=this.ii(o,i,a,n,e[r+7],10,1126891415),n=this.ii(n,o,i,a,e[r+14],15,-1416354905),a=this.ii(a,n,o,i,e[r+5],21,-57434055),i=this.ii(i,a,n,o,e[r+12],6,1700485571),o=this.ii(o,i,a,n,e[r+3],10,-1894986606),n=this.ii(n,o,i,a,e[r+10],15,-1051523),a=this.ii(a,n,o,i,e[r+1],21,-2054922799),i=this.ii(i,a,n,o,e[r+8],6,1873313359),o=this.ii(o,i,a,n,e[r+15],10,-30611744),n=this.ii(n,o,i,a,e[r+6],15,-1560198380),a=this.ii(a,n,o,i,e[r+13],21,1309151649),i=this.ii(i,a,n,o,e[r+4],6,-145523070),o=this.ii(o,i,a,n,e[r+11],10,-1120210379),n=this.ii(n,o,i,a,e[r+2],15,718787259),a=this.ii(a,n,o,i,e[r+9],21,-343485551),i=this.add(i,s),a=this.add(a,c),n=this.add(n,l),o=this.add(o,u)}return this.rhex(i)+this.rhex(a)+this.rhex(n)+this.rhex(o)},getFolderPath:function(t){var e="",i="",a="",n="",o=t.substring(0,1);return"c"==o||"d"==o||"e"==o||"f"==o?(e=t.substring(6,8)+"/",i=t.substring(2,4)+"/",a=t.substring(4,6)+"/",n=t.substring(0,2)+"/"):8==parseInt(o)||9==parseInt(o)||"a"==o||"b"==o?(e=t.substring(4,6)+"/",i=t.substring(0,2)+"/",a=t.substring(6,8)+"/",n=t.substring(2,4)+"/"):parseInt(o)>=4&&parseInt(o)<=7?(e=t.substring(2,4)+"/",i=t.substring(6,8)+"/",a=t.substring(0,2)+"/"):parseInt(o)>=0&&parseInt(o)<=3&&(e=t.substring(0,2)+"/",i=t.substring(4,6)+"/"),e+i+a+n}});e.exports=a,cc._RF.pop()},{}],HistoryUtils:[function(t,e,i){"use strict";cc._RF.push(e,"58bf7hKMA9L66ZvWMoVzlMH","HistoryUtils");var a=t("Singleton"),n=t("ItemConst");function o(t){return"exchange"===t?a.dao.userExchangeHistories:"shop"===t?a.dao.userPurchaseHistories:void 0}function r(t,e,i,a){var r=0;if(0===i)return n.SHOP_ITEM_STOCK_COUNT_MAX;var s=o(t);r=i;for(var c=0;c<s.length;c++)if(e===s[c].getListId())switch(a){case n.HISTORY_RESET_TYPE.DAYS:r=i-s[c].getTodayQuantity();break;case n.HISTORY_RESET_TYPE.WEEK:r=i-s[c].getWeeklyQuantity();break;case n.HISTORY_RESET_TYPE.MONTH:r=i-s[c].getMonthlyQuantity();break;default:r=i-s[c].getTotalQuantity()}return r}e.exports={getRemainingCount:function(t,e,i){return r(t,e,i,n.HISTORY_RESET_TYPE.NON)},getRemainingCountOfToday:function(t,e,i){return r(t,e,i,n.HISTORY_RESET_TYPE.DAYS)},getRemainingCountOfWeek:function(t,e,i){return r(t,e,i,n.HISTORY_RESET_TYPE.WEEK)},getRemainingCountOfMonth:function(t,e,i){return r(t,e,i,n.HISTORY_RESET_TYPE.MONTH)}},cc._RF.pop()},{ItemConst:"ItemConst",Singleton:"Singleton"}],HomeConst:[function(t,e,i){"use strict";cc._RF.push(e,"a2e29oaFyxCW55xt7L/PeFn","HomeConst"),cc.Class({statics:{BANNER:{QUEST:1,GACHA:2,SHOP:3,EVENT:4},DEFAULT_BG:"bg0001",SERIF_GROUP:{NORMAL:0,LOGIN:1},SPINE_NODE_INFO:{CHARACTER:{POS_X:0,POS_Y:100,SCALE:.85},STILL:{POS_X:0,POS_Y:0,SCALE:1}}}}),cc._RF.pop()},{}],HomeRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"1b0absyTMdPprnL7FWuUZI+","HomeRootUtils"),e.exports={openHomeRoot:function(t,e){t._myPageCharacterView?cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(t._myPageCharacterView=cc.instantiate(t.myPageCharacterViewPrefab).getComponent("MyPageCharacterView"),t._myPageCharacterView.initMyPageCharacterView(t),t.subRootParent.addChild(t._myPageCharacterView.node)),t.myPageEventQuestBannerView?cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(t.myPageEventQuestBannerView=cc.instantiate(t.myPageEventQuestBannerViewPrefab).getComponent("MyPageEventQuestBannerView"),t.myPageEventQuestBannerView.initMyPageEventQuestBannerView(t),t.subRootParent.addChild(t.myPageEventQuestBannerView.node)),t._bannerView?cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(t._bannerView=cc.instantiate(t.bannerViewPrefab).getComponent("BannerView"),t.subRootParent.addChild(t._bannerView.node)),t._myPageMainView?cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(t._myPageMainView=cc.instantiate(t.myPageMainViewPrefab).getComponent("MyPageMainView"),t._myPageMainView.initMyPageMainView(t),t.subRootParent.addChild(t._myPageMainView.node)),e.panelMission&&t.openPanelMissionPopup()},closeHomeRoot:function(t,e){t._myPageCharacterView&&(t._myPageCharacterView.node.destroy(),t._myPageCharacterView=null),t.myPageEventQuestBannerView&&(t.myPageEventQuestBannerView.node.destroy(),t.myPageEventQuestBannerView=null),t._bannerView&&(t._bannerView.node.destroy(),t._bannerView=null),t._myPageMainView&&(t._myPageMainView.node.destroy(),t._myPageMainView=null)}},cc._RF.pop()},{}],HomeRoot:[function(t,e,i){"use strict";cc._RF.push(e,"c798eSwuONN/K8jSMB2jG8b","HomeRoot");var a=t("Async"),n=t("OutGameRootBase"),o=t("CommonUtils"),r=t("Singleton"),s=t("HomeConst"),c=t("QuestUtils"),l=t("EventUtils"),u=t("DeckUtils"),h=t("GameConst"),d=t("DeckConst"),p=t("LocalDataConst"),m=t("MissionConst"),g=t("CharacterUtils"),C=t("ResourceUtils"),f=t("PopupUtils"),E=(t("RoomConst"),t("TimeUtils")),T=t("TutorialUtils"),S=t("SceneConst"),R=t("HomeViewSetting");t("MyPageCharacterView");cc.Class({extends:n,properties:{myPageCharacterViewPrefab:cc.Prefab,myPageEventQuestBannerViewPrefab:cc.Prefab,bannerViewPrefab:cc.Prefab,myPageMainViewPrefab:cc.Prefab,myPageNewsPopupPrefab:cc.Prefab,panelMissionPopupPrefab:cc.Prefab,panelMissionRewardConfirmPopupPrefab:cc.Prefab,minigameButton:cc.Prefab},bannerMasters:null,_myPageCharacterView:null,_bannerView:null,_myPageMainView:null,_presentCount:null,_myPageNewsPopup:null,_myPageNewsMasters:null,characterMainModelArray:null,_minigameButton:null,_panelMissionPopup:null,_panelMissionRewardConfirmSimpleWindow:null,_panelMissionRewardConfirmPopup:null,onLoad:function(){this._super(),this._uiHeader.setCallbackToSelectCharacterBtn(function(){cc.director.loadScene("HomeScene")})},_getSceneBgmName:function(){return h.BGM.HOME},initData:function(){this._initBannerMasters(),this._initMyPageCharacterData(),T.isTutorialEnded()&&(this.requestURLCount+=1,r.MyPageService.refresh(function(t){this.requestURLCount-=1,t.isUpdateDate?f.openCommonPopupOk("","\u65e5\u4ed8\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\u518d\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002",void 0,void 0,function(){cc.director.loadScene(S.SCENE.FILE_NAME.BOOT+".fire")},void 0,!0):(r.localData[p.IS_EXIST_GACHA_SESSION]=t.isExistsGachaSession,r.localData[p.PRESENT_COUNT]=t.presentCount)}.bind(this)))},_initBannerMasters:function(){this.bannerMasters=_.filter(r.dao.MyPageBannerMasters,function(t){return this._isActiveBanner(t)}.bind(this)),this.bannerMasters=o.sortModels(this.bannerMasters,[{getterName:"getOrder",order:"asc"}])},_isActiveBanner:function(t){switch(t.getTransitionId()){case s.BANNER.QUEST:case s.BANNER.GACHA:case s.BANNER.SHOP:return E.isRangeOfDate(t.getDateFrom(),t.getDateTo());case s.BANNER.EVENT:return l.isEventOpenByEventId(t.getTransitionParam1())}},initResource:function(){this._super(),this._requestMyPageSpineRes(),this._myPageNewsMasters=this.getMyPageNewsMasters(),this._myPageNewsMasters.forEach(function(t){this.requestRes(C.getFileNameMyPageNewsBanner(t.getNewsId()),cc.SpriteFrame)}.bind(this))},_requestMyPageSpineRes:function(){for(var t=g.getCharacterSkillMainMasterMapIndexBySkillId(),e=0;e<this.characterMainModelArray.length;e+=1)if(this.isStillByMyPageCharacterRarity(this.characterMainModelArray[e])&&!this.isDisplayRoom(this.characterMainModelArray[e])){var i=t[this.characterMainModelArray[e].getSkillId()],a=i.getSpineName(),n=C.getDirectoryIngameSkillSpine(i.getSpineDirectoryPath()),o=i.getHitEffectName(),r=C.getDirectoryIngameHitSpine(i.getSpineDirectoryPath());this.requestRes(n+a,sp.SkeletonData,this._requestEventsSpineRes.bind(this,a,n,o,r))}else this.requestRes(C.getFileNameCharacterRoomSpine(this.characterMainModelArray[e].getSpineDirectoryPath()),sp.SkeletonData)},_requestEventsSpineRes:function(t,e,i,a){var n=e+t,o=this.getResource(n);o&&_.forEach(o.skeletonJson.animations.home.events,function(t){if(!this.isSkipEventInHome(t.name))switch(t.name){case i:this.requestRes(a+t.name,sp.SkeletonData);break;default:var n=t.name,o=e+n;this.checkCommon(n)&&(o=this.convertCommonPath(n)),this.requestRes(o,sp.SkeletonData)}}.bind(this))},checkCommon:function(t){return 0===t.lastIndexOf("gr_",0)},convertCommonPath:function(t){return"download/character/common/spine/"+t.substr(3,t.length-3)},isSkipEventInHome:function(t){return 0===t.indexOf("gr_se_")||0===t.indexOf("se_")||0===t.indexOf("vo_")},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,R.HOME_SETTING)},initialize:function(){var t=[];t.push(this.openMyPageNewsPopup.bind(this)),t.push(this.openGachaTransitionPopup.bind(this)),t.push(this.openUserRenamePopup.bind(this)),a.waterfall(t),this.initOutGameRootBase(),this._uiHeader.setSwitchCharacterShowModeCallBack(function(){this.setSwitchCharacterShowMode()}.bind(this));this._initOpenFirstView({HomeRoot:{}})},transitionBanner:function(t){var e,i,a=this.bannerMasters[t].getTransitionId(),n=this.bannerMasters[t].getTransitionParam1(),o=this.bannerMasters[t].getTransitionParam2(),r=this.bannerMasters[t].getTransitionParam3();switch(a){case s.BANNER.QUEST:e="QuestScene",i=this.setTransitionQuest(n,o,r);break;case s.BANNER.GACHA:e="GachaScene",i=this.setTransitionGacha(n,o,r);break;case s.BANNER.SHOP:e="ShopScene",i=this.setTransitionShop(n,o,r);break;case s.BANNER.EVENT:var c=this.getTransitionEventData(n,o,r);if(!l.isEventOpenByEventId(c.eventId))return f.openSimpleMessageWindow("\u30a4\u30d9\u30f3\u30c8\u306f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002",void 0,"mypage_out_range_event");var u=l.getTransitionEventSceneData(c.eventId);e=u.sceneName,i=u.sceneParam;break;default:return cc.error("\u9077\u79fb\u5148\u304c\u5b58\u5728\u3057\u307e\u305b\u3093")}this.pushScene(e,this.getCurrentSceneName(),i,{HomeRoot:{}})},setTransitionQuest:function(t,e,i){if(t&&!e){var a=c.getUserQuestMapByWorldId(t);if(0!==Object.keys(a).length)return{QuestTopSubRoot:{worldId:t}}}else if(t&&e){a=c.getUserQuestMapByWorldId(t);if(0!==Object.keys(a).length&&a[e])return{QuestTopSubRoot:{worldId:t,areaId:e}}}},setTransitionGacha:function(t,e,i){return{GachaTopSubRoot:{selectGachaId:t}}},setTransitionShop:function(t,e,i){return{ShopSelectSubRoot:{}}},getTransitionEventData:function(t,e,i){return{eventId:parseInt(t)}},setSwitchCharacterShowMode:function(){this._myPageCharacterView.switchCharacterShowMode()},setUIHeaderVisibleSwitchCharacterShowModeBtn:function(t){this._uiHeader.setVisibleSwitchCharacterShowModeBtn(t)},openMyPageNewsPopup:function(t){if(this.closeMyPageNewsPopup(),!T.isTutorialEnded()||!r.localData[p.MYPAGE_NEWS_FIRST_START])return t();r.localData[p.MYPAGE_NEWS_FIRST_START]=!1,this._myPageNewsPopup=cc.instantiate(this.myPageNewsPopupPrefab).getComponent("MyPageNewsPopup"),this._myPageNewsPopup.openMyPageNewsPopup(this._myPageNewsMasters,t)},closeMyPageNewsPopup:function(){this._myPageNewsPopup&&(this._myPageNewsPopup.close(),this._myPageNewsPopup=null)},openGachaTransitionPopup:function(t){if(!r.localData[p.IS_EXIST_GACHA_SESSION])return t();r.localData[p.IS_EXIST_GACHA_SESSION]=!1,f.openCommonPopupOk("\u78ba\u8a8d","\u78ba\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u30ac\u30c1\u30e3\u30ea\u30b6\u30eb\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\n\u30ac\u30c1\u30e3\u753b\u9762\u306b\u9077\u79fb\u3057\u307e\u3059\u3002","",!1,function(){this.pushScene("GachaScene",this.getCurrentSceneName(),{GachaTopSubRoot:{selectGachaId:0,isLoadSession:!0}})}.bind(this),"OK")},openUserRenamePopup:function(t){if(!T.isTutorialEnded())return t();var e=r.dao.userBasicData;switch(e.getUserNameStatus()){case h.INSPECTION_STATUS_TYPE.INSPECTING:r.UserService.updateUserNameInspection(function(){r.UserService.checkUserNameStatus(function(){})});break;case h.INSPECTION_STATUS_TYPE.DELETE:case h.INSPECTION_STATUS_TYPE.NG:r.UserService.checkUserNameStatus(function(){});break;case h.INSPECTION_STATUS_TYPE.ERROR:r.UserService.updateUserName(e.getUserName(),function(){r.UserService.checkUserNameStatus(function(){})})}return t()},getMyPageNewsMasters:function(){var t=r.dao.MyPageNewsMasters.filter(function(t){return E.isDateInRange(E.getNowDateTime(),t.getDateFrom(),t.getDateTo())}).slice();return t.sort(function(t,e){return t.getOrder()>e.getOrder()?1:-1}),t},_initMyPageCharacterData:function(){this.characterMainModelArray=[];var t=r.dao[r.USER].userData.getPartner(),e=g.getCharacterMainModelByCharacterId(t.partnerId);if(e)this.characterMainModelArray.push(e);else{var i=u.createDeckMap()[d.DECK_TYPE.QUEST][r.localData[p.SELECT_QUEST_DECK_ORDER]];this.characterMainModelArray.push(i[d.DECK_LEADER_POSITION][d.ROLE_TYPE.MAIN].getCharacterMainMaster())}},isDisplayRoom:function(t){var e=r.dao[r.USER].userData.getPartner();return e.partnerId===t.getCharacterId()&&0!==e.isDisplayRoom},isStillByMyPageCharacterRarity:function(t){return 3<=t.getRarity()},openPanelMissionPopup:function(t){this.closePanelMissionPopup(),this._panelMissionPopup=cc.instantiate(this.panelMissionPopupPrefab).getComponent("PanelMissionPopup"),this._panelMissionPopup.openPanelMissionPopup(this,m.PANEL_MISSION_CONST.MISSION_TYPE.BEGINNER,t)},closePanelMissionPopup:function(){this._panelMissionPopup&&(this._panelMissionPopup.close(),this._panelMissionPopup=null)},openPanelMissionRewardConfirmPopup:function(t,e){this.closePanelMissionRewardConfirmPopup(),this._panelMissionRewardConfirmPopup=cc.instantiate(this.panelMissionRewardConfirmPopupPrefab).getComponent("PanelMissionRewardConfirmPopup"),this._panelMissionRewardConfirmPopup.openPanelMissionRewardConfirmPopup(this,t,e)},closePanelMissionRewardConfirmPopup:function(){this._panelMissionRewardConfirmPopup&&(this._panelMissionRewardConfirmPopup.close(),this._panelMissionRewardConfirmPopup=null)},requestReceiveMissionGetItem:function(t,e){r.MissionService.receive([t.getMissionCd()],function(i){cc.log("mission_receive : \u901a\u4fe1\u5b8c\u4e86"),e&&e(),this.openPanelMissionRewardConfirmPopup([t])}.bind(this))},requestAllReceiveMissionGetItem:function(t,e){var i=_.map(t,function(t){return t.getMissionCd()});r.MissionService.receive([i],function(i){cc.log("mission_receive : \u901a\u4fe1\u5b8c\u4e86"),e&&e(),this.openPanelMissionRewardConfirmPopup(t)}.bind(this))},transitionSceneByPanelMissionPopup:function(t){this.pushScene(t,this.getCurrentSceneName(),void 0,{HomeRoot:{}})}}),cc._RF.pop()},{Async:"Async",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckUtils:"DeckUtils",EventUtils:"EventUtils",GameConst:"GameConst",HomeConst:"HomeConst",HomeViewSetting:"HomeViewSetting",LocalDataConst:"LocalDataConst",MissionConst:"MissionConst",MyPageCharacterView:"MyPageCharacterView",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",SceneConst:"SceneConst",Singleton:"Singleton",TimeUtils:"TimeUtils",TutorialUtils:"TutorialUtils"}],HomeViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"eca17XcWvhBwIJmrzXBbNYs","HomeViewSetting");var a=t("HomeRootUtils");e.exports={HOME_SETTING:{HomeRoot:{open:a.openHomeRoot,close:a.closeHomeRoot}}},cc._RF.pop()},{HomeRootUtils:"HomeRootUtils"}],HotUpdate:[function(t,e,i){"use strict";cc._RF.push(e,"ee8c3BV3mdFkLQkYHy10fQD","HotUpdate");t("ResourceUtils"),t("GameConst"),t("StaticResourceConst");var a=t("PopupUtils");cc.Class({extends:cc.Component,properties:{progressBar:cc.ProgressBar,percentLabel:cc.Label,manifestUrl:{type:cc.Asset,default:null},_updating:!1,_canRetry:!1,_storagePath:"",_root:null,_loadView:null},_hotUpdateEndCallBackFunc:null,_checkCb:function(t){var e,i;cc.log("HotUpdate:checkCb: "+t.getEventCode());var a=function(){this._am.setEventCallback(null),this._checkListener=null,this._updating=!1}.bind(this);switch(t.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:e="\u30ed\u30fc\u30ab\u30eb\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002",cc.log(e),a(),this._hotUpdateEndCallBackFunc(t,e);break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:e="\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u3002",cc.log(e),a(),this._hotUpdateEndCallBackFunc(t,e);break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:i="\u3059\u3067\u306b\u6700\u65b0\u306e\u30ea\u30e2\u30fc\u30c8\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u6700\u65b0\u306e\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002",cc.log(i),a(),this._hotUpdateEndCallBackFunc(t,null);break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:i="\u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f\u3002\u66f4\u65b0\u3092\u8a66\u307f\u3066\u304f\u3060\u3055\u3044\u3002",cc.log(i),this.addUpdateTip(function(){a(),this.progressBar.progress=0,this._hotUpdate()}.bind(this));break;default:return void cc.log("HotUpdate:checkCb:default")}},_updateCb:function(t){var e=!1,i=!1,a="";switch(t.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:cc.log("\u30ed\u30fc\u30ab\u30eb\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u30db\u30c3\u30c8\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306f\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3057\u305f\u3002"),a="\u30ed\u30fc\u30ab\u30eb\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002",i=!0;break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:cc.log(t.getPercent()+"%"),this.percentLabel.string=!0===isNaN(t.getPercent())?0:parseInt(100*t.getPercent())+"",this.progressBar.progress=!0===isNaN(t.getPercent())?0:t.getPercent();var n=t.getMessage();n&&cc.log("\u66f4\u65b0\u6e08\u307f\u30d5\u30a1\u30a4\u30eb: "+n);break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:cc.log("\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u3001\u30db\u30c3\u30c8\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3057\u305f\u3002"),a="\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057",i=!0;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:cc.log("\u3059\u3067\u306b\u6700\u65b0\u306e\u30ea\u30e2\u30fc\u30c8\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u6700\u65b0\u306e\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002"),i=!0;break;case jsb.EventAssetsManager.UPDATE_FINISHED:cc.log("\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002 "+t.getMessage()),e=!0;break;case jsb.EventAssetsManager.UPDATE_FAILED:cc.log("\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002 "+t.getMessage()),this._updating=!1,this._canRetry=!0;break;case jsb.EventAssetsManager.ERROR_UPDATING:cc.log("\u30a2\u30bb\u30c3\u30c8\u306e\u66f4\u65b0\u30a8\u30e9\u30fc: "+t.getAssetId()+", "+t.getMessage());break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:cc.log(t.getMessage())}if(i&&(cc.log("HotUpdate:updateCb:failed"),this._am.setEventCallback(null),this._updateListener=null,this._updating=!1,""!=a&&this._hotUpdateEndCallBackFunc(t,a)),e){cc.log("HotUpdate:updateCb:AllEnd"),this._updating=!1;var o=jsb.fileUtils.getSearchPaths(),r=this._am.getLocalManifest().getSearchPaths();cc.log(JSON.stringify(r)),o.unshift(r[0]),cc.sys.localStorage.setItem("HotUpdateSearchPaths",JSON.stringify(o)),jsb.fileUtils.setSearchPaths(o),cc.audioEngine.stopAll(),cc.game.restart()}},_retry:function(){!this._updating&&this._canRetry&&(this._canRetry=!1,cc.log("\u5931\u6557\u3057\u305f\u30a2\u30bb\u30c3\u30c8\u3092\u518d\u8a66\u884c..."),this._am.downloadFailedAssets())},_checkUpdate:function(){if(cc.log("HotUpdate:checkUpdate"),this._updating)cc.log("\u78ba\u8a8d\u307e\u305f\u306f\u66f4\u65b0\u4e2d...");else{if(this._am.getState()===jsb.AssetsManager.State.UNINITED){var t=this.manifestUrl.nativeUrl;cc.loader.md5Pipe&&(t=cc.loader.md5Pipe.transformURL(t)),this._am.loadLocalManifest(t)}this._am.getLocalManifest()&&this._am.getLocalManifest().isLoaded()?(this._am.setEventCallback(this._checkCb.bind(this)),this._am.checkUpdate(),this._updating=!0):cc.log("\u30ed\u30fc\u30ab\u30eb\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f...")}},_hotUpdate:function(){if(cc.log("HotUpdate:hotUpdate"),this._am&&!this._updating){if(cc.log("\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u958b\u59cb"),this._am.setEventCallback(this._updateCb.bind(this)),this._am.getState()===jsb.AssetsManager.State.UNINITED){var t=this.manifestUrl.nativeUrl;cc.loader.md5Pipe&&(t=cc.loader.md5Pipe.transformURL(t)),this._am.loadLocalManifest(t)}this._failCount=0,this._am.update(),this._updating=!0}},startHotUpdate:function(t){cc.log("HotUpdate:startHotUpdate"),this._hotUpdateEndCallBackFunc=t,cc.sys.isNative?(cc.log("Native\u7248"),this._checkUpdate()):(cc.log("Web\u7248"),null!=this._hotUpdateEndCallBackFunc&&this._hotUpdateEndCallBackFunc(null))},onLoad:function(){cc.log("HotUpdate:onLoad"),this.node.active=!1,cc.sys.isNative?(this._storagePath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"deepone-assets",cc.log("Storage path for remote asset : "+this._storagePath),this.versionCompareHandle=function(t,e){cc.log("JS\u30ab\u30b9\u30bf\u30e0\u30d0\u30fc\u30b8\u30e7\u30f3\u6bd4\u8f03: \u30ed\u30fc\u30ab\u30eb\u306f "+t+", \u30b5\u30fc\u30d0\u30fc\u306f "+e);for(var i=t.split("."),a=e.split("."),n=0;n<i.length;++n){var o=parseInt(i[n]),r=parseInt(a[n]||0);if(o!==r)return o-r}return a.length>i.length?-1:0},this._am=new jsb.AssetsManager("",this._storagePath,this.versionCompareHandle),cc.log(this._am),this._am.setVerifyCallback(function(t,e){var i=e.compressed,a=e.md5,n=e.path;e.size;return i?(cc.log("\u78ba\u8a8d\u306b\u5408\u683c\u3057\u307e\u3057\u305f : "+n),!0):(cc.log("\u78ba\u8a8d\u306b\u5408\u683c\u3057\u307e\u3057\u305f : "+n+" ("+a+")"),!0)}),cc.sys.os===cc.sys.OS_ANDROID&&(this._am.setMaxConcurrentTask(2),cc.log("\u6700\u5927\u4e26\u5217\u30bf\u30b9\u30af\u6570\u306f2\u306b\u5236\u9650\u3055\u308c\u3066\u3044\u307e\u3059")),this.progressBar.progress=0):cc.log("Web\u7248")},addUpdateTip:function(t){var e=this;a.openCommonPopupOk("","\u30a2\u30d7\u30ea\u306e\u66f4\u65b0\u3092\u884c\u3044\u307e\u3059\n\u901a\u4fe1\u74b0\u5883\u306e\u826f\u3044\u5834\u6240\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u884c\u306a\u3063\u3066\u304f\u3060\u3055\u3044","",!1,function(){t(),e.node.active=!0})}}),cc._RF.pop()},{GameConst:"GameConst",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],HowToPlayPopup:[function(t,e,i){"use strict";cc._RF.push(e,"a6723EmzTZFt4LP+nI8+IEO","HowToPlayPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("CommonScrollView"),t("Singleton"),t("EventUtils"),t("ResourceUtils"));t("HistoryUtils"),t("CommonUtils"),t("ItemUtils"),cc.Class({extends:a,properties:{pageView:cc.PageView,indicatorParentNode:cc.Node,indicatorPrefab:cc.Prefab,pageDescriptionTextLabel:cc.Label,rightAllowBtn:n,leftAllowBtn:n,closeBtn:n},_helpImagePathArray:null,_helpDescriptionTextArray:null,_indicatorArray:null,openHowToPlayPopup:function(t,e,i){this._setParameter(t,e),this.setCloseCallBack(i),this._initPageViewContent(),this._initIndicator(),this._initButton(),this.closeBtn.setTapEvent(function(){this.close()}.bind(this),n.SE_NAME.CANCEL),this.open(this.openCallback.bind(this))},openCallback:function(){this.pageView.node.active=!0,this._redraw(),this.pageView.node.on("scroll-ended",this._redraw,this)},_redraw:function(){this.redrawIndicator(),this.redrawVisibleButton(),this.redrawDescriptionText()},_setParameter:function(t,e){this._helpImagePathArray=t,this._helpDescriptionTextArray=e},_initPageViewContent:function(){for(var t=null,e=0;e<this._helpImagePathArray.length;e+=1)t=(new cc.Node).addComponent(cc.Sprite),o.addSprite(t,this._helpImagePathArray[e]),this.pageView.addPage(t.node);this.pageView.node.active=!1},_initIndicator:function(){var t=this._helpImagePathArray.length;this._indicatorArray=[];for(var e=-25*(t-1)/2,i=0;i<t;i+=1){var a=cc.instantiate(this.indicatorPrefab);a.getChildByName("IndicatorEnable").active=!1,a.getChildByName("IndicatorBase").active=!0;var n=e+25*i;a.position=cc.v2(n,a.position.y+5),this.indicatorParentNode.addChild(a),this._indicatorArray.push(a)}},_initButton:function(){this.rightAllowBtn.setTapEvent(this.rightAllowBtnEvent.bind(this),n.SE_NAME.COUNT),this.leftAllowBtn.setTapEvent(this.leftAllowBtnEvent.bind(this),n.SE_NAME.COUNT)},rightAllowBtnEvent:function(){var t=this.pageView.getCurrentPageIndex();t<this._helpImagePathArray.length-1&&this.pageView.setCurrentPageIndex(t+1)},leftAllowBtnEvent:function(){var t=this.pageView.getCurrentPageIndex();t>0&&this.pageView.setCurrentPageIndex(t-1)},redrawIndicator:function(){for(var t=0;t<this._indicatorArray.length;t++)this._indicatorArray[t].getChildByName("IndicatorEnable").active=!1;this._indicatorArray.length>0&&(this._indicatorArray[this.pageView.getCurrentPageIndex()].getChildByName("IndicatorEnable").active=!0)},redrawDescriptionText:function(){this.pageDescriptionTextLabel.string=this._helpDescriptionTextArray[this.pageView.getCurrentPageIndex()]},redrawVisibleButton:function(){this.rightAllowBtn.node.active=!0,this.leftAllowBtn.node.active=!0;var t=this.pageView.getCurrentPageIndex();0===t&&(this.leftAllowBtn.node.active=!1),t===this._helpImagePathArray.length-1&&(this.rightAllowBtn.node.active=!1)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",EventUtils:"EventUtils",HistoryUtils:"HistoryUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],HttpStatus:[function(t,e,i){"use strict";cc._RF.push(e,"fff9dO+BndLqaVhi8uoNDoN","HttpStatus"),e.exports={HTTP_200:200},cc._RF.pop()},{}],Http:[function(t,e,i){"use strict";cc._RF.push(e,"ec938QQcWNHxoVajNonts63","Http");var a=t("Singleton"),n=t("SingletonConst"),o=t("NetworkUtils"),r=t("ErrorCode"),s=[{optionKey:"accept",headerKey:"Accept"},{optionKey:"authorization",headerKey:"Authorization"},{optionKey:"x-deep-one-app-version",headerKey:"X-Deep-One-App-Version"}],c=[{optionKey:"accept",headerKey:"Accept"},{optionKey:"authorization",headerKey:"Authorization"},{optionKey:"contentType",headerKey:"Content-Type"},{optionKey:"x-deep-one-app-version",headerKey:"X-Deep-One-App-Version"}],l=[];function u(t){l.splice(l.indexOf(t),1)}function h(t,e,i){var a,n;for(a=0;a<e.length;a+=1)void 0!==i[(n=e[a]).optionKey]&&t.setRequestHeader(n.headerKey,i[n.optionKey])}function d(t){return r["SERVER_"+t+"_ERROR"]?r["SERVER_"+t+"_ERROR"]:r.SERVER_ERROR}function p(t,e,i,c){var p,m;o.checkNetworkReachabilitySanity(function(){var _=a[n.ERROR_MANAGER];p=cc.loader.getXMLHttpRequest(),i&&(p.responseType="arraybuffer"),cc.sys.isNative,p.open("GET",t),h(p,s,e),p.onreadystatechange=function(){if(4===p.readyState&&200===p.status){if(clearTimeout(m),u(p),this){var t=o.checkHttpStatusSanity(p.status);i?(p&&p.response&&0==p.response.byteLength&&(t=_.getErrorInfo(r.NETWORK_ERROR)),this(t,p&&p.response)):(p&&p.responseText&&0==p.responseText.length&&(t=_.getErrorInfo(r.NETWORK_ERROR)),this(t,p&&p.responseText)),c=void 0,cc.sys.isNative}}else if(400<=p.status&&p.status<=599){var e=d(p.status);return u(p),p.abort(),c(_.getErrorInfo(e))}}.bind(c),p.onerror=function(){if(clearTimeout(m),u(p),c)return cc.sys.isNative,c(_.getErrorInfo(r.NETWORK_ERROR))};var g=a[n.ENVIRONMENT];m=setTimeout(function(){return u(p),p.abort(),cc.sys.isNative,c(_.getErrorInfo(r.CLIENT_TIME_OUT))},e.timeout||g.getApiTimeout()),l.push(p),p.send()})}function m(t,e,i,s){var p,m;o.checkNetworkReachabilitySanity(function(){var _=a[n.ERROR_MANAGER];p=cc.loader.getXMLHttpRequest(),cc.sys.isNative,p.open("POST",t),h(p,c,i),p.onreadystatechange=function(){if(4===p.readyState&&200===p.status){if(clearTimeout(m),u(p),s){cc.sys.isNative;var t=o.checkHttpStatusSanity(p.status);return p&&p.responseText&&0==p.responseText.length&&(t=_.getErrorInfo(r.NETWORK_ERROR)),s(t,p&&p.responseText)}}else if(400<=p.status&&p.status<=599){var e=d(p.status);return clearTimeout(m),u(p),p.abort(),s(_.getErrorInfo(e))}},p.onerror=function(){if(clearTimeout(m),u(p),s)return cc.sys.isNative,s(_.getErrorInfo(r.NETWORK_ERROR))};var g=a[n.ENVIRONMENT];m=setTimeout(function(){return u(p),p.abort(),cc.sys.isNative,s(_.getErrorInfo(r.CLIENT_TIME_OUT))},i.timeout||g.getApiTimeout()),l.push(p),p.send(e)})}function _(t){return function(e,i){var a={};if(i&&i.length>0)try{a=JSON.parse(i)}catch(t){e=e||t}t(e,a)}}e.exports={httpGetJson:function(t,e,i){"function"==typeof e&&(i=e,e=void 0),(e=e||{}).accept="application/json;charset=UTF-8",p(t,e,!1,_(i))},httpGetBinary:function(t,e,i){"function"==typeof e&&(i=e,e=void 0),p(t,e=e||{},!0,i)},httpPostJson:function(t,e,i,a){"function"==typeof i&&(a=i,i=void 0),i=i||{},cc.sys.browserType===cc.sys.BROWSER_TYPE_IE?(i.contentType="text/plain;charset=UTF-8",i.accept="text/plain;charset=UTF-8"):(i.contentType="application/json;charset=UTF-8",i.accept="application/json;charset=UTF-8"),m(t,e,i,_(a))},cleanup:function(){var t,e;for(t=0;t<l.length;t+=1)(e=l[t]).onreadystatechange=void 0,e.onerror=void 0,cc.sys.isNative;l=[]}},cc._RF.pop()},{ErrorCode:"ErrorCode",NetworkUtils:"NetworkUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],InitCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"fef21uKhVNIIqrXUbnFVRyE","InitCharacterModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],InitEquipmentModel:[function(t,e,i){"use strict";cc._RF.push(e,"381b1aBJEJKv50WkgTmSJzc","InitEquipmentModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEquipmentId:function(){if(this._isKeyFieldAvailable("equipmentId"))return this._data.equipmentId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentId")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],InitItemModel:[function(t,e,i){"use strict";cc._RF.push(e,"96e2b3Ya25GuIU+OmYiffgR","InitItemModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemApRecoveryGemModel:[function(t,e,i){"use strict";cc._RF.push(e,"11cedAbP0xAdYgBHQCPrtTN","ItemApRecoveryGemModel");var a=t("MasterDatabase"),n=t("Singleton")[t("SingletonConst").ERROR_MANAGER];cc.Class({extends:a,getEffectValue:function(){if(this._isKeyFieldAvailable("effectValue"))return this._data.effectValue;n.throwModelPropertyNotFoundError("object field is invalid :: effectValue")},getCostCount:function(){if(this._isKeyFieldAvailable("costCount"))return this._data.costCount;n.throwModelPropertyNotFoundError("object field is invalid :: costCount")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemApis:[function(t,e,i){"use strict";cc._RF.push(e,"c2cc6NV7MhOB5FU/kRXZ6LH","ItemApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.LOGIN,path:"user/login",method:"POST"}),a.RESTClient.graft({name:n.ITEM_GET_MASTER_DATA,path:"item/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.ITEM_GET_USER_DATA,path:"item/getUserData",method:"POST"}),a.RESTClient.graft({name:n.ITEM_SELL,path:"item/sell",method:"POST"}),a.RESTClient.graft({name:n.ITEM_USE,path:"item/use",method:"POST"}),a.RESTClient.graft({name:n.ITEM_USE_RECOVERY_ITEM,path:"item/useRecoveryItem",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],ItemCategoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"2a726+wPVxDr5O+Cuh2+bFO","ItemCategoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getMaxCount:function(){if(this._isKeyFieldAvailable("maxCount"))return this._data.maxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCount")},getItemCategory:function(){if(this._isKeyFieldAvailable("itemCategory"))return this._data.itemCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemCategory")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemConst:[function(t,e,i){"use strict";cc._RF.push(e,"359f3wtJSFH+pg/k0iUFXoL","ItemConst"),cc.Class({statics:{ITEM_CATEGORY:cc.Enum({NONE:0,RECIPE:1,EQUIPMENT:2,MATERIAL:3,CONSUME:4}),ITEM_TYPE:cc.Enum({DMM_POINT:100,FREE_GEM:101,PAID_GEM:102,ONLY_FREE_GEM:103,GOLD:201,GACHA_POINT:202,EQUIPMENT_FORTIFY_MATERIAL:301,EQUIPMENT_RECIPE:302,CHARA_POSSESSION_BORDER:401,EQUIPMENT_POSSESSION_BORDER:402,LOGIN_PACK:411,GIFT_FROM:501,GIFT_TO:599,AP_RECOVERY:701,KEY:711,SKIP_TICKET:721,SELECT_TICKET:731,RELEASE_STORY_TICKET:741,GACHA_TICKET:781,ANOTHER_GACHA_TICKET:782,SET_ITEM:791,USABLE_SET_ITEM:792,EXCHANGE_POINT:801,RELEASE_SET:900,CHARACTER:910,EQUIPMENT:911,FURNITURE:961,AP:991}),GIFT_ITEM_FAVORITE_ADD_TYPE:cc.Enum({RATE:1,ADD:2,OVERWRITE:3}),EQUIPMENT_TYPE:{ATK:1,DEF:2,FORTIFY_MATERIAL:3,EXCEED_LIMIT_MATERIAL:4},EQUIPMENT_BOOST_TYPE:cc.Enum({NORMAL:0,BOOST:1}),GEM_ITEM_ID:cc.Enum({FREE:101001,PAID:102001}),AP_CONSUME_ITEM:701001,AP_CONSUME_ITEM_HALF:701002,BP_CONSUME_ITEM:702001,BP_CONSUME_ITEM_HALF:702002,NORMAL_QUEST_SKIP_TICKET:721001,RAID_CHALLENGE_ITEM:712001,RELEASE_EVENT_STORY_TICKET:741001,RAID_GACHA_TICKET:781002,SHOP_TAB:cc.Enum({CAMPAIGN:0,GEM:1,SET:2,NORMAL:3,BOX:4}),SHOP_CATEGORY:cc.Enum({CAMPAIGN:1,GEM:2,SET:3,NORMAL:4,BOX:5}),SHOP_ITEM_STOCK_COUNT_MAX:999,SHOP_RESET_TYPE:{NON:0,DAYS:1,MONTH:2,REPLENISHMENT_DAYS:3,REPLENISHMENT_LOGIN_DAYS:4},HISTORY_RESET_TYPE:{NON:0,DAYS:1,WEEK:2,MONTH:3},WAREHOUSE_TAB:cc.Enum({CONSUME:0,GIFT:1,EQUIPMENT:2,CHARACTER_STORAGE:3,EQUIPMENT_STORAGE:4,MATERIAL_STORAGE:5,OTHER:6})}}),cc._RF.pop()},{}],ItemMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"7469eynZ7FLYrYYY9awtorR","ItemMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getItemCategory:function(){if(this._isKeyFieldAvailable("itemCategory"))return this._data.itemCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemCategory")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getIconName:function(){if(this._isKeyFieldAvailable("iconName"))return this._data.iconName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: iconName")},getSalePrice:function(){if(this._isKeyFieldAvailable("salePrice"))return this._data.salePrice;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: salePrice")},getEffectValue:function(){if(this._isKeyFieldAvailable("effectValue"))return this._data.effectValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectValue")},getEffectTime:function(){if(this._isKeyFieldAvailable("effectTime"))return this._data.effectTime;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: effectTime")},getRarity:function(){if(this._isKeyFieldAvailable("rarity"))return this._data.rarity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rarity")},getAttribute:function(){if(this._isKeyFieldAvailable("attribute"))return this._data.attribute;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: attribute")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"3e8050AJ8ZApJcraUPZxnF2","ItemMatrixThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("MatrixThumbnailBase");cc.Class({extends:o,properties:{mainImageSprite:cc.Sprite,mainNode:cc.Node,grayDispNode:cc.Node,isSelectedNode:cc.Node,emptyNode:cc.Node,numeLabel:cc.Label,denomLabel:cc.Label,popVeilNode:cc.Node,popAnim:cc.Animation,thumbnailBtn:a},resetItemMatrixThumbnail:function(){this.mainImageSprite.spriteFrame=null,this.setDenomCount("","")},setMainImage:function(t){n.addSprite(this.mainImageSprite,t)},setNumeCount:function(t,e,i){this.numeLabel.string=t+e,i&&(this.numeLabel.node.color=i)},setDenomCount:function(t,e){this.denomLabel.string=t+e},setCountSize:function(t){this.numeLabel.fontSize=t,this.denomLabel.fontSize=t},setActive:function(t){this.grayDispNode.active=!t},setSelectedNodeActive:function(t){this.isSelectedNode.active=t},setSelectedOrder:function(t){},setProtected:function(t){},getProtected:function(){return!1},switchEmptyNodeActive:function(t){this.emptyNode.active=t,this.mainNode.active=!t},setCallbackToThumbnailBtn:function(t){this.thumbnailBtn.setTapEvent(t,"")},playPopAnim:function(t){this.popVeilNode.active=!0,this.popAnim.play(),t&&this.popAnim.on("finished",function(e,i){if(i.name===this.popAnim.getClips()[0].name)return t()},this)}});cc._RF.pop()},{CommonButton:"CommonButton",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils"}],ItemModel:[function(t,e,i){"use strict";cc._RF.push(e,"c11femYNgZE2LVOA8EIa9ht","ItemModel");var a=t("UserItemModel"),n=t("Singleton");cc.Class({userData:void 0,_itemMainMaster:void 0,_itemRecipeMaster:void 0,_itemSetMaster:void 0,_itemSelectMaster:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._itemMainMaster=null,this._itemRecipeMaster=null,this._itemSetMaster=null},getItemMainMaster:function(){return this._itemMainMaster||(this._itemMainMaster=n.dao.ItemMainMasters.find(function(t){return t.getItemId()===this.userData.getItemId()}.bind(this)),this._itemMainMaster||(this._itemMainMaster=n.dao.ItemMainMasters[0])),this._itemMainMaster},getItemRecipeMaster:function(){return this._itemRecipeMaster||(this._itemRecipeMaster=n.dao.ItemRecipeMasters.find(function(t){return t.getItemId()===this.userData.getItemId()}.bind(this))),this._itemRecipeMaster},getItemSetMaster:function(){return this._itemSetMaster||(this._itemSetMaster=n.dao.ItemSetMasters.find(function(t){return t.getItemId()===this.userData.getItemId()}.bind(this))),this._itemSetMaster},getItemSelectMaster:function(){return this._itemSelectMaster||(this._itemSelectMaster=n.dao.ItemSelectMasters.find(function(t){return t.getItemId()===this.userData.getItemId()}.bind(this))),this._itemSelectMaster},getItemId:function(){return this.userData.getItemId()},getName:function(){return this.getItemMainMaster().getName()},getCount:function(){return this.userData.getCount()},getText:function(){return this.getItemMainMaster().getText()},getItemType:function(){return this.userData.getItemType()},getItemCategory:function(){return this.getItemMainMaster().getItemCategory()},getSetItemId:function(){return this.getItemSetMaster().getSetItemId()},getEffectValue:function(){return this.getItemMainMaster().getEffectValue()},getSetId:function(){return this.getItemSelectMaster().getSetId()},getSelectItemId:function(){return this.getItemSelectMaster().getSelectItemId()},getSalePrice:function(){return this.getItemMainMaster().getSalePrice()},getRarity:function(){return this.getItemMainMaster().getRarity()},getFromDate:function(){return this.getItemMainMaster().getFromDate()},getToDate:function(){return this.getItemMainMaster().getToDate()}});cc._RF.pop()},{Singleton:"Singleton",UserItemModel:"UserItemModel"}],ItemNoticeWindow:[function(t,e,i){"use strict";cc._RF.push(e,"fcb0aN4yNhFKonRS0uLqwE2","ItemNoticeWindow");var a=t("MatrixThumbnail"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("ItemUtils");cc.Class({extends:cc.Component,properties:{itemNoticeWindowAnimation:cc.Animation,itemThumbnail:a,noticeTextLabel:cc.Label,noticeNumLabel:cc.Label},_itemMainMaster:null,initItemNoticeWindow:function(t,e,i){this._itemMainMaster=r.getItemMaster(t),this._initItemThumbnail(),this.noticeTextLabel.string=e,this.noticeNumLabel.string=n.convertToCommaDelimited(i)},playItemNoticeWindowOpenAnimation:function(t){var e=this.itemNoticeWindowAnimation.getClips()[0];this.itemNoticeWindowAnimation.once("finished",function(e){return this.node.destroy(),t()},this),this.node.active=!0,this.itemNoticeWindowAnimation.play(e.name)},_initItemThumbnail:function(){var t=o.getFileNameThumbnailByItemType(this._itemMainMaster.getItemId(),this._itemMainMaster.getItemType());this.itemThumbnail.initItemMatrixThumbnail(t,void 0,void 0,void 0)}}),cc._RF.pop()},{CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",MatrixThumbnail:"MatrixThumbnail",ResourceUtils:"ResourceUtils"}],ItemQuestLockModel:[function(t,e,i){"use strict";cc._RF.push(e,"081dbPRSM1Kt63IqJLOwk4c","ItemQuestLockModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getQuestIds:function(){if(this._isKeyFieldAvailable("questIds"))return this._data.questIds;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: questIds")},getQuestType:function(){if(this._isKeyFieldAvailable("questType"))return this._data.questType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: questType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemRecipeModel:[function(t,e,i){"use strict";cc._RF.push(e,"6cb28c23QdLZpdXo760RgT9","ItemRecipeModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getNeedCount:function(){if(this._isKeyFieldAvailable("needCount"))return this._data.needCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: needCount")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getRecipeItemId:function(){if(this._isKeyFieldAvailable("recipeItemId"))return this._data.recipeItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: recipeItemId")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemSelectModel:[function(t,e,i){"use strict";cc._RF.push(e,"054a12Fh6BFWbcF9dFLnpnu","ItemSelectModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getSelectItemId:function(){if(this._isKeyFieldAvailable("selectItemId"))return this._data.selectItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: selectItemId")},getSetId:function(){if(this._isKeyFieldAvailable("setId"))return this._data.setId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: setId")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemService:[function(t,e,i){"use strict";cc._RF.push(e,"e4674G+i3VHe6tYBtJvolMv","ItemService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,sell:function(t,e,i){var a=this._createItemSellRequestParameter(t,e);this._requestCallApi(n.ITEM_SELL,a,function(t,e){return i(t?void 0:e)})},_createItemSellRequestParameter:function(t,e){var i={items:[]};for(var a in t)i.items.push({itemId:t[a],count:e[a]});return i},_createUseRecoveryItemParameterArray:function(t,e){var i=[];if(Array.isArray(t)&&Array.isArray(e)&&t.length===e.length)for(var a=0;a<t.length;a+=1)i.push({itemId:t[a],count:e[a]});return i},use:function(t,e,i,a){var o={itemId:t,count:e,conditionId:i};this._requestCallApi(n.ITEM_USE,o,function(t,e){return a(t?void 0:e)})},useRecoveryItem:function(t,e,i){var a={itemUseRecoveryItemParameterArray:this._createUseRecoveryItemParameterArray(t,e)};this._requestCallApi(n.ITEM_USE_RECOVERY_ITEM,a,function(t,e){return i(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],ItemSetModel:[function(t,e,i){"use strict";cc._RF.push(e,"df158aDX+lOrpvPz3Fu8czu","ItemSetModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getSetItemId:function(){if(this._isKeyFieldAvailable("setItemId"))return this._data.setItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: setItemId")},getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")},getSetId:function(){if(this._isKeyFieldAvailable("setId"))return this._data.setId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: setId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ItemSourceConst:[function(t,e,i){"use strict";cc._RF.push(e,"96b5f3uvfhM5YgiVyg7i3WQ","ItemSourceConst");t("CommonButton"),t("ResourceUtils"),cc.Class({statics:{SOURCE_ITEM_ID:{CHARACTER_FORTIFY_MATERIAL:791901,CHARACTER_EXCEED_LIMIT_MATERIAL:791902,CHARACTER_SKILL_FORTIFY_MATERIAL:791903,CHARACTER_ABILITY_FORTIFY_MATERIAL:791904,EQUIPMENT_FORTIFY_MATERIAL:791905},SOURCE_SCENE_THUMBNAIL_PATH:{EXCHANGE:"download/exchange/thumbnail_s/normal_exchange",PANEL_MISSION:"download/mission/thumbnail_s/panel_mission",NORMAL_MISSION:"download/mission/thumbnail_s/normal_mission"},SOURCE_WORLD_ID:{WEEK:2001,BEGINER:5004}}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],ItemSourceListPopup:[function(t,e,i){"use strict";cc._RF.push(e,"5b7014fmUFDn7UES73DjRvb","ItemSourceListPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=(t("Singleton"),t("MatrixThumbnailUtils")),s=t("ItemSourceListView");cc.Class({extends:a,properties:{thumbnailParentNode:cc.Node,itemNameLabel:cc.Label,itemTextLabel:cc.Label,itemSourceListView:s,executeLabel:cc.Label,closeBtn:n,executeBtn:n},_preSceneName:"",_preViewParam:void 0,openItemSourceListPopup:function(t,e,i){this._preSceneName=e,this._preViewParam=i,this._initItemDetailView(t),this._initItemSourceListView(t),this.executeBtn.switchBtnImage(this.itemSourceListView.getThumbnails().length>0),this.open(function(){this.closeBtn.setTapEvent(this._onTapCloseBtn.bind(this)),this.itemSourceListView.getThumbnails().length>0&&this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))}.bind(this))},_initItemDetailView:function(t){this.itemNameLabel.string=t.getName(),this.itemTextLabel.string=t.getText();var e=r.createMatrixThumbnailByItemType(t.getItemId(),t.getItemType());this.thumbnailParentNode.addChild(e.node)},_initItemSourceListView:function(t){this.itemSourceListView.initItemSourceListView(t,this._callbackToSelectThumbnail.bind(this))},_callbackToSelectThumbnail:function(t){t&&(this.executeLabel.string=t)},_callbackToExecute:function(){var t=this.itemSourceListView.getSendSceneParam();o.getRoot().pushScene(t.sendSceneName,this._preSceneName,t.sendViewParam,this._preViewParam)},_onTapCloseBtn:function(){this.close()},_onTapExecuteBtn:function(){this.setCloseCallBack(this._callbackToExecute.bind(this)),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ItemSourceListView:"ItemSourceListView",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupBase:"PopupBase",Singleton:"Singleton"}],ItemSourceListView:[function(t,e,i){"use strict";cc._RF.push(e,"fc43cF2c65AyJwF3hDi/3P7","ItemSourceListView");var a=t("Singleton"),n=(t("ItemUtils"),t("ItemSourceUtils")),o=t("ResourceUtils"),r=t("ListViewBase"),s=t("ItemSourceConst");cc.Class({extends:r,properties:{},_sendSceneParam:null,_callbackToSelect:null,initItemSourceListView:function(t,e){this._callbackToSelect=e;var i=_.filter(a.dao.ItemSetMasters,function(e){return e.getSetItemId()===t.getItemId()});this.thumbnailParentNode.destroyAllChildren(),this._initWorldThumbnails(t,i),this._initExchangeThumbnail(t,i),this._initPanelMissionThumbnail(t,i),this._initNormalMissionThumbnail(t,i),this._resetSelectThumbnail(),this._setSelectThumbnail(this.thumbnailParentNode.getComponentsInChildren("ItemSourceThumbnail")[0])},getThumbnails:function(){return this.thumbnailParentNode.getComponentsInChildren("ItemSourceThumbnail")},getSendSceneParam:function(){return this._sendSceneParam},_initWorldThumbnails:function(t,e){var i=n.getDropWorldMasterArray(t.getItemType(),t.getItemId());_.forEach(e,function(t){Array.prototype.push.apply(i,n.getDropWorldMasterArray(t.getItemType(),t.getItemId()))}),i=_.uniqBy(i,function(t){return t.getWorldId()}),_.forEach(i,function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("ItemSourceThumbnail");e.initItemSourceThumbnail(t.getName(),o.getFileNameWorldSmallThumbnail(t.getWorldId()),n.createQuestSendSceneParam(t),this._callbackToThumbnail.bind(this,e)),this.thumbnailParentNode.addChild(e.node)}.bind(this))},_initExchangeThumbnail:function(t,e){var i=n.getExchangeMainMaster(t.getItemType(),t.getItemId());if(!i)for(var a=0;a<e.length&&!(i=n.getExchangeMainMaster(e[a].getItemType(),e[a].getItemId()));a+=1);if(i){var o=cc.instantiate(this.thumbnailPrefab).getComponent("ItemSourceThumbnail");o.initItemSourceThumbnail("\u4ea4\u63db\u6240",s.SOURCE_SCENE_THUMBNAIL_PATH.EXCHANGE,n.createExchangeSendSceneParam(i),this._callbackToThumbnail.bind(this,o)),this.thumbnailParentNode.addChild(o.node)}},_initPanelMissionThumbnail:function(t,e){if(n.isPanelMissionRewardItem(t.getItemType(),t.getItemId())||_.some(e,function(t){return n.isPanelMissionRewardItem(t.getItemType(),t.getItemId())})){var i=cc.instantiate(this.thumbnailPrefab).getComponent("ItemSourceThumbnail");i.initItemSourceThumbnail("\u30d1\u30cd\u30eb\u30df\u30c3\u30b7\u30e7\u30f3",s.SOURCE_SCENE_THUMBNAIL_PATH.PANEL_MISSION,n.createPanelMissionSendSceneParam(),this._callbackToThumbnail.bind(this,i)),this.thumbnailParentNode.addChild(i.node)}},_initNormalMissionThumbnail:function(t,e){if(n.isNormalMissionRewardItem(t.getItemType(),t.getItemId())||_.some(e,function(t){return n.isNormalMissionRewardItem(t.getItemType(),t.getItemId())})){var i=cc.instantiate(this.thumbnailPrefab).getComponent("ItemSourceThumbnail");i.initItemSourceThumbnail("\u30df\u30c3\u30b7\u30e7\u30f3",s.SOURCE_SCENE_THUMBNAIL_PATH.NORMAL_MISSION,n.createNormalMissionSendSceneParam(),this._callbackToThumbnail.bind(this,i)),this.thumbnailParentNode.addChild(i.node)}},_resetSelectThumbnail:function(){for(var t=this.getThumbnails(),e=0;e<t.length;e+=1)t[e].switchActiveBackLight(!1)},_setSelectThumbnail:function(t){t&&(this._sendSceneParam=t.getSendSceneParam(),t.switchActiveBackLight(!0),this._callbackToSelect&&this._callbackToSelect(t.getSendSceneParam().sendText))},_callbackToThumbnail:function(t){this._resetSelectThumbnail(),this._setSelectThumbnail(t)}});cc._RF.pop()},{ItemSourceConst:"ItemSourceConst",ItemSourceUtils:"ItemSourceUtils",ItemUtils:"ItemUtils",ListViewBase:"ListViewBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ItemSourceThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"63280fkUPNHq6TR1Yac9I/N","ItemSourceThumbnail");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,imageSprite:cc.Sprite,backLightNode:cc.Node,thumbnailBtn:a},_sendSceneParam:null,initItemSourceThumbnail:function(t,e,i,a){this.nameLabel.string=t,this._sendSceneParam=i,n.addSprite(this.imageSprite,e),this._callbackToThumbnail=a,this.thumbnailBtn.setTapEvent(this._onTapThumbnail.bind(this))},getSendSceneParam:function(){return this._sendSceneParam},switchActiveBackLight:function(t){this.backLightNode.active=t},_onTapThumbnail:function(){this._callbackToThumbnail&&this._callbackToThumbnail()}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],ItemSourceUtils:[function(t,e,i){"use strict";cc._RF.push(e,"a4ddaYWpR1GQ7olBPXuLV20","ItemSourceUtils");var a=t("Singleton"),n=t("TimeUtils"),o=t("QuestUtils"),r=t("CommonUtils"),s=t("UserUtils"),c=t("ItemSourceConst"),l=t("MissionConst");function u(t,e){var i=_.filter(a.dao.QuestDropMasters,function(i){return i.getItemId()===e&&i.getItemType()===t}),r=_.filter(a.dao.QuestWorldMasters,function(t){switch(t.getWorldId()){case c.SOURCE_WORLD_ID.WEEK:return(!t.getFromDate()||t.getFromDate()<=n.getNowDate())&&(!t.getToDate()||n.getNowDate()<=t.getToDate());case c.SOURCE_WORLD_ID.BEGINER:var e=_.find(a.dao.EventMainMasters,function(e){return t.getWorldId()===e.getWorldId()});return s.checkOpenCondition(e.getConditionType(),e.getConditionFrom(),e.getConditionTo())&&(!t.getFromDate()||t.getFromDate()<=n.getNowDate())&&(!t.getToDate()||n.getNowDate()<=t.getToDate());default:return!1}}),l=_.filter(a.dao.QuestAreaMasters,function(t){return(!t.getFromDate()||t.getFromDate()<=n.getNowDate())&&(!t.getToDate()||n.getNowDate()<=t.getToDate())&&o.checkNowWeekByAreaId(t.getAreaId())&&!!r.find(function(e){return e.getWorldId()===t.getWorldId()})}),u=o.createUserStageFlatMap();return _.filter(a.dao.QuestStageMasters,function(t){return!!_.find(l,function(e){return e.getAreaId()===t.getAreaId()&&!!u[t.getStageId()]&&!!i.find(function(e){return e.getStageId()===t.getStageId()})})})}function h(t){return _.find(a.dao.ExchangeMainMasters,function(e){return e.getExchangeId()===t&&n.isRangeOfDate(e.getFromDate(),e.getToDate())})}function d(t,e,i){return!!_.find(a.dao.MissionRewardMasters,function(a){return a.getItemType()===t&&a.getItemId()===e&&_.some(i,function(t){return a.getMissionId()===t.getMissionId()})})}e.exports={getDropWorldMasterArray:function(t,e){var i=o.getWorldMasterMap(),a=u(t,e);a=_.uniqBy(a,function(t){return t.getWorldId()});var n=[];return _.forEach(a,function(t,e){n.push(i[t.getWorldId()])}),n=r.sortModels(n,[{getterName:"getWorldId",order:"desc"}])},getExchangeMainMaster:function(t,e){var i,o=_.find(a.dao.ExchangePointDetailMasters,function(i){return i.getItemType()===t&&i.getItemId()===e&&n.isRangeOfDate(i.getFromDate(),i.getToDate())});return o&&(i=h(o.getExchangeId()))?i:(o=_.find(a.dao.ExchangePointDetailMasters,function(i){return i.getItemType()===t&&i.getItemId()===e&&n.isRangeOfDate(i.getFromDate(),i.getToDate())}))&&(i=h(o.getExchangeId()))?i:void 0},isPanelMissionRewardItem:function(t,e){return d(t,e,_.filter(a.dao.userMissions,function(t){return t.getCategory()===l.MISSION_CATEGORY.PANEL&&!t.getIsReceived()}))},isNormalMissionRewardItem:function(t,e){return d(t,e,_.filter(a.dao.userMissions,function(t){return t.getCategory()!==l.MISSION_CATEGORY.PANEL&&!t.getIsReceived()}))},createQuestSendSceneParam:function(t){var e,i="";switch(t.getWorldId()){case c.SOURCE_WORLD_ID.WEEK:i="WeekScene",e={WeekTopSubRoot:{}};break;case c.SOURCE_WORLD_ID.BEGINER:i="EventRegularQuestScene",e={EventRegularQuestTopSubRoot:{eventId:_.find(a.dao.EventMainMasters,function(e){return e.getWorldId()===t.getWorldId()}).getEventId()}}}return{sendText:"\u51fa\u6483\u3078",sendSceneName:i,sendViewParam:e}},createExchangeSendSceneParam:function(t){return{sendText:"\u4ea4\u63db\u6240\u3078",sendSceneName:"ExchangeScene",sendViewParam:{ExchangeSubRoot:{exchangeId:t.getExchangeId()}}}},createPanelMissionSendSceneParam:function(){return{sendText:"\u30d1\u30cd\u30eb\u30df\u30c3\u30b7\u30e7\u30f3\u3078",sendSceneName:"HomeScene",sendViewParam:{HomeRoot:{panelMission:!0}}}},createNormalMissionSendSceneParam:function(){return{sendText:"\u30df\u30c3\u30b7\u30e7\u30f3\u3078",sendSceneName:"MissionScene",sendViewParam:{MissionTabView:{selectedTab:0}}}}},cc._RF.pop()},{CommonUtils:"CommonUtils",ItemSourceConst:"ItemSourceConst",MissionConst:"MissionConst",QuestUtils:"QuestUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",UserUtils:"UserUtils"}],ItemUtils:[function(t,e,i){"use strict";cc._RF.push(e,"aab62WF20pA1KNQrGE/OD2x","ItemUtils");var a=t("Singleton"),n=t("ItemConst");function o(){var t={},e=a.dao.ItemMainMasters;for(var i in e)t[e[i].getItemId()]=e[i];return t}function r(t,e){return t.find(function(t){return t.getFavoriteItemId()===e})}function s(t){return{master:t,userModelArray:a.dao.userEquipments.filter(function(e){return e.getEquipmentId()===t.getEquipmentId()}),number:t.getEquipmentId(),attribute:t.getAttribute(),itemType:n.ITEM_TYPE.EQUIPMENT}}e.exports={getItemMainMasterMap:function(){return o()},getItemSetMasterArrayBySetItemId:function(t){return a.dao.ItemSetMasters.filter(function(e){return e.getSetItemId()===t})},getUserItemCount:function(t,e){switch(t=parseInt(t),e=isNaN(parseInt(e))?0:parseInt(e)){case n.ITEM_TYPE.CHARACTER:return _.filter(a.dao.userCharacters,function(e){return e.getCharacterId()===t}).length;case n.ITEM_TYPE.EQUIPMENT:return _.filter(a.dao.userEquipments,function(e){return e.getEquipmentId()===t}).length;case n.ITEM_TYPE.FURNITURE:return _.filter(a.dao.userFurniture,function(e){return e.getFurnitureId()===t}).length;case n.ITEM_TYPE.FREE_GEM:return a.dao.userBasicData.getGem();default:var i=a.dao.userItems.find(function(e){return e.getItemId()===t});return i?i.getCount():0}},getItemMaster:function(t){return a.dao.ItemMainMasters.find(function(e){return e.getItemId()===t})},getItemRecipeMaster:function(t){return a.dao.ItemRecipeMasters.find(function(e){return e.getRecipeItemId()===t})},getUserGiftItemArrayBySort:function(t){for(var e=t.getCharacterFavoriteMasterArray(),i=a.dao.userItems.filter(function(t){return n.ITEM_TYPE.GIFT_FROM<=t.getItemType()&&t.getItemType()<=n.ITEM_TYPE.GIFT_TO}),o=[],s=[],c=[],l=0;l<i.length;l+=1)i[l].getCount()<=0?c.push(i[l]):r(e,i[l].getItemId())?o.push(i[l]):s.push(i[l]);return o.concat(s.concat(c))},getGiftItemEffectValue:function(t,e){var i=r(e.getCharacterFavoriteMasterArray(),t.getItemId()),a=t.getEffectValue();if(i)switch(i.getAddType()){case n.GIFT_ITEM_FAVORITE_ADD_TYPE.RATE:a=t.getEffectValue()*(i.getValue()/1e3);break;case n.GIFT_ITEM_FAVORITE_ADD_TYPE.ADD:a=t.getEffectValue()+i.getValue();break;case n.GIFT_ITEM_FAVORITE_ADD_TYPE.OVERWRITE:a=i.getValue()}return Math.ceil(a)},createWarehouseUserItemModelMap:function(){var t={};return t[n.WAREHOUSE_TAB.CONSUME]=a.dao.userItems.filter(function(t){return t.getItemCategory()===n.ITEM_CATEGORY.CONSUME&&t.getCount()>0}),t[n.WAREHOUSE_TAB.GIFT]=a.dao.userItems.filter(function(t){return n.ITEM_TYPE.GIFT_FROM<=t.getItemType()&&t.getItemType()<=n.ITEM_TYPE.GIFT_TO&&t.getCount()>0}),t[n.WAREHOUSE_TAB.EQUIPMENT]=a.dao.EquipmentMainMasters.filter(function(t){return t.getEquipmentType()===n.EQUIPMENT_TYPE.ATK}).map(function(t){return s(t)}),t[n.WAREHOUSE_TAB.CHARACTER_STORAGE]=_.filter(a.dao.warehouseCharacters,function(t){return t.getCount()>0}),t[n.WAREHOUSE_TAB.EQUIPMENT_STORAGE]=_.filter(a.dao.warehouseEquipments,function(t){return t.getCount()>0}),t[n.WAREHOUSE_TAB.MATERIAL_STORAGE]=_.filter(a.dao.warehouseMaterials,function(t){return t.getCount()>0}),t[n.WAREHOUSE_TAB.OTHER]=a.dao.userItems.filter(function(t){return t.getItemCategory()!==n.ITEM_CATEGORY.CONSUME&&t.getItemCategory()!==n.ITEM_CATEGORY.NONE&&(t.getItemType()<n.ITEM_TYPE.GIFT_FROM||n.ITEM_TYPE.GIFT_TO<t.getItemType())&&t.getCount()>0}),t},getItemInfo:function(t,e){var i="",o="";if(n.ITEM_TYPE.CHARACTER===t){var r=a.dao.CharacterMainMasters.find(function(t){return t.getCharacterId()===e});i=r.getSkinName()?"\u3010"+r.getSkinName()+"\u3011"+r.getName():r.getName(),o=r.getShortText()}else if(n.ITEM_TYPE.EQUIPMENT===t){var s=a.dao.EquipmentMainMasters.find(function(t){return t.getEquipmentId()===e});i=s.getName(),o=s.getText()}else if(n.ITEM_TYPE.FURNITURE===t){var c=a.dao.FurnitureMainMasters.find(function(t){return t.getFurnitureId()===e});i=c.getName(),o=c.getDescription()}else{var l=a.dao.ItemMainMasters.find(function(t){return t.getItemId()===e});i=l.getName(),o=l.getText()}return{name:i,text:o}}},cc._RF.pop()},{ItemConst:"ItemConst",Singleton:"Singleton"}],ListPageView:[function(t,e,i){"use strict";cc._RF.push(e,"d3427ewvDpHTpx/M4gVtWaE","ListPageView");var a=t("CommonPageView");cc.Class({extends:a,properties:{nodeCountMax:1},_visibleDataList:null,_dataList:null,initListPageView:function(t,e,i){i&&this.setDataList(i),this.initCommonPageView(t,this._getPageCountMax(),0,this._setPageEvent.bind(this)),this.setCallbackToCreateThumbnailNode(e),this.redraw()},setDataList:function(t){this._dataList=t,this._visibleDataList=t},setVisibleDataList:function(t){this._visibleDataList=t},getDataList:function(){return this._dataList},getVisibleDataList:function(){return this._visibleDataList},_getNodeCountMax:function(){return this.nodeCountMax},_getPageCountMax:function(){return parseInt((this.getVisibleDataList().length-1)/this._getNodeCountMax())+1},_setPageEvent:function(t){this.removePageContent();var e=this._createListContent(t);for(var i in e.nodeArray){var a=e.nodeArray[i];this.content.addChild(a)}},_createThumbnailNode:function(t,e,i){if(this._callbackToCreateThumbnailNode)return this._callbackToCreateThumbnailNode(t,void 0,e,i);var a=(new cc.Node).addComponent(cc.Label);return a.string="\u30b5\u30e0\u30cd",a.node},_handlePageNode:function(t,e){this._callbackToHandlePageNode&&this._callbackToHandlePageNode(t,e)},_createListContent:function(t){var e=this._getNodeCountMax(),i=this._getPageCountMax();t>=i?t=i-1:t<0&&(t=0),this._pageCountMax=i;for(var a=t*e,n=a+e,o=[],r=[],s=a;s<n&&!(s>=this.getVisibleDataList().length);s++){var c=this.getVisibleDataList()[s],l=this._createThumbnailNode(c,s-a);l&&(this._handlePageNode(l,c),o.push(l),r.push(c))}return{nodeArray:o,dataArray:r}},setCallbackToCreateThumbnailNode:function(t){this._callbackToCreateThumbnailNode=t},setCallbackToHandlePageNode:function(t){this._callbackToHandlePageNode=t}});cc._RF.pop()},{CommonPageView:"CommonPageView"}],ListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"3bb10MIv2tBZaWf7ikdxLn6","ListViewBase");cc.Class({extends:cc.Component,properties:{thumbnailParentNode:cc.Node,thumbnailPrefab:cc.Prefab},_root:null,resetListView:function(){this.thumbnailParentNode.destroyAllChildren(),this.node.active=!1,this.thumbnailParentNode.active=!1},initListView:function(t){this._root=t,this.resetListView(),this._setListContent(t),this.node.active=!0,this.thumbnailParentNode.active=!0},_setListContent:function(t){cc.error("_setListContent(root) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")},_addThumbnail:function(t){cc.error("_addThumbnail(data) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9");var e=cc.instantiate(this.thumbnailPrefab).getComponent(cc.Component);this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){cc.error("_callbackToThumbnail(data) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")}});cc._RF.pop()},{}],LoadProgressCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"6b65a3t2mBHMbYWI8cYfGsJ","LoadProgressCharacterView");var a=t("LoadProgressView"),n=t("LoopRollView"),o=t("LoadingUtils"),r=t("CommonButton");cc.Class({extends:a,properties:{loopRollView:n,characterWindowNode:cc.Node,characterViewPrefab:cc.Prefab,leftButton:r,rightButton:r},onLoad:function(){this.characterWindowNode.active=!1,this.leftButton.setTapEvent(function(){this.loopRollView.moveToLeft()}.bind(this),r.SE_NAME.COUNT),this.rightButton.setTapEvent(function(){this.loopRollView.moveToRight()}.bind(this),r.SE_NAME.COUNT)},showLoading:function(){this.node.active=!0},initLoadProgress:function(){this._super();var t=o.getDisplayLoadingCharacterMasters();if(t.length>0&&!this.characterWindowNode.active){for(var e=0;e<t.length;e+=1){var i=cc.instantiate(this.characterViewPrefab).getComponent("LoadingCharacterView");i.initLoadingCharacterView(t[e]),this.loopRollView.content.addChild(i.node)}this.characterWindowNode.opacity=0,this.characterWindowNode.active=!0,this.characterWindowNode.runAction(cc.fadeIn(1).easing(cc.easeInOut(5))),this.loopRollView.initLoopRollView(),this.loopRollView.setSelectedNo(0)}},setLoadProgress:function(t){this._super(t)}});cc._RF.pop()},{CommonButton:"CommonButton",LoadProgressView:"LoadProgressView",LoadingUtils:"LoadingUtils",LoopRollView:"LoopRollView"}],LoadProgressTipsView:[function(t,e,i){"use strict";cc._RF.push(e,"87c00KDiP9PRJGdyBW0nCxc","LoadProgressTipsView");var a=t("LoadProgressView"),n=t("LoopRollView"),o=t("LoadingUtils"),r=t("CommonButton"),s="run",c="loading";cc.Class({extends:a,properties:{loopRollView:n,tipsWindowNode:cc.Node,tipsLeftButton:r,tipsRightButton:r,tipsViewPrefab:cc.Prefab,naviCharacterSkeleton:sp.Skeleton,naviCharacterButton:r},onLoad:function(){this.tipsWindowNode.active=!1,this.naviCharacterButton.setTapEvent(function(){this.naviCharacterButton.setTouchEnable(!1),this._playFallAnimation(function(){this.naviCharacterButton.setTouchEnable(!0)}.bind(this))}.bind(this)),this.naviCharacterSkeleton.setAnimation(0,s,!0),this.tipsLeftButton.setTapEvent(function(){this.loopRollView.moveToLeft()}.bind(this),r.SE_NAME.COUNT),this.tipsRightButton.setTapEvent(function(){this.loopRollView.moveToRight()}.bind(this),r.SE_NAME.COUNT)},showLoading:function(){this.node.active=!0},initLoadProgress:function(){this._super();var t=o.getDisplayLoadingTipsMasters();if(t.length>0&&!this.tipsWindowNode.active){for(var e=0;e<t.length;e+=1){var i=cc.instantiate(this.tipsViewPrefab).getComponent("LoadingTipsView");i.initTipsView(t[e]),this.loopRollView.content.addChild(i.node)}this.tipsWindowNode.opacity=0,this.tipsWindowNode.active=!0,this.tipsWindowNode.runAction(cc.fadeIn(1).easing(cc.easeInOut(5))),this.loopRollView.initLoopRollView(),this.loopRollView.setSelectedNo(0)}},setLoadProgress:function(t){this._super(t)},_playFallAnimation:function(t){this.naviCharacterSkeleton.setCompleteListener(function(){this.naviCharacterSkeleton.setCompleteListener(null),this.naviCharacterSkeleton.setAnimation(0,s,!0),t()}.bind(this)),this.naviCharacterSkeleton.setAnimation(0,c,!1)}});cc._RF.pop()},{CommonButton:"CommonButton",LoadProgressView:"LoadProgressView",LoadingUtils:"LoadingUtils",LoopRollView:"LoopRollView"}],LoadProgressView:[function(t,e,i){"use strict";cc._RF.push(e,"8b0b0Foyu5MJKVNKpZGdaWS","LoadProgressView");var a=t("LoadSimpleView"),n=cc.Enum({START:0,END:1});cc.Class({extends:a,isPlayingDelay:!1,properties:{loadProgressBar:cc.ProgressBar,loadProgressLabel:cc.Label,viewAnimation:cc.Animation},showLoading:function(){this._super(),this.viewAnimation.play(this.viewAnimation.getClips()[n.START].name)},hideLoading:function(){this._super()},setDelayLoading:function(t){this.isPlayingDelay||(this.node.active=!0,this.isPlayingDelay=!0,this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){return this.isPlayingDelay=!1,t()}.bind(this)))))},initLoadProgress:function(){this.loadProgressBar.progress=0,this.loadProgressLabel.string="0"},setLoadProgress:function(t){this.loadProgressBar.progress=t,this.loadProgressLabel.string=""+Math.floor(100*t)}});cc._RF.pop()},{LoadSimpleView:"LoadSimpleView"}],LoadSimpleView:[function(t,e,i){"use strict";cc._RF.push(e,"5d563sQoU5MkoGi7BQKgEX3","LoadSimpleView");cc.Class({extends:cc.Component,showLoading:function(){this.node.active=!0},hideLoading:function(){this.node.destroy()},setDelayLoading:function(t){t()},initLoadProgress:function(){},setLoadProgress:function(t){}});cc._RF.pop()},{}],LoadingCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"1ce7eB7RdRKPYS03mcbabTi","LoadingCharacterModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getSerif:function(){if(this._isKeyFieldAvailable("serif"))return this._data.serif;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: serif")},getDescription:function(){if(this._isKeyFieldAvailable("description"))return this._data.description;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: description")},getMainPosX:function(){if(this._isKeyFieldAvailable("mainPosX"))return this._data.mainPosX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: mainPosX")},getMainPosY:function(){if(this._isKeyFieldAvailable("mainPosY"))return this._data.mainPosY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: mainPosY")},getBackPosX:function(){if(this._isKeyFieldAvailable("backPosX"))return this._data.backPosX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: backPosX")},getBackPosY:function(){if(this._isKeyFieldAvailable("backPosY"))return this._data.backPosY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: backPosY")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],LoadingCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"3fc96700iVPKZyOs7cquTgi","LoadingCharacterView");var a=t("CharacterUtils"),n=t("ResourceUtils"),o=t("Async");cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,serifLabel:cc.Label,descriptionLabel:cc.Label,standNode:cc.Node,standSprite:cc.Sprite,standBackSprite:cc.Sprite},initLoadingCharacterView:function(t){this.standNode.active=!1;var e=a.getCharacterMainModelByCharacterId(t.getCharacterId());this.nameLabel.string=e.getName()+"("+e.getReadingName()+")",this.serifLabel.string=t.getSerif(),this.descriptionLabel.string=t.getDescription()?t.getDescription():e.getText(),this._initCharacterStand(t)},_initCharacterStand:function(t){var e=n.getFileNameCharacterStand(t.getCharacterId()),i=[];i.push(function(i){this.standSprite.node.setPosition(t.getMainPosX(),t.getMainPosY()),n.addSprite(this.standSprite,e,function(){i()})}.bind(this)),i.push(function(i){this.standBackSprite.node.setPosition(t.getBackPosX(),t.getBackPosY()),n.addSprite(this.standBackSprite,e,function(){i()})}.bind(this)),i.push(function(){this.standNode.opacity=0,this.standNode.active=!0,this.standNode.runAction(cc.fadeIn(1).easing(cc.easeInOut(5)))}.bind(this)),o.waterfall(i)}});cc._RF.pop()},{Async:"Async",CharacterUtils:"CharacterUtils",ResourceUtils:"ResourceUtils"}],LoadingMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"1cd5bM+4nBGY7FhuSf/Ii6k","LoadingMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLoadingType:function(){if(this._isKeyFieldAvailable("LoadingType"))return this._data.LoadingType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: LoadingType")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],LoadingTipsModel:[function(t,e,i){"use strict";cc._RF.push(e,"64dacwT3hRGUbe/lTagiAj2","LoadingTipsModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getTitle:function(){if(this._isKeyFieldAvailable("title"))return this._data.title;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: title")},getDescription:function(){if(this._isKeyFieldAvailable("description"))return this._data.description;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: description")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],LoadingTipsView:[function(t,e,i){"use strict";cc._RF.push(e,"48bf5FnKONEvr1BMYaGjPzY","LoadingTipsView");cc.Class({extends:cc.Component,properties:{titleLabel:cc.Label,descriptionLabel:cc.Label},initTipsView:function(t){this.titleLabel.string=t.getTitle(),this.descriptionLabel.string=t.getDescription()}});cc._RF.pop()},{}],LoadingUtils:[function(t,e,i){"use strict";cc._RF.push(e,"15a2c3oEu9MYrTUlBWvetbP","LoadingUtils");var a=t("Singleton"),n=t("GameConst");function o(t){if(a.dao.LoadingMainMasters)return a.dao.LoadingMainMasters.find(function(e){return e.getLoadingType()===t})}e.exports={getLoadingMainModel:o,getDisplayLoadingTipsMasters:function(){var t=o(n.LOADING_TYPE.TIPS);return t?_.sampleSize(a.dao.LoadingTipsMasters,t.getCount()):[]},getDisplayLoadingCharacterMasters:function(){var t=o(n.LOADING_TYPE.CHARACTER);return t?_.sampleSize(a.dao.LoadingCharacterMasters,t.getCount()):[]}},cc._RF.pop()},{GameConst:"GameConst",Singleton:"Singleton"}],LocalDataConst:[function(t,e,i){"use strict";cc._RF.push(e,"428a3mfvMZDHrBgS8ZBqQ5G","LocalDataConst"),cc.Class({statics:{SORT_TYPE:"sortType",SORT_ORDER:"sortOrder",FILTER:{THREE:{AUTO_DECK_EDIT_EQUIPMENT:"autoDeckEditEquipmentFilter"},FOUR:{AUTO_DECK_EDIT_TARGET:"autoDeckEditTargetFilter"},FIVE:{CHARACTER_FORTIFY_RECOMMEND:"characterFortifyRecommendFilter"},SIX:{EQUIPMENT_SELL_RECOMMEND:"equipmentSellRecommendFilter",EQUIPMENT_FORTIFY_RECOMMEND:"equipmentFortifyRecommendFilter",AUTO_DECK_EDIT_ATTRIBUTE:"autoDeckEditAttributeFilter"},SEVEN:{CHARACTER_SELL_RECOMMEND:"characterSellRecommendFilter"},TEN:{WAREHOUSE_EQUIPMENT:"warehouseEquipmentFilter",WAREHOUSE_STORAGE_CHARACTER:"WarehouseStorageCharacterFilter",WAREHOUSE_STORAGE_EQUIPMENT:"WarehouseStorageEquipmentFilter"},TWELVE:{EQUIPMENT:"equipmentFilter",WAREHOUSE_STORAGE_MATERIAL:"WarehouseStorageMaterialFilter"},THIRTEEN:{CHARACTER:"characterFilter"}},USER_PROGRESS_NOTIFIED:"userProgressNotified",REQUEST_QUEUE:"requestQueue",REQUEST_RUNNING:"requestRunning",SELECT_QUEST_DECK_ORDER:"selectQuestDeckOrder",SELECT_TOWER_DECK_ORDER:"selectTowerDeckOrder",SELECT_PVP_DECK_ORDER:"selectPvPDeckOrder",SELECT_WORLD_ID:"selectWorldId",SELECT_AREA_ID:"selectAreaId",SELECT_STAGE_ID:"selectStageId",NEW_RELEASE_NORMAL_STAGE_ID:"newReleaseNormalStageId",NOW_DATETIME:"nowDateTime",PRE_SYSTEM_DATE:"preSystemDate",SCENE_TRANSITION_TARGETS:"sceneTransitionTargets",DMM_USER_INFO:"dmmUserInfo",GAME_SERVER_COMM_USER_ID:"gameServerCommUserId",GAME_SERVER_COMM_TOKEN:"gameServerCommToken",GAME_SERVER_COMM_SECRET:"gameServerCommSecret",GAME_SERVER_COMM_EXPIRES:"gameServerCommExpires",PAYMENT_IMAGE_URL:"paymentImageUrl",MYPAGE_NEWS_FIRST_START:"myPageNewsFirstStartFlg",MY_PAGE_LOGIN_VOICE:"myPageLoginVoice",TUTORIAL_SUB_STEP:"tutorialSubStep",REQUEST_API_LIST:"requestApiList",REQUEST_API_DEL_LIST:"requestApiDelList",PRESENT_COUNT:"presentCount",NEW_USER_ITEMS:"newUserItems",IS_EXIST_GACHA_SESSION:"isExistsGachaSession",RES_QUALITY:"resQuality",IS_OPEN_SYSTEM_POPUP:"isOpenSystemPopup",IS_CAPACITY_FULL:"isCapacityFull ",IS_CAPACITY_ZIP_AMPLE:"isCapacityZipAmple ",IS_BUTTON_DURING_INTERVAL:"isButtonDuringInterval",IS_POPUP_OPENING:"isPopupOpening",USER_VERSION:"userVersion",APP_STORE_URL:"appStoreUrl",TOWER_AUTO_MODE:"TOWER_AUTO_MODE",LOCAL_STORAGE_KEY:cc.Enum({SUB_MENU_BUNNER:"subMenuBunnerOpen",PLAY_SKILL_ANIMATION:"playSkillAnimation",MY_PAGE_BACKGROUND:"myPageBackground",SORT_TYPE_CHARACTER:"sortTypeCharacter",SORT_ORDER_CHARACTER:"sortOrderCharacter",SORT_TYPE_EQUIPMENT:"sortTypeEquipment",SORT_ORDER_EQUIPMENT:"sortOrderEquipment",SORT_TYPE_WAREHOUSE_EQUIPMENT:"sortTypeWarehouseEquipment",SORT_ORDER_WAREHOUSE_EQUIPMENT:"sortOrderWarehouseEquipment",SORT_TYPE_WAREHOUSE_STORAGE_CHARACTER:"sortTypeWarehouseStorageCharacter",SORT_ORDER_WAREHOUSE_STORAGE_CHARACTER:"sortOrderWarehouseStorageCharacter",SORT_TYPE_WAREHOUSE_STORAGE_EQUIPMENT:"sortTypeWarehouseStorageEquipment",SORT_ORDER_WAREHOUSE_STORAGE_EQUIPMENT:"sortOrderWarehouseStorageEquipment",SORT_TYPE_WAREHOUSE_STORAGE_MATERIAL:"sortTypeWarehouseStorageMaterial",SORT_ORDER_WAREHOUSE_STORAGE_MATERIAL:"sortOrderWarehouseStorageMaterial",SORT_TYPE_DECK:"sortTypeDeck",RAID_SEND_RESCUE_WHEN_APPEAR:"raidSendRescueWhenAppear",MYPAGE_NEWS_READ:"myPageNewsReadFlg",TUTORIAL_HELP_READ:"tutorialHelpReadFlg",EVENT_FIRST_LOOK:"eventFirstLookFlg",SHOP_UPDATE_LOOK:"shopUpdateLookFlg",EXCHANGE_DAILY_LOOK:"exchangeDailyLookFlg",EXCHANGE_MONTHLY_LOOK:"exchangeMothlyLookFlg",EXCHANGE_ARENA_LOOK:"exchangeArenaLookFlg",FINISHED_MISSION_CDS:"finishedMissionCds",RESOURCE_QUALITY:"resourceQuality",ALL_RES_POP_TYPE:"selectAllResDialog",FIRST_QUALITY_POP:"firstQualityPop",RESOURCE_DL_TYPE:"resourceDownloadType",RAID_GACHA_EFFECT_SKIP:"raidGachaEffectSkip",RAID_GACHA_GET_RESET_STOP:"raidGachaGetResetStop"}),LOCAL_STORAGE_GET_TYPE:cc.Enum({STRING:0,BOOLEAN:1,INTEGER:2,FLOAT:3})}}),cc._RF.pop()},{}],LocalStartRoot:[function(t,e,i){"use strict";cc._RF.push(e,"c220dLd+3FAQ5eNlSY5HHnF","LocalStartRoot");var a=t("StartRoot"),n=t("Http"),o=t("RESTClient"),r=(t("MasterDataConstants"),t("Singleton")),s=(t("ApiConstants"),t("QuestModel"),t("QuestUtils"),t("MissionUtils")),c=(t("UserModel"),t("ItemModel"),t("PvPModel"),t("StoryUtils")),l=(t("HotUpdate"),t("CommonUtils"),t("AdvRoot"),t("PvPUtils")),u=t("BattleData"),h=(t("EnumTypes"),t("SceneConst")),d=(t("GameConst"),t("DeckConst")),p=t("QuestRoot"),m=t("PvPRoot"),g=t("BattleFunction"),C=t("LocalDataConst"),f=t("PopupUtils");cc.Class({extends:a,properties:{btnGroup:cc.Node,btnLogout:cc.Button},onLoad:function(){this._setErrorHandling(),this._setNoticeHandling(),this.btnGroup.active=!1},initData:function(){this._bootInit(),this._bootSequence()},updateChild:function(t){},startBattleScene:function(){r.QuestService.startBattle(10010101,1,!1,function(t){cc.log("startBattle : \u901a\u4fe1\u5b8c\u4e86");var e=t.session.stageId,i=r.dao.userQuests.find(function(t){return e===t.userData.getStageId()});i&&(u.selectedQuestModel=i),g.setQuestStartBattleData(i,t.stage,g.createSessionObjectData(t.session.sessionId,t.session.stageId,t.session.deckId,d.DECK_TYPE.QUEST),g.createBattleCallbacks(p.prototype.requestSaveBattleTransaction,p.prototype.requestEndBattle,p.prototype.transitionEventForEndBattle)),cc.director.loadScene("battleLoading.fire")})},startDeckScene:function(){this._transitionScene(h.SCENE.FILE_NAME.DECK)},startUnitPromoteScene:function(){this._transitionScene(h.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT)},startQuestScene:function(){this._transitionScene(h.SCENE.FILE_NAME.QUEST)},startHomeScene:function(){this._transitionScene(h.SCENE.FILE_NAME.HOME)},startMissionScene:function(){this._transitionScene(h.SCENE.FILE_NAME.MISSION)},startEventQuestScene:function(){this._transitionScene(h.SCENE.FILE_NAME.EVENT)},startExchangeScene:function(){this._transitionScene(h.SCENE.FILE_NAME.EXCHANGE)},startRoomScene:function(){this._transitionScene(h.SCENE.FILE_NAME.ROOM)},startDebugScene:function(){this._transitionScene(h.SCENE.FILE_NAME.DEBUG)},startPresentBoxScene:function(){this._transitionScene(h.SCENE.FILE_NAME.PRESENT_BOX)},startShopScene:function(){this._transitionScene(h.SCENE.FILE_NAME.SHOP)},startGachaScene:function(){this._transitionScene(h.SCENE.FILE_NAME.GACHA)},startWarehouseScene:function(){this._transitionScene(h.SCENE.FILE_NAME.WARE_HOUSE)},startStoryScene:function(){this._transitionScene(h.SCENE.FILE_NAME.STORY)},startTowerScene:function(){this._transitionScene(h.SCENE.FILE_NAME.TOWER)},startPvPScene:function(){this._transitionScene(h.SCENE.FILE_NAME.PVP)},startEquipmentScene:function(){this._transitionScene(h.SCENE.FILE_NAME.EQUIPMENT)},startRaidScene:function(){this._transitionScene(h.SCENE.FILE_NAME.RAID)},startLoginBonusScene:function(){r.LoginBonusService.getLoginBonus(function(t){if(t.loginBonus){var e={LoginBonusSubRoot:{loginBonus:t.loginBonus}};this.pushScene(h.SCENE.FILE_NAME.LOGIN_BONUS,null,e,null)}else this._transitionScene(h.SCENE.FILE_NAME.HOME)}.bind(this))},startAdvScene:function(){this._transitionScene("AdvScene")},startSetTestBattleScene:function(){this._transitionScene(h.SCENE.FILE_NAME.SET_TEST_BATTLE)},testPvpBattleScene:function(){l.requestGetBattlePlayers(function(t){if(cc.log(t),t&&t.length>0){var e=t[0];r.PvPService.startBattle(e.userCd,r.localData[C.SELECT_PVP_DECK_ORDER],function(t){g.setPvPStartBattleData(e,g.createPvPSessionObjectData(t.sessionId),g.createPvPBattleCallbacks(m.prototype.requestEndBattle,m.prototype.requestEndBattle)),cc.director.loadScene("battleLoading.fire")})}})},startBootScene:function(){this._transitionScene(h.SCENE.FILE_NAME.BOOT)},startWeekScene:function(){this._transitionScene(h.SCENE.FILE_NAME.WEEK)},startRaidGachaScene:function(){this._transitionScene(h.SCENE.FILE_NAME.RAID_GACHA)},startMinigameScene:function(){cc.director.loadScene("MinigameScene.fire")},login:function(){},loadMasterData:function(){},loadUserData:function(){var t=this;r.ServiceManager.loadUserData(function(){cc.log("loadUserData complete"),cc.log(r.dao),t.btnGroup.active=!0},s.noticeMissionUpdate)},testHttp:function(){n.httpPostJson("http://localhost:3000/deep-one/api/character/getMasterData","",{authorization:!0},!0,function(t,e){null===t?(cc.log("testHttp = "),cc.log(e)):cc.log("err = "+t)})},testRectClient:function(){o.RESTClient.graft({name:"getUserCharacterData",path:"character/getMasterData",method:"POST"})},testServiceManager:function(){r.ServiceManager.loadMasterData(function(){cc.log("loadMasterData complete"),cc.log(r.dao.MyPageBannerMasters),cc.log(r.dao.MyPageEventMasters),cc.log(r.dao.MyPageMainMasters)}),r.ServiceManager.loadUserData(function(){cc.log("loadUserData complete")})},testAPI:function(){r.GachaService.getList(function(t){cc.log("\u901a\u4fe1\u5b8c\u4e86")})},testQuestModel:function(){cc.log("---\u30af\u30a8\u30b9\u30c8\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8---");var t=r.dao.userQuests[1];cc.log(t),cc.log("\u30ef\u30fc\u30eb\u30c9ID\uff1a"+t.getWorldId()),cc.log("\u30ef\u30fc\u30eb\u30c9\u540d\uff1a"+t.getWorldName()),cc.log("\u30a8\u30ea\u30a2\u540d\uff1a"+t.getAreaName()),cc.log("\u30a8\u30ea\u30a2\u8aac\u660e\uff1a"+t.getAreaText()),cc.log("\u30b9\u30c6\u30fc\u30b8\u540d\uff1a"+t.getStageName()),cc.log("\u9054\u6210\u6761\u4ef61\uff1a"+t.getQuestAchieveMaster1().getText()),cc.log("\u9054\u6210\u6761\u4ef62\uff1a"+t.getQuestAchieveMaster2().getText()),cc.log("\u9054\u6210\u6761\u4ef63\uff1a"+t.getQuestAchieveMaster3().getText()),cc.log("\u30a4\u30d9\u30f3\u30c8\u7a2e\u5225\uff1a"+t.getCategory()),cc.log("\u6d88\u8cbbAP\uff1a"+t.getStamina()),cc.log(t.getQuestDropMasterArray())},testUserModel:function(){cc.log("---\u30e6\u30fc\u30b6\u30fc\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8---");var t=r.dao.userBasicData;cc.log(t),cc.log("\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\uff1a"+t.getUserName()),cc.log("\u30ec\u30d9\u30eb\uff1a"+t.getLevel()),cc.log("\u6b21\u306e\u30ec\u30d9\u30eb\u307e\u3067\u3042\u3068\uff1a"+t.getNextLevelExp()),cc.log("\u77f3\u6240\u6301\u6570\uff1a"+t.getGem()),cc.log("SE\u97f3\u91cf\uff1a"+t.getSeVolume()),cc.log("BGM\u97f3\u91cf\uff1a"+t.getBgmVolume()),cc.log("Voice\u97f3\u91cf\uff1a"+t.getVoiceVolume()),cc.log("\u30d1\u30fc\u30c8\u30ca\u30fcID\uff1a"+t.getPartnerId()),cc.log("isBgmMute\uff1a"+t.getIsBgmMute()),cc.log("isSeMute\uff1a"+t.getIsSeMute()),cc.log("isVoiceMute\uff1a"+t.getIsVoiceMute()),cc.log("isSkillAuto\uff1a"+t.getIsSkillAuto()),cc.log("\u30b7\u30b9\u30c6\u30e0\u6642\u9593\uff1a"+t.getSystemDate())},testMissionModel:function(){cc.log("---\u30df\u30c3\u30b7\u30e7\u30f3\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8---");var t=r.dao.userMissions[0];cc.log(t),cc.log("\u30df\u30c3\u30b7\u30e7\u30f3\u7a2e\u5225:"+t.getCategory()),cc.log("\u30df\u30c3\u30b7\u30e7\u30f3ID:"+t.getMissionId()),cc.log("\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u540d\u524d:"+t.getName()),cc.log("\u9054\u6210\u6761\u4ef6:"+t.getText()),cc.log("\u5831\u916c\u500b\u6570:"+t.getMissionRewardMater()[0].getCount()),cc.log("\u5831\u916c\u30bf\u30a4\u30d7:"+t.getMissionRewardMater()[0].getItemType()),cc.log("\u5831\u916c\u30a2\u30a4\u30c6\u30e0ID:"+t.getMissionRewardMater()[0].getItemId())},testItemModel:function(){cc.log("---\u30a2\u30a4\u30c6\u30e0\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8---");var t=r.dao.userItems[0];cc.log(t),cc.log("\u30a2\u30a4\u30c6\u30e0ID:"+t.getItemId()),cc.log("\u30a2\u30a4\u30c6\u30e0\u540d:"+t.getName()),cc.log("\u6240\u6301\u6570:"+t.getCount()),cc.log("\u30a2\u30a4\u30c6\u30e0\u8aac\u660e:"+t.getText()),cc.log("\u30a2\u30a4\u30c6\u30e0\u7a2e\u5225:"+t.getItemType()),cc.log(t.getSetItemId())},testFurnitureModel:function(){cc.log("---\u5bb6\u5177\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8---");var t=r.dao.userFurniture[0];cc.log(t),cc.log("\u5bb6\u5177ID:"+t.getFurnitureId()),cc.log("\u5bb6\u5177\u540d:"+t.getFurnitureName()),cc.log("\u5bb6\u5177\u7a2e\u5225:"+t.getFurnitureType()),cc.log("\u8cfc\u5165\u53ef\u80fd\u56de\u6570:"+t.getMaxCount()),cc.log(t.getFurnitureCategoryName()),cc.log(t.getFurnitureTypeName())},testQuestInfo:function(){for(var t=r.dao.userQuests,e=0,i=0,a=0;a<t.length;a++){if(e!==t[a].getWorldId()){switch(e=t[a].getWorldId(),parseInt(t[a].getWorldId()/1e3)){case 1:cc.log(" ___________\u901a\u5e38__________");break;case 2:cc.log(" ___________\u9650\u5b9a__________");break;case 3:cc.log(" ___________\u30a4\u30d9__________")}cc.log(" \u30ef\u30fc\u30eb\u30c9ID\uff1a"+t[a].getWorldId()),cc.log(" \u30ef\u30fc\u30eb\u30c9\u540d\uff1a"+t[a].getWorldName())}if(i!==t[a].getQuestAreaMaster().getAreaId()){var n=t[a].getQuestAreaMaster();i=n.getAreaId(),cc.log("   \u30a8\u30ea\u30a2ID\uff1a"+n.getAreaId()),cc.log("   \u30a8\u30ea\u30a2\u540d\uff1a"+n.getName()),cc.log("   \u8aac\u660e\uff1a"+n.getText()),cc.log("   \u5ea7\u6a19\uff1a x:"+n.getPosX()+", y:"+n.getPosY())}var o=t[a].getQuestStageMaster();cc.log("     \u30b9\u30c6\u30fc\u30b8ID\uff1a"+o.getStageId()),cc.log("     \u30b9\u30c6\u30fc\u30b8\u540d\uff1a"+o.getName()),cc.log("     \u8aac\u660e\uff1a"+o.getText())}},testRoomModel:function(){cc.log("---\u30eb\u30fc\u30e0\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8");var t=r.dao.userRoom.getRoomFurnitureList();for(var e in t){var i=t[e];cc.log(i.getX()),cc.log(i.getUserFurnitureModel().getName())}},testPvPModel:function(){cc.log("---PvP\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8");var t=r.dao.userPvP;cc.log("\u968e\u7d1a:"+t.getName()),cc.log("1\u65e5\u6700\u5927\u6f14\u7fd2\u56de\u6570:"+t.getMaxStamina()),cc.log("\u6226\u7e3e\u30dd\u30a4\u30f3\u30c8:"+t.getPoint()),cc.log("\u30ea\u30bb\u30c3\u30c8\u65e5\u6642:"+t.getToDate()),cc.log("\u6b8b\u308a\u6f14\u7fd2\u56de\u6570:"+t.getStamina())},testPresentModel:function(){cc.log("---\u30d7\u30ec\u30bc\u30f3\u30c8\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8");var t=r.dao.userPresents[1];cc.log("\u30a2\u30a4\u30c6\u30e0ID:"+t.getItemId()),cc.log("\u30a2\u30a4\u30c6\u30e0\u540d:"+t.getName()),cc.log("\u30d7\u30ec\u30bc\u30f3\u30c8\u8aac\u660e:"+t.getMessage()),cc.log("\u53d7\u3051\u53d6\u308a\u671f\u9650:"+t.getReceiveEndDate()),cc.log(t.getIsReceived()),cc.log(t.getReceiveStartDate())},testCharacterModel:function(){cc.log("\u30ad\u30e3\u30e9\u30af\u30bf\u30fc");var t=r.dao.userCharacters[0];cc.log(t),cc.log(t.getFavoriteItemType())},testPictureBookDetailModel:function(){cc.log("---\u56f3\u9451\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8---");var t=r.dao.pictureBookDetail[0];cc.log(t),cc.log(t.getCharacterContentsMaster()),cc.log(t.getName()),cc.log(t.getText())},testPictureBookBaseModel:function(){cc.log("---\u56f3\u9451\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8---");var t=r.dao.pictureBookBase[0];cc.log(t),cc.log(t.getName()),cc.log(t.getText())},testStoryUtils:function(){cc.log("---StoryUtils\u306e\u30c6\u30b9\u30c8---");cc.log(c.isOpenCheck(10000001))},testGacha:function(){cc.log("---\u30ac\u30c1\u30e3\u306e\u30c6\u30b9\u30c8---");var t=r.dao.userGacha[0];cc.log(t),cc.log(t.getGachaName());var e=t.getBanners();cc.log(e[0].bannerFile)},testRequestGetStoryResource:function(){var t=this.node.getComponentsInChildren(cc.EditBox),e=_.find(t,function(t){return"StoryIdEditBox"===t.node.name}),i=100103;e&&!isNaN(e.string)&&(i=parseInt(e.string)),r.StoryService.getStoryResource([i],1,function(t){cc.log("getStoryResource response = ",t)})},testRequestAddStory:function(){var t=this.node.getComponentsInChildren(cc.EditBox),e=_.find(t,function(t){return"AddStoryIdEditBox"===t.node.name}),i=100103;e&&!isNaN(e.string)&&(i=parseInt(e.string)),_.find(r.dao.userStories,function(t){return t.getStoryId()===i})?f.openSimpleMessageWindow("already story [id = "+i+"]",function(){}):r.StoryService.addStory(i,function(t){f.openSimpleMessageWindow("complete add story [id = "+i+"]",function(){}),cc.log("addStory response = ",t)})}}),cc._RF.pop()},{AdvRoot:"AdvRoot",ApiConstants:"ApiConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",CommonUtils:"CommonUtils",DeckConst:"DeckConst",EnumTypes:"EnumTypes",GameConst:"GameConst",HotUpdate:"HotUpdate",Http:"Http",ItemModel:"ItemModel",LocalDataConst:"LocalDataConst",MasterDataConstants:"MasterDataConstants",MissionUtils:"MissionUtils",PopupUtils:"PopupUtils",PvPModel:"PvPModel",PvPRoot:"PvPRoot",PvPUtils:"PvPUtils",QuestModel:"QuestModel",QuestRoot:"QuestRoot",QuestUtils:"QuestUtils",RESTClient:"RESTClient",SceneConst:"SceneConst",Singleton:"Singleton",StartRoot:"StartRoot",StoryUtils:"StoryUtils",UserModel:"UserModel"}],LoginBonusApis:[function(t,e,i){"use strict";cc._RF.push(e,"3705cvQ2E1FILw70UAArXEY","LoginBonusApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.LOGIN_BONUS_GET_MASTER_DATA,path:"loginBonus/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.GET_LOGIN_BONUSES,path:"loginBonus/getLoginBonus",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],LoginBonusConst:[function(t,e,i){"use strict";cc._RF.push(e,"600fcrkwrBJUqqKoxY0BZ2F","LoginBonusConst"),cc.Class({statics:{RECEIVED_TYPE:{CURRENT:1,NEXT:2},LOGIN_BONUS_LAYOUT:{NORMAL:{TYPE:1,INDEX:0,PATH:"prefab/outGame/loginBonus/window/LoginBonusNormalView"},SPECIAL:{TYPE:2,INDEX:1,PATH:"prefab/outGame/loginBonus/window/LoginBonusSpecialView"},VARIABLE:{TYPE:3,INDEX:2,PATH:"prefab/outGame/loginBonus/window/LoginBonusVariableNormalView"}},DEFAULT_LAYOUT_PATH:"prefab/outGame/loginBonus/window/LoginBonusVariableNormalView"}}),cc._RF.pop()},{}],LoginBonusMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"5aac0Ub2DZCD4gC4BZq1m+f","LoginBonusMatrixThumbnail");var a=t("Singleton"),n=t("ResourceUtils"),o=t("MatrixThumbnailBase"),r=t("LoginBonusConst"),s=t("StaticResourceConst"),c=0,l=0,u=1;cc.Class({extends:o,properties:{mainImageSprite:cc.Sprite,countNumLabel:cc.Label,dayNumLabel:cc.Label,dayBaseNode:cc.Node,acquiredNode:cc.Node,selectAnim:cc.Animation,acquiredAnim:cc.Animation},initLoginBonusMatrixThumbnail:function(t,e,i){this._initSprites(t),this._setCount(e),this._setDay(i)},switchCountNumActive:function(t){this.countNumLabel.node.active=t},switchDayNumActive:function(t){this.dayBaseNode.active=t,this.dayNumLabel.node.active=t},switchAcquiredActive:function(t){this.acquiredNode.active=t},playAcquiredAnimation:function(t){this.switchDayNumActive(!1),this.acquiredAnim.once("finished",function(){if(t)return t()},this),this.node.runAction(cc.sequence(cc.delayTime(.5*this.acquiredAnim.getClips()[c].duration),cc.callFunc(function(){a.soundManager.playSE(n.getResource(s.SE.STAMP),!1)},this))),this.acquiredAnim.play(this.acquiredAnim.getClips()[c].name)},playSelectAnimation:function(t){switch(this.selectAnim.node.active=!0,t){case r.RECEIVED_TYPE.CURRENT:a.soundManager.playSE(n.getResource(s.SE.REWARD),!1),this.selectAnim.play(this.selectAnim.getClips()[l].name);break;case r.RECEIVED_TYPE.NEXT:this.selectAnim.play(this.selectAnim.getClips()[u].name);break;default:this.selectAnim.node.active=!1}},_initSprites:function(t){n.addSprite(this.mainImageSprite,t)},_setCount:function(t){t>=0?(this.countNumLabel.node.active=!0,this.countNumLabel.string=t+""):this.countNumLabel.node.active=!1},_setDay:function(t){this.dayBaseNode.active=!0,this.dayNumLabel.node.active=!0,this.dayNumLabel.string=t+""}});cc._RF.pop()},{LoginBonusConst:"LoginBonusConst",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],LoginBonusModel:[function(t,e,i){"use strict";cc._RF.push(e,"e70bdXcWxVE4oNSINthwObs","LoginBonusModel");var a=t("MasterDatabase"),n=t("Singleton")[t("SingletonConst").ERROR_MANAGER];cc.Class({extends:a,getMessageParameter2:function(){if(this._isKeyFieldAvailable("messageParameter2"))return this._data.messageParameter2;n.throwModelPropertyNotFoundError("object field is invalid :: messageParameter2")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n.throwModelPropertyNotFoundError("object field is invalid :: toDate")},getLoginBonusType:function(){if(this._isKeyFieldAvailable("loginBonusType"))return this._data.loginBonusType;n.throwModelPropertyNotFoundError("object field is invalid :: loginBonusType")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n.throwModelPropertyNotFoundError("object field is invalid :: name")},getLoginBonusId:function(){if(this._isKeyFieldAvailable("loginBonusId"))return this._data.loginBonusId;n.throwModelPropertyNotFoundError("object field is invalid :: loginBonusId")},getLayoutName:function(){if(this._isKeyFieldAvailable("layoutName"))return this._data.layoutName;n.throwModelPropertyNotFoundError("object field is invalid :: layoutName")},getIsLoop:function(){if(this._isKeyFieldAvailable("isLoop"))return this._data.isLoop;n.throwModelPropertyNotFoundError("object field is invalid :: isLoop")},getMaxColumn:function(){if(this._isKeyFieldAvailable("maxColumn"))return this._data.maxColumn;n.throwModelPropertyNotFoundError("object field is invalid :: maxColumn")},getMessageParameter1:function(){if(this._isKeyFieldAvailable("messageParameter1"))return this._data.messageParameter1;n.throwModelPropertyNotFoundError("object field is invalid :: messageParameter1")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n.throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getMessageEndParameter:function(){if(this._isKeyFieldAvailable("messageEndParameter"))return this._data.messageEndParameter;n.throwModelPropertyNotFoundError("object field is invalid :: messageEndParameter")},getCharacterId2:function(){if(this._isKeyFieldAvailable("characterId2"))return this._data.characterId2;n.throwModelPropertyNotFoundError("object field is invalid :: characterId2")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n.throwModelPropertyNotFoundError("object field is invalid :: order")},getCharacterId1:function(){if(this._isKeyFieldAvailable("characterId1"))return this._data.characterId1;n.throwModelPropertyNotFoundError("object field is invalid :: characterId1")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],LoginBonusNormalRibbon:[function(t,e,i){"use strict";cc._RF.push(e,"326ac3DwTVIHaBlZClz2mX5","LoginBonusNormalRibbon");var a=0,n=1;cc.Class({extends:cc.Component,properties:{ribbonAnim:cc.Animation},onLoad:function(){this.ribbonAnim.once("finished",this._playRibbonLoopAnimation.bind(this),this),this.ribbonAnim.play(this.ribbonAnim.getClips()[a].name)},_playRibbonLoopAnimation:function(){this.ribbonAnim.play(this.ribbonAnim.getClips()[n].name)}});cc._RF.pop()},{}],LoginBonusNormalView:[function(t,e,i){"use strict";cc._RF.push(e,"d1038r/Lw1IX5l35WLcEInt","LoginBonusNormalView");var a=t("LoginBonusViewBase"),n=t("ResourceUtils"),o=t("CharacterUtils"),r=t("LoginBonusSerifView"),s=t("LoginBonusSdCharacterView"),c=t("LoginBonusConst"),l=t("CommonButton"),u=t("Async");cc.Class({extends:a,properties:{addRewardThumbnailNodeArray:[cc.Node],rewardThumbnailPrefab:cc.Prefab,leftSerifView:r,rightSerifView:r,leftSdCharaView:s,rightSdCharaView:s,touchBtn:l,receivedPopupPrefab:cc.Prefab,addSelectThumbnailNode:cc.Node},_rewardThumbnailMap:void 0,_receivedPopup:null,initLoginBonusView:function(t,e,i){this._super(t,e,i),this._initRewardThumbnail(),this._initCharacterView(),this._initBtn()},closePopup:function(){this._receivedPopup&&(this._receivedPopup.close(),this._receivedPopup=null)},_initRewardThumbnail:function(){this.addRewardThumbnailNodeArray.forEach(function(t){t.active=!1}),this._rewardThumbnailMap={},this._loginBonusRewardMasters.forEach(function(t,e){var i=cc.instantiate(this.rewardThumbnailPrefab).getComponent("LoginBonusMatrixThumbnail"),a=n.getFileNameThumbnailByItemType(t.getItemId(),t.getItemType());i.initLoginBonusMatrixThumbnail(a,t.getAmount(),t.getLoginCount()),i.switchAcquiredActive(t.getLoginCount()<this._loginBonus.loginCount),i.switchDayNumActive(t.getLoginCount()>=this._loginBonus.loginCount);var o=Math.floor(e/this._loginBonusMainMaster.getMaxColumn());this.addRewardThumbnailNodeArray[o].addChild(i.node),this.addRewardThumbnailNodeArray[o].active=!0,this._rewardThumbnailMap[t.getLoginCount()]=i}.bind(this))},_initCharacterView:function(){var t=o.getCharacterMainModelByCharacterId(this._loginBonusMainMaster.getCharacterId1());this.leftSerifView.initLoginBonusSerifView(this._root,t.getShortName(),this._loginBonusMainMaster.getMessageParameter1()),this.leftSerifView.node.opacity=0,this.leftSdCharaView.initLoginBonusSdCharacterView(this._loginBonusMainMaster.getCharacterId1());var e=o.getCharacterMainModelByCharacterId(this._loginBonusMainMaster.getCharacterId2());this.rightSerifView.initLoginBonusSerifView(this._root,e.getShortName(),this._loginBonusMainMaster.getMessageParameter2()),this.rightSerifView.node.opacity=0,this.rightSdCharaView.initLoginBonusSdCharacterView(this._loginBonusMainMaster.getCharacterId2())},_initBtn:function(){this.touchBtn.setTapEvent(this._nextLoginEvent),this.touchBtn.node.active=!1},startLoginBonusAnimation:function(){this._super();var t=[];t.push(function(t){this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(t)))}.bind(this)),t.push(function(t){this._rewardThumbnailMap[this._loginBonus.loginCount].playAcquiredAnimation(t)}.bind(this)),t.push(function(t){this.playOpenGrayOutBGAnim(function(){});var e=this._loginBonusRewardMasters.find(function(t){return t.getLoginCount()===this._loginBonus.loginCount}.bind(this));this._receivedPopup=cc.instantiate(this.receivedPopupPrefab).getComponent("LoginBonusReceivedPopup"),this._receivedPopup.openLoginBonusReceivedPopup(e.getItemId(),e.getItemType(),e.getAmount(),c.RECEIVED_TYPE.CURRENT,function(){this.leftSerifView.playFade(0,t)}.bind(this)),this._rewardThumbnailMap[this._loginBonus.loginCount].playSelectAnimation(c.RECEIVED_TYPE.CURRENT),this.leftSerifView.playFade(255,function(){}),this.leftSerifView.playOpenAnim(function(){})}.bind(this)),t.push(function(t){this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(t)))}.bind(this)),t.push(function(t){if(this._rewardThumbnailMap[this._loginBonus.loginCount+1]){var e=this._loginBonusRewardMasters.find(function(t){return t.getLoginCount()===this._loginBonus.loginCount+1}.bind(this));this._receivedPopup=cc.instantiate(this.receivedPopupPrefab).getComponent("LoginBonusReceivedPopup"),this._receivedPopup.openLoginBonusReceivedPopup(e.getItemId(),e.getItemType(),e.getAmount(),c.RECEIVED_TYPE.NEXT,function(){if(this._nextLoginEvent)return this._nextLoginEvent()}.bind(this)),this._rewardThumbnailMap[this._loginBonus.loginCount].playSelectAnimation(void 0),this._rewardThumbnailMap[this._loginBonus.loginCount+1].playSelectAnimation(c.RECEIVED_TYPE.NEXT),this.rightSerifView.setSerifLabel(this._loginBonusMainMaster.getMessageParameter2())}else this.rightSerifView.setSerifLabel(this._loginBonusMainMaster.getMessageEndParameter());this.rightSerifView.playFade(255,function(){}),this.rightSerifView.playOpenAnim(function(){}),this.touchBtn.node.active=!0,t()}.bind(this)),u.waterfall(t)},_getDuplicationThumbnail:function(t){var e=cc.instantiate(t.node).getComponent("LoginBonusMatrixThumbnail"),i=t.node.convertToWorldSpaceAR(cc.v2(0,0)),a=this.addSelectThumbnailNode.convertToNodeSpaceAR(i);return this.addSelectThumbnailNode.addChild(e.node),e.node.setPosition(a),e}});cc._RF.pop()},{Async:"Async",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",LoginBonusConst:"LoginBonusConst",LoginBonusSdCharacterView:"LoginBonusSdCharacterView",LoginBonusSerifView:"LoginBonusSerifView",LoginBonusViewBase:"LoginBonusViewBase",ResourceUtils:"ResourceUtils"}],LoginBonusReceivedPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e3b322bUndGYarSPHVUIgbA","LoginBonusReceivedPopup");var a=t("PopupBase"),n=t("ResourceUtils"),o=(t("CharacterUtils"),t("EquipmentUtils"),t("FurnitureUtils"),t("ItemUtils")),r=(t("ItemConst"),t("LoginBonusConst")),s=t("StaticResourceConst"),c=0,l=1;cc.Class({extends:a,properties:{mainImageSprite:cc.Sprite,nameLabel:cc.Label,countNumLabel:cc.Label,selectAnim:cc.Animation,nextSelectDisableNodeArray:[cc.Node]},openLoginBonusReceivedPopup:function(t,e,i,a,s){n.addSprite(this.mainImageSprite,n.getFileNameThumbnailByItemType(t,e),void 0);var c=o.getItemInfo(e,t);this.nameLabel.string=c.name,this.countNumLabel.string=""+i,a===r.RECEIVED_TYPE.NEXT&&this._setDisableNode(),this._playSelectAnimation(a),this.setCloseCallBack(s),this.open()},_addGrayBack:function(t,e){var i=this._getGrayBackSprite();i||(i=new cc.Node("PopupGrayBack").addComponent(cc.Sprite),n.addSprite(i,s.SIMPLE_TEX_PATH,function(){i.node.setContentSize(cc.winSize),i.node.color=cc.color(0,0,0),i.node.opacity=0}),this._setNodeGroup(i.node),t.addChild(i.node,e))},_playSelectAnimation:function(t){switch(t){case r.RECEIVED_TYPE.CURRENT:this.selectAnim.play(this.selectAnim.getClips()[c].name);break;case r.RECEIVED_TYPE.NEXT:this.selectAnim.play(this.selectAnim.getClips()[l].name)}},_setDisableNode:function(){this.nextSelectDisableNodeArray.forEach(function(t){t.active=!1})}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",EquipmentUtils:"EquipmentUtils",FurnitureUtils:"FurnitureUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LoginBonusConst:"LoginBonusConst",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],LoginBonusRoot:[function(t,e,i){"use strict";cc._RF.push(e,"3a563v/AJ9I3I/c2CHy+iIi","LoginBonusRoot");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("LoginBonusViewSetting"),r=t("GameConst"),s=t("CharacterUtils"),c=t("ResourceUtils"),l=t("SceneConst"),u=(t("StartRoot"),t("LoginBonusConst"));cc.Class({extends:a,properties:{loginBonusSubRootPrefab:cc.Prefab},_loginBonusArray:null,_loginBonusMainMasterMap:null,_loginBonusRewardMasterMap:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,o.LOGIN_BONUS_SETTING)},onLoad:function(){this._setErrorHandling(),this._addBand()},_getSceneBgmName:function(){return r.BGM.HOME},initData:function(){if(this.requestURLCount+=1,this.sceneParam){var t=JSON.parse(this.sceneParam).LoginBonusSubRoot;if(t)if(t.loginBonus){this._createLoginBonusMasterMap(t.loginBonus);var e=t.loginBonus.slice();e.sort(function(t,e){return this._loginBonusMainMasterMap[t.loginBonusId].getOrder()>this._loginBonusMainMasterMap[e.loginBonusId].getOrder()?1:-1}.bind(this)),this._loginBonusArray=e,this.requestURLCount-=1}else this.transitionHomeScene();else this.transitionHomeScene()}else this.transitionHomeScene()},initResource:function(){if(this._super(),this._loginBonusArray){for(var t=Object.keys(u.LOGIN_BONUS_LAYOUT),e=0;e<t.length;e+=1)this.requestRes(u.LOGIN_BONUS_LAYOUT[t[e]].PATH,cc.Prefab);this._loginBonusArray.forEach(function(t){this._loadUniquePrefab(this._loginBonusMainMasterMap[t.loginBonusId]),this._loadCharacters(this._loginBonusMainMasterMap[t.loginBonusId]),this.requestRes(c.getFileNameLoginLoginBonusBG(t.loginBonusId),cc.SpriteFrame),this._loginBonusRewardMasterMap[t.loginBonusId].forEach(function(t){this.requestRes(c.getFileNameThumbnailByItemType(t.getItemId(),t.getItemType()),cc.SpriteFrame),0!==t.getItemId2()&&this.requestRes(c.getFileNameThumbnailByItemType(t.getItemId2(),t.getItemType2()),cc.SpriteFrame)}.bind(this))}.bind(this))}else this.transitionHomeScene()},_loadUniquePrefab:function(t){switch(t.getLoginBonusType()){case u.LOGIN_BONUS_LAYOUT.VARIABLE.TYPE:t.getLayoutName()&&this.requestRes(c.getFileNameLoginBonusPrefab(t.getLayoutName()),cc.Prefab)}},_loadCharacters:function(t){switch(t.getLoginBonusType()){case u.LOGIN_BONUS_LAYOUT.SPECIAL.TYPE:this.requestRes(c.getFileNameCharacterStand(t.getCharacterId1()),cc.SpriteFrame);break;default:this.requestRes(c.getFileNameCharacterSDSpine(s.getCharacterMainModelByCharacterId(t.getCharacterId1()).getSpineDirectoryPath()),sp.SkeletonData),this.requestRes(c.getFileNameCharacterSDSpine(s.getCharacterMainModelByCharacterId(t.getCharacterId2()).getSpineDirectoryPath()),sp.SkeletonData)}},initialize:function(){if(cc.log("\u30ed\u30b0\u30a4\u30f3\u30dc\u30fc\u30ca\u30b9\uff1a\u30eb\u30fc\u30c8"),this._loginBonusArray){this.initOutGameRootBase();this._initOpenFirstView({LoginBonusSubRoot:{}})}else this.transitionHomeScene()},getLoginBonusArray:function(){return this._loginBonusArray},getLoginBonusMainMasterMap:function(){return this._loginBonusMainMasterMap},getLoginBonusRewardMasterMap:function(){return this._loginBonusRewardMasterMap},_createLoginBonusMasterMap:function(t){this._loginBonusMainMasterMap={},this._loginBonusRewardMasterMap={},t.forEach(function(t){this._loginBonusMainMasterMap[t.loginBonusId]=n.dao.LoginBonusMainMasters.find(function(e){return e.getLoginBonusId()===t.loginBonusId}),this._loginBonusRewardMasterMap[t.loginBonusId]=n.dao.LoginBonusRewardMasters.filter(function(e){return e.getLoginBonusId()===t.loginBonusId})}.bind(this))},transitionHomeScene:function(){this.pushScene(l.SCENE.FILE_NAME.RESTORE_BATTLE,void 0,void 0,void 0,!0)}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",GameConst:"GameConst",LoginBonusConst:"LoginBonusConst",LoginBonusViewSetting:"LoginBonusViewSetting",OutGameRootBase:"OutGameRootBase",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",StartRoot:"StartRoot"}],LoginBonusSdCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"cfc067bHQlIAa2iheqHCuHo","LoginBonusSdCharacterView");var a=t("SDCharacterViewBase");cc.Class({extends:a,properties:{},_characterId:0,initLoginBonusSdCharacterView:function(t){this._characterId=t,this.initSDCharacterView(),this.setSpineAnimation(this._getDefaultSkinName(),this._getDefaultAnimationName(),!0)},_getCharacterId:function(){return this._characterId},_getDefaultSkinName:function(){return"default"},_getDefaultAnimationName:function(){return"idle"}});cc._RF.pop()},{SDCharacterViewBase:"SDCharacterViewBase"}],LoginBonusSerifView:[function(t,e,i){"use strict";cc._RF.push(e,"c5683I9LRxNgL7lqeNZQRTM","LoginBonusSerifView");cc.Class({extends:cc.Component,properties:{serifLabel:cc.Label,nameLabel:cc.Label,openAnim:cc.Animation},_root:null,initLoginBonusSerifView:function(t,e,i){this._root=t,this.serifLabel.string=i,this.nameLabel.string=e},setSerifLabel:function(t){this.serifLabel.string=t},playFade:function(t,e){this.node.runAction(cc.sequence(cc.fadeTo(.2,t),cc.callFunc(e)))},playOpenAnim:function(t){this.openAnim.once("finished",function(){if(t)return t()},this),this.openAnim.play(this.openAnim.getClips()[0].name)}});cc._RF.pop()},{}],LoginBonusService:[function(t,e,i){"use strict";cc._RF.push(e,"5d696kvSO5Byq7RwAdhnlDh","LoginBonusService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getLoginBonus:function(t){this._requestCallApi(n.GET_LOGIN_BONUSES,{},function(e,i){return t(e?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],LoginBonusSpecialTotalThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"25034DjYMxEVoS6KhbFM/6A","LoginBonusSpecialTotalThumbnail");var a=t("ResourceUtils"),n=t("LoginBonusMatrixThumbnail"),o=t("LoginBonusConst"),r=t("ItemUtils");cc.Class({extends:cc.Component,properties:{totalRewardThumbnail:n,dayLabel:cc.Label,remainDayLabel:cc.Label,rewardNameLabel:cc.Label},_root:null,_loginBonus:void 0,_loginRewardModel:null,initLoginBonusSpecialTotalThumbnail:function(t,e,i){this._root=t,this._loginBonus=e,this._loginRewardModel=i,this._initTotalRewardThumbnail(),this.dayLabel.string=""+i.getLoginCount(),this.remainDayLabel.string=""+(i.getLoginCount()-e.loginCount),this.rewardNameLabel.string=r.getItemMaster(i.getItemId2()).getName()},_initTotalRewardThumbnail:function(){var t=a.getFileNameThumbnailByItemType(this._loginRewardModel.getItemId2(),this._loginRewardModel.getItemType2());this.totalRewardThumbnail.initLoginBonusMatrixThumbnail(t,this._loginRewardModel.getAmount2(),this._loginRewardModel.getLoginCount()),this.totalRewardThumbnail.switchDayNumActive(!1),this.totalRewardThumbnail.switchAcquiredActive(!1)},playAcquiredAnimation:function(t){this.totalRewardThumbnail.playAcquiredAnimation(t)},playSelectAnimation:function(){this.totalRewardThumbnail.playSelectAnimation(o.RECEIVED_TYPE.CURRENT)}});cc._RF.pop()},{ItemUtils:"ItemUtils",LoginBonusConst:"LoginBonusConst",LoginBonusMatrixThumbnail:"LoginBonusMatrixThumbnail",ResourceUtils:"ResourceUtils"}],LoginBonusSpecialView:[function(t,e,i){"use strict";cc._RF.push(e,"e8e3er2lKFJzaZlqn3XgEE1","LoginBonusSpecialView");var a=t("LoginBonusViewBase"),n=t("ResourceUtils"),o=t("LoginBonusSpecialTotalThumbnail"),r=t("LoginBonusSerifView"),s=t("LoginBonusConst"),c=t("CharacterUtils"),l=t("CommonButton"),u=t("ViewUtils"),h=t("Async");cc.Class({extends:a,properties:{addRewardThumbnailNodeArray:[cc.Node],rewardThumbnailPrefab:cc.Prefab,totalRewardThumbnail:o,serifView:r,characterStandViewParentNode:cc.Node,touchBtn:l,receivedPopupPrefab:cc.Prefab,addSelectThumbnailNode:cc.Node},_rewardThumbnailMap:void 0,_receivedPopup:null,initLoginBonusView:function(t,e,i){this._super(t,e,i),this._initRewardThumbnail(),this._initCharacterView(),this._initBtn()},closePopup:function(){this._receivedPopup&&(this._receivedPopup.close(),this._receivedPopup=null)},_initRewardThumbnail:function(){this.addRewardThumbnailNodeArray.forEach(function(t){t.active=!1}),this._rewardThumbnailMap={},this._loginBonusRewardMasters.forEach(function(t,e){var i=cc.instantiate(this.rewardThumbnailPrefab).getComponent("LoginBonusMatrixThumbnail"),a=n.getFileNameThumbnailByItemType(t.getItemId(),t.getItemType());i.initLoginBonusMatrixThumbnail(a,t.getAmount(),t.getLoginCount()),i.switchAcquiredActive(t.getLoginCount()<this._loginBonus.loginCount),i.switchDayNumActive(t.getLoginCount()>=this._loginBonus.loginCount);var o=Math.floor(e/this._loginBonusMainMaster.getMaxColumn());this.addRewardThumbnailNodeArray[o].addChild(i.node),this.addRewardThumbnailNodeArray[o].active=!0,this._rewardThumbnailMap[t.getLoginCount()]=i}.bind(this));var t=_.maxBy(this._loginBonusRewardMasters,function(t){return t.getLoginCount()});this.totalRewardThumbnail.initLoginBonusSpecialTotalThumbnail(this._root,this._loginBonus,t)},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=u.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_setCharacterStandImage:function(t){this._characterStandView.setCharacterStandImage(t)},_initCharacterView:function(){var t=c.getCharacterMainModelByCharacterId(this._loginBonusMainMaster.getCharacterId1());this.serifView.initLoginBonusSerifView(this._root,t.getShortName(),this._loginBonusMainMaster.getMessageParameter1()),this.serifView.node.opacity=0,this._initCharacterStandView(),this._setCharacterStandImage(this._loginBonusMainMaster.getCharacterId1())},_initBtn:function(){this.touchBtn.setTapEvent(this._nextLoginEvent),this.touchBtn.node.active=!1},startLoginBonusAnimation:function(){var t;this._super();var e=[];e.push(function(t){this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(t)))}.bind(this)),e.push(function(t){this._rewardThumbnailMap[this._loginBonus.loginCount].playAcquiredAnimation(t)}.bind(this)),e.push(function(t){this.playOpenGrayOutBGAnim(function(){});var e=this._loginBonusRewardMasters.find(function(t){return t.getLoginCount()===this._loginBonus.loginCount}.bind(this));this._receivedPopup=cc.instantiate(this.receivedPopupPrefab).getComponent("LoginBonusReceivedPopup"),this._receivedPopup.openLoginBonusReceivedPopup(e.getItemId(),e.getItemType(),e.getAmount(),s.RECEIVED_TYPE.CURRENT,function(){this.playCloseGrayOutBGAnim(t)}.bind(this)),this._rewardThumbnailMap[this._loginBonus.loginCount].playSelectAnimation(s.RECEIVED_TYPE.CURRENT),this.serifView.playFade(255,function(){})}.bind(this)),e.push(function(e){this._rewardThumbnailMap[this._loginBonus.loginCount+1]?(this._rewardThumbnailMap[this._loginBonus.loginCount].playSelectAnimation(void 0),this.serifView.setSerifLabel(this._loginBonusMainMaster.getMessageParameter2()),(t=this._getDuplicationThumbnail(this._rewardThumbnailMap[this._loginBonus.loginCount+1])).playSelectAnimation(s.RECEIVED_TYPE.NEXT),t.node.runAction(cc.sequence(cc.scaleTo(.2,1.2,1.2),cc.callFunc(e)))):this.totalRewardThumbnail.playAcquiredAnimation(e)}.bind(this)),e.push(function(t){if(!this._rewardThumbnailMap[this._loginBonus.loginCount+1]){this.playOpenGrayOutBGAnim(function(){});var e=this._loginBonusRewardMasters.find(function(t){return t.getLoginCount()===this._loginBonus.loginCount}.bind(this));this._receivedPopup=cc.instantiate(this.receivedPopupPrefab).getComponent("LoginBonusReceivedPopup"),this._receivedPopup.openLoginBonusReceivedPopup(e.getItemId2(),e.getItemType2(),e.getAmount2(),s.RECEIVED_TYPE.CURRENT,function(){this.playCloseGrayOutBGAnim(this._nextLoginEvent.bind(this))}.bind(this)),this._rewardThumbnailMap[this._loginBonus.loginCount].playSelectAnimation(void 0),this.totalRewardThumbnail.playSelectAnimation(),this.serifView.setSerifLabel(this._loginBonusMainMaster.getMessageEndParameter())}this.touchBtn.node.active=!0,t()}.bind(this)),h.waterfall(e)},_getDuplicationThumbnail:function(t){var e=cc.instantiate(t.node).getComponent("LoginBonusMatrixThumbnail"),i=t.node.convertToWorldSpaceAR(cc.v2(0,0)),a=this.addSelectThumbnailNode.convertToNodeSpaceAR(i);return this.addSelectThumbnailNode.addChild(e.node),e.node.setPosition(a),e}});cc._RF.pop()},{Async:"Async",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",LoginBonusConst:"LoginBonusConst",LoginBonusSerifView:"LoginBonusSerifView",LoginBonusSpecialTotalThumbnail:"LoginBonusSpecialTotalThumbnail",LoginBonusViewBase:"LoginBonusViewBase",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],LoginBonusSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"fa6faFZo51PoYRZNWqB6gpN","LoginBonusSubRoot");var a=t("WindowBase"),n=t("LoginBonusConst"),o=t("ResourceUtils");cc.Class({extends:a,properties:{viewContent:cc.Node,fadeNode:cc.Node},_root:null,_loginBonusViewArray:null,fadeFlg:!1,initLoginBonusSubRoot:function(t){this._root=t;var e=t.getLoginBonusMainMasterMap(),i=t.getLoginBonusArray();this._loginBonusViewArray=[],i.forEach(function(i){var a=this._getLoginBonusView(e[i.loginBonusId]);a&&(a.initLoginBonusView(t,i,this.setNextLoginBonusView.bind(this)),this._loginBonusViewArray.push(a))}.bind(this)),this.fadeFlg=!1,this.fadeNode.active=!1,this.setNextLoginBonusView()},_getLoginBonusView:function(t){if(t){var e;switch(t.getLoginBonusType()){case n.LOGIN_BONUS_LAYOUT.NORMAL.TYPE:e=cc.instantiate(o.getResource(n.LOGIN_BONUS_LAYOUT.NORMAL.PATH));break;case n.LOGIN_BONUS_LAYOUT.SPECIAL.TYPE:e=cc.instantiate(o.getResource(n.LOGIN_BONUS_LAYOUT.SPECIAL.PATH));break;case n.LOGIN_BONUS_LAYOUT.VARIABLE.TYPE:e=t.getLayoutName()?cc.instantiate(o.getResource(o.getFileNameLoginBonusPrefab(t.getLayoutName()))):cc.instantiate(o.getResource(n.LOGIN_BONUS_LAYOUT.VARIABLE.PATH));break;default:e=cc.instantiate(o.getResource(n.DEFAULT_LAYOUT_PATH))}return e?e.getComponent("LoginBonusViewBase"):void cc.error("\u30ed\u30b0\u30a4\u30f3\u30dc\u30fc\u30ca\u30b9\u30ec\u30a4\u30a2\u30a6\u30c8\u53d6\u5f97\u5931\u6557\uff1a\u30de\u30b9\u30bf\u5b9a\u7fa9\u3092\u898b\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\n",t)}},setNextLoginBonusView:function(){if(this._loginBonusViewArray.length>0){this.viewContent.destroyAllChildren();var t=this._loginBonusViewArray.shift();this._playFadeIn(function(){this.viewContent.addChild(t.node),this._playFadeOut(function(){this.fadeFlg=!0,t.startLoginBonusAnimation()}.bind(this))}.bind(this))}else this._root.transitionHomeScene()},_playFadeIn:function(t){this.fadeFlg?(this.fadeNode.active=!0,this.fadeNode.opacity=0,this.fadeNode.runAction(cc.sequence(cc.fadeIn(.2),cc.callFunc(function(){t()})))):t()},_playFadeOut:function(t){this.fadeFlg?this.fadeNode.runAction(cc.sequence(cc.fadeOut(.2),cc.callFunc(function(){this.fadeNode.active=!1,t()},this))):t()}});cc._RF.pop()},{LoginBonusConst:"LoginBonusConst",ResourceUtils:"ResourceUtils",WindowBase:"WindowBase"}],LoginBonusUtils:[function(t,e,i){"use strict";cc._RF.push(e,"29fee+LJS1JsbmgHFxli2pz","LoginBonusUtils"),e.exports={openLoginBonusSubRoot:function(t,e){cc.log("openLoginBonusSubRoot"),cc.log(e),t.loginBonusSubRoot||(t.loginBonusSubRoot=cc.instantiate(t.loginBonusSubRootPrefab).getComponent("LoginBonusSubRoot"),t.subRootParent.addChild(t.loginBonusSubRoot.node)),t.loginBonusSubRoot.initLoginBonusSubRoot(t)},closeLoginBonusSubRoot:function(t,e){cc.log("closeLoginBonusSubRoot"),cc.log(e),t.loginBonusSubRoot&&(t.loginBonusSubRoot.node.destroy(),t.loginBonusSubRoot=null)}},cc._RF.pop()},{}],LoginBonusVariableNormalView:[function(t,e,i){"use strict";cc._RF.push(e,"be634VSsI1BJbTVE+i4O3Aa","LoginBonusVariableNormalView");var a=t("LoginBonusViewBase"),n=t("ResourceUtils"),o=t("CharacterUtils"),r=t("LoginBonusSerifView"),s=t("LoginBonusSdCharacterView"),c=t("LoginBonusConst"),l=t("CommonButton"),u=t("Async");cc.Class({extends:a,properties:{thumbnailParentNode:cc.Node,rewardThumbnailPrefab:cc.Prefab,leftSerifView:r,rightSerifView:r,leftSdCharaView:s,rightSdCharaView:s,touchBtn:l,receivedPopupPrefab:cc.Prefab,addSelectThumbnailNode:cc.Node},_layoutArray:void 0,_rewardThumbnailMap:void 0,_receivedPopup:null,initLoginBonusView:function(t,e,i){this._super(t,e,i),this._initRewardThumbnail(),this._initCharacterView(),this._initBtn()},closePopup:function(){this._receivedPopup&&(this._receivedPopup.close(),this._receivedPopup=null)},_initRewardThumbnail:function(){this._rewardThumbnailMap={};var t=-1,e=this._loginBonusMainMaster.getMaxColumn(),i=0,a=null;this._loginBonusRewardMasters.forEach(function(o,r){if((i=Math.floor(r/e))>t&&(t=i,this.thumbnailParentNode.addChild(this._createLayoutNode(t))),a=this.thumbnailParentNode.getChildByName("thumbLayout_"+t)){var s=cc.instantiate(this.rewardThumbnailPrefab).getComponent("LoginBonusMatrixThumbnail"),c=n.getFileNameThumbnailByItemType(o.getItemId(),o.getItemType());s.initLoginBonusMatrixThumbnail(c,o.getAmount(),o.getLoginCount()),s.switchAcquiredActive(o.getLoginCount()<this._loginBonus.loginCount),s.switchDayNumActive(o.getLoginCount()>=this._loginBonus.loginCount);Math.floor(r/this._loginBonusMainMaster.getMaxColumn());a.addChild(s.node),this._rewardThumbnailMap[o.getLoginCount()]=s}}.bind(this))},_createLayoutNode:function(t){var e=new cc.Node("thumbLayout_"+t).addComponent(cc.Layout);return e.type=cc.Layout.Type.HORIZONTAL,e.resizeMode=cc.Layout.ResizeMode.CHILDREN,e.spacingX=35,e.node.zIndex=t,e.node.width=770,e.node.height=160,e.node},_initCharacterView:function(){var t=o.getCharacterMainModelByCharacterId(this._loginBonusMainMaster.getCharacterId1());this.leftSerifView.initLoginBonusSerifView(this._root,t.getShortName(),this._loginBonusMainMaster.getMessageParameter1()),this.leftSerifView.node.opacity=0,this.leftSdCharaView.initLoginBonusSdCharacterView(this._loginBonusMainMaster.getCharacterId1());var e=o.getCharacterMainModelByCharacterId(this._loginBonusMainMaster.getCharacterId2());this.rightSerifView.initLoginBonusSerifView(this._root,e.getShortName(),this._loginBonusMainMaster.getMessageParameter2()),this.rightSerifView.node.opacity=0,this.rightSdCharaView.initLoginBonusSdCharacterView(this._loginBonusMainMaster.getCharacterId2())},_initBtn:function(){this.touchBtn.setTapEvent(this._nextLoginEvent),this.touchBtn.node.active=!1},startLoginBonusAnimation:function(){this._super();var t=[];t.push(function(t){this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(t)))}.bind(this)),t.push(function(t){this._rewardThumbnailMap[this._loginBonus.loginCount].playAcquiredAnimation(t)}.bind(this)),t.push(function(t){this.playOpenGrayOutBGAnim(function(){});var e=this._loginBonusRewardMasters.find(function(t){return t.getLoginCount()===this._loginBonus.loginCount}.bind(this));this._receivedPopup=cc.instantiate(this.receivedPopupPrefab).getComponent("LoginBonusReceivedPopup"),this._receivedPopup.openLoginBonusReceivedPopup(e.getItemId(),e.getItemType(),e.getAmount(),c.RECEIVED_TYPE.CURRENT,function(){this.leftSerifView.playFade(0,t)}.bind(this)),this._rewardThumbnailMap[this._loginBonus.loginCount].playSelectAnimation(c.RECEIVED_TYPE.CURRENT),this.leftSerifView.playFade(255,function(){}),this.leftSerifView.playOpenAnim(function(){})}.bind(this)),t.push(function(t){this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(t)))}.bind(this)),t.push(function(t){if(this._rewardThumbnailMap[this._loginBonus.loginCount+1]){var e=this._loginBonusRewardMasters.find(function(t){return t.getLoginCount()===this._loginBonus.loginCount+1}.bind(this));this._receivedPopup=cc.instantiate(this.receivedPopupPrefab).getComponent("LoginBonusReceivedPopup"),this._receivedPopup.openLoginBonusReceivedPopup(e.getItemId(),e.getItemType(),e.getAmount(),c.RECEIVED_TYPE.NEXT,function(){if(this._nextLoginEvent)return this._nextLoginEvent()}.bind(this)),this._rewardThumbnailMap[this._loginBonus.loginCount].playSelectAnimation(void 0),this._rewardThumbnailMap[this._loginBonus.loginCount+1].playSelectAnimation(c.RECEIVED_TYPE.NEXT),this.rightSerifView.setSerifLabel(this._loginBonusMainMaster.getMessageParameter2())}else this.rightSerifView.setSerifLabel(this._loginBonusMainMaster.getMessageEndParameter());this.rightSerifView.playFade(255,function(){}),this.rightSerifView.playOpenAnim(function(){}),this.touchBtn.node.active=!0,t()}.bind(this)),u.waterfall(t)},_getDuplicationThumbnail:function(t){var e=cc.instantiate(t.node).getComponent("LoginBonusMatrixThumbnail"),i=t.node.convertToWorldSpaceAR(cc.v2(0,0)),a=this.addSelectThumbnailNode.convertToNodeSpaceAR(i);return this.addSelectThumbnailNode.addChild(e.node),e.node.setPosition(a),e}});cc._RF.pop()},{Async:"Async",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",LoginBonusConst:"LoginBonusConst",LoginBonusSdCharacterView:"LoginBonusSdCharacterView",LoginBonusSerifView:"LoginBonusSerifView",LoginBonusViewBase:"LoginBonusViewBase",ResourceUtils:"ResourceUtils"}],LoginBonusViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"45ee8X3pgFPorZr+aryU+oS","LoginBonusViewBase");var a=t("Singleton"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("StaticResourceConst"),s=0,c=1;cc.Class({extends:cc.Component,properties:{skipBtn:n,bgSprite:cc.Sprite,titleRibbonPrefab:cc.Prefab,titleRibbonParentNode:cc.Node,grayOutBgAnim:cc.Animation},_root:null,_loginBonus:void 0,_nextLoginEvent:void 0,_loginBonusMainMaster:null,_loginBonusRewardMasters:null,_loginBonusNormalRibbon:null,initLoginBonusView:function(t,e,i){this._root=t,this._loginBonus=e,this._nextLoginEvent=i,this._loginBonusMainMaster=t.getLoginBonusMainMasterMap()[e.loginBonusId],this._loginBonusRewardMasters=t.getLoginBonusRewardMasterMap()[e.loginBonusId],this.initBgSprite(),this.initTitleRibbon(),this.skipBtn.setTapEvent(function(){this.closePopup(),i()}.bind(this))},initBgSprite:function(){o.addSprite(this.bgSprite,o.getFileNameLoginLoginBonusBG(this._loginBonus.loginBonusId),void 0)},initTitleRibbon:function(){this._loginBonusNormalRibbon||(this._loginBonusNormalRibbon=cc.instantiate(this.titleRibbonPrefab).getComponent("LoginBonusNormalRibbon"),this.titleRibbonParentNode.addChild(this._loginBonusNormalRibbon.node))},playOpenGrayOutBGAnim:function(t){this.grayOutBgAnim.once("finished",function(){if(t)return t()},this),this.grayOutBgAnim.play(this.grayOutBgAnim.getClips()[s].name)},playCloseGrayOutBGAnim:function(t){this.isValid&&(this.grayOutBgAnim.once("finished",function(){if(t)return t()},this),this.grayOutBgAnim.play(this.grayOutBgAnim.getClips()[c].name))},closePopup:function(){},startLoginBonusAnimation:function(){a.soundManager.playSE(o.getResource(r.SE.LOGIN_BONUS),!1)}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],LoginBonusViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"a708b0pIptEf4AsYpVnQydA","LoginBonusViewSetting");var a=t("LoginBonusUtils");e.exports={LOGIN_BONUS_SETTING:{LoginBonusSubRoot:{open:a.openLoginBonusSubRoot,close:a.closeLoginBonusSubRoot}}},cc._RF.pop()},{LoginBonusUtils:"LoginBonusUtils"}],LoginPackApis:[function(t,e,i){"use strict";cc._RF.push(e,"5c2e9pskXdG/o2Ph0W5sS9X","LoginPackApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.LOGIN_PACK_GET_MASTER_DATA,path:"loginPack/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.GET_LOGIN_PACKS,path:"loginPack/getLoginPack",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],LoginPackMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"8cc24IXSqBOYYPt6krCiK18","LoginPackMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLoginPackId:function(){if(this._isKeyFieldAvailable("loginPackId"))return this._data.loginPackId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: loginPackId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getLoginBonusDays:function(){if(this._isKeyFieldAvailable("loginBonusDays"))return this._data.loginBonusDays;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: loginBonusDays")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],LoginPackRewardModel:[function(t,e,i){"use strict";cc._RF.push(e,"25206+B/XdN1a4U2gpM9/FY","LoginPackRewardModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLoginPackId:function(){if(this._isKeyFieldAvailable("loginPackId"))return this._data.loginPackId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: loginPackId")},getLoginCount:function(){if(this._isKeyFieldAvailable("loginCount"))return this._data.loginCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: loginCount")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getItemCount:function(){if(this._isKeyFieldAvailable("itemCount"))return this._data.itemCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemCount")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],LoginPackService:[function(t,e,i){"use strict";cc._RF.push(e,"51935GfwqZMc6kDgHU6GqqE","LoginPackService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getLoginPack:function(t){this._requestCallApi(n.GET_LOGIN_PACKS,{},function(e,i){return t(e?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],LoginRewardModel:[function(t,e,i){"use strict";cc._RF.push(e,"d3e560bZ/NO5K0KlpAlCIdR","LoginRewardModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLoginBonusId:function(){if(this._isKeyFieldAvailable("loginBonusId"))return this._data.loginBonusId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: loginBonusId")},getLoginCount:function(){if(this._isKeyFieldAvailable("loginCount"))return this._data.loginCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: loginCount")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getAmount:function(){if(this._isKeyFieldAvailable("amount"))return this._data.amount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: amount")},getItemType2:function(){if(this._isKeyFieldAvailable("itemType2"))return this._data.itemType2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType2")},getItemId2:function(){if(this._isKeyFieldAvailable("itemId2"))return this._data.itemId2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId2")},getAmount2:function(){if(this._isKeyFieldAvailable("amount2"))return this._data.amount2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: amount2")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],LoopRollView:[function(t,e,i){"use strict";cc._RF.push(e,"f4c59Z6TqdNaZtb7O6fIuM5","LoopRollView");t("CommonButton");var a=t("RollView");cc.Class({extends:a,properties:{autoLoopRollSecond:0},onLoad:function(){this.init(),this.initBase(),this.initLoopRollView()},initLoopRollView:function(){this.pagingWidth<=0&&(this.pagingWidth=this.node.width),this._startAutoLoopRoll(),this._setIndicator()},getSelectedNo:function(){var t=this._viewX+this.pagingWidth*this.content.childrenCount,e=0;return(e=parseInt(t%this.pagingWidth)<this.pagingWidth/2?t/this.pagingWidth:t/this.pagingWidth+1)<0&&(e+=this.content.childrenCount+.5),e>=this.content.childrenCount-1&&(e%=this.content.childrenCount),parseInt(Math.min(Math.max(parseInt(e),0),this.content.childrenCount-1))},setSelectedNoMove:function(t){if(!this._bMove){var e=this.content.children[t].getPosition();1<this.content.childrenCount&&(e.x<0?(this._bMoveTo=!0,this._iMoveX+=e.x):this.pagingWidth<=e.x+1&&(this._bMoveTo=!0,this._iMoveX-=-e.x),this._stopAutoLoopRoll())}},_startAutoLoopRoll:function(){this.content.childrenCount<=1||this.autoLoopRollSecond>=1&&this.schedule(this.moveToRight,this.autoLoopRollSecond)},_stopAutoLoopRoll:function(){this.unschedule(this.moveToRight)},moveToLeft:function(){1<this.content.childrenCount&&(this._bMoveTo=!0,this._iMoveX-=this.pagingWidth,this._stopAutoLoopRoll())},moveToRight:function(){1<this.content.childrenCount&&(this._bMoveTo=!0,this._iMoveX+=this.pagingWidth,this._stopAutoLoopRoll())},_adjustContent:function(){var t=parseInt(this._viewX)%this.pagingWidth;if(0!==t){(this._bSwipeRight?this.pagingWidth-t<this.pagingWidth/4:!(t<this.pagingWidth/4))?this._viewX+=(this.pagingWidth-t)/4:this._viewX-=t/4}},_drawContent:function(){var t=this.pagingWidth*this.content.childrenCount;this._viewX<0&&(this._viewX+=t),this._viewX=this._viewX%t;for(var e=0;e<this.content.childrenCount;e++){var i=Math.floor(this._viewX-e*this.pagingWidth);i>t/2&&(i-=t),i<-t/2&&(i+=t),this.content.children[e].setPosition(cc.v2(-i,0))}},_adjustContentMoveTo:function(){this._super(),0===Math.abs(this._iMoveX)&&this._startAutoLoopRoll()},_adjustContentEasingTo:function(){var t=parseInt(this._iMoveX/this.movementFrame);this._iMoveX=this._iMoveX-t,this._viewX+=t,Math.abs(this._iMoveX)<this.pagingWidth/10&&(this._iMoveX=0,this._bMoveTo=!1,this._startAutoLoopRoll())},_touchStartEvent:function(t){this._super(),this._stopAutoLoopRoll()},_touchEndEvent:function(t){var e=this.node.convertToNodeSpace(t.getStartLocation()),i=this.node.convertToNodeSpace(t.getLocation());this._bSwipeRight=i.x-e.x>0,this._startAutoLoopRoll()}});cc._RF.pop()},{CommonButton:"CommonButton",RollView:"RollView"}],MaintenanceRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"7abc3AG6pRG/pF82pQVHRzs","MaintenanceRootUtils"),e.exports={openMaintenanceSubRoot:function(t,e){cc.log("openMaintenanceSubRoot"),cc.log(e),t.maintenanceSubRoot||(t.maintenanceSubRoot=cc.instantiate(t.maintenanceSubRootPrefab).getComponent("MaintenanceSubRoot"),t.subRootParent.addChild(t.maintenanceSubRoot.node)),t.maintenanceSubRoot.initMaintenanceSubRoot(t,e)},closeMaintenanceSubRoot:function(t,e){cc.log("closeMaintenanceSubRoot"),cc.log(e),t.maintenanceSubRoot&&(t.maintenanceSubRoot.node.destroy(),t.maintenanceSubRoot=null)}},cc._RF.pop()},{}],MaintenanceRoot:[function(t,e,i){"use strict";cc._RF.push(e,"84acaNYeHNB2qH4eBD3fj/W","MaintenanceRoot");var a=t("OutGameRootBase"),n=t("MaintenanceViewSetting"),o=t("Singleton"),r=t("LocalDataConst");cc.Class({extends:a,properties:{maintenanceSubRootPrefab:cc.Prefab},_gachaData:null,onLoad:function(){cc.log("onLoad base"),this._addBG(),this._addBand(),this._setTapEffect()},initData:function(){o.localData[r.REQUEST_API_DEL_LIST].forEach(function(t){o.localData[r.REQUEST_API_LIST].forEach(function(e,i){t===e&&o.localData[r.REQUEST_API_LIST].splice(i,1)})})},initResource:function(){},initialize:function(){this._initOpenFirstView({MaintenanceSubRoot:{}})},updateChild:function(){},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,n.MAINTENANCE_SETTING)}});cc._RF.pop()},{LocalDataConst:"LocalDataConst",MaintenanceViewSetting:"MaintenanceViewSetting",OutGameRootBase:"OutGameRootBase",Singleton:"Singleton"}],MaintenanceSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"fa3e9uJvlVKhJBo8XYKUdKm","MaintenanceSubRoot");var a=t("TimeUtils");cc.Class({extends:cc.Component,properties:{endTimeParentNode:cc.Node,endTimeLabel:cc.Label,messageLabel:cc.Label},initMaintenanceSubRoot:function(t,e){""===e.endDate?this.endTimeParentNode.active=!1:"99991231235959"===e.endDate?(this.endTimeParentNode.active=!0,this.endTimeLabel.string="\u672a\u5b9a"):(this.endTimeParentNode.active=!0,this.endTimeLabel.string=a.parseTimeToYmdhm(e.endDate)),this.messageLabel.string=e.text}});cc._RF.pop()},{TimeUtils:"TimeUtils"}],MaintenanceViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"5e0bbND05RE4Z6V+C51gpIU","MaintenanceViewSetting");var a=t("MaintenanceRootUtils");e.exports={MAINTENANCE_SETTING:{MaintenanceSubRoot:{open:a.openMaintenanceSubRoot,close:a.closeMaintenanceSubRoot}}},cc._RF.pop()},{MaintenanceRootUtils:"MaintenanceRootUtils"}],MasterDataApi:[function(t,e,i){"use strict";cc._RF.push(e,"f8da7wsXnhJB4wDTE1kcrEk","MasterDataApi");var a=t("ApiConstants");e.exports={CAMPAIGN:a.CAMPAIGN_GET_MASTER_DATA,CHARACTER:a.CHARACTER_GET_MASTER_DATA,CHARACTER_TEXT:a.CHARACTER_TEXT_GET_MASTER_DATA,CHARACTER_TEXT2:a.CHARACTER_TEXT_GET_MASTER_DATA2,CHARACTER_TEXT3:a.CHARACTER_TEXT_GET_MASTER_DATA3,CHARACTER_SKILL:a.CHARACTER_SKILL_GET_MASTER_DATA,CHARACTER_SKILL_EFFECT:a.CHARACTER_SKILL_EFFECT_GET_MASTER_DATA,CHARACTER_SKILL_EFFECT2:a.CHARACTER_SKILL_EFFECT_GET_MASTER_DATA2,CHARACTER_ABILITY:a.CHARACTER_ABILITY_GET_MASTER_DATA,CHARACTER_ABILITY_EFFECT:a.CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA,CHARACTER_ABILITY_EFFECT2:a.CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA2,CHARACTER_ABILITY_EFFECT3:a.CHARACTER_ABILITY_EFFECT_GET_MASTER_DATA3,USER:a.USER_GET_MASTER_DATA,QUEST:a.QUEST_GET_MASTER_DATA,SHOP:a.SHOP_GET_MASTER_DATA,PRESENT:a.PRESENT_GET_MASTER_DATA,ITEM:a.ITEM_GET_MASTER_DATA,MISSION:a.MISSION_GET_MASTER_DATA,EQUIPMENT:a.EQUIPMENT_GET_MASTER_DATA,ROOM:a.ROOM_GET_MASTER_DATA,PVP:a.PVP_GET_MASTER_DATA,TOWER:a.TOWER_GET_MATER_DATA,STORY:a.STORY_GET_MASTER_DATA,PAYMENT:a.PAYMENT_DMM_GET_MASTER_DATA,EVENT:a.EVENT_GET_MASTER_DATA,RAID:a.RAID_GET_MASTER_DATA,LOGIN_BONUS:a.LOGIN_BONUS_GET_MASTER_DATA,LOGIN_PACK:a.LOGIN_PACK_GET_MASTER_DATA,TUTORIAL:a.TUTORIAL_GET_MASTER_DATA,MINIGAME:a.MINIGAME_GET_MASTER_DATA},cc._RF.pop()},{ApiConstants:"ApiConstants"}],MasterDataConstants:[function(t,e,i){"use strict";cc._RF.push(e,"dcce0Hc0rpHLJbiN6t4tFdP","MasterDataConstants"),e.exports={DATA_TYPE:{CAMPAIGN:"CAMPAIGN",CHARACTER:"CHARACTER",CHARACTER_TEXT:"CHARACTER_TEXT",CHARACTER_TEXT2:"CHARACTER_TEXT2",CHARACTER_TEXT3:"CHARACTER_TEXT3",CHARACTER_SKILL:"CHARACTER_SKILL",CHARACTER_SKILL_EFFECT:"CHARACTER_SKILL_EFFECT",CHARACTER_SKILL_EFFECT2:"CHARACTER_SKILL_EFFECT2",CHARACTER_ABILITY:"CHARACTER_ABILITY",CHARACTER_ABILITY_EFFECT:"CHARACTER_ABILITY_EFFECT",CHARACTER_ABILITY_EFFECT2:"CHARACTER_ABILITY_EFFECT2",CHARACTER_ABILITY_EFFECT3:"CHARACTER_ABILITY_EFFECT3",USER:"USER",QUEST:"QUEST",SHOP:"SHOP",PRESENT:"PRESENT",ITEM:"ITEM",EQUIPMENT:"EQUIPMENT",MISSION:"MISSION",ROOM:"ROOM",PVP:"PVP",TOWER:"TOWER",STORY:"STORY",PAYMENT:"PAYMENT",EVENT:"EVENT",RAID:"RAID",LOGIN_BONUS:"LOGIN_BONUS",LOGIN_PACK:"LOGIN_PACK",TUTORIAL:"TUTORIAL",MINIGAME:"MINIGAME"},DATA_KEY:{CAMPAIGN:"Campaign",CHARACTER_MAIN:"CharacterMain",CHARACTER_ABILITY_EFFECT:"CharacterAbilityEffect",CHARACTER_ABILITY_EFFECT2:"CharacterAbilityEffect2",CHARACTER_ABILITY_EFFECT3:"CharacterAbilityEffect3",CHARACTER_ABILITY_GROUP:"CharacterAbilityGroup",CHARACTER_ABILITY_MAIN:"CharacterAbilityMain",CHARACTER_ABILITY_UP:"CharacterAbilityUp",CHARACTER_LEVEL:"CharacterLevel",CHARACTER_MATERIAL:"CharacterMaterial",CHARACTER_EXCEED_LIMIT:"CharacterExceedLimit",CHARACTER_SKILL_EFFECT:"CharacterSkillEffect",CHARACTER_SKILL_EFFECT2:"CharacterSkillEffect2",CHARACTER_SKILL_MAIN:"CharacterSkillMain",CHARACTER_GROUP:"CharacterGroup",CHARACTER_SKILL_UP:"CharacterSkillUp",CHARACTER_SKILL_UP_RATE:"CharacterSkillUpRate",CHARACTER_NORMAL_ATTACK:"CharacterNormalAttack",CHARACTER_CONTENTS:"CharacterContents",CHARACTER_FAVORITE:"CharacterFavorite",CHARACTER_TEXT:"CharacterText",CHARACTER_TEXT2:"CharacterText2",CHARACTER_TEXT3:"CharacterText3",USER_MAIN:"UserMain",USER_HOW_TO_PLAY:"UserHowToPlay",USER_HELP:"UserHelp",USER_BUFF_HELP:"UserBuffHelp",USER_PROGRESS:"UserProgress",MY_PAGE_BANNER:"MyPageBanner",MY_PAGE_EVENT:"MyPageEvent",MY_PAGE_MAIN:"MyPageMain",MY_PAGE_NEWS:"MyPageNews",LOADING_MAIN:"LoadingMain",LOADING_CHARACTER:"LoadingCharacter",LOADING_TIPS:"LoadingTips",QUEST_WORLD:"QuestWorld",QUEST_AREA:"QuestArea",QUEST_STAGE:"QuestStage",QUEST_ACHIEVE:"QuestAchieve",QUEST_DROP:"QuestDrop",QUEST_EVENT_POINT:"QuestEventPoint",SHOP_MAIN:"ShopMain",SHOP_DETAIL:"ShopDetail",PRESENT_MESSAGE:"PresentMessage",ITEM_MAIN:"ItemMain",ITEM_SET:"ItemSet",ITEM_RECIPE:"ItemRecipe",ITEM_CATEGORY:"ItemCategory",ITEM_SELECT:"ItemSelect",ITEM_QUEST_LOCK:"ItemQuestLock",ITEM_AP_RECOVERY_GEM:"ItemApRecoveryGem",EQUIPMENT_MAIN:"EquipmentMain",EQUIPMENT_EFFECT:"EquipmentEffect",EQUIPMENT_LEVEL:"EquipmentLevel",EQUIPMENT_EXCEED_LIMIT:"EquipmentExceedLimit",EQUIPMENT_MATERIAL:"EquipmentMaterial",MISSION_MAIN:"MissionMain",MISSION_DETAIL:"MissionDetail",MISSION_REWARD:"MissionReward",ROOM_MAIN:"RoomMain",ROOM_CHARACTER_FRAME:"RoomCharacterFrame",FURNITURE_MAIN:"FurnitureMain",FURNITURE_COST:"FurnitureCost",FURNITURE_COLLECT:"FurnitureCollect",FURNITURE_CATEGORY:"FurnitureCategory",FURNITURE_TYPE:"FurnitureType",EXCHANGE_MAIN:"ExchangeMain",EXCHANGE_POINT_DETAIL:"ExchangePointDetail",EXCHANGE_ITEM_DETAIL:"ExchangeItemDetail",PVP_MAIN:"PvPMain",PVP_CLASS:"PvPClass",PVP_CLASS_REWARD:"PvPClassReward",TOWER_MAIN:"TowerMain",TOWER_REWARD:"TowerReward",TOWER_REWARD_GROUP:"TowerRewardGroup",STORY_CATEGORY:"StoryCategory",STORY_GROUP:"StoryGroup",STORY_QUEST:"StoryQuest",STORY_EVENT:"StoryEvent",STORY_OTHER:"StoryOther",STORY_ROOM:"StoryRoom",STORY_VOICE:"StoryVoice",STORY_TUTORIAL:"StoryTutorial",STORY_PICTURE_BOOK:"StoryPictureBook",PAYMENT_DMM:"Dmm",EVENT_MAIN:"EventMain",EVENT_ITEM:"EventItem",EVENT_CHARACTER:"EventCharacter",EVENT_BOOST_CHARACTER:"EventBoostCharacter",EVENT_BOOST_EFFECT:"EventBoostEffect",EVENT_HELP:"EventHelp",EVENT_POINT_REWARD:"EventPointReward",RAID_BATTLE:"RaidBattle",RAID_BATTLE_TYPE:"RaidBattleType",RAID_REWARD:"RaidReward",RAID_REWARD_GROUP:"RaidRewardGroup",LOGIN_BONUS_MAIN:"LoginBonusMain",LOGIN_BONUS_REWARD:"LoginBonusReward",LOGIN_PACK_MAIN:"LoginPackMain",LOGIN_PACK_REWARD:"LoginPackReward",TUTORIAL_MAIN_STEP:"TutorialMainStep",TUTORIAL_SUB_STEP:"TutorialSubStep",TUTORIAL_EVENT:"TutorialEvent",MINIGAME_MAIN:"MinigameMain",MINIGAME_CHARACTER_MAIN:"MinigameCharacterMain",MINIGAME_CHARACTER_TEXT:"MinigameCharacterText"},DATA_MODEL:{Campaign:"CampaignModel",CharacterMain:"CharacterMainModel",CharacterAbilityGroup:"CharacterAbilityGroupModel",CharacterAbilityEffect:"CharacterAbilityEffectModel",CharacterAbilityEffect2:"CharacterAbilityEffectModel",CharacterAbilityEffect3:"CharacterAbilityEffectModel",CharacterAbilityMain:"CharacterAbilityMainModel",CharacterAbilityUp:"CharacterAbilityUpModel",CharacterLevel:"CharacterLevelModel",CharacterMaterial:"CharacterMaterialModel",CharacterExceedLimit:"CharacterExceedLimitModel",CharacterSkillEffect:"CharacterSkillEffectModel",CharacterSkillEffect2:"CharacterSkillEffectModel",CharacterSkillMain:"CharacterSkillMainModel",CharacterGroup:"CharacterGroupModel",CharacterSkillUp:"CharacterSkillUpModel",CharacterSkillUpRate:"CharacterSkillUpRateModel",CharacterNormalAttack:"CharacterNormalAttackModel",CharacterContents:"CharacterContentsModel",CharacterFavorite:"CharacterFavoriteModel",CharacterText:"CharacterTextModel",CharacterText2:"CharacterTextModel",CharacterText3:"CharacterTextModel",UserMain:"UserMainModel",UserHowToPlay:"UserHowToPlayModel",UserHelp:"UserHelpModel",UserBuffHelp:"UserBuffHelpModel",UserProgress:"UserProgressModel",MyPageBanner:"MyPageBannerModel",MyPageEvent:"MyPageEventModel",MyPageMain:"MyPageMainModel",MyPageNews:"MyPageNewsModel",LoadingMain:"LoadingMainModel",LoadingCharacter:"LoadingCharacterModel",LoadingTips:"LoadingTipsModel",QuestWorld:"QuestWorldModel",QuestArea:"QuestAreaModel",QuestStage:"QuestStageModel",QuestAchieve:"QuestAchieveModel",QuestDrop:"QuestDropModel",QuestEventPoint:"QuestEventPointModel",ShopMain:"ShopMainModel",ShopDetail:"ShopDetailModel",PresentMessage:"PresentMessageModel",ItemMain:"ItemMainModel",ItemSet:"ItemSetModel",ItemRecipe:"ItemRecipeModel",ItemCategory:"ItemCategoryModel",ItemSelect:"ItemSelectModel",ItemQuestLock:"ItemQuestLockModel",ItemApRecoveryGem:"ItemApRecoveryGemModel",EquipmentMain:"EquipmentMainModel",EquipmentEffect:"EquipmentEffectModel",EquipmentLevel:"EquipmentLevelModel",EquipmentExceedLimit:"EquipmentExceedLimitModel",EquipmentMaterial:"EquipmentMaterialModel",MissionMain:"MissionMainModel",MissionDetail:"MissionDetailModel",MissionReward:"MissionRewardModel",RoomMain:"RoomMainModel",RoomCharacterFrame:"RoomCharacterFrameModel",FurnitureMain:"FurnitureMainModel",FurnitureCost:"FurnitureCostModel",FurnitureCollect:"FurnitureCollectModel",FurnitureCategory:"FurnitureCategoryModel",FurnitureType:"FurnitureTypeModel",ExchangeMain:"ExchangeMainModel",ExchangePointDetail:"ExchangePointDetailModel",ExchangeItemDetail:"ExchangeItemDetailModel",PvPMain:"PvPMainModel",PvPClass:"PvPClassModel",PvPClassReward:"PvPClassRewardModel",TowerMain:"TowerMainModel",TowerReward:"TowerRewardModel",TowerRewardGroup:"TowerRewardGroupModel",StoryCategory:"StoryCategoryModel",StoryGroup:"StoryGroupModel",StoryQuest:"StoryQuestModel",StoryEvent:"StoryEventModel",StoryOther:"StoryOtherModel",StoryRoom:"StoryRoomModel",StoryVoice:"StoryVoiceModel",StoryTutorial:"StoryTutorialModel",StoryPictureBook:"StoryPictureBookModel",Dmm:"DmmModel",EventMain:"EventMainModel",EventItem:"EventItemModel",EventCharacter:"EventCharacterModel",EventBoostCharacter:"EventBoostCharacterModel",EventBoostEffect:"EventBoostEffectModel",EventHelp:"EventHelpModel",EventPointReward:"EventPointRewardModel",RaidBattle:"RaidBattleModel",RaidBattleType:"RaidBattleTypeModel",RaidReward:"RaidRewardModel",RaidRewardGroup:"RaidRewardGroupModel",LoginBonusMain:"LoginBonusModel",LoginBonusReward:"LoginRewardModel",LoginPackMain:"LoginPackMainModel",LoginPackReward:"LoginPackRewardModel",TutorialMainStep:"TutorialMainStepModel",TutorialSubStep:"TutorialSubStepModel",TutorialEvent:"TutorialEventModel",MinigameMain:"MinigameMainModel",MinigameCharacterMain:"MinigameCharacterMainModel",MinigameCharacterText:"MinigameCharacterTextModel"},MODEL_SUFFIX:"Masters"},cc._RF.pop()},{}],MasterDataLoadKeys:[function(t,e,i){"use strict";cc._RF.push(e,"172027MqQtGG6T1eB5mUycB","MasterDataLoadKeys");var a=t("MasterDataConstants");e.exports={CHARACTER:[{key:a.DATA_KEY.CHARACTER_MAIN},{key:a.DATA_KEY.CHARACTER_LEVEL},{key:a.DATA_KEY.CHARACTER_MATERIAL},{key:a.DATA_KEY.CHARACTER_EXCEED_LIMIT},{key:a.DATA_KEY.CHARACTER_GROUP},{key:a.DATA_KEY.CHARACTER_NORMAL_ATTACK},{key:a.DATA_KEY.CHARACTER_CONTENTS},{key:a.DATA_KEY.CHARACTER_FAVORITE}],CHARACTER_TEXT:[{key:a.DATA_KEY.CHARACTER_TEXT,kind:"add"}],CHARACTER_TEXT2:[{key:a.DATA_KEY.CHARACTER_TEXT2,kind:"add",name:"CharacterText"}],CHARACTER_TEXT3:[{key:a.DATA_KEY.CHARACTER_TEXT3,kind:"add",name:"CharacterText"}],CHARACTER_SKILL:[{key:a.DATA_KEY.CHARACTER_SKILL_MAIN},{key:a.DATA_KEY.CHARACTER_SKILL_UP},{key:a.DATA_KEY.CHARACTER_SKILL_UP_RATE}],CHARACTER_SKILL_EFFECT:[{key:a.DATA_KEY.CHARACTER_SKILL_EFFECT,kind:"add"}],CHARACTER_SKILL_EFFECT2:[{key:a.DATA_KEY.CHARACTER_SKILL_EFFECT2,kind:"add",name:"CharacterSkillEffect"}],CHARACTER_ABILITY:[{key:a.DATA_KEY.CHARACTER_ABILITY_GROUP},{key:a.DATA_KEY.CHARACTER_ABILITY_MAIN},{key:a.DATA_KEY.CHARACTER_ABILITY_UP}],CHARACTER_ABILITY_EFFECT:[{key:a.DATA_KEY.CHARACTER_ABILITY_EFFECT,kind:"add"}],CHARACTER_ABILITY_EFFECT2:[{key:a.DATA_KEY.CHARACTER_ABILITY_EFFECT2,kind:"add",name:"CharacterAbilityEffect"}],CHARACTER_ABILITY_EFFECT3:[{key:a.DATA_KEY.CHARACTER_ABILITY_EFFECT3,kind:"add",name:"CharacterAbilityEffect"}],ITEM:[{key:a.DATA_KEY.ITEM_MAIN},{key:a.DATA_KEY.ITEM_SET},{key:a.DATA_KEY.ITEM_RECIPE},{key:a.DATA_KEY.ITEM_CATEGORY},{key:a.DATA_KEY.ITEM_SELECT},{key:a.DATA_KEY.ITEM_QUEST_LOCK},{key:a.DATA_KEY.ITEM_AP_RECOVERY_GEM}],PRESENT:[{key:a.DATA_KEY.PRESENT_MESSAGE}],EQUIPMENT:[{key:a.DATA_KEY.EQUIPMENT_MAIN},{key:a.DATA_KEY.EQUIPMENT_MATERIAL},{key:a.DATA_KEY.EQUIPMENT_LEVEL},{key:a.DATA_KEY.EQUIPMENT_EXCEED_LIMIT},{key:a.DATA_KEY.EQUIPMENT_EFFECT}],USER:[{key:a.DATA_KEY.USER_MAIN},{key:a.DATA_KEY.USER_HOW_TO_PLAY},{key:a.DATA_KEY.USER_HELP},{key:a.DATA_KEY.USER_BUFF_HELP},{key:a.DATA_KEY.USER_PROGRESS},{key:a.DATA_KEY.MY_PAGE_BANNER},{key:a.DATA_KEY.MY_PAGE_EVENT},{key:a.DATA_KEY.MY_PAGE_MAIN},{key:a.DATA_KEY.MY_PAGE_NEWS},{key:a.DATA_KEY.LOADING_MAIN},{key:a.DATA_KEY.LOADING_CHARACTER},{key:a.DATA_KEY.LOADING_TIPS}],QUEST:[{key:a.DATA_KEY.QUEST_WORLD},{key:a.DATA_KEY.QUEST_AREA},{key:a.DATA_KEY.QUEST_STAGE},{key:a.DATA_KEY.QUEST_ACHIEVE},{key:a.DATA_KEY.QUEST_DROP},{key:a.DATA_KEY.QUEST_EVENT_POINT}],MISSION:[{key:a.DATA_KEY.MISSION_MAIN},{key:a.DATA_KEY.MISSION_REWARD},{key:a.DATA_KEY.MISSION_DETAIL}],SHOP:[{key:a.DATA_KEY.SHOP_MAIN},{key:a.DATA_KEY.SHOP_DETAIL},{key:a.DATA_KEY.EXCHANGE_MAIN},{key:a.DATA_KEY.EXCHANGE_POINT_DETAIL},{key:a.DATA_KEY.EXCHANGE_ITEM_DETAIL}],BANNER:[{key:a.DATA_KEY.BANNER}],LOGIN_BONUS:[{key:a.DATA_KEY.LOGIN_BONUS_MAIN},{key:a.DATA_KEY.LOGIN_BONUS_REWARD}],LOGIN_PACK:[{key:a.DATA_KEY.LOGIN_PACK_MAIN},{key:a.DATA_KEY.LOGIN_PACK_REWARD}],VERSION:[{key:a.DATA_KEY.VERSION}],EXCHANGE:[{key:a.DATA_KEY.EXCHANGE_MAIN},{key:a.DATA_KEY.EXCHANGE_POINT_DETAIL},{key:a.DATA_KEY.EXCHANGE_ITEM_DETAIL}],ROOM:[{key:a.DATA_KEY.ROOM_MAIN},{key:a.DATA_KEY.ROOM_CHARACTER_FRAME},{key:a.DATA_KEY.FURNITURE_MAIN},{key:a.DATA_KEY.FURNITURE_COST},{key:a.DATA_KEY.FURNITURE_COLLECT},{key:a.DATA_KEY.FURNITURE_CATEGORY},{key:a.DATA_KEY.FURNITURE_TYPE}],PVP:[{key:a.DATA_KEY.PVP_MAIN},{key:a.DATA_KEY.PVP_CLASS},{key:a.DATA_KEY.PVP_CLASS_REWARD}],TOWER:[{key:a.DATA_KEY.TOWER_MAIN},{key:a.DATA_KEY.TOWER_REWARD},{key:a.DATA_KEY.TOWER_REWARD_GROUP}],STORY:[{key:a.DATA_KEY.STORY_CATEGORY},{key:a.DATA_KEY.STORY_GROUP},{key:a.DATA_KEY.STORY_QUEST},{key:a.DATA_KEY.STORY_EVENT},{key:a.DATA_KEY.STORY_OTHER},{key:a.DATA_KEY.STORY_ROOM},{key:a.DATA_KEY.STORY_PICTURE_BOOK},{key:a.DATA_KEY.STORY_VOICE},{key:a.DATA_KEY.STORY_TUTORIAL}],PAYMENT:[{key:a.DATA_KEY.PAYMENT_DMM}],EVENT:[{key:a.DATA_KEY.EVENT_MAIN},{key:a.DATA_KEY.EVENT_ITEM},{key:a.DATA_KEY.EVENT_CHARACTER},{key:a.DATA_KEY.EVENT_BOOST_CHARACTER},{key:a.DATA_KEY.EVENT_BOOST_EFFECT},{key:a.DATA_KEY.EVENT_HELP},{key:a.DATA_KEY.EVENT_POINT_REWARD}],RAID:[{key:a.DATA_KEY.RAID_BATTLE},{key:a.DATA_KEY.RAID_BATTLE_TYPE},{key:a.DATA_KEY.RAID_REWARD},{key:a.DATA_KEY.RAID_REWARD_GROUP}],CAMPAIGN:[{key:a.DATA_KEY.CAMPAIGN}],TUTORIAL:[{key:a.DATA_KEY.TUTORIAL_MAIN_STEP},{key:a.DATA_KEY.TUTORIAL_SUB_STEP},{key:a.DATA_KEY.TUTORIAL_EVENT}],MINIGAME:[{key:a.DATA_KEY.MINIGAME_MAIN},{key:a.DATA_KEY.MINIGAME_CHARACTER_MAIN},{key:a.DATA_KEY.MINIGAME_CHARACTER_TEXT}]},cc._RF.pop()},{MasterDataConstants:"MasterDataConstants"}],MasterDatabase:[function(t,e,i){"use strict";cc._RF.push(e,"d693fp4UqFIq5mSrjzp+C9D","MasterDatabase");var a=t("Singleton"),n=t("SingletonConst");cc.Class({ctor:function(){var t=arguments[0];null===t&&a[n.ERROR_MANAGER].throwError(void 0,void 0,void 0,"invalid to construct :: data null"),this._data=t},_isKeyFieldAvailable:function(t){return this._data.hasOwnProperty(t)}});cc._RF.pop()},{Singleton:"Singleton",SingletonConst:"SingletonConst"}],MaterialCharacterInfoView:[function(t,e,i){"use strict";cc._RF.push(e,"61904KhRipDMJwxfoU1lnhA","MaterialCharacterInfoView");var a=t("CommonButton"),n=(t("ResourceUtils"),t("CharacterUtils")),o=t("CharacterConst");cc.Class({extends:cc.Component,properties:{mainNameLabel:cc.Label,skinNameLabel:cc.Label,characterThumbnailPrefab:cc.Prefab,characterThumbnailParentNode:cc.Node,characterLevelProgressViewPrefab:cc.Prefab,characterLevelProgressViewParentNode:cc.Node,characterExceedLimitProgressViewPrefab:cc.Prefab,characterExceedLimitProgressViewParentNode:cc.Node,infoBtn:a},_root:null,_characterModel:null,_characterThumbnail:null,_characterLevelProgressView:null,_characterExceedLimitProgressView:null,onLoad:function(){this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),"")},initMaterialCharacterInfoView:function(t,e){this._root=t,this._addCharacterThumbnail(),this._addLevelProgressView(),this._addExceedLimitProgressView(),this.drawMaterialCharacterInfoView(e)},drawMaterialCharacterInfoView:function(t){this._characterModel=t,this._characterModel?this._setMaterialCharacterInfo():this._setNoMaterialCharacterInfo()},_setInfoButton:function(t){this.infoBtn.transition=t?cc.Button.Transition.NONE:cc.Button.Transition.COLOR,this.infoBtn.interactable=t,this.infoBtn.setTouchEnable(t)},_setMaterialCharacterInfo:function(){this.mainNameLabel.node.parent.opacity=0,this.mainNameLabel.node.parent.runAction(cc.fadeIn(.3)),this.mainNameLabel.string=this._characterModel.getShortName(),this.skinNameLabel.string="["+this._characterModel.getSkinName()+"]",this._addCharacterThumbnail(),this._characterThumbnail.initCharacterMatrixThumbnail(this._characterModel.getCharacterMainMaster(),this._characterModel.getExceedLimit(),this._characterModel.getLevel(),1),this.characterLevelProgressViewParentNode.active=!0,this.characterExceedLimitProgressViewParentNode.active=!0,this.drawLevelProgress(o.PROMOTE_TYPE.STATUS,[]),this._setInfoButton(this._characterModel.getCharacterMainMaster().getCharacterType()===o.CHARACTER_TYPE.NORMAL)},_setNoMaterialCharacterInfo:function(){this.mainNameLabel.node.parent.opacity=0,this.mainNameLabel.node.parent.runAction(cc.fadeIn(.3)),this.mainNameLabel.string="\u672a\u9078\u629e",this.skinNameLabel.string="",this._addCharacterThumbnail(),this._characterThumbnail.initPlainMatrixThumbnail(),this.characterLevelProgressViewParentNode.active=!1,this.characterExceedLimitProgressViewParentNode.active=!1,this._setInfoButton(!1)},_addCharacterThumbnail:function(){this.characterThumbnailParentNode.destroyAllChildren(),this._characterThumbnail=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.characterThumbnailParentNode.addChild(this._characterThumbnail.node)},_addLevelProgressView:function(){this._characterLevelProgressView||(this._characterLevelProgressView=cc.instantiate(this.characterLevelProgressViewPrefab).getComponent("CharacterLevelProgressView"),this.characterLevelProgressViewParentNode.addChild(this._characterLevelProgressView.node))},drawLevelProgress:function(t,e){t||(t=o.PROMOTE_TYPE.STATUS);var i=this._characterModel.getLevel(),a=this._characterModel.getLevel(),r=this._characterModel.getMaxLevel(),s=this._characterModel.getMaxLevel(),c=this._characterModel.getNeedExpForNextLevel(),l=this._characterModel.getExpRateForNextLevel(),u=0,h=0;if(Array.isArray(e)&&e.length>0)switch(t){case o.PROMOTE_TYPE.FORTIFY:var d=this._characterModel.getCharacterExp()+n.calcTotalMaterialExp(e,this._characterModel);c=(a=Math.min(n.getCharacterLevelByTotalExp(d,this._characterModel.getCharacterMainMaster().getExpType()),this._characterModel.getMaxLevel()))!==this._characterModel.getMaxLevel()?n.calcNeedExpForNextLevelByTotalExp(d,this._characterModel.getCharacterMainMaster().getExpType()):0,s=0,u=a>this._characterModel.getLevel()?1:n.calcExpRateForNextLevelByTotalExp(d,this._characterModel.getCharacterMainMaster().getExpType());break;case o.PROMOTE_TYPE.EXCEED_LIMIT:h=e.length,s=this._characterModel.getMaxLevelByExceedLimit(this._characterModel.getExceedLimit()+h)}this._characterLevelProgressView.initCharacterLevelProgressView(t,i,a,r,s,c,l,u),this.drawCharacterExceedLimitProgressView(h)},_addExceedLimitProgressView:function(){this._characterExceedLimitProgressView||(this._characterExceedLimitProgressView=cc.instantiate(this.characterExceedLimitProgressViewPrefab).getComponent("CharacterExceedLimitProgressView"),this.characterExceedLimitProgressViewParentNode.addChild(this._characterExceedLimitProgressView.node))},drawCharacterExceedLimitProgressView:function(t){var e=t||0;this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(this._characterModel.getExceedLimit(),this._characterModel.getExceedLimit()+e,this._characterModel.getExceedLimitMaxCount())},_onTapInfoBtn:function(){this._root.openPromoteCharacterDetailPopup(this._characterModel)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],MatrixConfig:[function(t,e,i){"use strict";cc._RF.push(e,"8865aUk0vpN1oSMQ0uxk2ZF","MatrixConfig");cc.Class({countX:0,countY:0,startX:0,startY:0,spaceX:0,spaceY:0,ctor:function(){this.countX=parseInt(arguments[0]),this.countY=parseInt(arguments[1]),this.startX=parseInt(arguments[2]),this.startY=parseInt(arguments[3]),this.spaceX=parseInt(arguments[4]),this.spaceY=parseInt(arguments[5])}});cc._RF.pop()},{}],MatrixMultipleSelectCountUpPageView:[function(t,e,i){"use strict";cc._RF.push(e,"4987cVT2bVPhp1DROUcP8uw","MatrixMultipleSelectCountUpPageView");var a=t("MatrixPageViewBase"),n=cc.Enum({NONE:0,RESET:1});cc.Class({extends:a,properties:{},_findModelGetterName:null,_countModelGetterName:null,_countInfoArray:null,_checkLimit:null,_countDownType:n.NONE,initMatrixPageView:function(t,e,i,a,o,r,s,c){this._countDownType||(this._countDownType=n.NONE),this._findModelGetterName=t,this._countModelGetterName=e,this._countInfoArray=o.slice(),this._checkLimit=r,this._super(i,a,s,c)},setCountDownType:function(t){this._countDownType=t},_resetData:function(){this._currentIndex=0,this.clearCountInfoArray()},_initMatrixThumbnail:function(t,e,i,a){t.setSelectedOrder(this._getCheckedOrder(e)),t.setActive(this._isImageActive(e)),this._isThumbnailTouchEnabled(e)?t.setCallbackToThumbnailBtn(function(){this._isThumbnailTouchEnabled(e)&&(this._countUpOrRemove(e),t.setSelectedOrder(this._getCheckedOrder(e)),t.setActive(this._isImageActive(e)),this._drawNumeLabel(),this._currentListContent=this._createListContent(this.getPageIndex(),!1),this._callbackThumbnail&&this._callbackThumbnail(e,this._countInfoArray))}.bind(this)):t.setCallbackToThumbnailBtn()},_drawNumeLabel:function(){this.numeLabel&&Array.isArray(this._countInfoArray)&&(this.numeLabel.string=""+this._getCurrentSelectCount())},_drawDenomLabel:function(t){this.denomLabel&&(this.denomLabel.string=""+this._checkLimit)},_isImageActive:function(t){return!this._callbackIsImageActive||this._callbackIsImageActive(t,this._countInfoArray)},_isThumbnailTouchEnabled:function(t){return!this._callbackIsThumbnailTouchEnabled||this._callbackIsThumbnailTouchEnabled(t,this._countInfoArray)},_createCountInfo:function(t,e){return{model:t,count:e}},clearCountInfoArray:function(){this._countInfoArray=[],this._callbackThumbnail&&this._callbackThumbnail(this._countInfoArray)},getCountInfoArray:function(){return this._countInfoArray},_getCountInfo:function(t){return _.find(this._countInfoArray,function(e){return e.model&&e.model[this._findModelGetterName]()===t[this._findModelGetterName]()}.bind(this))},_getCheckedOrder:function(t){var e=this._getCountInfo(t);return e?e.count:0},_countUpOrRemove:function(t){if(this._getCurrentSelectCount()>=this._checkLimit)switch(this._countDownType){case n.RESET:return this._removeCountInfo(t);default:return}var e=this._getCountInfo(t);return e?e.count>=e.model[this._countModelGetterName]()?this._removeCountInfo(t):void(e.count+=1):this._countInfoArray.push(this._createCountInfo(t,1))},_removeCountInfo:function(t){this._countInfoArray=_.filter(this._countInfoArray,function(e){return e.model&&e.model[this._findModelGetterName]()!==t[this._findModelGetterName]()}.bind(this))},_getCurrentSelectCount:function(){return _.sumBy(this._countInfoArray,function(t){return t.count})}});cc._RF.pop()},{MatrixPageViewBase:"MatrixPageViewBase"}],MatrixMultipleSelectPageView:[function(t,e,i){"use strict";cc._RF.push(e,"1b099SQsLlDeLi4ERug+L1n","MatrixMultipleSelectPageView");var a=t("MatrixPageViewBase");cc.Class({extends:a,properties:{},_findModelGetterName:null,_checkedModelArray:null,_checkLimit:0,initMatrixPageView:function(t,e,i,a,n,o,r){this._findModelGetterName=t,this._checkedModelArray=a.slice(),this._checkLimit=n,this._super(e,i,o,r)},_resetData:function(){this._currentIndex=0,this.clearCheckedModelArray()},_initMatrixThumbnail:function(t,e,i,a){t.setSelectedOrder(this._getCheckedOrder(e)),t.setActive(this._isImageActive(e)),this._isThumbnailTouchEnabled(e)?t.setCallbackToThumbnailBtn(function(){this._isThumbnailTouchEnabled(e)&&(t.setSelectedOrder(this._getCheckedOrder(e)),this._toggleCheck(t,e),this._currentListContent=this._createListContent(this._currentIndex,!1),this._drawNumeLabel(),this._checkLimitGrayOut(),this._callbackThumbnail&&this._callbackThumbnail(this._checkedModelArray))}.bind(this)):t.setCallbackToThumbnailBtn()},_drawNumeLabel:function(){this.numeLabel&&Array.isArray(this._checkedModelArray)&&(this.numeLabel.string=this._checkedModelArray.length)},_drawDenomLabel:function(t){this.denomLabel&&(this.denomLabel.string=this._checkLimit+"")},_isThumbnailTouchEnabled:function(t){return!this._callbackIsThumbnailTouchEnabled||this._callbackIsThumbnailTouchEnabled(t,this._checkedModelArray)},_isImageActive:function(t){return!this._callbackIsImageActive||this._callbackIsImageActive(t,this._checkedModelArray)},_redrawCheck:function(t,e){t.setSelectedOrder(e)},_checkLimitGrayOut:function(){this._checkedModelArray.length>=this._checkLimit-1&&(this._currentListContent=this._createListContent(this.getPageIndex(),!1))},clearCheckedModelArray:function(){this._checkedModelArray=[],this._callbackThumbnail&&this._callbackThumbnail(this._checkedModelArray)},getCheckedModelArray:function(){return this._checkedModelArray},_toggleCheck:function(t,e){var i=this._getFindModelFromCheckedModelArray(e);if(i)this._checkedModelArray=this._checkedModelArray.filter(function(t){return t[this._findModelGetterName]()!==i[this._findModelGetterName]()}.bind(this)),!1;else{if(!(this._checkedModelArray.length<this._checkLimit))return;this._checkedModelArray.push(e),!0}},_getCheckedOrder:function(t){for(var e=-1,i=0;i<this._checkedModelArray.length;i++)if(t[this._findModelGetterName]()===this._checkedModelArray[i][this._findModelGetterName]()){e=i;break}return e+1},_getFindModelFromCheckedModelArray:function(t){return this._checkedModelArray.find(function(e){return e[this._findModelGetterName]()===t[this._findModelGetterName]()}.bind(this))}});cc._RF.pop()},{MatrixPageViewBase:"MatrixPageViewBase"}],MatrixPageViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"330f0H2hatFuLzplduNmWW8","MatrixPageViewBase");var a=t("ListPageView"),n=(t("GameConst"),t("SortButton")),o=(t("ResourceUtils"),t("StaticResourceConst"),t("Singleton"),t("LocalDataConst"),t("AnimationUtils")),r=t("CommonUtils");cc.Class({extends:a,properties:{numeLabel:cc.Label,denomLabel:cc.Label,sortBtn:n},_isPlaySpawnAnim:!1,_currentListContent:null,_sortType:null,_sortOrder:null,_filterCheckList:null,initMatrixPageView:function(t,e,i,a){this._isPlaySpawnAnim=void 0===a||null===a||a,this._initSortButton(),this.setDataList(t),this._drawNumeLabel(),this._drawDenomLabel(e),this.sortAndFilter(),this.initListPageView(this.content,i)},redrawSimply:function(){var t=this._isPlaySpawnAnim;this._isPlaySpawnAnim=!1,this.redraw(),this._isPlaySpawnAnim=t},_resetData:function(){cc.error("_resetPageData()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),this._currentIndex=0},_initMatrixThumbnail:function(t,e){cc.error("_initMatrixThumbnail(matrixThumbnail, data)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")},_drawNumeLabel:function(){cc.error("_drawNumeLabel()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),this.numeLabel},_drawDenomLabel:function(t){cc.error("_drawDenomLabel(maxCount)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),this.denomLabel},_isThumbnailTouchEnabled:function(t){return!this._callbackIsThumbnailTouchEnabled||this._callbackIsThumbnailTouchEnabled(t)},_isImageActive:function(t){return!this._callbackIsImageActive||this._callbackIsImageActive(t)},_initSortButton:function(){this.sortBtn&&this.sortBtn.initSortButton(this._getSortType(),this._getSortOrder(),this._getFilterCheckList(),this._callbackToConvertSortText.bind(this),this._callbackToSetSortOrder.bind(this),this._callbackToOpenSortFilterPopup.bind(this),this._callbackToExecuteSortFilter.bind(this))},_callbackToOpenSortFilterPopup:function(t,e){this._callbackToCreateSortFilterPopup?this._callbackToCreateSortFilterPopup().openSortFilterPopup(this._getSortType(),this._getFilterCheckList(),this._callbackToExecuteSortFilter.bind(this),null):cc.error("\u30bd\u30fc\u30c8/\u30d5\u30a3\u30eb\u30bf\u30fc\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},_callbackToConvertSortText:function(t){return this._setSortType(t),this._callbackConvertSortText?this._callbackConvertSortText(t):""},_callbackToSetSortOrder:function(t){this._setSortOrder(t)},_callbackToExecuteSortFilter:function(t,e){this.sortBtn.setSortType(t),this.sortBtn.setFilterChecklist(e),this.setSortParam(t,this._getSortOrder()),this.setFilterCheckList(e),this._resetData(),this.sortAndFilter(),this.redraw()},setCallBackToThumbnail:function(t){this._callbackThumbnail=t},getCallBackToThumbnail:function(){return this._callbackThumbnail},setCallBackToCreateSortFilterPopup:function(t){this._callbackToCreateSortFilterPopup=t},setCallBackToConvertSortText:function(t){this._callbackConvertSortText=t},setCallBackToThumbnailLong:function(t){this._callbackThumbnailLong=t},setCallBackToCreateSortConditions:function(t){this._callbackCreateSortConditions=t},setCallBackToCreateFilterConditions:function(t){this._callbackCreateFilterConditions=t},setCallBackToSortAndFilter:function(t){this._callbackToSortAndFilter=t},setCallBackToIsThumbnailTouchEnabled:function(t){this._callbackIsThumbnailTouchEnabled=t},setCallBackToIsImageActive:function(t){this._callbackIsImageActive=t},_createListContent:function(t,e){var i=this._getNodeCountMax(),a=this._getPageCountMax();t>=a?t=a-1:t<0&&(t=0),this._pageCountMax=a;var n=t*i,r=n+i,s=[],c=[];this.content.children.forEach(function(t){t.active=!1});for(var l=n;l<r;l++){var u=this.getVisibleDataList()[l],h=this.content.children[l-n];if(h&&u?(this._callbackToCreateThumbnailNode&&this._callbackToCreateThumbnailNode(u,h,l-n,e),h.active=!0,e&&o.recreateSpawnAnimationNode(h,l-n)):!h&&u&&(h=this._createThumbnailNode(u,l-n,e),this.content.addChild(h)),h){if(!u)break;this._handlePageNode(h,u),s.push(h),c.push(u)}}return{nodeArray:s,dataArray:c}},switchPageContent:function(t){this.setPageIndex(t)},_setPageEvent:function(t){this._currentListContent=this._createListContent(t,this._isPlaySpawnAnim)},_handlePageNode:function(t,e){this._initMatrixThumbnailBase(this._findMatrixThumbnail(t),e),this._drawNumeLabel()},_initMatrixThumbnailBase:function(t,e){this._initMatrixThumbnail(t,e),t.setActive(this._isImageActive(e)),this._isThumbnailTouchEnabled(e)&&t.thumbnailBtn.setLongTapEvent(function(){this._callbackThumbnailLong&&this._callbackThumbnailLong(e)}.bind(this))},_createThumbnailNode:function(t,e,i){var a=this._super(t,e,i);return a.name="MatrixThumbnail_"+(e+1),i?o.createSpawnAnimationNode(a,e):a},_findMatrixThumbnail:function(t){var e=t.getComponent("MatrixThumbnailBase");return e||(e=t.getComponentInChildren("MatrixThumbnailBase")),e},sortAndFilter:function(){this._visibleDataList=this._filter(this.getDataList(),this._getFilterCheckList()),this._visibleDataList=this._sort(this.getVisibleDataList(),this._getSortType(),this._getSortOrder()),this._pageCountMax=this._getPageCountMax(),this._callbackToSortAndFilter&&this._callbackToSortAndFilter(this._getSortType(),this._getSortOrder(),this._getFilterCheckList())},setSortParam:function(t,e){this._setSortType(t),this._setSortOrder(e)},_sort:function(t,e,i){var a=this._createSortConditions(e,i);return r.sortModels(t,a)},_createSortConditions:function(t,e){return this._callbackCreateSortConditions?this._callbackCreateSortConditions(t,this._convertSortOrderToText(e)):[]},_getSortType:function(){return null!==this._sortType&&void 0!==this._sortType||(this._sortType=0),this._sortType},_getSortOrder:function(){return null!==this._sortOrder&&void 0!==this._sortOrder||(this._sortOrder=!0),this._sortOrder},_setSortType:function(t){this._sortType=t},_setSortOrder:function(t){this._sortOrder=t},_convertSortOrderToText:function(t){return t?"asc":"desc"},setFilterCheckList:function(t){this._filterCheckList=t},_filter:function(t,e){var i=[];return r.isFilterActive(e)&&(i=this._createFilterConditions(e)),r.filterModels(t,i)},_createFilterConditions:function(t){return this._callbackCreateFilterConditions?this._callbackCreateFilterConditions(t):[]},_getFilterCheckList:function(){return null!==this._filterCheckList&&void 0!==this._filterCheckList||(this._filterCheckList=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]),this._filterCheckList}});cc._RF.pop()},{AnimationUtils:"AnimationUtils",CommonUtils:"CommonUtils",GameConst:"GameConst",ListPageView:"ListPageView",LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SortButton:"SortButton",StaticResourceConst:"StaticResourceConst"}],MatrixSingleSelectPageView:[function(t,e,i){"use strict";cc._RF.push(e,"5524433A6tGcba29MWRdsBj","MatrixSingleSelectPageView");var a=t("MatrixPageViewBase");cc.Class({extends:a,properties:{},_resetData:function(){this._currentIndex=0},_initMatrixThumbnail:function(t,e){t.setCallbackToThumbnailBtn(function(){this._callbackThumbnail&&this._callbackThumbnail(t,e)}.bind(this))},_drawNumeLabel:function(){this.numeLabel&&Array.isArray(this._dataList)&&(this.numeLabel.string=this._dataList.length)},_drawDenomLabel:function(t){this.denomLabel&&(this.denomLabel.string=t+"")}});cc._RF.pop()},{MatrixPageViewBase:"MatrixPageViewBase"}],MatrixThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"bc8bfHC6HBFirfoAzb0vFzE","MatrixThumbnailBase");cc.Class({extends:cc.Component,properties:{},setSelectedNodeActive:function(t){cc.error("setSelectedNodeActive(b)\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},setSelectedOrder:function(t){cc.error("setSelectedOrder(b)\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},setActive:function(t){cc.error("setActive(b)\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},setProtected:function(t){cc.error("setProtected(b)\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},getProtected:function(){return cc.error("getProtected()\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),!1},playPopAnim:function(t){cc.error("playPopAnim(callback)\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},setCallbackToThumbnailBtn:function(t){cc.error("setCallbackToThumbnailBtn(callFunc)\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")}});cc._RF.pop()},{}],MatrixThumbnailUtils:[function(t,e,i){"use strict";cc._RF.push(e,"7a4bbZkqU1KQbBU2Nx4Gbpl","MatrixThumbnailUtils");var a=t("Singleton"),n=t("ResourceUtils"),o=t("ItemConst"),r=t("StaticResourceConst");function s(t,e){var i=cc.instantiate(n.getResource(r.CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("CharacterMatrixThumbnail");if(!t)return i;var a=0;return e&&null!==e.exceedLimit&&void 0!==e.exceedLimit&&(a=e.exceedLimit),i.initCharacterMatrixThumbnail(t,a,void 0,void 0),e&&null!==e.count&&void 0!==e.count&&(e.prefix?i.setBottomParams(e.prefix,e.count):i.setBottomParams("",e.count)),i}function c(t,e){var i=cc.instantiate(n.getResource(r.EQUIPMENT_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("EquipmentMatrixThumbnail");if(!t)return i;var a=t.getRarity();return e&&null!==e.rarity&&void 0!==e.rarity&&(a=e.rarity),i.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),a,void 0),e&&null!==e.count&&void 0!==e.count&&(e.prefix?i.setParameter(e.prefix,""+e.count):i.setParameter("",""+e.count)),i}function l(t,e){var i=cc.instantiate(n.getResource(r.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");if(!t)return i;if(i.setMainImage(n.getFileNameItemThumbnail(t.getItemId())),e){if(null!==e.count&&void 0!==e.count){var a="";null!==e.prefix&&void 0!==e.prefix&&(a=e.prefix),i.setNumeCount(a,e.count,e.color)}if(null!==e.maxCount&&void 0!==e.maxCount){var o="";null!==e.prefix&&void 0!==e.prefix&&(o=e.prefix),i.setDenomCount(o,e.maxCount)}}return i}e.exports={createMatrixThumbnailByItemType:function(t,e,i){switch(e){case o.ITEM_TYPE.CHARACTER:return s(_.find(a.dao.CharacterMainMasters,function(e){return e.getCharacterId()===t}),i);case o.ITEM_TYPE.EQUIPMENT:return c(_.find(a.dao.EquipmentMainMasters,function(e){return e.getEquipmentId()===t}),i)}return l(_.find(a.dao.ItemMainMasters,function(e){return e.getItemId()===t}),i)}},cc._RF.pop()},{ItemConst:"ItemConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],MatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"a07bcOunMhPpJd5GfR3Mabg","MatrixThumbnail");t("CommonNumber");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("CharacterSortConst"),r=t("MatrixThumbnailBase"),s=cc.Enum({OPEN:0,NEW:1});cc.Class({extends:r,properties:{mainImageSprite:cc.Sprite,leftIconImageSprite:cc.Sprite,rightIconImageSprite:cc.Sprite,grayImageSprite:cc.Sprite,selectedOrderLabel:cc.Label,countNumLabel:cc.Label,topNumPrefixNode:cc.Node,topNumNode:cc.Node,bottomNumPrefixNode:cc.Node,bottomNumNode:cc.Node,centerLabel:cc.Label,isProtectNode:cc.Node,isEquipmentNode:cc.Node,isSelectedNode:cc.Node,selectedOrderNode:cc.Node,isFirstClearNode:cc.Node,isSubMissionRewardNode:cc.Node,subMissionRewardLabel:cc.Label,isAddRewardNode:cc.Node,isNewNode:cc.Node,emptyNode:cc.Node,plainNode:cc.Node,addingNode:cc.Node,matrixThumbnailAnimationWhiteOutNode:cc.Node,matrixThumbnailAnimation:cc.Animation,thumbnailBtn:a},initMatrixThumbnail:function(t,e,i,a,n){this._initSprites(t,e,i),this._setTopPalams(-1,""),this._setBottomPalams(a,n),this._setCount(-1),this.setSelectedOrder(0),this._switchEmptyNodeActive(!1),this._switchAddingNodeActive(!1),this.setCenterLabel("")},initItemMatrixThumbnail:function(t,e,i,a){this._initSprites(t,""),this._setTopPalams(e,i),this._setBottomPalams(-1,""),this._setCount(a),this.setSelectedOrder(0),this._switchEmptyNodeActive(!1),this._switchAddingNodeActive(!1),this.setCenterLabel("")},initEmptyMatrixThumbnail:function(){this._setTopPalams(-1,""),this._setBottomPalams(-1,""),this._setCount(-1),this.setSelectedOrder(0),this._switchEmptyNodeActive(!0),this._switchAddingNodeActive(!1),this.setCenterLabel("")},initPlainMatrixThumbnail:function(){this._setTopPalams(-1,""),this._setBottomPalams(-1,""),this._setCount(-1),this.setSelectedOrder(0),this._switchEmptyNodeActive(!1),this._switchPlainNodeActive(!0),this._switchAddingNodeActive(!1),this.mainImageSprite.node.parent.active=!1,this.setCenterLabel("")},initAddingMatrixThumbnail:function(){this._setTopPalams(-1,""),this._setBottomPalams(-1,""),this._setCount(-1),this.setSelectedOrder(0),this._switchEmptyNodeActive(!1),this._switchAddingNodeActive(!0),this.setCenterLabel("")},setCallbackToThumbnailBtn:function(t){this.thumbnailBtn.setTapEvent(t,"")},setCenterLabel:function(t,e){this.centerLabel.node.active=!!t,this.centerLabel.string=t,e&&(this.centerLabel.node.color=e)},setActive:function(t){this.grayImageSprite.node.active=!t},_switchEmptyNodeActive:function(t){this.emptyNode.active=t},_switchPlainNodeActive:function(t){this.plainNode.active=t},_switchAddingNodeActive:function(t){this.addingNode.active=t},setSelectedNodeActive:function(t){this.isSelectedNode.active=t},setSelectedOrder:function(t){var e=parseInt(t)>0;this.setSelectedNodeActive(e),this.selectedOrderNode.active=e,this.selectedOrderLabel.string=t},setProtected:function(t){this.isProtectNode.active=t},getProtected:function(){return this.isProtectNode.active},setEquiped:function(t){this.isEquipmentNode.active=t},setFirstClear:function(t){this.isFirstClearNode.active=t},setSubMissionReward:function(t){this.isSubMissionRewardNode.active=!0,this.subMissionRewardLabel.string=Array(parseInt(t,10)+1).join("\u2605")},setAddReward:function(){this.isAddRewardNode.active=!0},setNew:function(t){this.isNewNode.active=t,t?this.matrixThumbnailAnimation.playAdditive(this.matrixThumbnailAnimation.getClips()[s.NEW].name):this.matrixThumbnailAnimation.stop(this.matrixThumbnailAnimation.getClips()[s.NEW].name)},playOpenAnimation:function(t){t&&this.matrixThumbnailAnimation.once("finished",function(e){return t(e)},this),this.node.setScale(0,0),this.matrixThumbnailAnimationWhiteOutNode.active=!0,this.matrixThumbnailAnimation.playAdditive(this.matrixThumbnailAnimation.getClips()[s.OPEN].name)},_initSprites:function(t,e,i){this.grayImageSprite.node.active=!1,n.addSprite(this.mainImageSprite,t),n.addSprite(this.leftIconImageSprite,e),n.addSprite(this.rightIconImageSprite,i)},_setCount:function(t){t>=0?(this.countNumLabel.node.active=!0,this.countNumLabel.string=t+""):this.countNumLabel.node.active=!1},_setTopNum:function(t){var e=this.topNumNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t+""},_setTopNumPrefix:function(t){var e=this.topNumPrefixNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t},_setTopPalams:function(t,e){t>=0?(this._setTopNum(t),this._setTopNumPrefix(e)):(this._setTopNum(""),this._setTopNumPrefix(""))},_setBottomNum:function(t){var e=this.bottomNumNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t+""},_setBottomNumPrefix:function(t){var e=this.bottomNumPrefixNode.getComponentsInChildren(cc.Label);for(var i in e)e[i].string=t},_setBottomPalams:function(t,e){t>=0?(this._setBottomNum(t),this._setBottomNumPrefix(this._getBottomNumPrefixText(e))):(this._setBottomNum(""),this._setBottomNumPrefix(""))},_getBottomNumPrefixText:function(t){switch(t){case o.SORT_TYPE.LEVEL:return"Lv.";case o.SORT_TYPE.RARE:return"\u2605";case o.SORT_TYPE.TOTAL:return"\u6226\u529b";case o.SORT_TYPE.HP:return"Hp";case o.SORT_TYPE.ATK:return"Atk";case o.SORT_TYPE.DEF:return"Def"}return""}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CommonButton:"CommonButton",CommonNumber:"CommonNumber",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils"}],MatrixView:[function(t,e,i){"use strict";cc._RF.push(e,"c29f5pr7DJA8JSMdCnmv9ej","MatrixView");cc.Class({extends:cc.Component,_dataArray:null,_matrixConfig:null,init:function(t){this._matrixConfig=t},drawMatrixView:function(t,e){this.node.destroyAllChildren(),this._dataArray=e;for(var i=0;i<t.length&&!(this.node.childrenCount>=this._matrixConfig.countX*this._matrixConfig.countY);i++){var a=this._matrixConfig.startX+this._matrixConfig.spaceX*(i%this._matrixConfig.countX),n=this._matrixConfig.startY+this._matrixConfig.spaceY*parseInt(i/this._matrixConfig.countX);t[i].setPosition(cc.v2(a,n)),t[i].name=""+i,this.node.addChild(t[i])}},drawMatrixViewWithAnimation:function(t,e){this.drawMatrixView(t,e);for(var i=0;i<t.length;i++){var a=this._matrixConfig.startX+this._matrixConfig.spaceX*(i%this._matrixConfig.countX),n=this._matrixConfig.startY+this._matrixConfig.spaceY*parseInt(i/this._matrixConfig.countX);t[i].setPosition(cc.v2(a,n-30));var o=cc.sequence(cc.delayTime(.015*i),cc.moveTo(.4,cc.v2(a,n)).easing(cc.easeOut(3)));t[i].runAction(o),t[i].opacity=0;var r=cc.sequence(cc.delayTime(.015*i),cc.fadeIn(.4));t[i].runAction(r);for(var s=t[i].getComponentsInChildren(cc.Label),c=0;c<s.length;c++){s[c].node.opacity=0;var l=cc.sequence(cc.delayTime(.4),cc.callFunc(function(){this.opacity=255},s[c].node));s[c].node.runAction(l)}}},getDataArray:function(){return this._dataArray},getMatrixConfig:function(){return this._matrixConfig}});cc._RF.pop()},{}],MemoryManager:[function(t,e,i){"use strict";cc._RF.push(e,"19131qQx21MTYkV0quTQew0","MemoryManager");var a=t("Singleton"),n=t("AdvSingleton"),o=t("ResLoader"),r=t("BattleConstants"),s=cc.Class({properties:{dynamicResMap:{default:{}},storeSpArr:[],storeLocalPathArr:[],storePrefabArr:[]},statics:{instance:null},ctor:function(){s.instance=this},localPrefabStore:function(t){},localResStore:function(t,e){},storeDynamicRes:function(t){var e=t[0];e&&(this.dynamicResMap[e]||(this.dynamicResMap[e]=t[1]))},storeRes:function(t,e){},release:function(){for(var t in this.dynamicResMap){var e=this.dynamicResMap[t];if(null!=e){if(a.res[t]){if(a.res[t+"_scene"]){if(a.res[t+"_scene"]==cc.director.getScene().name)continue;delete a.res[t+"_scene"]}a.res[t]=null}n.res[t]&&(n.res[t]=null),cc.loader.release(e),delete this.dynamicResMap[t]}}o.loader.releaseResDir(r.BATTLE_UI_FOLDER_NAME,cc.Prefab),o.loader.releaseResDir(r.BATTLE_OBJ_FOLDER_NAME,cc.Prefab),o.loader.releaseResDir(r.BATTLE_SE_FOLDER_NAME,cc.AudioClip),setTimeout(function(){cc.sys.garbageCollect()},100)},releaseAdvRes:function(){for(var t in n.res)if(this.dynamicResMap[t]){var e=this.dynamicResMap[t];if(null==e)continue;cc.loader.release(e),n.res[t]=null,this.dynamicResMap[t]=null}n.res={},setTimeout(function(){cc.sys.garbageCollect()},100)},releaseResArray:function(t){for(var e=0;e<t.length;e++){var i=t[e];if(this.dynamicResMap[i]){var a=this.dynamicResMap[i];cc.loader.release(a),this.dynamicResMap[i]=null}}setTimeout(function(){cc.sys.garbageCollect()},100)},loadRes:function(t){var e=cc.loader.getDependsRecursively(t),i=!0,a=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=o.value,c=this.resLoadNumMap[s];this.resLoadNumMap[s]=null==c?1:c+1}}catch(t){a=!0,n=t}finally{try{!i&&r.return&&r.return()}finally{if(a)throw n}}},releaseRes:function(t){var e=void 0;e=t instanceof Array?t:[t];for(var i=!0,a=0;a<e.length;a++){var n=e[a],o=cc.loader.getDependsRecursively(n),r=o.length,s=0,c=!0,l=!1,u=void 0;try{for(var h,d=o[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var p=h.value,m=this.resLoadNumMap[p];null!=m&&void 0!=m&&(m--,this.resLoadNumMap[p]=m,m<=0&&(cc.loader.release(p),this.resLoadNumMap[p]=null,s++))}}catch(t){l=!0,u=t}finally{try{!c&&d.return&&d.return()}finally{if(l)throw u}}s!=r&&(i=!1)}return i},updateResKeyWhenSwitchResQuality:function(t){for(var e in this.dynamicResMap){var i=this.dynamicResMap[e];this.dynamicResMap[e+"_"+t]=i,delete this.dynamicResMap[e]}}});e.exports=s,cc._RF.pop()},{AdvSingleton:"AdvSingleton",BattleConstants:"BattleConstants",ResLoader:"ResLoader",Singleton:"Singleton"}],MenuPopup:[function(t,e,i){"use strict";cc._RF.push(e,"08640zaVQ9ANoUXtCZZsy+Z","MenuPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=(t("UIHeader"),t("CommonUtils")),s=t("ResourceUtils"),c=t("NoticeBadgeCheckUtils"),l=t("ViewUtils"),u=t("GameConst"),h=t("StaticResourceConst"),d=t("LocalDataConst"),p=t("SceneConst"),m={POSITION:cc.v2(130,27),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{exchangeBtn:o,shopBtn:o,warehouseBtn:o,presentBtn:o,storyBtn:o,profileBtn:o,newsBtn:o,settingBtn:o,titleBtn:o,questionnaireBtn:o,closeBtn:o,menuSettingPopupPrefab:cc.Prefab},openMenuPopup:function(){this._initMenuPopup(),this.open()},_initMenuPopup:function(){n.dao.userBasicData;this._initButtons()},_initButtons:function(){this._initShopBtn(),this._initExchangeBtn(),this._initWarehouseBtn(),this._initPresentBtn(),this._initStoryBtn(),this._initProfileBtn(),this._initNewsBtn(),this._initSettingBtn(),this._initTitleBtn(),this._initQuestionnaireBtn(),this._initCloseBtn()},_initShopBtn:function(){this._initTransitionBtn(this.shopBtn,"ShopScene"),c.hasNewShopItem()&&l.addNoticeBadge(this.shopBtn.node,m.POSITION,m.SCALE)},_initExchangeBtn:function(){this._initTransitionBtn(this.exchangeBtn,"ExchangeScene"),c.hasNewExchangeItem()&&l.addNoticeBadge(this.exchangeBtn.node,m.POSITION,m.SCALE)},_initWarehouseBtn:function(){this._initTransitionBtn(this.warehouseBtn,"WarehouseScene")},_initPresentBtn:function(){this._initTransitionBtn(this.presentBtn,"PresentBoxScene"),c.hasReceivablePresent()&&l.addNoticeBadge(this.presentBtn.node,m.POSITION,m.SCALE)},_initStoryBtn:function(){this._initTransitionBtn(this.storyBtn,"StoryScene"),c.hasNewReleasedNormalStory()&&l.addNoticeBadge(this.storyBtn.node,m.POSITION,m.SCALE)},_initProfileBtn:function(){this._initTransitionBtn(this.profileBtn,"ProfileScene")},_initQuestionnaireBtn:function(){this._initTransitionBtn(this.questionnaireBtn,"QuestionnaireScene")},_initNewsBtn:function(){cc.sys.isBrowser&&!cc.sys.isMobile?this.newsBtn.node.active=!1:(this.newsBtn.node.active=!0,this.newsBtn.setTapEvent(this._onTapNewsBtn.bind(this)))},_initSettingBtn:function(){this.settingBtn.setTapEvent(this._onTapSettingBtn.bind(this))},_initTitleBtn:function(){this.titleBtn.setTapEvent(this._onTapTitleBtn.bind(this))},_initCloseBtn:function(){this.closeBtn.setTapEvent(function(){this.close()}.bind(this),o.SE_NAME.CANCEL)},_onTapTitleBtn:function(){r.restartGame()},_onTapNewsBtn:function(){cc.instantiate(s.getResource(h.NEWS_POPUP_PREFAB_PATH)).getComponent("NewsPopup").openNewsPopup(u.NEWS_TAB.INFO,0)},_onTapSettingBtn:function(){var t=cc.instantiate(this.menuSettingPopupPrefab).getComponent("MenuSettingPopup");t.openSettingPopup(),t.setCloseCallBack(function(){var e=t.getSoundSetting(),i=n.dao.userBasicData.getBattleSpeed(),a=n.dao.userBasicData.getIsSkillAuto();n.soundManager.setSEVol(e.se),n.soundManager.setVoiceVol(e.voice),n.soundManager.setBGMVol(e.bgm),n.soundManager.setBgmMute(e.bgmMute),n.soundManager.setSeMute(e.seMute),n.soundManager.setVoiceMute(e.voiceMute),r.saveLocalStorage(d.LOCAL_STORAGE_KEY.PLAY_SKILL_ANIMATION,t.getIsSkillSkipMode()),r.getRoot().requestUpdateSetting(e,i,a)})},_closeEvent:function(t){this._closeCallBack&&this._closeCallBack(),t()},_transitionEvent:function(t){this._closeEvent(function(){cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase").clearScene(),r.getRoot().pushScene(t,p.SCENE.FILE_NAME.HOME)})},_initTransitionBtn:function(t,e){t.showDevelopmentText(e,10,10),t.setTapEvent(function(){this._transitionEvent(e)}.bind(this))}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",UIHeader:"UIHeader",ViewUtils:"ViewUtils"}],MenuSettingConfigView:[function(t,e,i){"use strict";cc._RF.push(e,"01b2fKu0e5B5Ll8FmPkdPBe","MenuSettingConfigView");t("Singleton");var a=t("CommonButton"),n=t("CommonUtils"),o=t("MenuSettingViewBase"),r=t("LocalDataConst"),s=cc.Enum({NORMAL:"Normal",SIMPLE:"Simple"});cc.Class({extends:o,properties:{soundSettingViewParentNode:cc.Node,soundSettingViewPrefab:cc.Prefab,skillPlayAnimToggleBtnArray:[a]},_soundSettingView:null,onLoad:function(){this.skillPlayAnimToggleBtnArray.forEach(function(t){t.setTapEvent(this._skillPlayAnimToggleEvent.bind(this))}.bind(this))},initMenuSettingView:function(){this._addSoundSettingView(),this._initSkillPlayAnimToggle()},_addSoundSettingView:function(){if(!this._soundSettingView){var t=cc.instantiate(this.soundSettingViewPrefab).getComponent("SoundSettingView");this.soundSettingViewParentNode.addChild(t.node),this._soundSettingView=t}},_initSkillPlayAnimToggle:function(){var t="";t=n.loadLocalStorage(r.LOCAL_STORAGE_KEY.PLAY_SKILL_ANIMATION,!0,r.LOCAL_STORAGE_GET_TYPE.BOOLEAN)?s.NORMAL:s.SIMPLE,this.skillPlayAnimToggleBtnArray.forEach(function(e){e.node.getName()===t?e.switchBtnImage(!0):e.switchBtnImage(!1)})},_skillPlayAnimToggleEvent:function(t){t.target.getComponent("CommonButton").getBtnImageSwitchState()||this.skillPlayAnimToggleBtnArray.forEach(function(t){t.switchBtnImage(!t.getBtnImageSwitchState())})},getIsSkillSkipMode:function(){return this.skillPlayAnimToggleBtnArray.find(function(t){return t.node.getName()===s.NORMAL}).getBtnImageSwitchState()},getSoundSetting:function(){return this._soundSettingView.getSoundSetting()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",MenuSettingViewBase:"MenuSettingViewBase",Singleton:"Singleton"}],MenuSettingPopup:[function(t,e,i){"use strict";cc._RF.push(e,"26985RwZgZMEKQ3+O993+pG","MenuSettingPopup");var a=t("PopupBase"),n=(t("Singleton"),t("CommonButton")),o=(t("UIHeader"),t("CommonUtils"),t("MenuSettingTabView"));t("LocalDataConst"),cc.Enum({NORMAL:"Normal",SIMPLE:"Simple"}),cc.Class({extends:a,properties:{menuSettingTabView:o,closeBtn:n},_soundSettingView:null,openSettingPopup:function(){this._initMenuPopup(),this.open()},_initMenuPopup:function(){this.menuSettingTabView.initMenuSettingTabView(),this.closeBtn.setTapEvent(function(){this.close()}.bind(this),n.SE_NAME.CANCEL)},_closeEvent:function(t){this._closeCallBack&&this._closeCallBack(),t()},getIsSkillSkipMode:function(){return this.menuSettingTabView.getIsSkillSkipMode()},getSoundSetting:function(){return this.menuSettingTabView.getSoundSetting()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",MenuSettingTabView:"MenuSettingTabView",PopupBase:"PopupBase",Singleton:"Singleton",UIHeader:"UIHeader"}],MenuSettingQualityView:[function(t,e,i){"use strict";cc._RF.push(e,"53305D51OVDNrZwV1oqbJTE","MenuSettingQualityView");var a=t("Singleton"),n=t("CommonButton"),o=t("CommonUtils"),r=t("PopupUtils"),s=t("MenuSettingViewBase"),c=t("GameConst"),l=t("LocalDataConst"),u=t("ViewUtils"),h=t("DownManifestManager"),d=t("SingletonConst");t("MemoryManager"),cc.Class({extends:s,properties:{lowQualityBtn:n,highQualityBtn:n,dlBtn:n,dlDispNode:cc.Node,allResourceDownloadConfirmPopupPrefab:cc.Prefab,hdNeedCapacityNode:cc.Node,ldNeedCapacityNode:cc.Node,hdNeedCapacityGbLabel:cc.Label,ldNeedCapacityGbLabel:cc.Label,hdNeedCapacityMbLabel:cc.Label,ldNeedCapacityMbLabel:cc.Label},_quality:0,onLoad:function(){this.lowQualityBtn.setTapEvent(this._onTapLowQualityBtn.bind(this)),this.highQualityBtn.setTapEvent(this._onTapHighQualityBtn.bind(this)),this.dlBtn.setTapEvent(this._onTapDlBtn.bind(this)),cc.sys.isNative?(this._setRequireCapacity(),this.hdNeedCapacityNode.active=!0,this.ldNeedCapacityNode.active=!0):(this.hdNeedCapacityNode.active=!1,this.ldNeedCapacityNode.active=!1)},initMenuSettingView:function(){this._quality=o.loadLocalStorage(l.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,l.LOCAL_STORAGE_GET_TYPE.INTEGER),a.localData[l.RES_QUALITY]=this._quality,this.dlDispNode.active=cc.sys.isNative,this._resetQualityBtns(),this._drawQualityBtns()},_resetQualityBtns:function(){this.lowQualityBtn.switchBtnImage(!1),this.highQualityBtn.switchBtnImage(!1)},_drawQualityBtns:function(){switch(this._quality){case c.RESOURCE_QUALITY.HIGH:this.highQualityBtn.switchBtnImage(!0);break;case c.RESOURCE_QUALITY.LOW:default:this.lowQualityBtn.switchBtnImage(!0)}},_confirmQuality:function(t){r.openCommonPopupYesNo("\u78ba\u8a8d",this._getQualityText(t),"",!1,this._setQuality.bind(this,t),function(){},"\u5b9f\u884c","\u30ad\u30e3\u30f3\u30bb\u30eb",!0)},_getQualityText:function(t){switch(t){case c.RESOURCE_QUALITY.LOW:return"\u672c\u5f53\u306b\u8efd\u91cf\u7248\u306b\n\u5207\u308a\u66ff\u3048\u3092\u884c\u3044\u307e\u3059\u304b\uff1f";case c.RESOURCE_QUALITY.HIGH:return"\u672c\u5f53\u306b\u9ad8\u30af\u30aa\u30ea\u30c6\u30a3\u7248\u306b\n\u5207\u308a\u66ff\u3048\u3092\u884c\u3044\u307e\u3059\u304b\uff1f"}return""},_setQuality:function(t){var e=this;function i(){e._quality=t,a.localData[l.RES_QUALITY]=t,o.saveLocalStorage(l.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,e._quality),o.restartGame()}this.isOverMaxTextureSize(t)?i():r.openCommonPopupOk("","\u3053\u306e\u7aef\u672b\u3067\u306f\u9ad8\u89e3\u50cf\u5ea6\u3092\u9078\u629e\u3059\u308b\u3068\n\u8868\u793a\u304c\u4e71\u308c\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002","",!1,function(){i()})},_onTapLowQualityBtn:function(){this._quality!==c.RESOURCE_QUALITY.LOW&&this._confirmQuality(c.RESOURCE_QUALITY.LOW)},_onTapHighQualityBtn:function(){this._quality!==c.RESOURCE_QUALITY.HIGH&&this._confirmQuality(c.RESOURCE_QUALITY.HIGH)},_onTapDlBtn:function(){u.addModalLayer(),h.instance.checkNewVersion(function(t,e){u.removeModalLayer(),t?r.openCommonPopupOk("\u78ba\u8a8d","\u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","",!1,function(){o.restartGame()}):e?this._openAllResourceDownloadConfirmPopup(this._quality):r.openSystemPopup("\u78ba\u8a8d","\u8ffd\u52a0\u306e\u30c7\u30fc\u30bf\u306f\u3042\u308a\u307e\u305b\u3093\u3002","",!1,function(){})}.bind(this))},_openAllResourceDownloadConfirmPopup:function(t){cc.instantiate(this.allResourceDownloadConfirmPopupPrefab).getComponent("AllResourceDownloadConfirmPopup").openAllResourceDownloadConfirmPopup(t)},_requestDownMainfest:function(t,e){u.addModalLayer();var i=this;h.instance.loadDownLoadMainfest(function(a){u.removeModalLayer(),null==a?e():r.openCommonPopupYesNo("\u78ba\u8a8d",a,"",!1,function(){i._requestDownMainfest(t,e)},function(){},"\u5b9f\u884c","\u30ad\u30e3\u30f3\u30bb\u30eb",!0)}.bind(this),t)},_setRequireCapacity:function(){var t=h.instance.getNeedCapacity(),e=t[0],i=t[1];this.ldNeedCapacityGbLabel.string=o.convertToCommaDelimited((e/1024).toFixed(2))+"GB",this.hdNeedCapacityGbLabel.string=o.convertToCommaDelimited((i/1024).toFixed(2))+"GB",this.ldNeedCapacityMbLabel.string="("+o.convertToCommaDelimited(e.toFixed(2))+"MB)",this.hdNeedCapacityMbLabel.string="("+o.convertToCommaDelimited(i.toFixed(2))+"MB)"},isOverMaxTextureSize:function(t){if(cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID&&t===c.RESOURCE_QUALITY.HIGH){var e=a[d.ENVIRONMENT];return!(jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","getMaxTextureSize","()I")<c.MAX_TEXTURE_SIZE)}return!0}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",MenuSettingViewBase:"MenuSettingViewBase",PopupUtils:"PopupUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",ViewUtils:"ViewUtils"}],MenuSettingTabView:[function(t,e,i){"use strict";cc._RF.push(e,"14de41dMr1ElZfy0b5pfmkV","MenuSettingTabView");var a=t("TabViewBase"),n=t("MenuSettingViewBase");cc.Class({extends:a,properties:{menuSettingViewArray:[n]},initMenuSettingTabView:function(){this.initTabViewBase(),this._setCurrentTab(0),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetPauseView(),this.menuSettingViewArray[t].node.active=!0,this.menuSettingViewArray[t].initMenuSettingView()},_resetPauseView:function(){for(var t in this.menuSettingViewArray)this.menuSettingViewArray[t].node.active=!1},getIsSkillSkipMode:function(){return this.menuSettingViewArray[0].getIsSkillSkipMode()},getSoundSetting:function(){return this.menuSettingViewArray[0].getSoundSetting()}});cc._RF.pop()},{MenuSettingViewBase:"MenuSettingViewBase",TabViewBase:"TabViewBase"}],MenuSettingViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"569f8PcfStPApBp67TH2PmF","MenuSettingViewBase");cc.Class({extends:cc.Component,properties:{},initMenuSettingView:function(){cc.warn("initMenuSettingView \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")}});cc._RF.pop()},{}],MessageView:[function(t,e,i){"use strict";cc._RF.push(e,"2a20cue0eZG6bkReYNMh4AP","MessageView");var a=t("AdvRichText"),n=t("AdvConstants");cc.Class({extends:cc.Component,properties:{nameText:a,messageText:a,selectionNode:cc.Node,selectBtnPrefab:cc.Prefab},init:function(){},setName:function(t,e){this.nameText.setCustomText(t,e)},setMessage:function(t,e){this.messageText.setCustomText(t,e)},setSelectThumbnails:function(t,e){this.selectionNode.destroyAllChildren();for(var i=0;i<e.length;i++){var a=cc.instantiate(this.selectBtnPrefab).getComponent("AdvSelectThumbnail");a.init(t,i+1,e[i],function(e){t.readNextLine(),this.selectionNode.destroyAllChildren(),t.addMessageLog(n.ADV_LOG_TAG.SELECT,"",e)}.bind(this)),this.selectionNode.addChild(a.node)}}}),cc._RF.pop()},{AdvConstants:"AdvConstants",AdvRichText:"AdvRichText"}],MiniCharacterController:[function(t,e,i){"use strict";cc._RF.push(e,"79977s4tnpLnIHvPl1hDQ/f","MiniCharacterController");var a=t("MiniCharacterView"),n=t("MiniCharacterData");cc.Class({_characterView:null,_characrerData:null,createMiniCharacterView:function(t,e,i,o){return this._characterView||(this._characterView=new a,this._characrerData=new n),this._characrerData.initialize(t,e,i),this._characterView.initialize(this._characrerData.getCharacterId(),e,o),this._characterView},isDead:function(){return this._characrerData.isDead()},setPosition:function(t){this._characrerData.isDead()||this._characterView.setCurrentPosition(t)},idle:function(){this._characrerData.isDead()||this._characterView.idle()},run:function(){this._characrerData.isDead()||this._characterView.run()},win:function(){this._characrerData.isDead()||this._characterView.win()},addWater:function(){this._characrerData.isDead()||this._characterView.addWater()},hideWater:function(){this._characrerData.isDead()||this._characterView.hideWater()},miniJump:function(){this._characrerData.isDead()||this._characterView.miniJump()},jump:function(){this._characrerData.isDead()||this._characterView.jump()},death:function(){this._characrerData.setDead(),this._characterView.death()},deathFireball:function(){this._characrerData.setDead(),this._characterView.deathFireball()},deathFall:function(){this._characrerData.setDead(),this._characterView.deathFall()},deathWaterFall:function(){this._characrerData.setDead(),this._characterView.deathWaterFall()}});cc._RF.pop()},{MiniCharacterData:"MiniCharacterData",MiniCharacterView:"MiniCharacterView"}],MiniCharacterData:[function(t,e,i){"use strict";cc._RF.push(e,"5a6f976wJVKTootgg/BBbA7","MiniCharacterData");cc.Class({_characterId:0,_position:0,_isWin:!1,_lane:0,_isDead:!1,initialize:function(t,e,i){this._characterId=t,this._lane=e,this._isWin=i},getCharacterId:function(){return this._characterId},getLane:function(){return this._lane},getWin:function(){return this._isWin},setDead:function(){this._isDead=!0},isDead:function(){return this._isDead}});cc._RF.pop()},{}],MiniCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"8d0derefpNEyIn5cLCNn9QM","MiniCharacterView");var a=t("Singleton"),n=t("ResourceUtils"),o=t("MinigameObjectView"),r=t("MinigamePlayData");t("MinigameConstants"),cc.Class({extends:o,skeleton:sp.Skeleton,_lane:0,_root:null,_nodeWater:null,initialize:function(t,e,i){this._root=i,this._lane=e;var o=n.getFileNameCharacterSDSpine(t);this._node=new cc.Node,this.skeleton=this._node.addComponent(sp.Skeleton),this.skeleton.skeletonData=a.res[o],this.addChild(this._node),this.setCurrentPosition(0),this.setScale(.5),this._nodeWater=cc.instantiate(i.waterPrefab),this._nodeWater.active=!1,this.addChild(this._nodeWater)},setCurrentPosition:function(t){var e=t+r.offsetX-this._lane*r.laneGapX,i=r.offsetY-this._lane*r.laneGapY;this.setPosition(cc.v2(e,i))},idle:function(){this.skeleton.setAnimation(0,"idle",!0)},run:function(){this.skeleton.setAnimation(0,"run",!0)},win:function(){this.skeleton.setAnimation(0,"win",!0)},addWater:function(){this._nodeWater.active=!0,this._node.runAction(cc.moveBy(.1,cc.v2(0,-50)))},hideWater:function(){this._nodeWater.active=!1,this._node.runAction(cc.moveBy(.1,cc.v2(0,50)))},miniJump:function(){this._node.runAction(cc.jumpBy(.5,cc.v2(0,0),150,1))},jump:function(){this._node.runAction(cc.jumpBy(1.7,cc.v2(0,0),300,1))},death:function(){this.skeleton.setAnimation(0,"out",!1),this.skeleton.setCompleteListener(function(){this.active=!1});var t=cc.instantiate(this._root.hitPrefab);this.addChild(t)},deathFireball:function(){this.skeleton.setAnimation(0,"out",!1),this.skeleton.setCompleteListener(function(){this.active=!1});var t=cc.instantiate(this._root.hitFireballPrefab);this.addChild(t)},deathFall:function(){var t=cc.tintTo(1,0,0,0),e=cc.fadeOut(1),i=cc.jumpBy(1,cc.v2(600,-200),100,1),a=cc.spawn(t,e,i);this._node.runAction(a)},deathWaterFall:function(){var t=cc.tintTo(1,0,0,0),e=cc.fadeOut(1),i=cc.moveBy(1,cc.v2(400,-200)),a=cc.spawn(t,e,i);this._node.runAction(a)}});cc._RF.pop()},{MinigameConstants:"MinigameConstants",MinigameObjectView:"MinigameObjectView",MinigamePlayData:"MinigamePlayData",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],MinigameApis:[function(t,e,i){"use strict";cc._RF.push(e,"71847RI/TtLkbvXuuBVxMFX","MinigameApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.MINIGAME_GET_MASTER_DATA,path:"minigame/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.MINIGAME_GET_USER_DATA,path:"minigame/getUserData",method:"POST"}),a.RESTClient.graft({name:n.MINIGAME_PLAY,path:"minigame/play",method:"POST"}),a.RESTClient.graft({name:n.MINIGAME_GET_LIST,path:"minigame/getList",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],MinigameCharacterMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"6418cr+HSNFf4lcr3hshvq1","MinigameCharacterMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");cc.Class({extends:a,getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].ModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MinigameCharacterSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"7c7dcCdAP9PJZfvPf9KlBxa","MinigameCharacterSelectSubRoot");t("MinigameRoot");var a=t("CommonButton"),n=t("CharacterUtils"),o=t("ResourceUtils"),r=t("Singleton"),s=t("TimeUtils"),c=t("ItemUtils"),l=t("StaticResourceConst");cc.Class({extends:cc.Component,properties:{labelDeadLine:cc.Label,spriteRewardWin:cc.Node,spriteRewardLose:cc.Node,labelRewardNameWin:cc.Label,labelRewardNameLose:cc.Label,labelWinRewardCount:cc.Label,labelLoseRewardCount:cc.Label,nodeSd:[cc.Node],labelCharacterName:[cc.Label],nodeStartShadow:cc.Node,spriteSelectedArrow:[cc.Sprite],buttonBack:a,buttonCharacter:[a],buttonStart:a,recoveryTimeNode:cc.Node,recoveryTimeLabel:cc.Label},_selectedIndex:0,initCharacterSelectSubRoot:function(t){this._root=t,this._initDeadLine(),this._initReward(),this._initCharacter(),this._initSelect(),this._initButton(),this._initRecoveryTime()},_initDeadLine:function(){this.labelDeadLine.string="\u7d42\u4e86\u65e5\u6642:"+this._root.deadLine+"\u307e\u3067"},_initReward:function(){var t=o.getFileNameThumbnailByItemType(this._root.minigameData.itemId,this._root.minigameData.itemType),e=cc.instantiate(o.getResource(l.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");e.setMainImage(t),this.spriteRewardWin.addChild(e.node);var i=cc.instantiate(o.getResource(l.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");i.setMainImage(t),this.spriteRewardLose.addChild(i.node);var a=c.getItemInfo(this._root.minigameData.itemType,this._root.minigameData.itemId);this.labelRewardNameWin.string=a.name,this.labelRewardNameLose.string=a.name,this.labelWinRewardCount.string=""+this._root.minigameData.winAmount,this.labelLoseRewardCount.string=""+this._root.minigameData.loseAmount},_initCharacter:function(){for(var t=0;t<this.buttonCharacter.length;t+=1){var e=n.getPreEntryCharacterMinigameMainModelByCharacterId(this._root.characterIdList[t]),i=o.getFileNameCharacterSDSpine(this._root.characterIdList[t]),a=this.nodeSd[t].addComponent(sp.Skeleton);a.skeletonData=r.res[i],a.setAnimation(0,"idle",!0),this.labelCharacterName[t].string=e.getName()}},_initSelect:function(){for(var t=0;t<this.spriteSelectedArrow.length;t+=1)this.spriteSelectedArrow[t].node.active=!1},_initButton:function(){this.buttonBack.setTapEvent(this._onBack.bind(this));for(var t=0;t<this.buttonCharacter.length;t+=1)this.buttonCharacter[t].setTapEvent(this._selectCharacter.bind(this,t))},_initRecoveryTime:function(){var t=_.split(this._root.minigameData.recoveryTime,",");if(t.length>1){this.recoveryTimeNode.active=!0;var e=_.map(t,function(t){return s.parseTimeToHm("20200101"+t)});this.recoveryTimeLabel.string=_.join(e,"\u3068")}else this.recoveryTimeNode.active=!1},_onBack:function(){this._root.transitionHomeRoot()},_onStart:function(){this._root.startMinigame(this._selectedIndex)},_selectCharacter:function(t){this._selectedIndex=t;for(var e=0;e<this.spriteSelectedArrow.length;e+=1)this.spriteSelectedArrow[e].node.active=!1;this.spriteSelectedArrow[t].node.active=!0,this._activeStartButton()},_activeStartButton:function(){this.nodeStartShadow.active&&(this.nodeStartShadow.active=!1,this.buttonStart.setTapEvent(this._onStart.bind(this)))}}),cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",ItemUtils:"ItemUtils",MinigameRoot:"MinigameRoot",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",TimeUtils:"TimeUtils"}],MinigameCharacterTextModel:[function(t,e,i){"use strict";cc._RF.push(e,"eb110l9b59GPYMfTLLm4fI7","MinigameCharacterTextModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");cc.Class({extends:a,getTextId:function(){if(this._isKeyFieldAvailable("textId"))return this._data.textId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: textId")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getRivalCharacterId:function(){if(this._isKeyFieldAvailable("rivalCharacterId"))return this._data.rivalCharacterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rivalCharacterId")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MinigameConstants:[function(t,e,i){"use strict";cc._RF.push(e,"db2541tsvpJPbS1JgxBaFss","MinigameConstants"),e.exports={SPEED_SLOW:300,SPEED_NORMAL:500,TRAP_COUNT:10,MINIGAME_SOUND:"download/minigame/sound/",MINIGAME_BGM:"download/sound/bgm/"},cc._RF.pop()},{}],MinigameCutinSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"db9f0jupOdHd5/8iHA0K6kY","MinigameCutinSubRoot");var a=t("ResourceUtils"),n=t("CharacterUtils");cc.Class({extends:cc.Component,properties:{spriteLeftCharacter:cc.Sprite,spriteRightCharacter:cc.Sprite,labelLeftCharacter:cc.Label,labelRightCharacter:cc.Label,labelLeftSerif:cc.Label,labelRightSerif:cc.Label},_leftCharacterId:0,_rightCharacterId:0,_leftTextList:null,_rightTextList:null,initMinigameCutinSubRoot:function(t){this._root=t,this._initCharacter()},_initCharacter:function(){this._leftCharacterId=this._root.characterIdList[Math.min(this._root.winLane,this._root.rivalLane)];var t=a.getFileNameCharacterMinigame(this._leftCharacterId);a.addSprite(this.spriteLeftCharacter,t,function(){},!1);var e=n.getPreEntryCharacterMinigameMainModelByCharacterId(this._leftCharacterId);this.labelLeftCharacter.string=e.getName(),this._rightCharacterId=this._root.characterIdList[Math.max(this._root.winLane,this._root.rivalLane)];var i=a.getFileNameCharacterMinigame(this._rightCharacterId);a.addSprite(this.spriteRightCharacter,i,function(){},!1);var o=n.getPreEntryCharacterMinigameMainModelByCharacterId(this._rightCharacterId);this.labelRightCharacter.string=o.getName(),this._leftTextList=n.getMinigameTextList(this._leftCharacterId,this._rightCharacterId),this._rightTextList=n.getMinigameTextList(this._rightCharacterId,this._leftCharacterId),this.labelLeftSerif.string=this._leftTextList[0].getText(),this.labelRightSerif.string=this._rightTextList[0].getText();var r=cc.delayTime(3),s=cc.callFunc(function(){this.labelLeftSerif.string=this._leftTextList[1].getText()}.bind(this)),c=cc.delayTime(1),l=cc.callFunc(function(){this.labelRightSerif.string=this._rightTextList[1].getText()}.bind(this)),u=cc.sequence(r,s,c,l);this.node.runAction(u)}}),cc._RF.pop()},{CharacterUtils:"CharacterUtils",ResourceUtils:"ResourceUtils"}],MinigameMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"3c0a6BHwMhCpoEUdwKQaQAX","MinigameMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLoseAmount:function(){if(this._isKeyFieldAvailable("loseAmount"))return this._data.loseAmount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: loseAmount")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getRecoveryTime:function(){if(this._isKeyFieldAvailable("recoveryTime"))return this._data.recoveryTime;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: recoveryTime")},getWinAmount:function(){if(this._isKeyFieldAvailable("winAmount"))return this._data.winAmount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: winAmount")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MinigameManager:[function(t,e,i){"use strict";cc._RF.push(e,"eef33e0x0BJqJzk7nFbE7gg","MinigameManager");var a=t("ResourceUtils"),n=t("BackgroundController"),o=t("MinigamePlayData"),r=t("MiniCharacterController"),s=t("MinigameConstants"),c=t("TrapManager"),l=t("MinigameCutinSubRoot"),u=t("Singleton");cc.Class({_backgroundController:null,_trapManager:null,ctor:function(t){this._root=t,this._trapManager=new c(t)},loadResource:function(t){for(var e=0;e<t.length;e+=1){var i=a.getFileNameCharacterSDSpine(t[e]);this._root.requestRes(i,sp.SkeletonData);var n=a.getFileNameCharacterMinigame(t[e]);this._root.requestRes(n,cc.SpriteFrame)}this._root.requestRes(s.MINIGAME_BGM+"bgm033",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"countdown",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"fall",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"goal",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"long_jump",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"meteor",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"stone_crush",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"stone_jump",cc.AudioClip),this._root.requestRes(s.MINIGAME_SOUND+"water",cc.AudioClip)},setBackground:function(t){this._backgroundController=new n,this._backgroundController.setBackgroundView(t),this._trapManager.setBackgroundController(this._backgroundController)},update:function(t){if(o.isRun&&(o.position+=t*o.speed,this._root.labelPosition.string=parseInt(o.position)+"m"),this._backgroundController){this._backgroundController.setPosition(o.position);for(var e=0;e<o.characterList.length;e+=1)o.characterList[e].setPosition(o.position);for(e=0;e<o.trapList.length;e+=1)o.trapList[e].checkInvoke(o.position)&&o.trapList[e].invoke()}!o.isGoal&&this._isGoal()&&this.goal(),!o.isRush&&this._isRush()&&this.rush()},addCharacter:function(t){for(var e=0;e<t.length;e+=1){var i=new r,a=i.createMiniCharacterView(t[e],e,!1,this._root);this._backgroundController.addCharacterView(a,e),i.idle(),o.characterList.push(i)}},createTrap:function(t,e){this._trapManager.createTrap(s.TRAP_COUNT,t,e)},run:function(){o.isRun=!0,o.speed=s.SPEED_NORMAL;for(var t=0;t<o.characterList.length;t+=1)o.characterList[t].run()},stop:function(){o.isRun=!1;for(var t=0;t<o.characterList.length;t+=1)o.characterList[t].idle()},win:function(){o.isRun=!1;for(var t=0;t<o.characterList.length;t+=1)o.characterList[t].win()},jump:function(t){o.characterList[t].jump()},death:function(t){o.characterList[t].death()},rush:function(){o.isRush=!0;var t=cc.instantiate(this._root.cutinAnimation);this._root.node.addChild(t),t.getComponent(l).initMinigameCutinSubRoot(this._root);var e=t.getComponent(cc.Animation);e.play("Cutin_Anim"),e.once("finished",function(t){}),this._backgroundController&&this._backgroundController.changeRushMode(!0)},rushOff:function(){this._backgroundController&&this._backgroundController.changeRushMode(!1)},speedDown:function(){o.speed=s.SPEED_SLOW},speedNormal:function(){o.speed=s.SPEED_NORMAL},skip:function(){for(var t=0;t<o.characterList.length;t+=1)t!==this._root.winLane&&o.characterList[t].death();this.goal()},goal:function(){o.isGoal=!0,this.win(),this.playGoalAnimation()},playStartAnimation:function(){u.soundManager.playSE(a.getResource(s.MINIGAME_SOUND+"countdown"));var t=cc.instantiate(this._root.startAnimation);this._root.node.addChild(t);var e=t.getComponent(cc.Animation);e.play("CountDownStart_Anim"),e.once("finished",function(t){u.soundManager.continuePlayBGM(a.getResource(s.MINIGAME_BGM+"bgm033"),1),this.createTrap(this._root.winLane,this._root.rivalLane),this.run(),this._root.skipButton.node.active=!0,this._root.skipButton.setTapEvent(function(){this.skip()}.bind(this))}.bind(this),this)},playGoalAnimation:function(){u.soundManager.bgmStop(1.5);var t=cc.instantiate(this._root.goalAnimation);this._root.node.addChild(t);var e=t.getComponent(cc.Animation);e.play("Goal_Anim"),e.once("finished",function(t){this._root.showResult(),this._root.skipButton.node.active=!1}.bind(this),this)},_isGoal:function(){return o.position>o.goalX},_isRush:function(){return o.position>o.rushX}});cc._RF.pop()},{BackgroundController:"BackgroundController",MiniCharacterController:"MiniCharacterController",MinigameConstants:"MinigameConstants",MinigameCutinSubRoot:"MinigameCutinSubRoot",MinigamePlayData:"MinigamePlayData",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TrapManager:"TrapManager"}],MinigameObjectView:[function(t,e,i){"use strict";cc._RF.push(e,"8da6cUqRTpGBJI+Qy7QD2e8","MinigameObjectView");cc.Class({extends:cc.Node,_position:0,_node:null});cc._RF.pop()},{}],MinigamePlayData:[function(t,e,i){"use strict";cc._RF.push(e,"8428f4OXlNCpoV9d5zMwM5m","MinigamePlayData");e.exports={isRun:!1,isRush:!1,isGoal:!1,position:0,characterList:[],trapList:[],speed:0,offsetX:400,laneGapX:120,offsetY:0,laneGapY:64,goalX:0,rushX:0,initialize:function(){this.isRun=!1,this.isRush=!1,this.isGoal=!1,this.position=0,this.characterList=[],this.trapList=[],this.speed=0,this.offsetX=400,this.laneGapX=120,this.offsetY=0,this.laneGapY=64,this.goalX=0,this.rushX=0}},cc._RF.pop()},{}],MinigameResultSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"8b432UsAOZD9amn8pWC4sxt","MinigameResultSubRoot");t("MinigameRoot");var a=t("CommonButton"),n=t("CharacterUtils"),o=t("ResourceUtils"),r=t("Singleton"),s=t("StaticResourceConst");cc.Class({extends:cc.Component,properties:{spriteReward:cc.Node,labelRewardCount:cc.Label,nodeSd:cc.Node,labelCharacterName:cc.Label,buttonNext:a,nodeReward:cc.Node,nodeLose:cc.Node,nodeWin:cc.Node},initResultSubRoot:function(t){this._root=t,this._initReward(),this._initCharacter(),this._initButton()},_initReward:function(){var t=o.getFileNameThumbnailByItemType(this._root.minigameData.itemId,this._root.minigameData.itemType),e=cc.instantiate(o.getResource(s.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");e.setMainImage(t),this.spriteReward.addChild(e.node),this._root.selectedLane!==this._root.winLane?(this.nodeWin.active=!1,this.nodeLose.active=!0,this.labelRewardCount.string=""+this._root.minigameData.loseAmount):(this.nodeWin.active=!0,this.nodeLose.active=!1,this.labelRewardCount.string=""+this._root.minigameData.winAmount)},_initCharacter:function(){var t=this._root.characterIdList[this._root.selectedLane],e=n.getPreEntryCharacterMinigameMainModelByCharacterId(t);if(e){var i=o.getFileNameCharacterSDSpine(t),a=this.nodeSd.addComponent(sp.Skeleton);a.skeletonData=r.res[i],this._root.selectedLane!==this._root.winLane?a.setAnimation(0,"idle",!0):a.setAnimation(0,"win",!0),this.labelCharacterName.string=e.getName()}},_initButton:function(){this.buttonNext.setTapEvent(this._onNext.bind(this))},_onNext:function(){cc.log("onNext"),this._root.transitionHomeRoot()}}),cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",MinigameRoot:"MinigameRoot",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],MinigameRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"3497aFgNjhBirGj/YSIkfwo","MinigameRootUtils");var a=t("Singleton"),n=t("TimeUtils");e.exports={openCharacterSelectSubRoot:function(t,e){cc.log("openCharacterSelectSubRoot"),t.characterSelectSubRoot||(t.characterSelectSubRoot=cc.instantiate(t.characterSelectSubRootPrefab).getComponent("MinigameCharacterSelectSubRoot"),t.subRootParent.addChild(t.characterSelectSubRoot.node)),t.characterSelectSubRoot.initCharacterSelectSubRoot(t)},closeCharacterSelectSubRoot:function(t,e){cc.log("closeCharacterSelectSubRoot"),t.characterSelectSubRoot&&(t.characterSelectSubRoot.node.destroy(),t.characterSelectSubRoot=null)},openResultSubRoot:function(t,e){cc.log("openResultSubRoot"),t.resultSubRoot||(t.resultSubRoot=cc.instantiate(t.resultSubRootPrefab).getComponent("MinigameResultSubRoot"),t.subRootParent.addChild(t.resultSubRoot.node)),t.resultSubRoot.initResultSubRoot(t)},closeResultSubRoot:function(t,e){cc.log("closeResultSubRoot"),t.resultSubRoot&&(t.resultSubRoot.node.destroy(),t.resultSubRoot=null)},canPlayMinigame:function(){if(a.dao.userMinigame){var t=n.getNowDateTime(),e=n.getNowDate(),i=_.map(_.split("000000",","),function(t){return e+t}),o=_.max(_.filter(i,function(e){return e<=t}));if(a.dao.userMinigame.getLastDate()>=o)return!1}return!0}},cc._RF.pop()},{Singleton:"Singleton",TimeUtils:"TimeUtils"}],MinigameRoot:[function(t,e,i){"use strict";cc._RF.push(e,"1cf96N4a4tID5xsUPoh3J/Y","MinigameRoot");var a=t("GameRootBase"),n=t("BackgroundView"),o=t("MinigameManager"),r=t("CommonButton"),s=t("MinigameRootUtils"),c=t("Singleton"),l=(t("CommonUtils"),t("SingletonConst")),u=t("ErrorCode");cc.Class({extends:a,properties:{characterSelectSubRootPrefab:cc.Prefab,resultSubRootPrefab:cc.Prefab,subRootParent:cc.Node,fireballPrefab:cc.Prefab,waterPrefab:cc.Prefab,hitPrefab:cc.Prefab,hitFireballPrefab:cc.Prefab,backgroundView:n,labelPosition:cc.Label,spriteFrameTrap:[cc.SpriteFrame],skipButton:r,startAnimation:cc.Prefab,goalAnimation:cc.Prefab,cutinAnimation:cc.Prefab},_minigameManager:null,deadLine:null,rewardId:null,rewardKind:null,rewardCount:null,characterIdList:null,winLane:0,rivalLane:0,characterSelectSubRoot:null,resultSubRoot:null,selectedLane:null,minigameData:null,onLoad:function(){cc.log("onLoad"),this._super(),c.soundManager.stopAll()},initData:function(){cc.log("initData"),this.characterIdList=this._getRandomCharacterId(),this.deadLine="2019/12/31 23:59",this.rewardId=1001,this.rewardKind=1,this.rewardCount=99,this.requestURLCount+=1,c.MinigameService.getList(function(t){this.requestURLCount-=1,t.minigameData?this.minigameData=t.minigameData[0]:c[l.ERROR_MANAGER].throwError(u.MINIGAME_MASTER_ERROR,void 0)}.bind(this))},initResource:function(){this._minigameManager=new o(this),this._minigameManager.loadResource(this.characterIdList)},initialize:function(){this._minigameManager.setBackground(this.backgroundView),s.openCharacterSelectSubRoot(this)},setResult:function(t,e){this.winLane=t,this.rivalLane=e},startMinigame:function(t){this.selectedLane=t,s.closeCharacterSelectSubRoot(this),c.MinigameService.play(t,function(t){t&&(this.setResult(t.winLane,t.rivalLane),this._minigameManager.addCharacter(this.characterIdList),this._minigameManager.playStartAnimation())}.bind(this))},showResult:function(){s.openResultSubRoot(this)},updateChild:function(t){this._minigameManager.update(t)},onRun:function(){cc.log("onRun"),this._minigameManager.run()},onStop:function(){cc.log("onStop"),this._minigameManager.stop()},onRush:function(){cc.log("onRush"),this._minigameManager.rush()},onRushOff:function(){cc.log("onRush"),this._minigameManager.rushOff()},onAddCharacter:function(){cc.log("onAddCharacter"),this._minigameManager.addCharacter([100101,100101,100101,100101])},onJump:function(){this._minigameManager.jump(0)},onDeath:function(){this._minigameManager.death(0)},onAddTrap:function(){cc.log("onAddTrap"),this._minigameManager.createTrap(0,1)},onSpeedDown:function(){cc.log("onSpeedDown"),this._minigameManager.speedDown()},onSpeedNormal:function(){cc.log("onSpeedNormal"),this._minigameManager.speedNormal()},transitionHomeRoot:function(){this.pushScene("HomeScene")},_getRandomCharacterId:function(){for(var t=[],e=_.sampleSize(c.dao.MinigameCharacterMainMasters,5),i=0;i<5;i+=1)e[i]?t.push(e[i].getCharacterId()):t.push(100101);return t}}),cc._RF.pop()},{BackgroundView:"BackgroundView",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ErrorCode:"ErrorCode",GameRootBase:"GameRootBase",MinigameManager:"MinigameManager",MinigameRootUtils:"MinigameRootUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MinigameService:[function(t,e,i){"use strict";cc._RF.push(e,"7bd79bJBClLCoHU4PfNstzS","MinigameService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,play:function(t,e){var i={lane:t};this._requestCallApi(n.MINIGAME_PLAY,i,function(t,i){return e(t?void 0:i)})},getList:function(t){this._requestCallApi(n.MINIGAME_GET_LIST,{},function(e,i){return t(e?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],MissionApis:[function(t,e,i){"use strict";cc._RF.push(e,"ac1bdTc/qZCcr6LTywWbukl","MissionApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.MISSION_GET_MASTER_DATA,path:"mission/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.MISSION_GET_USER_DATA,path:"mission/getUserData",method:"POST"}),a.RESTClient.graft({name:n.MISSION_RECEIVE,path:"mission/receive",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],MissionBackButton:[function(t,e,i){"use strict";cc._RF.push(e,"a315b2i44lMyZH0RXl/ocCJ","MissionBackButton"),cc.Class({extends:cc.Component,properties:{},backMyPageScene:function(){cc.director.loadScene("HomeScene.fire")}}),cc._RF.pop()},{}],MissionConst:[function(t,e,i){"use strict";cc._RF.push(e,"0cbce5OcvBPJbDZiQeLOb6I","MissionConst");var a=t("SceneConst");e.exports={MISSION_TAB:cc.Enum({DAILY:0,WEEK:1,NORMAL:2,EVENT:3}),MISSION_CATEGORY:cc.Enum({NORMAL:1,DAILY:2,WEEK:3,EVENT:4,PANEL:13}),PANEL_MISSION_CONST:{TAB_INDEX:{FIRST:0,SECOND:1,THIRD:2,FOURTH:3},MISSION_TYPE:{BEGINNER:"BEGINNER"},MISSION_GROUP_ID_TYPE:{BEGINNER:{FIRST:1300001,SECOND:1300002,THIRD:1300003,FOURTH:1300004}}},MAX_BADGE_COUNT:99,MISSION_SETTING:{LOGIN_COUNT:{type:1,sceneName:""},LOGIN_TIME:{type:2,sceneName:""},TARGET_ITEM_GET:{type:3,sceneName:a.SCENE.FILE_NAME.QUEST},CHARACTER_FORTIFY_COUNT:{type:101,sceneName:a.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT},CHARACTER_EXCEED_LIMIT_COUNT:{type:102,sceneName:a.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT},CHARACTER_MAX_FRIENDSHIP:{type:104,sceneName:a.SCENE.FILE_NAME.ROOM},CHARACTER_MAX_EXCEED_LIMIT:{type:105,sceneName:a.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT},TARGET_CHARACTER_GET:{type:106,sceneName:a.SCENE.FILE_NAME.QUEST},TARGET_CHARACTER_MAX_LEVEL:{type:107,sceneName:a.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT},TARGET_CHARACTER_MAX_FRIENDSHIP:{type:108,sceneName:a.SCENE.FILE_NAME.ROOM},TARGET_CHARACTER_TOTAL_FRIENDSHIP:{type:109,sceneName:a.SCENE.FILE_NAME.ROOM},TARGET_CHARACTER_LEVEL:{type:110,sceneName:a.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT},EQUIPMENT_FORTIFY_COUNT:{type:201,sceneName:a.SCENE.FILE_NAME.EQUIPMENT},EQUIPMENT_EXCEED_LIMIT_COUNT:{type:203,sceneName:a.SCENE.FILE_NAME.EQUIPMENT},EQUIPMENT_MAX_EXCEED_LIMIT:{type:204,sceneName:a.SCENE.FILE_NAME.EQUIPMENT},TARGET_EQUIPMENT_GET:{type:205,sceneName:a.SCENE.FILE_NAME.QUEST},TARGET_EQUIPMENT_MAX_LEVEL:{type:206,sceneName:a.SCENE.FILE_NAME.EQUIPMENT},SKILL_LEVEL_UP_COUNT:{type:301,sceneName:a.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT},ABILITY_LEVEL_UP_COUNT:{type:303,sceneName:a.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT},PICTURE_BOOK_CHARACTER_COUNT:{type:401,sceneName:a.SCENE.FILE_NAME.GACHA},USER_LEVEL_UP_COUNT:{type:501,sceneName:a.SCENE.FILE_NAME.QUEST},STAGE_CLEAR_COUNT:{type:502,sceneName:a.SCENE.FILE_NAME.QUEST},TARGET_STAGE_CLEAR_COUNT:{type:503,sceneName:a.SCENE.FILE_NAME.QUEST},QUEST_ACHIEVE_TOTAL_COUNT:{type:504,sceneName:a.SCENE.FILE_NAME.QUEST},QUEST_BATTLE_SKILL_TOTAL_COUNT:{type:505,sceneName:a.SCENE.FILE_NAME.QUEST},TARGET_GACHA_COUNT:{type:601,sceneName:a.SCENE.FILE_NAME.GACHA},ROOM_COLLECT_COUNT:{type:701,sceneName:a.SCENE.FILE_NAME.ROOM},ROOM_FURNITURE_COUNT:{type:702,sceneName:a.SCENE.FILE_NAME.ROOM},MISSION_CLEAR_COUNT:{type:901,sceneName:""},TARGET_EVENT_ITEM_TOTAL_COUNT:{type:1001,sceneName:a.SCENE.FILE_NAME.QUEST},TARGET_RAID_RELIEF_ENTRY_COUNT:{type:1101,sceneName:a.SCENE.FILE_NAME.QUEST},TARGET_RAID_MVP_COUNT:{type:1102,sceneName:a.SCENE.FILE_NAME.QUEST},OLD_TOWER_CHALLENGE_COUNT:{type:1201,sceneName:a.SCENE.FILE_NAME.TOWER},TOWER_CHALLENGE_COUNT:{type:1202,sceneName:a.SCENE.FILE_NAME.TOWER},OLD_PVP_CHALLENGE_COUNT:{type:1301,sceneName:a.SCENE.FILE_NAME.PVP},PVP_WIN_COUNT:{type:1302,sceneName:a.SCENE.FILE_NAME.PVP},PVP_CHALLENGE_COUNT:{type:1303,sceneName:a.SCENE.FILE_NAME.PVP}},THUMBNAIL_CONST:{ACHIEVE:{NOT_DONE:0,DONE:1},RECEIVE:{NOT_DONE:0,DONE:-2}}},cc._RF.pop()},{SceneConst:"SceneConst"}],MissionDetailEventListView:[function(t,e,i){"use strict";cc._RF.push(e,"1aee9Eg/ChMpqG1cHseJQAH","MissionDetailEventListView");var a=t("CommonUtils"),n=t("CommonScrollView"),o=t("ListViewBase");cc.Class({extends:o,properties:{scrollView:n,missionEventHeaderPrefab:cc.Prefab},initMissionDetailEventListView:function(t,e){this._userMissionArray=e,this.initListView(t),this.scrollView.scrollToTop()},_setListContent:function(t){if(t.deleteUpdateCallbackKey("MissionEventThumbnail",function(){this.thumbnailParentNode.destroyAllChildren()}.bind(this)),Array.isArray(this._userMissionArray)&&!(this._userMissionArray.length<=0)){var e=[];e.push({getterName:"getIndex",order:"asc"}),this._userMissionArray=a.sortModels(this._userMissionArray,e);var i=cc.instantiate(this.missionEventHeaderPrefab).getComponent("MissionEventHeaderThumbnailView");i.initMissionEventHeader(this._userMissionArray[0].getEventMainMater().getName(),this._userMissionArray[0].getMissionMainMater().getToDate()),this.thumbnailParentNode.addChild(i.node);var n=0;t.setUpdateCallback(function(){return n>=this._userMissionArray.length||(this._addThumbnail(this._userMissionArray[n]),n+=1,!1)}.bind(this),"MissionEventThumbnail")}},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("MissionThumbnailView");e.initMissionThumbnail(this._root,t),this.thumbnailParentNode.addChild(e.node)},getUpdateCallbackKey:function(){return"MissionEventThumbnail"}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",ListViewBase:"ListViewBase"}],MissionDetailEventTabView:[function(t,e,i){"use strict";cc._RF.push(e,"21d03DWNTpB2qbjbYLDDBkj","MissionDetailEventTabView");var a=t("Singleton"),n=t("TimeUtils"),o=t("EventUtils"),r=(t("CommonUtils"),t("VariableTabViewBase")),s=t("MissionDetailEventListView"),c=t("MissionConst");cc.Class({extends:r,properties:{missionDetailEventListView:s},_root:null,_tabBtnArray:null,_eventMissionMap:null,_availableEventMissionMainMasterMap:null,_eventMainMasterMap:null,initMissionDetailEventTabView:function(t,e){this._root=t,this._eventMissionMap=this._createEventMissionMap(),this._eventMainMasterMap=o.getEventMainMasterMap(),this._availableEventMissionMainMasterMap=this._createEventMissionMainMasterMap(),Array.isArray(this._tabBtnArray)||(this._tabBtnArray=this._createTabButtons()),this.initVariableTabViewBase(t,this._tabBtnArray),this._setCurrentTab(e),this._activateTab(this.getCurrentTab()),this.setCallbackToTabEvent(this._onChangeTab.bind(this))},drawMissionDetailEventTabView:function(){this._eventMissionMap=this._createEventMissionMap(),this._activateTab(this.getCurrentTab()),this._drawAttention()},_drawAttention:function(){for(var t=Object.keys(this._availableEventMissionMainMasterMap),e=0;e<t.length;e+=1)this.tabBtnArray[e]&&(Array.isArray(this._eventMissionMap[t[e]])?this.tabBtnArray[e].drawAttention(this._eventMissionMap[t[e]]):this.tabBtnArray[e].drawAttention([]))},_createEventMissionMainMasterMap:function(){for(var t=_.filter(a.dao.MissionMainMasters,function(t){return n.isRangeOfDate(t.getFromDate(),t.getToDate())&&t.getCategory()===c.MISSION_CATEGORY.EVENT}),e={},i=0;i<t.length;i+=1)e[t[i].getMissionGroupId()]=t[i];return e},_createEventMissionMap:function(){var t=this._root.getUserMissionCategoryMap()[c.MISSION_CATEGORY.EVENT];return _.groupBy(t,function(t){return t.getMissionGroupId()})},_createTabButtons:function(){for(var t,e,i=[],a=Object.keys(this._availableEventMissionMainMasterMap),n=0;n<a.length;n+=1){var o=this.getTabButtonPrefab(n,a.length),r=cc.instantiate(o).getComponent("TabButton");(t=this._availableEventMissionMainMasterMap[a[n]])&&(e=this._eventMainMasterMap[t.getEventId()])&&(r.initTabButton(e.getName(),!0),i.push(r),this.setTabBtn(r,n))}return i},_onChangeTab:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){!Array.isArray(this.tabBtnArray)||this.tabBtnArray.length<=0||(this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this.missionDetailEventListView.initMissionDetailEventListView(this._root,this._eventMissionMap[Object.keys(this._availableEventMissionMainMasterMap)[t]]))}});cc._RF.pop()},{CommonUtils:"CommonUtils",EventUtils:"EventUtils",MissionConst:"MissionConst",MissionDetailEventListView:"MissionDetailEventListView",Singleton:"Singleton",TimeUtils:"TimeUtils",VariableTabViewBase:"VariableTabViewBase"}],MissionDetailEventTopView:[function(t,e,i){"use strict";cc._RF.push(e,"dc783iNUS1G+5aY6WRrhwdM","MissionDetailEventTopView");var a=t("MissionDetailTopViewBase"),n=t("MissionDetailEventTabView");cc.Class({extends:a,properties:{missionDetailEventTabView:n},initMissionDetailTopView:function(t,e){this.missionDetailEventTabView.initMissionDetailEventTabView(t,e)},drawMissionDetailTopView:function(t,e){this.missionDetailEventTabView.drawMissionDetailEventTabView()}});cc._RF.pop()},{MissionDetailEventTabView:"MissionDetailEventTabView",MissionDetailTopViewBase:"MissionDetailTopViewBase"}],MissionDetailModel:[function(t,e,i){"use strict";cc._RF.push(e,"28f29WOFDRKGqqFXaV0nK1G","MissionDetailModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getMissionType:function(){if(this._isKeyFieldAvailable("missionType"))return this._data.missionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionType")},getMissionGroupId:function(){if(this._isKeyFieldAvailable("missionGroupId"))return this._data.missionGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionGroupId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getMissionId:function(){if(this._isKeyFieldAvailable("missionId"))return this._data.missionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionId")},getReleaseMissionId:function(){if(this._isKeyFieldAvailable("releaseMissionId"))return this._data.releaseMissionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: releaseMissionId")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getConditionCount:function(){if(this._isKeyFieldAvailable("conditionCount"))return this._data.conditionCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: condition")},getConditionId:function(){if(this._isKeyFieldAvailable("conditionId"))return this._data.conditionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MissionDetailNormalTopView:[function(t,e,i){"use strict";cc._RF.push(e,"e7841vfhMpG/4qLh806hMCL","MissionDetailNormalTopView");var a=t("MissionDetailTopViewBase"),n=t("MissionScrollView");cc.Class({extends:a,properties:{missionScrollView:n},initMissionDetailTopView:function(t,e){},drawMissionDetailTopView:function(t,e){this.missionScrollView.initMissionScrollView(t,e)},activateMissionDetailTopView:function(){this.missionScrollView.scrollToTop()}});cc._RF.pop()},{MissionDetailTopViewBase:"MissionDetailTopViewBase",MissionScrollView:"MissionScrollView"}],MissionDetailTabButton:[function(t,e,i){"use strict";cc._RF.push(e,"45234yPe35A943IlXJUYmIz","MissionDetailTabButton");var a=t("TabButton"),n=t("MissionConst");cc.Class({extends:a,properties:{attentionParentNode:cc.Node,attentionPlusNode:cc.Node,attentionCountLabel:cc.Label},drawAttention:function(t){var e=_.filter(t,function(t){return t.getIsReceivable()}).length;e<=0?this.attentionParentNode.active=!1:e>n.MAX_BADGE_COUNT?(this.attentionParentNode.active=!0,this.attentionCountLabel.string=n.MAX_BADGE_COUNT,this.attentionPlusNode.active=!0):(this.attentionParentNode.active=!0,this.attentionCountLabel.string=e,this.attentionPlusNode.active=!1)}});cc._RF.pop()},{MissionConst:"MissionConst",TabButton:"TabButton"}],MissionDetailTopViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"40bd5THuvNHx45V+OWYuEnT","MissionDetailTopViewBase");cc.Class({extends:cc.Component,properties:{},initMissionDetailTopView:function(){},drawMissionDetailTopView:function(t,e){},activateMissionDetailTopView:function(){}});cc._RF.pop()},{}],MissionEventHeaderThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"63515zhUjxFKohCt0Agobfj","MissionEventHeaderThumbnailView");var a=t("TimeUtils");cc.Class({extends:cc.Component,properties:{eventNameLabel:cc.Label,eventEndDateDayLabel:cc.Label,eventEndDateHourLabel:cc.Label,eventEndDateMinuteLabel:cc.Label},initMissionEventHeader:function(t,e){this.eventNameLabel.string=t,this._setEndDateText(e)},_setEndDateText:function(t){var e=a.getDiffMS(t),i=a.parseMsToDay(e),n=a.parseMsToHour(e),o=a.parseMsToMinute(e);this.eventEndDateDayLabel.node.active=!1,this.eventEndDateHourLabel.node.active=!1,this.eventEndDateMinuteLabel.node.active=!1,i>=1?(this.eventEndDateDayLabel.node.active=!0,this.eventEndDateDayLabel.string=i):n>=1?(this.eventEndDateHourLabel.node.active=!0,this.eventEndDateHourLabel.string=n):(this.eventEndDateMinuteLabel.node.active=!0,this.eventEndDateMinuteLabel.string=o)}});cc._RF.pop()},{TimeUtils:"TimeUtils"}],MissionMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"03406z32KFA/ZpQsIsIWi/3","MissionMainModel");var a=t("MasterDatabase"),n=t("Singleton")[t("SingletonConst").ERROR_MANAGER];cc.Class({extends:a,getCategory:function(){if(this._isKeyFieldAvailable("category"))return this._data.category;n.throwModelPropertyNotFoundError("object field is invalid :: category")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n.throwModelPropertyNotFoundError("object field is invalid :: index")},getMissionGroupId:function(){if(this._isKeyFieldAvailable("missionGroupId"))return this._data.missionGroupId;n.throwModelPropertyNotFoundError("object field is invalid :: missionGroupId")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n.throwModelPropertyNotFoundError("object field is invalid :: toDate")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n.throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n.throwModelPropertyNotFoundError("object field is invalid :: eventId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MissionModel:[function(t,e,i){"use strict";cc._RF.push(e,"0c167ikGN9A5ZtZcxHmV2iq","MissionModel");var a=t("UserMissionModel"),n=(t("CommonUtils"),t("Singleton"));cc.Class({userData:void 0,_releaseMissionModel:void 0,_missionMainMaster:void 0,_missionDetailMaster:void 0,_missionRewardMaster:void 0,_eventMainMaster:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._releaseMissionModel=null,this._missionMainMaster=null,this._missionDetailMaster=null,this._missionRewardMaster=null,this._eventMainMaster=null},getMissionMainMater:function(){return this._missionMainMaster||(this._missionMainMaster=n.dao.MissionMainMasters.find(function(t){return t.getMissionGroupId()===this.getMissionGroupId()}.bind(this))),this._missionMainMaster},getMissionDetailMaster:function(){return this._missionDetailMaster||(this._missionDetailMaster=_.find(n.dao.MissionDetailMasters,function(t){return t.getMissionId()===this.getMissionId()}.bind(this))),this._missionDetailMaster},getMissionRewardMater:function(){return this._missionRewardMaster||(this._missionRewardMaster=_.filter(n.dao.MissionRewardMasters,function(t){return t.getMissionId()===this.getMissionId()}.bind(this))),this._missionRewardMaster},getReleaseMissionModel:function(){return this._releaseMissionModel||(this._releaseMissionModel=_.find(n.dao.userMissions,function(t){return t.getMissionId()===this.getReleaseMissionId()}.bind(this))),this._releaseMissionModel},getEventMainMater:function(){return this._eventMainMaster||(this._eventMainMaster=n.dao.EventMainMasters.find(function(t){return t.getEventId()===this.getMissionMainMater().getEventId()}.bind(this))),this._eventMainMaster},getClearCount:function(){return Math.min(this.userData.getClearCount(),this.getConditionCount())},getCategory:function(){return this.getMissionMainMater().getCategory()},getIndex:function(){return this.getMissionMainMater().getIndex()},getMissionId:function(){return this.userData.getMissionId()},getMissionGroupId:function(){return this.userData.getMissionGroupId()},getMissionCd:function(){return this.userData.getMissionCd()},getName:function(){return this.getMissionDetailMaster().getName()},getText:function(){return this.getMissionDetailMaster().getText()},getCount:function(){return this.getMissionRewardMater().getCount()},getItemId:function(){return this.getMissionRewardMater().getItemId()},getItemType:function(){return this.getMissionRewardMater().getItemType()},getReceiveCount:function(){return this.userData.getReceiveCount()},getMissionType:function(){return this.getMissionDetailMaster().getMissionType()},getReleaseMissionId:function(){return this.getMissionDetailMaster().getReleaseMissionId()},getConditionCount:function(){return this.getMissionDetailMaster().getConditionCount()},getConditionId:function(){return this.getMissionDetailMaster().getConditionId().split(",")},getIsReceivable:function(){return!!this.getIsCompleted()&&!this.getIsReceived()},getIsCompleted:function(){return this.getClearCount()>=this.getConditionCount()},getIsReceived:function(){return this.getReceiveCount()>0},getIsReleased:function(){var t=this.getReleaseMissionModel();return!t||!!t.getIsReceived()}});cc._RF.pop()},{CommonUtils:"CommonUtils",Singleton:"Singleton",UserMissionModel:"UserMissionModel"}],MissionResultAllPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e5ee3xKXRVJjb3UzEJ3IgxO","MissionResultAllPopup");var a=t("CommonButton"),n=t("PopupBase"),o=t("CommonScrollView"),r=t("CharacterUtils"),s=t("ItemConst"),c=t("CharacterConst"),l=t("Singleton"),u={UNIT:{IDX:0,NAME:"\u30e6\u30cb\u30c3\u30c8"},FORTIFY_MATERIAL:{IDX:1,NAME:"\u5f37\u5316\u7d20\u6750"},ITEM:{IDX:2,NAME:"\u30a2\u30a4\u30c6\u30e0"},EQUIPMENT:{IDX:3,NAME:"\u88c5\u5099"},FURNITURE:{IDX:4,NAME:"\u5bb6\u5177"},GAME_MONEY:{IDX:5,NAME:"\u30b2\u30fc\u30e0\u5185\u901a\u8ca8"},GEM:{IDX:6,NAME:"\u5e7b\u5922\u77f3"},AP:{IDX:7,NAME:"AP"}};cc.Class({extends:n,properties:{confirmOkBtn:a,confirmCancelBtn:a,completeOkBtn:a,missionResultGetItemViewPrefab:cc.Prefab,confirmTextNode:cc.Node,completeTextNode:cc.Node,scrollView:o},_missionRewardArray:null,_callback:null,openMissionResultAllPopup:function(t,e,i){this._missionRewardArray=_.flatMap(t,function(t){return t.getMissionRewardMater()});for(var n=Object.keys(u).map(function(t){return{name:u[t].NAME,count:0}}),o=0;o<this._missionRewardArray.length;o+=1)this._addReward(this._missionRewardArray[o],n);this.scrollView.content.destroyAllChildren();for(o=0;o<n.length;o++)switch(o){case u.GAME_MONEY.IDX:for(var r in n[o].items){if(n[o].items[r].count>0)(s=cc.instantiate(this.missionResultGetItemViewPrefab).getComponent("SimpleThumbnail")).initSimpleThumbnail(n[o].items[r].name,n[o].items[r].count),this.scrollView.content.addChild(s.node)}break;default:var s;if(n[o].count>0)(s=cc.instantiate(this.missionResultGetItemViewPrefab).getComponent("SimpleThumbnail")).initSimpleThumbnail(n[o].name,n[o].count),this.scrollView.content.addChild(s.node)}e?(this.setCloseCallBack(i),this.completeOkBtn.setTapEvent(this._completeOkBtnEvent.bind(this)),this.confirmOkBtn.node.active=!1,this.confirmCancelBtn.node.active=!1,this.completeOkBtn.node.active=!0,this.confirmTextNode.active=!1,this.completeTextNode.active=!0):(this._callback=i,this.confirmOkBtn.setTapEvent(this._confirmOkBtnEvent.bind(this)),this.confirmCancelBtn.setTapEvent(this._confirmCancelBtnEvent.bind(this),a.SE_NAME.CANCEL),this.confirmOkBtn.node.active=!0,this.confirmCancelBtn.node.active=!0,this.completeOkBtn.node.active=!1,this.confirmTextNode.active=!0,this.completeTextNode.active=!1),this.open()},_confirmOkBtnEvent:function(){this.setCloseCallBack(this._callback),this.close()},_confirmCancelBtnEvent:function(){this.close()},_completeOkBtnEvent:function(){this.close()},_addReward:function(t,e){switch(t.getItemType()){case s.ITEM_TYPE.CHARACTER:this._addCharacterReward(t,e);break;case s.ITEM_TYPE.EQUIPMENT:e[u.EQUIPMENT.IDX].count+=t.getCount();break;case s.ITEM_TYPE.EQUIPMENT_FORTIFY_MATERIAL:e[u.FORTIFY_MATERIAL.IDX].count+=t.getCount();break;case s.ITEM_TYPE.GOLD:case s.ITEM_TYPE.GACHA_POINT:case s.ITEM_TYPE.EXCHANGE_POINT:if(e[u.GAME_MONEY.IDX].items||(e[u.GAME_MONEY.IDX].items={}),e[u.GAME_MONEY.IDX].items[t.getItemId()])e[u.GAME_MONEY.IDX].items[t.getItemId()].count+=t.getCount();else{var i=_.find(l.dao.ItemMainMasters,function(e){return e.getItemId()===t.getItemId()&&e.getItemType()===t.getItemType()});i&&(e[u.GAME_MONEY.IDX].items[t.getItemId()]={name:i.getName(),count:t.getCount()})}break;case s.ITEM_TYPE.FREE_GEM:case s.ITEM_TYPE.PAID_GEM:e[u.GEM.IDX].count+=t.getCount();break;case s.ITEM_TYPE.AP:e[u.AP.IDX].count+=t.getCount();break;default:e[u.ITEM.IDX].count+=t.getCount()}},_addCharacterReward:function(t,e){switch(r.getCharacterMainModelByCharacterId(t.getItemId()).getCharacterType()){case c.CHARACTER_TYPE.FORTIFY:case c.CHARACTER_TYPE.EXCEEDLIMIT:case c.CHARACTER_TYPE.SKILL_UP:case c.CHARACTER_TYPE.ABILITY_UP:e[u.FORTIFY_MATERIAL.IDX].count+=t.getCount();break;default:e[u.UNIT.IDX].count+=t.getCount()}}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",ItemConst:"ItemConst",PopupBase:"PopupBase",Singleton:"Singleton"}],MissionResultPopup:[function(t,e,i){"use strict";cc._RF.push(e,"8c6d3ztkm9KnI8uQKI3aPZW","MissionResultPopup");var a=t("CommonButton"),n=t("PopupBase"),o=t("ItemUtils"),r=t("CommonScrollView");cc.Class({extends:n,properties:{okBtn:a,simpleWidthThumbnailPrefab:cc.Prefab,scrollView:r},openMissionResultPopup:function(t,e){for(var i=t.getMissionRewardMater(),a=0;a<i.length;a+=1){var n=cc.instantiate(this.simpleWidthThumbnailPrefab).getComponent("SimpleThumbnail"),r=o.getItemInfo(i[a].getItemType(),i[a].getItemId());n.initSimpleThumbnail(r.name,i[a].getCount()),this.scrollView.content.addChild(n.node)}this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.setCloseCallBack(e),this.open()},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],MissionRewardModel:[function(t,e,i){"use strict";cc._RF.push(e,"83f602ejotJUqmKnTbtg8tp","MissionRewardModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getMissionId:function(){if(this._isKeyFieldAvailable("missionId"))return this._data.missionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionId")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MissionRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"0ded0aYAHlJD6CQ9poq5+9w","MissionRootUtils"),e.exports={openMissionTabView:function(t,e){cc.log("openMissionTabView"),cc.log(e);var i=e.selectedTab;void 0===t._missionTabView||null===t._missionTabView?(t._missionTabView=cc.instantiate(t.missionTabViewPrefab).getComponent("MissionTabView"),t._missionTabView.initMissionTabView(t,i),t.subRootParent.addChild(t._missionTabView.node)):cc.log("View\u306f\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002")},closeMissionTabView:function(t,e){cc.log("closeMissionTabView"),cc.log(e),null!==t._missionTabView&&(t._missionTabView.node.destroy(),t._missionTabView=null)}},cc._RF.pop()},{}],MissionRoot:[function(t,e,i){"use strict";cc._RF.push(e,"1d9edc/vmZCc6X0R6Lr6UHB","MissionRoot");var a=t("OutGameRootBase"),n=t("Singleton"),o=(t("MissionTabView"),t("MissionViewSetting")),r=t("MissionConst"),s=t("MissionUtils"),c=t("PopupUtils");cc.Class({extends:a,properties:{missionTabViewPrefab:cc.Prefab,missionResultPopupPrefab:cc.Prefab,missionResultAllPopupPrefab:cc.Prefab},_missionTabView:null,_missionResultPopup:null,_missionResultAllPopup:null,_userMissionCategoryMap:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,o.MISSION_SETTING)},reload:function(){this._userMissionCategoryMap=s.getMissionSceneUserMissionCategoryMap()},redraw:function(){this.redrawUIHeader(),this._missionTabView&&this._missionTabView.redraw()},initData:function(){this.reload()},initialize:function(){var t={MissionTabView:{selectedTab:this.getActiveTab()}};this._initOpenFirstView(t)},createPreViewParam:function(){return{MissionTabView:{selectedTab:this._missionTabView.getComponent("MissionTabView").getCurrentTab()}}},openMissionResultPopup:function(t){this.closeMissionResultPopup(),this._missionResultPopup=cc.instantiate(this.missionResultPopupPrefab).getComponent("MissionResultPopup"),this._missionResultPopup.openMissionResultPopup(t)},closeMissionResultPopup:function(){this._missionResultPopup&&(this._missionResultPopup.close(),this._missionResultPopup=null)},openMissionResultAllPopup:function(t,e,i){this.closeMissionResultAllPopup(),this._missionResultAllPopup=cc.instantiate(this.missionResultAllPopupPrefab).getComponent("MissionResultAllPopup"),this._missionResultAllPopup.openMissionResultAllPopup(t,e,i)},closeMissionResultAllPopup:function(){this._missionResultAllPopup&&(this._missionResultAllPopup.close(),this._missionResultAllPopup=null)},openMissionResultByLimitPopup:function(){c.openCommonPopupOk("\u4e0a\u9650","AP\u304c999\u3092\u8d85\u3048\u308b\u305f\u3081\u3001\n\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002","",!1,void 0)},openMissionResultAllByLimitPopup:function(t,e){0===e.length?this.openMissionResultByLimitPopup():this.openMissionResultAllPopup(e,!0,function(){c.openCommonPopupOk("\u4e0a\u9650","AP\u304c999\u3092\u8d85\u3048\u308b\u305f\u3081\u3001\n\u4e00\u90e8\u4efb\u52d9\u306f\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002","",!1,void 0)})},getActiveTab:function(){for(var t=[r.MISSION_CATEGORY.DAILY,r.MISSION_CATEGORY.WEEK,r.MISSION_CATEGORY.NORMAL,r.MISSION_CATEGORY.EVENT],e=r.MISSION_CATEGORY.DAILY,i=0;i<t.length;i+=1){if(this._userMissionCategoryMap[t[i]].some(function(t){return t.getIsReceivable()})){e=t[i];break}}return this.convertMissionCategoryToMissionTab(e)},getUserMissionCategoryMap:function(){return this._userMissionCategoryMap},convertMissionCategoryToMissionTab:function(t){switch(t){case r.MISSION_CATEGORY.DAILY:return r.MISSION_TAB.DAILY;case r.MISSION_CATEGORY.WEEK:return r.MISSION_TAB.WEEK;case r.MISSION_CATEGORY.NORMAL:return r.MISSION_TAB.NORMAL;case r.MISSION_CATEGORY.EVENT:return r.MISSION_TAB.EVENT}return r.MISSION_TAB.DAILY},convertMissionTabToMissionCategory:function(t){switch(t){case r.MISSION_TAB.DAILY:return r.MISSION_CATEGORY.DAILY;case r.MISSION_TAB.WEEK:return r.MISSION_CATEGORY.WEEK;case r.MISSION_TAB.NORMAL:return r.MISSION_CATEGORY.NORMAL;case r.MISSION_TAB.EVENT:return r.MISSION_CATEGORY.EVENT}return r.MISSION_CATEGORY.DAILY},requestReceiveMissionGetItem:function(t){n.MissionService.receive([t.getMissionCd()],function(e){cc.log("mission_receive : \u901a\u4fe1\u5b8c\u4e86"),this.reload(),this.redraw(),e.notReceiveMissionCds.length>0?this.openMissionResultByLimitPopup():this.openMissionResultPopup(t)}.bind(this))},requestAllReceiveMissionGetItem:function(t){var e=t.filter(function(t){return t.getIsReceivable()}),i=e.map(function(t){return t.getMissionCd()});e.length>0?n.MissionService.receive(i,function(t){cc.log("mission_receive : \u901a\u4fe1\u5b8c\u4e86"),this.reload(),this.redraw();var i=_.remove(e,function(e){return _.some(t.notReceiveMissionCds,function(t){return t===e.getMissionCd()})});i.length>0?this.openMissionResultAllByLimitPopup(i,e):this.openMissionResultAllPopup(e,!0)}.bind(this)):c.openSimpleMessageWindow("\u53d7\u3051\u53d6\u308c\u308b\u5831\u916c\u304c\u3042\u308a\u307e\u305b\u3093",void 0)}});cc._RF.pop()},{MissionConst:"MissionConst",MissionTabView:"MissionTabView",MissionUtils:"MissionUtils",MissionViewSetting:"MissionViewSetting",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",Singleton:"Singleton"}],MissionScrollView:[function(t,e,i){"use strict";cc._RF.push(e,"dc1ddoQJ+9JmqpCj5bjvruU","MissionScrollView");var a=t("CommonScrollView"),n=t("CommonUtils"),o=t("MissionConst");cc.Class({extends:a,properties:{missionDetailViewPrefab:cc.Prefab,missionEventHeaderPrefab:cc.Prefab},_root:null,_userMissionArray:null,_selectedTab:0,initMissionScrollView:function(t,e){this._root=t,this._selectedTab=e,this.redraw()},redraw:function(){var t=[];t.push({getterName:"getIndex",order:"asc"}),this._userMissionArray=n.sortModels(this._root.getUserMissionCategoryMap()[this._root.convertMissionTabToMissionCategory(this._selectedTab)],t),this.content.destroyAllChildren();for(var e=0,i=0;i<this._userMissionArray.length;i+=1)if(this._userMissionArray[i].getIsReleased()){var a=cc.instantiate(this.missionDetailViewPrefab).getComponent("MissionThumbnailView");if(a.initMissionThumbnail(this._root,this._userMissionArray[i]),this._selectedTab===o.MISSION_TAB.EVENT&&e!==this._userMissionArray[i].getMissionGroupId()){e=this._userMissionArray[i].getMissionGroupId();var r=cc.instantiate(this.missionEventHeaderPrefab).getComponent("MissionEventHeaderThumbnailView");r.initMissionEventHeader(this._userMissionArray[i].getEventMainMater().getName(),this._userMissionArray[i].getMissionMainMater().getToDate()),this.content.addChild(r.node)}this.content.addChild(a.node)}}}),cc._RF.pop()},{CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",MissionConst:"MissionConst"}],MissionService:[function(t,e,i){"use strict";cc._RF.push(e,"c415eNz67ZJCbsVURh2HVy8","MissionService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,receive:function(t,e){var i={missionCds:t.join(",")};this._requestCallApi(n.MISSION_RECEIVE,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],MissionTabView:[function(t,e,i){"use strict";cc._RF.push(e,"e76777eIYdFL7YlTmqjGuch","MissionTabView");var a=t("CommonButton"),n=t("TabViewBase"),o=t("ViewUtils"),r=t("PictureBookUtils"),s=t("CharacterUtils"),c=t("Singleton"),l=t("MissionDetailTopViewBase"),u=t("CharacterConst"),h=t("MissionConst"),d=t("GameConst"),p=t("ItemConst"),m=0,g=1;cc.Class({extends:n,properties:{missionLabel:cc.Label,eventTabGrayOutNode:cc.Node,allReceiveBtn:a,missionTabBadgeNode:[cc.Node],missionTabBadgeCountLabelArray:[cc.Label],missionTabBadgePlusNodeArray:[cc.Node],characterStandViewParentNode:cc.Node,serifWindowPos:cc.Node,missionDetailTopViewArray:[l]},_root:null,_characterStandView:null,_serifBalloon:null,_userMissionCategoryMap:null,_missionDetailTopView:null,initMissionTabView:function(t,e){this._root=t,this.initTabViewBase(),this._setCurrentTab(e),this._activateTab(e),this._initMissionDetailTopViewArray(t),this._redrawMissionTabView(e),this._setAllReceiveBtnEvent(),this._initCharacterStandView(),this._reloadCharacterStandImage(),this._serifBalloon||(this._serifBalloon=o.createSerifWindow(),this.serifWindowPos.addChild(this._serifBalloon.node)),this._reloadSerifBalloon()},redraw:function(){this._redrawMissionTabView(this.getCurrentTab())},_initMissionDetailTopViewArray:function(t){_.forEach(this.missionDetailTopViewArray,function(e){e.initMissionDetailTopView(t,0)})},_drawMissionDetailTopView:function(t){switch(_.forEach(this.missionDetailTopViewArray,function(t){t.node.active=!1}),t){case h.MISSION_TAB.DAILY:case h.MISSION_TAB.WEEK:case h.MISSION_TAB.NORMAL:this._missionDetailTopView=this.missionDetailTopViewArray[m];break;case h.MISSION_TAB.EVENT:this._missionDetailTopView=this.missionDetailTopViewArray[g]}this._missionDetailTopView.node.active=!0,this._missionDetailTopView.drawMissionDetailTopView(this._root,t)},_redrawMissionTabView:function(t){this._userMissionCategoryMap=this._root.getUserMissionCategoryMap(),this._initActiveAttention(),this._drawMissionDetailTopView(t),this._userMissionCategoryMap[this._root.convertMissionTabToMissionCategory(t)].filter(function(t){return t.getIsReceivable()}).length>0?this.allReceiveBtn.switchBtnImage(!0):this.allReceiveBtn.switchBtnImage(!1),this.eventTabGrayOutNode.active=!1},_tabEvent:function(t,e,i){this._resetTab(),this._activateTab(e),this._redrawMissionTabView(e),this._missionDetailTopView.activateMissionDetailTopView()},_resetTab:function(){for(var t=0;t<this.tabBtnArray.length;t++)this.tabBtnArray[t].node.zIndex=-1},_setMissionLabel:function(t){t===h.MISSION_TAB.DAILY?this.missionLabel.string="\u203b\u30c7\u30a4\u30ea\u30fc\u4efb\u52d9\u306f\n\u6bce\u65e500:00\u306b\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002":t===h.MISSION_TAB.WEEK?this.missionLabel.string="\u203b\u30a6\u30a3\u30fc\u30af\u30ea\u30fc\u4efb\u52d9\u306f\n\u6bce\u9031\u6708\u66dc\u65e5\u306e00:00\u306b\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002":t===h.MISSION_TAB.NORMAL?this.missionLabel.string="\u203b\u30ce\u30fc\u30de\u30eb\u4efb\u52d9\u306f\n\u4e00\u5ea6\u3057\u304b\u9054\u6210\u3067\u304d\u307e\u305b\u3093\u3002":t===h.MISSION_TAB.EVENT&&(this.missionLabel.string="\u203b\u30a4\u30d9\u30f3\u30c8\u4efb\u52d9\u306f\n\u958b\u50ac\u7d42\u4e86\u5f8c2\u65e5\u9593\u307e\u3067\u53d7\u3051\u53d6\u308c\u307e\u3059\u3002")},_activateTab:function(t){for(var e=0;e<this.tabBtnArray.length;e+=1)e===t?this.tabBtnArray[e].switchBtnImage(!0):this.tabBtnArray[e].switchBtnImage(!1);this._setMissionLabel(t)},_initActiveAttention:function(){for(var t=0;t<this.tabBtnArray.length;t+=1){var e=this._root.convertMissionTabToMissionCategory(t),i=this._userMissionCategoryMap[e].filter(function(t){return t.getIsReceivable()}).length;i<=0?(this.missionTabBadgeNode[t].active=!1,this.missionTabBadgeCountLabelArray[t].node.active=!1,this.missionTabBadgePlusNodeArray[t].active=!1):i>h.MAX_BADGE_COUNT?(this.missionTabBadgeNode[t].active=!0,this.missionTabBadgeCountLabelArray[t].node.active=!0,this.missionTabBadgeCountLabelArray[t].string=h.MAX_BADGE_COUNT,this.missionTabBadgePlusNodeArray[t].active=!0):(this.missionTabBadgeNode[t].active=!0,this.missionTabBadgeCountLabelArray[t].node.active=!0,this.missionTabBadgeCountLabelArray[t].string=i,this.missionTabBadgePlusNodeArray[t].active=!1)}},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=o.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_reloadCharacterStandImage:function(){this._characterStandView.setCharacterStandImage(this._root.getNavigatorCharacterId())},_reloadSerifBalloon:function(){var t=[],e=[],i=s.getCharacterMainModelByCharacterId(this._root.getNavigatorCharacterId());r.getCharacterTextMasterArray(i.getCharacterId(),u.TEXT_SCENE_TYPE.MISSION).forEach(function(i){t.push(i.getText()),e.push(i.getVoiceFile())}),this._serifBalloon.setSerifContent(i.getCharacterId(),i.getShortName(),t,e),this._serifBalloon.playRandomSerifAnimation()},_setAllReceiveBtnEvent:function(){this.allReceiveBtn.setTapEvent(function(){var t=this._userMissionCategoryMap[this._root.convertMissionTabToMissionCategory(this.getCurrentTab())],e=c.dao[c.USER].getCurrentStaminaInfo().currentStamina,i=[],a=[],n=0;_.each(t,function(t){var o=_.sumBy(t.getMissionRewardMater(),function(t){return t.getItemType()===p.ITEM_TYPE.AP?t.getCount():0});e+n+o>d.MAX_USER_AP?i.push(t):(a.push(t),n+=o)}),0===a.length?this._root.openMissionResultByLimitPopup():this._root.requestAllReceiveMissionGetItem(t)}.bind(this),a.SE_NAME.RECEIVE)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",GameConst:"GameConst",ItemConst:"ItemConst",MissionConst:"MissionConst",MissionDetailTopViewBase:"MissionDetailTopViewBase",PictureBookUtils:"PictureBookUtils",Singleton:"Singleton",TabViewBase:"TabViewBase",ViewUtils:"ViewUtils"}],MissionThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"078277vsK1FdrMVd4wK6lZy","MissionThumbnailView");var a=t("CommonButton"),n=(t("ResourceUtils"),t("Singleton")),o=t("ItemUtils"),r=t("MatrixThumbnailUtils"),s=t("MissionConst"),c=t("ItemConst"),l=t("SceneConst"),u=t("GameConst");cc.Class({extends:cc.Component,properties:{missionName:cc.Label,missionText:cc.Label,missionSituationNow:cc.Label,missionSituationGoal:cc.Label,missionSituationProgressBar:cc.ProgressBar,missionIconLinkGrayOutNode:cc.Node,missionIconLinkBtn:a,missionIconGetItemBtn:a,missionClearNode:cc.Node,itemThumbnailParentNode:cc.Node,modelSimplePopupPrefab:cc.Prefab},_root:null,_userMissionModel:null,_isLink:null,initMissionThumbnail:function(t,e){this._root=t,this._userMissionModel=e,this._setLinkBtnEvent(),this._setReceiveBtnEvent(),this._initRewardItemSprite(),this.redraw()},redraw:function(){var t=this._userMissionModel.getMissionDetailMaster();this.missionName.string=t.getName(),this.missionText.string=t.getText();var e=this._userMissionModel.getClearCount(),i=t.getConditionCount(),a=String(i).length;a=a>1?-a:-2,String(e).length>-a?this.missionSituationNow.string=String(e):this.missionSituationNow.string=("00"+String(e)).slice(a),this.missionSituationGoal.string=("00"+String(i)).slice(a),this.missionSituationProgressBar.progress=e/i,this._setActive()},_initRewardItemSprite:function(){for(var t=this._userMissionModel.getMissionRewardMater(),e=0;e<3;e+=1){var i=t[e];if(i){var a={prefix:"x",count:i.getCount()},n=r.createMatrixThumbnailByItemType(i.getItemId(),i.getItemType(),a);n.setCallbackToThumbnailBtn(this._onTapItemThumbnail.bind(this,n.node,i.getItemId(),i.getItemType(),this.itemThumbnailParentNode.scale)),this.itemThumbnailParentNode.addChild(n.node)}}},_isNumberTypeReward:function(t){switch(t){case c.ITEM_TYPE.DMM_POINT:case c.ITEM_TYPE.FREE_GEM:case c.ITEM_TYPE.PAID_GEM:case c.ITEM_TYPE.GOLD:case c.ITEM_TYPE.GACHA_POINT:case c.ITEM_TYPE.EXCHANGE_POINT:return!0;default:return!1}},_setLinkBtnEvent:function(){var t=Object.keys(s.MISSION_SETTING).find(function(t){return s.MISSION_SETTING[t].type===this._userMissionModel.getMissionType()}.bind(this)),e=s.MISSION_SETTING[t].sceneName,i=this._userMissionModel.getConditionId();n.dao.TowerRewardMasters.some(function(t){return i.some(function(e){return t.getStageId()===Number(e)})})&&(e=l.SCENE.FILE_NAME.TOWER),e?"HomeScene"===e?(this.missionIconLinkBtn.setTapEvent(function(){this._root.pushScene(e,null,void 0,null)}.bind(this)),this._isLink=!0):(this.missionIconLinkBtn.setTapEvent(function(){var t={MissionTabView:{selectedTab:this._root.convertMissionCategoryToMissionTab(this._userMissionModel.getCategory())}};this._root.pushScene(e,this._root.getCurrentSceneName(),void 0,t)}.bind(this)),this._isLink=!0):this._isLink=!1},_setReceiveBtnEvent:function(){this.missionIconGetItemBtn.setTapEvent(function(){n.dao[n.USER].getCurrentStaminaInfo().currentStamina+_.sumBy(this._userMissionModel.getMissionRewardMater(),function(t){return t.getItemType()===c.ITEM_TYPE.AP?t.getCount():0})>u.MAX_USER_AP?this._root.openMissionResultByLimitPopup():this._root.requestReceiveMissionGetItem(this._userMissionModel)}.bind(this),a.SE_NAME.EXECUTE)},_setActive:function(){this.missionIconLinkGrayOutNode.active=!1,this.missionIconLinkBtn.node.active=!1,this.missionIconGetItemBtn.node.active=!1,this.missionClearNode.active=!1,this._userMissionModel.getIsCompleted()?this.missionIconGetItemBtn.node.active=!0:this._userMissionModel.getIsReceived()?(this.missionIconLinkGrayOutNode.active=!0,this.missionClearNode.active=!0):this._isLink&&(this.missionIconLinkBtn.node.active=!0)},_onTapItemThumbnail:function(t,e,i,a){var n=cc.instantiate(t),r=cc.instantiate(t),s=t.convertToWorldSpaceAR(cc.v2(0,0)),c=this._root.node.convertToNodeSpaceAR(s);this._root.node.addChild(r,u.Z_ORDER.POPUP),r.setScale(a),r.setPosition(c);var l=o.getItemInfo(i,e),h=cc.instantiate(this.modelSimplePopupPrefab).getComponent("ModelDetailPopup");h.node.setPosition(cc.v2(-100,c.y)),h.openModelDetailPopup(n,l.name,l.text,function(){r.destroy()},o.getUserItemCount(e,i))}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",MissionConst:"MissionConst",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton"}],MissionUtils:[function(t,e,i){"use strict";cc._RF.push(e,"8bb1bc6qJdE9YdXkS88u+J1","MissionUtils");var a=t("Singleton"),n=t("CommonUtils"),o=t("MissionConst"),r=t("SingletonConst"),s=t("LocalDataConst"),c=",";function l(){var t=Number.MAX_VALUE;return a.dao.userMissions.forEach(function(e){u(e)&&(t=Math.min(t,e.getMissionGroupId()))}),t}function u(t){return t.getCategory()===o.MISSION_CATEGORY.PANEL&&t.getMissionType()===o.MISSION_SETTING.MISSION_CLEAR_COUNT.type&&!1===t.getIsCompleted()}function h(t,e){return!!t&&(t.getCategory()!==o.MISSION_CATEGORY.PANEL||t.getMissionGroupId()===e)}function d(t){return a.dao.userMissions.filter(function(e){if(e.getIsReceived())return!1;var i=e.getMissionMainMater();return!!i&&t===i.getCategory()})}function p(t){return a.dao.userMissions.filter(function(e){return e.getCategory()===o.MISSION_CATEGORY.PANEL&&e.getMissionGroupId()===t})}e.exports={noticeMissionUpdate:function(t){if(Array.isArray(t)){var e=n.loadLocalStorage(s.LOCAL_STORAGE_KEY.FINISHED_MISSION_CDS,"",s.LOCAL_STORAGE_GET_TYPE.STRING).split(c).filter(function(t){return t.length>0});if(e.length>0&&(t=t.concat(e)),Array.isArray(a.dao.userMissions)){var i={},o=l();a.dao.userMissions.forEach(function(t){i[t.getMissionCd()]=t}),t.forEach(function(t){h(i[t],o)&&a[r.NOTICE_MANAGER].sendNoticeMessageWithGaugePoint(i[t].getText(),0,i[t].getClearCount(),i[t].getConditionCount())}),e.length>0&&n.saveLocalStorage(s.LOCAL_STORAGE_KEY.FINISHED_MISSION_CDS,"")}else{var u=t.join(c);n.saveLocalStorage(s.LOCAL_STORAGE_KEY.FINISHED_MISSION_CDS,u)}}},getCurrentPanelMissionGroupId:l,getMissionSceneUserMissionCategoryMap:function(){var t={},e=[o.MISSION_CATEGORY.DAILY,o.MISSION_CATEGORY.WEEK,o.MISSION_CATEGORY.NORMAL],i=[];return i.push({getterName:"getIsCompleted",order:"desc"}),i.push({getterName:"getMissionId",order:"asc"}),e.forEach(function(e){var a=d(e);t[e]=n.sortModels(a,i)}),i.unshift({getterName:"getMissionGroupId",order:"asc"}),t[o.MISSION_CATEGORY.EVENT]=n.sortModels(d(o.MISSION_CATEGORY.EVENT),i),t},getUserPanelMissionGroupIdMap:function(){var t={},e=_.values(o.PANEL_MISSION_CONST.MISSION_GROUP_ID_TYPE.BEGINNER),i=[];return i.push({getterName:"getMissionId",order:"asc"}),e.forEach(function(e){var a=p(e);t[e]=n.sortModels(a,i)}),t},isPanelMissionComplete:function(){var t=_.filter(a.dao.userMissions,function(t){return t.getMissionMainMater().getMissionGroupId()===o.PANEL_MISSION_CONST.MISSION_GROUP_ID_TYPE.BEGINNER.FOURTH});return _.every(t,function(t){return t.getReceiveCount()>0})}},cc._RF.pop()},{CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",MissionConst:"MissionConst",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MissionViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"adc409WRy5Na72kGvHjJm2x","MissionViewSetting");var a=t("MissionRootUtils");e.exports={MISSION_SETTING:{MissionTabView:{open:a.openMissionTabView,close:a.closeMissionTabView}}},cc._RF.pop()},{MissionRootUtils:"MissionRootUtils"}],ModelDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"30c1f7hrHdCg571r0UMGH38","ModelDetailPopup");var a=t("PopupBase");cc.Class({extends:a,properties:{nameLabel:cc.Label,descriptionLabel:cc.Label,countLabel:cc.Label,thumbnailParentNode:cc.Node},openModelDetailPopup:function(t,e,i,a,n){this._drawContent(t,e,i,n),this.setCloseCallBack(a),this.open()},_drawContent:function(t,e,i,a){t.scale=1,t.position=cc.v2(0,0),this.thumbnailParentNode.addChild(t),this.nameLabel.string=e,this.descriptionLabel.string=i,this.countLabel&&!_.isNaN(a)&&(this.countLabel.string=a)}});cc._RF.pop()},{PopupBase:"PopupBase"}],MonsterAvatarCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"ac12fl/jG9BdJGJidYeM785","MonsterAvatarCtrl");var a=cc.Class({extends:cc.Component,properties:{myBattleUnit:null,mainUnitAdjustPos:cc.Node,damageShowNode:cc.Node,effectShowNode:cc.Node,monsterEncount:cc.Animation},avatarShow:function(t,e){var i=this;this.monsterEncount.on("finished",function(e){i.monsterEncount.off("finished"),t()}.bind(this),this),this.monsterEncount.play()}});e.exports=a,cc._RF.pop()},{}],MonsterUnitCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"1f8b00zQtVO1r1G5bwFwdTe","MonsterUnitCtrl");var a=t("BattleData"),n=(t("CommonFunction"),t("BattleConstants")),o=t("SpineEventInterpreter"),r=t("BaseUnitCtrl"),s=cc.Class({extends:r,properties:{enemy_gaugeInAnim:cc.Animation,enemy_iconInAnim:cc.Animation,enemy_IconImage:cc.Sprite,nameLabel:cc.RichText,gaugeBaseNode:cc.Node},mainCardShow:function(t,e){var i=this;this.enemy_gaugeInAnim.on("finished",function(e){i.enemy_gaugeInAnim.off("finished"),t()}.bind(this),this),this.enemy_gaugeInAnim.play();var n=this.myBattleUnit.mainAvatar;n.node.runAction(cc.scaleTo(.5,1)),n.premultipliedAlpha=!0,n.setAnimation(0,"idle"+this.getAnimationAddName(),!0),a.GM.soundManager.playSE(a.RM.soundResourceList.EnemyAppears)},playShowIn:function(t,e){var i=this.myBattleUnit.mainAvatar;i.setCompleteListener(function(e,a){i.setCompleteListener(null),t()}),i.setAnimation(0,"in",!1)},iconShow:function(t,e){var i=this;this.enemy_iconInAnim.on("finished",function(e){i.enemy_iconInAnim.off("finished"),t()}.bind(this),this),this.enemy_iconInAnim.play()},setHp:function(t){this.hpGaugeBar.progress=t/this.myBattleUnit.getMaxHp()},setSkillRate:function(t){this.skillGaugeBar.progress=t/n.SKILLRATE_MAX},playAttack:function(t,e){var i=this.myBattleUnit.mainAvatar,r=i.timeScale;i.timeScale=n.NORMAL_ATTACK_SPEED_RATIO_MONSTER*a.cur_GameSpeed;var s=e.get("parentNode"),c=new cc.Node;c.parent=s,e.set("onEndDestroy",!1),e.set("main_spine",i);var l=new cc.Node,u=c.addComponent(o);l.parent=s,e.set("parentNode",a.UI_M.effectCenter),u.init(function(){i.timeScale=r,i.setAnimation(0,"idle"+this.getAnimationAddName(),!0),h||t()}.bind(this),e);var h=e.get("startDelay");h&&(h/=n.NORMAL_ATTACK_SPEED_RATIO_MONSTER,this.scheduleOnce(function(){t()},h))},playBeAttacked:function(t,e){var i=this,a=this.myBattleUnit.mainAvatar;e.isDead;if(this.nowPlayingDeath)t();else{this.myBattleUnit.mainAvatar.setAnimation(0,"damage"+this.getAnimationAddName(),!1);a.setCompleteListener(function(e,n){a.setCompleteListener(null),a.setAnimation(0,"idle"+i.getAnimationAddName(),!0),t()})}},playDead:function(t,e){var i=this.myBattleUnit.mainAvatar,n=e.get("fadeTime"),o=e.get("aliveExist");this.nowPlayingDeath=!0,i.setAnimation(0,"death"+this.getAnimationAddName(),!1);var r=this,s=this.myBattleUnit.avatarController.mainUnitAdjustPos;i.setCompleteListener(function(e,c){if(i.setCompleteListener(null),o)s.runAction(cc.fadeOut(n));else{var l=cc.sequence(cc.fadeOut(n),cc.callFunc(t,this));s.runAction(l)}a.GM.soundManager.playSE(a.RM.soundResourceList.DefeatEnemy),r.nowPlayingDeath=!1}),this.gaugeBaseNode.runAction(cc.fadeOut(n)),o&&t()},playRevive:function(t,e){this.myBattleUnit.mainAvatar.setAnimation(0,"idle"+this.getAnimationAddName(),!0),this.myBattleUnit.avatarController.mainUnitAdjustPos.opacity=255;var i=n.DEAD_FADEOUT_TIME/a.cur_GameSpeed;this.gaugeBaseNode.runAction(cc.fadeIn(i)),t()},playSpineSkill:function(t,e){var i=this.myBattleUnit.mainAvatar,n=a.UI_M.effectCenter,r=(e.get("aniName"),new cc.Node);r.parent=n,e.set("onEndDestroy",!1),e.set("main_spine",i),e.set("parentNode",a.UI_M.effectCenter);var s=new cc.Node,c=r.addComponent(o);s.parent=n,c.init(function(){i.setAnimation(0,"idle"+this.getAnimationAddName(),!0),t()}.bind(this),e)},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e--)this.updateCallbacks[e](t);this.updateBuffIcon(t),this.checkIsPlayingBuffContinueAnimation()||this.playBuffContinueAnimation()},playActionStart:function(t,e){t()}});e.exports=s,cc._RF.pop()},{BaseUnitCtrl:"BaseUnitCtrl",BattleConstants:"BattleConstants",BattleData:"BattleData",CommonFunction:"CommonFunction",SpineEventInterpreter:"SpineEventInterpreter"}],MovieController:[function(t,e,i){"use strict";cc._RF.push(e,"03111WNjdRIsLOUi08qI8Sj","MovieController");cc.Class({extends:cc.Component,properties:{autoplayOnReady:!1},onLoad:function(){},start:function(){},_isLoop:!1,_recentBackgroudColor:null,_videoPlayer:null,_callbackToTap:null,_callbackToEnd:null,setLoop:function(t){this._isLoop=t},playVideo:function(){this._videoPlayer&&this._videoPlayer.play()},pauseVideo:function(){this._videoPlayer&&(this._setVideoZIndex(this._videoPlayer,-1),this._videoPlayer.pause())},resumeVideo:function(){this._videoPlayer&&(this._setVideoZIndex(this._videoPlayer,0),cc.sys.isNative?this._videoPlayer.play():this._videoPlayer.resume())},removeVideo:function(){this._videoPlayer&&this._recentBackgroudColor&&(cc.Camera.main.backgroundColor=this._recentBackgroudColor,this._videoPlayer.node.destroy())},setTapEvent:function(t){this._callbackToTap=t},setCompleteListener:function(t){this._callbackToEnd=t},onEventVideoPlayer:function(t,e){switch(e){case cc.VideoPlayer.EventType.META_LOADED:this._onMetaLoaded(t);break;case cc.VideoPlayer.EventType.READY_TO_PLAY:this._onReadyToPlay(t);break;case cc.VideoPlayer.EventType.PLAYING:this._onPlaying(t);break;case cc.VideoPlayer.EventType.PAUSED:this._onPaused(t);break;case cc.VideoPlayer.EventType.STOPPED:this._onStopped(t);break;case cc.VideoPlayer.EventType.COMPLETED:this._onCompleted(t);break;case cc.VideoPlayer.EventType.CLICKED:this._onClicked(t)}},_onMetaLoaded:function(t){cc.log("movie - loaded")},_onReadyToPlay:function(t){cc.log("movie - ready"),this._recentBackgroudColor=cc.color(cc.Camera.main.backgroundColor.r,cc.Camera.main.backgroundColor.g,cc.Camera.main.backgroundColor.b,cc.Camera.main.backgroundColor.a),cc.Camera.main.backgroundColor=cc.color(0,0,0,0),cc.sys.isNative||(document.\u03bfnc\u03bfntextmenu=new Function("event.returnValue=false"),document.oncontextmenu=function(){event.returnValue=!1}),this._videoPlayer=t,this.autoplayOnReady&&this.playVideo()},_onPlaying:function(t){cc.log("movie - playing")},_onPaused:function(t){cc.log("movie - paused")},_onStopped:function(t){cc.log("movie - stopped")},_onCompleted:function(t){cc.log("movie - completed"),this._isLoop&&this.playVideo(),this._callbackToEnd&&this._callbackToEnd(this,t)},_onClicked:function(t){this._callbackToTap&&this._callbackToTap(this,t)},_setVideoZIndex:function(t,e){cc.sys.isNative||(t._impl._video.style.zIndex=e)}});cc._RF.pop()},{}],MyPageApis:[function(t,e,i){"use strict";cc._RF.push(e,"42aeflkm+NA6pUu1pFkZVaR","MyPageApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.MY_PAGE_REFRESH,path:"myPage/refresh",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],MyPageBannerModel:[function(t,e,i){"use strict";cc._RF.push(e,"736c6fPbXdPCrPa06Y7qT6B","MyPageBannerModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getTransitionParam1:function(){if(this._isKeyFieldAvailable("transitionParam1"))return this._data.transitionParam1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: transitionParam1")},getTransitionParam2:function(){if(this._isKeyFieldAvailable("transitionParam2"))return this._data.transitionParam2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: transitionParam2")},getTransitionParam3:function(){if(this._isKeyFieldAvailable("transitionParam3"))return this._data.transitionParam3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: transitionParam3")},getDateTo:function(){if(this._isKeyFieldAvailable("dateTo"))return this._data.dateTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateTo")},getDateFrom:function(){if(this._isKeyFieldAvailable("dateFrom"))return this._data.dateFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateFrom")},getFileName:function(){if(this._isKeyFieldAvailable("fileName"))return this._data.fileName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fileName")},getTransitionId:function(){if(this._isKeyFieldAvailable("transitionId"))return this._data.transitionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: transitionId")},getBannerId:function(){if(this._isKeyFieldAvailable("bannerId"))return this._data.bannerId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bannerId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MyPageCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"a45aad8GpFCxrHlYWCRR7hT","MyPageCharacterView");t("CommonButton");var a=t("CommonUtils"),n=t("Singleton"),o=t("ResourceUtils"),r=t("ViewUtils"),s=(t("DeckUtils"),t("PictureBookUtils")),c=t("CharacterUtils"),l=t("ExtensionAdvUtils"),u=t("RoomUtils"),h=(t("TimeUtils"),t("ResLoader"),t("TutorialUtils")),d=t("HomeConst"),p=(t("GameConst"),t("LocalDataConst")),m=t("RoomConst"),_=t("CharacterConst"),g=t("SingletonConst"),C=t("ErrorCode");cc.Class({extends:cc.Component,properties:{characterPos:cc.Node,characterImage:cc.Sprite,characterAvatar:sp.Skeleton,avatarBackground:cc.Sprite,serifWindowPos:cc.Node,roomWholeFurnitureViewPrefab:cc.Prefab,fadeTime:0},_root:null,_characterMainModelArray:null,_iCharacterLength:null,_iCurrentCharacter:null,_bSwipe:null,_bSpineInit:null,_bSpineEnd:null,_subRootAnimation:null,_serifBalloon:null,_currentSerifGroup:0,_layerNodeList:null,_bSpineError:!1,initMyPageCharacterView:function(t){this._root=t,this._characterMainModelArray=this._root.characterMainModelArray,this._iCharacterLength=this._characterMainModelArray.length,this._iCurrentCharacter=0,Object.keys(m.Z_ORDER_CATEGORY).forEach(function(t){m.Z_ORDER_CATEGORY[t]>=this.characterAvatar.node.zIndex&&(this.characterAvatar.node.zIndex=m.Z_ORDER_CATEGORY[t]+1)}.bind(this))},onLoad:function(){this._bSpineInit=!0,this._bSpineEnd=!1,this._subRootAnimation=cc.director.getScene().getChildByName("Canvas").getChildByName("SubRootParent").getComponent(cc.Animation),this.autoCharacterChange(),this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this._bSwipe=!1,this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this._serifBalloon||(this._serifBalloon=r.createSerifWindow(),this.serifWindowPos.addChild(this._serifBalloon.node))},update:function(t){try{this._bSpineInit&&!this._subRootAnimation.getAnimationState("SubRoot_Start").isPlaying&&(this._bSpineInit=!1,this._initMainCharacter()),!this._bSpineEnd&&this._subRootAnimation.getAnimationState("SubRoot_End").isPlaying&&(this._bSpineEnd=!0,l.setFadeOutAll(this.avatarBackground.node,.1))}catch(t){this._openThrowError(t)}},_openThrowError:function(t){cc.error(t),this._bSpineError=!0,this._isStillByCurrentCharacterRarity()?this.switchCharacterShowMode():this.characterAvatar.node.active=!1,this._root.setUIHeaderVisibleSwitchCharacterShowModeBtn(!1),n[g.ERROR_MANAGER]&&n[g.ERROR_MANAGER].throwError(C.OUTGAME_SPINE_ERROR)},_onTouchStart:function(t){cc.log("STS"),this._bSwipe=!1},_onTouchMove:function(t){if(cc.log(this._bSwipe),!this._bSwipe){var e=t.getLocation().x-t.getPreviousLocation().x;if(this._stopAutoLoop(),e>60){if(this._characterMainModelArray.length<=1)return;cc.log("Swipe"),this._bSwipe=!0,this._iCurrentCharacter+=this._characterMainModelArray.length-1,this.redrawMainCharacter()}else if(e<-60){if(this._characterMainModelArray.length<=1)return;cc.log("Swipe"),this._bSwipe=!0,this._iCurrentCharacter++,this.redrawMainCharacter()}}},_onTouchEnd:function(){this._bSwipe||this._characterTap(),this.autoCharacterChange()},autoCharacterChange:function(){this._characterMainModelArray.length},fade:function(){this._iCurrentCharacter++,this.redrawMainCharacter()},_stopAutoLoop:function(){this.unschedule(this.fade)},_isStillByCurrentCharacterRarity:function(){var t=n.dao[n.USER].userData.getPartner(),e=this._characterMainModelArray[this._iCurrentCharacter%this._iCharacterLength];return(e.getCharacterId()!==t.partnerId||0===t.isDisplayRoom)&&3<=e.getRarity()},_initMainCharacter:function(){if(this._isStillByCurrentCharacterRarity()){if(this._root.setUIHeaderVisibleSwitchCharacterShowModeBtn(!0),a.loadLocalStorage(p.LOCAL_STORAGE_KEY.MY_PAGE_BACKGROUND,!1,p.LOCAL_STORAGE_GET_TYPE.BOOLEAN)||!h.isTutorialEnded())return this.characterImage.node.opacity=255,this.avatarBackground.node.opacity=0,this.avatarBackground.node.active=!1,this._initSerifBalloon(),void this._setSprite(this.characterImage)}else this._root.setUIHeaderVisibleSwitchCharacterShowModeBtn(!1);this.characterImage.node.opacity=0,this.avatarBackground.node.opacity=255,this.characterImage.node.active=!1,this._initSerifBalloon(),this._setCharacterAvatar()},_initSerifBalloon:function(){this._isFirstLogin()?(this._setCurrentSerifGroup(d.SERIF_GROUP.LOGIN),this._reloadSerifBalloon()):(this._setCurrentSerifGroup(d.SERIF_GROUP.NORMAL),this._reloadSerifBalloon())},redrawMainCharacter:function(){var t=[];if(this._isStillByCurrentCharacterRarity()){if(this._root.setUIHeaderVisibleSwitchCharacterShowModeBtn(!0),a.loadLocalStorage(p.LOCAL_STORAGE_KEY.MY_PAGE_BACKGROUND,!1,p.LOCAL_STORAGE_GET_TYPE.BOOLEAN)){var e=new cc.Node("newCharacterImage").addComponent(cc.Sprite);this._setSprite(e),e.node.opacity=0,this.node.addChild(e.node,this.characterImage.node.zIndex);var i=cc.callFunc(function(){this._setSprite(this.characterImage),e.node.destroy()},this);return t.push(cc.fadeIn(this.fadeTime)),t.push(i),t.push(cc.callFunc(this.autoCharacterChange.bind(this))),void e.node.runAction(cc.sequence(t))}}else this._root.setUIHeaderVisibleSwitchCharacterShowModeBtn(!1);var n=cc.callFunc(function(){l.setFadeOutAll(this.avatarBackground.node,this.fadeTime/2)},this),o=cc.callFunc(function(){this._setCharacterAvatar(),this.avatarBackground.node.runAction(cc.fadeIn(this.fadeTime/2))},this);t.push(n),t.push(cc.delayTime(this.fadeTime/2)),t.push(o),t.push(cc.callFunc(this.autoCharacterChange.bind(this))),this.avatarBackground.node.runAction(cc.sequence(t)),this._reloadSerifBalloon()},_setSprite:function(t){t.node.setPosition(cc.v2(0,0)),o.addSprite(t,o.getFileNameCharacterMain(this._characterMainModelArray[this._iCurrentCharacter%this._iCharacterLength].getCharacterId()))},_characterTap:function(){try{cc.log("Character Tap"),this._getCurrentSerifGroup()===d.SERIF_GROUP.LOGIN&&(this._setCurrentSerifGroup(d.SERIF_GROUP.NORMAL),this._reloadSerifBalloon()),this._serifBalloon.playRandomSerifAnimation(),this._isStillByCurrentCharacterRarity()||this._bSpineError||this.playSpineAction(this._serifBalloon.getCurrentCharacterSkinName(),_.ROOM_SPINE_ANIM_TYPE.IDLE)}catch(t){this._openThrowError(t)}},_reloadSerifBalloon:function(){var t=n.dao[n.USER].userData.getPartner(),e=[],i=[],a=[],o=this._characterMainModelArray[this._iCurrentCharacter%this._iCharacterLength];s.getCharacterTextMasterArray(o.getCharacterId(),_.TEXT_SCENE_TYPE.MYPAGE,this._getCurrentSerifGroup()).forEach(function(t){e.push(t.getText()),i.push(t.getVoiceFile()),a.push(t.getSkinName())}),this._getCurrentSerifGroup()===d.SERIF_GROUP.NORMAL&&o.getCharacterId()===t.partnerId&&0!==t.isDisplayRoom&&s.getCharacterTextMasterArray(o.getCharacterId(),_.TEXT_SCENE_TYPE.ROOM,1).forEach(function(t){e.push(t.getText()),i.push(t.getVoiceFile()),a.push(t.getSkinName())}),this._serifBalloon.setSerifContent(o.getCharacterId(),o.getShortName(),e,i,a),this._serifBalloon.playRandomSerifAnimation(!h.isTutorialEnded())},_isFirstLogin:function(){return!!n.localData[p.MY_PAGE_LOGIN_VOICE]&&(n.localData[p.MY_PAGE_LOGIN_VOICE]=!1,!0)},_setCharacterAvatar:function(){try{var t=this._characterMainModelArray[this._iCurrentCharacter%this._iCharacterLength];this._isStillByCurrentCharacterRarity()?this._highRarityCharacterSpineAnimation(t):this._lowRarityCharacterSpineAnimation(t)}catch(t){this._openThrowError(t)}},_lowRarityCharacterSpineAnimation:function(t){this.redrawBackground(t),this.characterAvatar.node.position=cc.v2(d.SPINE_NODE_INFO.CHARACTER.POS_X,d.SPINE_NODE_INFO.CHARACTER.POS_Y),this.characterAvatar.node.scale=d.SPINE_NODE_INFO.CHARACTER.SCALE;var e=t.getSpineDirectoryPath(),i=o.getFileNameCharacterRoomSpine(e);this.characterAvatar.skeletonData=n.res[i],l.setFadeIn(this.characterAvatar.node,this.fadeTime/2),this.playSpineAction(this._serifBalloon.getCurrentCharacterSkinName(),_.ROOM_SPINE_ANIM_TYPE.IDLE)},redrawBackground:function(t){this.clearBackground();var e=n.dao[n.USER].userData.getPartner();if(t.getCharacterId()===e.partnerId&&0!==e.isDisplayRoom){var i=u.getRoomFurnitureModelArrayByCharacterGroupId(t.getCharacterGroupId());this._roomWholeFurnitureView||(this._roomWholeFurnitureView=cc.instantiate(this.roomWholeFurnitureViewPrefab).getComponent("RoomWholeFurnitureView"),this.avatarBackground.node.addChild(this._roomWholeFurnitureView.node)),this._roomWholeFurnitureView.initRoomWholeFurnitureViewFromFurnitures(i)}else{var a=d.DEFAULT_BG;t.getMyPageBgFileName()&&(a=t.getMyPageBgFileName()),o.addSprite(this.avatarBackground,o.getFileNameMyPageBg(a))}},clearBackground:function(){this.avatarBackground.spriteFrame=null,this.avatarBackground.node.getComponentsInChildren(cc.Sprite).forEach(function(t){this.avatarBackground.node.getName()!==t.node.getName()&&t.node.destroy()}.bind(this))},playSpineAction:function(t,e){var i=Object.keys(_.ROOM_SPINE_SKIN_TYPE).find(function(e){return _.ROOM_SPINE_SKIN_TYPE[e]===t});if(i?this._setSkin(_.ROOM_SPINE_SKIN_TYPE[i]):this._setRandomSkin(),e){if(this.characterAvatar.animation===e)return void this.characterAvatar.setSlotsToSetupPose();this._setAnimation(e)}else this._setRandomAnimation();this.characterAvatar.setSlotsToSetupPose()},playRandomSpineAction:function(){this._setRandomSkin(),this._setRandomAnimation(),this.characterAvatar.setSlotsToSetupPose()},_setRandomSkin:function(){var t=a.getRandom(1,Object.keys(this.characterAvatar.skeletonData.skeletonJson.skins).length-1),e=Object.keys(this.characterAvatar.skeletonData.skeletonJson.skins)[t];e&&this._setSkin(e)},_setSkin:function(t){this.characterAvatar.skeletonData.skeletonJson.skins[t]?(this.characterAvatar.defaultAnimation=t,this.characterAvatar.setSkin(t)):cc.error("skin "+t+"\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002")},_setRandomAnimation:function(){var t=a.getRandom(0,Object.keys(this.characterAvatar.skeletonData.skeletonJson.animations).length-1),e=Object.keys(this.characterAvatar.skeletonData.skeletonJson.animations)[t];this.characterAvatar.animation!==e&&this._setAnimation(e)},_setAnimation:function(t){if(this.characterAvatar.node.opacity=0,this.characterAvatar.node.color=cc.color(0,0,0),this.characterAvatar.node.runAction(cc.spawn(cc.fadeIn(.2),cc.tintTo(.2,255,255,255))),!this.characterAvatar.setAnimation(0,t,!0)){var e=this._characterMainModelArray[this._iCurrentCharacter%this._iCharacterLength].getCharacterId();throw new Error(e+" character spine `"+t+"` animation not found")}},_highRarityCharacterSpineAnimation:function(t){this.clearBackground(),this.characterAvatar.node.position=cc.v2(d.SPINE_NODE_INFO.STILL.POS_X,d.SPINE_NODE_INFO.STILL.POS_Y),this.characterAvatar.node.scale=d.SPINE_NODE_INFO.STILL.SCALE;var e=this,i=c.getCharacterSkillMainMasterMapIndexBySkillId(),a=i[t.getSkillId()].getSpineName(),n=o.getDirectoryIngameSkillSpine(i[t.getSkillId()].getSpineDirectoryPath());this.characterAvatar.skeletonData=this._root.getResource(n+a);if(null===this._layerNodeList)this._layerNodeList=[];else{for(var r in this._layerNodeList)this._layerNodeList[r].destroy();this._layerNodeList=[]}if(0===this._layerNodeList.length)for(var s=0;s<10;s+=1){var u=new cc.Node;u.parent=this.characterAvatar.node.parent,u.setPosition(cc.v2(0,0));var h=9-s;u.zIndex=h,this._layerNodeList.push(u)}if(this.characterAvatar.setEventListener(function(i,a){var o=a.data.name.split(","),r=o[0],s=(o.length>=2&&o[1],a.stringValue?a.stringValue.split(","):[]),c=(s[0],s.length>=2&&s[1],s.length>=3?s[2]-1:null);s.length>=4&&s[3],s.length>=5&&s[4];if(!e._root.isSkipEventInHome(r)){var u,h=n+r;e._root.checkCommon(r)&&(h=e._root.convertCommonPath(r));var d=e._layerNodeList[c],p=new cc.Node;if((u=p.addComponent(sp.Skeleton)).skeletonData=e._root.getResource(h),u.timeScale=1,p.parent=d,p.setPosition(cc.v2(0,0)),l.setFadeIn(p,e.fadeTime/2),!u.setAnimation(0,_.ROOM_SPINE_ANIM_TYPE.HOME,!0))throw new Error(t.getCharacterId()+" character spine `"+h+_.ROOM_SPINE_ANIM_TYPE.HOME+"` animation not found")}}),this.characterAvatar.setCompleteListener(function(t,e){this.characterAvatar.setEventListener(null),this.characterAvatar.setCompleteListener(null)}.bind(this)),!this.characterAvatar.setAnimation(0,_.ROOM_SPINE_ANIM_TYPE.HOME,!0))throw new Error(t.getCharacterId()+" character spine `"+_.ROOM_SPINE_ANIM_TYPE.HOME+"` animation not found")},switchCharacterShowMode:function(){try{var t=a.loadLocalStorage(p.LOCAL_STORAGE_KEY.MY_PAGE_BACKGROUND,!1,p.LOCAL_STORAGE_GET_TYPE.BOOLEAN);t=!t,a.saveLocalStorage(p.LOCAL_STORAGE_KEY.MY_PAGE_BACKGROUND,t),this.characterPos.stopAllActions();var e=[],i=cc.callFunc(function(){t?(this.characterImage.node.active=!0,this._setSprite(this.characterImage),this.characterImage.node.runAction(cc.fadeIn(this.fadeTime)),l.setFadeOutAll(this.avatarBackground.node,this.fadeTime)):(this.avatarBackground.node.active=!0,l.setFadeOutAll(this.avatarBackground.node,.1,this._setCharacterAvatar.bind(this)),this.avatarBackground.node.runAction(cc.fadeIn(this.fadeTime)),this.characterImage.node.runAction(cc.fadeOut(this.fadeTime)))},this),n=cc.callFunc(function(){t?this.avatarBackground.node.active=!1:this.characterImage.node.active=!1,this._reloadSerifBalloon(d.SERIF_GROUP.NORMAL),this.autoCharacterChange()},this);e.push(i),e.push(cc.delayTime(this.fadeTime)),e.push(n),this.characterPos.runAction(cc.sequence(e))}catch(t){this._openThrowError(t)}},_setCurrentSerifGroup:function(t){this._currentSerifGroup=t},_getCurrentSerifGroup:function(){return this._currentSerifGroup}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",ErrorCode:"ErrorCode",ExtensionAdvUtils:"ExtensionAdvUtils",GameConst:"GameConst",HomeConst:"HomeConst",LocalDataConst:"LocalDataConst",PictureBookUtils:"PictureBookUtils",ResLoader:"ResLoader",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",RoomUtils:"RoomUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",TimeUtils:"TimeUtils",TutorialUtils:"TutorialUtils",ViewUtils:"ViewUtils"}],MyPageEventModel:[function(t,e,i){"use strict";cc._RF.push(e,"c9f980ksJNIJZatWupD+ETc","MyPageEventModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getDateTo:function(){if(this._isKeyFieldAvailable("dateTo"))return this._data.dateTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateTo")},getDateFrom:function(){if(this._isKeyFieldAvailable("dateFrom"))return this._data.dateFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateFrom")},getBgm:function(){if(this._isKeyFieldAvailable("bgm"))return this._data.bgm;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bgm")},getBackground:function(){if(this._isKeyFieldAvailable("background"))return this._data.background;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: background")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MyPageEventQuestBannerView:[function(t,e,i){"use strict";cc._RF.push(e,"18704DPdIlPK4cxBE8VMZ04","MyPageEventQuestBannerView");var a=t("LoopRollView"),n=t("Singleton"),o=t("EventUtils"),r=t("TimeUtils"),s=t("GameConst"),c=t("QuestUtils"),l=t("CommonUtils");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,endDateLabel:cc.Label,loopRollView:a},_root:null,_eventMainMasterArray:null,initMyPageEventQuestBannerView:function(t){this._root=t,this._eventMainMasterArray=o.getOpenEventMainMasterArray(),this._eventMainMasterArray=l.sortModels(this._eventMainMasterArray,[{getterName:"getIndex",order:"asc"}]),this.endDateLabel.node.parent.active=this._eventMainMasterArray.length>0,this._initContent(),this._drawEndDate(0)},_initContent:function(){this.loopRollView.content.destroyAllChildren();for(var t=0;t<this._eventMainMasterArray.length;t+=1){var e=cc.instantiate(this.thumbnailPrefab).getComponent("MyPageEventQuestThumbnail");e.initMyPageEventQuestThumbnail(this._eventMainMasterArray[t],this._onTapThumbnail.bind(this,this._eventMainMasterArray[t])),this.loopRollView.content.addChild(e.node)}this.loopRollView.setLoopRollChangeCallFunc(this._onChangeThumbnail.bind(this))},_onChangeThumbnail:function(t){this._drawEndDate(t)},_drawEndDate:function(t){var e,i=this._eventMainMasterArray[t];if(i)switch(i.getConditionType()){case s.OPEN_CONDITION_TYPE.REGISTER_DATE:e=r.addMinute(n.dao.userBasicData.getTutorialEndDate(),i.getConditionTo()),this.endDateLabel.string="\u7d42\u4e86\u65e5\u6642\uff1a"+r.parseTimeToYmdhm(e)+" \u307e\u3067";break;default:var a=c.getWorldMasterByWorldId(i.getWorldId());a?(e=a.getToDate(),r.isRangeOfDate(void 0,e)?this.endDateLabel.string="\u7d42\u4e86\u65e5\u6642\uff1a"+r.parseTimeToYmdhm(e)+" \u307e\u3067":this.endDateLabel.string="\u53d7\u53d6\u65e5\u6642\uff1a"+r.parseTimeToYmdhm(i.getToDate())+" \u307e\u3067"):(e=i.getToDate(),this.endDateLabel.string="\u7d42\u4e86\u65e5\u6642\uff1a"+r.parseTimeToYmdhm(e)+" \u307e\u3067")}},_onTapThumbnail:function(t){var e=o.getTransitionEventSceneData(t.getEventId()),i=e.sceneName,a=e.sceneParam;this._root.pushScene(i,this._root.getCurrentSceneName(),a,void 0)}});cc._RF.pop()},{CommonUtils:"CommonUtils",EventUtils:"EventUtils",GameConst:"GameConst",LoopRollView:"LoopRollView",QuestUtils:"QuestUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],MyPageEventQuestThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"22db6TYkrhPxorIO/5Q2tfs","MyPageEventQuestThumbnail");t("LoopRollView");var a=t("CommonButton"),n=(t("Singleton"),t("EventUtils"),t("ResourceUtils"));cc.Class({extends:cc.Component,properties:{imageSprite:cc.Sprite,thumbBtn:a},_eventMainMaster:null,initMyPageEventQuestThumbnail:function(t,e){this._eventMainMaster=t,n.addSprite(this.imageSprite,n.getFileNameLogoByEventId(t.getEventId())),this.thumbBtn.setTapEvent(e)}});cc._RF.pop()},{CommonButton:"CommonButton",EventUtils:"EventUtils",LoopRollView:"LoopRollView",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],MyPageMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"11a871+76tBKJVNOz23mnj7","MyPageMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStageIdTo:function(){if(this._isKeyFieldAvailable("stageIdTo"))return this._data.stageIdTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageIdTo")},getBackground:function(){if(this._isKeyFieldAvailable("background"))return this._data.background;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: background")},getStageIdFrom:function(){if(this._isKeyFieldAvailable("stageIdFrom"))return this._data.stageIdFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageIdFrom")},getBgm:function(){if(this._isKeyFieldAvailable("bgm"))return this._data.bgm;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bgm")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MyPageMainView:[function(t,e,i){"use strict";cc._RF.push(e,"05755/Sm7hAhLwYY1w2u8XC","MyPageMainView");var a=t("CommonButton"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("Singleton"),s=(t("PopupUtils"),t("TimeUtils")),c=t("ShopUtils"),l=t("EventUtils"),u=t("MissionUtils"),h=t("NoticeBadgeCheckUtils"),d=t("ViewUtils"),p=t("UserUtils"),m=t("GameConst"),g=t("StaticResourceConst"),C=t("EventQuestConst"),f=t("ItemConst"),E=(t("LocalDataConst"),t("SceneConst")),T=(t("MissionConst"),t("SingletonConst")),S=t("MinigameRootUtils"),R={POSITION:cc.v2(28,32),SCALE:cc.v2(1,1)};cc.Class({extends:cc.Component,properties:{raidBattleAppearViewParentNode:cc.Node,raidBattleAppearViewPrefab:cc.Prefab,exchangeBtn:a,shopBtn:a,shopCampaignImage:cc.Sprite,warehouseBtn:a,presentBoxBtn:a,newsBtn:a,storyBtn:a,panelMissionBtn:a,minigameBtn:a,shopAppealBtn:a,panelMissionAttentionImage:cc.Sprite,subMenuBtnAnimationArray:[cc.Animation]},_root:null,_strSubMenuFlag:null,_raidBattleAppearView:null,onLoad:function(){this.scheduleOnce(this._playSubMenuBtnAnimation.bind(this),2),this.exchangeBtn.setTapEvent(this._exchangeBtn.bind(this)),this.warehouseBtn.setTapEvent(this._warehouseBtn.bind(this)),this.shopBtn.setTapEvent(this._shopBtn.bind(this)),this.storyBtn.setTapEvent(this._storyBtn.bind(this)),this.presentBoxBtn.setTapEvent(this._presentBoxBtn.bind(this)),this.panelMissionBtn.setTapEvent(this._panelMissionBtn.bind(this)),this.minigameBtn.setTapEvent(this._minigameBtn.bind(this)),this.shopAppealBtn.setTapEvent(this._shopAppealBtn.bind(this))},initMyPageMainView:function(t){this._root=t,this.exchangeBtn.showDevelopmentText(E.SCENE.FILE_NAME.EXCHANGE,10,0),this.shopBtn.showDevelopmentText(E.SCENE.FILE_NAME.SHOP,10,0),this.warehouseBtn.showDevelopmentText(E.SCENE.FILE_NAME.WARE_HOUSE,10,0),this.presentBoxBtn.showDevelopmentText(E.SCENE.FILE_NAME.PRESENT_BOX,10,0),this.storyBtn.showDevelopmentText(E.SCENE.FILE_NAME.STORY,10,0),this._initShopBtn(),this._initExchangeBtn(),this._initPresentBtn(),this._initStoryBtn(),cc.sys.isBrowser&&!cc.sys.isMobile?this.newsBtn.node.active=!1:(this.newsBtn.node.active=!0,this.newsBtn.setTapEvent(this._newsBtn.bind(this))),this._shopCampaign(),this._displayPanelMissionBtn(),this._initShopAppealBtn(),this._initMinigameBtn(),this._initRaidBattleAppearView()},_initShopBtn:function(){h.hasNewShopItem()&&d.addNoticeBadge(this.shopBtn.node,R.POSITION,R.SCALE)},_initExchangeBtn:function(){h.hasNewExchangeItem()&&d.addNoticeBadge(this.exchangeBtn.node,R.POSITION,R.SCALE)},_initStoryBtn:function(){h.hasNewReleasedNormalStory()&&d.addNoticeBadge(this.storyBtn.node,R.POSITION,R.SCALE)},_initPresentBtn:function(){h.hasReceivablePresent()?d.addNoticeBadge(this.presentBoxBtn.node,R.POSITION,R.SCALE):d.hideNoticeBadge(this.presentBoxBtn.node)},_initShopAppealBtn:function(){this.shopAppealBtn.node.stopAllActions(),this._isAvailableShopAppeal()?(this.shopAppealBtn.node.active=!0,this.shopAppealBtn.node.runAction(cc.repeatForever(cc.sequence(cc.delayTime(2),cc.rotateTo(.1,-10).easing(cc.easeSineInOut()),cc.rotateTo(.2,10).easing(cc.easeSineInOut()),cc.rotateTo(.1,0).easing(cc.easeSineInOut()),cc.delayTime(2))))):this.shopAppealBtn.node.active=!1},_initMinigameBtn:function(){S.canPlayMinigame()?this.minigameBtn.node.active=!0:this.minigameBtn.node.active=!1},_isAvailableShopAppeal:function(){var t=_.filter(r.dao.ShopMainMasters,function(t){return t.getCategory()===f.SHOP_CATEGORY.CAMPAIGN&&s.isRangeOfDate(t.getFromDate(),t.getToDate())&&p.checkOpenCondition(t.getConditionType(),t.getConditionFrom(),t.getConditionTo())});return _.some(r.dao.ShopDetailMasters,function(e){return _.some(t,function(t){return e.getShopId()===t.getShopId()&&s.isRangeOfDate(e.getFromDate(),e.getToDate())&&c.getShopItemRemainingCount(e.getListId(),e.getMaxCount(),e.getResetType())>0})})},_isMonthlySetItemShopDetail:function(t,e){switch(t.getResetType()){case f.SHOP_RESET_TYPE.MONTH:return t.getItemType()===f.ITEM_TYPE.SET_ITEM&&e[t.getShopId()]===f.SHOP_CATEGORY.SET;case f.SHOP_RESET_TYPE.REPLENISHMENT_DAYS:return t.getItemType()===f.ITEM_TYPE.SET_ITEM&&e[t.getShopId()]&&e[t.getShopId()].getCategory()===f.SHOP_CATEGORY.SET&&30===t.getReplenishmentDays();default:return!1}},_exchangeBtn:function(){this._root.pushScene("ExchangeScene",this._root.getCurrentSceneName())},_shopBtn:function(){this._root.pushScene("ShopScene",this._root.getCurrentSceneName())},_warehouseBtn:function(){this._root.pushScene("WarehouseScene",this._root.getCurrentSceneName())},_presentBoxBtn:function(){this._root.pushScene("PresentBoxScene",this._root.getCurrentSceneName())},_newsBtn:function(){cc.instantiate(o.getResource(g.NEWS_POPUP_PREFAB_PATH)).getComponent("NewsPopup").openNewsPopup(m.NEWS_TAB.INFO,0)},_storyBtn:function(){this._root.pushScene("StoryScene",this._root.getCurrentSceneName())},_panelMissionBtn:function(){this._root.openPanelMissionPopup(this._displayPanelMissionBtn.bind(this))},_minigameBtn:function(){this._root.pushScene("MinigameScene")},_shopAppealBtn:function(){this._root.pushScene("ShopScene",this._root.getCurrentSceneName(),{ShopSelectSubRoot:{shopCategory:f.SHOP_CATEGORY.CAMPAIGN}})},_shopCampaign:function(){this.shopCampaignImage.node.active=!1;var t=r.dao.ShopMainMasters.find(function(t){return t.getCategory()===f.SHOP_CATEGORY.CAMPAIGN&&s.isRangeOfDate(t.getFromDate(),t.getToDate())});if(t){var e=t.getShopId(),i=r.dao.ShopDetailMasters.filter(function(t){return t.getShopId()===e&&s.isRangeOfDate(t.getFromDate(),t.getToDate())});Array.isArray(i)&&i.length>0&&(this.shopCampaignImage.node.active=!0)}},_displayPanelMissionBtn:function(){this.panelMissionBtn.node.active=!u.isPanelMissionComplete(),this.panelMissionAttentionImage.node.active=!1;var t=u.getUserPanelMissionGroupIdMap(),e=u.getCurrentPanelMissionGroupId();_.some(t[e],function(t){return t.getIsReceivable()})&&(this.panelMissionAttentionImage.node.active=!0)},_playSubMenuBtnAnimation:function(){var t=this.subMenuBtnAnimationArray.length-1,e=n.getRandom(0,t);this.subMenuBtnAnimationArray[e].play(),this.scheduleOnce(this._playSubMenuBtnAnimation.bind(this),n.getRandom(2,4))},_initRaidBattleAppearView:function(){var t=p.getUserSceneProgressInfo("RaidScene");if(r[T.ENVIRONMENT].getDebugContentsRelease()||!t||t.isReleased){var e=l.getOpenEventMainMasterArray().find(function(t){return t.getEventType()===C.EVENT_TYPE.RAID});e&&(this._raidBattleAppearView||(this._raidBattleAppearView=cc.instantiate(this.raidBattleAppearViewPrefab).getComponent("RaidBattleAppearView"),this.raidBattleAppearViewParentNode.addChild(this._raidBattleAppearView.node)),this._raidBattleAppearView.initRaidBattleAppearView(e.getEventId(),r.dao.userRaid,this._root.getCurrentSceneName(),null))}}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",MinigameRootUtils:"MinigameRootUtils",MissionConst:"MissionConst",MissionUtils:"MissionUtils",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",ShopUtils:"ShopUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",StaticResourceConst:"StaticResourceConst",TimeUtils:"TimeUtils",UserUtils:"UserUtils",ViewUtils:"ViewUtils"}],MyPageNewsMainContentView:[function(t,e,i){"use strict";cc._RF.push(e,"8f78dm4aH5Dcp185VkSuesW","MyPageNewsMainContentView");var a=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{mainContentSprite:cc.Sprite,newsTextLabel:cc.Label},initMyPageNewsMainContentView:function(t){this.mainContentSprite.spriteFrame=null,a.addSprite(this.mainContentSprite,a.getFileNameMyPageNewsMainContentImage(t.getNewsId()),void 0),this.newsTextLabel.string=""+t.getText()}});cc._RF.pop()},{ResourceUtils:"ResourceUtils"}],MyPageNewsModel:[function(t,e,i){"use strict";cc._RF.push(e,"bc9fbv+3kZBVKFuCZ5f/ZAw","MyPageNewsModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getNewsId:function(){if(this._isKeyFieldAvailable("newsId"))return this._data.newsId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: newsId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getBandId:function(){if(this._isKeyFieldAvailable("bandId"))return this._data.bandId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bandId")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getDateFrom:function(){if(this._isKeyFieldAvailable("dateFrom"))return this._data.dateFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateFrom")},getDateTo:function(){if(this._isKeyFieldAvailable("dateTo"))return this._data.dateTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateTo")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],MyPageNewsPopup:[function(t,e,i){"use strict";cc._RF.push(e,"16c08M2MIROt5XIZf1Nf7S7","MyPageNewsPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("Singleton"),t("LocalDataConst")),r=t("CommonUtils"),s=t("CommonScrollView"),c=t("MyPageNewsMainContentView");cc.Class({extends:a,properties:{sideBannerThumbnailPrefab:cc.Prefab,sideScrollView:s,mainContentView:c,mainContentScrollView:s,closeBtn:n},_newsNewMap:null,_sideBannerThumbnailMap:null,ctor:function(){this._sideBannerThumbnailMap={},this._newsNewMap={}},openMyPageNewsPopup:function(t,e){this._loadNewsReadFlgMap(),this.sideScrollView.content.destroyAllChildren(),t.forEach(function(t,e){0===e&&(this._saveNewsReadFlg(t.getNewsId()),this.mainContentView.initMyPageNewsMainContentView(t));var i=cc.instantiate(this.sideBannerThumbnailPrefab).getComponent("MyPageNewsSideBannerThumbnail");i.initMyPageNewsSideBannerThumbnail(t,!this._newsNewMap[t.getNewsId()],this._onTapSideBannerThumbnail.bind(this)),this.sideScrollView.content.addChild(i.node),this._sideBannerThumbnailMap[t.getNewsId()]=i}.bind(this)),this.closeBtn.setTapEvent(this.close.bind(this,e),n.SE_NAME.CANCEL),this.sideScrollView.node.active=!1,this.mainContentScrollView.node.active=!1,this.open(function(){this.sideScrollView.node.active=!0,this.mainContentScrollView.node.active=!0}.bind(this))},_onTapSideBannerThumbnail:function(t){this._saveNewsReadFlg(t.getNewsId()),this._sideBannerThumbnailMap[t.getNewsId()].setNewActive(!1),this.mainContentView.initMyPageNewsMainContentView(t),this.mainContentScrollView.scrollToTop()},_loadNewsReadFlgMap:function(){this._newsNewMap=JSON.parse(r.loadLocalStorage(o.LOCAL_STORAGE_KEY.MYPAGE_NEWS_READ,"{}",o.LOCAL_STORAGE_GET_TYPE.STRING))},_saveNewsReadFlg:function(t){this._newsNewMap[t]||(this._newsNewMap[t]=!0),r.saveLocalStorage(o.LOCAL_STORAGE_KEY.MYPAGE_NEWS_READ,JSON.stringify(this._newsNewMap))},close:function(t){t&&t(),this._super()}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",MyPageNewsMainContentView:"MyPageNewsMainContentView",PopupBase:"PopupBase",Singleton:"Singleton"}],MyPageNewsSideBannerBandView:[function(t,e,i){"use strict";cc._RF.push(e,"4b1b83UoBFF5Lg8oEbPVmh4","MyPageNewsSideBannerBandView");cc.Class({extends:cc.Component,properties:{bandLabel:cc.Label},initMyPageNewsSideBannerBandView:function(t){this.bandLabel.string=""+t}});cc._RF.pop()},{}],MyPageNewsSideBannerThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"86a62ffUu9GBrRXHnmTKXbN","MyPageNewsSideBannerThumbnail");var a=t("CommonButton"),n=t("MyPageNewsSideBannerBandView"),o=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{bannerSprite:cc.Sprite,bandArray:[n],newsLabel:cc.Label,newNode:cc.Node,thumbnailBtn:a},_newsModel:null,initMyPageNewsSideBannerThumbnail:function(t,e,i){this._newsModel=t,o.addSprite(this.bannerSprite,o.getFileNameMyPageNewsBanner(t.getNewsId()),void 0),this._initBand(t),this.newsLabel.string=""+t.getName(),this.newNode.active=e,this.thumbnailBtn.setTapEvent(function(){i(t)})},_initBand:function(t){this.bandArray.forEach(function(t){t.node.active=!1});var e=t.getBandId()-1;this.bandArray[e]?(this.bandArray[e].node.active=!0,this.bandArray[e].initMyPageNewsSideBannerBandView(t.getName())):(this.bandArray[0].node.active=!0,this.bandArray[0].initMyPageNewsSideBannerBandView(t.getName()))},setNewActive:function(t){this.newNode.active=t}});cc._RF.pop()},{CommonButton:"CommonButton",MyPageNewsSideBannerBandView:"MyPageNewsSideBannerBandView",ResourceUtils:"ResourceUtils"}],MyPageService:[function(t,e,i){"use strict";cc._RF.push(e,"3e8b0fJvb1Pvp47wDxLfF2+","MyPageService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,refresh:function(t){this._requestCallApi(n.MY_PAGE_REFRESH,void 0,function(e,i){return t(e?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],NetworkReachability:[function(t,e,i){"use strict";cc._RF.push(e,"b0214ZD+O9PcqxUvEGgJ225","NetworkReachability"),e.exports={NETWORK_WIFI_INACCESSIBLE:"NETWORK_WIFI_INACCESSIBLE",NETWORK_DISABLE:"NETWORK_DISABLE"},cc._RF.pop()},{}],NetworkUtils:[function(t,e,i){"use strict";cc._RF.push(e,"381a6LaPbZMhZSE5fNOPq1q","NetworkUtils");var a=t("Singleton"),n=t("SingletonConst"),o=t("ErrorCode"),r=t("HttpStatus"),s=t("NetworkReachability");e.exports={checkNetworkReachabilitySanity:function(t){var e,i=a[n.ERROR_MANAGER];switch(cc.sys.isNative&&cc.sys.os===cc.sys.OS_IOS&&(e=jsb.reflection.callStaticMethod("AppController","checkNetworkStatus")),e){case s.NETWORK_WIFI_INACCESSIBLE:return t(i.getErrorInfo(o.NETWORK_WIFI_INACCESSIBLE));case s.NETWORK_DISABLE:return t(i.getErrorInfo(o.NETWORK_DISABLE))}t()},checkHttpStatusSanity:function(t){var e=a[n.ERROR_MANAGER];if(t===r.HTTP_200)return null;var i=o["HTTP_"+t];return i?e.getErrorInfo(i):e.getErrorInfo(o.UNEXPECTED_ERROR)}},cc._RF.pop()},{ErrorCode:"ErrorCode",HttpStatus:"HttpStatus",NetworkReachability:"NetworkReachability",Singleton:"Singleton",SingletonConst:"SingletonConst"}],NewsPopup:[function(t,e,i){"use strict";cc._RF.push(e,"56ebbR/3ZlIZoLQFkXTpSDM","NewsPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("SingletonConst");cc.Class({extends:a,properties:{webView:cc.Node},openNewsPopup:function(t,e){var i=n[o.ENVIRONMENT],a=i.getNewsUrl()?i.getNewsUrl():"";this.webView.getComponent(cc.WebView).url=a+"?tab="+t+"&page="+e,this.open()}});cc._RF.pop()},{PopupBase:"PopupBase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],NoramlQuestRoot:[function(t,e,i){"use strict";cc._RF.push(e,"b10449gZPRIfoFuC8JxLDDJ","NoramlQuestRoot");var a=t("QuestRootBase"),n=t("QuestUtils"),o=t("SceneConst"),r=t("GameConst"),s=t("Singleton"),c=t("LocalDataConst"),l=t("NormalQuestViewSetting");cc.Class({extends:a,properties:{questAreaStageSelectSubRootPrefab:cc.Prefab,worldSelectSubRootPrefab:cc.Prefab},questAreaStageSelectSubRoot:null,worldSelectSubRoot:null,selectDifficult:0,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,l.NORMAL_QUEST_SETTING)},initialize:function(){if(!s.localData[c.SELECT_WORLD_ID]){var t=n.getUserWorldArrayByWorldCategory(r.WORLD_CATEGORY.NORMAL);s.localData[c.SELECT_WORLD_ID]=t[t.length-1].getWorldId()}var e={WorldSelectSubRoot:{worldId:s.localData[c.SELECT_WORLD_ID]}};this._initOpenFirstView(e)},createPreViewParam:function(){var t={};return this.worldSelectSubRoot&&(t.WorldSelectSubRoot=this.getListViewParam()),this.questAreaStageSelectSubRoot&&(t.QuestAreaStageSelectSubRoot=this.getListViewParam()),this.battleStartConfirmSubRoot&&(t.BattleStartConfirmSubRoot=this.getListViewParam()),t},pushStageScrollView:function(t,e){var i={QuestAreaStageSelectSubRoot:{worldId:this.selectWorldId,areaId:t,difficult:e}},a={QuestAreaStageSelectSubRoot:{worldId:this.selectWorldId,difficult:e}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),i,a)},pushWorldSelectSubRoot:function(){var t={QuestAreaStageSelectSubRoot:{worldId:this.selectWorldId}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),{WorldSelectSubRoot:{}},t)},pushBattleStartConfirmSubRoot:function(t,e,i){var a={BattleStartConfirmSubRoot:{stageId:t}},r={QuestAreaStageSelectSubRoot:{worldId:n.getAreaMasterByAreaId(e).getWorldId(),areaId:e,stageId:t,difficult:i}};t&&e?(cc.log(this.getCurrentSceneName()),this.pushScene(o.SCENE.FILE_NAME.NORMAL_QUEST,this.getCurrentSceneName(),a,r)):cc.error("stageId\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},pushQuestAreaStageSelectSubRoot:function(){var t={QuestAreaStageSelectSubRoot:{worldId:s.localData[c.SELECT_WORLD_ID],areaId:void 0,difficult:r.QUEST_DIFFICULT.NORMAL.NORMAL}},e={WorldSelectSubRoot:{worldId:s.localData[c.SELECT_WORLD_ID]}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),t,e)}}),cc._RF.pop()},{GameConst:"GameConst",LocalDataConst:"LocalDataConst",NormalQuestViewSetting:"NormalQuestViewSetting",QuestRootBase:"QuestRootBase",QuestUtils:"QuestUtils",SceneConst:"SceneConst",Singleton:"Singleton"}],NormalQuestRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"af5a6c1JzdNYJTl5k3Dm3+x","NormalQuestRootUtils");var a=t("Singleton"),n=t("LocalDataConst"),o=t("CommonUtils"),r=t("UnlockEffectConst");function s(t,e){cc.log("openWorldSelectSubRoot"),cc.log(e),t.setListViewParam(e.worldId,e.areaId,e.stageId,e.difficult);var i=cc.instantiate(t.worldSelectSubRootPrefab).getComponent("QuestWorldSelectSubRoot");i.initQuestWorldSelectSubRoot(t),t.worldSelectSubRoot=i,t.subRootParent.addChild(i.node)}e.exports={openQuestAreaStageSelectSubRoot:function(t,e){if(cc.log("openQuestAreaStageSelectSubRoot"),cc.log(e),void 0!==t.questAreaStageSelectSubRoot&&null!==t.questAreaStageSelectSubRoot||(t.questAreaStageSelectSubRoot=cc.instantiate(t.questAreaStageSelectSubRootPrefab).getComponent("QuestAreaStageSelectSubRoot"),t.subRootParent.addChild(t.questAreaStageSelectSubRoot.node)),a.localData[n.NEW_RELEASE_NORMAL_STAGE_ID]){var i=_.find(a.dao.userQuests,function(t){return t.getStageId()===a.localData[n.NEW_RELEASE_NORMAL_STAGE_ID]});if(a.localData[n.NEW_RELEASE_NORMAL_STAGE_ID]=0,i)if(o.loadLocalStorage(r.TRIGGER_PREFIX_NAME.EXTRA_QUEST+e.worldId,!1,n.LOCAL_STORAGE_GET_TYPE.BOOLEAN));else{if(i.getWorldId()>e.worldId)return e.worldId=i.getWorldId(),e.areaId=i.getAreaId(),e.stageId=i.getStageId(),e.difficult=i.getAreaDifficult(),s(t,e);e.areaId=i.getAreaId(),e.stageId=i.getStageId(),e.difficult=i.getAreaDifficult()}}t.setListViewParam(e.worldId,e.areaId,e.stageId,e.difficult),t.questAreaStageSelectSubRoot.initQuestAreaStageSelectSubRoot(t,e.worldId,e.areaId,e.difficult)},closeQuestAreaStageSelectSubRoot:function(t,e){cc.log("closeQuestAreaStageSelectSubRoot"),cc.log(e),t.questAreaStageSelectSubRoot&&(t.questAreaStageSelectSubRoot.node.destroy(),t.questAreaStageSelectSubRoot=null)},openWorldSelectSubRoot:s,closeWorldSelectSubRoot:function(t,e){cc.log("closeWorldSelectSubRoot"),cc.log(e),t.worldSelectSubRoot&&(t.worldSelectSubRoot.node.destroy(),t.worldSelectSubRoot=null)},openBattleStartConfirmSubRoot:function(t,e){cc.log("openBattleStartConfirmSubRoot"),cc.log(e),t.setListViewParam(t.selectWorldId,t.selectAreaId,e.stageId,t.selectDifficult);for(var i=parseInt(e.stageId,10),n=0;n<a.dao.userQuests.length;n++)if(a.dao.userQuests[n].userData._data.stageId===i){t.openStageQuestModel=a.dao.userQuests[n];break}void 0===t.battleStartConfirmSubRoot||null===t.battleStartConfirmSubRoot?(t.battleStartConfirmSubRoot=cc.instantiate(t.battleStartConfirmSubRootPrefab).getComponent("BattleStartConfirmSubRoot"),t.battleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,t.openStageQuestModel),t.subRootParent.addChild(t.battleStartConfirmSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002")},closeBattleStartConfirmSubRoot:function(t,e){cc.log("closeBattleStartConfirmSubRoot"),cc.log(e),t.battleStartConfirmSubRoot&&(t.battleStartConfirmSubRoot.node.destroy(),t.battleStartConfirmSubRoot=null)}},cc._RF.pop()},{CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",Singleton:"Singleton",UnlockEffectConst:"UnlockEffectConst"}],NormalQuestViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"e0b42FrQz9Ii6v7NbDOEw8E","NormalQuestViewSetting");var a=t("NormalQuestRootUtils");e.exports={NORMAL_QUEST_SETTING:{QuestAreaStageSelectSubRoot:{open:a.openQuestAreaStageSelectSubRoot,close:a.closeQuestAreaStageSelectSubRoot},WorldSelectSubRoot:{open:a.openWorldSelectSubRoot,close:a.closeWorldSelectSubRoot},BattleStartConfirmSubRoot:{open:a.openBattleStartConfirmSubRoot,close:a.closeBattleStartConfirmSubRoot}}},cc._RF.pop()},{NormalQuestRootUtils:"NormalQuestRootUtils"}],NoticeBadgeCheckUtils:[function(t,e,i){"use strict";cc._RF.push(e,"c61cbArp81LmIJ0dlTrUdsq","NoticeBadgeCheckUtils");var a=t("Singleton"),n=t("CommonUtils"),o=t("EquipmentUtils"),r=t("MissionUtils"),s=t("PictureBookUtils"),c=t("QuestUtils"),l=t("CharacterUtils"),u=t("EventUtils"),h=t("TimeUtils"),d=(t("ItemUtils"),t("LocalDataConst")),p=t("EventQuestConst"),m=t("ItemConst"),g=t("CharacterConst"),C=t("GameConst"),f={QUEST:1,EVENT:2,OTHER:3,TUTORIAL:6},E={TUTORIAL:1};function T(t){return!n.loadLocalStorage(d.LOCAL_STORAGE_KEY.EVENT_FIRST_LOOK+t,!1,d.LOCAL_STORAGE_GET_TYPE.BOOLEAN)}function S(){return n.loadLocalStorage(d.LOCAL_STORAGE_KEY.EXCHANGE_DAILY_LOOK,0,d.LOCAL_STORAGE_GET_TYPE.INTEGER)<parseInt(h.getNowDate())}function R(){return n.loadLocalStorage(d.LOCAL_STORAGE_KEY.EXCHANGE_MONTHLY_LOOK,0,d.LOCAL_STORAGE_GET_TYPE.INTEGER)<Math.floor(.01*parseInt(h.getNowDate()))}function A(){var t=n.loadLocalStorage(d.LOCAL_STORAGE_KEY.EXCHANGE_ARENA_LOOK,0,d.LOCAL_STORAGE_GET_TYPE.INTEGER),e=a.dao.userPvP.getFromDate()?parseInt(a.dao.userPvP.getFromDate()):0;return t<Math.floor(e)}e.exports={isNewEventQuest:T,hasNewEventQuest:function(){for(var t=_.filter(u.getOpenEventMainMasterArray(),function(t){return t.getEventType()!==p.EVENT_TYPE.RAID}),e=0;e<t.length;e+=1)if(T(t[e].getEventId()))return!0;return!1},hasUnclearedBeginerQuest:function(){var t=_.filter(u.getOpenEventMainMasterArray(),function(t){return t.getConditionType()===C.OPEN_CONDITION_TYPE.REGISTER_DATE});return!(t.length<=0||!_.find(a.dao.userQuests,function(e){return _.some(t,function(t){return e.getWorldId()===t.getWorldId()&&!e.getIsCompletedMissions()})}))},hasPvPChallengeCount:function(){return a.dao.userPvP.getStamina()>0},hasWeekUnlockCount:function(){var t=c.getUserWorldArrayByWorldCategory(C.WORLD_CATEGORY.WEEK)[0].getWorldId(),e=c.getCampaignRemainingUnlockCountInfoByWorldId(t);return e.MaxUnlockCount>e.MaxTodayUnlockCount},hasTowerChallengerCount:function(){return a.dao.towerSession.getTowerSelectMaxCount()>a.dao.towerSession.getTowerSelectCount()},hasPromotableCharacter:function(){for(var t=l.getPlayableUserCharacterModelArray(),e=0;e<t.length;e+=1)if(t[e].hasExceedableMaterial()||t[e].hasAbilityFotifyableMaterial())return!0;return!1},hasSellMaterial:function(){return l.getCharacterModelArrayByCharacterTypes([g.CHARACTER_TYPE.SELL]).length>0},hasExceedableEquipment:function(){for(var t=o.getEquipmentModelArrayByEquipmentType(m.EQUIPMENT_TYPE.ATK),e=[],i=[],a=0;a<t.length;a+=1)t[a].getIsLevelMax()?e.push(t[a]):i.push(t[a]);return!(e.length<=0||!_.find(e,function(t){return!!_.find(i,function(e){return t.getEquipmentId()===e.getEquipmentId()})}))},hasGachaTicket:function(){return!!_.find(a.dao.userItems,function(t){return t.getItemType()===m.ITEM_TYPE.GACHA_TICKET&&t.getCount()>0&&h.isRangeOfDate(t.getFromDate(),t.getToDate())})},hasReceivableMission:function(){for(var t=_.flatMap(r.getMissionSceneUserMissionCategoryMap()),e=0;e<t.length;e+=1)if(t[e].getIsReceivable())return!0;return!1},hasNewShopItem:function(){return n.loadLocalStorage(d.LOCAL_STORAGE_KEY.SHOP_UPDATE_LOOK,0,d.LOCAL_STORAGE_GET_TYPE.INTEGER)<Math.floor(.01*parseInt(h.getNowDate()))},hasNewExchangeItem:function(){return!!(S()||R()||A())},hasNewDailyExchangeItem:S,hasNewMonthlyExchangeItem:R,hasNewArenaExchangeItem:A,hasReceivablePresent:function(){return a.localData[d.PRESENT_COUNT]>0},hasNewReleasedNormalStory:function(){return!!_.find(a.dao.userStories,function(t){switch(t.getStoryCategory()){case f.QUEST:case f.EVENT:case f.OTHER:return!t.getIsRead();case f.TUTORIAL:return t.getStoryGroupId()===E.TUTORIAL&&!t.getIsRead();default:return!1}})},hasNewReleasedStoryCategory:function(t){switch(t=parseInt(t)){case f.QUEST:case f.EVENT:return!!_.find(a.dao.userStories,function(e){return e.getStoryCategory()===t&&!e.getIsRead()});case f.OTHER:case f.TUTORIAL:return!!_.find(a.dao.userStories,function(e){return!e.getIsRead()&&(e.getStoryCategory()===t||e.getStoryCategory()===f.TUTORIAL&&e.getStoryGroupId()===E.TUTORIAL)});default:return!1}},hasNewReleasedRoomStory:function(){return s.isNewReleasedAllStory()}},cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",MissionUtils:"MissionUtils",PictureBookUtils:"PictureBookUtils",QuestUtils:"QuestUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],NoticeManager:[function(t,e,i){"use strict";cc._RF.push(e,"b5bffy8FHBFUIYeiMItmMKo","NoticeManager");var a=t("Singleton"),n=t("EventManager"),o=t("ResourceUtils"),r=(t("CommonUtils"),t("ItemConst"),t("StaticResourceConst")),s=t("GameConst"),c=t("SceneConst"),l=cc.Enum({SIMPLE:0,GAUGE:1}),u=cc.Enum({BOOT:c.SCENE.FILE_NAME.BOOT,TEST:c.SCENE.FILE_NAME.TEST,TITLE:c.SCENE.FILE_NAME.TITLE,DEBUG:c.SCENE.FILE_NAME.DEBUG,MAINTENANCE:c.SCENE.FILE_NAME.MAINTENANCE,LOGIN_BONUS:c.SCENE.FILE_NAME.LOGIN_BONUS,DUMMY_LOGIN:c.SCENE.FILE_NAME.DUMMY_LOGIN,PVP_START_ANIM:c.SCENE.FILE_NAME.PVP_START_ANIM,BATTLE_LOADING:c.SCENE.FILE_NAME.BATTLE_LOADING,SET_TEST_BATTLE:c.SCENE.FILE_NAME.SET_TEST_BATTLE});cc.Class({_event:void 0,_viewArray:void 0,_viewIdx:0,_currentViewIdx:0,_queue:void 0,_isExecution:void 0,_instanceId:void 0,_isActive:!1,ctor:function(){this.__instanceId="NoticeManager",this._event=new n,this._viewIdx=-1,this._currentViewIdx=-1,this._viewArray=[],this._queue=[],this._isExecution=!1},cleanup:function(){this._event.cleanup()},sendNotice:function(t){t||cc.log("[notice] undefined notice"),this._event.rise(this,t)},sendSimpleNoticeMessage:function(t,e){this.sendNotice(this.createNoticeObject(l.SIMPLE,{message:t,isClear:e}))},sendNoticeMessageWithGaugePoint:function(t,e,i,a,n){this.sendNotice(this.createNoticeObject(l.GAUGE,{message:t,beforePoint:e,afterPoint:i,maxPoint:a,clearCallback:n}))},subscribe:function(t,e){this._event.subscribe(t,!1,e)},createNoticeObject:function(t,e){return{handlingType:t,body:e}},getMessage:function(t){return this.getNotice(t).getMessage()},setNoticeHandling:function(t,e){if(this.cleanup(),this._clearAllNoticeEvent(),this.subscribe(t,this._pushNoticeEvent.bind(this)),e)return e();cc.director.getScheduler().schedule(this._executionNoticeEvent.bind(this),this,1)},_pushNoticeEvent:function(t,e){var i=this;switch(this._viewIdx+=1,e.handlingType){case l.SIMPLE:this._viewArray.push(this._createSimpleNoticeWithClearStampView());break;case l.GAUGE:this._viewArray.push(this._createSimpleNoticeWithClearGaugeView())}var a=this._viewIdx;this._queue.push(function(t){cc.director.getScene().getChildByName("Canvas").addChild(i._viewArray[a].node,s.Z_ORDER.POPUP),i._viewArray[a].openNoticeView(e.body,t)})},_executionNoticeEvent:function(){var t,e=this;this.isActiveNoticeManager()&&this.isActiveNoticeScene()&&(this._isExecution||this._queue.length>0&&(this._currentViewIdx+=1,t=this._queue.shift(),this._isExecution=!0,t(function(){e._isExecution=!1})))},changeSceneEvent:function(){this.isActiveNoticeManager()&&(this._isExecution||this._currentViewIdx<this._viewIdx)&&(this._currentViewIdx>=0&&this._viewArray[this._currentViewIdx].stopNoticeView(function(){}),this._clearAllNoticeEvent())},_clearAllNoticeEvent:function(){this._queue=[],this._viewArray=[],this._viewIdx=-1,this._currentViewIdx=-1,this._isExecution=!1},_createSimpleNoticeWithClearStampView:function(){return cc.instantiate(o.getResource(r.SIMPLE_NOTICE_WITH_CLEAR_STAMP_VIEW_PREFAB_PATH)).getComponent("SimpleNoticeWithClearStampView")},_createSimpleNoticeWithClearGaugeView:function(){return cc.instantiate(o.getResource(r.SIMPLE_NOTICE_WITH_CLEAR_GAUGE_VIEW_PREFAB_PATH)).getComponent("SimpleNoticeWithClearGaugeView")},isActiveNoticeManager:function(){if(!this._isActive){var t=[r.SIMPLE_NOTICE_WITH_CLEAR_STAMP_VIEW_PREFAB_PATH,r.SIMPLE_NOTICE_WITH_CLEAR_GAUGE_VIEW_PREFAB_PATH];this._isActive=t.every(function(t){return!!a.staticRes[t]})}return this._isActive},isActiveNoticeScene:function(t){var e;for(var i in e=t||cc.director.getScene().name,u)if(e===u[i])return!1;return!0}}),cc._RF.pop()},{CommonUtils:"CommonUtils",EventManager:"EventManager",GameConst:"GameConst",ItemConst:"ItemConst",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],NoticeViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"243da9LpFBJorU5Lo7HTsoc","NoticeViewBase");t("Singleton"),t("SingletonConst");cc.Class({extends:cc.Component,properties:{noticeBaseNode:cc.Node,slideTime:0,displayTime:0},_noticeBaseHeight:0,_noticeBasePosition:0,_noticeData:null,_windowSize:null,_closeCallBack:null,onLoad:function(){this._windowSize=cc.winSize},openNoticeView:function(t,e){this._noticeBaseHeight=this.noticeBaseNode.getContentSize().height,this._noticeBasePosition=this.noticeBaseNode.getPosition(),this.noticeBaseNode.setPosition(cc.v2(this._noticeBasePosition.x,this._windowSize.height/2+this._noticeBaseHeight)),this._noticeData=t,this._closeCallBack=e,this._initNoticeView(),this._openNoticeViewAction(this._displayNoticeViewAction.bind(this))},_openNoticeViewAction:function(t){var e=this.noticeBaseNode.getPosition(),i=[];i.push(cc.moveTo(this.slideTime,cc.v2(e.x,e.y-this._noticeBaseHeight))),i.push(cc.callFunc(function(){if(t)return t(this._closeNoticeView.bind(this))},this)),this.noticeBaseNode.runAction(cc.sequence(i))},_initNoticeView:function(){cc.warn("_initNoticeView\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),this._setParameter(this._noticeData)},_setParameter:function(){cc.warn("_setParameter\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_displayNoticeViewAction:function(t){cc.warn("_displayNoticeViewAction\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),this._sampleAction(t)},_closeNoticeView:function(t){this._closeNoticeViewAction(t),this._closeCallBack&&this._closeCallBack()},_closeNoticeViewAction:function(t){var e=this,i=this.noticeBaseNode.getPosition(),a=[];a.push(cc.moveTo(e.slideTime,cc.v2(i.x,i.y+e._noticeBaseHeight))),a.push(cc.callFunc(function(){if(e.noticeBaseNode.destroy(),t)return t()},this)),this.noticeBaseNode.runAction(cc.sequence(a))},stopNoticeView:function(t){if(this.noticeBaseNode)this.noticeBaseNode.stopAllActions(),this._closeNoticeViewAction(t);else if(t)return t()}}),cc._RF.pop()},{Singleton:"Singleton",SingletonConst:"SingletonConst"}],OAuth:[function(t,e,i){"use strict";cc._RF.push(e,"6812fFC/PRPIZFgHWS0QoWU","OAuth");var a=t("CommonUtils"),n=t("url");cc.Class({_data:void 0,ctor:function(){this._data={}},set:function(t,e){this._data[t]=e},getAuthorization:function(t,e){var i={},n="";e.lastIndexOf("RequestToken")>=0?n+='OAuth realm="Clients"':e.lastIndexOf("AccessToken")>=0?(n+='OAuth realm="Clients"',i.oauth_token=this._data.game_server_token):(n+='OAuth realm="Users"',i.oauth_token=this._data.game_server_token),i.xoauth_requestor_id=this._data.user_id,i.oauth_consumer_key=this._data.consumer_key,i.oauth_signature_method=this._data.signature_method,i.oauth_nonce=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),i.oauth_timestamp=Math.floor(cc.sys.now()/1e3);var o=this._normalizeUrl(e),r=this._normalizeParameters(i),s=this._constructBaseString(t,o,r),c=this._encode(this._data.consumer_secret)+"&";return this._data.game_server_secret&&(c+=this._data.game_server_secret),i.oauth_signature=a.encryptHmac(s,c),Object.keys(i).forEach(function(t){n=n+" "+t+'="'+i[t]+'"'}),n},_normalizeUrl:function(t){var e=n.parse(t,!0);return delete e.query,delete e.search,n.format(e)},_normalizeParameters:function(t){var e=[];return Object.keys(t).sort().forEach(function(i){e.push(i+"="+t[i])}),e.join("&")},_constructBaseString:function(t,e,i){return[t.toUpperCase(),this._encode(e),this._encode(i)].join("&")},_encode:function(t){return encodeURIComponent(t).replace("(","%28").replace(")","%29").replace("$","%24").replace("!","%21").replace("*","%2A").replace("'","%27").replace("%7E","~")}}),cc._RF.pop()},{CommonUtils:"CommonUtils",url:5}],OutGameRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"8bde3Zuu61GQrj0RIztvNLE","OutGameRootBase");var a=t("GameRootBase"),n=t("GameConst"),o=(t("CommonUtils"),t("ResourceUtils")),r=t("UserUtils"),s=t("PopupUtils"),c=t("StaticResourceConst"),l=(t("ResourceConst"),t("ItemConst")),u=t("Singleton"),h=t("UIHeader"),d=t("BackButton"),p=t("FileLoaderManager"),m=t("SingletonConst"),_=t("MemoryManager");cc.Class({extends:a,properties:{bgPrefab:cc.Prefab,backgroundParent:cc.Node,headerParent:cc.Node,sideMenuParent:cc.Node,subRootParent:cc.Node},_backBtn:null,_uiHeader:null,_uiSide:null,_navigatorCharacterId:null,onLoad:function(){this._addBG(),this._addUIHeader(),this._addUISide(),this._addBackBtn(),this._addBand(),this._setTapEffect()},initResource:function(){u.soundManager.init(),this.playSceneBgm(this._getSceneBgmName())},_getSceneBgmName:function(){return n.BGM.COMMON},_addBG:function(){if(this.bgPrefab){var t=cc.instantiate(this.bgPrefab);this.backgroundParent.addChild(t,n.Z_ORDER.BG),_.instance.localPrefabStore(this.bgPrefab)}else cc.error("OutGameRootBase : \u80cc\u666f\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},_addUIHeader:function(){var t=cc.instantiate(o.getResource(c.COMMON_HEADER_PREFAB_PATH));this._uiHeader=t.getComponent(h),this.headerParent.addChild(t,n.Z_ORDER.UI_HEADER)},_addUISide:function(){var t=cc.instantiate(o.getResource(c.COMMON_SIDE_PREFAB_PATH));this._uiSide=t.getComponent("UISide"),this.sideMenuParent.addChild(t,n.Z_ORDER.UI)},_addBackBtn:function(){var t=cc.instantiate(o.getResource(c.COMMON_BACK_BUTTON_PREFAB_PATH));this._backBtn=t.getComponent(d),this.node.addChild(t,n.Z_ORDER.UI_BACK_BUTTON),this._switchActiveBackBtn(!1)},_switchActiveBackBtn:function(t){this._backBtn&&(this._backBtn.node.active=!!t&&this.checkSceneStack())},setBackButtonCallBack:function(t){this._backBtn.setCallback(t)},initOutGameRootBase:function(){},updateChild:function(t){},redraw:function(){},callSceneStackListener:function(){this._switchActiveBackBtn(!0)},pushScene:function(t,e,i,a,n){var o=r.getUserSceneProgressInfo(t);u[m.ENVIRONMENT].getDebugContentsRelease()||!o||o.isReleased?this._super(t,e,i,a,n):s.openSimpleMessageWindow(o.description)},playSceneBgm:function(t){p.instance.loadFile(o.getFileNameBGM(t),cc.AudioClip,function(t,e){t?cc.error(t):u.soundManager.continuePlayBGM(e,0)})},redrawUIHeader:function(){this._uiHeader.redraw()},requestUpdateSetting:function(t,e,i,a){u.UserService.updateSetting(t.bgm,t.se,t.voice,t.seMute,t.bgmMute,t.voiceMute,e,i,function(){a&&a()})},getNavigatorCharacterId:function(){return this._navigatorCharacterId||(this._navigatorCharacterId=r.getNavigatorCharacterId()),this._navigatorCharacterId},requestUseRecoveryItem:function(t,e,i){switch(t){case l.GEM_ITEM_ID.FREE:case l.GEM_ITEM_ID.PAID:u.UserService.recoveryStamina(e,function(){if(this.redraw(),this._uiHeader.redraw(),i)return i()}.bind(this));break;default:u.ItemService.useRecoveryItem([t],[e],function(){if(this.redraw(),this._uiHeader.redraw(),i)return i()}.bind(this))}},setCurrencyUIHeader:function(t,e){this._uiHeader.setCurrencyItemId(t),this._uiHeader.setCurrencyBtnEvent(e)},setUIHeaderCurrencyInfo:function(t){this._uiHeader.setCurrencyInfo(t)},transitionShopSceneByUIHeader:function(){if("ShopScene"!==this.getCurrentSceneName()){var t={ShopSelectSubRoot:{shopCategory:l.SHOP_CATEGORY.GEM}},e=this.createPreViewParam();this.pushScene("ShopScene",this.getCurrentSceneName(),t,e)}},transitionShopSceneByApRecoveryPopup:function(){if("ShopScene"!==this.getCurrentSceneName()){var t={ShopSelectSubRoot:{shopCategory:l.SHOP_CATEGORY.NORMAL}},e=this.createPreViewParam();this.pushScene("ShopScene",this.getCurrentSceneName(),t,e)}},createPreViewParam:function(){cc.warn("\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")}}),cc._RF.pop()},{BackButton:"BackButton",CommonUtils:"CommonUtils",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",GameRootBase:"GameRootBase",ItemConst:"ItemConst",MemoryManager:"MemoryManager",PopupUtils:"PopupUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",StaticResourceConst:"StaticResourceConst",UIHeader:"UIHeader",UserUtils:"UserUtils"}],PageButtonView:[function(t,e,i){"use strict";cc._RF.push(e,"56ab77shy9H4KoTbcD3VBVB","PageButtonView");var a=t("CommonButton"),n=(t("CommonNumber"),t("PageButton"));cc.Class({extends:cc.Component,properties:{pageBtnList:[n],leftBtn:a,rightBtn:a,leftEndBtn:a,rightEndBtn:a},_pageCountMax:0,_currentPageNumber:0,initPageButtonView:function(t,e,i,a,n,o,r){if(this._pageCountMax=e,this._resetActiveAllPageBtnNode(),this._initSideButtons(a,n,o,r),e<=1)this.node.active=!1;else{this.node.active=!0;for(var s=0;s<e&&!(s>=this.pageBtnList.length);s+=1)this.pageBtnList[s].node.active=!0,this.setPageButtonEvent(s,i);for(var c=this.pageBtnList.length-1;c>e;c-=1)this.pageBtnList[c].node.destroy(),this.pageBtnList.splice(c,1);this.setPageButtons(t,e)}},setPageButtons:function(t,e){var i=t+1,a=this._getMinMaxPageNumbers(t,e);this._activateAllPageBtnImage(),this._switchActiveSideButtons(t,e);for(var n=0;n+a.min<=e&&!(n>=this.pageBtnList.length);n+=1){var o=n+a.min;this.pageBtnList[n].setPageNum(o),o===i&&(this.pageBtnList[n].switchBtnImage(!1),this._currentPageNumber=o)}},_resetActiveAllPageBtnNode:function(){for(var t=0;t<this.pageBtnList.length;t++)this.pageBtnList[t].node.active=!1},_activateAllPageBtnImage:function(){for(var t=0;t<this.pageBtnList.length;t++)this.pageBtnList[t].switchBtnImage(!0)},_switchActiveSideButtons:function(t,e){this._switchLeftSideButtonImage(t>0),this._switchRightSideButtonImage(t<e-1)},_switchLeftSideButtonImage:function(t){this.leftBtn&&this.leftBtn.switchBtnImage(t),this.leftEndBtn&&this.leftEndBtn.switchBtnImage(t)},_switchRightSideButtonImage:function(t){this.rightBtn&&this.rightBtn.switchBtnImage(t),this.rightEndBtn&&this.rightEndBtn.switchBtnImage(t)},_getMinMaxPageNumbers:function(t,e){var i=t+1,a=Math.min(e,i+parseInt(this.pageBtnList.length/2));return{max:a,min:Math.max(a-this.pageBtnList.length+1,1)}},setPageButtonEvent:function(t,e){this.pageBtnList[t].setTapEvent(function(i){this._currentPageNumber!==this.pageBtnList[t].getPageNum()&&(this._currentPageNumber=this.pageBtnList[t].getPageNum(),e&&e(this.pageBtnList[t].getPageNum()-1))}.bind(this),a.SE_NAME.COUNT),this.pageBtnList[t].setOverEvent(function(){},function(){})},_initSideButtons:function(t,e,i,a){this._setLeftButtonEvent(t),this._setRightButtonEvent(e),this._setLeftEndButtonEvent(i),this._setRightEndButtonEvent(a)},_setLeftButtonEvent:function(t){this.leftBtn&&(this.leftBtn.setTapEvent(t,a.SE_NAME.COUNT),this.leftBtn.setOverEvent(function(){},function(){}))},_setRightButtonEvent:function(t){this.rightBtn&&(this.rightBtn.setTapEvent(t,a.SE_NAME.COUNT),this.rightBtn.setOverEvent(function(){},function(){}))},_setLeftEndButtonEvent:function(t){this.leftEndBtn&&(this.leftEndBtn.setTapEvent(t,a.SE_NAME.COUNT),this.leftEndBtn.setOverEvent(function(){},function(){}))},_setRightEndButtonEvent:function(t){this.rightEndBtn&&(this.rightEndBtn.setTapEvent(t,a.SE_NAME.COUNT),this.rightEndBtn.setOverEvent(function(){},function(){}))}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonNumber:"CommonNumber",PageButton:"PageButton"}],PageButton:[function(t,e,i){"use strict";cc._RF.push(e,"fa050og9k9IWZgLFOzG2Sha","PageButton");var a=t("CommonButton"),n=(t("CommonNumber"),t("CommonUtils"));cc.Class({extends:a,properties:{pageNumberLabel:cc.Label},setPageNum:function(t){parseInt(this.pageNumberLabel.string)!==t&&(this.pageNumberLabel.string=t,this.pageNumberLabel.node.opacity=0,this.pageNumberLabel.node.runAction(cc.fadeIn(.1)))},getPageNum:function(){return parseInt(this.pageNumberLabel.string)},switchBtnImage:function(t){var e;this.setTouchEnable(t),t?(e=cc.color(this.tapAnimation.getClips()[1].curveData.props.color[0].value),n.setChildrenColorOrLabelOpacity(this.node,e)):(e=cc.color(this.tapAnimation.getClips()[1].curveData.props.color[1].value),n.setChildrenColorOrLabelOpacity(this.node,e))}});cc._RF.pop()},{CommonButton:"CommonButton",CommonNumber:"CommonNumber",CommonUtils:"CommonUtils"}],PageViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"9a48bfdBGBJcYD5cK8qLIQr","PageViewBase");var a=t("WindowBase"),n=t("CommonButton"),o=t("GameConst");cc.Class({extends:a,properties:{content:cc.Node,swipeStartDistance:100,isLoopContent:!1},_pageCountMax:0,_currentIndex:0,_recentMoveDirection:o.DIRECTION_TYPE.NONE,_callbackToSetPageNode:null,_callbackToSwipeEvent:null,_btnArray:null,_initPageViewBase:function(t,e,i,a,n){this._initContent(t),this._pageCountMax=e,this._currentIndex=i||0,this.setCallbackToSetPageNode(a),this._initSwipe(n),this._btnArray=[]},_initContent:function(t){!this.content&&t&&(this.content=t,this.windowNode.addChild(t))},removePageContent:function(){this.content.destroyAllChildren()},_adjustPageIndex:function(t){if((t=isNaN(t)?0:t)<this._currentIndex?this._recentMoveDirection=o.DIRECTION_TYPE.LEFT:t>this._currentIndex?this._recentMoveDirection=o.DIRECTION_TYPE.RIGHT:this._recentMoveDirection=o.DIRECTION_TYPE.NONE,this.isLoopContent){for(;t<0;)t+=this._pageCountMax;t%=this._pageCountMax}else t>=this._pageCountMax?t=this._pageCountMax-1:t<0&&(t=0);return t},_setPageNode:function(t){this._callbackToSetPageNode&&this._callbackToSetPageNode(t),this._btnArray=[],this._callbackToSwipeEvent&&this._addSwipeEventForPageContent(this.content)},_addSwipeEventForPageContent:function(t){for(var e=t.getComponentsInChildren(n),i=0;i<e.length;i++)e[i].bPropagationStopped=!1,e[i].node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),e[i].node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),e[i].node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),e[i].node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this._btnArray.push(e[i])},setPageIndex:function(t){this._currentIndex=this._adjustPageIndex(t),this._setPageNode(this._currentIndex)},getPageIndex:function(){return this._currentIndex},getMoveDirection:function(){return this._recentMoveDirection},switchPageContent:function(t){this.setPageIndex(t)},moveToLeftPageContent:function(){this.switchPageContent(this.getPageIndex()-1)},moveToRightPageContent:function(){this.switchPageContent(this.getPageIndex()+1)},_initSwipe:function(t){t&&(this._callbackToSwipeEvent=t,this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this))},_onTouchStart:function(t){this._isSwiped=!1},_onTouchMove:function(t){if(this._isSwipeStarted(t)){if(this._callbackToSwipeEvent){var e=t.getLocation().x>t.getStartLocation().x?this._currentIndex-1:this._currentIndex+1;this._callbackToSwipeEvent(this._adjustPageIndex(e),t)}for(var i=0;i<this._btnArray.length;i++)this._btnArray[i].setTouchEnable(!1)}},_onTouchEnd:function(t){if(this._isSwipeStarted(t)&&this._callbackToSwipeEvent){var e=t.getLocation().x>t.getStartLocation().x?this._currentIndex-1:this._currentIndex+1;this._callbackToSwipeEvent(this._adjustPageIndex(e),t)}this._isSwiped=!1;for(var i=0;i<this._btnArray.length;i++)this._btnArray[i].setTouchEnable(!0)},_onTouchCancel:function(t){this._onTouchEnd(t)},_isSwipeStarted:function(t){return!this._isSwiped&&this._isOverForSwipeStartDistance(t)&&(this._isSwiped=!0),this._isSwiped},_isOverForSwipeStartDistance:function(t){var e=t.getStartLocation(),i=t.getLocation();return Math.abs(e.x-i.x)>this.swipeStartDistance},setCallbackToSetPageNode:function(t){this._callbackToSetPageNode=t}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",WindowBase:"WindowBase"}],PanelMissionAchievementThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"27771MvbhlOQrvqxam8DWDl","PanelMissionAchievementThumbnail");var a=t("PanelMissionThumbnailBase"),n=t("ResourceUtils"),o=t("GameConst"),r=t("ItemUtils"),s=cc.Enum({PRE_PANEL_INCOMPLETE:0,CHALLENGING:1,READY_COMPLETE:2,COMPLETE:3});cc.Class({extends:a,properties:{},onLoad:function(){this._super()},initPanelMissionAchievementThumbnail:function(t){this.setReceiveCallback(t)},redrawPanelMissionAchievementThumbnail:function(t,e){this.initPanelMissionThumbnailBase(t),this.setThumbnailStatusType(e),this._switchInitThumbnail()},_switchInitThumbnail:function(){var t=this._missionModel.getClearCount(),e=this._missionModel.getConditionCount();switch(this._initThumbnail(t,e),this.getThumbnailStatusType()){case s.CHALLENGING:this._initChallengingThumbnail();break;case s.READY_COMPLETE:this._initReadyCompleteThumbnail();break;case s.COMPLETE:this._initCompleteThumbnail()}},_initThumbnail:function(t,e){var i=this.getMissionRewardMasterByMissionId(this._missionModel.getMissionId());this.setSituationNowLabel(t),this.setSituationGoalNumLabel(e),this.setRewardItemThumbnail(n.getFileNameThumbnailByItemType(i.getItemId(),i.getItemType()),i.getCount(),i.getItemType(),i.getItemId()),this.setCompleteStampNode(!1),this.setReceiveBtn(!0),this.receiveBtn.switchBtnImage(!1)},_initChallengingThumbnail:function(){},_initReadyCompleteThumbnail:function(){this.receiveBtn.switchBtnImage(!0)},_initCompleteThumbnail:function(t,e){this.setCompleteStampNode(!0),this.receiveBtn.switchBtnImage(!1)},_onTapItemThumbnail:function(t,e,i,a){if(this.modelDetailPopupPrefab){var n=cc.director.getScene().getChildByName("Canvas"),s=cc.instantiate(this.modelDetailPopupPrefab).getComponent("ModelDetailPopup"),c=cc.instantiate(t),l=cc.instantiate(t);l.setScale(a);var u=t.convertToWorldSpaceAR(cc.v2(0,0)),h=n.convertToNodeSpaceAR(u);n.addChild(l,o.Z_ORDER.POPUP),l.setPosition(h);var d=r.getItemInfo(e,i);s.node.setPosition(cc.v2(h.x+350,h.y));var p=cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack"),m=p?p.zIndex:void 0;s.openModelDetailPopup(c,d.name,d.text,function(){l.destroy(),p&&(p.zIndex=m)}),this._setModelDetailPopupZOrder(s,l,p)}}});cc._RF.pop()},{GameConst:"GameConst",ItemUtils:"ItemUtils",PanelMissionThumbnailBase:"PanelMissionThumbnailBase",ResourceUtils:"ResourceUtils"}],PanelMissionListView:[function(t,e,i){"use strict";cc._RF.push(e,"4dac4yJbFdGlJnMh1VRpgGN","PanelMissionListView");var a=t("ListViewBase");cc.Class({extends:a,properties:{lockNode:cc.Node,lockNodeNumLabel:cc.Label},_root:null,_receiveEventCallback:null,_transitionEventCallback:null,initPanelMissionListView:function(t,e,i){this.initListView(t),this._receiveEventCallback=e,this._transitionEventCallback=i},redrawPanelMissionListView:function(t,e,i){this.resetListView(),this._setLockPanel(!e,i),this._setListContent(t,e),this.node.active=!0,this.thumbnailParentNode.active=!0},_setLockPanel:function(t,e){this.lockNode.active=t,this.lockNodeNumLabel.string=String(e+1)},initListView:function(t){this._root=t,this.resetListView(),this.node.active=!0,this.thumbnailParentNode.active=!0},_setListContent:function(t,e){_.forEach(t,function(t,i){this._addThumbnail(t,e,i)}.bind(this))},_addThumbnail:function(t,e,i){var a=cc.instantiate(this.thumbnailPrefab).getComponent("PanelMissionThumbnail");this.thumbnailParentNode.addChild(a.node,i),a.initPanelMissionThumbnail(t,e,this._receiveEventCallback.bind(this),this._transitionEventCallback.bind(this))}});cc._RF.pop()},{ListViewBase:"ListViewBase"}],PanelMissionPopup:[function(t,e,i){"use strict";cc._RF.push(e,"4fe39MUiXJFE48MTwC2RD1M","PanelMissionPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonUtils"),s=t("MissionConst");cc.Class({extends:a,properties:{panelMissionTabViewPrefab:cc.Prefab,panelMissionListViewPrefab:cc.Prefab,panelMissionAchievementThumbnailPrefab:cc.Prefab,panelMissionTabViewParentNode:cc.Node,panelMissionListViewParentNode:cc.Node,panelMissionAchievementThumbnailParentNode:cc.Node,receiveAllBtn:o,closeBtn:o},_root:null,_panelMissionTabView:null,_panelMissionListView:null,_panelMissionAchievementThumbnail:null,_panelMissionMapKeyArray:null,_displayableTabIndexArray:null,_selectableTabIndexArray:null,_selectedTabIndex:0,_recentTabIndex:0,_missionGroupIdType:null,_panelMissionModelArray:null,_panelMissionMap:null,onLoad:function(){this.receiveAllBtn.setTapEvent(this._onTapReceiveAllBtnEvent.bind(this),o.SE_NAME.RECEIVE),this.closeBtn.setTapEvent(this._onTapCloseBtnEvent.bind(this),o.SE_NAME.CANCEL)},openPanelMissionPopup:function(t,e,i){this._root=t,this._missionGroupIdType=e,this.setCloseCallBack(i),this._initPanelMission(),this.reload(),this.open()},_initPanelMission:function(){this._selectedTabIndex=0,this._recentTabIndex=0,this._panelMissionMapKeyArray=this._createPanelMissionMapKeyArray(),this._displayableTabIndexArray=this._createDisplayableTabIndexArray(),this._initPanelMissionTabView(),this._initPanelMissionListView(),this._initPanelMissionAchievementThumbnail()},_initPanelMissionTabView:function(){this._panelMissionTabView||(this._panelMissionTabView=cc.instantiate(this.panelMissionTabViewPrefab).getComponent("PanelMissionTabView"),this.panelMissionTabViewParentNode.addChild(this._panelMissionTabView.node),this._panelMissionTabView.initPanelMissionTabView(this._root,this._displayableTabIndexArray.length,this._onTapTabBtnEvent.bind(this)))},_initPanelMissionListView:function(){this._panelMissionListView||(this._panelMissionListView=cc.instantiate(this.panelMissionListViewPrefab).getComponent("PanelMissionListView"),this.panelMissionListViewParentNode.addChild(this._panelMissionListView.node),this._panelMissionListView.initPanelMissionListView(this._root,this._onTapReceiveBtnEvent.bind(this),this._onTapTransitionBtnEvent.bind(this)))},_initPanelMissionAchievementThumbnail:function(){this._panelMissionAchievementThumbnail||(this._panelMissionAchievementThumbnail=cc.instantiate(this.panelMissionAchievementThumbnailPrefab).getComponent("PanelMissionAchievementThumbnail"),this.panelMissionAchievementThumbnailParentNode.addChild(this._panelMissionAchievementThumbnail.node),this._panelMissionAchievementThumbnail.initPanelMissionAchievementThumbnail(this._onTapReceiveBtnEvent.bind(this)))},reload:function(){if(this._root.redrawUIHeader(),this._reloadPanelMissionData(),this._isAllMissionComplete())return this.close();this._createSelectableTabIndexArray(),this._setCurrentTabIndex(),this.redraw()},_reloadPanelMissionData:function(){this._panelMissionModelArray=[],this._panelMissionMap={},this._panelMissionModelArray=_.filter(n.dao.userMissions,function(t){return t.getMissionMainMater().getCategory()===s.MISSION_CATEGORY.PANEL}),_.forEach(this._panelMissionMapKeyArray,function(t){var e=_.filter(this._panelMissionModelArray,function(e){return e.getMissionDetailMaster().getMissionGroupId()===s.PANEL_MISSION_CONST.MISSION_GROUP_ID_TYPE[this.getMissionGroupIdType()][t]}.bind(this));this._panelMissionMap[t]=this._createPanelMissionInfo(e)}.bind(this))},redraw:function(){this._panelMissionTabView.redrawPanelMissionTabView(this._selectableTabIndexArray,this._selectedTabIndex),this._panelMissionListView.redrawPanelMissionListView(this._getCurrentPanelMissionInfo().panelMissionModelArray,this._isCompletePreviousPanelMission(),this._selectedTabIndex-1),this._panelMissionAchievementThumbnail.redrawPanelMissionAchievementThumbnail(this._getCurrentPanelMissionInfo().achievementMissionModel,this._isCompletePreviousPanelMission()),this._switchReceiveAllBtn()},_onTapTabBtnEvent:function(t,e,i){this._recentTabIndex=this._selectedTabIndex,this._selectedTabIndex=e,this.reload()},_onTapCloseBtnEvent:function(){this.close()},_onTapReceiveBtnEvent:function(t){this._root.requestReceiveMissionGetItem(t,this.reload.bind(this))},_onTapReceiveAllBtnEvent:function(){if(this.receiveAllBtn.getBtnImageSwitchState()){var t=_.filter(this._getCurrentPanelMissionInfo().panelMissionModelArray,function(t){return t.getIsReceivable()});this._root.requestAllReceiveMissionGetItem(t,this.reload.bind(this))}},_onTapTransitionBtnEvent:function(t){this._root.transitionSceneByPanelMissionPopup(t),this.close()},_createPanelMissionMapKeyArray:function(){return Object.keys(s.PANEL_MISSION_CONST.MISSION_GROUP_ID_TYPE[this.getMissionGroupIdType()])},_createDisplayableTabIndexArray:function(){var t=[];return _.forEach(this._panelMissionMapKeyArray,function(e){t.push(s.PANEL_MISSION_CONST.TAB_INDEX[e])}),t},_createPanelMissionInfo:function(t){var e=_.find(t,function(t){return t.getMissionDetailMaster().getMissionType()===s.MISSION_SETTING.MISSION_CLEAR_COUNT.type}),i=_.filter(t,function(t){return t.getMissionDetailMaster().getMissionType()!==s.MISSION_SETTING.MISSION_CLEAR_COUNT.type}),a=[];return a.push({getterName:"getMissionId",order:"asc"}),{achievementMissionModel:e,panelMissionModelArray:i=r.sortModels(i,a),isComplete:e.getReceiveCount()>0}},_createSelectableTabIndexArray:function(){this._selectableTabIndexArray=[],_.forEach(this._panelMissionMapKeyArray,function(t){this._panelMissionMap[t].isComplete||this._selectableTabIndexArray.push(s.PANEL_MISSION_CONST.TAB_INDEX[t])}.bind(this))},getMissionGroupIdType:function(){return this._missionGroupIdType},_getCurrentPanelMissionInfo:function(){return this._panelMissionMap[this._convertTabIndexToPanelMissionMapKey(this._selectedTabIndex)]},_setCurrentTabIndex:function(){void 0===_.find(this._selectableTabIndexArray,function(t){return t===this._recentTabIndex}.bind(this))&&(this._recentTabIndex=this._selectableTabIndexArray[0]),void 0===_.find(this._selectableTabIndexArray,function(t){return t===this._selectedTabIndex}.bind(this))&&(this._selectedTabIndex=this._recentTabIndex)},_switchReceiveAllBtn:function(){this.receiveAllBtn.switchBtnImage(!1),_.some(this._getCurrentPanelMissionInfo().panelMissionModelArray,function(t){return t.getIsReceivable()})&&this._isCompletePreviousPanelMission()&&this.receiveAllBtn.switchBtnImage(!0)},_convertTabIndexToPanelMissionMapKey:function(t){return _.find(this._panelMissionMapKeyArray,function(e){return s.PANEL_MISSION_CONST.TAB_INDEX[e]===t})},_isAllMissionComplete:function(){return _.every(this._panelMissionMapKeyArray,function(t){return this._panelMissionMap[t].isComplete}.bind(this))},_isCompletePreviousPanelMission:function(){var t=this._selectedTabIndex-1;return t<0||this._panelMissionMap[this._convertTabIndexToPanelMissionMapKey(t)].isComplete}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",MissionConst:"MissionConst",PopupBase:"PopupBase",Singleton:"Singleton"}],PanelMissionRewardConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"acbdaqWyDtNPILxfL8munMZ","PanelMissionRewardConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("Singleton"),r=t("ResourceUtils");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,itemThumbnailPrefab:cc.Prefab,okBtn:n},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},_root:null,_missionModelArray:null,openPanelMissionRewardConfirmPopup:function(t,e,i){this._root=t,this._missionModelArray=e,this._setLayoutSize(e.length),this.setCloseCallBack(i),this._initPanelMissionRewardConfirmPopup(),this.open()},_setLayoutSize:function(t){var e=this.itemThumbnailParentNode.width/5,i=Math.min(5,t);this.itemThumbnailParentNode.width=e*i},_initPanelMissionRewardConfirmPopup:function(){_.forEach(this._missionModelArray,function(t){this._initRewardItem(t)}.bind(this))},_onTapOkBtn:function(){this.close()},_initRewardItem:function(t){var e=this._getMissionRewardMasterByMissionId(t.getMissionId());this._setRewardItemThumbnail(r.getFileNameThumbnailByItemType(e.getItemId(),e.getItemType()),e.getCount())},_getMissionRewardMasterByMissionId:function(t){return _.filter(o.dao.MissionRewardMasters,function(e){return e.getMissionId()===t})[0]},_setRewardItemThumbnail:function(t,e){var i=cc.instantiate(this.itemThumbnailPrefab).getComponent("ItemMatrixThumbnail");i.setMainImage(t),i.setNumeCount("x",e,void 0),this.itemThumbnailParentNode.addChild(i.node)}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],PanelMissionTabButton:[function(t,e,i){"use strict";cc._RF.push(e,"7f56f50/sRNoIu/s9NutrTN","PanelMissionTabButton");var a=t("TabButton");cc.Class({extends:a,properties:{},initPanelMissionTabButton:function(t){this.initTabButton(t,!0)},setCompletePanelMissionTabButton:function(t,e){var i=void 0===_.find(e,function(e){return e===t});this.grayOutNode&&(this.grayOutNode.active=i)}});cc._RF.pop()},{TabButton:"TabButton"}],PanelMissionTabView:[function(t,e,i){"use strict";cc._RF.push(e,"17819yZKVZExqxYWyAuSKTc","PanelMissionTabView");var a=t("VariableTabViewBase");cc.Class({extends:a,properties:{},_root:null,_maxTabIndex:0,_tabBtnArray:null,initPanelMissionTabView:function(t,e,i){this._root=t,this._maxTabIndex=e,this.setCallbackToTabEvent(i)},redrawPanelMissionTabView:function(t,e){this._tabBtnArray||this.initVariableTabViewBase(this._root,this._createPanelMissionTabButtons()),this._resetTab(t),this._activateTab(e)},_createPanelMissionTabButtons:function(){this._tabBtnArray=[];for(var t=0;t<this._maxTabIndex;t+=1){var e=this.getTabButtonPrefab(t,this._maxTabIndex),i=cc.instantiate(e).getComponent("PanelMissionTabButton");this._tabBtnArray.push(i);var a=String(t+1)+"\u679a\u76ee";i.initPanelMissionTabButton(a)}return this._tabBtnArray},_resetTab:function(t){for(var e=0;e<this._tabBtnArray.length;e+=1)this._tabBtnArray[e].switchBtnImage(!1),this._tabBtnArray[e].setCompletePanelMissionTabButton(e,t)},_activateTab:function(t){this._setCurrentTab(t),this._tabBtnArray[t].switchBtnImage(!0)}});cc._RF.pop()},{VariableTabViewBase:"VariableTabViewBase"}],PanelMissionThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"eb633JlazFIUJ3d7a7N3vQj","PanelMissionThumbnailBase");var a=t("Singleton"),n=t("CommonButton"),o=(t("GameConst"),t("ItemUtils"),cc.Enum({PRE_PANEL_INCOMPLETE:0,CHALLENGING:1,READY_COMPLETE:2,COMPLETE:3})),r=251,s=252,c=253;cc.Class({extends:cc.Component,properties:{itemThumbnailParentNode:cc.Node,itemThumbnailPrefab:cc.Prefab,missionSituationNow:cc.Label,missionSituationGoal:cc.Label,missionCompleteStampNode:cc.Node,modelDetailPopupPrefab:cc.Prefab,receiveBtn:n},_missionModel:null,_missionStatusType:0,_receiveCallback:null,onLoad:function(){this.receiveBtn.setTapEvent(this._onTapReceiveBtn.bind(this),n.SE_NAME.EXECUTE)},initPanelMissionThumbnailBase:function(t){this._missionModel=t},_onTapReceiveBtn:function(){this.receiveBtn.getBtnImageSwitchState()&&this._receiveCallback&&this._receiveCallback(this._missionModel)},setThumbnailStatusType:function(t){this._missionStatusType=o.PRE_PANEL_INCOMPLETE,t&&(this._missionStatusType=o.CHALLENGING,this._missionModel.getReceiveCount()>0?this._missionStatusType=o.COMPLETE:this._missionModel.getIsReceivable()&&(this._missionStatusType=o.READY_COMPLETE))},getThumbnailStatusType:function(){return this._missionStatusType},setReceiveCallback:function(t){this._receiveCallback=t},setReceiveBtn:function(t){this.receiveBtn.node.active=t},setRewardItemThumbnail:function(t,e,i,a){var n=cc.instantiate(this.itemThumbnailPrefab).getComponent("ItemMatrixThumbnail");n.setMainImage(t),n.setNumeCount("x",e,void 0),this.itemThumbnailParentNode.addChild(n.node),n.setCallbackToThumbnailBtn(this._onTapItemThumbnail.bind(this,n.node,i,a,this.itemThumbnailParentNode.scale))},setSituationNowLabel:function(t){this.missionSituationNow.string=String(t)},setSituationGoalNumLabel:function(t){this.missionSituationGoal.string=String(t)},setCompleteStampNode:function(t){this.missionCompleteStampNode.active=t},getMissionRewardMasterByMissionId:function(t){return _.filter(a.dao.MissionRewardMasters,function(e){return e.getMissionId()===t})[0]},_onTapItemThumbnail:function(t,e,i,a){},_setModelDetailPopupZOrder:function(t,e,i){t.node.zIndex=c,e.zIndex=s,i.zIndex=r}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",ItemUtils:"ItemUtils",Singleton:"Singleton"}],PanelMissionThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"fb86d++yW5CPbDFdeA0cuMd","PanelMissionThumbnail");var a=t("CommonButton"),n=t("PanelMissionThumbnailBase"),o=t("ResourceUtils"),r=t("MissionConst"),s=t("GameConst"),c=t("ItemUtils"),l=cc.Enum({PRE_PANEL_INCOMPLETE:0,CHALLENGING:1,READY_COMPLETE:2,COMPLETE:3});cc.Class({extends:n,properties:{missionName:cc.Label,situationProgressBarParentNode:cc.Node,missionSituationProgressBar:cc.ProgressBar,situationProgressCompleteNode:cc.Node,readyCompleteNoticeNode:cc.Node,challengeBtn:a},_challengeCallback:null,_destinationSceneName:null,onLoad:function(){this._super(),this.challengeBtn.setTapEvent(this._onTapChallengeBtn.bind(this))},initPanelMissionThumbnail:function(t,e,i,a){this.initPanelMissionThumbnailBase(t),this.setThumbnailStatusType(e),this.setReceiveCallback(i),this._setChallengeCallback(a),this._switchInitThumbnail()},_switchInitThumbnail:function(){this._initDestinationSceneName(),this._initBtn();var t=this._missionModel.getClearCount(),e=this._missionModel.getConditionCount();switch(this._initThumbnail(e),this.getThumbnailStatusType()){case l.CHALLENGING:this._initChallengingThumbnail(t,e);break;case l.READY_COMPLETE:this._initReadyCompleteThumbnail();break;case l.COMPLETE:this._initCompleteThumbnail()}},_initDestinationSceneName:function(){var t=_.find(Object.keys(r.MISSION_SETTING),function(t){return r.MISSION_SETTING[t].type===this._missionModel.getMissionType()}.bind(this));this._destinationSceneName=r.MISSION_SETTING[t].sceneName},_initBtn:function(){this._setChallengeBtn(!1),this.setReceiveBtn(!1)},_initThumbnail:function(t){var e=this._missionModel.getText(),i=this.getMissionRewardMasterByMissionId(this._missionModel.getMissionId());this._setMissionName(e),this.setSituationNowLabel(0),this.setSituationGoalNumLabel(t),this._setSituationProgressBar(0,t),this.setRewardItemThumbnail(o.getFileNameThumbnailByItemType(i.getItemId(),i.getItemType()),i.getCount(),i.getItemType(),i.getItemId()),this.setCompleteStampNode(!1),this._setChallengeBtn(!0)},_initChallengingThumbnail:function(t,e){this.setSituationNowLabel(t),this.setSituationGoalNumLabel(e),this._setSituationProgressBar(t,e),this._setChallengeBtn(!0)},_initReadyCompleteThumbnail:function(){this.situationProgressBarParentNode.active=!1,this.situationProgressCompleteNode.active=!0,this.readyCompleteNoticeNode.active=!0,this._setChallengeBtn(!1),this.setReceiveBtn(!0),this.receiveBtn.switchBtnImage(!0)},_initCompleteThumbnail:function(t,e){this.situationProgressBarParentNode.active=!1,this.situationProgressCompleteNode.active=!0,this.setCompleteStampNode(!0),this._setChallengeBtn(!1),this.setReceiveBtn(!0),this.receiveBtn.switchBtnImage(!1)},_onTapChallengeBtn:function(){this.getThumbnailStatusType()!==l.PRE_PANEL_INCOMPLETE&&this._challengeCallback&&this._challengeCallback(this._destinationSceneName)},_setMissionName:function(t){this.missionName.string=t},_setChallengeCallback:function(t){this._challengeCallback=t},_setSituationProgressBar:function(t,e){this.missionSituationProgressBar.progress=t<=0?0:t/e},_setChallengeBtn:function(t){""!==this._destinationSceneName?this.challengeBtn.node.active=t:this.challengeBtn.node.active=!1},_onTapItemThumbnail:function(t,e,i,a){if(this.modelDetailPopupPrefab){var n=cc.director.getScene().getChildByName("Canvas"),o=cc.instantiate(this.modelDetailPopupPrefab).getComponent("ModelDetailPopup"),r=cc.instantiate(t),l=cc.instantiate(t);l.setScale(a);var u=t.convertToWorldSpaceAR(cc.v2(0,0)),h=n.convertToNodeSpaceAR(u);n.addChild(l,s.Z_ORDER.POPUP),l.setPosition(h);var d=c.getItemInfo(e,i);o.node.setPosition(cc.v2(h.x-250,h.y+100));var p=cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack"),m=p?p.zIndex:void 0;o.openModelDetailPopup(r,d.name,d.text,function(){l.destroy(),p&&(p.zIndex=m)}),this._setModelDetailPopupZOrder(o,l,p)}}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",ItemUtils:"ItemUtils",MissionConst:"MissionConst",PanelMissionThumbnailBase:"PanelMissionThumbnailBase",ResourceUtils:"ResourceUtils"}],PaymentApis:[function(t,e,i){"use strict";cc._RF.push(e,"61999NkP29PpJs8DpwItgph","PaymentApis");var a=t("RESTClient").RESTClient;a.graft({name:"payment/getMasterData",path:"payment/getMasterData",method:"GET",type:"binary"}),a.graft({name:"payment/getPaymentResult",path:"payment/getPaymentResult",method:"POST"}),a.graft({name:"payment/beginSpPayment",path:"payment/beginSpPayment",method:"POST"}),a.graft({name:"payment/beginAndroidPayment",path:"payment/beginAndroidPayment",method:"POST"}),a.graft({name:"payment/createAndroidPayment",path:"payment/createAndroidPayment",method:"POST"}),cc._RF.pop()},{RESTClient:"RESTClient"}],PaymentManager:[function(t,e,i){"use strict";cc._RF.push(e,"84dac1xJ0RGA7JU/3B7Vmvh","PaymentManager");var a=t("Singleton"),n=t("SingletonConst"),o=t("DmmAndroidJsToJava"),r=(t("ResourceUtils"),cc.Enum({SUCCESS:0,CANCEL:1,ERROR:2}));cc.Class({extends:cc.Component,_requestCaller:void 0,_dmmAndroidData:void 0,_dmmAndroidCallbackFlg:!1,ctor:function(){this._requestCaller=arguments[0]},request:function(t,e,i){var o=a.dao.DmmMasters.find(function(e){return e.getSkuId()===t}),r=a[n.ENVIRONMENT],s={SKU_ID:""+t,PRICE:""+o.getPrice(),COUNT:""+e,DESCRIPTION:o.getText(),NAME:o.getName(),IMAGE_URL:r.getPaymentImageUrl()+t+".png"};cc.sys.isBrowser&&cc.sys.isMobile?(s.VERSION=r.getResourceVersion(),this._requestDmmSpPayment(s,i)):cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID?this._requestDmmAndroidPayment(s,i):this._requestDmmPcPayment(s,i)},_requestDmmPcPayment:function(t,e){var i=this;window.addEventListener("message",function t(a){if("paymentSuccess"===a.data.type)if(window.removeEventListener("message",t,!1),"ok"===a.data.result.responseCode){var n={paymentId:a.data.result.payment_id};i._paymentSuccess(n,e)}else i._paymentCancel(e);else"paymentError"===a.data.type&&(window.removeEventListener("message",t,!1),i._paymentError(a.data,e))}),window.parent.postMessage({api:"payment",param:t},"*")},_requestDmmSpPayment:function(t,e){var i=this;this._requestCaller("payment/beginSpPayment",t,function(t,a){if(t||a.err)return i._paymentError(a.err,e);i._openDmmSpPaymentWindow(a.transactionUrl)})},_openDmmSpPaymentWindow:function(t){window.parent.location.href=t},_requestDmmAndroidPayment:function(t,e){var i=this;this._requestCaller("payment/beginAndroidPayment",t,function(a,n){if(a||n.err)return i._paymentError(n.err,e);o.requestDmmAndroidPayment(n.callbackUrl,t,function(a){i._createDmmAndroidPayment(a,t,e)})})},_createDmmAndroidPayment:function(t,e,i){var a=this,n={entry:t,item:e};this._requestCaller("payment/createAndroidPayment",n,function(t,n){if(t||n.err)return a._paymentError(n.err,i);o.openDmmAndroidPayment(),a._dmmAndroidData={},a._dmmAndroidCallbackFlg=!1,a.schedule(a._paymentDmmAndroidCallback.bind(a,e),1/60),window.resultAndroidPayment=function(t,e,n){a._dmmAndroidData={state:t,eventType:e,paymentId:n,callback:i},a._dmmAndroidCallbackFlg=!0,window.resultAndroidPayment=null}})},_paymentDmmAndroidCallback:function(t){if(this._dmmAndroidCallbackFlg){if(this._dmmAndroidData.state===r.SUCCESS){if(null===this._dmmAndroidData.paymentId)return void this._paymentError("payment err",this._dmmAndroidData.callback);if(260===this._dmmAndroidData.eventType)return void this._paymentError("payment err",this._dmmAndroidData.callback);o.dmpSpend(t.PRICE),this._paymentSuccess(this._dmmAndroidData,this._dmmAndroidData.callback)}else this._dmmAndroidData.state===r.CANCEL?this._paymentCancel(this._dmmAndroidData.callback):this._paymentError("payment err",this._dmmAndroidData.callback);this._dmmAndroidCallbackFlg=!1,this.unscheduleAllCallbacks()}},_paymentSuccess:function(t,e){var i=this,a={paymentId:t.paymentId};this._requestCaller("payment/getPaymentResult",a,function(t,a){return t||a.err?e(a.status):"userCanceled"===a.response_code?i._paymentCancel(e):e(void 0,a)})},_paymentCancel:function(t){return t(null)},_paymentError:function(t,e){return e(t)}}),cc._RF.pop()},{DmmAndroidJsToJava:"DmmAndroidJsToJava",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],PaymentService:[function(t,e,i){"use strict";cc._RF.push(e,"d7c409q7f9M55B1M+m+4VIW","PaymentService");var a=t("BaseService");cc.Class({extends:a,getResult:function(t,e){var i={paymentId:t};this._requestCallApi("payment/getPaymentResult",i,function(t,i){return t||i.err?e(null):"userCanceled"===i.response_code?e(null):e(i)})}});cc._RF.pop()},{BaseService:"BaseService"}],PictureBookBaseModel:[function(t,e,i){"use strict";cc._RF.push(e,"d51canHgkxAlqj559yD99uU","PictureBookBaseModel");var a=t("UserPictureBookBaseModel"),n=t("Singleton"),o=(t("CommonUtils"),t("CharacterConst")),r=(t("RoomConst"),t("PictureBookUtils"));cc.Class({userData:void 0,_characterGroupMaster:void 0,_characterMainMasterArray:void 0,_contentsMasterArray:void 0,_normalStoryMasterArray:void 0,_adultStoryMasterArray:void 0,_roomStoryMasterArray:void 0,_voiceStoryMasterArray:void 0,_characterVoiceContentsMasterArray:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._characterGroupMaster=null,this._characterMainMasterArray=null,this._contentsMasterArray=null,this._normalStoryMasterArray=null,this._adultStoryMasterArray=null,this._roomStoryMasterArray=null,this._voiceStoryMasterArray=null,this._characterVoiceContentsMasterArray=null},getCharacterGroupMaster:function(){return this._characterGroupMaster||(this._characterGroupMaster=n.dao.CharacterGroupMasters.find(function(t){return t.getCharacterGroupId()===this.userData.getCharacterGroupId()}.bind(this))),this._characterGroupMaster},getPictureBookDetailModelArray:function(){return n.dao.pictureBookDetail.filter(function(t){return t.getCharacterGroupId()===this.userData.getCharacterGroupId()}.bind(this))},getPictureBookDetailModelByCharacterId:function(t){return n.dao.pictureBookDetail.find(function(e){return e.getCharacterId()===t})},getCharacterMainMasterArray:function(){return this._characterMainMasterArray||(this._characterMainMasterArray=n.dao.CharacterMainMasters.filter(function(t){return t.getCharacterGroupId()===this.userData.getCharacterGroupId()}.bind(this))),this._characterMainMasterArray},getCharacterMainMastersByCharacterType:function(t){return this.getCharacterMainMasterArray().filter(function(e){return parseInt(e.getCharacterType())===parseInt(t)})},getDefaultRoomCharacterMainModel:function(){return this.getCharacterMainMastersByCharacterType(o.CHARACTER_TYPE.DEFAULT)[0]},getCharacterGroupId:function(){return this.userData.getCharacterGroupId()},getRoomSelectCharacterId:function(){return this.userData.getRoomSelectCharacterId()<=0?this.getPictureBookDetailModelArray()[0].getCharacterId():this.userData.getRoomSelectCharacterId()},getRoomSelectPictureBookDetailModel:function(){return n.dao.pictureBookDetail.find(function(t){return t.getCharacterId()===this.getRoomSelectCharacterId()}.bind(this))},getName:function(){return this.getCharacterGroupMaster().getName()},getShortName:function(){return this.getCharacterGroupMaster().getShortName()},getText:function(){return this.getCharacterGroupMaster().getText()},getContentsGroupId:function(){return this.getCharacterGroupMaster().getContentsGroupId()},getFriendship:function(){return this.getPictureBookDetailModelArray()[0].getMaxFriendship()},getContentsMasterArray:function(){return this._contentsMasterArray||(this._contentsMasterArray=r.getContentsMasterArrayByContentsGroupId(this.getContentsGroupId())),this._contentsMasterArray},getRoomStoryMasterArray:function(){return this._roomStoryMasterArray||(this._roomStoryMasterArray=r.createRoomStoryMasterArray(this.getCharacterGroupId())),this._roomStoryMasterArray},getVoiceStoryMasterArray:function(){return this._voiceStoryMasterArray||(cc.log(n.dao.StoryVoiceMasters),this._voiceStoryMasterArray=r.createVoiceStoryMasterArray(this.getContentsMasterArray())),this._voiceStoryMasterArray},getNormalStoryMasterArray:function(){return this._normalStoryMasterArray||(this._normalStoryMasterArray=r.createNormalStoryMasterArray(this.getContentsMasterArray())),this._normalStoryMasterArray},getAdultStoryMasterArray:function(){return this._adultStoryMasterArray||(this._adultStoryMasterArray=r.createAdultStoryMasterArray(this.getContentsMasterArray())),this._adultStoryMasterArray},getVoiceContentsMasterArray:function(){return this._characterVoiceContentsMasterArray||(this._characterVoiceContentsMasterArray=r.createVoiceContentsMasterArray(this.getContentsMasterArray())),this._characterVoiceContentsMasterArray},getUserRoomStoryMap:function(){return r.createUserRoomStoryMap(this.getRoomStoryMasterArray())},getUserNormalStoryMap:function(){return r.createUserNormalStoryMap(this.getContentsMasterArray())},getUserVoiceStoryMap:function(){return r.createUserVoiceStoryMap(this.getContentsMasterArray())},getUserAdultStoryMap:function(){return r.createUserAdultStoryMap(this.getContentsMasterArray())},isNewReleasedRoomStory:function(){var t=this.getUserRoomStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;var i=this.getPictureBookDetailModelArray();for(var e in i)if(i[e].isNewReleasedRoomStory())return!0;return!1},isNewReleasedNormalStory:function(){var t=this.getUserNormalStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedAdultStory:function(){var t=this.getUserAdultStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedSpVoice:function(){var t=this.getUserVoiceStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedAllStory:function(){if(this.isNewReleasedRoomStory())return!0;if(this.isNewReleasedNormalStory())return!0;if(this.isNewReleasedAdultStory())return!0;if(this.isNewReleasedSpVoice())return!0;var t=this.getPictureBookDetailModelArray();for(var e in t)if(t[e].isNewReleasedStory())return!0;return!1},isNewReleasedCardStory:function(){if(this.isNewReleasedNormalStory())return!0;if(this.isNewReleasedAdultStory())return!0;if(this.isNewReleasedSpVoice())return!0;var t=this.getPictureBookDetailModelArray();for(var e in t)if(t[e].isNewReleasedCardStory())return!0;return!1}});cc._RF.pop()},{CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",PictureBookUtils:"PictureBookUtils",RoomConst:"RoomConst",Singleton:"Singleton",UserPictureBookBaseModel:"UserPictureBookBaseModel"}],PictureBookDetailFilterConst:[function(t,e,i){"use strict";cc._RF.push(e,"b78f6PmhYlLyqKMVD4jJnrO","PictureBookDetailFilterConst");cc.Class({statics:{PROPERTY_NAME:"PictureBookDetailFilter",FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_THUNDER:2,ATTRIBUTE_WIND:3,ATTRIBUTE_DARK:4,ATTRIBUTE_LIGHT:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9}),FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4"}}});cc._RF.pop()},{}],PictureBookDetailModel:[function(t,e,i){"use strict";cc._RF.push(e,"882ddHWBspE6o/x47n/wIfP","PictureBookDetailModel");t("UserPictureBookBaseModel");var a=t("UserPictureBookDetailModel"),n=t("Singleton"),o=t("CommonUtils"),r=t("RoomConst"),s=t("PictureBookUtils"),c=(t("CharacterUtils"),t("StoryUtils"));cc.Class({userData:void 0,_characterMainMaster:void 0,_characterGroupMaster:void 0,_characterFavoriteMasterArray:void 0,_characterFriendshipContentsMasterArray:void 0,_characterStoryContentsMasterArray:void 0,_contentsMasterArray:void 0,_normalStoryMasterArray:void 0,_adultStoryMasterArray:void 0,_roomStoryMasterArray:void 0,_voiceContentsMasterArray:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._characterMainMaster=null,this._characterGroupMaster=null,this._characterFavoriteMasterArray=null,this._characterFriendshipContentsMasterArray=null,this._characterStoryContentsMasterArray=null,this._contentsMasterArray=null,this._normalStoryMasterArray=null,this._adultStoryMasterArray=null,this._roomStoryMasterArray=null,this._voiceContentsMasterArray=null},getCharacterMainMaster:function(){return this._characterMainMaster||(this._characterMainMaster=n.dao.CharacterMainMasters.find(function(t){return t.getCharacterId()===this.userData.getCharacterId()}.bind(this))),this._characterMainMaster},getCharacterGroupMaster:function(){return this._characterGroupMaster||(this._characterGroupMaster=n.dao.CharacterGroupMasters.find(function(t){return t.getCharacterGroupId()===this.getCharacterGroupId()}.bind(this))),this._characterGroupMaster},getCharacterFavoriteMasterArray:function(){return this._characterFavoriteMasterArray||(this._characterFavoriteMasterArray=n.dao.CharacterFavoriteMasters.filter(function(t){return t.getCharacterId()===this.userData.getCharacterId()}.bind(this))),this._characterFavoriteMasterArray},getAttribute:function(){return this.getCharacterMainMaster().getAttribute()},getRarity:function(){return this.getCharacterMainMaster().getRarity()},getExceedLimit:function(){return this.userData.getExceedLimit()},getCharacterId:function(){return this.userData.getCharacterId()},getCharacterGroupId:function(){return this.getCharacterMainMaster().getCharacterGroupId()},getName:function(){return this.getCharacterMainMaster().getName()},getShortName:function(){return this.getCharacterMainMaster().getShortName()},getSkinName:function(){return this.getCharacterMainMaster().getSkinName()},getText:function(){return this.getCharacterMainMaster().getText()},getCharacterType:function(){return this.getCharacterMainMaster().getCharacterType()},getMaxFriendship:function(){return r.MAX_FRIENDSHIP},isFavoriteItemId:function(t){return this.getCharacterFavoriteMasterArray().some(function(e){return e.getFavoriteItemId()===t})},getUnion:function(){return this.getCharacterGroupMaster().getUnion()},getReadingName:function(){return this.getCharacterGroupMaster().getReadingName()},_getFriendshipRate:function(){return this.getFriendship()/100},getFriendshipBonusHp:function(){return this._friendshipBonusHp||(this._friendshipBonusHp=parseInt(this.getCharacterMainMaster().getMaxAddHp()*this._getFriendshipRate())),this._friendshipBonusHp},getFriendshipBonusAtk:function(){return this._friendshipBonusAtk||(this._friendshipBonusAtk=parseInt(this.getCharacterMainMaster().getMaxAddAtk()*this._getFriendshipRate())),this._friendshipBonusAtk},getFriendshipBonusDef:function(){return this._friendshipBonusDef||(this._friendshipBonusDef=parseInt(this.getCharacterMainMaster().getMaxAddDef()*this._getFriendshipRate())),this._friendshipBonusDef},getContentsGroupId:function(){return this.getCharacterMainMaster().getContentsGroupId()},getFriendship:function(){return this.userData.getFriendship()},getContentsMasterArray:function(){return this._contentsMasterArray||(this._contentsMasterArray=s.getContentsMasterArrayByContentsGroupId(this.getContentsGroupId())),this._contentsMasterArray},getRoomStoryMasterArray:function(){return this._roomStoryMasterArray||(this._roomStoryMasterArray=s.createRoomStoryMasterArray(this.getCharacterId())),this._roomStoryMasterArray},getNormalStoryMasterArray:function(){return this._normalStoryMasterArray||(this._normalStoryMasterArray=s.createNormalStoryMasterArray(this.getContentsMasterArray())),this._normalStoryMasterArray},getAdultStoryMasterArray:function(){return this._adultStoryMasterArray||(this._adultStoryMasterArray=s.createAdultStoryMasterArray(this.getContentsMasterArray())),this._adultStoryMasterArray},getVoiceContentsMasterArray:function(){return this._characterVoiceContentsMasterArray||(this._characterVoiceContentsMasterArray=s.createVoiceContentsMasterArray(this.getContentsMasterArray())),this._characterVoiceContentsMasterArray},getUserRoomStoryMap:function(){return s.createUserRoomStoryMap(this.getRoomStoryMasterArray())},getUserNormalStoryMap:function(){return s.createUserNormalStoryMap(this.getContentsMasterArray())},getUserAdultStoryMap:function(){return s.createUserAdultStoryMap(this.getContentsMasterArray())},getUserVoiceStoryMap:function(){return s.createUserVoiceStoryMap(this.getContentsMasterArray())},isNewReleasedRoomStory:function(){var t=this.getUserRoomStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedNormalStory:function(){var t=this.getUserNormalStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedAdultStory:function(){var t=this.getUserAdultStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedSpVoice:function(){var t=this.getUserVoiceStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedStory:function(){var t=this._createUserCharacterStoryMap();for(var e in t)if(!t[e].getIsRead())return!0;return!1},isNewReleasedCardStory:function(){return!!this.isNewReleasedNormalStory()||(!!this.isNewReleasedAdultStory()||!!this.isNewReleasedSpVoice())},getReleasableFriendshipVoiceContentsMasterArray:function(t,e){return this.getCharacterFriendshipContentsMasterArray().filter(function(i){return i.getContentType()===r.ROOM_CONTENTS_TYPE.VOICE_SCENARIO&&t<i.getConditionValue1()&&i.getConditionValue1()<=e})},getReleasableFriendshipStoryIdArray:function(t){var e=[],i=this.getCharacterStoryContentsMasterArray(),a=this._createUserCharacterStoryMap();for(var n in i){var o=i[n],r=o.getStoryId();if(!a[r]){var c=s.isReleasedContentsCondition(o.getConditionType1(),o.getConditionValue1(),this,t),l=s.isReleasedContentsCondition(o.getConditionType2(),o.getConditionValue2(),this,t);c&&l&&e.push(r)}}return e},getCharacterFriendshipContentsMasterArray:function(){if(!this._characterFriendshipContentsMasterArray){this._characterFriendshipContentsMasterArray=this.getContentsMasterArray().slice().filter(function(t){return t.getConditionType1()===r.RELEASE_CONDITION_TYPE.FRIENDSHIP});var t=[];t.push({getterName:"getConditionValue1"}),this._characterFriendshipContentsMasterArray=o.sortModels(this._characterFriendshipContentsMasterArray,t)}return this._characterFriendshipContentsMasterArray},getContentsId:function(){return this.getContentsMasterArray()[0].getContentsId()},getConditionType1:function(){return this.getContentsMasterArray()[0].getConditionType1()},getConditionType2:function(){return this.getContentsMasterArray()[0].getConditionType2()},getConditionValue1:function(){return this.getContentsMasterArray()[0].getConditionValue1()},getConditionValue2:function(){return this.getContentsMasterArray()[0].getConditionValue2()},getStoryId:function(){return this.getContentsMasterArray()[0].getStoryId()},getCharacterStoryContentsMasterArray:function(){return this._characterStoryContentsMasterArray||(this._characterStoryContentsMasterArray=this.getContentsMasterArray().slice().filter(function(t){return t.getStoryId()>0})),this._characterStoryContentsMasterArray},getLastReleaseFriendshipContentsMaster:function(){var t=this.getCharacterFriendshipContentsMasterArray().filter(function(t){return t.getConditionValue1()<=this.getFriendship()}.bind(this));return t[t.length-1]},getNextReleaseFriendshipContentsMaster:function(){return this.getCharacterFriendshipContentsMasterArray().find(function(t){return t.getConditionValue1()>this.getFriendship()}.bind(this))},getNeedFriendshipForNextContentsRelease:function(){var t=this.getNextReleaseFriendshipContentsMaster();return t?t.getConditionValue1()-this.getFriendship():0},getNextReleaseFriendshopContentsText:function(){var t="",e=this.getNextReleaseFriendshipContentsMaster();if(e)switch(e.getContentType()){case r.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO:case r.ROOM_CONTENTS_TYPE.ADULT_SCENARIO:t="\u30b7\u30ca\u30ea\u30aa";break;case r.ROOM_CONTENTS_TYPE.VOICE_SCENARIO:t="\u30dc\u30a4\u30b9"}return t},_createUserCharacterStoryMap:function(){var t=this.getContentsMasterArray(),e={},i=c.createUserStoryFlatMap();for(var a in t){var n=t[a].getStoryId(),o=i[n];o&&(e[n]=o)}return e},getPictureBookDetailVoiceInfoMap:function(){return this._createCharacterContentsVoiceInfoMap()},_createCharacterContentsVoiceInfoMap:function(){var t=this.getVoiceContentsMasterArray(),e={};for(var i in t){var a=t[i],n=a.getConditionValue1()<=this.getFriendship(),o=s.createCharacterContentsVoiceInfo(a,this.getCharacterGroupId(),this.getCharacterId(),n);e[a.getContentsId()]=o}return e}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",PictureBookUtils:"PictureBookUtils",RoomConst:"RoomConst",Singleton:"Singleton",StoryUtils:"StoryUtils",UserPictureBookBaseModel:"UserPictureBookBaseModel",UserPictureBookDetailModel:"UserPictureBookDetailModel"}],PictureBookDetailSortConst:[function(t,e,i){"use strict";cc._RF.push(e,"9577bMjL9BPf68hKTaj/HtQ","PictureBookDetailSortConst");cc.Class({statics:{SORT_TYPE:cc.Enum({GETTING:0,ATTRIBUTE:1,RARE:2,FRIENDSHIP:3}),SORT_FUNC_NAME:{GETTING:"getCharacterId",ATTRIBUTE:"getAttribute",RARE:"getRarity",FRIENDSHIP:"getFriendship"}}});cc._RF.pop()},{}],PictureBookService:[function(t,e,i){"use strict";cc._RF.push(e,"ba7bbCSp6hLUr/lXUvc+rGj","PictureBookService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,gift:function(t,e,i,a){var o={characterId:t,itemId:e,count:i};this._requestCallApi(n.PICTURE_BOOK_GIFT,o,function(t,e){return a(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],PictureBookUtils:[function(t,e,i){"use strict";cc._RF.push(e,"cfd0f1PmBZHibbWphs4cucI","PictureBookUtils");var a=t("Singleton"),n=(t("CharacterConst"),t("StoryConst"),t("StoryUtils")),o=t("RoomConst"),r=t("CommonUtils"),s=t("TimeUtils");function c(t){return a.dao.CharacterContentsMasters.filter(function(e){return e.getContentsGroupId()===t})}function l(t){var e=t.slice();return a.dao.StoryPictureBookMasters.filter(function(t){for(var i=0;i<e.length;i+=1)if(e[i].getStoryId()===t.getStoryId()&&e[i].getContentType()===o.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO)return e.splice(i,1),!0;return!1})}function u(t){var e=t.slice();return a.dao.StoryVoiceMasters.filter(function(t){for(var i=0;i<e.length;i+=1)if(e[i].getStoryId()===t.getStoryId()&&e[i].getContentType()===o.ROOM_CONTENTS_TYPE.VOICE_SCENARIO)return e.splice(i,1),!0;return!1})}function h(t){return t=t.slice(),a.dao.StoryPictureBookMasters.filter(function(e){for(var i=0;i<t.length;i+=1)if(t[i].getStoryId()===e.getStoryId()&&t[i].getContentType()===o.ROOM_CONTENTS_TYPE.ADULT_SCENARIO)return t.splice(i,1),!0;return!1})}function d(t){return a.dao.StoryRoomMasters.filter(function(e){return e.getCondition1()===t})}function p(t,e,i,a,n,r,s,c,l,u){var h={};return h[o.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO]=m(t,e,i,s),h[o.ROOM_CONTENTS_TYPE.ADULT_SCENARIO]=m(t,e,a,c),h[o.ROOM_CONTENTS_TYPE.ROOM_SCENARIO]=m(t,e,n,l),h[o.ROOM_CONTENTS_TYPE.VOICE_SCENARIO]=m(t,e,r,u),h}function m(t,e,i,a){var n={},o=E();for(var r in i){var s=i[r],c=s.getStoryId(),l=o[c],u=a[c],h=v(s,l,u,t,e,!!u);n[c]=h}return n}function g(t){t=Array.isArray(t)?t:a.dao.CharacterGroupMasters;var e=C(),i={};for(var n in t){var o=t[n],r=o.getCharacterGroupId(),s=e[r];s&&(i[r]=b(o,s))}return i}function C(){var t=a.dao.pictureBookBase,e={};for(var i in t){var n=t[i],o=a.dao.CharacterGroupMasters.find(function(t){return t.getCharacterGroupId()===n.getCharacterGroupId()});parseInt(s.getNowDateTime())>parseInt(o.getFromDate())&&(e[n.getCharacterGroupId()]=n)}return e}function f(t){var e={},i=a.dao.pictureBookDetail.filter(function(e){return e.getCharacterGroupId()===t});for(var n in i)e[i[n].getCharacterId()]=i[n];return e}function E(){var t={},e=a.dao.CharacterContentsMasters;for(var i in e){var n=e[i],o=n.getStoryId();o>0&&(t[o]=n)}return t}function T(t,e,i,a){switch(t){case o.RELEASE_CONDITION_TYPE.NON:return!0;case o.RELEASE_CONDITION_TYPE.FRIENDSHIP:return e<=i.getFriendship();case o.RELEASE_CONDITION_TYPE.EXCEEDLIMIT:return e<=i.getExceedLimit();case o.RELEASE_CONDITION_TYPE.STORY:for(var n in a)for(var r in a[n])if(e===a[n][r].storyMaster.getStoryId())return!!a[n][r].userStoryModel&&!!a[n][r].userStoryModel.getIsRead();return!0;default:return!0}}function S(t,e){var i="";switch(t){case o.RELEASE_CONDITION_TYPE.FRIENDSHIP:i="\u9069\u5408\u7387"+e+"%";break;case o.RELEASE_CONDITION_TYPE.EXCEEDLIMIT:i="\u9650\u754c\u7a81\u7834\u56de\u6570 "+e;break;case o.RELEASE_CONDITION_TYPE.STORY:var a=e;i=n.getStoryMasterFlatMap()[a].getName()+" \u8aad\u4e86"}return i}function R(t,e,i,a){return(isNaN(parseInt(e))||t.getCharacterId()===e)&&(isNaN(parseInt(i))||t.getSceneType()===i)&&(isNaN(parseInt(a))||t.getGroupType()===a)}function A(){var t={},e=a.dao.CharacterTextMasters;for(var i in e){var n=e[i];t[n.getTextId()]=n}return t}function b(t,e){return{characterGroupMaster:t,pictureBookBaseModel:e}}function M(t,e,i){return{characterMainMaster:t,pictureBookDetailModel:e,characterContentsInfoMap:i}}function v(t,e,i,a,n,o){return{storyMaster:t,userStoryModel:i,contentsMaster:e,characterGroupId:a,characterId:n,isReleased:o}}e.exports={getContentsMasterArrayByContentsGroupId:c,getRoomStoryMasterArrayByFurnitureId:function(t){return a.dao.StoryRoomMasters.filter(function(e){return e.getCondition2()===t})},createRoomStoryMasterArray:d,createNormalStoryMasterArray:l,createAdultStoryMasterArray:h,createVoiceStoryMasterArray:u,createVoiceContentsMasterArray:function(t){var e=t.slice().filter(function(t){return t.getContentType()===o.ROOM_CONTENTS_TYPE.VOICE_SCENARIO}),i=[];return i.push({getterName:"getConditionValue1"}),i.push({getterName:"getContentsId"}),r.sortModels(e,i)},createUserNormalStoryMap:function(t){var e={},i=a.dao.userStories,n=t.slice();for(var r in i){var s=i[r],c=s.getStoryId();for(var l in n){var u=n[l];if(u.getStoryId()===c&&u.getContentType()===o.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO){n.splice(l,1),e[c]=s;break}}}return e},createUserAdultStoryMap:function(t){var e={},i=a.dao.userStories,n=t.slice();for(var r in i){var s=i[r],c=s.getStoryId();for(var l in n){var u=n[l];if(u.getStoryId()===c&&u.getContentType()===o.ROOM_CONTENTS_TYPE.ADULT_SCENARIO){n.splice(l,1),e[c]=s;break}}}return e},createUserRoomStoryMap:function(t){var e={},i=a.dao.userStories,n=t.slice();for(var o in i){var r=i[o],s=r.getStoryId();for(var c in n)if(n[c].getStoryId()===s){n.splice(c,1),e[s]=r;break}}return e},createUserVoiceStoryMap:function(t){var e={},i=a.dao.userStories,n=t.slice();for(var r in i){var s=i[r],c=s.getStoryId();for(var l in n){var u=n[l];if(u.getStoryId()===c&&u.getContentType()===o.ROOM_CONTENTS_TYPE.VOICE_SCENARIO){n.splice(l,1),e[c]=s;break}}}return e},createCharacterContentsInfoMap:p,createPictureBookBaseInfoMap:g,createUserPictureBookBaseModelMap:C,createPictureBookDetailInfoMap:function(t,e,i){var n={};for(var o in e||(e=a.dao.CharacterMainMasters.filter(function(e){return e.getCharacterGroupId()===t})),i||(i=f(t)),e){var r=e[o],s=r.getCharacterId(),m=c(e[o].getContentsGroupId()),_=l(m),g=h(m),C=u(m),E=d(e[o].getCharacterId()),T=i[s],S=p(r.getCharacterGroupId(),s,_,g,E,C,T?T.getUserNormalStoryMap():{},T?T.getUserAdultStoryMap():{},T?T.getUserRoomStoryMap():{},T?T.getUserVoiceStoryMap():{});n[s]=M(r,T,S)}return n},getPictureBookBaseModelArrayByFurnitureId:function(t){var e=a.dao.userRoom.getRoomFurnitureList().filter(function(e){return e.getFurnitureId()===t}),i=C(),n=[];for(var o in e){var r=i[e[o].getCharacterGroupId()];r&&n.push(r)}return n},getPictureBookDetailModelByCharacterId:function(t){return a.dao.pictureBookDetail.find(function(e){return e.getCharacterId()===t})},isReleasedContentsCondition:T,getContentsReleaseConditionText:function(t,e,i){if(!t)return"\u958b\u653e\u6761\u4ef6\uff1a???";var a=T(t.getConditionType1(),t.getConditionValue1(),e,i),n=t.getConditionType1(),r=S(t.getConditionType1(),t.getConditionValue1()),s=T(t.getConditionType2(),t.getConditionValue2(),e,i),c=t.getConditionType2(),l=S(t.getConditionType2(),t.getConditionValue2());return a||n===o.RELEASE_CONDITION_TYPE.NON||s||c===o.RELEASE_CONDITION_TYPE.NON?a&&s?void 0:a?l+"\u3067\u958b\u653e":r+"\u3067\u958b\u653e":r+"\u3068"+l+"\u3067\u958b\u653e"},getCharacterTextMasterArray:function(t,e,i){return _.filter(a.dao.CharacterTextMasters,function(a){return R(a,t,e,i)})},getCharacterTextMasterMap:function(){return A()},createCharacterContentsStoryInfo:v,createCharacterContentsVoiceInfo:function(t,e,i,a,n){return{contentsMaster:t,textMaster:e,characterGroupId:i,characterId:a,isReleased:n}},isNewReleasedAllStory:function(){var t=g();for(var e in t)if(t[e].pictureBookBaseModel&&t[e].pictureBookBaseModel.isNewReleasedAllStory())return!0;return!1}},cc._RF.pop()},{CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",RoomConst:"RoomConst",Singleton:"Singleton",StoryConst:"StoryConst",StoryUtils:"StoryUtils",TimeUtils:"TimeUtils"}],PicturebookApis:[function(t,e,i){"use strict";cc._RF.push(e,"1f47c+oZCZGRaYV1lmmndvm","PicturebookApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.PICTURE_BOOK_GET_USER_DATA,path:"pictureBook/getUserData",method:"POST"}),a.RESTClient.graft({name:n.PICTURE_BOOK_GIFT,path:"pictureBook/gift",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],PlayerUnitCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"20b049VP9BA8YpByA34w1PJ","PlayerUnitCtrl");var a=t("BattleData"),n=t("BattleConstants"),o=t("SpineEventInterpreter"),r=t("BaseUnitCtrl"),s=(t("TimeUtils"),t("CharacterConst")),c=t("BattleFunction"),l=cc.Class({extends:r,properties:{avatarBaseNode:cc.Node,supportAvatarBaseNode:cc.Node,gaugeBaseNode:cc.Node,mainUnitAdjustPos:cc.Node,damageShowNode:cc.Node,effectShowNode:cc.Node,cardMoveAnm:cc.Animation,cardEffectAnm:cc.Animation,hpEffectAnm:cc.Animation,abilityEffectAnm:cc.Animation,charaChangeAnm:cc.Animation,hpLabel:cc.Label,hpNormal_sprFrame:cc.SpriteFrame,hpDanger_sprFrame:cc.SpriteFrame,skillNormal_sprFrame:cc.SpriteFrame,skillFull_sprFrame:cc.SpriteFrame,skillBtnAniSprite:cc.Sprite,hpNormal_font:cc.Font,hpDanger_font:cc.Font,hpFull_font:cc.Font,dyingEffectnode:cc.Node,subSpritesForAbilityShow:[cc.Node],unitCanInput:!1},_viewSpRate:0,_playingAnimName:"",mainCardShow:function(t,e){t()},charaCardShow:function(t,e){this.node.color=new cc.Color(0,0,0);var i=cc.fadeIn(.5),a=cc.tintTo(.5,255,255,255),n=cc.spawn(a,i);this.node.runAction(n),this.setSpineActionIdleOrGroggy(this.myBattleUnit.checkGroggy()),t()},playActionStart:function(t,e){this.cardMoveAnm.once("finished",function(e){t()}.bind(this),this),this.cardMoveAnm.play("AttackOnPos_Anim")},playPvPPlayerShow:function(t,e){var i=cc.fadeOut(0),a=cc.fadeIn(.3);this.node.runAction(cc.sequence(i,a)),this.cardMoveAnm.once("finished",function(e){t()}.bind(this),this),this.cardMoveAnm.play("PvPInPlayer_Anim")},playPvPEnemyShow:function(t,e){var i=cc.fadeOut(0),a=cc.fadeIn(.3);this.node.runAction(cc.sequence(i,a)),this.cardMoveAnm.once("finished",function(e){t()}.bind(this),this),this.cardMoveAnm.play("PvPInEnemy_Anim")},playAttack:function(t,e){this.myBattleUnit.mainAvatar.node.active=!0;var i=this.myBattleUnit.mainAvatar,r=i.timeScale;i.timeScale=n.NORMAL_ATTACK_SPEED_RATIO*a.cur_GameSpeed;var s=a.GM.gameRoot.playerAvatarNode,c=new cc.Node;c.parent=s,e.set("onEndDestroy",!1),e.set("main_spine",i);var l=new cc.Node,u=c.addComponent(o);l.parent=s,e.set("parentNode",a.UI_M.monsterEffectCenter),u.init(function(){i.timeScale=r},e);var h=e.get("startDelay");h/=n.NORMAL_ATTACK_SPEED_RATIO;var d=this.myBattleUnit.mainAvatar.node;d.color=new cc.Color(0,0,0),d.opacity=0;var p=cc.moveTo(0,0,90),m=cc.fadeIn(.1),_=cc.tintTo(.1,255,255,255),g=cc.spawn(_,m),C=cc.moveBy(.3,0,80),f=cc.fadeOut(.1),E=cc.tintTo(.1,0,0,0),T=cc.spawn(E,f),S=cc.delayTime(h),R=cc.callFunc(function(){t()}.bind(this)),A=cc.sequence(p,g,C,S,T,R);d.runAction(A)},playBeAttacked:function(t,e){this.cardMoveAnm.once("finished",function(e){t()}.bind(this),this),this.cardMoveAnm.play("Damage_Anim"),c.playRandomBattleVoice(this.myBattleUnit.textMasterArray,s.TEXT_GROUP_TYPE.BATTLE.DAMAGE)},play_AttackReturnToIdle:function(t,e){this.cardMoveAnm.on("finished",function(e){this.cardMoveAnm.off("finished",null),t()}.bind(this),this),this.cardMoveAnm.play("AttackOffPos_Anim")},play_SpineSkillReturnToIdle:function(t,e){t()},play_DamageToIdle:function(t,e){t()},playDead:function(t,e){a.latestDeadUnit=this,this.cardEffectAnm.on("finished",function(t){this.cardEffectAnm.off("finished",null)}.bind(this),this),this.cardEffectAnm.play("Death_Anim"),this.nowPlayingDeath=!0,this.myBattleUnit.thumbnailAvatar.setCompleteListener(function(e,i){t()}),this.myBattleUnit.thumbnailAvatar.setAnimation(0,"death",!1),this.myBattleUnit.thumbnailAvatar.node.color=new cc.Color(255,255,255);var i=cc.tintTo(.1,128,128,128);this.myBattleUnit.thumbnailAvatar.node.runAction(i),c.playRandomBattleVoice(this.myBattleUnit.textMasterArray,s.TEXT_GROUP_TYPE.BATTLE.DEATH)},playRevive:function(t,e){t()},playScaleHide:function(t,e){t()},playScaleRestore:function(t,e){t()},playCardHide:function(t,e){t()},playCardRestore:function(t,e){t()},playSkill:function(t,e){cc.log("playSkill"),this.cardEffectAnm.on("finished",function(e){this.cardEffectAnm.off("finished",null),cc.log("playSkill complete"),a.UI_M.b_canInputUI=!0,this.cardEffectAnm.play("Default_Anim"),t()}.bind(this),this),a.UI_M.b_canInputUI=!1,this.cardEffectAnm.play("SkillUse_Anim")},playAbilityCharaChange:function(t,e){this.charaChangeAnm.once("finished",function(e){t()}.bind(this),this),this.charaChangeAnm.play("AbilityCutin_CharaChange_Anim").speed=a.cur_GameSpeed},playSpineSkill:function(t,e){this.myBattleUnit.mainAvatar.node.active=!0;var i=this.myBattleUnit.mainAvatar,r=i.timeScale;i.timeScale=n.NORMAL_ATTACK_SPEED_RATIO*a.cur_GameSpeed;var s=a.GM.gameRoot.playerAvatarNode,c=new cc.Node;c.parent=s,e.set("onEndDestroy",!1),e.set("main_spine",i);var l=new cc.Node,u=c.addComponent(o);l.parent=s,e.set("parentNode",a.UI_M.monsterEffectCenter),u.init(function(){i.timeScale=r},e);var h=1,d=this.myBattleUnit.mainAvatar.node;h/=n.NORMAL_ATTACK_SPEED_RATIO,d.color=new cc.Color(255,255,255),cc.log("spineNode = "),cc.log(d);var p=d.parent.convertToNodeSpace(cc.v2(640,360)),m=cc.moveTo(0,p.x,p.y),_=cc.fadeIn(.1),g=cc.fadeOut(.1),C=cc.tintTo(.1,0,0,0),f=cc.spawn(C,g),E=cc.delayTime(h),T=cc.callFunc(function(){t()}.bind(this)),S=cc.sequence(m,_,E,f,T);d.runAction(S)},playCardFlip:function(t,e){t()},playCardFlipRestore:function(t,e){t()},setHp:function(t){this.hpLabel.string=t,this.hpGaugeBar.progress=t/this.myBattleUnit.getMaxHp(),this.hpGaugeBarDanger.progress=t/this.myBattleUnit.getMaxHp();var e=n.LOWHP_RATIO,i=t/this.myBattleUnit.getMaxHp();i<=e?(this.hpLabel.font=this.hpDanger_font,this.hpGaugeBar.node.active=!1,this.hpGaugeBarDanger.node.active=!0):i>=1?(this.hpLabel.font=this.hpFull_font,this.hpGaugeBar.node.active=!0,this.hpGaugeBarDanger.node.active=!1):(this.hpLabel.font=this.hpNormal_font,this.hpGaugeBar.node.active=!0,this.hpGaugeBarDanger.node.active=!1)},setSkillRate:function(t){this._viewSpRate=t,this.skillGaugeBar.progress=this._viewSpRate/n.SKILLRATE_MAX,this.redrawSkillOnEffect()},redrawSkillOnEffect:function(){if(this._viewSpRate>=n.SKILLRATE_MAX)if("SkillOn_Anim"!==!this._playingAnimName&&this.myBattleUnit.useSkillMode){var t=this.cardEffectAnm.play("SkillOn_Anim");t.wrapMode=cc.WrapMode.Loop,t.repeatCount=1/0,t.speed=a.cur_GameSpeed,this._playingAnimName="SkillOn_Anim"}else if("SPMax_Anim"!==!this._playingAnimName&&!this.myBattleUnit.useSkillMode){a.spMaxAnimStateArray.find(function(t){return t===this.cardEffectAnm.getAnimationState("SPMax_Anim")}.bind(this))||a.spMaxAnimStateArray.push(this.cardEffectAnm.getAnimationState("SPMax_Anim"));var e=this.cardEffectAnm.play("SPMax_Anim",0);for(var i in a.spMaxAnimStateArray)a.spMaxAnimStateArray[i].time=0;e.wrapMode=cc.WrapMode.Loop,e.repeatCount=1/0,e.speed=a.cur_GameSpeed,this._playingAnimName="SPMax_Anim"}this._viewSpRate<n.SKILLRATE_MAX&&("Default_Anim"!==this._playingAnimName&&(this.cardEffectAnm.play("Default_Anim").wrapMode=cc.WrapMode.Default,this._playingAnimName="Default_Anim"))},setSpineActionIdleOrGroggy:function(t){this.myBattleUnit.thumbnailAvatar.setCompleteListener(null),this.myBattleUnit.thumbnailAvatar.setAnimation(0,"idle",!0)},onClickSkillBtn:function(){this.myBattleUnit.isEnemy||(cc.log("onClickSkillBtn"),a.UI_M.b_canInputUI&&this._viewSpRate>=n.SKILLRATE_MAX&&this.myBattleUnit.curSkillRate>=n.SKILLRATE_MAX&&(this.myBattleUnit.useSkillMode=!this.myBattleUnit.useSkillMode,this.redrawSkillOnEffect()))},setTapEvent:function(t){this.onClickSkillBtn=t},getTapEvent:function(t){return this.onClickSkillBtn.bind(this)},setTouchEnable:function(t){},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e--)this.updateCallbacks[e](t);this.updateBuffIcon(t),this.debugLabel&&this.myBattleUnit&&this.myBattleUnit.initComplete,this.checkIsPlayingBuffContinueAnimation()||this.playBuffContinueAnimation()}});e.exports=l,cc._RF.pop()},{BaseUnitCtrl:"BaseUnitCtrl",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",CharacterConst:"CharacterConst",SpineEventInterpreter:"SpineEventInterpreter",TimeUtils:"TimeUtils"}],PointCurrencyThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"306fe27/QZPtrS0QrWDGQxW","PointCurrencyThumbnail");var a=t("ItemUtils"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("TimeUtils"),s=t("ExchangeConst");cc.Class({extends:cc.Component,properties:{currencyNode:cc.Node,currencyByCurrencySprite:cc.Sprite,currencyByCurrencyNumLabel:cc.Label,dateAndCurrencyNode:cc.Node,dateAndCurrencyByCurrencySprite:cc.Sprite,dateAndCurrencyByCurrencyNumLabel:cc.Label,dateAndCurrencyByDateLabel:cc.Label},_currencyCost:null,_pointDetailModel:null,initPointCurrencyThumbnail:function(t,e){this._currencyCost=t,this._pointDetailModel=e,this.currencyNode.active=!1,this.dateAndCurrencyNode.active=!1,this._pointDetailModel.getIsToDateDisplayFlg()&&this._pointDetailModel.getToDate()?(this._initDate(this._pointDetailModel.getToDate(),this.dateAndCurrencyByDateLabel),this._initCurrencyCost(t,this.dateAndCurrencyByCurrencySprite,this.dateAndCurrencyByCurrencyNumLabel),this.dateAndCurrencyNode.active=!0):(this._initCurrencyCost(t,this.currencyByCurrencySprite,this.currencyByCurrencyNumLabel),this.currencyNode.active=!0)},redraw:function(){this._setFontColor()},_initDate:function(t,e){e.string=_.replace(r.parseTimeToYmdhm(t)," ","\n")+"\u307e\u3067",this._setFontColor()},_initCurrencyCost:function(t,e,i){o.addSprite(e,o.getFileNameItemImage(t.itemId),void 0,void 0),i.string=n.convertToCommaDelimited(t.count),this._setFontColor()},_setFontColor:function(){this._pointDetailModel.getIsToDateDisplayFlg()&&this._pointDetailModel.getToDate()?this._setFontColorByCostOver(this.dateAndCurrencyByCurrencyNumLabel.node,this._currencyCost.itemId,this._currencyCost.count):this._setFontColorByCostOver(this.currencyByCurrencyNumLabel.node,this._currencyCost.itemId,this._currencyCost.count)},_setFontColorByCostOver:function(t,e,i){var n=a.getUserItemCount(e);t.color=n<i?s.COST_OVER_COLOR:s.NORMAL_COLOR}}),cc._RF.pop()},{CommonUtils:"CommonUtils",ExchangeConst:"ExchangeConst",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils"}],PoolManager:[function(t,e,i){"use strict";cc._RF.push(e,"3a736F4EnZNSIA0lNyQ6nTM","PoolManager");var a=t("BattleData"),n=t("EnumTypes"),o=t("BattleConstants"),r=t("SkillCutinView"),s=t("SkillCutinMessageView"),c=t("AbilityCutinView"),l=(t("AbilityCutinMessageView"),t("CommonUtils")),u=t("BattleFunction"),h=t("UnisonCutinView"),d=t("GameConst"),p=cc.Class({extends:cc.Component,properties:{attackUpIcon:cc.SpriteFrame,attackUpFireIcon:cc.SpriteFrame,attackUpWaterIcon:cc.SpriteFrame,attackUpThunderIcon:cc.SpriteFrame,attackUpWindIcon:cc.SpriteFrame,attackUpLightIcon:cc.SpriteFrame,attackUpDarkIcon:cc.SpriteFrame,attackDownIcon:cc.SpriteFrame,attackDownFireIcon:cc.SpriteFrame,attackDownWaterIcon:cc.SpriteFrame,attackDownThunderIcon:cc.SpriteFrame,attackDownWindIcon:cc.SpriteFrame,attackDownLightIcon:cc.SpriteFrame,attackDownDarkIcon:cc.SpriteFrame,defenceUpIcon:cc.SpriteFrame,defenceUpFireIcon:cc.SpriteFrame,defenceUpWaterIcon:cc.SpriteFrame,defenceUpThunderIcon:cc.SpriteFrame,defenceUpWindIcon:cc.SpriteFrame,defenceUpLightIcon:cc.SpriteFrame,defenceUpDarkIcon:cc.SpriteFrame,defenceDownIcon:cc.SpriteFrame,defenceDownFireIcon:cc.SpriteFrame,defenceDownWaterIcon:cc.SpriteFrame,defenceDownThunderIcon:cc.SpriteFrame,defenceDownWindIcon:cc.SpriteFrame,defenceDownLightIcon:cc.SpriteFrame,defenceDownDarkIcon:cc.SpriteFrame,hpUpIcon:cc.SpriteFrame,hpAttackUpIcon:cc.SpriteFrame,hpDefenceUpIcon:cc.SpriteFrame,criticalUpIcon:cc.SpriteFrame,criticalDownIcon:cc.SpriteFrame,cooperationProbabilityUpIcon:cc.SpriteFrame,cooperationProbabilityDownIcon:cc.SpriteFrame,cooperativeAttackUpIcon:cc.SpriteFrame,cooperativeAttackDownIcon:cc.SpriteFrame,skillDamageUpIcon:cc.SpriteFrame,skillDamageDownIcon:cc.SpriteFrame,damageCutIcon:cc.SpriteFrame,skillRiseUpIcon:cc.SpriteFrame,skillRiseDownIcon:cc.SpriteFrame,targetRateUpIcon:cc.SpriteFrame,targetRateDownIcon:cc.SpriteFrame,AbnormalStateInvalidIcon:cc.SpriteFrame,AbnormalStateResistanceUpIcon:cc.SpriteFrame,AbnormalStateResistanceDownIcon:cc.SpriteFrame,AbnormalStateUpIcon:cc.SpriteFrame,AbnormalStateDownIcon:cc.SpriteFrame,recoveryUpIcon:cc.SpriteFrame,recoveryDownIcon:cc.SpriteFrame,AutoRecoveryIcon:cc.SpriteFrame,poisonIcon:cc.SpriteFrame,paralysisIcon:cc.SpriteFrame,confusionIcon:cc.SpriteFrame,hitDownIcon:cc.SpriteFrame,skillSealIcon:cc.SpriteFrame,barrierIcon:cc.SpriteFrame,gutsIcon:cc.SpriteFrame,reflectIcon:cc.SpriteFrame,AvoidIcon:cc.SpriteFrame,dummyIcon:cc.SpriteFrame,damageNumPre:cc.Prefab,unisonShowPre:cc.Prefab,poisonContinuePrefab:cc.Prefab,poisonHitPrefab:cc.Prefab,poisonInvoke1Prefab:cc.Prefab,poisonInvoke2Prefab:cc.Prefab,poisonInvoke3Prefab:cc.Prefab,paralysisContinuePrefab:cc.Prefab,paralysisHitPrefab:cc.Prefab,paralysisInvoke1Prefab:cc.Prefab,paralysisInvoke2Prefab:cc.Prefab,paralysisInvoke3Prefab:cc.Prefab,attackUpHitPrefab:cc.Prefab,attackDownHitPrefab:cc.Prefab,defenceUpHitPrefab:cc.Prefab,defenceDownHitPrefab:cc.Prefab,damageCutHitPrefab:cc.Prefab,reflectionHitPrefab:cc.Prefab,targetHitPrefab:cc.Prefab,hpUpHitPrefab:cc.Prefab,criticalHitPrefab:cc.Prefab,clockUpHitPrefab:cc.Prefab,clockDownHitPrefab:cc.Prefab,recoveryUpHitPrefab:cc.Prefab,recoveryDownHitPrefab:cc.Prefab,confusionHitPrefab:cc.Prefab,accuracyRateDownHitPrefab:cc.Prefab,skillLockHitPrefab:cc.Prefab,barrierHitPrefab:cc.Prefab,gutsHitPrefab:cc.Prefab,avoidanceHitPrefab:cc.Prefab,lineMagentaHitPrefab:cc.Prefab,lineWhiteHitPrefab:cc.Prefab,otherInvoke1Prefab:cc.Prefab,otherInvoke2Prefab:cc.Prefab,otherMagentaInvoke1Prefab:cc.Prefab,otherMagentaInvoke2Prefab:cc.Prefab,otherBlueInvoke1Prefab:cc.Prefab,otherBlueInvoke2Prefab:cc.Prefab,dummyEffectPre:cc.Prefab,healNumPre:cc.Prefab,healEffectPre:cc.Prefab,autoEndPopupPre:cc.Prefab,autoRunPopupPre:cc.Prefab,autoStopPopupPre:cc.Prefab,towerAutoRunPopupPre:cc.Prefab,attackEffectPoolArr:[],attackEffectPrefabArr:[]},_autoRunPopupParentNode:null,_autoRunWindow:null,_showedSkillCutinMessage:!1,onLoad:function(){this._showedSkillCutinMessage=!0},checkAndAddAttackPool:function(t,e){if(t in this.attackEffectPoolArr==0){for(var i=new cc.NodePool("EffectEnd"),a=0;a<o.ATTACK_EFFECT_POOL_AMOUNT;++a){var n=cc.instantiate(e);i.put(n)}this.attackEffectPoolArr[t]=i,this.attackEffectPrefabArr[t]=e}},playDamageNum:function(t,e){var i=e.get("damage"),n=e.get("dmgShowNode"),o=e.get("parentNode"),r=e.get("numSpriteFrames"),s=e.get("damageTextSpriteFrame"),c=e.get("speed"),l=e.get("modiPos"),u=e.get("scale"),h=e.get("anchorPoint"),d=e.get("textPosition"),p=cc.instantiate(this.damageNumPre);p.parent=a.UI_M.damageCenter,p.setPosition(l.x,l.y),p.setScale(u);var m=n.convertToWorldSpace(cc.v2(0,0));p.setPosition(o.convertToNodeSpace(m)),p.getComponent("damageShow").init(i,r,s,d,h,c,t)},playHeal:function(t,e){var i=e.get("healPow"),a=e.get("numShowNode"),n=(e.get("effShowNode"),e.get("parentNode")),o=e.get("numSpriteFrames"),r=e.get("speed"),s=e.get("scale"),c=e.get("anchorPoint"),l=cc.instantiate(this.healNumPre);l.parent=n,l.setPosition(0,0),l.setScale(s);var u=a.convertToWorldSpace(cc.v2(0,0));l.setPosition(n.convertToNodeSpace(u)),l.getComponent("healShow").init(i,o,c,r,t)},playSkillCutin:function(t,e){var i=a.GM.gameRoot.skillCutinNode.getComponent(cc.Animation);i.once("finished",function(e){t()}.bind(this),this),i.play(this._getSkillCutinInAnimationName()).speed=e.speed,a.GM.gameRoot.skillCutinNode.getComponent(r).init(e.battleUnit.getCharaterModel().getName(),e.battleSkill.getName());var o=a.GM.gameRoot.skillCutinMessageNode.getComponent(s);a.GM.gameRoot.skillCutinMessageNode.active=!1,o.init(e.battleSkill.getDescription()),this._showedSkillCutinMessage=!1,e.battleSkill.getEffectShowType()!==n.SkillEffectShowType.FULL_SPINE_EFFECT_BY_SPINE_EVENT&&this.playSkillCutinMessage()},_getSkillCutinInAnimationName:function(){return"SkillCutin_Anim"},playSkillCutinMessage:function(){if(!this._showedSkillCutinMessage){a.GM.gameRoot.skillCutinMessageNode.active=!0;var t=a.GM.gameRoot.skillCutinMessageNode.getComponent(cc.Animation);t.on("finished",function(t){a.GM.gameRoot.skillCutinMessageNode.active=!1}.bind(this),this),t.play(this._getSkillCutinMessageInAnimationName()).speed=a.cur_GameSpeed,this._showedSkillCutinMessage=!0}},_getSkillCutinMessageInAnimationName:function(){return"SkillCutinMessage_Anim"},playUnisonCutin:function(t,e){var i=a.GM.gameRoot.unisonCutinNode.getComponent(cc.Animation),n=a.GM.gameRoot.unisonCutinNode.getComponent(h);a.GM.gameRoot.unisonCutinNode.parent.setPosition(e.x-440,-360),i.once("finished",function(e){t()}.bind(this),this),i.play("Unison_Front_Anim").speed=1+.5*(e.speed-1),n.spriteStand.spriteFrame=e.standTextureResource},playAbilityShow:function(t,e){var i=cc.instantiate(a.GM.gameRoot.abilityCutinPrefab).getComponent(c);a.GM.gameRoot.abilityCutinNode.addChild(i.node);var n=i.animation;n.on("finished",function(){a.currentTurnAbilityCount-=1,i.node.destroy(),t()}.bind(this),this);var r,s=e.battleAbility.getAbilityName(),l="";if(e.battleUnit.isEnemy){i.setEnemyLabelText(s),l=this._getAbilityCutinEnemyAnimationName();u=e.battleUnit.get_EffectShowNode().convertToWorldSpaceAR(e.battleUnit.get_EffectShowNode().getPosition()),h=i.node.parent.convertToNodeSpaceAR(u);r=cc.v2(h.x,h.y+o.ABILITYCUTIN_MOVETO_Y_ENEMY)}else{i.setPlayerLabelText(s),l=this._getAbilityCutinPlayerAnimationName();var u=e.battleUnit.unitController.node.convertToWorldSpaceAR(e.battleUnit.unitController.node.getPosition()),h=i.node.parent.convertToNodeSpaceAR(u);r=cc.v2(h.x,h.y+o.ABILITYCUTIN_MOVETO_Y_PLAYER)}i.node.setPosition(r);var d=n.play(l);d.speed=a.cur_GameSpeed;var p={main:"AbilityCutin_Main_Anim",sub:"AbilityCutin_Sub_Anim",enemy:"AbilityCutin_Enemy_Anim"},m=p[e.animationKind];e.battleUnit.unitController.abilityEffectAnm&&((d=e.battleUnit.unitController.abilityEffectAnm.play(m)).speed=a.cur_GameSpeed),a.GM.soundManager.playSE(a.RM.soundResourceList.SoloCutIN)},_getAbilityCutinPlayerAnimationName:function(){return"AbilityCutin_Player_Anim"},_getAbilityCutinEnemyAnimationName:function(){return"AbilityCutin_Enemy_Anim"},playHighlightOn:function(t,e){var i=e.targetList,a=e.isEnemyAttacker,n=this._getUnTargetUnitList(i,a);for(var o in n)n[o].mainAvatar&&l.setChildrenColorOrLabelOpacity(n[o].mainAvatar.node,cc.color(128,128,128),128);t()},playHighlightOff:function(t,e){var i=e.targetList,a=e.isEnemyAttacker,n=this._getUnTargetUnitList(i,a);for(var o in n)n[o].mainAvatar&&l.setChildrenColorOrLabelOpacity(n[o].mainAvatar.node,cc.color(255,255,255),255);t()},_getUnTargetUnitList:function(t,e){var i=u.getUnitList(!e).slice();for(var a in t)for(var n in i)if(i[n]===t[a]){i.splice(n,1);break}return i},playActionInvoke1Effect:function(t,e){var i=e.attackerUnit,a=e.targetUnit;if(i.isEnemy!==a.isEnemy){var n=i.get_EffectShowNode(),o=e.parentNode,r=e.actionType,s=e.power,c=e.waitTime,l=this.getActionInvoke1Prefab(r,s),u=this.getActionInvoke2Prefab(r,s);if(this.actionType=r,l&&u){var h=[];h.push(cc.delayTime(c)),h.push(cc.callFunc(function(){this._playActionInvoke2Effect(u,o,n,c,a,i,r,t),this.simpleShowEffect(l,o,n,c,null)},this));var d=cc.sequence(h);n.runAction(d)}else t()}else t()},_playActionInvoke2Effect:function(t,e,i,a,n,o,r,s){var c=this.simpleShowEffect(t,e,i,a,s),l=n.get_EffectShowNode().convertToWorldSpace(n.get_EffectShowNode().getPosition()),u=(e.convertToNodeSpace(l),o.get_EffectShowNode().convertToWorldSpace(o.get_EffectShowNode().getPosition())),h=cc.v2(l.x-u.x,l.y-u.y),d=Math.atan2(h.y,h.x);c.angle=d/Math.PI*180+90;var p=Math.sqrt(h.x*h.x+h.y*h.y);c.runAction(cc.scaleTo(.5,1,p/320))},playActionInvoke3Effect:function(t,e){var i=e.targetUnit.get_EffectShowNode(),o=e.parentNode,r=e.actionType,s=e.waitTime,c=this.getActionInvoke3Prefab(r);this.actionType=r,c?(this.simpleShowEffect(c,o,i,s,t),r===n.BuffType.POISON?a.GM.soundManager.playSE(a.RM.soundResourceList.Poison):r===n.BuffType.PARALYSIS&&a.GM.soundManager.playSE(a.RM.soundResourceList.Paralysis)):t()},playActionHitEffect:function(t,e){var i=e.targetNode,a=e.parentNode,n=e.actionType,o=e.power,r=e.waitTime,s=this.getActionHitPrefab(n,o);this.actionType=n,this.simpleShowEffect(s,a,i,r,t)},playBuffContinueEffect:function(t,e){var i=e.buff,n=e.targetNode,o=e.parentNode,r=e.waitTime,s=this.getBuffContinuePrefab(i),c=this.getEffectSE(i);c&&a.GM.soundManager.playSE(c),this.simpleShowEffect(s,o,n,r,t)},playBuffInvokeEffect_Instant:function(t,e){var i=e.targetNode,r=e.parentNode,s=null;switch(e.buffType){case n.BuffType.IMMORTAL:s=this.gutsHitPrefab;break;case n.BuffType.NORMAL_ATTACK_COUNTER:case n.BuffType.NORMAL_ATTACK_EVASION:default:s=this.damageCutHitPrefab}var c=o.BUFF_INVOKE_EFFECT_WAITTIME/a.cur_GameSpeed;this.simpleShowEffect(s,r,i,c,t)},simpleShowEffect:function(t,e,i,n,o){var r=cc.instantiate(t);if(r.parent=e,r.setPosition(0,0),i){var s=i.convertToWorldSpace(i.getPosition());r.setPosition(r.convertToNodeSpace(s))}var c=r.getComponent(cc.Animation),l=c.getClips();for(var u in l){l[u].speed=a.cur_GameSpeed}var h=r.getComponent("EffectEnd");if(n){var d=[];d.push(cc.delayTime(n)),d.push(cc.callFunc(function(){o&&o()},this));var p=cc.sequence(d);this.node.runAction(p),c.on("finished",function(t){r.destroy()}.bind(this),this),c.play()}else h?(h.endAction=o,c.on("finished",function(t){r.destroy()}.bind(this),this),c.play()):(c.on("finished",function(t){r.destroy(),o&&o()}.bind(this),this),c.play());return r},getSpriteFrameIcon:function(t){switch(t.type){case n.BuffType.ATK_CHANGE:case n.BuffType.ATK_CHANGE_STOCKABLE:default:if(t.invokeType===n.EffectConditionType.SPECIFY_ATTRIBUTE){var e=Number(t.invokeVal);if(t.power>=0)switch(e){case d.ATTRIBUTE.FIRE:return this.attackUpFireIcon;case d.ATTRIBUTE.WATER:return this.attackUpWaterIcon;case d.ATTRIBUTE.THUNDER:return this.attackUpThunderIcon;case d.ATTRIBUTE.WIND:return this.attackUpWindIcon;case d.ATTRIBUTE.LIGHT:return this.attackUpLightIcon;case d.ATTRIBUTE.DARK:return this.attackUpDarkIcon}else switch(e){case d.ATTRIBUTE.FIRE:return this.attackDownFireIcon;case d.ATTRIBUTE.WATER:return this.attackDownWaterIcon;case d.ATTRIBUTE.THUNDER:return this.attackDownThunderIcon;case d.ATTRIBUTE.WIND:return this.attackDownWindIcon;case d.ATTRIBUTE.LIGHT:return this.attackDownLightIcon;case d.ATTRIBUTE.DARK:return this.attackDownDarkIcon}}return t.power>=0?this.attackUpIcon:this.attackDownIcon;case n.BuffType.DEF_CHANGE:case n.BuffType.DEF_CHANGE_STOCKABLE:if(t.invokeType===n.EffectConditionType.SPECIFY_ATTRIBUTE){e=Number(t.invokeVal);if(t.power>=0)switch(e){case d.ATTRIBUTE.FIRE:return this.defenceUpFireIcon;case d.ATTRIBUTE.WATER:return this.defenceUpWaterIcon;case d.ATTRIBUTE.THUNDER:return this.defenceUpThunderIcon;case d.ATTRIBUTE.WIND:return this.defenceUpWindIcon;case d.ATTRIBUTE.LIGHT:return this.defenceUpLightIcon;case d.ATTRIBUTE.DARK:return this.defenceUpDarkIcon}else switch(e){case d.ATTRIBUTE.FIRE:return this.defenceDownFireIcon;case d.ATTRIBUTE.WATER:return this.defenceDownWaterIcon;case d.ATTRIBUTE.THUNDER:return this.defenceDownThunderIcon;case d.ATTRIBUTE.WIND:return this.defenceDownWindIcon;case d.ATTRIBUTE.LIGHT:return this.defenceDownLightIcon;case d.ATTRIBUTE.DARK:return this.defenceDownDarkIcon}}return t.power>=0?this.defenceUpIcon:this.defenceDownIcon;case n.BuffType.HP_CHANGE:case n.BuffType.HP_CHANGE_STOCKABLE:return this.hpUpIcon;case n.BuffType.LOW_HP_ATK_UP:return this.hpAttackUpIcon;case n.BuffType.LOW_HP_DEF_UP:return this.hpDefenceUpIcon;case n.BuffType.CRITICAL_CHANCE_UP:return t.power>=0?this.criticalUpIcon:this.criticalDownIcon;case n.BuffType.PLUS_UNISON_ATTACK_CHANCE:return t.power>=0?this.cooperationProbabilityUpIcon:this.cooperationProbabilityDownIcon;case n.BuffType.PLUS_UNISON_ATTACK_POWER:return t.power>=0?this.cooperativeAttackUpIcon:this.cooperativeAttackDownIcon;case n.BuffType.SKILL_DAMAGE_UP:return t.power>=0?this.skillDamageUpIcon:this.skillDamageDownIcon;case n.BuffType.DAMAGE_CHANGE:case n.BuffType.DAMAGE_CHANGE_BY_ELEMENT:return this.damageCutIcon;case n.BuffType.PLUS_SKILL_RATE:return t.power>=0?this.skillRiseUpIcon:this.skillRiseDownIcon;case n.BuffType.ADJUST_HATE_WEIGHT_FROM_ENEMY:return t.power>=0?this.targetRateUpIcon:this.targetRateDownIcon;case n.BuffType.IMMUNE_BAD_CONDITION:return this.AbnormalStateInvalidIcon;case n.BuffType.PREVENT_BAD_CONDITION:return t.power>=0?this.AbnormalStateResistanceUpIcon:this.AbnormalStateResistanceDownIcon;case n.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE:return t.power>=0?this.AbnormalStateUpIcon:this.AbnormalStateDownIcon;case n.BuffType.RECOVERY_POWER_UP:return t.power>=0?this.recoveryUpIcon:this.recoveryDownIcon;case n.BuffType.REGENERATION:case n.BuffType.NORMAL_ATTACK_HP_DRAIN:return this.AutoRecoveryIcon;case n.BuffType.POISON:return this.poisonIcon;case n.BuffType.PARALYSIS:return this.paralysisIcon;case n.BuffType.CONFUSE:return this.confusionIcon;case n.BuffType.DARKNESS_ON_NORMAL_ATTK:case n.BuffType.DARKNESS_ON_ALL:return this.hitDownIcon;case n.BuffType.SEAL_SKILL:return this.skillSealIcon;case n.BuffType.DAMAGE_BARRIER:return this.barrierIcon;case n.BuffType.IMMORTAL:return this.gutsIcon;case n.BuffType.ALL_COUNTER:case n.BuffType.NORMAL_ATTACK_COUNTER:return this.reflectIcon;case n.BuffType.NORMAL_ATTACK_EVASION:return this.AvoidIcon}},getActionInvoke1Prefab:function(t,e){switch(t){case n.BuffType.ATK_CHANGE:case n.BuffType.DEF_CHANGE:case n.BuffType.CRITICAL_CHANCE_UP:case n.BuffType.PLUS_UNISON_ATTACK_CHANCE:case n.BuffType.PLUS_UNISON_ATTACK_POWER:case n.BuffType.SKILL_DAMAGE_UP:if(e<0)return this.otherInvoke1Prefab;case n.BuffType.POISON:case n.BuffType.PARALYSIS:case n.BuffType.CONFUSE:case n.BuffType.DARKNESS_ON_NORMAL_ATTK:case n.BuffType.DARKNESS_ON_ALL:case n.BuffType.SEAL_SKILL:return this.otherMagentaInvoke1Prefab;case n.BuffType.PLUS_SKILL_RATE:case n.ActionType.INCREASE_SKILL_RATE:case n.BuffType.ADJUST_HATE_WEIGHT_FROM_ENEMY:case n.BuffType.PREVENT_BAD_CONDITION:case n.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE:case n.BuffType.RECOVERY_POWER_UP:if(e<0)return this.otherBlueInvoke1Prefab;default:return null}},getActionInvoke2Prefab:function(t,e){switch(t){case n.BuffType.ATK_CHANGE:case n.BuffType.DEF_CHANGE:case n.BuffType.CRITICAL_CHANCE_UP:case n.BuffType.PLUS_UNISON_ATTACK_CHANCE:case n.BuffType.PLUS_UNISON_ATTACK_POWER:case n.BuffType.SKILL_DAMAGE_UP:if(e<0)return this.otherInvoke2Prefab;case n.BuffType.POISON:case n.BuffType.PARALYSIS:case n.BuffType.CONFUSE:case n.BuffType.DARKNESS_ON_NORMAL_ATTK:case n.BuffType.DARKNESS_ON_ALL:case n.BuffType.SEAL_SKILL:return this.otherMagentaInvoke2Prefab;case n.BuffType.PLUS_SKILL_RATE:case n.ActionType.INCREASE_SKILL_RATE:case n.BuffType.ADJUST_HATE_WEIGHT_FROM_ENEMY:case n.BuffType.PREVENT_BAD_CONDITION:case n.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE:case n.BuffType.RECOVERY_POWER_UP:if(e<0)return this.otherBlueInvoke2Prefab;default:return null}},getActionInvoke3Prefab:function(t){switch(t){case n.BuffType.POISON:return this.poisonInvoke3Prefab;case n.BuffType.PARALYSIS:return this.paralysisInvoke3Prefab;default:return null}},getActionHitPrefab:function(t,e){switch(t){case n.BuffType.ATK_CHANGE:case n.BuffType.LOW_HP_ATK_UP:return e>=0?this.attackUpHitPrefab:this.attackDownHitPrefab;case n.BuffType.DEF_CHANGE:case n.BuffType.LOW_HP_DEF_UP:return e>=0?this.defenceUpHitPrefab:this.defenceDownHitPrefab;case n.BuffType.HP_CHANGE:return this.hpUpHitPrefab;case n.BuffType.CRITICAL_CHANCE_UP:return e>=0?this.criticalHitPrefab:this.defenceDownHitPrefab;case n.BuffType.DAMAGE_CHANGE:return this.damageCutHitPrefab;case n.BuffType.PLUS_SKILL_RATE:return e>=0?this.clockUpHitPrefab:this.clockDownHitPrefab;case n.BuffType.ADJUST_HATE_WEIGHT_FROM_ENEMY:return this.targetHitPrefab;case n.BuffType.RECOVERY_POWER_UP:return e>=0?this.recoveryUpHitPrefab:this.recoveryDownHitPrefab;case n.BuffType.POISON:return this.poisonHitPrefab;case n.BuffType.PARALYSIS:return this.paralysisHitPrefab;case n.BuffType.CONFUSE:return this.confusionHitPrefab;case n.BuffType.DARKNESS_ON_NORMAL_ATTK:case n.BuffType.DARKNESS_ON_ALL:return this.accuracyRateDownHitPrefab;case n.BuffType.SEAL_SKILL:return this.skillLockHitPrefab;case n.BuffType.DAMAGE_BARRIER:return this.barrierHitPrefab;case n.BuffType.IMMORTAL:return this.gutsHitPrefab;case n.BuffType.NORMAL_ATTACK_COUNTER:case n.BuffType.ALL_COUNTER:return this.reflectionHitPrefab;case n.BuffType.NORMAL_ATTACK_EVASION:return this.avoidanceHitPrefab;case n.BuffType.PLUS_UNISON_ATTACK_CHANCE:case n.BuffType.PLUS_UNISON_ATTACK_POWER:case n.BuffType.SKILL_DAMAGE_UP:return e>=0?this.lineMagentaHitPrefab:this.dummyEffectPre;case n.BuffType.IMMUNE_BAD_CONDITION:return this.lineWhiteHitPrefab;case n.BuffType.PREVENT_BAD_CONDITION:case n.BuffType.PLUS_CAST_BAD_CONDITION_CHANCE:return e>=0?this.lineWhiteHitPrefab:this.dummyEffectPre;default:return this.dummyEffectPre}},getBuffContinuePrefab:function(t){var e=t.type;t.power;switch(e){case n.BuffType.POISON:return this.poisonContinuePrefab;case n.BuffType.PARALYSIS:return this.paralysisContinuePrefab;default:return this.dummyEffectPre}},getEffectSE:function(t){var e=t.type,i=t.power,o=null;return e==n.BuffType.ATK_CHANGE?o=i>=0?a.RM.soundResourceList.Buff:a.RM.soundResourceList.Debuff:e==n.BuffType.DEF_CHANGE?o=i>=0?a.RM.soundResourceList.Buff:a.RM.soundResourceList.Debuff:e==n.BuffType.DAMAGE_CHANGE?o=a.RM.soundResourceList.Buff:e==n.BuffType.POISON?o=a.RM.soundResourceList.Poison:e==n.BuffType.PARALYSIS&&(o=a.RM.soundResourceList.Paralysis),o},openAutoEndPopup:function(t,e){var i=cc.instantiate(this.autoEndPopupPre).getComponent("AutoEndPopup");i.initPopup(t,e),i.open()},openAutoRunWindow:function(t,e){var i=null;(i=a.battleType===n.BattleType.TOWER?cc.instantiate(this.towerAutoRunPopupPre).getComponent("TowerAutoDisplayWindow"):cc.instantiate(this.autoRunPopupPre).getComponent("AutoDisplayWindow")).initAutoDisplayWindow(t,e),i.open(),this._autoRunWindow=i},closeAutoRunWindow:function(){this._autoRunWindow&&(this._autoRunWindow.closeAutoDisplayWindow(),this._autoRunWindow.close(),this._autoRunWindow=null)},setAutoRunWindowActive:function(t){this._autoRunWindow.setActive(t)},openAutoStopPopup:function(){cc.instantiate(this.autoStopPopupPre).getComponent("AutoStopPopup").openAutoStopPopup()}});e.exports=p,cc._RF.pop()},{AbilityCutinMessageView:"AbilityCutinMessageView",AbilityCutinView:"AbilityCutinView",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",CommonUtils:"CommonUtils",EnumTypes:"EnumTypes",GameConst:"GameConst",SkillCutinMessageView:"SkillCutinMessageView",SkillCutinView:"SkillCutinView",UnisonCutinView:"UnisonCutinView"}],PopupBase:[function(t,e,i){"use strict";cc._RF.push(e,"14ab5aDoAFFvLffxu4zWcZT","PopupBase");var a=t("WindowBase"),n=t("GameConst"),o=t("LocalDataConst"),r=t("StaticResourceConst"),s=t("ResourceUtils"),c=t("TutorialUtils"),l=t("TutorialConst"),u=t("ViewUtils"),h=t("Singleton"),d=cc.Enum({OPEN_ANIM_IDX:0,CLOSE_ANIM_IDX:1});cc.Class({extends:a,_openCallBack:null,_closeCallBack:null,_nodeGroup:null,_isDisabledOutRangeTap:void 0,_isClosed:!1,_bSystemPopup:!1,_popupAnimation:null,_setOpenCallBack:function(t){t&&(this._openCallBack=t)},setCloseCallBack:function(t){this._closeCallBack=t},setNodeGroup:function(t){this._nodeGroup=t},activateSystemPopupMode:function(){this._bSystemPopup=!0},open:function(t){this._openPopupBase(t)},setDisableOutRangeTap:function(t){this._isDisabledOutRangeTap=t},_openPopupBase:function(t){this._isDisabledOutRangeTap=void 0!==this._isDisabledOutRangeTap&&this._isDisabledOutRangeTap,this._setOpenCallBack(t),this._initPopupAnim(),this._addGrayBack(cc.director.getScene().getChildByName("Canvas"),n.Z_ORDER.GRAY_BACK),this._addWindow(),this._openWindowBase(),this._playOpenAnimation(),!c.isTutorialEnded()&&c.isTutorialAdvByPopup(this.node.name)&&u.addModalLayer()},_addWindow:function(){var t=new cc.Node("ModalLayer");t.setContentSize(cc.winSize),t.zIndex=-1,t.active=!0;var e=-1*this.node.getPosition().x,i=-1*this.node.getPosition().y;t.setPosition(cc.v2(e,i)),this.node.addChild(t),this.windowNode&&(this.windowNode.on("touchstart",function(t){t.stopPropagation()}),this.windowNode.on("touchend",function(t){t.stopPropagation()})),t.on("touchstart",function(t){t.stopPropagation()}),t.on("touchend",function(t){this._isEnableOutRangeTap()&&this.close(),t.stopPropagation()}.bind(this)),t.on(cc.Node.EventType.MOUSE_WHEEL,function(t){t.stopPropagation()}),this._setNodeGroup(this.node);var a=this._bSystemPopup?n.Z_ORDER.SYSTEM_POPUP:n.Z_ORDER.POPUP;cc.director.getScene().getChildByName("Canvas").addChild(this.node,a)},_isEnableOutRangeTap:function(){return!this._isDisabledOutRangeTap&&this.windowNode&&!this._bSystemPopup&&(c.isTutorialEnded()||cc.director.getScene().name===l.EXCEPTION_SCENE_NAME.BATTLE)},_addGrayBack:function(t,e){var i=this._getGrayBackSprite();i||(i=new cc.Node("PopupGrayBack").addComponent(cc.Sprite),s.addSprite(i,r.SIMPLE_TEX_PATH,function(){i.node.setContentSize(cc.winSize),i.node.color=cc.color(0,0,0),i.node.opacity=128}),this._setNodeGroup(i.node),t.addChild(i.node,e))},_removeGrayBack:function(){if(cc.director.getScene().getChildByName("Canvas").getComponentsInChildren("PopupBase").length<=0){var t=this._getGrayBackSprite();t&&t.node.destroy()}},_getGrayBackSprite:function(){return cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack")?cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack").getComponent(cc.Sprite):null},close:function(){this._playCloseAnimation()},_closePopupBase:function(){var t=this;this.isValid&&(this.node.active=!1,this._closeCallBack&&this._closeCallBack(),this.node.removeFromParent(!0),cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){t._removeGrayBack(),t._closeWindowBase()},cc.director.getScene()))},_initPopupAnim:function(){cc.director.isPaused()||(h.localData[o.IS_POPUP_OPENING]=!0,this._popupAnimation=this.node.addComponent(cc.Animation),this._popupAnimation.addClip(s.getResource(r.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH)),this._popupAnimation.addClip(s.getResource(r.POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH)))},_playOpenAnimation:function(){this._popupAnimation&&this._popupAnimation.getAnimationState(this._popupAnimation.getClips()[d.OPEN_ANIM_IDX].name).isPlaying||(h.soundManager.playSE(s.getResource(r.SE.POPUP_ON),!1),!cc.director.isPaused()&&this._popupAnimation?(this._popupAnimation.once("finished",function(){if(h.localData[o.IS_POPUP_OPENING]=!1,!c.isTutorialEnded()&&c.isTutorialAdvByPopup(this.node.name)&&(u.removeModalLayer(),c.startTutorialAdv()),this._openCallBack)return this._openCallBack()}.bind(this),this),this.node.setScale(.01,.01),this._popupAnimation.play(this._popupAnimation.getClips()[d.OPEN_ANIM_IDX].name)):this._openCallBack&&this._openCallBack())},_playCloseAnimation:function(){this._isClosed||this._popupAnimation&&this._popupAnimation.getAnimationState(this._popupAnimation.getClips()[d.CLOSE_ANIM_IDX].name).isPlaying||(this._isClosed=!0,h.soundManager.playSE(s.getResource(r.SE.POPUP_OFF),!1),!cc.director.isPaused()&&this._popupAnimation?(this._popupAnimation.once("finished",this._closePopupBase.bind(this),this),this._popupAnimation.play(this._popupAnimation.getClips()[d.CLOSE_ANIM_IDX].name)):this._closePopupBase())},_setNodeGroup:function(t){this._nodeGroup&&(t.group=this._nodeGroup)}}),cc._RF.pop()},{GameConst:"GameConst",LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",TutorialConst:"TutorialConst",TutorialUtils:"TutorialUtils",ViewUtils:"ViewUtils",WindowBase:"WindowBase"}],PopupUtils:[function(t,e,i){"use strict";cc._RF.push(e,"e2c41RCWnNMJqBQZ+gVEElo","PopupUtils");var a=t("Singleton"),n=t("LocalDataConst"),o=t("StaticResourceConst"),r=t("ResourceUtils");function s(t){var e=cc.director.getScene().getChildByName("Canvas").getComponentsInChildren("CommonPopup");if(e.length>0){var i=e[0].getCloseCallback();e[0].setCloseCallBack(function(){i&&i(),t()})}else t()}e.exports={openCommonPopupYesNo:function(t,e,i,a,n,c,l,u,h){s(function(){var s=cc.instantiate(r.getResource(o.DIALOG_PREFAB_PATH)).getComponent("CommonPopup");s.initYesNo(t,e,i,a,n,c,l,u),s.open(),s.setDisableOutRangeTap(h)})},openCommonPopupOk:function(t,e,i,a,n,c,l){s(function(){var s=cc.instantiate(r.getResource(o.DIALOG_PREFAB_PATH)).getComponent("CommonPopup");s.initOk(t,e,i,a,n,c),s.open(),s.setDisableOutRangeTap(l)})},openSimpleMessageWindow:function(t,e,i){i&&cc.director.getScene().getChildByName("Canvas").getChildByName(i)||cc.instantiate(r.getResource(o.SIMPLE_MESSAGE_WINDOW_PREFAB_PATH)).getComponent("SimpleMessagePopup").openSimpleMessagePopup(t,e,i)},setVariableTextWindowForMouseOverEvent:function(t,e,i,a,n){var s=cc.instantiate(r.getResource(o.VARIABLE_TEXT_WINDOW_PREFAB_PATH)).getComponent("CommonWindow");t.setOverEvent(function(){n&&s.node.setPosition(n),s.openVariableTextWindow(t.node,e,i,a)},function(){s.closeWindow()})},openHowToPlayPopup:function(t,e){cc.instantiate(r.getResource(o.HOW_TO_PLAY_POPUP_PREFAB_PATH)).getComponent("HowToPlayPopup").openHowToPlayPopup(t,e)},openSystemPopup:function(t,e,i,c,l,u){s(function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!0;var s=cc.instantiate(r.getResource(o.DIALOG_PREFAB_PATH)).getComponent("CommonPopup");s.initOk(t,e,i,c,l,u),s.activateSystemPopupMode(),s.open(),s.setCloseCallBack(function(){l&&l(),a.localData[n.IS_OPEN_SYSTEM_POPUP]=!1}),s.onDestroy=function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!1}})},openSystemPopupYesNo:function(t,e,i,c,l,u,h,d){s(function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!0;var s=cc.instantiate(r.getResource(o.DIALOG_PREFAB_PATH)).getComponent("CommonPopup");s.initYesNo(t,e,i,c,l,u,h,d),s.activateSystemPopupMode(),s.open(),s.setCloseCallBack(function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!1}),s.onDestroy=function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!1}})},openSystemPopupPlane:function(t,e){s(function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!0;var i=cc.instantiate(r.getResource(o.DIALOG_PREFAB_PATH)).getComponent("CommonPopup");i.initPlane(t,e),i.activateSystemPopupMode(),i.open(),i.setCloseCallBack(function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!1}),i.onDestroy=function(){a.localData[n.IS_OPEN_SYSTEM_POPUP]=!1}})},openUserRenamePopup:function(t,e,i){cc.instantiate(r.getResource(o.USER_RENAME_POPUP_PREFAB_PATH)).getComponent("UserRenamePopup").openUserRenamePopup(function(e){a.UserService.updateUserName(e,function(){a.UserService.checkUserNameStatus(t)})},e,i)}},cc._RF.pop()},{LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],PresentApis:[function(t,e,i){"use strict";cc._RF.push(e,"4743ck9V/FKKKDLeFJKTGEG","PresentApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.PRESENT_GET_MASTER_DATA,path:"present/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.PRESENT_LIST,path:"present/getList",method:"POST"}),a.RESTClient.graft({name:n.PRESENT_HISTORY_LIST,path:"present/getHistoryList",method:"POST"}),a.RESTClient.graft({name:n.PRESENT_RECEIVE,path:"present/receive",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],PresentBoxRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"ae217LVYzNA1KEcqhpaF+Ud","PresentBoxRootUtils");var a=t("PresentBoxSubRoot");e.exports={openPresentBoxSubRoot:function(t,e){cc.log("openPresentBoxSubRoot"),cc.log(e),t.presentBoxSubRoot?cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(t.presentBoxSubRoot=cc.instantiate(t.presentBoxSubRootPrefab).getComponent(a),t.presentBoxSubRoot.init(t,e.presentHistoryFlg),t.subRootParent.addChild(t.presentBoxSubRoot.node))},closePresentBoxSubRoot:function(t,e){cc.log("closePresentBoxSubRoot"),cc.log(e),t.presentBoxSubRoot||(t.presentBoxSubRoot.node.destroy(),t.presentBoxSubRoot=null)}},cc._RF.pop()},{PresentBoxSubRoot:"PresentBoxSubRoot"}],PresentBoxRoot:[function(t,e,i){"use strict";cc._RF.push(e,"198830aL0tIErtruMVuKVDA","PresentBoxRoot");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("PopupUtils"),r=t("PresentConst"),s=t("LocalDataConst"),c=t("ItemConst"),l=t("CharacterConst"),u=t("EquipmentConst"),h=t("PresentBoxViewSetting");cc.Class({extends:a,properties:{presentBoxSubRootPrefab:cc.Prefab,filterPopupPrefab:cc.Prefab,confirmPopupPrefab:cc.Prefab,confirmListPopupPrefab:cc.Prefab,presentRandomReceiveCompletePopupPrefab:cc.Prefab},presentArray:null,presentHistoryArray:null,maxCount:0,receivePresents:null,nonReceiveReasons:null,selectPresentModelMap:null,filterCheckList:null,_filterPopup:null,_presentConfirmSimplePopup:null,_presentRandomReceiveCompletePopup:null,_presentConfirmSimpleListPopup:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,h.PRESENTBOX_SETTING)},initialize:function(){this.selectPresentModelMap={},this.filterCheckList=r.PRESENT_FILTER_DEFAULT,this.initOutGameRootBase();this._initOpenFirstView({PresentBoxSubRoot:{}})},requestGetList:function(t,e,i,a,o){n.PresentService.getList(t,e,i,a,function(t){this.presentArray=t.presents,this.maxCount=t.maxCount,n.localData[s.PRESENT_COUNT]=t.presentCount,o(t)}.bind(this))},requestGetHistoryList:function(t,e){n.PresentService.getHistoryList(t,function(t){this.presentHistoryArray=t.historyPresents,this.maxCount=t.maxCount,e(t)}.bind(this))},requestReceive:function(t,e){n.PresentService.receive(t,function(t){e&&(this.receivePresents=t.receivePresents,this.nonReceiveReasons=t.nonReceiveReasons,e(t)),this.redrawUIHeader()}.bind(this))},openFilterPopup:function(t,e){this.closeFilterPopup(),this._filterPopup=cc.instantiate(this.filterPopupPrefab).getComponent("FilterPopup"),this._filterPopup.openFilterPopup(t,e)},closeFilterPopup:function(){this._filterPopup&&(this._filterPopup.close(),this._filterPopup=null)},openConfirmSimplePopup:function(t,e){this.closeConfirmSimplePopup(),this._presentConfirmSimplePopup=cc.instantiate(this.confirmPopupPrefab).getComponent("PresentConfirmSimplePopup"),this._presentConfirmSimplePopup.openConfirmSimplePopup(t,e)},closeConfirmSimplePopup:function(){this._presentConfirmSimplePopup&&(this._presentConfirmSimplePopup.close(),this._presentConfirmSimplePopup=null)},openPresentRandomReceiveCompletePopup:function(t,e,i,a,n,o,r){this.closePresentRandomReceiveCompletePopup(),this._presentRandomReceiveCompletePopup=cc.instantiate(this.presentRandomReceiveCompletePopupPrefab).getComponent("PresentRandomReceiveCompletePopup"),this._presentRandomReceiveCompletePopup.openPresentRandomReceiveCompletePopup(t,e,i,a,n,o,r)},closePresentRandomReceiveCompletePopup:function(){this._presentRandomReceiveCompletePopup&&(this._presentRandomReceiveCompletePopup.close(),this._presentRandomReceiveCompletePopup=null)},openConfirmSimpleListPopup:function(t,e,i){this.closeConfirmSimpleListPopup(),this._presentConfirmSimpleListPopup=cc.instantiate(this.confirmListPopupPrefab).getComponent("PresentConfirmSimpleListPopup"),this._presentConfirmSimpleListPopup.openConfirmSimpleListPopup(t,e,i)},closeConfirmSimpleListPopup:function(){this._presentConfirmSimpleListPopup&&(this._presentConfirmSimpleListPopup.close(),this._presentConfirmSimpleListPopup=null)},openMaxCheckPopup:function(){o.openCommonPopupOk("","\u9078\u629e\u3067\u304d\u308b\u30ae\u30d5\u30c8\u306e\u6570\u306f"+r.PRESENT_MAX_COUNT+"\u4ef6\u307e\u3067\u3067\u3059","",!1,function(){})},openMaxLimitPopup:function(t){o.openCommonPopupOk("\u6240\u6301\u4e0a\u9650","\u6240\u6301\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u53d7\u3051\u53d6\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002","",!1,t)},openMaxLimitPopupWithReason:function(t,e,i){for(var a=[],n=0;n<e.length;n+=1){var r=this._getReasonText(e[n]);r&&a.push(r)}var s=(a=_.uniq(a)).join("\n");t.length>0?s+="\n\u304c\u6240\u6301\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n\u4e00\u90e8\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u53d7\u3051\u53d6\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002":s+="\n\u304c\u6240\u6301\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u53d7\u3051\u53d6\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002",o.openCommonPopupOk("\u6240\u6301\u4e0a\u9650",s,"",!1,i)},_getReasonText:function(t){return t.itemType===c.ITEM_TYPE.CHARACTER&&t.type===l.CHARACTER_TYPE.NORMAL?"\u30e6\u30cb\u30c3\u30c8":t.itemType===c.ITEM_TYPE.CHARACTER&&t.type===l.CHARACTER_TYPE.FORTIFY?"\u30e6\u30cb\u30c3\u30c8\u7528\u7d20\u6750":t.itemType===c.ITEM_TYPE.EQUIPMENT&&t.type===u.EQUIPMENT_TYPE.NORMAL?"\u88c5\u5099":t.itemType===c.ITEM_TYPE.EQUIPMENT&&t.type===u.EQUIPMENT_TYPE.FORTIFY_MATERIAL?"\u88c5\u5099\u7528\u7d20\u6750":t.itemType===c.ITEM_TYPE.FURNITURE?"\u5bb6\u5177":void 0},openSomeMaxLimitPopup:function(t){o.openCommonPopupOk("\u6240\u6301\u4e0a\u9650","\u6240\u6301\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n\u4e00\u90e8\u306e\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u53d7\u3051\u53d6\u308c\u307e\u305b\u3093\u3002","",!1,t)},openLimitPopup:function(t,e){if(this.nonReceiveReasons.length>0)this.openMaxLimitPopupWithReason(this.receivePresents,this.nonReceiveReasons,function(){if(this.receivePresents.length>0)return e()}.bind(this));else{if(!(t.length>this.receivePresents.length))return e();this.openSomeMaxLimitPopup(function(){e()})}},getBulkReceiveAvailablePresentArray:function(){return _.filter(this.presentArray,function(t){return t.itemType!==c.ITEM_TYPE.USABLE_SET_ITEM})}}),cc._RF.pop()},{CharacterConst:"CharacterConst",EquipmentConst:"EquipmentConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",PresentBoxViewSetting:"PresentBoxViewSetting",PresentConst:"PresentConst",Singleton:"Singleton"}],PresentBoxSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"19b88W33gpHg6Z3Xklia2/T","PresentBoxSubRoot");var a=t("CommonButton"),n=t("PresentScrollView"),o=t("CommonPageView"),r=t("PresentConst");cc.Class({extends:cc.Component,properties:{presentScrollView:n,receiveSelectItemBtn:a,receiveSelectItemGrayOutNode:cc.Node,receiveAllBtn:a,receiveAllGrayOutNode:cc.Node,filterBtn:a,filterGrayOutNode:cc.Node,resetBtn:a,receiveListBtn:a,receiveHistoryBtn:a,receiveListDescriptionLabel:cc.Label,receiveHistoryDescriptionLabel:cc.Label,commonPageView:o,presentContent:cc.Node,noPresentNode:cc.Node},_root:null,_presentHistoryFlg:!1,init:function(t,e){cc.log("PresentBoxSubRoot"),this._root=t,this._presentHistoryFlg=e,e?this._requestHistoryList(0,function(){this._initHistoryList()}.bind(this)):this._requestReceiveList(0,function(){this._initReceiveList()}.bind(this)),this._setButtonEvent()},redraw:function(){this._presentHistoryFlg?this._initHistoryList():this._initReceiveList()},_requestReceiveList:function(t,e){var i=this._getRequestGetListParam();this._root.requestGetList(t,i.categories,i.hasPeriod,i.noPeriod,e)},_requestHistoryList:function(t,e){this._root.requestGetHistoryList(t,e)},_initReceiveList:function(){this._initScrollView(this._root.presentArray,this._root.maxCount),this._setButtonActive(),this.receiveListDescriptionLabel.node.active=!0,this.receiveHistoryDescriptionLabel.node.active=!1},_initHistoryList:function(){this._initScrollView(this._root.presentHistoryArray,this._root.maxCount),this._setButtonActive(),this.receiveListDescriptionLabel.node.active=!1,this.receiveHistoryDescriptionLabel.node.active=!0},_initScrollView:function(t,e){var i=Math.ceil(e/r.PRESENT_MAX_COUNT);this.commonPageView.initCommonPageView(e,i,0,this._setCommonPageEvent.bind(this),function(){}),this._root.maxCount>0?(this._presentHistoryFlg?this.presentScrollView.initHistoryScrollView(this._root,this._root.presentHistoryArray):this.presentScrollView.initReceiveScrollView(this._root,t,this._setButtonActive.bind(this),function(){this._root.selectPresentModelMap={},this._requestReceiveList(0,this._initReceiveList.bind(this))}.bind(this)),this.noPresentNode.active=!1):(this._root.deleteUpdateCallbackKey(this.presentScrollView.getUpdateCallbackKey(),function(){this.presentScrollView.content.destroyAllChildren()}.bind(this)),this.noPresentNode.active=!0)},_setCommonPageEvent:function(t){this._presentHistoryFlg?this._requestHistoryList(t,function(){this.presentScrollView.initHistoryScrollView(this._root,this._root.presentHistoryArray)}.bind(this)):this._requestReceiveList(t,function(){this.presentScrollView.initReceiveScrollView(this._root,this._root.presentArray,this._setButtonActive.bind(this),function(){this._root.selectPresentModelMap={},this._requestReceiveList(0,this._initReceiveList.bind(this))}.bind(this))}.bind(this))},_setButtonEvent:function(){this.receiveAllBtn.setTapEvent(this._getReceiveAllEvent.bind(this),a.SE_NAME.RECEIVE),this.receiveSelectItemBtn.setTapEvent(this._getReceiveSelectEvent.bind(this),a.SE_NAME.RECEIVE),this.filterBtn.setTapEvent(this._getFilterEvent.bind(this)),this.resetBtn.setTapEvent(this._getResetEvent.bind(this),a.SE_NAME.CANCEL),this.receiveHistoryBtn.setTapEvent(this._getReceiveHistoryEvent.bind(this)),this.receiveListBtn.setTapEvent(this._getReceiveListEvent.bind(this))},_setButtonActive:function(){this._presentHistoryFlg?this._setButtonReceiveHistoryActive():this._setButtonReceiveListActive()},_setButtonReceiveListActive:function(){this._root.maxCount>0?(this._setButtonSelectPresentActive(),this.noPresentNode.active=!1):(this._setButtonFilterPresentActive(),this.noPresentNode.active=!0)},_setButtonReceiveHistoryActive:function(){this.receiveListBtn.node.active=!0,this.receiveHistoryBtn.node.active=!1,this.filterBtn.node.active=!1,this.filterGrayOutNode.active=!1,this.resetBtn.node.active=!1,this.receiveAllBtn.node.active=!1,this.receiveSelectItemBtn.node.active=!1,this.receiveSelectItemGrayOutNode.active=!1,this.receiveAllGrayOutNode.active=!1},_setButtonSelectPresentActive:function(){Object.keys(this._root.selectPresentModelMap).length>0?(this.receiveListBtn.node.active=!1,this.receiveHistoryBtn.node.active=!0,this.filterBtn.node.active=!0,this.filterGrayOutNode.active=!1,this.resetBtn.node.active=!0,this.receiveAllBtn.node.active=!1,this.receiveSelectItemBtn.node.active=!0,this.receiveSelectItemGrayOutNode.active=!1,this.receiveAllGrayOutNode.active=!1):(this.receiveListBtn.node.active=!1,this.receiveHistoryBtn.node.active=!0,this.filterBtn.node.active=!0,this.filterGrayOutNode.active=!1,this.resetBtn.node.active=!1,this.receiveAllBtn.node.active=this._root.getBulkReceiveAvailablePresentArray().length>0,this.receiveSelectItemBtn.node.active=!1,this.receiveSelectItemGrayOutNode.active=!1,this.receiveAllGrayOutNode.active=!1)},_setButtonFilterPresentActive:function(){this._root.filterCheckList.indexOf(!1)>=0?(this.receiveListBtn.node.active=!1,this.receiveHistoryBtn.node.active=!0,this.filterBtn.node.active=!0,this.filterGrayOutNode.active=!1,this.resetBtn.node.active=!1,this.receiveAllBtn.node.active=!1,this.receiveSelectItemBtn.node.active=!1,this.receiveSelectItemGrayOutNode.active=!1,this.receiveAllGrayOutNode.active=!1):(this.receiveListBtn.node.active=!1,this.receiveHistoryBtn.node.active=!0,this.filterBtn.node.active=!1,this.filterGrayOutNode.active=!0,this.resetBtn.node.active=!1,this.receiveAllBtn.node.active=!1,this.receiveSelectItemBtn.node.active=!1,this.receiveSelectItemGrayOutNode.active=!1,this.receiveAllGrayOutNode.active=!1)},_getRequestGetListParam:function(){for(var t={categories:[],hasPeriod:Number(this._root.filterCheckList[r.FILTER_IDX.HAS_PERIOD]),noPeriod:Number(this._root.filterCheckList[r.FILTER_IDX.NO_PERIOD])},e=[r.FILTER_IDX.UNIT,r.FILTER_IDX.EQUIPMENT,r.FILTER_IDX.ITEM,r.FILTER_IDX.OTHER],i=0;i<e.length;i+=1)this._root.filterCheckList[e[i]]&&t.categories.push(r.FILTER_IDX_TO_CATEGORY[e[i]]);return t},_getReceiveAllEvent:function(){this._root.openConfirmSimpleListPopup(this._root.getBulkReceiveAvailablePresentArray(),!1,function(){var t=_.map(this._root.getBulkReceiveAvailablePresentArray(),function(t){return t.presentCd});this._root.requestReceive(t,function(){this._root.openLimitPopup(this._root.getBulkReceiveAvailablePresentArray(),function(){this._openCompletePopup()}.bind(this))}.bind(this))}.bind(this))},_getReceiveSelectEvent:function(){var t=[],e=[];for(var i in this._root.selectPresentModelMap)t.push(this._root.selectPresentModelMap[i]),e.push(this._root.selectPresentModelMap[i].presentCd);this._root.openConfirmSimpleListPopup(t,!1,function(){this._root.requestReceive(e,function(){this._root.openLimitPopup(t,function(){this._openCompletePopup()}.bind(this))}.bind(this))}.bind(this))},_getFilterEvent:function(){this._root.openFilterPopup(this._root.filterCheckList,function(t){this._root.filterCheckList=t,this._requestReceiveList(0,this._initReceiveList.bind(this))}.bind(this))},_getResetEvent:function(){this.presentScrollView.resetAllCheck(),this._root.selectPresentModelMap={},this._setButtonActive()},_getReceiveHistoryEvent:function(){this._presentHistoryFlg=!0,this._root.maxCount=0,this._requestHistoryList(0,this.redraw.bind(this))},_getReceiveListEvent:function(){this._presentHistoryFlg=!1,this._root.maxCount=0,this._requestReceiveList(0,this.redraw.bind(this))},_openCompletePopup:function(){this._root.openConfirmSimpleListPopup(this._root.receivePresents,!0,function(){this._root.selectPresentModelMap={},this._requestReceiveList(0,this._initReceiveList.bind(this))}.bind(this))}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonPageView:"CommonPageView",PresentConst:"PresentConst",PresentScrollView:"PresentScrollView"}],PresentBoxViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"97338TWnJ9BA4DYUGA3xH8K","PresentBoxViewSetting");var a=t("PresentBoxRootUtils");e.exports={PRESENTBOX_SETTING:{PresentBoxSubRoot:{open:a.openPresentBoxSubRoot,close:a.closePresentBoxSubRoot}}},cc._RF.pop()},{PresentBoxRootUtils:"PresentBoxRootUtils"}],PresentConfirmSimpleListPopup:[function(t,e,i){"use strict";cc._RF.push(e,"ba619Dsy91PGYSaoYgdkQY3","PresentConfirmSimpleListPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=t("CommonUtils"),s=t("ItemUtils");cc.Class({extends:a,properties:{confirmTextNode:cc.Node,completeTextNode:cc.Node,simpleThumbnailPrefab:cc.Prefab,scrollView:o,confirmOkBtn:n,confirmCancelBtn:n,completeOkBtn:n},openConfirmSimpleListPopup:function(t,e,i){var a=r.getRoot();a.deleteUpdateCallbackKey("ConfirmSimpleListThumbnail",function(){this.scrollView.content.destroyAllChildren()}.bind(this));var o=_.cloneDeep(t);a.setUpdateCallback(function(){if(o.length<=0)return!0;var t=o.shift(),e=cc.instantiate(this.simpleThumbnailPrefab).getComponent("SimpleThumbnail"),i=s.getItemInfo(t.itemType,t.masterId);return e.initSimpleThumbnail(i.name,t.count),this.scrollView.content.addChild(e.node),!1}.bind(this),"ConfirmSimpleListThumbnail"),e?(this.confirmTextNode.active=!1,this.completeTextNode.active=!0,this.confirmOkBtn.node.active=!1,this.confirmCancelBtn.node.active=!1,this.completeOkBtn.node.active=!0,this.setCloseCallBack(i),this.completeOkBtn.setTapEvent(function(){this.close()}.bind(this))):(this.confirmTextNode.active=!0,this.completeTextNode.active=!1,this.confirmOkBtn.node.active=!0,this.confirmCancelBtn.node.active=!0,this.completeOkBtn.node.active=!1,this.confirmOkBtn.setTapEvent(function(){this.setCloseCallBack(i),this.close()}.bind(this)),this.confirmCancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL)),this.open(function(){this.scrollView.node.active=!0})},onDestroy:function(){var t=r.getRoot();t&&t.deleteUpdateCallbackKey("ConfirmSimpleListThumbnail",null)}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],PresentConfirmSimplePopup:[function(t,e,i){"use strict";cc._RF.push(e,"eef5erMd8dNi50bCpZyEbBe","PresentConfirmSimplePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ItemUtils");cc.Class({extends:a,properties:{simpleThumbnailPrefab:cc.Prefab,simpleThumbnailAddNode:cc.Node,okBtn:n},openConfirmSimplePopup:function(t,e){var i=cc.instantiate(this.simpleThumbnailPrefab).getComponent("SimpleThumbnail"),a=o.getItemInfo(t.itemType,t.masterId);i.initSimpleThumbnail(a.name,t.count),this.simpleThumbnailAddNode.addChild(i.node),this.setCloseCallBack(e),this.okBtn.setTapEvent(this.close.bind(this)),this.open()}}),cc._RF.pop()},{CommonButton:"CommonButton",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],PresentConst:[function(t,e,i){"use strict";cc._RF.push(e,"4e757o8Zx9BPY8ZvPnpAUBG","PresentConst");var a=t("GameConst");cc.Class({statics:{PRESENT_MAX_COUNT:100,PRESENT_NO_PERIOD_DATE:"99991231235959",PRESENT_FILTER_DEFAULT:[!0,!0,!0,!0,!0,!0],FILTER_IDX:cc.Enum({UNIT:0,EQUIPMENT:1,ITEM:2,OTHER:3,HAS_PERIOD:4,NO_PERIOD:5}),FILTER_IDX_TO_CATEGORY:{0:a.PRESENT_CATEGORY.UNIT,1:a.PRESENT_CATEGORY.EQUIPMENT,2:a.PRESENT_CATEGORY.ITEM,3:a.PRESENT_CATEGORY.OTHER}}});cc._RF.pop()},{GameConst:"GameConst"}],PresentMessageModel:[function(t,e,i){"use strict";cc._RF.push(e,"3e40atCDXdGwKbk5SGbU/Qx","PresentMessageModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getMessageId:function(){if(this._isKeyFieldAvailable("messageId"))return this._data.messageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: messageId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],PresentRandomReceiveCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"eacdczWxBJLD7ovbwsSZ4k7","PresentRandomReceiveCompletePopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("ItemUtils"),s=t("ItemConst");cc.Class({extends:a,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,presentNameLabel:cc.Label,presentCountLabel:cc.Label,okBtn:o},onLoad:function(){this.okBtn.setTapEvent(this.close.bind(this))},openPresentRandomReceiveCompletePopup:function(t,e,i,a,n,o,s){var c=r.getItemInfo(t.itemType,t.masterId);this.presentNameLabel.string=c.name+"x",this.presentCountLabel.string=""+t.count,this._initContent(t,e,i,a,n,o),this.setCloseCallBack(s),this.open()},_initContent:function(t,e,i,a,o,r){this.thumbnailParentNode.destroyAllChildren();var c=this._createReceivedGem(n.dao.userBasicData.getFreeGem(),i);c>0&&this._addPresentDetailThumbnail(t,s.ITEM_TYPE.FREE_GEM,s.GEM_ITEM_ID.FREE,c);var l,u,h=this._createReceivedGem(n.dao.userBasicData.getPaidGem(),a);h>0&&this._addPresentDetailThumbnail(t,s.ITEM_TYPE.PAID_GEM,s.GEM_ITEM_ID.PAID,h);var d=this._createReceivedCharacters(e.addCharacters);_.forEach(d,function(e,i){l=i.split("_"),u={characterId:parseInt(l[0]),level:parseInt(l[1]),exceedLimit:parseInt(l[2])},this._addPresentDetailThumbnail(t,s.ITEM_TYPE.CHARACTER,u.characterId,e,u)}.bind(this));var p=this._createReceivedEquipments(e.addEquipments);_.forEach(p,function(e,i){l=i.split("_"),u={equipmentId:parseInt(l[0]),level:parseInt(l[1]),rarity:1+parseInt(l[2])},this._addPresentDetailThumbnail(t,s.ITEM_TYPE.EQUIPMENT,u.equipmentId,e,u)}.bind(this));this._createReceivedFurniture(n.dao.userFurniture,r);var m=this._createReceivedItems(n.dao.userItems,o);_.forEach(m,function(e){this._addPresentDetailThumbnail(t,e.itemType,e.itemId,e.count)}.bind(this))},_addPresentDetailThumbnail:function(t,e,i,a,n){var o=cc.instantiate(this.thumbnailPrefab).getComponent("PresentReceiveDetailThumbnail");o.iniPresentReceiveDetailThumbnail(t,e,i,a,n),this.thumbnailParentNode.addChild(o.node)},_createReceivedGem:function(t,e){return t-e},_createReceivedCharacters:function(t){return _.countBy(t,function(t){return t.characterId+"_"+t.level+"_"+t.exceedLimit})},_createReceivedEquipments:function(t){return _.countBy(t,function(t){return t.equipmentId+"_"+t.level+"_"+t.exceedLimit})},_createReceivedFurniture:function(t,e){return _.differenceBy(t,e,function(t){return t.getFurnitureCd()})},_createReceivedItems:function(t,e){var i=_.differenceBy(t,e,function(t){return t.getItemId()+"_"+t.getCount()});return _.map(i,function(t){var i,a=_.find(e,function(e){return e.getItemType()===t.getItemType()&&e.getItemId()===t.getItemId()});return i=a?t.getCount()-a.getCount():t.getCount(),{itemType:t.getItemType(),itemId:t.getItemId(),count:i}})}});cc._RF.pop()},{CommonButton:"CommonButton",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",Singleton:"Singleton"}],PresentReceiveDetailThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"6b2aaHJ+mRLm5S8jEL9fYdm","PresentReceiveDetailThumbnail");var a=t("MatrixThumbnailUtils"),n=t("ItemUtils");cc.Class({extends:cc.Component,properties:{itemNameLabel:cc.Label,itemCountLabel:cc.Label,reasonLabel:cc.Label,setMatrixThumbnailNode:cc.Node},iniPresentReceiveDetailThumbnail:function(t,e,i,o,r){var s=a.createMatrixThumbnailByItemType(i,e,r);this.setMatrixThumbnailNode.addChild(s.node);var c=n.getItemInfo(e,i);this.itemNameLabel.string=c.name,this.itemCountLabel.string=""+o;var l=n.getItemInfo(t.itemType,t.masterId);this.reasonLabel.string=l.name+"\u53d7\u3051\u53d6\u308a\u3067\u7372\u5f97\u3057\u307e\u3057\u305f\u3002"}});cc._RF.pop()},{ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils"}],PresentScrollView:[function(t,e,i){"use strict";cc._RF.push(e,"97d033LciNGXqbeUJhkv1AE","PresentScrollView");var a=t("CommonScrollView");cc.Class({extends:a,properties:{presentThumbnailViewPrefab:cc.Prefab},_root:null,initReceiveScrollView:function(t,e,i,a){this._root=t,t.deleteUpdateCallbackKey("PresentScrollThumbnail",function(){this.content.destroyAllChildren()}.bind(this));var n=_.cloneDeep(e);t.setUpdateCallback(function(){if(n.length<=0)return!0;var e=n.shift(),o=cc.instantiate(this.presentThumbnailViewPrefab);return o.getComponent("PresentThumbnailView").initReceiveThumbnail(t,e,i,a),this.content.addChild(o),!1}.bind(this),"PresentScrollThumbnail")},initHistoryScrollView:function(t,e){this._root=t,t.deleteUpdateCallbackKey("PresentScrollThumbnail",function(){this.content.destroyAllChildren()}.bind(this));var i=_.cloneDeep(e);t.setUpdateCallback(function(){if(i.length<=0)return!0;var e=i.shift(),a=cc.instantiate(this.presentThumbnailViewPrefab);return a.getComponent("PresentThumbnailView").initHistoryThumbnail(t,e),this.content.addChild(a),!1}.bind(this),"PresentScrollThumbnail")},resetAllCheck:function(){for(var t=0;t<this.content.childrenCount;t+=1)this.content.children[t].getComponent("PresentThumbnailView").resetCheck()},getUpdateCallbackKey:function(){return"PresentScrollThumbnail"},onDestroy:function(){this._root&&this._root.deleteUpdateCallbackKey("PresentScrollThumbnail",null)}});cc._RF.pop()},{CommonScrollView:"CommonScrollView"}],PresentService:[function(t,e,i){"use strict";cc._RF.push(e,"ab34efJ+TZLqb1tf8EEjeyp","PresentService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getList:function(t,e,i,a,o){var r={index:t,categories:e.join(","),hasPeriod:i,noPeriod:a};this._requestCallApi(n.PRESENT_LIST,r,function(t,e){return o(t?void 0:e)})},getHistoryList:function(t,e){var i={index:t};this._requestCallApi(n.PRESENT_HISTORY_LIST,i,function(t,i){return e(t?void 0:i)})},receive:function(t,e){var i={presentCds:t.join(",")};this._requestCallApi(n.PRESENT_RECEIVE,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],PresentThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"0700anlgkVIB7FZFMG4kTZ8","PresentThumbnailView");var a=t("CommonButton"),n=t("CommonScrollLabel"),o=t("Singleton"),r=t("ItemUtils"),s=t("PresentUtils"),c=t("TimeUtils"),l=t("MatrixThumbnailUtils"),u=t("PresentConst"),h=t("ItemConst");cc.Class({extends:cc.Component,properties:{itemName:n,descriptionLabel:cc.Label,limitPeriodLabel:cc.Label,limitPeriodNode:cc.Node,receiveDateLabel:cc.Label,receiveDateNode:cc.Node,presentGetBtn:a,presentCheckBtn:a,presentCheckNode:cc.Node,setMatrixThumbnailNode:cc.Node},_root:null,initReceiveThumbnail:function(t,e,i,a){this._root=t;var n={prefix:"x",count:e.count},o=l.createMatrixThumbnailByItemType(e.masterId,e.itemType,n);this.setMatrixThumbnailNode.addChild(o.node);var d=r.getItemInfo(e.itemType,e.masterId);switch(this.itemName.setString(d.name),this.descriptionLabel.string=s.getMessage(e),this.presentCheckNode.active=!1,e.receiveEndDate!==u.PRESENT_NO_PERIOD_DATE?this.limitPeriodLabel.string=c.parseTimeToYmdhm(e.receiveEndDate):this.limitPeriodLabel.string="\u7121\u671f\u9650",this.limitPeriodNode.active=!0,this.receiveDateNode.active=!1,e.itemType){case h.ITEM_TYPE.USABLE_SET_ITEM:this.presentCheckBtn.node.active=!1;break;default:this._root.selectPresentModelMap[e.presentCd]&&(this.presentCheckNode.active=!0)}this.presentGetBtn.setTouchEnable(!0),this._setButtonEvent(e,i,a)},initHistoryThumbnail:function(t,e){this._root=t;var i={prefix:"x",count:e.count},a=l.createMatrixThumbnailByItemType(e.masterId,e.itemType,i);this.setMatrixThumbnailNode.addChild(a.node);var n=r.getItemInfo(e.itemType,e.masterId);this.itemName.setString(n.name),this.descriptionLabel.string=s.getMessage(e),this.presentCheckBtn.node.active=!1,this.receiveDateLabel.string=c.parseTimeToYmdhm(e.receivedData),this.limitPeriodNode.active=!1,this.receiveDateNode.active=!0,this.presentGetBtn.node.active=!1},resetCheck:function(){this.presentCheckNode.active=!1},_setButtonEvent:function(t,e,i){this.presentGetBtn.setTapEvent(function(){this.presentGetBtn.setTouchEnable(!1);var e=o.dao.userBasicData.getFreeGem(),a=o.dao.userBasicData.getPaidGem(),n=o.dao.userItems.slice(),r=o.dao.userFurniture.slice();this._root.requestReceive([t.presentCd],function(o){this._root.openLimitPopup([t],function(){switch(t.itemType){case h.ITEM_TYPE.USABLE_SET_ITEM:this._root.openPresentRandomReceiveCompletePopup(t,o,e,a,n,r,function(){i()});break;default:this._root.openConfirmSimplePopup(t,function(){i()})}}.bind(this)),this.presentGetBtn.setTouchEnable(!0)}.bind(this))}.bind(this),a.SE_NAME.EXECUTE),this.presentCheckBtn.setTapEvent(this._setCheckBtnEvent.bind(this,t,e),a.SE_NAME.EQUIP)},_setCheckBtnEvent:function(t,e){!this.presentCheckNode.active&&Object.keys(this._root.selectPresentModelMap).length>=u.PRESENT_MAX_COUNT?this._root.openMaxCheckPopup():(this.presentCheckNode.active=!this.presentCheckNode.active,this._setSelectPresentModelMap(this.presentCheckNode.active,t),e())},_setSelectPresentModelMap:function(t,e){t?this._root.selectPresentModelMap[e.presentCd]=e:delete this._root.selectPresentModelMap[e.presentCd]}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollLabel:"CommonScrollLabel",ItemConst:"ItemConst",ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",PresentConst:"PresentConst",PresentUtils:"PresentUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],PresentUtils:[function(t,e,i){"use strict";cc._RF.push(e,"966d4Nts/JLZ5lLoQuRgXdy","PresentUtils");var a=t("ResourceUtils"),n=t("Singleton");t("ItemConst");e.exports={getPresentIconName:function(t,e){return a.getFileNameThumbnailByItemType(e,t)},getMessage:function(t){for(var e=n.dao.PresentMessageMasters.find(function(e){return e.getMessageId()===t.messageId}).getText(),i=0;i<t.parameters.length;i++)e=e.replace("{"+i+"}",t.parameters[i]);return e}},cc._RF.pop()},{ItemConst:"ItemConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ProfileCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"d6871bXJFxPapC8VAc+UuLO","ProfileCharacterView");var a=t("Singleton"),n=(t("ResourceUtils"),t("CharacterUtils"),t("ViewUtils")),o=(t("GameConst"),t("DeckConst"));cc.Class({extends:cc.Component,properties:{characterStandViewParentNode:cc.Node},_characterStandView:null,initProfileCharacterView:function(){this._characterStandView=n.createCharacterStandView(),this._characterStandView.setCharacterStandImage(a.dao[a.USER].getPartnerId(o.DECK_TYPE.QUEST)),this.characterStandViewParentNode.addChild(this._characterStandView.node)}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",DeckConst:"DeckConst",GameConst:"GameConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],ProfileRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"f4f006IKthNB7fi6OrhlQ6Y","ProfileRootUtils"),e.exports={openProfileSubRoot:function(t,e){cc.log("openProfileSubRoot"),cc.log(e),t.profileSubRoot||(t.profileSubRoot=cc.instantiate(t.profileSubRootPrefab).getComponent("ProfileSubRoot"),t.subRootParent.addChild(t.profileSubRoot.node)),t.profileSubRoot.initProfileSubRoot(t)},closeProfileSubRoot:function(t,e){cc.log("closeProfileSubRoot"),cc.log(e),t.profileSubRoot&&(t.profileSubRoot.node.destroy(),t.profileSubRoot=null)}},cc._RF.pop()},{}],ProfileRoot:[function(t,e,i){"use strict";cc._RF.push(e,"4dc5fBc/YZLuYpASAyV42GM","ProfileRoot");var a=t("OutGameRootBase"),n=(t("Singleton"),t("PopupUtils")),o=t("ProfileViewSetting");t("GameConst"),cc.Class({extends:a,properties:{profileSubRootPrefab:cc.Prefab},_userRenamePopup:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,o.PROFILE_SETTING)},initData:function(){},initialize:function(){this.initOutGameRootBase();this._initOpenFirstView({ProfileSubRoot:{}})},redraw:function(){this.profileSubRoot&&this.profileSubRoot.initProfileSubRoot(this)},openUserRenamePopup:function(){n.openUserRenamePopup(this.redraw.bind(this),void 0,!1)}});cc._RF.pop()},{GameConst:"GameConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",ProfileViewSetting:"ProfileViewSetting",Singleton:"Singleton"}],ProfileSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"51f5azoyJ9MhahZKO5s29tF","ProfileSubRoot");var a=t("ProfileView"),n=t("ProfileCharacterView");cc.Class({extends:cc.Component,properties:{profileCharacterView:n,profileView:a},_root:null,initProfileSubRoot:function(t){this._root=t,this.profileCharacterView.initProfileCharacterView(),this.profileView.initProfileView(t)}});cc._RF.pop()},{ProfileCharacterView:"ProfileCharacterView",ProfileView:"ProfileView"}],ProfileViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"3d1f2oRQ81GiqNIUVHIwd3k","ProfileViewSetting");var a=t("ProfileRootUtils");e.exports={PROFILE_SETTING:{ProfileSubRoot:{open:a.openProfileSubRoot,close:a.closeProfileSubRoot}}},cc._RF.pop()},{ProfileRootUtils:"ProfileRootUtils"}],ProfileView:[function(t,e,i){"use strict";cc._RF.push(e,"7dc9ftJL4JJdK+ri219zoHD","ProfileView");var a=t("WindowBase"),n=t("CommonButton"),o=t("Singleton"),r=t("ResourceUtils");cc.Class({extends:a,properties:{userNameLabel:cc.Label,userLevelLabel:cc.Label,questClearCountLabel:cc.Label,towerNormalClearCountLabel:cc.Label,towerHardClearCountLabel:cc.Label,towerExtremeClearCountLabel:cc.Label,pvpWinRateLabel:cc.Label,pvpRankImageSprite:cc.Sprite,userRenameBtn:n},_root:null,onLoad:function(){this.userRenameBtn.setTapEvent(this._onTapRenameBtn.bind(this))},initProfileView:function(t){this._root=t;var e=o.dao[o.USER];this.userNameLabel.string=e.getUserName(),this.userLevelLabel.string=e.getLevel(),this.questClearCountLabel.string=o.dao.userQuests.reduce(function(t,e){return t+e.getClearCount()},0)+"\u56de";var i=o.dao.userPvP;r.addSprite(this.pvpRankImageSprite,r.getFileNamePvPClassIcon(i.getPvpClass()))},_onTapRenameBtn:function(){this._root.openUserRenamePopup()}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils",Singleton:"Singleton",WindowBase:"WindowBase"}],PromoteCharacterAbilityFortifyCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"00f3b580EZEgYDRfD/4vUj/","PromoteCharacterAbilityFortifyCompletePopup");var a=t("PopupBase"),n=(t("ItemUtils"),t("CommonUtils"),t("CommonButton")),o=(t("ResourceUtils"),t("GameConst")),r=(t("CharacterAbilityUtils"),t("ViewUtils"));cc.Class({extends:a,properties:{characterThumbnailPrefab:cc.Prefab,characterThumbnailParentNode:cc.Node,abilityThumbnailPrefab:cc.Prefab,abilityLayoutNode:cc.Node,beforeAbilityThumbnailParentNode:cc.Node,afterAbilityThumbnailParentNode:cc.Node,fortifyAnimation:cc.Animation,beforeLevelLabel:cc.Label,afterLevelLabel:cc.Label,maxLevelLabel:cc.Label,okBtn:n},_callbackToOkBtn:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openPromoteCharacterAbilityFortifyCompletePopup:function(t,e,i,a){this.setCloseCallBack(a),this._setCharacterThumbnail(t),this.beforeLevelLabel.string=e.abilityLevel+"",this.afterLevelLabel.string=i.abilityLevel+"",this.maxLevelLabel.string=i.maxAbilityLevel+"",this.abilityLayoutNode.opacity=0,this.open(function(){this._setAbilityThumbnails(e,i),this.fortifyAnimation.play()}.bind(this))},_setCharacterThumbnail:function(t){this.characterThumbnailParentNode.destroyAllChildren();var e=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail");e.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),t.getLevel(),1),this.characterThumbnailParentNode.addChild(e.node)},_setAbilityThumbnails:function(t,e){this.beforeAbilityThumbnailParentNode.destroyAllChildren(),this.afterAbilityThumbnailParentNode.destroyAllChildren();var i=cc.instantiate(this.abilityThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");i.initPromoteCharacterDetailStatusAbilityThumbnail(t,!1,!0),this.beforeAbilityThumbnailParentNode.addChild(i.node);var a=cc.instantiate(this.abilityThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");a.initPromoteCharacterDetailStatusAbilityThumbnail(e,!0,!0),a.setDescriptionRichText(r.insertDiffTag(t.abilityText,e.abilityText,o.RICH_TEXT_TAG_STATE.WHITE.START,o.RICH_TEXT_TAG_STATE.WHITE.END,o.RICH_TEXT_TAG_STATE.PLUS.START,o.RICH_TEXT_TAG_STATE.PLUS.END)),this.afterAbilityThumbnailParentNode.addChild(a.node),this.abilityLayoutNode.runAction(cc.fadeIn(.1))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterAbilityFortifyConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"c10ecNv+S9FUqnyi6ko4BVE","PromoteCharacterAbilityFortifyConfirmPopup");var a=t("CommonUtils"),n=t("ResourceUtils"),o=t("ViewUtils"),r=t("GameConst"),s=t("CharacterAbilityUtils"),c=t("PromoteCharacterConfirmPopupBase");cc.Class({extends:c,properties:{abilityThumbnailPrefab:cc.Prefab,abilityLayoutNode:cc.Node,beforeAbilityThumbnailParentNode:cc.Node,afterAbilityThumbnailParentNode:cc.Node},openPromoteCharacterAbilityFortifyConfirmPopup:function(t,e,i){this._initPromoteCharacterConfirmPopup(a.convertToCommaDelimited(s.calcAbilityFortifyPrice(t.abilityMainMaster.getAbilityFortifyType(),t.abilityLevel,t.rarity)),i),this.abilityLayoutNode.opacity=0,this.open(function(){this._setMaterials(s.createCharacterAbilityUpMaterialInfoArray(t.abilityMainMaster.getAbilityFortifyType(),t.abilityLevel)),this._setAbilityThumbnails(t,e)}.bind(this))},_setMaterials:function(t){for(var e in this.thumbnailParentNode.destroyAllChildren(),t)if(t[e].itemId){var i=cc.instantiate(this.thumbnailPrefab).getComponent("ItemMatrixThumbnail");i.setMainImage(n.getFileNameItemThumbnail(t[e].itemId)),i.setNumeCount("x",t[e].count),i.setCountSize(r.THUMBNAIL_LARGE_FONT_SIZE),this.thumbnailParentNode.addChild(i.node)}},_setAbilityThumbnails:function(t,e){this.beforeAbilityThumbnailParentNode.destroyAllChildren(),this.afterAbilityThumbnailParentNode.destroyAllChildren();var i=cc.instantiate(this.abilityThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");i.initPromoteCharacterDetailStatusAbilityThumbnail(t,!1,!0),this.beforeAbilityThumbnailParentNode.addChild(i.node);var a=cc.instantiate(this.abilityThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");a.initPromoteCharacterDetailStatusAbilityThumbnail(e,!0,!0),a.setDescriptionRichText(o.insertDiffTag(t.abilityText,e.abilityText,r.RICH_TEXT_TAG_STATE.WHITE.START,r.RICH_TEXT_TAG_STATE.WHITE.END,r.RICH_TEXT_TAG_STATE.PLUS.START,r.RICH_TEXT_TAG_STATE.PLUS.END)),this.afterAbilityThumbnailParentNode.addChild(a.node),this.abilityLayoutNode.runAction(cc.fadeIn(.1))}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CommonUtils:"CommonUtils",GameConst:"GameConst",PromoteCharacterConfirmPopupBase:"PromoteCharacterConfirmPopupBase",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterAbilityFortifyThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"9e48bOcY01HvYVt80sdA/+z","PromoteCharacterAbilityFortifyThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("CommonUtils"),r=t("CharacterAbilityUtils"),s=t("ItemUtils"),c=t("PopupUtils"),l=t("GameConst"),u=t("StaticResourceConst"),h=t("ItemSourceConst"),d=cc.Enum({MAIN:0,SUPPORT:1});cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,activeNode:cc.Node,inactiveNode:cc.Node,abilityLabelNodeArray:[cc.Node],nameLabel:cc.Label,descriptionText:cc.Label,levelLabel:cc.Label,priceLabel:cc.Label,sourceSearchBtn:a,executeBtn:a},_characterAbilityInfo:null,_abilityUpMaterialInfoArray:null,_callbackToExecuteBtn:null,onLoad:function(){this.sourceSearchBtn.setTapEvent(this._onTapSourceSearchBtn.bind(this)),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacterAbilityFortifyThumbnail:function(t,e){this._characterAbilityInfo=t,this._abilityUpMaterialInfoArray=r.createCharacterAbilityUpMaterialInfoArray(t.abilityMainMaster.getAbilityFortifyType(),t.abilityLevel),this._callbackToExecuteBtn=e,t.abilityLevel<t.maxAbilityLevel?(this.activeNode.active=!0,this.inactiveNode.active=!1,this.priceLabel.string=r.calcAbilityFortifyPrice(t.abilityMainMaster.getAbilityFortifyType(),t.abilityLevel,t.rarity),this._drawButton(),this._drawMaterials()):(this.activeNode.active=!1,this.inactiveNode.active=!0),this._switchDisplayMainOrSupportAbility(t.isSupportAbility),this.nameLabel.string=t.abilityMainMaster.getName(),this.descriptionText.string=t.abilityText,this.levelLabel.string="Lv."+t.abilityLevel+"/"+t.maxAbilityLevel},_isFortifyEnabled:function(){for(var t in this._abilityUpMaterialInfoArray)if(this._abilityUpMaterialInfoArray[t].itemId&&this._abilityUpMaterialInfoArray[t].count>s.getUserItemCount(this._abilityUpMaterialInfoArray[t].itemId))return!1;return!0},_drawButton:function(){this._isFortifyEnabled()?this.executeBtn.switchBtnImage(!0):this.executeBtn.switchBtnImage(!1)},_drawMaterials:function(){for(var t in this.thumbnailParentNode.destroyAllChildren(),this._abilityUpMaterialInfoArray)this._abilityUpMaterialInfoArray[t].itemId&&this.thumbnailParentNode.addChild(this._createThumbnail(this._abilityUpMaterialInfoArray[t]).node)},_createThumbnail:function(t){var e,i=s.getUserItemCount(t.itemId),a=cc.instantiate(this.thumbnailPrefab).getComponent("ItemMatrixThumbnail");return a.setMainImage(n.getFileNameItemThumbnail(t.itemId)),a.setCallbackToThumbnailBtn(function(){o.getRoot().openQuestSearchPopup(s.getItemMaster(t.itemId),a.node)}),t.count<=i?(e=l.COLOR_STATE.NORMAL,a.setActive(!0)):(e=l.COLOR_STATE.ALERT,a.setActive(!1)),a.setNumeCount("",i,e),a.setDenomCount("/",t.count),a.setCountSize(l.THUMBNAIL_LARGE_FONT_SIZE),a},_onTapSourceSearchBtn:function(){cc.instantiate(n.getResource(u.ITEM_SOURCE_LIST_POPUP_PREFAB_PATH)).getComponent("ItemSourceListPopup").openItemSourceListPopup(s.getItemMaster(h.SOURCE_ITEM_ID.CHARACTER_ABILITY_FORTIFY_MATERIAL),o.getRoot().getCurrentSceneName(),o.getRoot().sceneParam)},_onTapExecuteBtn:function(){this._isFortifyEnabled()?this._callbackToExecuteBtn(this._characterAbilityInfo):c.openSimpleMessageWindow("\u7d20\u6750\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002")},_switchDisplayMainOrSupportAbility:function(t){this.abilityLabelNodeArray.forEach(function(t){t.active=!1}),t?this.abilityLabelNodeArray[d.SUPPORT].active=!0:this.abilityLabelNodeArray[d.MAIN].active=!0}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemSourceConst:"ItemSourceConst",ItemUtils:"ItemUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],PromoteCharacterAlertPopup:[function(t,e,i){"use strict";cc._RF.push(e,"2ae93g2b2ZHw7dC6ChJDrcv","PromoteCharacterAlertPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView");t("Singleton"),t("ResourceUtils"),cc.Class({extends:a,properties:{commonScrollView:o,content:cc.Node,matrixThumbnailPrefab:cc.Prefab,okBtn:n,cancelBtn:n},_characterModelArray:null,_callback:null,openPromoteCharacterAlertPopup:function(t,e){this._setParameter(t,e),this._setScrollViewContent(),this._setButtonEvents(),this.open(this.openCallback.bind(this))},_setParameter:function(t,e){this._characterModelArray=t,this._callback=e},_setScrollViewContent:function(){this.content.destroyAllChildren();for(var t=null,e=0;e<this._characterModelArray.length;e+=1)(t=cc.instantiate(this.matrixThumbnailPrefab).getComponent("CharacterMatrixThumbnail")).initCharacterMatrixThumbnail(this._characterModelArray[e].getCharacterMainMaster(),this._characterModelArray[e].getExceedLimit()),this.content.addChild(t.node);this.commonScrollView.scrollToTop(),this.commonScrollView.node.active=!1},_setButtonEvents:function(){this.okBtn.setTapEvent(this._okBtnEvent.bind(this)),this.cancelBtn.setTapEvent(this._cancelBtnEvent.bind(this),n.SE_NAME.CANCEL)},_okBtnEvent:function(){this._callback(),this.close()},_cancelBtnEvent:function(){this.close()},openCallback:function(){this.commonScrollView.node.active=!0,this.commonScrollView.scrollToTop()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],PromoteCharacterConfirmPopupBase:[function(t,e,i){"use strict";cc._RF.push(e,"13f29rW60FMDa9Gqf5ncWR/","PromoteCharacterConfirmPopupBase");var a=t("PopupBase"),n=t("ItemUtils"),o=t("CommonUtils"),r=t("CommonButton"),s=t("GameConst");cc.Class({extends:a,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,needCurrencyNameLabel:cc.Label,needCurrencyCountLabel:cc.Label,currentCurrencyNameLabel:cc.Label,currentCurrencyCountLabel:cc.Label,executeBtn:r,cancelBtn:r},_callbackToExecuteBtn:null,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),r.SE_NAME.CANCEL)},_initPromoteCharacterConfirmPopup:function(t,e){this._callbackToExecuteBtn=e;var i=n.getItemMaster(s.ITEM_ID_GOLD);this.needCurrencyNameLabel.string="\u5fc5\u8981["+i.getName()+"]",this.needCurrencyCountLabel.string=t,this.currentCurrencyNameLabel.string="\u6240\u6301["+i.getName()+"]",this.currentCurrencyCountLabel.string=o.convertToCommaDelimited(n.getUserItemCount(s.ITEM_ID_GOLD))},_setMaterials:function(){},_onTapExecuteBtn:function(){this._callbackToExecuteBtn(),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],PromoteCharacterDetailAppendView:[function(t,e,i){"use strict";cc._RF.push(e,"54be2rv8+lOLrrJeDSvHbdE","PromoteCharacterDetailAppendView");t("CommonButton"),t("CharacterAbilityUtils");var a=t("PromoteCharacterDetailStatusViewBase");t("PromoteCharacterDetailFortifyAppendListView"),cc.Class({extends:a,properties:{skillThumbnailPrefab:cc.Prefab,abilityThumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node},initPromoteCharacterDetailStatusView:function(t,e){this._super(t,e),this._initListContent()},_initListContent:function(){this.thumbnailParentNode.destroyAllChildren(),this._initListContentForSkill(),this._initListContentForAbility()},_initListContentForSkill:function(){var t=this._characterModel.getCharacterSkillInfo(),e=cc.instantiate(this.skillThumbnailPrefab).getComponent("PromoteCharacterSkillFortifyThumbnail");e.initPromoteCharacterSkillFortifyThumbnail(t,this._onTapSkillInfoBtn.bind(this),this._onTapSkillExecuteBtn.bind(this)),this.thumbnailParentNode.addChild(e.node)},_initListContentForAbility:function(){var t=this._characterModel.getCharacterAbilityInfoArray();for(var e in t){var i=cc.instantiate(this.abilityThumbnailPrefab).getComponent("PromoteCharacterAbilityFortifyThumbnail");i.initPromoteCharacterAbilityFortifyThumbnail(t[e],this._onTapAbilityInfoBtn.bind(this),this._onTapAbilityExecuteBtn.bind(this)),this.thumbnailParentNode.addChild(i.node)}},_onTapSkillInfoBtn:function(t,e){this._root.openSkillSimplePopup(t,e,cc.v2(-270,0))},_onTapAbilityInfoBtn:function(t,e){this._root.openAbilitySimplePopup(t,e,cc.v2(-270,0))},_onTapSkillExecuteBtn:function(t){this._root.pushPromoteCharacterSkillFortifyMaterialSelectSubRoot(t)},_onTapAbilityExecuteBtn:function(t){this._root.openPromoteCharacterAbilityfortifyConfirmPopup(t)}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CommonButton:"CommonButton",PromoteCharacterDetailFortifyAppendListView:"PromoteCharacterDetailFortifyAppendListView",PromoteCharacterDetailStatusViewBase:"PromoteCharacterDetailStatusViewBase"}],PromoteCharacterDetailExceedLimitView:[function(t,e,i){"use strict";cc._RF.push(e,"c0167iRckpGs66D01khllgN","PromoteCharacterDetailExceedLimitView");t("CharacterUtils"),t("CommonUtils");var a=t("CharacterConst"),n=t("CommonButton"),o=t("PromoteCharacterDetailStatusParamViewBase"),r=t("PromoteCharacterDetailNextReleaseAppendListView");cc.Class({extends:o,properties:{promoteCharacterDetailNextReleaseAppendListView:r,nextReleaseHeaderLabel:cc.Label,attentionDispNode:cc.Node,executeBtn:n},onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacterDetailStatusView:function(t,e){this._super(t,e),this._drawPromoteCharacterDetailNextReleaseAppendListView()},_drawPromoteCharacterDetailNextReleaseAppendListView:function(){var t=this._characterModel.getExceedLimit(),e=t+1;t<this._characterModel.getExceedLimitMaxCount()?(this.executeBtn.switchBtnImage(!0),this.executeBtn.setTouchEnable(!0),this.attentionDispNode.active=!1,this.promoteCharacterDetailNextReleaseAppendListView.node.parent.active=!0,this.promoteCharacterDetailNextReleaseAppendListView.initPromoteCharacterDetailNextReleaseAppendListView(this._characterModel,t,e)):(e=t,this.executeBtn.switchBtnImage(!1),this.executeBtn.setTouchEnable(!1),this.attentionDispNode.active=!0,this.promoteCharacterDetailNextReleaseAppendListView.node.parent.active=!1)},_drawLevelProgress:function(){var t=this._characterModel.getMaxLevel(),e=this._root.getNextCharacterMaxLevelForTargetCharacter();if(t<e){this._characterLevelProgressView.node.active=!0;var i=this._characterModel.getExpRateForNextLevel(),n=this._characterModel.getNeedExpForNextLevel();this._characterLevelProgressView.initCharacterLevelProgressView(a.PROMOTE_TYPE.EXCEED_LIMIT,0,0,t,e,n,i)}else this._super()},_drawExceedLimitProgress:function(){this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(this._characterModel.getExceedLimit(),this._characterModel.getExceedLimit(),this._characterModel.getExceedLimitMaxCount())},_onTapExecuteBtn:function(){this._root.pushPromoteCharacterExceedLimitMaterialSelectSubRoot()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",PromoteCharacterDetailNextReleaseAppendListView:"PromoteCharacterDetailNextReleaseAppendListView",PromoteCharacterDetailStatusParamViewBase:"PromoteCharacterDetailStatusParamViewBase"}],PromoteCharacterDetailFortifyAppendListView:[function(t,e,i){"use strict";cc._RF.push(e,"6653a3WTwxHXpw37hoX1+J6","PromoteCharacterDetailFortifyAppendListView");cc.Class({extends:cc.Component,properties:{content:cc.Node,promoteCharacterDetailFortifySkillAbilityThumbnailPrefab:cc.Prefab},initPromoteCharacterDetailFortifyAppendListView:function(t,e,i){this._initListContent(t,e,i)},_initListContent:function(t,e,i){this.content.destroyAllChildren(),this._initListContentForSkill(t,e),this._initListContentForAbility(t,i)},_initListContentForSkill:function(t,e){var i=t.getCharacterSkillInfo(),a=cc.instantiate(this.promoteCharacterDetailFortifySkillAbilityThumbnailPrefab).getComponent("PromoteCharacterDetailFortifyAppendThumbnail");a.initPromoteCharacterDetailFortifySkillThumbnail(i,e),this.content.addChild(a.node)},_initListContentForAbility:function(t,e){var i=t.getCharacterAbilityInfoArray();for(var a in i){var n=cc.instantiate(this.promoteCharacterDetailFortifySkillAbilityThumbnailPrefab).getComponent("PromoteCharacterDetailFortifyAppendThumbnail");n.initPromoteCharacterDetailFortifyAbilityThumbnail(i[a],e),this.content.addChild(n.node)}}});cc._RF.pop()},{}],PromoteCharacterDetailFortifyAppendThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"555e6Gvt9JOEY4EmmprgK4g","PromoteCharacterDetailFortifyAppendThumbnail");var a=t("ItemConst"),n=cc.Enum({SKILL:0,ABILITY:1,WEAPON:2,PROTECTOR:3});cc.Class({extends:cc.Component,properties:{iconNodeArray:[cc.Node],activateNode:cc.Node,inActivateNode:cc.Node,lockIconNode:cc.Node,currentAppendNameLabel:cc.Label,afterAppendNameLabel:cc.Label,currentLevelNumLabel:cc.Label,beforeLevelNumLabel:cc.Label,afterLevelNumLabel:cc.Label},initPromoteCharacterDetailFortifySkillThumbnail:function(t,e){this._resetProperties();var i=t.skillLevel<e;this._initNodes(n.SKILL,i),this._initLabels(t.skillMainMaster.getName(),null,t.skillLevel,e)},initPromoteCharacterDetailFortifyAbilityThumbnail:function(t,e){this._resetProperties();var i=t.abilityLevel<e;this._initNodes(n.ABILITY,i),this._initLabels(t.abilityMainMaster.getName(),null,t.abilityLevel,e)},getLockIconNode:function(){return this.lockIconNode},initPromoteCharacterDetailStatusEquipmentSimpleThumbnail:function(t,e){this._resetProperties();var i=this._convertEquipmentTypeToIconIdx(t.equipmentType);this._initNodes(i,!1);var a=null,n=null;e?n=t.frameName+"\u304c\u89e3\u653e\u3055\u308c\u307e\u3059":a=t.frameName+"\u304c\u89e3\u653e\u3055\u308c\u307e\u3057\u305f",this._initLabels(a,n,0,0)},_convertEquipmentTypeToIconIdx:function(t){switch(t){case a.EQUIPMENT_TYPE.ATK:return n.WEAPON;case a.EQUIPMENT_TYPE.DEF:return n.PROTECTOR;default:return n.WEAPON}},_initNodes:function(t,e){this.iconNodeArray[t].active=!0,this.activateNode.active=e,this.inActivateNode.active=!e},_initLabels:function(t,e,i,a){t&&(this.currentAppendNameLabel.node.active=!0,this.currentAppendNameLabel.string=t),e&&(this.afterAppendNameLabel.node.active=!0,this.afterAppendNameLabel.string=e),this._setLevelNumText(this.currentLevelNumLabel,i),this._setLevelNumText(this.beforeLevelNumLabel,i),this._setLevelNumText(this.afterLevelNumLabel,a)},_setLevelNumText:function(t,e){t.string=e?"Lv."+e:""},_resetProperties:function(){for(var t in this.iconNodeArray)this.iconNodeArray[t].active=!1;this.activateNode.active=!1,this.inActivateNode.active=!1,this.currentAppendNameLabel.node.active=!1,this.afterAppendNameLabel.node.active=!1,this.currentAppendNameLabel.string="",this.afterAppendNameLabel.string=""}});cc._RF.pop()},{ItemConst:"ItemConst"}],PromoteCharacterDetailImageView:[function(t,e,i){"use strict";cc._RF.push(e,"eed3bidd8JJi60xhVOYmxBa","PromoteCharacterDetailImageView");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("Singleton"),r=t("PopupUtils"),s=t("CharacterConst");cc.Class({extends:cc.Component,properties:{characterNameLabel:cc.Label,characterSkinNameLabel:cc.Label,attributeIconImageSprite:cc.Sprite,rarityIconImageSprite:cc.Sprite,characterImageSprite:cc.Sprite,roomCardBtn:a,partnerBtn:a,protectBtn:a,wholeDisplayBtn:a,commonWholeViewPrefab:cc.Prefab},_root:null,_characterWholeView:null,initPromoteCharacterDetailImageView:function(t){this._root=t,this._characterWholeView=null;var e=t.getCurrentCharacterModel();this._initSprites(e),this._initButtons(e),this.redrawPromoteCharacterDetailImageView()},redrawPromoteCharacterDetailImageView:function(){var t=this._root.getCurrentCharacterModel();this._initLabels(t),this._redrawButtons()},_initLabels:function(t){this.characterNameLabel.string=t.getShortName(),this.characterSkinNameLabel.string="["+t.getSkinName()+"]"},_initSprites:function(t){n.addSprite(this.rarityIconImageSprite,n.getFileNameRarityStrIcon(t.getRarity())),n.addSprite(this.attributeIconImageSprite,n.getFileNameAttributeIcon(t.getAttribute())),n.addSprite(this.characterImageSprite,n.getFileNameCharacterMainMid(t.getCharacterId()))},_initButtons:function(t){this.roomCardBtn.setTapEvent(this._onTapRoomCardBtn.bind(this)),this.partnerBtn.setTapEvent(this._onTapPartnerBtn.bind(this),a.SE_NAME.EXECUTE),this.protectBtn.setTapEvent(this._onTapProtectBtn.bind(this),a.SE_NAME.EQUIP),this.wholeDisplayBtn.setTapEvent(this._onTapWholeDisplayBtn.bind(this))},_onTapRoomCardBtn:function(){this._root.transitionRoomCharacterScene(this._root.getCurrentCharacterModel().getCharacterGroupId(),this._root.getCurrentCharacterModel().getCharacterId())},_onTapPartnerBtn:function(){this._isFavorite()?this._root.requestChangePartner(0,this._callbackRequestChangePartner.bind(this)):this._root.requestChangePartner(this._root.getCurrentCharacterModel().getCharacterId(),this._callbackRequestChangePartner.bind(this))},_onTapProtectBtn:function(){var t=this._root.getCurrentCharacterCd();this._root.requestChangeProtect(t,this._redrawProtectBtn.bind(this))},_onTapWholeDisplayBtn:function(){this._openCharacterWholeView()},_openCharacterWholeView:function(){if(!this._characterWholeView){var t="";t=this._root.getCurrentCharacterModel().getRarity()>=s.WHOLE_DISPLAY_ENABLED_BORDER_RARITY?n.getFileNameCharacterMain(this._root.getCurrentCharacterModel().getCharacterId()):n.getFileNameCharacterStand(this._root.getCurrentCharacterModel().getCharacterId()),this._characterWholeView=cc.instantiate(this.commonWholeViewPrefab).getComponent("CommonWholeView"),this._characterWholeView.openCommonWholeView(t,function(){this._characterWholeView=null}.bind(this))}},_redrawButtons:function(){this._redrawPartnerBtn(),this._redrawProtectBtn()},_redrawPartnerBtn:function(){this.partnerBtn.switchBtnImage(this._isFavorite())},_redrawProtectBtn:function(){var t=this._root.getCurrentCharacterModel().getIsProtect();this.protectBtn.switchBtnImage(t)},_isFavorite:function(){var t=o.dao[o.USER].userData.getPartner(),e=this._root.getCurrentCharacterModel().getCharacterId();return 0===t.isDisplayRoom&&t.partnerId===e},_callbackRequestChangePartner:function(){this._redrawPartnerBtn(),this._isFavorite()?r.openCommonPopupOk("\u304a\u6c17\u306b\u5165\u308a\u767b\u9332","\u30db\u30fc\u30e0\u753b\u9762\u306e\u304a\u6c17\u306b\u5165\u308a\u306b\u767b\u9332\u3055\u308c\u307e\u3057\u305f\u3002"):r.openCommonPopupOk("\u304a\u6c17\u306b\u5165\u308a\u89e3\u9664","\u30db\u30fc\u30e0\u753b\u9762\u306e\u304a\u6c17\u306b\u5165\u308a\u304b\u3089\u89e3\u9664\u3055\u308c\u307e\u3057\u305f\u3002")}});cc._RF.pop()},{CharacterConst:"CharacterConst",CommonButton:"CommonButton",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],PromoteCharacterDetailNextReleaseAppendListView:[function(t,e,i){"use strict";cc._RF.push(e,"06044Vc8tBNHZ31M1GM3hMv","PromoteCharacterDetailNextReleaseAppendListView");cc.Enum({EQUIPMENT:0,ABILITY:1}),cc.Class({extends:cc.Component,properties:{content:cc.Node,equipmentThumbnailPrefab:cc.Prefab,skillAbilityThumbnailPrefab:cc.Prefab},initPromoteCharacterDetailNextReleaseAppendListView:function(t,e,i){this._initListContent(t,e,i)},_initListContent:function(t,e,i){this.content.destroyAllChildren(),this._initListContentForEquipment(t.getNextReleaseCharacterEquipmentInfoArray(),e,i),this._initListContentForAbility(t.getNextReleaseCharacterAbilityInfoArray(),e,i)},_initListContentForEquipment:function(t,e,i){for(var a in t){var n=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("PromoteCharacterDetailFortifyAppendThumbnail"),o=t[a],r=e<i&&o.needExceedLimit===i;n.initPromoteCharacterDetailStatusEquipmentSimpleThumbnail(o,r),this.content.addChild(n.node)}},_initListContentForAbility:function(t,e,i){for(var a in t){var n=cc.instantiate(this.skillAbilityThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail"),o=t[a],r=e<i&&o.needExceedLimit===i;n.initPromoteCharacterDetailStatusAbilityThumbnail(o,r,!0),this.content.addChild(n.node)}}});cc._RF.pop()},{}],PromoteCharacterDetailPopupStatusEquipmentListView:[function(t,e,i){"use strict";cc._RF.push(e,"d8659Jt1nJEs7RJqGqjNnrk","PromoteCharacterDetailPopupStatusEquipmentListView");t("PopupUtils");var a=t("CharacterEquipmentUtils"),n=t("PromoteCharacterDetailStatusAppendListViewBase");t("CharacterConst"),cc.Class({extends:n,properties:{},_initListContent:function(){this.content.destroyAllChildren();var t=[];if(this._characterModel)t=this._characterModel.getCharacterEquipmentInfoArray();else t=a.createCharacterEquipmentInfoArray(this._characterMainMaster,this._characterModel);for(var e in t){var i=this._createThumbnailNode(this._root,t[e],this._characterMainMaster.getAttribute());this.content.addChild(i)}},_createThumbnailNode:function(t,e,i){var a=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterDetailStatusEquipmentThumbnail");return a.initPromoteCharacterDetailStatusEquipmentThumbnail(e,i,void 0),a.node},_onTapThumbnailBtn:function(t){this._root.closePromoteCharacterDetailPopup(),t.equipmentModel?this._root.openPromoteCharacterEquipmentSelectPopup(t,this._root.redraw.bind(this._root)):this._root.pushPromoteCharacterEquipmentSelectSubRoot(t)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterEquipmentUtils:"CharacterEquipmentUtils",PopupUtils:"PopupUtils",PromoteCharacterDetailStatusAppendListViewBase:"PromoteCharacterDetailStatusAppendListViewBase"}],PromoteCharacterDetailPopupStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"13bd97VdCFEALAbNFQffcBm","PromoteCharacterDetailPopupStatusView");t("CommonButton");var a=t("CommonUtils"),n=t("CharacterUtils"),o=t("Singleton"),r=t("PromoteCharacterDetailStatusParamViewBase"),s=t("PromoteCharacterDetailStatusTabView");cc.Class({extends:r,properties:{promoteCharacterDetailStatusTabView:s},_characterMainMaster:null,initPromoteCharacterDetailStatusView:function(t,e,i){this._characterMainMaster=e,this._super(t,i),this._initPromoteCharacterDetailStatusTabView(t,e,i)},_initPromoteCharacterDetailStatusTabView:function(t,e,i){this.promoteCharacterDetailStatusTabView.initPromoteCharacterDetailStatusTabView(t,e,i)},_drawLevelProgress:function(){this._characterLevelProgressView.node.active=!0;var t=0,e=1,i=1,a=1;this._characterModel?(t=this._characterModel.getExpRateForNextLevel(),e=this._characterModel.getNeedExpForNextLevel(),i=this._characterModel.getMaxLevel(),a=this._characterModel.getLevel()):(e=n.calcNeedExpForNextLevelByTotalExp(0,this._characterMainMaster.getExpType()),i=this._characterMainMaster.getMaxLevel0()),this._characterLevelProgressView.initCharacterLevelProgressView(0,a,0,i,0,e,t)},_drawExceedLimitProgress:function(){var t=0,e=0,i=1;this._characterModel?(t=this._characterModel.getExceedLimit(),e=this._characterModel.getExceedLimit(),i=this._characterModel.getExceedLimitMaxCount()):i=o.dao.CharacterExceedLimitMasters.filter(function(t){return t.getExceedLimitType()===this._characterMainMaster.getExceedLimitType()}.bind(this)).length;this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(t,e,i)},_drawCharacterParameter:function(){this.characterParameterView.node.active=!0;var t=0,e=0,i=0;this._characterModel?(t=this._characterModel.getTotalHp(),e=this._characterModel.getTotalAtk(),i=this._characterModel.getTotalDef()):(t=this._characterMainMaster.getMinHp(),e=this._characterMainMaster.getMinAtk(),i=this._characterMainMaster.getMinDef()),this.totalPowerLabel.string=a.convertToCommaDelimited(t+e+i),this.characterParameterView.initBattleParameterView(t,e,i)},_drawCharacterAddParameter:function(){if(this.equipmentTotalPowerLabel){this.characterParameterView.node.active=!0;var t,e=this._getAddParameter();t=e.hp+e.atk+e.def,this.equipmentTotalPowerLabel.string="(+"+a.convertToCommaDelimited(t)+")",this.characterEquipmentParameterView.initBattleParameterView(e.hp,e.atk,e.def),this.characterEquipmentParameterView.setPrefix("(+"),this.characterEquipmentParameterView.setSuffix(")")}},_getAddParameter:function(){if(this._characterModel){var t=this._characterModel.getEquipmentStatus(),e=this._characterModel.getEquipmentEffect(this._characterModel.getHp()+t.hp,this._characterModel.getAtk()+t.atk,this._characterModel.getDef()+t.def);return{hp:t.hp+e.hp,atk:t.atk+e.atk,def:t.def+e.def}}return{hp:0,atk:0,def:0}}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",PromoteCharacterDetailStatusParamViewBase:"PromoteCharacterDetailStatusParamViewBase",PromoteCharacterDetailStatusTabView:"PromoteCharacterDetailStatusTabView",Singleton:"Singleton"}],PromoteCharacterDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"8ad50gA67FBa7cwHmEbs+A1","PromoteCharacterDetailPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("PromoteCharacterDetailPopupStatusView");cc.Class({extends:a,properties:{characterNameLabel:cc.Label,characterSkinNameLabel:cc.Label,characterLevelLabel:cc.Label,attributeIconImageSprite:cc.Sprite,rarityIconImageSprite:cc.Sprite,natureIconImageSprite:cc.Sprite,characterImageSprite:cc.Sprite,promoteCharacterDetailPopupStatusView:r,okBtn:n},_root:null,_characterModel:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openPromoteCharacterDetailPopup:function(t,e){this._root=t,this._characterModel=e,this._initLabels(),this._initSprites(),this.promoteCharacterDetailPopupStatusView.initPromoteCharacterDetailStatusView(t,e.getCharacterMainMaster(),e),this.open()},_initLabels:function(){this.characterNameLabel.string=this._characterModel.getShortName(),this.characterSkinNameLabel.string="["+this._characterModel.getSkinName()+"]",this.characterLevelLabel.string=""+this._characterModel.getLevel()},_initSprites:function(){o.addSprite(this.rarityIconImageSprite,o.getFileNameRarityStrIcon(this._characterModel.getRarity())),o.addSprite(this.attributeIconImageSprite,o.getFileNameAttributeIcon(this._characterModel.getAttribute())),o.addSprite(this.characterImageSprite,o.getFileNameCharacterMainDetail(this._characterModel.getCharacterId()))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",PromoteCharacterDetailPopupStatusView:"PromoteCharacterDetailPopupStatusView",ResourceUtils:"ResourceUtils"}],PromoteCharacterDetailReleaseAppendListView:[function(t,e,i){"use strict";cc._RF.push(e,"9b8f6vDU09CWrF7OJRps/vq","PromoteCharacterDetailReleaseAppendListView");var a=t("UnlockEffectUtils");cc.Class({extends:cc.Component,properties:{content:cc.Node,equipmentThumbnailPrefab:cc.Prefab,skillAbilityThumbnailPrefab:cc.Prefab},initPromoteCharacterDetailReleaseAppendListView:function(t,e){this._initListContent(t,e)},_initListContent:function(t,e){this.content.destroyAllChildren(),this._initListContentDifferenceExceedLimit(t,e)},_initListContentForEquipment:function(t){for(var e in t){var i=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("PromoteCharacterDetailFortifyAppendThumbnail"),n=t[e];i.initPromoteCharacterDetailStatusEquipmentSimpleThumbnail(n,!0),a.playUnLockEffectAnimationNormal(i.getLockIconNode(),function(){i.initPromoteCharacterDetailStatusEquipmentSimpleThumbnail(n,!1)}),this.content.addChild(i.node)}},_initListContentForAbility:function(t){for(var e in t){var i=cc.instantiate(this.skillAbilityThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail"),n=t[e];i.initPromoteCharacterDetailStatusAbilityThumbnail(n,!0,!1),a.playUnLockEffectAnimationNormal(i.getLockIconNode(),function(){i.initPromoteCharacterDetailStatusAbilityThumbnail(n,!1,!0)}),this.content.addChild(i.node)}},_initListContentDifferenceExceedLimit:function(t,e){for(var i=[],a=[],n=t.getExceedLimit()+1;n<=e.getExceedLimit();n+=1)i=i.concat(t.getReleaseCharacterEquipmentInfoArrayByExceedLimit(n)),a=a.concat(t.getReleaseCharacterAbilityInfoArrayByExceedLimit(n));this._initListContentForEquipment(i),this._initListContentForAbility(a)}});cc._RF.pop()},{UnlockEffectUtils:"UnlockEffectUtils"}],PromoteCharacterDetailRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"20198X/S+5AaqycmaJMYkfF","PromoteCharacterDetailRootUtils");t("GameConst"),t("CharacterConst"),t("EquipmentUtils");var a=t("Singleton");e.exports={openPromoteCharacterDetailSubRoot:function(t,e){t.promoteCharacterDetailSubRoot||(t.promoteCharacterDetailSubRoot=cc.instantiate(t.promoteCharacterDetailSubRootPrefab).getComponent("PromoteCharacterDetailSubRoot"),t.subRootParent.addChild(t.promoteCharacterDetailSubRoot.node)),t.setCurrentTab(e.topTabIndex),t.setCurrentCharacterCd(e.targetCharacterCd),t.promoteCharacterDetailSubRoot.initPromoterCharacterDetailSubRoot(t,t.getCurrentTab(),e.secondTabIndex)},closePromoteCharacterDetailSubRoot:function(t,e){cc.log("closePromoteCharacterDetailSubRoot"),cc.log(e),t.promoteCharacterDetailSubRoot&&(t.promoteCharacterDetailSubRoot.node.destroy(),t.promoteCharacterDetailSubRoot=null)},openPromoteCharacterEquipmentSelectSubRoot:function(t,e){if(cc.log("openPromoteCharacterEquipmentSelectSubRoot"),cc.log(e),!t.promoteCharacterEquipmentSelectSubRoot){var i={characterModel:a.dao[a.USER_CHARACTER].find(function(t){return t.getCharacterCd()===e.characterCd}),frameName:e.frameName,equipmentType:e.equipmentType,position:e.position,needExceedLimit:e.needExceedLimit,isReleased:e.isReleased,equipmentModel:a.dao[a.USER_EQUIPMENT].find(function(t){return t.getEquipmentCd()===e.equipmentCd})};t.promoteCharacterEquipmentSelectSubRoot=cc.instantiate(t.promoteCharacterEquipmentSelectSubRootPrefab).getComponent("PromoteCharacterEquipmentSelectSubRoot"),t.promoteCharacterEquipmentSelectSubRoot.initPromoteCharacterEquipmentSelectSubRoot(t,i),e.characterCd&&t.setCurrentCharacterCd(e.characterCd),t.subRootParent.addChild(t.promoteCharacterEquipmentSelectSubRoot.node)}},closePromoteCharacterEquipmentSelectSubRoot:function(t,e){cc.log("closePromoteCharacterEquipmentSelectSubRoot"),cc.log(e),t.promoteCharacterEquipmentSelectSubRoot&&(t.promoteCharacterEquipmentSelectSubRoot.node.destroy(),t.promoteCharacterEquipmentSelectSubRoot=null)},openPromoteCharacterFortifyMaterialSelectSubRoot:function(t,e){cc.log("PromoteCharacterFortifyMaterialSelectSubRoot"),cc.log(e),t.promoteCharacterFortifyMaterialSelectSubRoot||(t.promoteCharacterFortifyMaterialSelectSubRoot=cc.instantiate(t.promoteCharacterFortifyMaterialSelectSubRootPrefab).getComponent("PromoteCharacterFortifyMaterialSelectSubRoot"),t.subRootParent.addChild(t.promoteCharacterFortifyMaterialSelectSubRoot.node)),t.promoteCharacterFortifyMaterialSelectSubRoot.initPromoteCharacterFortifyMaterialSelectSubRoot(t,e.filterTypes)},closePromoteCharacterFortifyMaterialSelectSubRoot:function(t,e){cc.log("closePromoteCharacterFortifyMaterialSelectSubRoot"),cc.log(e),t.promoteCharacterFortifyMaterialSelectSubRoot&&(t.promoteCharacterFortifyMaterialSelectSubRoot.node.destroy(),t.promoteCharacterFortifyMaterialSelectSubRoot=null)},openPromoteCharacterExceedLimitMaterialSelectSubRoot:function(t,e){cc.log("openPromoteCharacterExceedLimitMaterialSelectSubRoot"),cc.log(e),t.promoteCharacterExceedLimitMaterialSelectSubRoot||(t.promoteCharacterExceedLimitMaterialSelectSubRoot=cc.instantiate(t.promoteCharacterExceedLimitMaterialSelectSubRootPrefab).getComponent("PromoteCharacterExceedLimitMaterialSelectSubRoot"),t.subRootParent.addChild(t.promoteCharacterExceedLimitMaterialSelectSubRoot.node)),t.promoteCharacterExceedLimitMaterialSelectSubRoot.initPromoteCharacterExceedLimitMaterialSelectSubRoot(t)},closePromoteCharacterExceedLimitMaterialSelectSubRoot:function(t,e){cc.log("closePromoteCharacterExceedLimitMaterialSelectSubRoot"),cc.log(e),t.promoteCharacterExceedLimitMaterialSelectSubRoot&&(t.promoteCharacterExceedLimitMaterialSelectSubRoot.node.destroy(),t.promoteCharacterExceedLimitMaterialSelectSubRoot=null)},openPromoteCharacterSkillFortifyMaterialSelectSubRoot:function(t,e){cc.log("openPromoteCharacterSkillFortifyMaterialSelectSubRoot"),cc.log(e),t.promoteCharacterSkillFortifyMaterialSelectSubRoot||(t.promoteCharacterSkillFortifyMaterialSelectSubRoot=cc.instantiate(t.promoteCharacterSkillFortifyMaterialSelectSubRootPrefab).getComponent("PromoteCharacterSkillFortifyMaterialSelectSubRoot"),t.subRootParent.addChild(t.promoteCharacterSkillFortifyMaterialSelectSubRoot.node)),t.promoteCharacterSkillFortifyMaterialSelectSubRoot.initPromoteCharacterSkillFortifyMaterialSelectSubRoot(t)},closePromoteCharacterSkillFortifyMaterialSelectSubRoot:function(t,e){cc.log("closePromoteCharacterSkillFortifyMaterialSelectSubRoot"),cc.log(e),t.promoteCharacterSkillFortifyMaterialSelectSubRoot&&(t.promoteCharacterSkillFortifyMaterialSelectSubRoot.node.destroy(),t.promoteCharacterSkillFortifyMaterialSelectSubRoot=null)}},cc._RF.pop()},{CharacterConst:"CharacterConst",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",Singleton:"Singleton"}],PromoteCharacterDetailRoot:[function(t,e,i){"use strict";cc._RF.push(e,"8e5c7vXfWpEErMS1Rvwjq71","PromoteCharacterDetailRoot");var a=t("Singleton"),n=t("CharacterUtils"),o=t("CharacterAbilityUtils"),r=t("PopupUtils"),s=t("CharacterSkillUtils"),c=t("ItemUtils"),l=t("AnimationUtils"),u=t("ResourceUtils"),h=t("UnlockEffectUtils"),d=t("PromoteCharacterRootBase"),p=t("PromoteCharacterDetailViewSetting"),m=t("GameConst"),g=t("StaticResourceConst"),C=t("ResourceConst"),f=t("CharacterConst"),E=t("WarehouseConst");cc.Class({extends:d,properties:{promoteCharacterDetailSubRootPrefab:cc.Prefab,promoteCharacterEquipmentSelectSubRootPrefab:cc.Prefab,promoteCharacterFortifyMaterialSelectSubRootPrefab:cc.Prefab,promoteCharacterExceedLimitMaterialSelectSubRootPrefab:cc.Prefab,promoteCharacterSkillFortifyMaterialSelectSubRootPrefab:cc.Prefab,promoteCharacterFortifyConfirmPopupPrefab:cc.Prefab,promoteCharacterFortifyAlertPopupPrefab:cc.Prefab,promoteCharacterFortifyCompletePopupPrefab:cc.Prefab,promoteCharacterExceedLimitConfirmPopupPrefab:cc.Prefab,promoteCharacterExceedLimitCompletePopupPrefab:cc.Prefab,promoteCharacterExceedLimitAlertPopupPrefab:cc.Prefab,promoteCharacterSkillFortifyConfirmPopupPrefab:cc.Prefab,promoteCharacterSkillFortifyCompletePopupPrefab:cc.Prefab,promoteCharacterSkillFortifyAlertPopupPrefab:cc.Prefab,promoteCharacterSkillFortifyRateOverAlertPopupPrefab:cc.Prefab,promoteCharacterAbilityFortifyConfirmPopupPrefab:cc.Prefab,promoteCharacterAbilityFortifyCompletePopupPrefab:cc.Prefab,characterSkillAbilitySimplePopupPrefab:cc.Prefab,promoteCharacterMaterialItmDetailPopupPrefab:cc.Prefab,questSearchPopupPrefab:cc.Prefab},_currentTab:0,materialCharacterType:0,materialDataType:0,_materialCharacterModelArray:null,_warehouseSelectMaterialCountInfoArray:null,_warehouseSelectCharacterCountInfoArray:null,_promoteCharacterFortifyConfirmPopup:null,_promoteCharacterFortifyCompletePopup:null,_promoteCharacterFortifyAlertPopup:null,_promoteCharacterExceedLimitConfirmPopup:null,_promoteCharacterExceedLimitCompletePopup:null,_promoteCharacterExceedLimitAlertPopup:null,_promoteCharacterSkillFortifyConfirmPopup:null,_promoteCharacterSkillFortifyCompletePopup:null,_promoteCharacterSkillFortifyAlertPopup:null,_promoteCharacterSkillFortifyRateAlertPopup:null,_promoteCharacterAbilityFortifyConfirmPopup:null,_promoteCharacterAbilityFortifyCompletePopup:null,_skillAbilitySimplePopup:null,_promoteCharacterMaterialItemDetailPopup:null,_questSearchPopup:null,_promoteCharacterEquipmentSelectPopup:null,_promoteCharacterEquipmentSwapPopup:null,_modalayer:null,initData:function(){if(this._super(),this.sceneParam){var t=JSON.parse(this.sceneParam),e=t[Object.keys(t)[0]];this._initPromoteCharacterDetailRootData(e)}this.materialCharacterType=f.CHARACTER_TYPE.NORMAL,this.materialDataType=f.MATERIAL_DATA_TYPE.CHARACTER,this._materialCharacterModelArray=[],this._warehouseSelectMaterialCountInfoArray=[],this._warehouseSelectCharacterCountInfoArray=[]},_initPromoteCharacterDetailRootData:function(t){t.targetCharacterCd&&this.setCurrentCharacterCd(t.targetCharacterCd)},initResource:function(){this._super(),this.requestRes(C.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_FORTIFY,cc.Prefab),this.requestRes(C.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_BASE,cc.Prefab),this.requestRes(C.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_CHARACTER_WAREHOUSE,cc.Prefab)},initialize:function(){this.initOutGameRootBase();this._initOpenFirstView({PromoteCharacterDetailSubRoot:{}})},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,p.PROMOTECHARACTERDETAIL_SETTING)},reload:function(){this._super(),this.resetSelectMaterials()},redraw:function(){this.promoteCharacterDetailSubRoot&&this.promoteCharacterDetailSubRoot.redrawPromoteCharacterDetailSubRoot(),this.promoteCharacterFortifyMaterialSelectSubRoot&&this.promoteCharacterFortifyMaterialSelectSubRoot.initPromoteCharacterFortifyMaterialSelectSubRoot(this),this.promoteCharacterExceedLimitMaterialSelectSubRoot&&this.promoteCharacterExceedLimitMaterialSelectSubRoot.initPromoteCharacterExceedLimitMaterialSelectSubRoot(this),this.promoteCharacterSkillFortifyMaterialSelectSubRoot&&this.promoteCharacterSkillFortifyMaterialSelectSubRoot.initPromoteCharacterSkillFortifyMaterialSelectSubRoot(this),this.redrawUIHeader(),this._modalayer&&(this._modalayer.destroy(),this._modalayer=null)},createPreViewParam:function(){var t={};return this.promoteCharacterDetailSubRoot&&(t.PromoteCharacterDetailSubRoot={targetCharacterCd:this.getCurrentCharacterCd(),topTabIndex:this.getCurrentTab()}),this.promoteCharacterFortifyMaterialSelectSubRoot&&(t.PromoteCharacterFortifyMaterialSelectSubRoot={targetCharacterCd:this.getCurrentCharacterCd()}),this.promoteCharacterExceedLimitMaterialSelectSubRoot&&(this.PromoteCharacterExceedLimitMaterialSelectSubRoot={targetCharacterCd:this.getCurrentCharacterCd()}),this.promoteCharacterSkillFortifyMaterialSelectSubRoot&&(this.PromoteCharacterSkillFortifyMaterialSelectSubRoot={targetCharacterCd:this.getCurrentCharacterCd()}),t},pushPromoteCharacterEquipmentSelectSubRoot:function(t){var e="";t.equipmentModel&&(e=t.equipmentModel.getEquipmentCd());var i={PromoteCharacterEquipmentSelectSubRoot:{characterCd:t.characterModel.getCharacterCd(),frameName:t.frameName,equipmentType:t.equipmentType,position:t.position,needExceedLimit:t.needExceedLimit,isReleased:t.isReleased,equipmentCd:e}},a={PromoteCharacterDetailSubRoot:{targetCharacterCd:this.getCurrentCharacterCd(),topTabIndex:0}};this.pushScene("PromoteCharacterDetailScene","PromoteCharacterDetailScene",i,a)},pushPromoteCharacterMaterialSelectSubRoot:function(t){var e={PromoteCharacterMaterialSelectSubRoot:{promoteType:t}},i={PromoteCharacterDetailSubRoot:{targetCharacterCd:this.getCurrentCharacterCd(),topTabIndex:t}};this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),e,i)},pushPromoteCharacterFortifyMaterialSelectSubRoot:function(t,e){cc.log("\u5f37\u5316\u7d20\u6750\u9078\u629e\u753b\u9762\u3092\u958b\u304f");var i={PromoteCharacterFortifyMaterialSelectSubRoot:{filterTypes:t}},a={PromoteCharacterDetailSubRoot:{targetCharacterCd:this.getCurrentCharacterCd(),topTabIndex:this.getCurrentTab(),secondTabIndex:e}};this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),i,a)},pushPromoteCharacterExceedLimitMaterialSelectSubRoot:function(t){cc.log("\u9650\u754c\u7a81\u7834\u7d20\u6750\u9078\u629e\u753b\u9762\u3092\u958b\u304f");var e={PromoteCharacterDetailSubRoot:{targetCharacterCd:this.getCurrentCharacterCd(),topTabIndex:this.getCurrentTab(),secondTabIndex:t}};this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),{PromoteCharacterExceedLimitMaterialSelectSubRoot:{}},e)},pushPromoteCharacterSkillFortifyMaterialSelectSubRoot:function(){cc.log("\u5f37\u5316\u7d20\u6750\u9078\u629e\u753b\u9762\u3092\u958b\u304f");var t={PromoteCharacterDetailSubRoot:{targetCharacterCd:this.getCurrentCharacterCd(),topTabIndex:this.getCurrentTab()}};this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),{PromoteCharacterSkillFortifyMaterialSelectSubRoot:{}},t)},openPromoteCharacterFortifyConfirmPopup:function(t){this.closePromoteCharacterFortifyConfirmPopup(),this._promoteCharacterFortifyConfirmPopup=cc.instantiate(this.promoteCharacterFortifyConfirmPopupPrefab).getComponent("PromoteCharacterFortifyConfirmPopup"),this._promoteCharacterFortifyConfirmPopup.openPromoteCharacterFortifyConfirmPopup(this.getCurrentCharacterModel(),t,function(){n.isCharacterExceedLimitMaterialAlert(t)?(this.closePromoteCharacterFortifyConfirmPopup(),this.openCharacterFortifyAlertPopup(t)):this.requestCharacterFortify(this.getCurrentCharacterModel(),t)}.bind(this))},closePromoteCharacterFortifyConfirmPopup:function(){this._promoteCharacterFortifyConfirmPopup&&(this._promoteCharacterFortifyConfirmPopup.close(),this._promoteCharacterFortifyConfirmPopup=null)},openCharacterFortifyCompletePopup:function(t,e,i){this.closeCharacterFortifyCompletePopup(),this._promoteCharacterFortifyCompletePopup=cc.instantiate(this.promoteCharacterFortifyCompletePopupPrefab).getComponent("PromoteCharacterFortifyCompletePopup");var a=this._promoteCharacterFortifyCompletePopup.openPromoteCharacterFortifyPopup.bind(this._promoteCharacterFortifyCompletePopup,t,e,i,this.redraw.bind(this));i?l.playResultRibbonAnimation(m.RESULT_RIBBON_ANIM_IDX.FORTIFY_GREAT,a):l.playResultRibbonAnimation(m.RESULT_RIBBON_ANIM_IDX.FORTIFY_NORMAL,a)},closeCharacterFortifyCompletePopup:function(){this._promoteCharacterFortifyCompletePopup&&(this._promoteCharacterFortifyCompletePopup.close(),this._promoteCharacterFortifyCompletePopup=null)},openCharacterFortifyAlertPopup:function(t){this.closeCharacterFortifyAlertPopup(),this._promoteCharacterFortifyAlertPopup=cc.instantiate(this.promoteCharacterFortifyAlertPopupPrefab).getComponent("PromoteCharacterAlertPopup"),this._promoteCharacterFortifyAlertPopup.openPromoteCharacterAlertPopup(t,function(){this.requestCharacterFortify(this.getCurrentCharacterModel(),t)}.bind(this))},closeCharacterFortifyAlertPopup:function(){this._promoteCharacterFortifyAlertPopup&&(this._promoteCharacterFortifyAlertPopup.close(),this._promoteCharacterFortifyAlertPopup=null)},openCharacterExceedLimitConfirmPopup:function(t,e,i,a){this.closeCharacterExceedLimitConfirmPopup(),this._promoteCharacterExceedLimitConfirmPopup=cc.instantiate(this.promoteCharacterExceedLimitConfirmPopupPrefab).getComponent("PromoteCharacterExceedLimitConfirmPopup"),this._promoteCharacterExceedLimitConfirmPopup.openPromoteCharacterExceedLimitConfirmPopup(this.getCurrentCharacterModel(),i,t,e,function(){switch(i){case f.EXCEED_LIMIT_MATERIAL_TYPE.CHARACTER:n.isCharacterExceedLimitMaterialAlert(a)?(this.closeCharacterExceedLimitConfirmPopup(),this.openCharacterExceedLimitAlertPopup(a)):this.requestCharacterExceedLimit(a);break;case f.EXCEED_LIMIT_MATERIAL_TYPE.ITEM:this.requestCharacterExceedLimitByItem()}}.bind(this))},closeCharacterExceedLimitConfirmPopup:function(){this._promoteCharacterExceedLimitConfirmPopup&&(this._promoteCharacterExceedLimitConfirmPopup.close(),this._promoteCharacterExceedLimitConfirmPopup=null)},openCharacterExceedLimitCompletePopup:function(t,e){this.closeCharacterExceedLimitCompletePopup(),this._promoteCharacterExceedLimitCompletePopup=cc.instantiate(this.promoteCharacterExceedLimitCompletePopupPrefab).getComponent("PromoteCharacterExceedLimitCompletePopup"),l.playResultRibbonAnimation(m.RESULT_RIBBON_ANIM_IDX.EXCEED_CHARACTER,this._promoteCharacterExceedLimitCompletePopup.openPromoteCharacterExceedLimitCompletePopup.bind(this._promoteCharacterExceedLimitCompletePopup,t,e,this.redraw.bind(this)))},closeCharacterExceedLimitCompletePopup:function(){this._promoteCharacterExceedLimitCompletePopup&&(this._promoteCharacterExceedLimitCompletePopup.close(),this._promoteCharacterExceedLimitCompletePopup=null)},openCharacterExceedLimitAlertPopup:function(t){this.closeCharacterExceedLimitAlertPopup(),this._promoteCharacterExceedLimitAlertPopup=cc.instantiate(this.promoteCharacterExceedLimitAlertPopupPrefab).getComponent("PromoteCharacterAlertPopup"),this._promoteCharacterExceedLimitAlertPopup.openPromoteCharacterAlertPopup(t,function(){this.requestCharacterExceedLimit(t)}.bind(this))},closeCharacterExceedLimitAlertPopup:function(){this._promoteCharacterExceedLimitAlertPopup&&(this._promoteCharacterExceedLimitAlertPopup.close(),this._promoteCharacterExceedLimitAlertPopup=null)},openPromoteCharacterSkillFortifyConfirmPopup:function(t,e){this.closePromoteCharacterAbilityfortifyConfirmPopup(),this._promoteCharacterSkillFortifyConfirmPopup=cc.instantiate(this.promoteCharacterSkillFortifyConfirmPopupPrefab).getComponent("PromoteCharacterSkillFortifyConfirmPopup"),this._promoteCharacterSkillFortifyConfirmPopup.openPromoteCharacterSkillFortifyConfirmPopup(this.getCurrentCharacterModel(),t,this.getCurrentCharacterModel().getNextCharacterSkillInfo(),e,function(){n.isCharacterExceedLimitMaterialAlert(e)?this.openPromoteCharacterSkillFortifyAlertPopup(t,e):s.calcTotalSkillUpRate(e,this.getCurrentCharacterModel().getCharacterSkillInfo(),this.getCurrentCharacterModel())>f.SKILL_FORTIFY_MAX_RATE?this.openPromoteCharacterSkillFortifyRateOverAlertPopup(t,e):this.requestSkillFortify(t,e)}.bind(this))},closePromoteCharacterSkillFortifyConfirmPopup:function(){this._promoteCharacterSkillFortifyConfirmPopup&&(this._promoteCharacterSkillFortifyConfirmPopup.close(),this._promoteCharacterSkillFortifyConfirmPopup=null)},openPromoteCharacterSkillFortifyCompletePopup:function(t,e){this.closePromoteCharacterSkillFortifyCompletePopup(),this._promoteCharacterSkillFortifyCompletePopup=cc.instantiate(this.promoteCharacterSkillFortifyCompletePopupPrefab).getComponent("PromoteCharacterSkillFortifyCompletePopup");var i=this._promoteCharacterSkillFortifyCompletePopup.openPromoteCharacterSkillFortifyCompletePopup.bind(this._promoteCharacterSkillFortifyCompletePopup,this.getCurrentCharacterModel(),t,e,function(){e.skillLevel===e.maxSkillLevel?this.popScene():this.redraw()}.bind(this));t.skillLevel<e.skillLevel?l.playResultRibbonAnimation(m.RESULT_RIBBON_ANIM_IDX.FORTIFY_NORMAL,i):(a.soundManager.playSE(u.getResource(g.SE.FAILURE)),l.playResultRibbonAnimation(m.RESULT_RIBBON_ANIM_IDX.FORTIFY_FAILURE,i))},closePromoteCharacterSkillFortifyCompletePopup:function(){this._promoteCharacterSkillFortifyCompletePopup&&(this._promoteCharacterSkillFortifyCompletePopup.close(),this._promoteCharacterSkillFortifyCompletePopup=null)},openPromoteCharacterSkillFortifyAlertPopup:function(t,e){this.closePromoteCharacterSkillFortifyAlertPopup(),this._promoteCharacterSkillFortifyAlertPopup=cc.instantiate(this.promoteCharacterSkillFortifyAlertPopupPrefab).getComponent("PromoteCharacterAlertPopup"),this._promoteCharacterSkillFortifyAlertPopup.openPromoteCharacterAlertPopup(e,function(){s.calcTotalSkillUpRate(e,this.getCurrentCharacterModel().getCharacterSkillInfo(),this.getCurrentCharacterModel())>f.SKILL_FORTIFY_MAX_RATE?this.openPromoteCharacterSkillFortifyRateOverAlertPopup(t,e):this.requestSkillFortify(t,e)}.bind(this))},closePromoteCharacterSkillFortifyAlertPopup:function(){this._promoteCharacterSkillFortifyConfirmPopup&&(this._promoteCharacterSkillFortifyConfirmPopup.close(),this._promoteCharacterSkillFortifyConfirmPopup=null)},openPromoteCharacterSkillFortifyRateOverAlertPopup:function(t,e){this.closePromoteCharacterSkillFortifyRateOverAlertPopup(),this._promoteCharacterSkillFortifyRateAlertPopup=cc.instantiate(this.promoteCharacterSkillFortifyRateOverAlertPopupPrefab).getComponent("AlertPopup"),this._promoteCharacterSkillFortifyRateAlertPopup.openAlertPopup("\u30fb\u30b9\u30ad\u30ebLv\u30a2\u30c3\u30d7\u78ba\u7387\u304c100%\u3092\u4e0a\u56de\u3063\u3066\u3044\u308b","\u4e0a\u8a18\u3044\u305a\u308c\u304b\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3057\u3066\u3044\u307e\u3059\u304c\n\u672c\u5f53\u306b\u5f37\u5316\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","\u30b9\u30ad\u30eb\u5f37\u5316\u3059\u308b",function(){this.requestSkillFortify(t,e)}.bind(this))},closePromoteCharacterSkillFortifyRateOverAlertPopup:function(){this._promoteCharacterSkillFortifyRateAlertPopup&&(this._promoteCharacterSkillFortifyRateAlertPopup.close(),this._promoteCharacterSkillFortifyRateAlertPopup=null)},openPromoteCharacterAbilityfortifyConfirmPopup:function(t,e){this.closePromoteCharacterAbilityfortifyConfirmPopup(),this._promoteCharacterAbilityFortifyConfirmPopup=cc.instantiate(this.promoteCharacterAbilityFortifyConfirmPopupPrefab).getComponent("PromoteCharacterAbilityFortifyConfirmPopup"),this._promoteCharacterAbilityFortifyConfirmPopup.openPromoteCharacterAbilityFortifyConfirmPopup(t,e,function(){this.requestAbilityFortiry(this.getCurrentCharacterCd(),t)}.bind(this))},closePromoteCharacterAbilityfortifyConfirmPopup:function(){this._promoteCharacterAbilityFortifyConfirmPopup&&(this._promoteCharacterAbilityFortifyConfirmPopup.close(),this._promoteCharacterAbilityFortifyConfirmPopup=null)},openPromoteCharacterAbilityfortifyCompletePopup:function(t,e){this.closePromoteCharacterAbilityfortifyCompletePopup(),this._modalayer=this.createModalLayer(),this.subRootParent.addChild(this._modalayer),this._promoteCharacterAbilityFortifyCompletePopup=cc.instantiate(this.promoteCharacterAbilityFortifyCompletePopupPrefab).getComponent("PromoteCharacterAbilityFortifyCompletePopup"),l.playResultRibbonAnimation(m.RESULT_RIBBON_ANIM_IDX.FORTIFY_NORMAL,this._promoteCharacterAbilityFortifyCompletePopup.openPromoteCharacterAbilityFortifyCompletePopup.bind(this._promoteCharacterAbilityFortifyCompletePopup,this.getCurrentCharacterModel(),t,e,this.redraw.bind(this)))},createModalLayer:function(){var t=new cc.Node;return t.setContentSize(1280,720),t.zIndex=255,t.active=!0,t.on("touchstart",function(t){t.stopPropagation()}),t.on("touchend",function(t){t.stopPropagation()}),t},closePromoteCharacterAbilityfortifyCompletePopup:function(){this._promoteCharacterAbilityFortifyCompletePopup&&(this._promoteCharacterAbilityFortifyCompletePopup.close(),this._promoteCharacterAbilityFortifyCompletePopup=null)},openSkillSimplePopup:function(t,e,i){this.closeSkillAbilitySimplePopup(),this._skillAbilitySimplePopup=cc.instantiate(this.characterSkillAbilitySimplePopupPrefab).getComponent("SkillAbilitySimplePopup"),this._skillAbilitySimplePopup.openSkillSimplePopup(t,e,i)},openAbilitySimplePopup:function(t,e,i){this.closeSkillAbilitySimplePopup(),this._skillAbilitySimplePopup=cc.instantiate(this.characterSkillAbilitySimplePopupPrefab).getComponent("SkillAbilitySimplePopup"),this._skillAbilitySimplePopup.openAbilitySimplePopup(t,e,i)},closeSkillAbilitySimplePopup:function(){this._skillAbilitySimplePopup&&(this._skillAbilitySimplePopup.close(),this._skillAbilitySimplePopup=null)},openPromoteCharacterMaterialItemDetailPopup:function(t){this.closePromoteCharacterMaterialItemDetailPopup(),this._promoteCharacterMaterialItemDetailPopup=cc.instantiate(this.promoteCharacterMaterialItmDetailPopupPrefab).getComponent("PromoteCharacterMaterialItemDetailPopup"),this._promoteCharacterMaterialItemDetailPopup.openPromoteCharacterMaterialItemDetailPopup(t)},closePromoteCharacterMaterialItemDetailPopup:function(){this._promoteCharacterMaterialItemDetailPopup&&(this._promoteCharacterMaterialItemDetailPopup.close(),this._promoteCharacterMaterialItemDetailPopup=null)},openQuestSearchPopup:function(t,e){this.closeQuestSearchPopup(),this._questSearchPopup=cc.instantiate(this.questSearchPopupPrefab).getComponent("WarehouseQuestSearchPopup"),this._questSearchPopup.openWarehouseQuestSearchPopup(t.getItemId(),t.getItemType(),t.getName(),t.getText(),e,this.transitionQuestScene.bind(this))},closeQuestSearchPopup:function(){this._promoteCharacterMaterialItemDetailPopup&&(this._promoteCharacterMaterialItemDetailPopup.close(),this._promoteCharacterMaterialItemDetailPopup=null)},transitionRoomCharacterScene:function(t,e){var i={RoomCardDetailSubRoot:{characterGroupId:t,characterId:e,topTabIdx:1,isDisplayRoom:!1}},a=this.createPreViewParam();this.pushScene("RoomCharacterScene",this.getCurrentSceneName(),i,a)},transitionQuestScene:function(t){var e={BattleStartConfirmSubRoot:{stageId:t}},i=this.createPreViewParam();this.pushScene("QuestScene",this.getCurrentSceneName(),e,i)},requestChangePartner:function(t,e){a.CharacterService.changePartner([t],0,function(){e&&e()})},requestCharacterFortify:function(t,e,i){switch(this.materialDataType){case f.MATERIAL_DATA_TYPE.WAREHOUSE:var a;switch(this.materialCharacterType){case f.CHARACTER_TYPE.NORMAL:a=E.WAREHOUSE_STORAGE_TYPE.CHARACTER;break;case f.CHARACTER_TYPE.FORTIFY:a=E.WAREHOUSE_STORAGE_TYPE.MATERIAL}this._requestCharacterFortifyWarehouse(t,this.getMaterialSelectCountInfoArray(),a,e,i);break;default:this._requestCharacterFortifyNormal(t,e,i)}},_requestCharacterFortifyNormal:function(t,e,i){var o=this._createParameterForMaterials(e),s=n.calcTotalMaterialPlice(t,o.length);c.getUserItemCount(m.ITEM_ID_GOLD)>=s?a.CharacterService.fortify(t.getCharacterCd(),o,function(e){this.reload(),this.openCharacterFortifyCompletePopup(t,n.getCharacterModelByCharacterCd(t.getCharacterCd()),e.isGreatSuccess),i&&i()}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},_requestCharacterFortifyWarehouse:function(t,e,i,o,s){var l=this._createParameterForWarehouseMaterials(e,i),u=n.calcTotalMaterialPlice(t,o.length);c.getUserItemCount(m.ITEM_ID_GOLD)>=u?a.CharacterService.fortifyWarehouse(t.getCharacterCd(),l,i,function(e){this.reload(),this.openCharacterFortifyCompletePopup(t,n.getCharacterModelByCharacterCd(t.getCharacterCd()),e.isGreatSuccess),s&&s()}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},requestCharacterExceedLimit:function(t){switch(this.materialDataType){case f.MATERIAL_DATA_TYPE.CHARACTER:this._requestCharacterExceedLimitNormal(t);break;case f.MATERIAL_DATA_TYPE.WAREHOUSE:this._requestCharacterExceedLimitWarehouse(t)}},_requestCharacterExceedLimitNormal:function(t){var e=this.getCurrentCharacterModel(),i=this._createParameterForMaterials(t),o=n.calcExceedLimitPrice(e.getExceedLimitType(),e.getExceedLimit(),e.getExceedLimit()+i.length);c.getUserItemCount(m.ITEM_ID_GOLD)>=o?a.CharacterService.exceedLimit(e.getCharacterCd(),i,function(){this.reload(),h.saveUnlockEffectForCharacterEquipment(e,this.getCurrentCharacterModel()),this.openCharacterExceedLimitCompletePopup(e,this.getCurrentCharacterModel())}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},_requestCharacterExceedLimitWarehouse:function(t){var e=this.getCurrentCharacterModel(),i=this._createParameterForWarehouseMaterials(this.getMaterialSelectCountInfoArray(),E.WAREHOUSE_STORAGE_TYPE.CHARACTER),o=n.calcExceedLimitPrice(e.getExceedLimitType(),e.getExceedLimit(),e.getExceedLimit()+i.length);c.getUserItemCount(m.ITEM_ID_GOLD)>=o?a.CharacterService.exceedLimitWarehouse(e.getCharacterCd(),i,function(){this.reload(),h.saveUnlockEffectForCharacterEquipment(e,this.getCurrentCharacterModel()),this.openCharacterExceedLimitCompletePopup(e,this.getCurrentCharacterModel())}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},requestCharacterExceedLimitByItem:function(){var t=this.getCurrentCharacterModel(),e=n.calcExceedLimitPrice(t.getExceedLimitType(),t.getExceedLimit(),t.getExceedLimit()+1);c.getUserItemCount(m.ITEM_ID_GOLD)>=e?a.CharacterService.exceedLimitByItem(this.getCurrentCharacterCd(),function(){this.reload(),h.saveUnlockEffectForCharacterEquipment(t,this.getCurrentCharacterModel()),this.openCharacterExceedLimitCompletePopup(t,this.getCurrentCharacterModel())}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},_createParameterForMaterials:function(t){var e=[];for(var i in t){var a=t[i].getCharacterCd();e.push(a)}return e},_createParameterForWarehouseMaterials:function(t,e){switch(e){case E.WAREHOUSE_STORAGE_TYPE.CHARACTER:return _.map(t,function(t){return{code:t.model.getCharacterCd(),count:t.count}});case E.WAREHOUSE_STORAGE_TYPE.MATERIAL:return _.map(t,function(t){return{code:t.model.getMaterialCd(),count:t.count}})}},_createParameterForMaterialWarehouseTypeParameter:function(t){return _.map(t,function(t){var e="",i=0;return t.model.getCharacterCd?(e=t.model.getCharacterCd(),i=t.model.getWarehouseType()):t.model.getMaterialCd&&(e=t.model.getMaterialCd(),i=t.model.getWarehouseType()),{code:e,count:t.count,warehouseType:i}})},requestSkillFortify:function(t,e){switch(this.materialDataType){case f.MATERIAL_DATA_TYPE.CHARACTER:this._requestSkillFortifyNormal(t,e);break;case f.MATERIAL_DATA_TYPE.WAREHOUSE:this._requestSkillFortifyWarehouse(t,e)}},_requestSkillFortifyNormal:function(t,e){var i=s.calcSkillFortifyPrice(e,t,this.getCurrentCharacterModel());c.getUserItemCount(m.ITEM_ID_GOLD)>=i?a.CharacterService.fortifySkill(this.getCurrentCharacterCd(),this._createParameterForMaterials(e),function(e){this.reload(),this.openPromoteCharacterSkillFortifyCompletePopup(t,this.getCurrentCharacterModel().getCharacterSkillInfo())}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},_requestSkillFortifyWarehouse:function(t,e){var i=s.calcSkillFortifyPrice(e,t,this.getCurrentCharacterModel());c.getUserItemCount(m.ITEM_ID_GOLD)>=i?a.CharacterService.fortifySkillWarehouse(this.getCurrentCharacterCd(),this._createParameterForMaterialWarehouseTypeParameter(this.getMaterialSelectCountInfoArray()),function(e){this.reload(),this.openPromoteCharacterSkillFortifyCompletePopup(t,this.getCurrentCharacterModel().getCharacterSkillInfo())}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},requestAbilityFortiry:function(t,e){var i=o.calcAbilityFortifyPrice(e.abilityMainMaster.getAbilityFortifyType(),e.abilityLevel,e.rarity);c.getUserItemCount(m.ITEM_ID_GOLD)>=i?a.CharacterService.fortifyAbility(t,e.abilityIndex,function(){this.reload();var t=this.getCurrentCharacterModel().getCharacterAbilityInfoArray().find(function(t){return t.abilityIndex===e.abilityIndex});this.openPromoteCharacterAbilityfortifyCompletePopup(e,t)}.bind(this)):r.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},requestFortifyEquipment:function(t,e){a.EquipmentService.fortify(t,function(){this.reload(),this.redraw(),e&&e()}.bind(this))},requestEquipmentProtect:function(t,e){a.EquipmentService.changeProtect([t.getEquipmentCd()],function(){this.reload(),e&&e()}.bind(this))},setCurrentTab:function(t){this._currentTab=t||0},getCurrentTab:function(){return this._currentTab},setMaterialCharacterModelArray:function(t){this._materialCharacterModelArray=t},getMaterialCharacterModelArray:function(){return this._materialCharacterModelArray},setMaterialSelectCountInfoArray:function(t){switch(this.materialCharacterType){case f.CHARACTER_TYPE.NORMAL:this._warehouseSelectMaterialCountInfoArray=[],this._warehouseSelectCharacterCountInfoArray=t;break;default:this._warehouseSelectCharacterCountInfoArray=[],this._warehouseSelectMaterialCountInfoArray=t}},getMaterialSelectCountInfoArray:function(){switch(this.materialCharacterType){case f.CHARACTER_TYPE.NORMAL:return this._warehouseSelectCharacterCountInfoArray;default:return this._warehouseSelectMaterialCountInfoArray}},resetSelectMaterials:function(){this.setMaterialCharacterModelArray([]),this.setMaterialSelectCountInfoArray([])},getMaterialModelArrayByFilterTypes:function(t){return _.filter(this.getMaterialCharacterModelArray(),function(e){return _.some(t,function(t){return e.getCharacterType()===t})})},getNextExceedLimitForTargetCharacter:function(){var t=this.getCurrentCharacterModel(),e=n.calcTotalMaterialExceedLimitExp(this.getMaterialCharacterModelArray(),t),i=t.getExceedLimitExp()+e;t.getExceedLimit();return n.getCharacterExceedLimitByTotalExceedLimitExp(i)},getNextCharacterMaxLevelForTargetCharacter:function(){var t=this.getNextExceedLimitForTargetCharacter();return this.getCurrentCharacterModel().getMaxLevelByExceedLimit(t)}});cc._RF.pop()},{AnimationUtils:"AnimationUtils",CharacterAbilityUtils:"CharacterAbilityUtils",CharacterConst:"CharacterConst",CharacterSkillUtils:"CharacterSkillUtils",CharacterUtils:"CharacterUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupUtils:"PopupUtils",PromoteCharacterDetailViewSetting:"PromoteCharacterDetailViewSetting",PromoteCharacterRootBase:"PromoteCharacterRootBase",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",UnlockEffectUtils:"UnlockEffectUtils",WarehouseConst:"WarehouseConst"}],PromoteCharacterDetailStatusAbilityListView:[function(t,e,i){"use strict";cc._RF.push(e,"f03a57vhEVK+6rDCQCwlSI6","PromoteCharacterDetailStatusAbilityListView");var a=t("PromoteCharacterDetailStatusAppendListViewBase"),n=t("CharacterAbilityUtils");cc.Class({extends:a,properties:{},_initListContent:function(){var t=[];for(var e in t=this._characterModel?this._characterModel.getCharacterAbilityInfoArray():n.createCharacterAbilityInfoArray(this._characterMainMaster.getAbilityGroupId(),this._characterMainMaster.getRarity(),0,this._characterMainMaster.getExceedLimitType(),null),this.content.destroyAllChildren(),t){var i=this._createThumbnailNode(this._root,t[e]);this.content.addChild(i)}},_createThumbnailNode:function(t,e){var i=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");return i.initPromoteCharacterDetailStatusAbilityThumbnail(e),i.node}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",PromoteCharacterDetailStatusAppendListViewBase:"PromoteCharacterDetailStatusAppendListViewBase"}],PromoteCharacterDetailStatusAbilityView:[function(t,e,i){"use strict";cc._RF.push(e,"caa2dAzBrVNgorfqMmzfIte","PromoteCharacterDetailStatusAbilityView");t("CommonButton"),t("CharacterAbilityUtils");var a=t("PromoteCharacterDetailStatusViewBase");cc.Class({extends:a,properties:{abilityThumbnailPrefab:cc.Prefab,nextAbilityThumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node},initPromoteCharacterDetailStatusView:function(t,e){this._super(t,e),this._initListContent()},_initListContent:function(){this.thumbnailParentNode.destroyAllChildren(),this._initListContentForAbility()},_initListContentForAbility:function(){var t=this._characterModel.getCharacterAbilityInfoArray();for(var e in t){var i;i=t[e].isReleased?this._createReleasedThumbnail(t[e]):this._createLockedThumbnail(t[e]),this.thumbnailParentNode.addChild(i)}},_createReleasedThumbnail:function(t){var e=cc.instantiate(this.abilityThumbnailPrefab).getComponent("PromoteCharacterAbilityFortifyThumbnail");return e.initPromoteCharacterAbilityFortifyThumbnail(t,this._onTapAbilityExecuteBtn.bind(this)),e.node},_createLockedThumbnail:function(t){var e=cc.instantiate(this.nextAbilityThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");return e.initPromoteCharacterDetailStatusAbilityThumbnail(t,!1,!0,!1,!0),e.node},_onTapAbilityExecuteBtn:function(t){this._root.openPromoteCharacterAbilityfortifyConfirmPopup(t,this._characterModel.getNextCharacterAbilityInfoByCharacterAbilityInfo(t))}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CommonButton:"CommonButton",PromoteCharacterDetailStatusViewBase:"PromoteCharacterDetailStatusViewBase"}],PromoteCharacterDetailStatusAppendListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"121af20YWhPUbs++c3VnPvt","PromoteCharacterDetailStatusAppendListViewBase");var a=t("WindowBase");cc.Class({extends:a,properties:{content:cc.Node,thumbnailPrefab:cc.Prefab},_root:null,_characterMainMaster:null,_characterModel:null,initPromoteCharacterDetailStatusAppendListView:function(t,e,i){this._root=t,this._characterMainMaster=e,this._characterModel=i,this._initListContent()},_initListContent:function(){}});cc._RF.pop()},{WindowBase:"WindowBase"}],PromoteCharacterDetailStatusAppendThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"01153qZoKBN7KgN5yZyIurM","PromoteCharacterDetailStatusAppendThumbnailBase");cc.Class({extends:cc.Component,properties:{appendNameLabel:cc.Label,needExceedLimitLabel:cc.Label,activateNode:cc.Node,inactivateNode:cc.Node,iconNodeArray:[cc.Node]},_initNodes:function(){},_initLabels:function(){},_resetThumbnailProperties:function(t){for(var e in this.appendNameLabel.string=t||"",this.needExceedLimitLabel.string="",this.activateNode.active=!1,this.inactivateNode.active=!1,this.iconNodeArray)this.iconNodeArray[e].active=!1},_setNeedExceedLimitLabelText:function(t){this.needExceedLimitLabel.string="\u9650\u754c\u7a81\u7834"+t+"\u6bb5\u968e\u76ee\u3067\n\u958b\u653e"}});cc._RF.pop()},{}],PromoteCharacterDetailStatusEquipmentLargeThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"556ccm1w9JGab02ffTosXpP","PromoteCharacterDetailStatusEquipmentLargeThumbnail");var a=t("CommonButton"),n=t("CommonUtils"),o=t("UnlockEffectUtils"),r=t("PromoteCharacterDetailStatusEquipmentThumbnail"),s=t("LocalDataConst"),c=t("UnlockEffectConst");cc.Class({extends:r,properties:{lockIconNode:cc.Node,infoBtn:a},initPromoteCharacterDetailStatusEquipmentThumbnail:function(t,e,i,a){this._super(t,e,i),this.infoBtn.setTapEvent(a.bind(this,t),"")},_initNodes:function(t){this.activateNode.active=!0;var e=c.TRIGGER_PREFIX_NAME.CHARACTER_EQUIPMENT+t.characterModel.getCharacterCd()+"_"+t.position;n.loadLocalStorage(e,!1,s.LOCAL_STORAGE_GET_TYPE.BOOLEAN)?(this.inactivateNode.active=!0,n.removeLocalStorage(e),o.playUnLockEffectAnimationWhite(this.lockIconNode,function(){this.inactivateNode.active=!1}.bind(this))):this.inactivateNode.active=!t.isReleased},_initLabels:function(t){t.equipmentModel?this.appendNameLabel.string=t.equipmentModel.getName():this._setNeedExceedLimitLabelText(t.needExceedLimit)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",PromoteCharacterDetailStatusEquipmentThumbnail:"PromoteCharacterDetailStatusEquipmentThumbnail",UnlockEffectConst:"UnlockEffectConst",UnlockEffectUtils:"UnlockEffectUtils"}],PromoteCharacterDetailStatusEquipmentListView:[function(t,e,i){"use strict";cc._RF.push(e,"52077aX8ABG14HEqqNSU9h9","PromoteCharacterDetailStatusEquipmentListView");t("PopupUtils");var a=t("PromoteCharacterDetailStatusAppendListViewBase");cc.Class({extends:a,properties:{},_initListContent:function(){var t=this._characterModel.getCharacterEquipmentInfoArray();for(var e in this.content.destroyAllChildren(),t){var i=this._createThumbnailNode(this._root,t[e],this._characterModel.getAttribute());this.content.addChild(i)}},_createThumbnailNode:function(t,e,i){var a=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterDetailStatusEquipmentLargeThumbnail");return a.initPromoteCharacterDetailStatusEquipmentThumbnail(e,i,this._onTapThumbnailBtn.bind(this),this._onTapInfoBtn.bind(this)),a.node},_onTapThumbnailBtn:function(t){this._root.pushPromoteCharacterEquipmentSelectSubRoot(t)},_onTapInfoBtn:function(t){t.equipmentModel&&this._root.openEquipmentDetailPopup(t.equipmentModel,t)}});cc._RF.pop()},{PopupUtils:"PopupUtils",PromoteCharacterDetailStatusAppendListViewBase:"PromoteCharacterDetailStatusAppendListViewBase"}],PromoteCharacterDetailStatusEquipmentThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"51fbbtKZRhMgLNe5srVv+u6","PromoteCharacterDetailStatusEquipmentThumbnail");t("ResourceUtils");var a=t("CommonUtils"),n=t("ItemConst"),o=(t("EquipmentSortConst"),t("StaticResourceConst"),t("PromoteCharacterDetailStatusAppendThumbnailBase")),r=t("BattleParameterView"),s=cc.Enum({WEAPON:0,PROTECTOR:1});cc.Class({extends:o,properties:{iconLabelArray:[cc.Label],matrixThumbnailPrefab:cc.Prefab,matrixThumbnailParentNode:cc.Node,battleParameterView:r,totalPowerLabel:cc.Label},_matrixThumbnail:null,initPromoteCharacterDetailStatusEquipmentThumbnail:function(t,e,i){this._resetThumbnailProperties(),this._initNodes(t),this._initLabels(t),this._initBattleParameter(t,e),this._initMatrixThumbnail(t,i)},_initNodes:function(t){switch(t.equipmentType){case n.EQUIPMENT_TYPE.ATK:this.iconNodeArray[s.WEAPON].active=!0;break;case n.EQUIPMENT_TYPE.DEF:this.iconNodeArray[s.PROTECTOR].active=!0}this.activateNode.active=!0,t.isReleased||(this.inactivateNode.active=!0)},_initLabels:function(t){switch(t.equipmentType){case n.EQUIPMENT_TYPE.ATK:this.iconLabelArray[s.WEAPON].string=t.frameName.replace(/\u67a0/g,"");break;case n.EQUIPMENT_TYPE.DEF:this.iconLabelArray[s.PROTECTOR].string=t.frameName.replace(/\u67a0/g,"")}t.equipmentModel?this.appendNameLabel.string=t.equipmentModel.getName():this._setNeedExceedLimitLabelText(t.needExceedLimit)},_initBattleParameter:function(t,e){if(t.equipmentModel){var i=[t],n=t.characterModel,o=n.getEquipmentStatus(i),r=n.getEquipmentEffect(n.getHp()+o.hp,n.getAtk()+o.atk,n.getDef()+o.def,i),s=o.hp+r.hp,c=o.atk+r.atk,l=o.def+r.def;this.totalPowerLabel.string=a.convertToCommaDelimited(s+c+l),this.battleParameterView.initBattleParameterView(s,c,l)}else this.totalPowerLabel.string="-",this.battleParameterView.resetBattleParameterView("-")},_initMatrixThumbnail:function(t,e){this._matrixThumbnail||(this._matrixThumbnail=cc.instantiate(this.matrixThumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.matrixThumbnailParentNode.addChild(this._matrixThumbnail.node),t.isReleased&&this._matrixThumbnail.setCallbackToThumbnailBtn(function(){e&&e(t)}));var i=this._matrixThumbnail.switchEmptyNodeActive.bind(this._matrixThumbnail);e&&(i=this._matrixThumbnail.switchPlusNodeActive.bind(this._matrixThumbnail)),t.equipmentModel?(this._matrixThumbnail.initEquipmentMatrixThumbnail(t.equipmentModel.getEquipmentId(),t.equipmentModel.getAttribute(),t.equipmentModel.getRarity(),t.equipmentModel),this._matrixThumbnail.setParameter("Lv.",t.equipmentModel.getLevel()),i(!1)):i(!0)},_resetThumbnailProperties:function(){this._super("\u88c5\u5099\u306a\u3057"),this.totalPowerLabel.string="",this.battleParameterView.initBattleParameterView("","","")}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonUtils:"CommonUtils",EquipmentSortConst:"EquipmentSortConst",ItemConst:"ItemConst",PromoteCharacterDetailStatusAppendThumbnailBase:"PromoteCharacterDetailStatusAppendThumbnailBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],PromoteCharacterDetailStatusFortifyLevelView:[function(t,e,i){"use strict";cc._RF.push(e,"12cc0ZkKqFKWYMayLCus00p","PromoteCharacterDetailStatusFortifyLevelView");t("GameConst");var a=t("CharacterUtils"),n=(t("ResourceUtils"),t("ViewUtils"));t("EquipmentUtils"),t("BattleParameterView"),cc.Class({extends:cc.Component,properties:{beforeLevelLabel:cc.Label,afterLevelLabel:cc.Label,maxLevelLabel:cc.Label,needExpNumLabel:cc.Label,beforeExpProgressBar:cc.ProgressBar,afterExpProgressBar:cc.ProgressBar},_targetModel:null,initPromoteCharacterDetailStatusFortifyLevelView:function(t){this._targetModel=t,this._drawBeforeLevel(t.getLevel()),this._drawAfterLevel(t.getLevel()),this._drawBeforeExpProgress(t),this._drawAfterExpProgress(t.getCharacterExp()),this._drawNeedExp(t.getCharacterExp()),this.maxLevelLabel.string=t.getMaxLevel()+""},drawPromoteCharacterDetailStatusFortifyLevelView:function(t){var e=this._targetModel.getCharacterExp()+a.calcTotalMaterialExp(t,this._targetModel),i=a.getCharacterLevelByTotalExp(e,this._targetModel.getCharacterMainMaster().getExpType());this._drawAfterLevel(i),this._drawAfterExpProgress(e,i),this._drawNeedExp(e)},_drawBeforeLevel:function(t){this.beforeLevelLabel&&(this.beforeLevelLabel.string=t+"")},_drawAfterLevel:function(t){this.afterLevelLabel.node.color=n.getParamChangeColor(this._targetModel.getLevel(),t),this.afterLevelLabel.string=t+""},_drawBeforeExpProgress:function(t){this.beforeExpProgressBar.progress=a.calcExpRateForNextLevelByTotalExp(t.getCharacterExp(),t.getCharacterMainMaster().getExpType())},_drawAfterExpProgress:function(t,e){e>this._targetModel.getLevel()?this.afterExpProgressBar.progress=1:this.afterExpProgressBar.progress=a.calcExpRateForNextLevelByTotalExp(t,this._targetModel.getCharacterMainMaster().getExpType())},_drawNeedExp:function(t){this.needExpNumLabel.string=a.calcNeedExpForNextLevelByTotalExp(t,this._targetModel.getCharacterMainMaster().getExpType())+""}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CharacterUtils:"CharacterUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterDetailStatusFortifyMaterialListView:[function(t,e,i){"use strict";cc._RF.push(e,"5af81yLWdBM1oGPnjarDtmy","PromoteCharacterDetailStatusFortifyMaterialListView");var a=t("ListViewBase"),n=t("CommonUtils"),o=t("CharacterUtils"),r=t("ResourceUtils"),s=t("GameConst"),c=t("StaticResourceConst");cc.Class({extends:a,properties:{expLabel:cc.Label,priceLabel:cc.Label},_materialArray:null,_filterTypes:null,_materialTab:null,initPromoteCharacterDetailStatusFortifyMaterialListView:function(t,e,i,a){this._materialArray=e||[],this._filterTypes=i||[],this._materialTab=a||0,this.resetListView(),this.initListView(t),this._setLabel()},getMaterialModelArray:function(){return this._materialArray},_setListContent:function(t){for(var e=0;e<s.FORTIFY_MAX_MATERIAL;e+=1)e<this._materialArray.length?this._addThumbnail(this.getMaterialModelArray()[e]):this._addThumbnail()},_addThumbnail:function(t){var e=cc.instantiate(r.getResource(c.CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("CharacterMatrixThumbnail");t?e.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),t.getLevel(),1):e.initAddingMatrixThumbnail(),e.setCallbackToThumbnailBtn(function(){this._callbackToThumbnail(t)}.bind(this)),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){this._root.pushPromoteCharacterFortifyMaterialSelectSubRoot(this._filterTypes,this._materialTab)},_setLabel:function(){this.priceLabel.string=n.convertToCommaDelimited(o.calcTotalMaterialPlice(this._root.getCurrentCharacterModel(),this.getMaterialModelArray().length)),this.expLabel.string=n.convertToCommaDelimited(o.calcTotalMaterialExp(this.getMaterialModelArray(),this._root.getCurrentCharacterModel()))}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",GameConst:"GameConst",ListViewBase:"ListViewBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],PromoteCharacterDetailStatusFortifyMaterialTabView:[function(t,e,i){"use strict";cc._RF.push(e,"1c879cQwIhPhbODmpINfnXF","PromoteCharacterDetailStatusFortifyMaterialTabView");var a=t("TabViewBase"),n=t("PromoteCharacterDetailStatusFortifyMaterialListView"),o=t("CharacterConst"),r=cc.Enum({MATERIAL:0,CHARACTER:1});cc.Class({extends:a,properties:{promoteCharacterDetailStatusFortifyMaterialListView:n},_root:null,_callbackToSwitchTab:null,initPromoteCharacterDetailStatusFortifyMaterialTabView:function(t,e,i){this._root=t,this._callbackToSwitchTab=i||this._callbackToSwitchTab,this.initTabViewBase(),this._setCurrentTab(e||0),this._activateTab(this.getCurrentTab())},getCurrentMaterialArray:function(){return this._root?this._root.getMaterialModelArrayByFilterTypes(this._getFilterTypesByCurrentTab(this.getCurrentTab())):[]},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this.promoteCharacterDetailStatusFortifyMaterialListView.initPromoteCharacterDetailStatusFortifyMaterialListView(this._root,this._root.getMaterialModelArrayByFilterTypes(this._getFilterTypesByCurrentTab(t)),this._getFilterTypesByCurrentTab(t),t),this._callbackToSwitchTab&&this.scheduleOnce(this._callbackToSwitchTab)},_getFilterTypesByCurrentTab:function(t){switch(t){case r.CHARACTER:return[o.CHARACTER_TYPE.NORMAL];case r.MATERIAL:return[o.CHARACTER_TYPE.FORTIFY,o.CHARACTER_TYPE.SKILL_UP,o.CHARACTER_TYPE.SELL]}return[]}});cc._RF.pop()},{CharacterConst:"CharacterConst",PromoteCharacterDetailStatusFortifyMaterialListView:"PromoteCharacterDetailStatusFortifyMaterialListView",TabViewBase:"TabViewBase"}],PromoteCharacterDetailStatusFortifyView:[function(t,e,i){"use strict";cc._RF.push(e,"dbb24u+FLFEsaBPuGpl9G3x","PromoteCharacterDetailStatusFortifyView");var a=t("CommonButton"),n=t("CommonUtils"),o=t("CharacterUtils"),r=t("ResourceUtils"),s=t("ItemUtils"),c=t("PromoteCharacterDetailStatusParamViewBase"),l=t("PromoteCharacterDetailStatusFortifyMaterialTabView"),u=t("CharacterConst"),h=t("ItemSourceConst"),d=t("StaticResourceConst");cc.Class({extends:c,properties:{inactiveTargetNodeArray:[cc.Node],sourceSearchBtn:a,resetBtn:a,executeBtn:a,materialTabView:l},_characterFortifyProgressView:null,onLoad:function(){this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.sourceSearchBtn.setTapEvent(this._onTapSourceSearchBtn.bind(this))},initPromoteCharacterDetailStatusView:function(t,e,i){this._super(t,e),this.materialTabView.initPromoteCharacterDetailStatusFortifyMaterialTabView(t,i,this._onSwitchTab.bind(this)),this._initButtons()},_onSwitchTab:function(){this._initButtons(),this._drawLevelProgress(),this._drawExceedLimitProgress(),this._drawCharacterParameter(),this._drawCharacterAddParameter()},_drawLevelProgress:function(){this._characterLevelProgressView.node.active=!0;var t=u.PROMOTE_TYPE.STATUS,e=this._characterModel.getLevel(),i=0,a=this._characterModel.getMaxLevel(),n=0,r=this._characterModel.getNeedExpForNextLevel(),s=this._characterModel.getExpRateForNextLevel(),c=0;if(this.materialTabView.getCurrentMaterialArray().length>0){t=u.PROMOTE_TYPE.FORTIFY;var l=this._characterModel.getCharacterExp()+o.calcTotalMaterialExp(this.materialTabView.getCurrentMaterialArray(),this._characterModel);r=0,(i=o.getCharacterLevelByTotalExp(l,this._characterModel.getCharacterMainMaster().getExpType()))!==this._characterModel.getMaxLevel()&&(r=o.calcNeedExpForNextLevelByTotalExp(l,this._characterModel.getCharacterMainMaster().getExpType())),n=0,c=i>this._characterModel.getLevel()?1:o.calcExpRateForNextLevelByTotalExp(l,this._characterModel.getCharacterMainMaster().getExpType())}this._characterLevelProgressView.initCharacterLevelProgressView(t,e,i,a,n,r,s,c)},_drawCharacterAddParameter:function(){if(this.equipmentTotalPowerLabel&&(this.inactiveTargetNodeArray.forEach(function(t){t.active=!1}),this.materialTabView.getCurrentMaterialArray().length>0)){this.inactiveTargetNodeArray.forEach(function(t){t.active=!0});var t=this._characterModel.getCharacterExp()+o.calcTotalMaterialExp(this.materialTabView.getCurrentMaterialArray(),this._characterModel),e=o.getCharacterLevelByTotalExp(t,this._characterModel.getCharacterMainMaster().getExpType());this.characterParameterView.node.active=!0,this.equipmentTotalPowerLabel.string=n.convertToCommaDelimited(this._characterModel.getTotalPower(e)),this.characterEquipmentParameterView.initBattleParameterView(this._characterModel.getTotalHp(e),this._characterModel.getTotalAtk(e),this._characterModel.getTotalDef(e))}},_initButtons:function(){this.materialTabView.getCurrentMaterialArray().length>0?(this.resetBtn.switchBtnImage(!0),this.executeBtn.switchBtnImage(!0),this.resetBtn.setTouchEnable(!0),this.executeBtn.setTouchEnable(!0)):(this.resetBtn.switchBtnImage(!1),this.executeBtn.switchBtnImage(!1),this.resetBtn.setTouchEnable(!1),this.executeBtn.setTouchEnable(!1))},_onTapSourceSearchBtn:function(){cc.instantiate(r.getResource(d.ITEM_SOURCE_LIST_POPUP_PREFAB_PATH)).getComponent("ItemSourceListPopup").openItemSourceListPopup(s.getItemMaster(h.SOURCE_ITEM_ID.CHARACTER_FORTIFY_MATERIAL),this._root.getCurrentSceneName(),this._root.sceneParam)},_onTapResetBtn:function(){this._root.resetSelectMaterials(),this._drawLevelProgress(),this._drawCharacterAddParameter(),this.materialTabView.initPromoteCharacterDetailStatusFortifyMaterialTabView(this._root,this.materialTabView.getCurrentTab()),this._initButtons()},_onTapExecuteBtn:function(){this._root.openPromoteCharacterFortifyConfirmPopup(this.materialTabView.getCurrentMaterialArray())},getTabIndex:function(){return this.materialTabView.getCurrentTab()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ItemSourceConst:"ItemSourceConst",ItemUtils:"ItemUtils",PromoteCharacterDetailStatusFortifyMaterialTabView:"PromoteCharacterDetailStatusFortifyMaterialTabView",PromoteCharacterDetailStatusParamViewBase:"PromoteCharacterDetailStatusParamViewBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],PromoteCharacterDetailStatusParamViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"8ca42gCEZJJIbUVK+tZccsi","PromoteCharacterDetailStatusParamViewBase");var a=t("CommonUtils"),n=t("PromoteCharacterDetailStatusViewBase"),o=(t("CharacterLevelProgressView"),t("CharacterExceedLimitProgressView"),t("BattleParameterView"));cc.Class({extends:n,properties:{characterLevelProgressViewPrefab:cc.Prefab,characterLevelProgressViewParentNode:cc.Node,characterExceedLimitProgressViewPrefab:cc.Prefab,characterExceedLimitProgressViewParentNode:cc.Node,characterParameterView:o,totalPowerLabel:cc.Label,characterEquipmentParameterView:o,equipmentTotalPowerLabel:cc.Label},_characterLevelProgressView:null,_characterExceedLimitProgressView:null,initPromoteCharacterDetailStatusView:function(t,e){this._super(t,e),this._addLevelProgressView(),this._addExceedLimitProgressView(),this._drawLevelProgress(),this._drawExceedLimitProgress(),this._drawCharacterParameter(),this._drawCharacterAddParameter()},_addLevelProgressView:function(){this._characterLevelProgressView||(this._characterLevelProgressView=cc.instantiate(this.characterLevelProgressViewPrefab).getComponent("CharacterLevelProgressView"),this.characterLevelProgressViewParentNode.addChild(this._characterLevelProgressView.node))},_drawLevelProgress:function(){this._characterLevelProgressView.node.active=!0;var t=this._characterModel.getExpRateForNextLevel(),e=this._characterModel.getNeedExpForNextLevel(),i=this._characterModel.getMaxLevel(),a=this._characterModel.getLevel();this._characterLevelProgressView.initCharacterLevelProgressView(0,a,0,i,0,e,t)},_addExceedLimitProgressView:function(){this._characterExceedLimitProgressView||(this._characterExceedLimitProgressView=cc.instantiate(this.characterExceedLimitProgressViewPrefab).getComponent("CharacterExceedLimitProgressView"),this.characterExceedLimitProgressViewParentNode.addChild(this._characterExceedLimitProgressView.node))},_drawExceedLimitProgress:function(){this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(this._characterModel.getExceedLimit(),this._characterModel.getExceedLimit(),this._characterModel.getExceedLimitMaxCount())},_drawCharacterParameter:function(){this.characterParameterView.node.active=!0,this.totalPowerLabel.string=a.convertToCommaDelimited(this._characterModel.getTotalPower()),this.characterParameterView.initBattleParameterView(this._characterModel.getTotalHp(),this._characterModel.getTotalAtk(),this._characterModel.getTotalDef())},_drawCharacterAddParameter:function(){cc.warn("_drawCharacterAddParameter\u304c\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CharacterExceedLimitProgressView:"CharacterExceedLimitProgressView",CharacterLevelProgressView:"CharacterLevelProgressView",CommonUtils:"CommonUtils",PromoteCharacterDetailStatusViewBase:"PromoteCharacterDetailStatusViewBase"}],PromoteCharacterDetailStatusSkillAbilityThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"96d07vQJ5ZPj4oHVvKMg+2Q","PromoteCharacterDetailStatusSkillAbilityThumbnail");var a=t("PromoteCharacterDetailStatusAppendThumbnailBase"),n=cc.Enum({SKILL:0,ABILITY:1,SUPPORT_ABILITY:2});cc.Class({extends:a,properties:{afterAppendNameLabel:cc.Label,appendLevelLabel:cc.Label,lockIconNode:cc.Node,appendDescriptionRichText:cc.RichText},initPromoteCharacterDetailStatusSkillThumbnail:function(t,e,i,a){this._resetThumbnailProperties(),this._initNodes(n.SKILL,!0,i),this._initLabels(t.skillMainMaster.getName(),t.skillText,t.skillLevel,t.maxSkillLevel,0,e,a)},initPromoteCharacterDetailStatusAbilityThumbnail:function(t,e,i,a,o){this._resetThumbnailProperties();var r=t.isSupportAbility?n.SUPPORT_ABILITY:n.ABILITY;this._initNodes(r,t.isReleased,i,o),this._initLabels(t.abilityMainMaster.getName(),t.abilityText,t.abilityLevel,0,t.needExceedLimit,e,a)},getLockIconNode:function(){return this.lockIconNode},setDescriptionRichText:function(t){this.appendDescriptionRichText.string=t},_initNodes:function(t,e,i,a){if(this.iconNodeArray[t].active=!0,this.activateNode.active=!0,this.appendNameLabel.node.active=!1,this.afterAppendNameLabel.node.active=!1,a){this.appendDescriptionRichText.enabled=!0,this.inactivateNode.active=!0,this.appendDescriptionRichText.node.opacity=0,this.inactivateNode.opacity=255;this.appendDescriptionRichText.node.runAction(cc.repeatForever(cc.sequence(cc.delayTime(2),cc.fadeIn(1).easing(cc.easeSineInOut()),cc.delayTime(2),cc.fadeOut(1).easing(cc.easeSineInOut())))),this.inactivateNode.runAction(cc.repeatForever(cc.sequence(cc.delayTime(2),cc.fadeOut(1).easing(cc.easeSineInOut()),cc.delayTime(2),cc.fadeIn(1).easing(cc.easeSineInOut()))))}else this.appendDescriptionRichText.enabled=e||i,this.inactivateNode.active=!e&&!i},_initLabels:function(t,e,i,a,n,o,r){o?(this.afterAppendNameLabel.node.active=!0,this.afterAppendNameLabel.string=t):(this.appendNameLabel.node.active=!0,this.appendNameLabel.string=t),this.appendDescriptionRichText.string=e,this._setAppendLevelLabelText(i,a,r),this._setNeedExceedLimitLabelText(n)},_resetThumbnailProperties:function(){this._super(""),this.appendLevelLabel.string="",this.appendDescriptionRichText.string=""},_setAppendLevelLabelText:function(t,e,i){this.appendLevelLabel.string=i?"Lv."+t+"/"+e:"Lv."+t},_setNeedExceedLimitLabelText:function(t){this.needExceedLimitLabel.string="\u9650\u754c\u7a81\u7834"+t+"\u6bb5\u968e\u76ee\u3067\u958b\u653e"}});cc._RF.pop()},{PromoteCharacterDetailStatusAppendThumbnailBase:"PromoteCharacterDetailStatusAppendThumbnailBase"}],PromoteCharacterDetailStatusSkillListView:[function(t,e,i){"use strict";cc._RF.push(e,"69192ppLzdMp4cxvoDNUWuv","PromoteCharacterDetailStatusSkillListView");var a=t("Singleton"),n=t("PromoteCharacterDetailStatusAppendListViewBase"),o=t("CharacterSkillUtils");cc.Class({extends:n,properties:{},_initListContent:function(){var t=[];if(this._characterModel)t=[this._characterModel.getCharacterSkillInfo()];else{var e=_.find(a.dao.CharacterSkillMainMasters,function(t){return t.getSkillId()===this._characterMainMaster.getSkillId()}.bind(this)),i=o.createCharacterSkillEffectMasterMap(this._characterMainMaster.getSkillId());t=[o.createCharacterSkillInfo(e,i[1],o.convertEffectText(i[1]),1,Object.keys(i).length)]}for(var n in this.content.destroyAllChildren(),t){var r=this._createThumbnailNode(this._root,t[n]);this.content.addChild(r)}},_createThumbnailNode:function(t,e){var i=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");return i.initPromoteCharacterDetailStatusSkillThumbnail(e),i.node}});cc._RF.pop()},{CharacterSkillUtils:"CharacterSkillUtils",PromoteCharacterDetailStatusAppendListViewBase:"PromoteCharacterDetailStatusAppendListViewBase",Singleton:"Singleton"}],PromoteCharacterDetailStatusSkillMaterialListView:[function(t,e,i){"use strict";cc._RF.push(e,"2dee7Sg8q9PH5sIHqvn9h7m","PromoteCharacterDetailStatusSkillMaterialListView");var a=t("ListViewBase"),n=t("GameConst"),o=t("CommonUtils"),r=(t("CharacterUtils"),t("CharacterSkillUtils")),s=(t("ResourceUtils"),t("CharacterConst"));cc.Class({extends:a,properties:{materialBaseNode:cc.Node,maximumBaseNode:cc.Node,levelUpRateLabel:cc.Label,priceLabel:cc.Label},_root:null,initPromoteCharacterDetailStatusSkillMaterialListView:function(t){var e=t.getCurrentCharacterModel().getCharacterSkillInfo();e.skillLevel===e.maxSkillLevel?(this.maximumBaseNode.active=!0,this.materialBaseNode.active=!1):(this.maximumBaseNode.active=!1,this.materialBaseNode.active=!0,this.resetListView(),this.initListView(t),this._setLabel())},_setListContent:function(t){for(var e=t.getMaterialCharacterModelArray(),i=0;i<n.SKILL_FORTIFY_MAX_MATERIAL;i+=1)i<e.length?this._addThumbnail(e[i]):this._addThumbnail()},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");t?e.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),t.getLevel(),1):e.initAddingMatrixThumbnail(),e.setCallbackToThumbnailBtn(function(){this._callbackToThumbnail(t)}.bind(this)),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){this._root.pushPromoteCharacterSkillFortifyMaterialSelectSubRoot()},_setLabel:function(){this.priceLabel.string=o.convertToCommaDelimited(r.calcSkillFortifyPrice(this._root.getMaterialCharacterModelArray(),this._root.getCurrentCharacterModel().getCharacterSkillInfo(),this._root.getCurrentCharacterModel()));var t=r.calcTotalSkillUpRate(this._root.getMaterialCharacterModelArray(),this._root.getCurrentCharacterModel().getCharacterSkillInfo(),this._root.getCurrentCharacterModel());this._drawSkillUpRate(t,t>s.SKILL_FORTIFY_MAX_RATE)},_drawSkillUpRate:function(t,e){e&&(t=n.MAX_SKILL_UP_RATE),this.levelUpRateLabel.string=t+""}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterSkillUtils:"CharacterSkillUtils",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",GameConst:"GameConst",ListViewBase:"ListViewBase",ResourceUtils:"ResourceUtils"}],PromoteCharacterDetailStatusSkillView:[function(t,e,i){"use strict";cc._RF.push(e,"ffc40C3SfhJMYaQBfmqN/IQ","PromoteCharacterDetailStatusSkillView");var a=t("CommonButton"),n=(t("CharacterAbilityUtils"),t("ViewUtils")),o=t("ResourceUtils"),r=t("ItemUtils"),s=t("PromoteCharacterDetailStatusViewBase"),c=t("PromoteCharacterDetailStatusSkillMaterialListView"),l=t("GameConst"),u=t("ItemSourceConst"),h=t("StaticResourceConst");cc.Class({extends:s,properties:{skillThumbnailPrefab:cc.Prefab,beforeSkillThumbnailParent:cc.Node,afterSkillThumbnailParent:cc.Node,arrowNode:cc.Node,promoteCharacterDetailStatusSkillMaterialListView:c,sourceSearchBtn:a,resetBtn:a,executeBtn:a},onLoad:function(){this.sourceSearchBtn.setTapEvent(this._onTapSouceSearchBtn.bind(this)),this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacterDetailStatusView:function(t,e){this._super(t,e),this._setSkillThumbnails(t.getCurrentCharacterModel().getCharacterSkillInfo(),t.getCurrentCharacterModel().getNextCharacterSkillInfo()),this.promoteCharacterDetailStatusSkillMaterialListView.initPromoteCharacterDetailStatusSkillMaterialListView(this._root),this._initButtons()},_setSkillThumbnails:function(t,e){this.beforeSkillThumbnailParent.destroyAllChildren(),this.afterSkillThumbnailParent.destroyAllChildren();var i=cc.instantiate(this.skillThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");if(this.beforeSkillThumbnailParent.addChild(i.node),t.skillLevel===t.maxSkillLevel)this.arrowNode.active=!1,this.afterSkillThumbnailParent.active=!1,i.initPromoteCharacterDetailStatusSkillThumbnail(t,!1,!0,!1);else{this.arrowNode.active=!0,this.afterSkillThumbnailParent.active=!0,i.initPromoteCharacterDetailStatusSkillThumbnail(t,!1,!0,!0);var a=cc.instantiate(this.skillThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");a.initPromoteCharacterDetailStatusSkillThumbnail(e,t.skillLevel<e.skillLevel,!0,!0),a.setDescriptionRichText(n.insertDiffTag(t.skillText,e.skillText,l.RICH_TEXT_TAG_STATE.WHITE.START,l.RICH_TEXT_TAG_STATE.WHITE.END,l.RICH_TEXT_TAG_STATE.PLUS.START,l.RICH_TEXT_TAG_STATE.PLUS.END)),this.afterSkillThumbnailParent.addChild(a.node)}},_initButtons:function(){this._root.getMaterialCharacterModelArray().length>0?(this.resetBtn.switchBtnImage(!0),this.executeBtn.switchBtnImage(!0),this.resetBtn.setTouchEnable(!0),this.executeBtn.setTouchEnable(!0)):(this.resetBtn.switchBtnImage(!1),this.executeBtn.switchBtnImage(!1),this.resetBtn.setTouchEnable(!1),this.executeBtn.setTouchEnable(!1))},_onTapSouceSearchBtn:function(){cc.instantiate(o.getResource(h.ITEM_SOURCE_LIST_POPUP_PREFAB_PATH)).getComponent("ItemSourceListPopup").openItemSourceListPopup(r.getItemMaster(u.SOURCE_ITEM_ID.CHARACTER_SKILL_FORTIFY_MATERIAL),this._root.getCurrentSceneName(),this._root.sceneParam)},_onTapResetBtn:function(){this._root.resetSelectMaterials(),this.promoteCharacterDetailStatusSkillMaterialListView.initPromoteCharacterDetailStatusSkillMaterialListView(this._root),this._initButtons()},_onTapExecuteBtn:function(){this._root.openPromoteCharacterSkillFortifyConfirmPopup(this._characterModel.getCharacterSkillInfo(),this._root.getMaterialCharacterModelArray())}});cc._RF.pop()},{CharacterAbilityUtils:"CharacterAbilityUtils",CommonButton:"CommonButton",GameConst:"GameConst",ItemSourceConst:"ItemSourceConst",ItemUtils:"ItemUtils",PromoteCharacterDetailStatusSkillMaterialListView:"PromoteCharacterDetailStatusSkillMaterialListView",PromoteCharacterDetailStatusViewBase:"PromoteCharacterDetailStatusViewBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst",ViewUtils:"ViewUtils"}],PromoteCharacterDetailStatusTabView:[function(t,e,i){"use strict";cc._RF.push(e,"cf58aejpkFLGIUJGPtAEZ7n","PromoteCharacterDetailStatusTabView");var a=t("TabViewBase"),n=t("PromoteCharacterDetailStatusAppendListViewBase");cc.Enum({EQUIPMENT:0,SKILL:1,ABILITY:2}),cc.Class({extends:a,properties:{promoteCharacterDetailStatusAppendListViewArray:[n]},_root:null,_characterMainMaster:null,_characterModel:null,initPromoteCharacterDetailStatusTabView:function(t,e,i){this._root=t,this._characterMainMaster=e,this._characterModel=i,this.initTabViewBase(),this._setCurrentTab(0),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){for(var e in this.promoteCharacterDetailStatusAppendListViewArray)this.promoteCharacterDetailStatusAppendListViewArray[e].node.active=!1;this.promoteCharacterDetailStatusAppendListViewArray[t].node.active=!0,this.promoteCharacterDetailStatusAppendListViewArray[t].initPromoteCharacterDetailStatusAppendListView(this._root,this._characterMainMaster,this._characterModel)}});cc._RF.pop()},{PromoteCharacterDetailStatusAppendListViewBase:"PromoteCharacterDetailStatusAppendListViewBase",TabViewBase:"TabViewBase"}],PromoteCharacterDetailStatusUpMaterialListView:[function(t,e,i){"use strict";cc._RF.push(e,"8ca93Bg1g5EoK6GAcB0MPoq","PromoteCharacterDetailStatusUpMaterialListView");cc.Class({extends:cc.Component,properties:{headerLabel:cc.Label,headerNode:cc.Node,content:cc.Node,thumbnailPrefab:cc.Prefab},initPromoteCharacterDetailStatusUpMaterialListView:function(t,e,i,a){this.headerLabel.string=e,this._initHeaderActive(i),this._initListContent(i,a)},_initListContent:function(t,e){for(var i in this.content.destroyAllChildren(),t){var a=i,n=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterDetailStatusUpMaterialThumbnail");n.initPromoteCharacterDetailStatusUpMaterialThumbnail(a,t[i],e,!this.headerNode.active),this.content.addChild(n.node)}},_initHeaderActive:function(t){for(var e in this.headerNode.active=!0,t)t[e].length>0&&(this.headerNode.active=!1)}});cc._RF.pop()},{}],PromoteCharacterDetailStatusUpMaterialThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"1a756thvB9CGbo5n+LQkIhQ","PromoteCharacterDetailStatusUpMaterialThumbnail");t("ResourceUtils"),t("CharacterConst"),t("GameConst"),cc.Class({extends:cc.Component,properties:{iconNodeArray:[cc.Node],countLabel:cc.Label,headerParentNode:cc.Node,matrixThumbnailParentNode:cc.Node,characterThumbnailPrefab:cc.Prefab},_matrixThumbnail:null,initPromoteCharacterDetailStatusUpMaterialThumbnail:function(t,e,i,a){this._initNodes(a),this._initMatrixThumbnail(e[0],i),this.iconNodeArray[t].active=!0,this.countLabel.string="x"+e.length},_addMatrixThumbnail:function(t){this._matrixThumbnail||(this._matrixThumbnail=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.matrixThumbnailParentNode.addChild(this._matrixThumbnail.node),this._matrixThumbnail.setCallbackToThumbnailBtn(t))},_initNodes:function(t){for(var e in this.headerParentNode.active=t,this.iconNodeArray)this.iconNodeArray[e].active=!1},_initMatrixThumbnail:function(t,e){this._addMatrixThumbnail(e),t?this._matrixThumbnail.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),-1,0):this._matrixThumbnail.initAddingMatrixThumbnail()}});cc._RF.pop()},{CharacterConst:"CharacterConst",GameConst:"GameConst",ResourceUtils:"ResourceUtils"}],PromoteCharacterDetailStatusViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"f20ddOUhBVLcaiDzzHlCC2t","PromoteCharacterDetailStatusViewBase");var a=t("WindowBase");cc.Class({extends:a,properties:{},_root:null,_characterModel:null,initPromoteCharacterDetailStatusView:function(t,e){this._root=t,this._characterModel=e},getTabIndex:function(){return 0}});cc._RF.pop()},{WindowBase:"WindowBase"}],PromoteCharacterDetailStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"2e3c1mTqjdMr5nrE/Zzw7L/","PromoteCharacterDetailStatusView");var a=t("CommonUtils"),n=t("PromoteCharacterDetailStatusParamViewBase"),o=t("PromoteCharacterDetailStatusEquipmentListView");cc.Class({extends:n,properties:{promoteCharacterDetailStatusEquipmentListView:o},initPromoteCharacterDetailStatusView:function(t,e){this._super(t,e),this._initPromoteCharacterDetailStatusTabView()},_initPromoteCharacterDetailStatusTabView:function(){this.promoteCharacterDetailStatusEquipmentListView.initPromoteCharacterDetailStatusAppendListView(this._root,this._characterModel.getCharacterMainMaster(),this._characterModel)},_drawCharacterAddParameter:function(){if(this.equipmentTotalPowerLabel){this.characterParameterView.node.active=!0;var t,e=this._characterModel.getEquipmentStatus(),i=this._characterModel.getEquipmentEffect(this._characterModel.getHp()+e.hp,this._characterModel.getAtk()+e.atk,this._characterModel.getDef()+e.def),n=e.hp+i.hp,o=e.atk+i.atk,r=e.def+i.def;t=n+o+r,this.equipmentTotalPowerLabel.string="(+"+a.convertToCommaDelimited(t)+")",this.characterEquipmentParameterView.initBattleParameterView(n,o,r),this.characterEquipmentParameterView.setPrefix("(+"),this.characterEquipmentParameterView.setSuffix(")")}}});cc._RF.pop()},{CommonUtils:"CommonUtils",PromoteCharacterDetailStatusEquipmentListView:"PromoteCharacterDetailStatusEquipmentListView",PromoteCharacterDetailStatusParamViewBase:"PromoteCharacterDetailStatusParamViewBase"}],PromoteCharacterDetailSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"57002uqfYRBc6CvlbX+rLDh","PromoteCharacterDetailSubRoot");var a=t("WindowBase"),n=t("PromoteCharacterDetailImageView"),o=t("PromoteCharacterDetailTopTabView");cc.Class({extends:a,properties:{promoteCharacterDetailImageView:n,promoteCharacterDetailTopTabView:o},initPromoterCharacterDetailSubRoot:function(t,e,i){this.promoteCharacterDetailImageView.initPromoteCharacterDetailImageView(t),this.promoteCharacterDetailTopTabView.initPromoteCharacterDetailTopTabView(t,e,i)},redrawPromoteCharacterDetailSubRoot:function(){this.promoteCharacterDetailImageView.redrawPromoteCharacterDetailImageView(),this.promoteCharacterDetailTopTabView.redrawPromoteCharacterDetailTopTabView()}});cc._RF.pop()},{PromoteCharacterDetailImageView:"PromoteCharacterDetailImageView",PromoteCharacterDetailTopTabView:"PromoteCharacterDetailTopTabView",WindowBase:"WindowBase"}],PromoteCharacterDetailTopTabView:[function(t,e,i){"use strict";cc._RF.push(e,"7cb94xasaFFaIGYnA5y4lwH","PromoteCharacterDetailTopTabView");var a=t("TabViewBase"),n=t("PromoteCharacterDetailStatusViewBase"),o=t("ViewUtils"),r=2,s=4,c={POSITION:cc.v2(47,18),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{promoteCharacterDetailStatusViewArray:[n]},_root:null,initPromoteCharacterDetailTopTabView:function(t,e,i){this._root=t,this.initTabViewBase(),this._setCurrentTab(e),this.redrawPromoteCharacterDetailTopTabView(i),this._setNoticeBadge()},redrawPromoteCharacterDetailTopTabView:function(t){t=t||this.promoteCharacterDetailStatusViewArray[this.getCurrentTab()].getTabIndex(),this._activateTab(this.getCurrentTab(),t),this._setNoticeBadge()},_setNoticeBadge:function(){this._root.getCurrentCharacterModel()&&(this._root.getCurrentCharacterModel().hasExceedableMaterial()?o.addNoticeBadge(this.tabBtnArray[r].node,c.POSITION,c.SCALE):o.hideNoticeBadge(this.tabBtnArray[r].node),this._root.getCurrentCharacterModel().hasAbilityFotifyableMaterial()?o.addNoticeBadge(this.tabBtnArray[s].node,c.POSITION,c.SCALE):o.hideNoticeBadge(this.tabBtnArray[s].node))},_tabEvent:function(t,e,i){this._root.resetSelectMaterials(),this._root.setCurrentTab(e),this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t,e){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t,e)},_switchTabContent:function(t,e){for(var i in this.promoteCharacterDetailStatusViewArray)this.promoteCharacterDetailStatusViewArray[i].node.active=!1;this.promoteCharacterDetailStatusViewArray[t].node.active=!0,this.promoteCharacterDetailStatusViewArray[t].initPromoteCharacterDetailStatusView(this._root,this._root.getCurrentCharacterModel(),e)}});cc._RF.pop()},{PromoteCharacterDetailStatusViewBase:"PromoteCharacterDetailStatusViewBase",TabViewBase:"TabViewBase",ViewUtils:"ViewUtils"}],PromoteCharacterDetailViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"07e73XoXMtGFaqrI0e7qipc","PromoteCharacterDetailViewSetting");var a=t("PromoteCharacterDetailRootUtils");e.exports={PROMOTECHARACTERDETAIL_SETTING:{PromoteCharacterDetailSubRoot:{open:a.openPromoteCharacterDetailSubRoot,close:a.closePromoteCharacterDetailSubRoot},PromoteCharacterEquipmentSelectSubRoot:{open:a.openPromoteCharacterEquipmentSelectSubRoot,close:a.closePromoteCharacterEquipmentSelectSubRoot},PromoteCharacterFortifyMaterialSelectSubRoot:{open:a.openPromoteCharacterFortifyMaterialSelectSubRoot,close:a.closePromoteCharacterFortifyMaterialSelectSubRoot},PromoteCharacterExceedLimitMaterialSelectSubRoot:{open:a.openPromoteCharacterExceedLimitMaterialSelectSubRoot,close:a.closePromoteCharacterExceedLimitMaterialSelectSubRoot},PromoteCharacterSkillFortifyMaterialSelectSubRoot:{open:a.openPromoteCharacterSkillFortifyMaterialSelectSubRoot,close:a.closePromoteCharacterSkillFortifyMaterialSelectSubRoot}}},cc._RF.pop()},{PromoteCharacterDetailRootUtils:"PromoteCharacterDetailRootUtils"}],PromoteCharacterEquipmentSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"16a77OXopRPAYWDPs2kbvK9","PromoteCharacterEquipmentSelectListView");var a=t("CommonButton"),n=t("Singleton"),o=(t("PopupUtils"),t("EquipmentUtils")),r=t("CommonUtils"),s=t("EquipmentListWithSideViewBase"),c=t("ItemConst"),l=t("EquipmentFilterConst"),u=t("LocalDataConst");cc.Class({extends:s,properties:{purchaseBtn:a},_characterEquipmentInfo:null,onLoad:function(){this.purchaseBtn.setTapEvent(this._onTapPurchaseBtn.bind(this))},initListView:function(t,e){this._characterEquipmentInfo=e,this.matrixPageView.setCallBackToIsImageActive(this._callBackToIsImageActive.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this._super(t)},_initSideView:function(t){this.equipmentSelectSideView.initEquipmentSelectSideView(t,this._callbackToRedraw.bind(this),this._callbackToSideExecute.bind(this),this._callbackToSideProtect.bind(this),this._characterEquipmentInfo)},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView(this._createEquipmentList(),n.dao.userBasicData.getEquipmentMaxCount(),this._callbackToCreateThumbnailNode.bind(this))},_createEquipmentList:function(){var t=o.getEquipmentModelArrayByEquipmentType(c.EQUIPMENT_TYPE.ATK);if(this._characterEquipmentInfo.equipmentModel)for(var e=0;e<t.length;e+=1)if(t[e].getEquipmentCd()===this._characterEquipmentInfo.equipmentModel.getEquipmentCd()){var i=t[e];t.splice(e,1),t.splice(0,0,i)}return t},_callbackToCreateThumbnailNode:function(t,e){var i;e?(i=e.getComponentInChildren("EquipmentMatrixThumbnail")).resetEquipmentMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),i.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),t),i.setProtected(t.getIsProtect());var a=o.createSortViewParams(r.loadLocalStorage(u.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,0,u.LOCAL_STORAGE_GET_TYPE.INTEGER),t);return i.setParameter(a.prefix,a.value),this._characterEquipmentInfo.equipmentModel&&t.getEquipmentCd()===this._characterEquipmentInfo.equipmentModel.getEquipmentCd()&&i.setCenterLabel("\u5916\u3059"),i.node},_callBackToIsImageActive:function(t){return!this._characterEquipmentInfo.equipmentModel||t.getEquipmentCd()!==this._characterEquipmentInfo.equipmentModel.getEquipmentCd()},_callbackToThumbnail:function(t,e){this._resetActiveThumbnails(),t.setSelectedNodeActive(!0),this.equipmentSelectSideView.drawEquipmentSelectSideView(e)},_callbackToSideExecute:function(t){var e=o.getCharacterModelByEquipmentCd(t.getEquipmentCd());if(e){var i=e.getCharacterEquipmentInfoArray().find(function(e){return e.equipmentModel&&e.equipmentModel.getEquipmentCd()===t.getEquipmentCd()});return this._characterEquipmentInfo.equipmentModel&&i.equipmentModel.getEquipmentCd()===this._characterEquipmentInfo.equipmentModel.getEquipmentCd()?this._root.requestEquip(this._root.createReleaseCharactersEquipmentParameter(this._characterEquipmentInfo),function(){this._root.popScene()}.bind(this)):this._root.openPromoteCharacterEquipmentSwapPopup(i,this._characterEquipmentInfo,function(){this._root.popScene()}.bind(this))}return this._root.requestEquip(this._root.createEquipCharactersEquipmentParameter(this._root.getCurrentCharacterModel().getCharacterCd(),t.getEquipmentCd(),this._characterEquipmentInfo.position),function(){this._root.popScene()}.bind(this))},_callbackToSortAndFilter:function(t,e,i){this._super(t,e,i);var a=this.matrixPageView.getVisibleDataList();if(this._characterEquipmentInfo.equipmentModel)for(var n=0;n<a.length;n+=1)if(a[n].getEquipmentCd()===this._characterEquipmentInfo.equipmentModel.getEquipmentCd()){var o=a[n];a.splice(n,1),a.splice(0,0,o)}this.matrixPageView.setVisibleDataList(a)},_callbackToCreateFilterConditions:function(t){for(var e=[],i=l.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:l.EQUIP_FILTER_FUNC_NAME[Object.keys(l.EQUIP_FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_callbackToSideProtect:function(t){this._root.requestEquipmentProtect(t,function(){this.matrixPageView.setDataList(this._createEquipmentList()),this.matrixPageView.sortAndFilter(),this.matrixPageView.redrawSimply(),this.equipmentSelectSideView.drawEquipmentSelectSideView(o.getEquipmentModelByEquipmentCd(t.getEquipmentCd()))}.bind(this))},_onTapPurchaseBtn:function(){this._root.transitionShop()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentFilterConst:"EquipmentFilterConst",EquipmentListWithSideViewBase:"EquipmentListWithSideViewBase",EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",Singleton:"Singleton"}],PromoteCharacterEquipmentSelectPopup:[function(t,e,i){"use strict";cc._RF.push(e,"dd329RT9uBNgIIiGMOyxjVi","PromoteCharacterEquipmentSelectPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("ResourceUtils"),t("BattleParameterView")),r=t("CommonUtils");cc.Class({extends:a,properties:{changeBtn:n,releaseBtn:n,nameLabel:cc.Label,equipmentParameterView:o,matrixThumbnail:cc.Node,matrixThumbnailPrefab:cc.Prefab,normalLabel:cc.Label,boostLabel:cc.Label,totalPowerLabel:cc.Label},_root:null,_characterEquipmentInfo:void 0,openPromoteCharacterEquipmentSelectPopup:function(t,e,i){cc.log("openPromoteCharacterEquipmentSelectPopup"),this._initPromoteCharacterEquipmentSelectPopup(t,e,i),this._initButtons(),this.open(function(){})},_initPromoteCharacterEquipmentSelectPopup:function(t,e,i){this._root=t,this._callback=i,this._characterEquipmentInfo=e,this.nameLabel.string=e.equipmentModel.getName(),this.totalPowerLabel.string=r.convertToCommaDelimited(e.equipmentModel.getTotalPower()),this.equipmentParameterView.initBattleParameterView(e.equipmentModel.getHp(),e.equipmentModel.getAtk(),e.equipmentModel.getDef()),this.normalLabel.string=e.equipmentModel.getEffectTextForNormal(),this.boostLabel.string=e.equipmentModel.getEffectTextForBoost();var a=cc.instantiate(this.matrixThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");this.matrixThumbnail.addChild(a.node),e.equipmentModel&&(a.initEquipmentMatrixThumbnail(e.equipmentModel.getEquipmentId(),e.equipmentModel.getAttribute(),e.equipmentModel.getRarity(),e.equipmentModel),a.setParameter("Lv.",e.equipmentModel.getLevel()),a.switchPlusNodeActive(!1))},_initButtons:function(){this.changeBtn.setTapEvent(this._eventChangeBtn.bind(this),n.SE_NAME.EQUIP),this.releaseBtn.setTapEvent(this._eventReleaseBtn.bind(this),n.SE_NAME.CANCEL)},_eventChangeBtn:function(){this.close(),this._root.pushPromoteCharacterEquipmentSelectSubRoot(this._characterEquipmentInfo)},_eventReleaseBtn:function(){return this._root.requestEquip(this._root.createReleaseCharactersEquipmentParameter(this._characterEquipmentInfo),function(){this.close(),this._callback()}.bind(this))},_eventCancelBtn:function(){this.close()}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonButton:"CommonButton",CommonUtils:"CommonUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],PromoteCharacterEquipmentSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"612d4oTwIxGSKIacmDw8EpF","PromoteCharacterEquipmentSelectSideView");var a=t("EquipmentSingleSelectSideViewBase");cc.Class({extends:a,properties:{executeBtnLabel:cc.Label},_characterEquipmentInfo:null,initEquipmentSelectSideView:function(t,e,i,a,n){this._super(t,e,i,a),this._characterEquipmentInfo=n},drawEquipmentSelectSideView:function(t){this._super(t),this._drawExecuteBtnLabel()},_drawExecuteBtnLabel:function(){this.executeBtnLabel.string="\u88c5\u5099\u3059\u308b",this._equipmentModel&&this._characterEquipmentInfo.equipmentModel&&this._equipmentModel.getEquipmentCd()===this._characterEquipmentInfo.equipmentModel.getEquipmentCd()&&(this.executeBtnLabel.string="\u5916\u3059")}});cc._RF.pop()},{EquipmentSingleSelectSideViewBase:"EquipmentSingleSelectSideViewBase"}],PromoteCharacterEquipmentSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"d4223SCwHpPl4u1mGYNTPwX","PromoteCharacterEquipmentSelectSubRoot");var a=t("WindowBase"),n=(t("EquipmentUtils"),t("PromoteCharacterEquipmentSelectListView"));cc.Class({extends:a,properties:{promoteCharacterEquipmentSelectListView:n},initPromoteCharacterEquipmentSelectSubRoot:function(t,e){this._characterEquipmentInfo=e,this.promoteCharacterEquipmentSelectListView.initListView(t,e)}});cc._RF.pop()},{EquipmentUtils:"EquipmentUtils",PromoteCharacterEquipmentSelectListView:"PromoteCharacterEquipmentSelectListView",WindowBase:"WindowBase"}],PromoteCharacterExceedLimitCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"6697c6qstFOzJgdk5Xx90B+","PromoteCharacterExceedLimitCompletePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=(t("CharacterUtils"),t("CommonScrollView")),s=t("PromoteCharacterDetailReleaseAppendListView"),c=t("PictureBookUtils"),l=t("CharacterConst"),u=t("Singleton"),h=cc.Enum({ANIM_CATEGORY:{LB:0,MAX_LV:1,LIST:2},EXCEED_LIMIT:0});cc.Class({extends:a,properties:{matrixThumbnailNode:cc.Node,matrixThumbnailPrefab:cc.Prefab,beforeLimitIconArray:[cc.Toggle],afterLimitIconArray:[cc.Toggle],beforeCharacterMaxLvLabel:cc.Label,afterCharacterMaxLvLabel:cc.Label,okBtn:n,popupAnimationArray:[cc.Animation],exceedLimitListView:s,commonScrollView:r},_characterModel:null,_characterModelAfter:null,onLoad:function(){this.okBtn.setTapEvent(this.close.bind(this))},openPromoteCharacterExceedLimitCompletePopup:function(t,e,i){this._initPromoteCharacterExceedLimitCompletePopup(t,e,i),this._initAnimationNode(),this.open(this._playOpenedAnimation.bind(this))},_initAnimationNode:function(){this.afterCharacterMaxLvLabel.node.setScale(0,1),this.popupAnimationArray[h.ANIM_CATEGORY.LIST].node.opacity=0},_initPromoteCharacterExceedLimitCompletePopup:function(t,e,i){this._characterModel=t,this._characterModelAfter=e,this.setCloseCallBack(i),this._setParameter()},_setParameter:function(){var t=cc.instantiate(this.matrixThumbnailPrefab).getComponent("CharacterMatrixThumbnail");t.initCharacterMatrixThumbnail(this._characterModel.getCharacterMainMaster(),this._characterModel.getExceedLimit()),this.matrixThumbnailNode.addChild(t.node),this.beforeCharacterMaxLvLabel.string=this._characterModel.getMaxLevel(),this._initLimitIconToggleArray(this.beforeLimitIconArray,this._characterModel.getExceedLimit(),this._characterModel.getExceedLimitMaxCount()),this.afterCharacterMaxLvLabel.string=this._characterModelAfter.getMaxLevel(),this._initLimitIconToggleArray(this.afterLimitIconArray,this._characterModelAfter.getExceedLimit(),this._characterModel.getExceedLimitMaxCount())},_initLimitIconToggleArray:function(t,e,i){for(var a=0;a<t.length;a+=1)a<i?(t[a].node.active=!0,t[a].isChecked=a<e):t[a].node.active=!1},_initListView:function(){this.exceedLimitListView.initPromoteCharacterDetailReleaseAppendListView(this._characterModel,this._characterModelAfter)},_playOpenedAnimation:function(){this._initListView(),this.commonScrollView.scrollToTop();var t=[];t.push(h.ANIM_CATEGORY.LB),t.push(h.ANIM_CATEGORY.MAX_LV),t.push(h.ANIM_CATEGORY.LIST),this.popupAnimationArray[h.ANIM_CATEGORY.MAX_LV].once("finished",function(){},this);for(var e=0;e<t.length;e+=1)this.popupAnimationArray[t[e]].play(this.popupAnimationArray[t[e]].getClips()[h.EXCEED_LIMIT].name);var i=c.getCharacterTextMasterArray(this._characterModelAfter.getCharacterId(),l.TEXT_SCENE_TYPE.PROMOTE,l.TEXT_GROUP_TYPE.PROMOTE.EXCEED_LIMIT),a=_.sample(i);a&&u.fileLoaderManager.loadFile(o.getFileNameCharacterSound(a.getCharacterId(),a.getVoiceFile()),cc.AudioClip,function(t,e){t?cc.error(t):u.soundManager.playVoice(e)})}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",PictureBookUtils:"PictureBookUtils",PopupBase:"PopupBase",PromoteCharacterDetailReleaseAppendListView:"PromoteCharacterDetailReleaseAppendListView",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],PromoteCharacterExceedLimitConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"a6d92SksHRPqptpMO1018H4","PromoteCharacterExceedLimitConfirmPopup");var a=t("CharacterConst"),n=t("PromoteCharacterConfirmPopupBase");cc.Class({extends:n,properties:{beforeLimitIconArray:[cc.Toggle],afterLimitIconArray:[cc.Toggle],beforeCharacterMaxLvLabel:cc.Label,afterCharacterMaxLvLabel:cc.Label,attentionLabel:cc.Label},openPromoteCharacterExceedLimitConfirmPopup:function(t,e,i,a,n){this._initPromoteCharacterConfirmPopup(a,n),this._characterModel=t,this._setMaterials(i),this._setParameter(i.length),this._setAttentionLabel(e),this.open()},_setMaterials:function(t){for(var e in t)this.thumbnailParentNode.addChild(t[e])},_setParameter:function(t){var e=t||0;this.beforeCharacterMaxLvLabel.string=this._characterModel.getMaxLevel(),this._initLimitIconToggleArray(this.beforeLimitIconArray,this._characterModel.getExceedLimit(),this._characterModel.getExceedLimitMaxCount());var i=this._characterModel.getMaxLevelByExceedLimit(this._characterModel.getExceedLimit()+e);this.afterCharacterMaxLvLabel.string=i,this._initLimitIconToggleArray(this.afterLimitIconArray,this._characterModel.getExceedLimit()+e,this._characterModel.getExceedLimitMaxCount())},_setAttentionLabel:function(t){switch(t){case a.EXCEED_LIMIT_MATERIAL_TYPE.CHARACTER:this.attentionLabel.string="\u7d20\u6750\u306b\u4f7f\u7528\u3055\u308c\u305f\u30e6\u30cb\u30c3\u30c8\u306f\u3044\u306a\u304f\u306a\u308a\u307e\u3059\n\u4f7f\u7528\u3055\u308c\u308b\u30e6\u30cb\u30c3\u30c8\u306e\u88c5\u5099\u306f\u81ea\u52d5\u7684\u306b\u89e3\u9664\u3055\u308c\u307e\u3059";break;case a.EXCEED_LIMIT_MATERIAL_TYPE.ITEM:this.attentionLabel.string="\u7d20\u6750\u306b\u4f7f\u7528\u3055\u308c\u305f\u30a2\u30a4\u30c6\u30e0\u306f\u306a\u304f\u306a\u308a\u307e\u3059"}},_initLimitIconToggleArray:function(t,e,i){for(var a=0;a<t.length;a+=1)a<i?(t[a].node.active=!0,t[a].isChecked=a<e):t[a].node.active=!1}});cc._RF.pop()},{CharacterConst:"CharacterConst",PromoteCharacterConfirmPopupBase:"PromoteCharacterConfirmPopupBase"}],PromoteCharacterExceedLimitMaterialSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"2255bj/2tFNSJ/sNxyD4lCc","PromoteCharacterExceedLimitMaterialSelectListView");var a=t("Singleton"),n=t("CommonButton"),o=t("CharacterUtils"),r=t("ResourceUtils"),s=t("DeckUtils"),c=(t("WarehouseUtils"),t("WarehouseConvertUtils")),l=t("PromoteCharacterSelectListViewBase"),u=t("PromoteCharacterExceedLimitMaterialSelectSideView"),h=t("MatrixMultipleSelectCountUpPageView"),d=t("CharacterConst"),p=t("CharacterSortConst"),m=t("WarehouseConst"),g=t("StaticResourceConst");cc.Class({extends:l,properties:{dataTypeLabel:cc.Label,warehouseSwitchBtn:n,countUpMatrixCharacterPageView:h,promoteCharacterSelectSideView:u},onLoad:function(){this.warehouseSwitchBtn.setTapEvent(this._onTapWarehouseSwitchBtn.bind(this))},initPromoteCharacterExceedLimitMaterialSelectListView:function(t){switch(this._root=t,t.materialDataType){case d.MATERIAL_DATA_TYPE.CHARACTER:this.initListView(t);break;case d.MATERIAL_DATA_TYPE.WAREHOUSE:this.initWarehouseCharacterListView(t)}},initListView:function(t){this.matrixPageView.setCallBackToIsImageActive(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsThumbnailEnabled.bind(this)),this._drawDataType(t.materialDataType),this.matrixPageView.node.active=!0,this._super(t),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtn.bind(this),this._callbackToSideResetBtn.bind(this),this._callbackToSideThumbnail.bind(this)),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(this._root.getMaterialCharacterModelArray())},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView("getCharacterCd",o.getExceedLimitMaterialCharacterModelArray(this._root.getCurrentCharacterModel()),a.dao[a.USER].getCharacterMaxCount(),this._root.getMaterialCharacterModelArray(),this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:"getIsProtect"}),i.push({getterName:"getIsDeckUnit"}),i.push({getterName:p.SORT_FUNC_NAME[Object.keys(p.SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_getCheckLimit:function(){return this._root.getCurrentCharacterModel().getExceedLimitMaxCount()-this._root.getCurrentCharacterModel().getExceedLimit()},_callbackToThumbnail:function(t){this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_callbackToSideThumbnail:function(t){this._setRecommendSelectMaterials(t)},_callbackIsThumbnailEnabled:function(t,e){return!t.getIsProtect()&&!s.isDeckUnit(t.getCharacterCd())&&!(e.length>=this._getCheckLimit()&&!e.find(function(e){return e.getCharacterCd()===t.getCharacterCd()}))},_callbackToRecommendSelectBtn:function(){},_callbackToSideResetBtn:function(){this.matrixPageView.clearCheckedModelArray(),this.matrixPageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_setRecommendSelectMaterials:function(t){var e=this.matrixPageView.getPageIndex();this.matrixPageView.initMatrixPageView("getCharacterCd",o.getExceedLimitMaterialCharacterModelArray(this._root.getCurrentCharacterModel()),a.dao[a.USER].getCharacterMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.matrixPageView.redraw(),this.matrixPageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_onTapWarehouseSwitchBtn:function(){switch(this._toggleDataType(),this._resetActiveListView(),this._root.materialDataType){case d.MATERIAL_DATA_TYPE.CHARACTER:this.initListView(this._root);break;case d.MATERIAL_DATA_TYPE.WAREHOUSE:this.initWarehouseCharacterListView(this._root)}},_toggleDataType:function(){switch(this._root.materialDataType){case d.MATERIAL_DATA_TYPE.CHARACTER:this._root.materialDataType=d.MATERIAL_DATA_TYPE.WAREHOUSE;break;case d.MATERIAL_DATA_TYPE.WAREHOUSE:this._root.materialDataType=d.MATERIAL_DATA_TYPE.CHARACTER}},_drawDataType:function(t){switch(t){case d.MATERIAL_DATA_TYPE.CHARACTER:this.dataTypeLabel.string="\u30e6\u30cb\u30c3\u30c8";break;case d.MATERIAL_DATA_TYPE.WAREHOUSE:this.dataTypeLabel.string="\u5009\u5eab"}},_resetActiveListView:function(){this._root.resetSelectMaterials(),this.matrixPageView.node.active=!1,this.countUpMatrixCharacterPageView.node.active=!1},initWarehouseCharacterListView:function(t){this._drawDataType(t.materialDataType),this.countUpMatrixCharacterPageView.node.active=!0,this.countUpMatrixCharacterPageView.setCallBackToIsImageActive(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixCharacterPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixCharacterPageView.setCallBackToThumbnail(this._callbackToWarehouseThumbnail.bind(this)),this._initMatrixPageViewForWarehouse(),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtn.bind(this),this._callbackToSideResetBtnForWarehouseMaterial.bind(this),this._callbackToSideThumbnailForWarehouseMaterial.bind(this)),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(this._root.getMaterialCharacterModelArray())},_initMatrixPageViewForWarehouse:function(){this.countUpMatrixCharacterPageView.initMatrixPageView("getCharacterCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getCharacterMaxCount(),this._root.getMaterialSelectCountInfoArray(),this._getCheckLimit(),this._callbackToCreateWarehouseCharacterThumbnailNode.bind(this))},_getWarehouseMaterialModelArray:function(){return Array.isArray(a.dao.warehouseCharacters)?_.filter(a.dao.warehouseCharacters,function(t){return t.getCount()>0&&t.getCharacterId()===this._root.getCurrentCharacterModel().getCharacterId()}.bind(this)):[]},_callbackIsWarehouseThumbnailEnabled:function(t,e){return _.sumBy(e,function(t){return t.count})<this._getCheckLimit()},_callbackToWarehouseThumbnail:function(t,e){this._root.setMaterialSelectCountInfoArray(this.countUpMatrixCharacterPageView.getCountInfoArray()),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(c.convertWarehouseModelCountInfoArrayToCharacters(this.countUpMatrixCharacterPageView.getCountInfoArray(),m.WAREHOUSE_STORAGE_TYPE.CHARACTER))},_callbackToSideResetBtnForWarehouseMaterial:function(){this._root.resetSelectMaterials(),this.countUpMatrixCharacterPageView.clearCountInfoArray(),this.countUpMatrixCharacterPageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_callbackToSideThumbnailForWarehouseMaterial:function(t){this._setRecommendSelectMaterialsForWarehouseMaterial(t)},_setRecommendSelectMaterialsForWarehouseMaterial:function(t){var e=this.countUpMatrixCharacterPageView.getPageIndex(),i=[];Array.prototype.push.apply(i,c.convertCharactersToWarehouseModelCountInfoArray(t,m.WAREHOUSE_STORAGE_TYPE.MATERIAL)),Array.prototype.push.apply(i,c.convertCharactersToWarehouseModelCountInfoArray(t,m.WAREHOUSE_STORAGE_TYPE.CHARACTER)),this._root.setMaterialSelectCountInfoArray(i),this._initMatrixPageViewForWarehouse(),this.countUpMatrixCharacterPageView.redraw(),this.countUpMatrixCharacterPageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_callbackToCreateWarehouseCharacterThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(r.getResource(g.CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("CharacterMatrixThumbnail"),i.initCharacterMatrixThumbnail(t.getMainMaster(),t.getExceedLimit(),void 0,void 0),i.setBottomParams("x",t.getCount()),i.node}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",DeckUtils:"DeckUtils",MatrixMultipleSelectCountUpPageView:"MatrixMultipleSelectCountUpPageView",PromoteCharacterExceedLimitMaterialSelectSideView:"PromoteCharacterExceedLimitMaterialSelectSideView",PromoteCharacterSelectListViewBase:"PromoteCharacterSelectListViewBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",WarehouseConst:"WarehouseConst",WarehouseConvertUtils:"WarehouseConvertUtils",WarehouseUtils:"WarehouseUtils"}],PromoteCharacterExceedLimitMaterialSelectSideListView:[function(t,e,i){"use strict";cc._RF.push(e,"0a908iVUidPPb0N4SAhszUD","PromoteCharacterExceedLimitMaterialSelectSideListView");t("CommonButton"),t("CommonUtils"),t("CharacterUtils");var a=t("CharacterConst"),n=(t("ResourceUtils"),t("CharacterExceedLimitMaterialViewBase"));cc.Class({extends:n,properties:{},_callbackToSideThumbnail:null,initPromoteCharacterExceedLimitMaterialSelectSideListView:function(t,e){this._root=t,this._callbackToSideThumbnail=e;this._root.getCurrentCharacterModel().getExceedLimitMaxCount(),this._root.getCurrentCharacterModel().getExceedLimit();this._drawMaterials([])},drawCharacterExceedLimitMaterialView:function(t){this._drawMaterials(t)},_drawMaterials:function(t){this._materialCharacterModelArray=t,this.thumbnailParentNode.destroyAllChildren();for(var e=this._root.getCurrentCharacterModel().getExceedLimitMaxCount()-this._root.getCurrentCharacterModel().getExceedLimit(),i=0;i<a.EXCEED_LIMIT_MAX_COUNT;i+=1){var n=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");t[i]?(n.initCharacterMatrixThumbnail(t[i].getCharacterMainMaster(),t[i].getExceedLimit(),t[i].getLevel(),1),n.setCallbackToThumbnailBtn(function(t){var e=this._materialCharacterModelArray.filter(function(e){return e.getCharacterCd()!==t.getCharacterCd()});this._callbackToThumbnail(e)}.bind(this,t[i]))):n.initAddingMatrixThumbnail(),i>=e&&(n.setActive(!1),n.setCenterLabel("\u9078\u629e\u4e0d\u53ef")),this.thumbnailParentNode.addChild(n.node)}},_callbackToThumbnail:function(t){this._callbackToSideThumbnail(t)},getAddExceedLimit:function(){return this._materialCharacterModelArray.length},getMaterialNodeArray:function(){for(var t=[],e=0;e<this._materialCharacterModelArray.length;e+=1)t.push(cc.instantiate(this.thumbnailParentNode.children[e]));return t},getExceedLimitMaterialType:function(){return a.EXCEED_LIMIT_MATERIAL_TYPE.CHARACTER},getSelectedMaterial:function(){return this._materialCharacterModelArray}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterExceedLimitMaterialViewBase:"CharacterExceedLimitMaterialViewBase",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ResourceUtils:"ResourceUtils"}],PromoteCharacterExceedLimitMaterialSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"44d74yAVUlF05FiUvupdtMe","PromoteCharacterExceedLimitMaterialSelectSideView");var a=t("CommonButton"),n=t("CommonUtils"),o=(t("EquipmentUtils"),t("CharacterUtils")),r=(t("ResourceUtils"),t("ViewUtils"),t("GameConst"),t("CharacterConst")),s=t("PopupUtils"),c=t("MaterialCharacterInfoView"),l=t("PromoteCharacterExceedLimitMaterialSelectSideListView");cc.Class({extends:cc.Component,properties:{materialCharacterInfoView:c,promoteCharacterExceedLimitMaterialSelectSideListView:l,thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,nextMaxLevelLabel:cc.Label,priceLabel:cc.Label,recommendSelectBtn:a,resetBtn:a,executeBtn:a},_root:null,_characterThumbnail:null,_materialCharacterModelArray:null,_callbackToRecommendSelectBtn:null,_callbackToResetBtn:null,onLoad:function(){this.recommendSelectBtn.setTapEvent(this._onTapRecommendSelectBtn.bind(this)),this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacerSelectSideView:function(t,e,i,a){this._root=t,this._callbackToRecommendSelectBtn=e,this._callbackToResetBtn=i,this.priceLabel.string="0",this.promoteCharacterExceedLimitMaterialSelectSideListView.initPromoteCharacterExceedLimitMaterialSelectSideListView(t,a),this.materialCharacterInfoView.initMaterialCharacterInfoView(t,this._root.getCurrentCharacterModel()),this.executeBtn.switchBtnImage(!0),this.recommendSelectBtn.node.active=!1},drawPromoteCharacterSelectSideView:function(t){this.promoteCharacterExceedLimitMaterialSelectSideListView.drawCharacterExceedLimitMaterialView(t),this._onChangeMaterial(t,this.promoteCharacterExceedLimitMaterialSelectSideListView.getAddExceedLimit()),this.materialCharacterInfoView.drawLevelProgress(r.PROMOTE_TYPE.EXCEED_LIMIT,t)},_onChangeMaterial:function(t,e){this.priceLabel.string=n.convertToCommaDelimited(o.calcExceedLimitPrice(this._root.getCurrentCharacterModel().getExceedLimitType(),this._root.getCurrentCharacterModel().getExceedLimit(),this._root.getCurrentCharacterModel().getExceedLimit()+e)),this._root.setMaterialCharacterModelArray(t);var i=t.length>0;this.resetBtn.switchBtnImage(i),this.resetBtn.setTouchEnable(i),this.executeBtn.switchBtnImage(i)},_onTapRecommendSelectBtn:function(){this._callbackToRecommendSelectBtn()},_onTapResetBtn:function(){this._callbackToResetBtn()},_onTapExecuteBtn:function(){this.promoteCharacterExceedLimitMaterialSelectSideListView.getSelectedMaterial().length<=0?s.openSimpleMessageWindow("\u7d20\u6750\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093"):this._root.popScene()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",MaterialCharacterInfoView:"MaterialCharacterInfoView",PopupUtils:"PopupUtils",PromoteCharacterExceedLimitMaterialSelectSideListView:"PromoteCharacterExceedLimitMaterialSelectSideListView",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterExceedLimitMaterialSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"b8ec9V8S3hFuaCPMF6ONhNp","PromoteCharacterExceedLimitMaterialSelectSubRoot");var a=t("WindowBase"),n=(t("EquipmentUtils"),t("PromoteCharacterExceedLimitMaterialSelectListView"));cc.Class({extends:a,properties:{promoteCharacterExceedLimitMaterialSelectListView:n},initPromoteCharacterExceedLimitMaterialSelectSubRoot:function(t){this.promoteCharacterExceedLimitMaterialSelectListView.initPromoteCharacterExceedLimitMaterialSelectListView(t)}});cc._RF.pop()},{EquipmentUtils:"EquipmentUtils",PromoteCharacterExceedLimitMaterialSelectListView:"PromoteCharacterExceedLimitMaterialSelectListView",WindowBase:"WindowBase"}],PromoteCharacterFortifyCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"70c40FYVdlG46hC5hSHxSD3","PromoteCharacterFortifyCompletePopup");var a=t("PopupBase"),n=(t("ResourceUtils"),t("CommonButton")),o=t("BattleParameterView"),r=(t("PromoteCharacterDetailFortifyAppendListView"),t("ViewUtils")),s=t("CommonUtils"),c=(t("GameConst"),cc.Enum({NORMAL:0,GREAT:1}));cc.Class({extends:a,properties:{matrixThumbnailNode:cc.Node,matrixThumbnailPrefab:cc.Prefab,beforeCharacterLvLabel:cc.Label,afterCharacterLvLabel:cc.Label,characterMaxLvLabel:cc.Label,beforeParameter:o,fortifyParameter:o,okBtn:n,popupAnimation:cc.Animation,beforeTotalPowerLabel:cc.Label,afterTotalPowerLabel:cc.Label,afterTotalPowerAnimation:cc.Animation},_characterModel:null,_characterModelAfter:null,onLoad:function(){this.okBtn.setTapEvent(this.close.bind(this))},openPromoteCharacterFortifyPopup:function(t,e,i,a){this.fortifyParameter.setScale(0),this._initPromoteCharacterFortifyPopup(t,e,a),this.open(this._playOpenedAnimation.bind(this,i))},_initPromoteCharacterFortifyPopup:function(t,e,i){this._characterModel=t,this._characterModelAfter=e,this.setCloseCallBack(i);var a=cc.instantiate(this.matrixThumbnailPrefab).getComponent("CharacterMatrixThumbnail");a.initCharacterMatrixThumbnail(this._characterModel.getCharacterMainMaster(),this._characterModel.getExceedLimit()),this.matrixThumbnailNode.addChild(a.node)},_playOpenedAnimation:function(t){t?this.popupAnimation.play(this.popupAnimation.getClips()[c.GREAT].name):this.popupAnimation.play(this.popupAnimation.getClips()[c.NORMAL].name),this.afterTotalPowerAnimation.play(),this.fortifyParameter.playAnimation(),this._setParameter()},_setParameter:function(){this.characterMaxLvLabel.string=this._characterModel.getMaxLevel(),this.beforeCharacterLvLabel.string=this._characterModel.getLevel(),this.beforeTotalPowerLabel.string=s.convertToCommaDelimited(this._characterModel.getTotalPower()),this.beforeParameter.initBattleParameterView(this._characterModel.getTotalHp(),this._characterModel.getTotalAtk(),this._characterModel.getTotalDef()),this.afterCharacterLvLabel.string=this._characterModelAfter.getLevel(),this.afterTotalPowerLabel.string=s.convertToCommaDelimited(this._characterModelAfter.getTotalPower()),this.fortifyParameter.initBattleParameterView(this._characterModelAfter.getTotalHp(),this._characterModelAfter.getTotalAtk(),this._characterModelAfter.getTotalDef()),this._statusFontColor()},_statusFontColor:function(){this.afterCharacterLvLabel.node.color=r.getParamChangeColor(this._characterModel.getLevel(),this._characterModelAfter.getLevel()),this.afterTotalPowerLabel.node.color=r.getParamChangeColor(this._characterModel.getHp()+this._characterModel.getAtk()+this._characterModel.getDef(),this._characterModelAfter.getHp()+this._characterModelAfter.getAtk()+this._characterModelAfter.getDef()),this.fortifyParameter.setColor(r.getParamChangeColor(this._characterModel.getHp(),this._characterModelAfter.getHp()),r.getParamChangeColor(this._characterModel.getAtk(),this._characterModelAfter.getAtk()),r.getParamChangeColor(this._characterModel.getDef(),this._characterModelAfter.getDef()))}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",PopupBase:"PopupBase",PromoteCharacterDetailFortifyAppendListView:"PromoteCharacterDetailFortifyAppendListView",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterFortifyConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"7928c1R+BFFbIbpMIu0dMWS","PromoteCharacterFortifyConfirmPopup");t("ResourceUtils");var a=t("CharacterUtils"),n=t("CommonUtils"),o=t("PromoteCharacterConfirmPopupBase");cc.Class({extends:o,properties:{},_characterModel:null,_materialCharacterModelArray:null,openPromoteCharacterFortifyConfirmPopup:function(t,e,i){this._characterModel=t,this._materialCharacterModelArray=e,this._initPromoteCharacterConfirmPopup(n.convertToCommaDelimited(a.calcTotalMaterialPlice(t,e.length)),i),this._setMaterials(e),this.open()},_setMaterials:function(t){for(var e in this.thumbnailParentNode.destroyAllChildren(),t){var i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");i.initCharacterMatrixThumbnail(t[e].getCharacterMainMaster(),t[e].getExceedLimit(),t[e].getLevel(),1),this.thumbnailParentNode.addChild(i.node)}}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",PromoteCharacterConfirmPopupBase:"PromoteCharacterConfirmPopupBase",ResourceUtils:"ResourceUtils"}],PromoteCharacterFortifyMaterialSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"b49a95K3NRH9ay4oTt3RG6+","PromoteCharacterFortifyMaterialSelectListView");var a=t("CharacterUtils"),n=t("WarehouseUtils"),o=t("DeckUtils"),r=t("Singleton"),s=t("ResourceUtils"),c=t("CommonButton"),l=t("CommonUtils"),u=t("WarehouseConvertUtils"),h=t("PromoteCharacterSelectListViewBase"),d=t("PromoteCharacterFortifyMaterialSelectSideView"),p=t("MatrixMultipleSelectCountUpPageView"),m=t("LocalDataConst"),g=t("WarehouseConst"),C=t("CharacterSortConst"),f=t("CharacterConst"),E=t("ItemConst"),T=t("ResourceConst"),S=t("StaticResourceConst"),R=t("GameConst");cc.Class({extends:h,properties:{materialNameLabel:cc.Label,materialCountLabel:cc.Label,materialMaxCountLabel:cc.Label,dataTypeLabel:cc.Label,warehouseSwitchBtn:c,countUpMatrixMaterialPageView:p,countUpMatrixCharacterPageView:p,promoteCharacterSelectSideView:d},_filterTypes:null,onLoad:function(){this.warehouseSwitchBtn.setTapEvent(this._onTapWarehouseSwitchBtn.bind(this))},initPromoteCharacterFortifyMaterialSelectListView:function(t,e){switch(this._root=t,this._filterTypes=e,_.some(this._filterTypes,function(t){return t===f.CHARACTER_TYPE.FORTIFY})?t.materialCharacterType=f.CHARACTER_TYPE.FORTIFY:t.materialCharacterType=f.CHARACTER_TYPE.NORMAL,t.materialCharacterType){case f.CHARACTER_TYPE.NORMAL:this._root.materialCharacterType=f.CHARACTER_TYPE.NORMAL,this.materialNameLabel.string="\u30e6\u30cb\u30c3\u30c8",this.materialCountLabel.string=""+a.getPlayableUserCharacterModelArray().length,this.materialMaxCountLabel.string=""+r.dao[r.USER].getCharacterMaxCount();break;case f.CHARACTER_TYPE.FORTIFY:this._root.materialCharacterType=f.CHARACTER_TYPE.FORTIFY,this.materialNameLabel.string="\u7d20\u6750",this.materialCountLabel.string=""+a.getNonPlayableUserCharacterModelArray().length,this.materialMaxCountLabel.string=""+R.MAX_MATERIAL_COUNT}switch(t.materialDataType){case f.MATERIAL_DATA_TYPE.CHARACTER:this.initListView(t,e);break;case f.MATERIAL_DATA_TYPE.WAREHOUSE:switch(t.materialCharacterType){case f.CHARACTER_TYPE.NORMAL:this.initWarehouseCharacterListView(this._root,this._filterTypes);break;case f.CHARACTER_TYPE.FORTIFY:this.initWarehouseMaterialListView(this._root,this._filterTypes)}}},initListView:function(t,e){this._filterTypes=e||[],t.materialDataType=f.MATERIAL_DATA_TYPE.CHARACTER,this._drawDataType(t.materialDataType,t.materialCharacterType),this.matrixPageView.node.active=!0,this.matrixPageView.setCallBackToIsImageActive(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this._super(t);var i=this._root.getMaterialModelArrayByFilterTypes(this._filterTypes);this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtn.bind(this),this._callbackToSideResetBtn.bind(this),this._callbackToSideThumbnail.bind(this)),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(i)},_getMaterialModelArray:function(){var t=r.dao.userCharacters;return t=_.filter(t,function(t){return t.getCharacterCd()!==this._root.getCurrentCharacterModel().getCharacterCd()&&_.some(this._filterTypes,function(e){return t.getCharacterType()===e})}.bind(this))},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView("getCharacterCd",this._getMaterialModelArray(),r.dao[r.USER].getCharacterMaxCount(),this._root.getMaterialModelArrayByFilterTypes(this._filterTypes),this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToCreateThumbnailNode:function(t,e){var i;e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");var n=a.convertViewSortType(this._root.getCurrentSortType(!1));return i.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),a.getSortParameter(t,n),n),i.setProtected(t.getIsProtect()),i.setBottomLabel(o.getDeckOrganizedText(t.getCharacterCd())),i.setEventBoost(t.getEventBoost()),i.node},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:"getIsSellMaterial"}),i.push({getterName:"getIsSkillMaterial"}),i.push({getterName:"getIsProtect"}),i.push({getterName:"getIsDeckUnit"}),i.push({getterName:C.SORT_FUNC_NAME[Object.keys(C.SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_callbackToSideThumbnail:function(t){this._setRecommendSelectMaterials(t)},_getCheckLimit:function(){return R.FORTIFY_MAX_MATERIAL},_callbackToThumbnail:function(t){this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_isMaterialEnabled:function(t){switch(t.getCharacterType()){case f.CHARACTER_TYPE.NORMAL:return!t.getIsProtect()&&!o.isDeckUnit(t.getCharacterCd());case f.CHARACTER_TYPE.FORTIFY:return!0;default:return!1}},_callbackIsThumbnailEnabled:function(t,e){return!!this._isMaterialEnabled(t)&&!(this._isLimitOver(t,e)&&!e.find(function(e){return e.getCharacterCd()===t.getCharacterCd()}))},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(s.getResource(T.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_BASE)).getComponent("SortFilterPopup")},_isLimitOver:function(t,e){return e.length>=this._getCheckLimit()||a.getCharacterLevelByTotalExp(this._root.getCurrentCharacterModel().getCharacterExp()+a.calcTotalMaterialExp(e,this._root.getCurrentCharacterModel()),this._root.getCurrentCharacterModel().getCharacterMainMaster().getExpType())>=this._root.getCurrentCharacterModel().getMaxLevel()},_callbackToSideExecute:function(t){cc.log("\u5f37\u5316\u78ba\u8a8d\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7")},_callbackToSideResetBtn:function(){this._root.resetSelectMaterials(),this.matrixPageView.clearCheckedModelArray(),this.matrixPageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_callbackToRecommendSelectBtn:function(){this._root.openRecommendedFortifyMaterialSelectPopup("\u4ee5\u4e0a\u306e\u6761\u4ef6\u3067\u3001\u9078\u629e\u3059\u308b\u30e6\u30cb\u30c3\u30c8/\u7d20\u6750\u3092\n\u6700\u5927"+R.FORTIFY_MAX_MATERIAL+"\u4f53\u9078\u629e\u3057\u307e\u3059\u3002",a.getFortifyMaterialCharacterModelArray(this._root.getCurrentCharacterCd()),R.FORTIFY_MAX_MATERIAL,this._root.getCurrentCharacterModel().getAttribute(),this._filterTypes,this._setRecommendSelectMaterials.bind(this))},_setRecommendSelectMaterials:function(t){var e=this.matrixPageView.getPageIndex();this.matrixPageView.initMatrixPageView("getCharacterCd",this._getMaterialModelArray(),r.dao[r.USER].getCharacterMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.matrixPageView.redraw(),this.matrixPageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},initWarehouseMaterialListView:function(t,e){this._root=t,this._filterTypes=e||[],t.materialDataType=f.MATERIAL_DATA_TYPE.WAREHOUSE,this._drawDataType(t.materialDataType,t.materialCharacterType),this.countUpMatrixMaterialPageView.node.active=!0,this.countUpMatrixMaterialPageView.setCallBackToIsImageActive(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToThumbnail(this._callbackToWarehouseThumbnail.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopupForWarehouseCharacter.bind(this)),this.countUpMatrixMaterialPageView.setCallBackToConvertSortText(n.convertSortTypeToTextForMaterial),this.countUpMatrixMaterialPageView.setCallBackToCreateSortConditions(n.createSortConditionsForCharacter),this.countUpMatrixMaterialPageView.setCallBackToCreateFilterConditions(n.createFilterConditionsForCharacter),this.countUpMatrixMaterialPageView.setSortParam(this._getCurrentSortTypeForWarehouseCharacter(),this._getCurrentSortOrderForWarehouseCharacter()),this.countUpMatrixMaterialPageView.setFilterCheckList(this._getCurrentFilterCheckListForWarehouseCharacter()),this.countUpMatrixMaterialPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilterForWarehouseCharacter.bind(this)),this.countUpMatrixMaterialPageView.initMatrixPageView("getMaterialCd","getCount",this._getWarehouseMaterialModelArray(),r.dao[r.USER].getCharacterMaxCount(),this._root.getMaterialSelectCountInfoArray(),this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtnForWarehouseMaterial.bind(this),this._callbackToSideResetBtnForWarehouseMaterial.bind(this),this._callbackToSideThumbnailForWarehouseMaterial.bind(this)),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(u.convertWarehouseModelCountInfoArrayToCharacters(this._root.getMaterialSelectCountInfoArray(),g.WAREHOUSE_STORAGE_TYPE.MATERIAL))},_getWarehouseMaterialModelArray:function(){switch(this._root.materialCharacterType){case f.CHARACTER_TYPE.NORMAL:if(Array.isArray(r.dao.warehouseCharacters))return _.filter(r.dao.warehouseCharacters,function(t){return t.getCount()>0});break;case f.CHARACTER_TYPE.FORTIFY:if(Array.isArray(r.dao.warehouseMaterials))return _.filter(r.dao.warehouseMaterials,function(t){return t.getCount()>0&&t.getItemType()===E.ITEM_TYPE.CHARACTER&&t.getMaterialType()===f.CHARACTER_TYPE.FORTIFY})}return[]},_callbackIsWarehouseThumbnailEnabled:function(t,e){var i=u.convertWarehouseModelCountInfoArrayToCharacters(e,g.WAREHOUSE_STORAGE_TYPE.CHARACTER);return!this._isLimitOver(t,i)},_callbackToWarehouseThumbnail:function(t,e){this._root.setMaterialSelectCountInfoArray(this.countUpMatrixMaterialPageView.getCountInfoArray()),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(u.convertWarehouseModelCountInfoArrayToCharacters(this.countUpMatrixMaterialPageView.getCountInfoArray(),g.WAREHOUSE_STORAGE_TYPE.MATERIAL))},_callbackToCreateWarehouseMaterialThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("WarehouseMaterialMatrixThumbnail")).resetWarehouseMaterialMatrixThumbnail():i=cc.instantiate(s.getResource(S.WAREHOUSE_MATERIAL_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("WarehouseMaterialMatrixThumbnail"),i.initWarehouseMaterialMatrixThumbnail(t.getMaterialId(),t.getAttribute(),t.getRarity(),t.getCategory()),i.setParameter("x",t.getCount()),i.node},_onTapWarehouseSwitchBtn:function(){switch(this._toggleDataType(),this._resetActiveListView(),this._root.materialDataType){case f.MATERIAL_DATA_TYPE.CHARACTER:this.initListView(this._root,this._filterTypes);break;case f.MATERIAL_DATA_TYPE.WAREHOUSE:switch(this._root.materialCharacterType){case f.CHARACTER_TYPE.NORMAL:this.initWarehouseCharacterListView(this._root,this._filterTypes);break;case f.CHARACTER_TYPE.FORTIFY:this.initWarehouseMaterialListView(this._root,this._filterTypes)}}},_toggleDataType:function(){switch(this._root.materialDataType){case f.MATERIAL_DATA_TYPE.CHARACTER:this._root.materialDataType=f.MATERIAL_DATA_TYPE.WAREHOUSE;break;case f.MATERIAL_DATA_TYPE.WAREHOUSE:this._root.materialDataType=f.MATERIAL_DATA_TYPE.CHARACTER}},_drawDataType:function(t,e){switch(t){case f.MATERIAL_DATA_TYPE.CHARACTER:switch(e){case f.CHARACTER_TYPE.NORMAL:this.dataTypeLabel.string="\u30e6\u30cb\u30c3\u30c8";break;case f.CHARACTER_TYPE.FORTIFY:this.dataTypeLabel.string="\u7d20\u6750"}break;case f.MATERIAL_DATA_TYPE.WAREHOUSE:this.dataTypeLabel.string="\u5009\u5eab"}},_resetActiveListView:function(){this._root.resetSelectMaterials(),this.matrixPageView.node.active=!1,this.countUpMatrixCharacterPageView.node.active=!1,this.countUpMatrixMaterialPageView.node.active=!1},_callbackToSideResetBtnForWarehouseMaterial:function(){this._root.resetSelectMaterials(),this.countUpMatrixMaterialPageView.clearCountInfoArray(),this.countUpMatrixMaterialPageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_callbackToRecommendSelectBtnForWarehouseMaterial:function(){this._root.openRecommendedFortifyMaterialSelectPopup("\u4ee5\u4e0a\u306e\u6761\u4ef6\u3067\u3001\u9078\u629e\u3059\u308b\u30e6\u30cb\u30c3\u30c8/\u7d20\u6750\u3092\n\u6700\u5927"+R.FORTIFY_MAX_MATERIAL+"\u4f53\u9078\u629e\u3057\u307e\u3059\u3002",u.convertWarehouseModelsToCharacters(g.WAREHOUSE_STORAGE_TYPE.MATERIAL,f.CHARACTER_TYPE.FORTIFY),R.FORTIFY_MAX_MATERIAL,this._root.getCurrentCharacterModel().getAttribute(),this._filterTypes,this._setRecommendSelectMaterialsForWarehouseMaterial.bind(this))},_callbackToSideThumbnailForWarehouseMaterial:function(t){this._setRecommendSelectMaterialsForWarehouseMaterial(t)},_setRecommendSelectMaterialsForWarehouseMaterial:function(t){var e=this.countUpMatrixMaterialPageView.getPageIndex(),i=u.convertCharactersToWarehouseModelCountInfoArray(t,g.WAREHOUSE_STORAGE_TYPE.MATERIAL);this._root.setMaterialSelectCountInfoArray(i),this.countUpMatrixMaterialPageView.initMatrixPageView("getMaterialCd","getCount",this._getWarehouseMaterialModelArray(),r.dao[r.USER].getCharacterMaxCount(),i,this._getCheckLimit(),this._callbackToCreateWarehouseMaterialThumbnailNode.bind(this)),this.countUpMatrixMaterialPageView.redraw(),this.countUpMatrixMaterialPageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},initWarehouseCharacterListView:function(t,e){this._root=t,this._filterTypes=e||[],t.materialDataType=f.MATERIAL_DATA_TYPE.WAREHOUSE,this._drawDataType(t.materialDataType,t.materialCharacterType),this.countUpMatrixCharacterPageView.node.active=!0,this.countUpMatrixCharacterPageView.setCallBackToIsImageActive(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixCharacterPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixCharacterPageView.setCallBackToThumbnail(this._callbackToWarehouseCharacterThumbnail.bind(this)),this.countUpMatrixCharacterPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopupForWarehouseCharacter.bind(this)),this.countUpMatrixCharacterPageView.setCallBackToConvertSortText(n.convertSortTypeToTextForMaterial),this.countUpMatrixCharacterPageView.setCallBackToCreateSortConditions(n.createSortConditionsForCharacter),this.countUpMatrixCharacterPageView.setCallBackToCreateFilterConditions(n.createFilterConditionsForCharacter),this.countUpMatrixCharacterPageView.setSortParam(this._getCurrentSortTypeForWarehouseCharacter(),this._getCurrentSortOrderForWarehouseCharacter()),this.countUpMatrixCharacterPageView.setFilterCheckList(this._getCurrentFilterCheckListForWarehouseCharacter()),this.countUpMatrixCharacterPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilterForWarehouseCharacter.bind(this)),this.countUpMatrixCharacterPageView.initMatrixPageView("getCharacterCd","getCount",this._getWarehouseMaterialModelArray(),r.dao[r.USER].getCharacterMaxCount(),this._root.getMaterialSelectCountInfoArray(),this._getCheckLimit(),this._callbackToCreateWarehouseCharacterThumbnailNode.bind(this)),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtnForWarehouseCharacter.bind(this),this._callbackToSideResetBtnForWarehouseCharacter.bind(this),this._callbackToSideThumbnailForWarehouseCharacter.bind(this)),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(u.convertWarehouseModelCountInfoArrayToCharacters(this._root.getMaterialSelectCountInfoArray(),g.WAREHOUSE_STORAGE_TYPE.CHARACTER))},_callbackToWarehouseCharacterThumbnail:function(t,e){this._root.setMaterialSelectCountInfoArray(this.countUpMatrixCharacterPageView.getCountInfoArray()),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(u.convertWarehouseModelCountInfoArrayToCharacters(this.countUpMatrixCharacterPageView.getCountInfoArray(),g.WAREHOUSE_STORAGE_TYPE.CHARACTER))},_callbackToCreateSortFilterPopupForWarehouseCharacter:function(){return cc.instantiate(s.getResource(T.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_CHARACTER_WAREHOUSE)).getComponent("SortFilterPopup")},_getCurrentSortTypeForWarehouseCharacter:function(){return l.loadLocalStorage(m.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_CHARACTER,g.WAREHOUSE_STORAGE_CHARACTER_SORT_TYPE.UPDATING,m.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrderForWarehouseCharacter:function(){return l.loadLocalStorage(m.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_CHARACTER,R.SORT_ORDER.ASC,m.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_getCurrentFilterCheckListForWarehouseCharacter:function(){return r.localData[m.FILTER.TEN.WAREHOUSE_STORAGE_CHARACTER]},_callbackToSortAndFilterForWarehouseCharacter:function(t,e,i){l.saveLocalStorage(m.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_CHARACTER,t),l.saveLocalStorage(m.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_CHARACTER,e)},_callbackToCreateWarehouseCharacterThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(s.getResource(S.CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("CharacterMatrixThumbnail"),i.initCharacterMatrixThumbnail(t.getMainMaster(),t.getExceedLimit(),void 0,void 0),i.setBottomParams("x",t.getCount()),i.node},_callbackToRecommendSelectBtnForWarehouseCharacter:function(){this._root.openRecommendedFortifyMaterialSelectPopup("\u4ee5\u4e0a\u306e\u6761\u4ef6\u3067\u3001\u9078\u629e\u3059\u308b\u30e6\u30cb\u30c3\u30c8/\u7d20\u6750\u3092\n\u6700\u5927"+R.FORTIFY_MAX_MATERIAL+"\u4f53\u9078\u629e\u3057\u307e\u3059\u3002",u.convertWarehouseModelsToCharacters(g.WAREHOUSE_STORAGE_TYPE.CHARACTER,f.CHARACTER_TYPE.NORMAL),R.FORTIFY_MAX_MATERIAL,this._root.getCurrentCharacterModel().getAttribute(),this._filterTypes,this._setRecommendSelectMaterialsForWarehouseCharacter.bind(this))},_callbackToSideResetBtnForWarehouseCharacter:function(){this._root.resetSelectMaterials(),this.countUpMatrixCharacterPageView.clearCountInfoArray(),this.countUpMatrixCharacterPageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_callbackToSideThumbnailForWarehouseCharacter:function(t){this._setRecommendSelectMaterialsForWarehouseCharacter(t)},_setRecommendSelectMaterialsForWarehouseCharacter:function(t){var e=this.countUpMatrixCharacterPageView.getPageIndex(),i=u.convertCharactersToWarehouseModelCountInfoArray(t,g.WAREHOUSE_STORAGE_TYPE.CHARACTER);this._root.setMaterialSelectCountInfoArray(i),this.countUpMatrixCharacterPageView.initMatrixPageView("getCharacterCd","getCount",this._getWarehouseMaterialModelArray(),r.dao[r.USER].getCharacterMaxCount(),i,this._getCheckLimit(),this._callbackToCreateWarehouseCharacterThumbnailNode.bind(this)),this.countUpMatrixCharacterPageView.redraw(),this.countUpMatrixCharacterPageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",MatrixMultipleSelectCountUpPageView:"MatrixMultipleSelectCountUpPageView",PromoteCharacterFortifyMaterialSelectSideView:"PromoteCharacterFortifyMaterialSelectSideView",PromoteCharacterSelectListViewBase:"PromoteCharacterSelectListViewBase",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",WarehouseConst:"WarehouseConst",WarehouseConvertUtils:"WarehouseConvertUtils",WarehouseUtils:"WarehouseUtils"}],PromoteCharacterFortifyMaterialSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"352201U/bFHeYiN5liZq5FN","PromoteCharacterFortifyMaterialSelectSideView");var a=t("CommonButton"),n=t("CommonUtils"),o=(t("EquipmentUtils"),t("CharacterUtils")),r=(t("ResourceUtils"),t("GameConst")),s=t("CharacterConst"),c=t("MaterialCharacterInfoView");cc.Class({extends:cc.Component,properties:{materialCharacterInfoView:c,thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,expLabel:cc.Label,expOverBalloonNode:cc.Node,expOverLabel:cc.Label,priceLabel:cc.Label,recommendSelectBtn:a,resetBtn:a,executeBtn:a},_root:null,_materialCharacterModelArray:null,_callbackToRecommendSelectBtn:null,_callbackToResetBtn:null,_callbackToSideThumbnail:null,onLoad:function(){this.recommendSelectBtn.setTapEvent(this._onTapRecommentSelectBtn.bind(this)),this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacerSelectSideView:function(t,e,i,a){this._root=t,this._callbackToRecommendSelectBtn=e,this._callbackToResetBtn=i,this._callbackToSideThumbnail=a,this.priceLabel.string="0",this._root.getCurrentCharacterModel().getLevel()<this._root.getCurrentCharacterModel().getMaxLevel()?(this.recommendSelectBtn.switchBtnImage(!0),this.recommendSelectBtn.setTouchEnable(!0)):(this.recommendSelectBtn.switchBtnImage(!1),this.recommendSelectBtn.setTouchEnable(!1)),this.materialCharacterInfoView.initMaterialCharacterInfoView(t,this._root.getCurrentCharacterModel()),this.expOverBalloonNode.active=!1,this._expOver(),this._drawMaterials([])},drawPromoteCharacterSelectSideView:function(t){this._drawMaterials(t),this.priceLabel.string=n.convertToCommaDelimited(o.calcTotalMaterialPlice(this._root.getCurrentCharacterModel(),t.length)),this.expLabel.string=n.convertToCommaDelimited(o.calcTotalMaterialExp(t,this._root.getCurrentCharacterModel()))},_drawMaterials:function(t){this._materialCharacterModelArray=t,this.executeBtn.switchBtnImage(!0),this.executeBtn.setTouchEnable(!0),t.length>0?(this.resetBtn.switchBtnImage(!0),this.resetBtn.setTouchEnable(!0)):(this.resetBtn.switchBtnImage(!1),this.resetBtn.setTouchEnable(!1));for(var e=0;e<r.FORTIFY_MAX_MATERIAL;e+=1){var i;this.thumbnailParentNode.children[e]?((i=this.thumbnailParentNode.children[e].getComponent("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail(),i.initPlainMatrixThumbnail()):(i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.thumbnailParentNode.addChild(i.node)),t[e]?(i.initCharacterMatrixThumbnail(t[e].getCharacterMainMaster(),t[e].getExceedLimit(),t[e].getLevel(),1),i.setCallbackToThumbnailBtn(function(t){var e=this._materialCharacterModelArray.filter(function(e){return e.getCharacterCd()!==t.getCharacterCd()});this._callbackToSideThumbnail(e)}.bind(this,t[e])),i.initDisablePlainMatrixThumbnail()):i.initPlainMatrixThumbnail()}this.materialCharacterInfoView.drawLevelProgress(s.PROMOTE_TYPE.FORTIFY,t),this._expOver()},_expOver:function(){var t=o.calcRemainingExpForMaxLevelByMaxLevelAndTotalExp(this._root.getCurrentCharacterModel().getMaxLevel(),this._root.getCurrentCharacterModel().getCharacterExp(),this._root.getCurrentCharacterModel().getCharacterMainMaster().getExpType()),e=o.calcTotalMaterialExp(this._materialCharacterModelArray,this._root.getCurrentCharacterModel())-t;e>0?(this.expOverBalloonNode.active=!0,this.expOverLabel.string=n.convertToCommaDelimited(e)):this.expOverBalloonNode.active=!1},_onTapRecommentSelectBtn:function(){this._callbackToRecommendSelectBtn()},_onTapResetBtn:function(){this._callbackToResetBtn()},_onTapExecuteBtn:function(){this._root.setMaterialCharacterModelArray(this._materialCharacterModelArray),this._root.popScene()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",MaterialCharacterInfoView:"MaterialCharacterInfoView",ResourceUtils:"ResourceUtils"}],PromoteCharacterFortifyMaterialSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"a122dBaOxhMdpQbl9oVVef9","PromoteCharacterFortifyMaterialSelectSubRoot");var a=t("WindowBase"),n=(t("EquipmentUtils"),t("PromoteCharacterFortifyMaterialSelectListView"));cc.Class({extends:a,properties:{promoteCharacterFortifyMaterialSelectListView:n},initPromoteCharacterFortifyMaterialSelectSubRoot:function(t,e){this.promoteCharacterFortifyMaterialSelectListView.initPromoteCharacterFortifyMaterialSelectListView(t,e)}});cc._RF.pop()},{EquipmentUtils:"EquipmentUtils",PromoteCharacterFortifyMaterialSelectListView:"PromoteCharacterFortifyMaterialSelectListView",WindowBase:"WindowBase"}],PromoteCharacterMaterialItemDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"db69fq2qENC5IY7yI41yvI9","PromoteCharacterMaterialItemDetailPopup");var a=t("PopupBase"),n=t("ResourceUtils"),o=t("CommonButton");cc.Class({extends:a,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,nameLabel:cc.Label,descriptionLabel:cc.Label,okBtn:o},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openPromoteCharacterMaterialItemDetailPopup:function(t){this._setThumbnail(t),this.nameLabel.string=t.getName(),this.descriptionLabel.string=t.getText(),this.open()},_setThumbnail:function(t){this.thumbnailParentNode.destroyAllChildren();var e=cc.instantiate(this.thumbnailPrefab).getComponent("ItemMatrixThumbnail");e.setMainImage(n.getFileNameItemThumbnail(t.getItemId())),this.thumbnailParentNode.addChild(e.node)},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],PromoteCharacterMaterialSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"38209mt/z5IBr3I8S1XH9Ag","PromoteCharacterMaterialSelectSideView");var a=t("WindowBase"),n=(t("CharacterSortConst"),t("CharacterConst")),o=(t("ResourceUtils"),t("StaticResourceConst"),t("Singleton")),r=t("LocalDataConst"),s=t("CharacterUtils"),c=t("CommonButton"),l=t("CommonUtils");t("CharacterLevelProgressView"),t("CharacterExceedLimitProgressView"),cc.Class({extends:a,properties:{content:cc.Node,targetCharacterThumbnailParentNode:cc.Node,expNameLabel:cc.Label,totalExpLabel:cc.Label,totalPliceLabel:cc.Label,characterLevelProgressViewPrefab:cc.Prefab,characterLevelProgressViewParentNode:cc.Node,characterExceedLimitProgressViewPrefab:cc.Prefab,characterExceedLimitProgressViewParentNode:cc.Node,characterThumbnailPrefab:cc.Prefab,resetBtn:c,executeBtn:c},_promoteType:null,_characterLevelProgressView:null,_characterExceedLimitProgressView:null,initPromoteCharacterMaterialSelectSideView:function(t,e,i,a,n){this._promoteType=t,this._initProgressView(t,i),this._initTargetThumbnail(e),this._initButtons(a,n),this.drawPromoteCharacterMaterialSelectSideView(e,i)},drawPromoteCharacterMaterialSelectSideView:function(t,e){this.drawPromoteCharacterMaterialSelectSideViewContent(e),this.drawLevelProgressView(t,e),this.drawExceedLimitProgressView(t,e),this.drawTotalExpLabel(t,e),this.drawTotalPliceLabel(t,e)},_initProgressView:function(t,e){switch(t){case n.PROMOTE_TYPE.FORTIFY:this._addLevelProgressView(),this.expNameLabel.string="\u53d6\u5f97\u7d4c\u9a13\u5024";break;case n.PROMOTE_TYPE.EXCEED_LIMIT:this._addExceedLimitProgressView(),this.expNameLabel.string="\u53d6\u5f97\u899a\u9192\u5024"}},_addLevelProgressView:function(){this._characterLevelProgressView||(this._characterLevelProgressView=cc.instantiate(this.characterLevelProgressViewPrefab).getComponent("CharacterLevelProgressView"),this.characterLevelProgressViewParentNode.addChild(this._characterLevelProgressView.node))},_addExceedLimitProgressView:function(){this._characterExceedLimitProgressView||(this._characterExceedLimitProgressView=cc.instantiate(this.characterExceedLimitProgressViewPrefab).getComponent("CharacterExceedLimitProgressView"),this.characterExceedLimitProgressViewParentNode.addChild(this._characterExceedLimitProgressView.node))},_initTargetThumbnail:function(t){this.targetCharacterThumbnailParentNode.addChild(this._createMatrixThumbnailNode(t))},_initButtons:function(t,e){this.resetBtn.setTapEvent(function(){t&&t()},c.SE_NAME.CANCEL),this.executeBtn.setTapEvent(function(){e&&e()})},drawPromoteCharacterMaterialSelectSideViewContent:function(t){for(var e in this.content.destroyAllChildren(),t)this.content.addChild(this._createMatrixThumbnailNode(t[e]))},drawLevelProgressView:function(t,e){if(this._characterLevelProgressView){var i,a=t.getLevel(),o=s.calcTotalMaterialExp(e,t),r=t.getCharacterExp()+o,c=s.getCharacterLevelByTotalExp(r,t.getCharacterMainMaster().getExpType()),l=s.calcNeedExpForNextLevelByTotalExp(r,t.getCharacterMainMaster().getExpType()),u=s.calcExpRateForNextLevelByTotalExp(t.getCharacterExp(),t.getCharacterMainMaster().getExpType()),h=s.calcExpRateForNextLevelByTotalExp(r,t.getCharacterMainMaster().getExpType());h=a<c?1:h,i=a<c?n.PROMOTE_TYPE.FORTIFY:n.PROMOTE_TYPE.STATUS,this._characterLevelProgressView.initCharacterLevelProgressView(i,a,c,t.getMaxLevel(),0,l,u,h)}},drawExceedLimitProgressView:function(t,e){this._characterExceedLimitProgressView&&this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(t.getExceedLimit(),t.getExceedLimit()+e.length,t.getExceedLimitMaxCount())},drawTotalExpLabel:function(t,e){this.totalExpLabel.string=l.convertToCommaDelimited(this._getTotalExp(t,e))},drawTotalPliceLabel:function(t,e){this.totalPliceLabel.string=l.convertToCommaDelimited(s.calcTotalMaterialPlice(t,e.length))},_createMatrixThumbnailNode:function(t){var e=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail"),i=s.convertViewSortType(o.localData[r.SORT_TYPE]);return e.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),s.getSortParameter(t,i),i),e.node},_getTotalExp:function(t,e){switch(this._promoteType){case n.PROMOTE_TYPE.FORTIFY:return s.calcTotalMaterialExp(e,t);case n.PROMOTE_TYPE.EXCEED_LIMIT:return s.calcTotalMaterialExceedLimitExp(e,t,!0)}return 0}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterExceedLimitProgressView:"CharacterExceedLimitProgressView",CharacterLevelProgressView:"CharacterLevelProgressView",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",WindowBase:"WindowBase"}],PromoteCharacterMaterialSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"21eb2YfLutAp5kSwfNX3gKc","PromoteCharacterMaterialSelectSubRoot");var a=t("WindowBase"),n=t("CharacterUtils"),o=t("GameConst"),r=(t("CharacterConst"),t("ResourceUtils")),s=t("Singleton"),c=t("LocalDataConst"),l=t("CharacterSortConst"),u=t("CharacterFilterConst"),h=t("MatrixMultipleSelectPageView"),d=t("PromoteCharacterMaterialSelectSideView");cc.Class({extends:a,properties:{matrixPageView:h,promoteCharacterMaterialSelectSideView:d,characterThumbnailPrefab:cc.Prefab},_root:null,initPromoteCharacterMaterialSelectSubRoot:function(t,e){this._root=t,this._initMatrixPageView(t),this._initPromoteCharacterMaterialSelectSideView(t,e),t.resetSelectMaterials()},_initMatrixPageView:function(t){this.matrixPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToIsImageActive(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToConvertSortText(n.convertSortTypeToText),this.matrixPageView.setCallBackToCreateSortConditions(this._callbackToCreateSortConditions.bind(this)),this.matrixPageView.setCallBackToCreateFilterConditions(this._callbackToCreateFilterConditions.bind(this)),this.matrixPageView.setCallBackToThumbnail(this._callbackToThumbnailBtn.bind(this)),this.matrixPageView.initMatrixPageView("getCharacterCd",n.getMaterialCharacterModelArray(t.getCurrentCharacterCd()),s.dao.userBasicData.getCharacterMaxCount(),t.getMaterialCharacterModelArray(),o.FORTIFY_MAX_MATERIAL,this._callbackToCreateThumbnailNode.bind(this))},_initPromoteCharacterMaterialSelectSideView:function(t,e){this.promoteCharacterMaterialSelectSideView.initPromoteCharacterMaterialSelectSideView(e,t.getCurrentCharacterModel(),t.getMaterialCharacterModelArray(),this._callbackToResetBtn.bind(this),this._callbackToExecuteBtn.bind(this))},_getThumbnailParam:function(t,e){return n.getSortParameter(t,e)},_callbackToThumbnailBtn:function(t){this.promoteCharacterMaterialSelectSideView.drawPromoteCharacterMaterialSelectSideView(this._root.getCurrentCharacterModel(),t)},_callbackToResetBtn:function(){this.matrixPageView.clearCheckedModelArray(),this.matrixPageView.redraw(),this.promoteCharacterMaterialSelectSideView.drawPromoteCharacterMaterialSelectSideViewContent(this.matrixPageView.getCheckedModelArray())},_callbackToExecuteBtn:function(){this._root.setMaterialCharacterModelArray(this.matrixPageView.getCheckedModelArray()),this._root.popScene()},_callbackToGetFileName:function(t){return r.getFileNameCharacterThumbnail(t.getCharacterId())},_callbackToCreateThumbnailNode:function(t,e){var i;e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail");var a=n.convertViewSortType(s.localData[c.SORT_TYPE]);return i.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),this._getThumbnailParam(t,a),a),i.setEventBoost(t.getEventBoost()),i.node},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:l.SORT_FUNC_NAME[Object.keys(l.SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_callbackToCreateFilterConditions:function(t){for(var e=[],i=u.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:u.FILTER_FUNC_NAME[Object.keys(u.FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(u.FILTER_GROUP_END).indexOf(t)>=0},_callbackIsThumbnailEnabled:function(t,e){return!t.getIsProtect()&&!(e.length>=o.FORTIFY_MAX_MATERIAL&&!e.find(function(e){return e.getCharacterCd()===t.getCharacterCd()}))}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterFilterConst:"CharacterFilterConst",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MatrixMultipleSelectPageView:"MatrixMultipleSelectPageView",PromoteCharacterMaterialSelectSideView:"PromoteCharacterMaterialSelectSideView",ResourceUtils:"ResourceUtils",Singleton:"Singleton",WindowBase:"WindowBase"}],PromoteCharacterProtectSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"d60cd7xLnZJPYvbC1PWdK5Y","PromoteCharacterProtectSelectListView");var a=t("CharacterUtils"),n=t("Singleton"),o=t("ResourceUtils"),r=t("ResourceConst"),s=t("PromoteCharacterSelectListViewBase");cc.Class({extends:s,properties:{},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView(a.getPlayableUserCharacterModelArray(),n.dao[n.USER].getCharacterMaxCount(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(o.getResource(r.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_BASE)).getComponent("SortFilterPopup")},_callbackToThumbnail:function(t,e){this._root.requestProtect([e],function(){this.matrixPageView.setDataList(a.getPlayableUserCharacterModelArray()),this.matrixPageView.sortAndFilter(),this.matrixPageView.redrawSimply()}.bind(this))}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",PromoteCharacterSelectListViewBase:"PromoteCharacterSelectListViewBase",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],PromoteCharacterRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"7ebc5beflVOAajyWpwYyDT3","PromoteCharacterRootBase");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("CharacterUtils"),r=t("CommonUtils"),s=t("DeckUtils"),c=t("LocalDataConst"),l=t("CharacterFilterConst"),u=t("EquipmentSortConst"),h=t("CharacterSortConst"),d=t("GameConst"),p=t("ItemConst"),m=t("CharacterConst");cc.Class({extends:a,properties:{promoteCharacterDetailPopupPrefab:cc.Prefab,recommendedSelectPopupPrefab:cc.Prefab,recommendedFortifyMaterialSelectPopupPrefab:cc.Prefab,recommendedSellMaterialSelectPopupPrefab:cc.Prefab,promoteCharacterEquipmentSelectPopupPrefab:cc.Prefab,promoteCharacterEquipmentSwapPopupPrefab:cc.Prefab,equipmentDetailPopupPrefab:cc.Prefab},_userCharacterModelMap:null,_currentCharacterCd:null,_currentFilterCheckList:null,_promoteCharacterDetailPopup:null,_recommendedMaterialSelectPopup:null,_recommendedFortifyMaterialSelectPopup:null,_recommendedSellMaterialSelectPopup:null,_equipmentDetailPopup:null,initData:function(){this.reload(),this._currentCharacterCd="",this._currentFilterCheckList=n.localData[c.FILTER.THIRTEEN.CHARACTER]},reload:function(){this._userCharacterModelMap=o.createUserCharacterModelMap()},setSortAndFilterParam:function(t,e,i,a){if(a){r.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,t),r.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_EQUIPMENT,e);for(var o=0;o<i.length;o+=1)n.localData[c.FILTER.TWELVE.EQUIPMENT][o]=i[o],this._currentFilterCheckList[o]=i[o]}else{r.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_CHARACTER,t),r.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_CHARACTER,e);for(o=0;o<i.length;o+=1)n.localData[c.FILTER.THIRTEEN.CHARACTER][o]=i[o],this._currentFilterCheckList[o]=i[o]}},getCurrentSortType:function(t){return t?r.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,u.SORT_TYPE.GETTING,c.LOCAL_STORAGE_GET_TYPE.INTEGER):r.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_CHARACTER,h.SORT_TYPE.GETTING,c.LOCAL_STORAGE_GET_TYPE.INTEGER)},getCurrentSortOrder:function(t){return t?r.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_EQUIPMENT,d.SORT_ORDER.ASC,c.LOCAL_STORAGE_GET_TYPE.BOOLEAN):r.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_CHARACTER,d.SORT_ORDER.ASC,c.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},getCurrentFilterCheckList:function(){return this._currentFilterCheckList},setCurrentCharacterCd:function(t){this._currentCharacterCd=t+""},getCurrentCharacterCd:function(){return this._currentCharacterCd},getCurrentCharacterModel:function(){return this._userCharacterModelMap[this.getCurrentCharacterCd()]},openPromoteCharacterDetailPopup:function(t){this.closePromoteCharacterDetailPopup(),this._promoteCharacterDetailPopup=cc.instantiate(this.promoteCharacterDetailPopupPrefab).getComponent("PromoteCharacterDetailPopup"),this._promoteCharacterDetailPopup.openPromoteCharacterDetailPopup(this,t)},closePromoteCharacterDetailPopup:function(){this._promoteCharacterDetailPopup&&(this._promoteCharacterDetailPopup.close(),this._promoteCharacterDetailPopup=null)},openRecommendedFortifyMaterialSelectPopup:function(t,e,i,a,o,r){this.closeRecommendedFortifyMaterialSelectPopup(),this._recommendedFortifyMaterialSelectPopup=cc.instantiate(this.recommendedFortifyMaterialSelectPopupPrefab).getComponent("RecommendedMaterialSelectPopup"),this._recommendedFortifyMaterialSelectPopup.openRecommendedMaterialSelectPopup(t,n.localData[c.FILTER.FIVE.CHARACTER_FORTIFY_RECOMMEND],function(t){n.localData[c.FILTER.FIVE.CHARACTER_FORTIFY_RECOMMEND]=t.slice(),r(this._createRecommendFortifyMaterialArray(e,t,i,a,o))}.bind(this))},closeRecommendedFortifyMaterialSelectPopup:function(){this._recommendedFortifyMaterialSelectPopup&&(this._recommendedFortifyMaterialSelectPopup.close(),this._recommendedFortifyMaterialSelectPopup=null)},openRecommendedSellMaterialSelectPopup:function(t,e,i){this.closeRecommendedSellMaterialSelectPopup(),this._recommendedSellMaterialSelectPopup=cc.instantiate(this.recommendedSellMaterialSelectPopupPrefab).getComponent("RecommendedMaterialSelectPopup"),this._recommendedSellMaterialSelectPopup.openRecommendedMaterialSelectPopup(t,n.localData[c.FILTER.SEVEN.CHARACTER_SELL_RECOMMEND],function(t){n.localData[c.FILTER.SEVEN.CHARACTER_SELL_RECOMMEND]=t.slice(),i(this._createRecommendSellMaterialArray(t,e))}.bind(this))},closeRecommendedSellMaterialSelectPopup:function(){this._recommendedSellMaterialSelectPopup&&(this._recommendedSellMaterialSelectPopup.close(),this._recommendedSellMaterialSelectPopup=null)},openPromoteCharacterEquipmentSelectPopup:function(t,e){this.closePromoteCharacterEquipmentSelectPopup(),this._promoteCharacterEquipmentSelectPopup=cc.instantiate(this.promoteCharacterEquipmentSelectPopupPrefab).getComponent("PromoteCharacterEquipmentSelectPopup"),this._promoteCharacterEquipmentSelectPopup.openPromoteCharacterEquipmentSelectPopup(this,t,e)},closePromoteCharacterEquipmentSelectPopup:function(){this._promoteCharacterEquipmentSelectPopup&&(this._promoteCharacterEquipmentSelectPopup.close(),this._promoteCharacterEquipmentSelectPopup=null)},openPromoteCharacterEquipmentSwapPopup:function(t,e,i){this.cloePromoteCharacterEquipmentSwapPopup(),this._promoteCharacterEquipmentSwapPopup=cc.instantiate(this.promoteCharacterEquipmentSwapPopupPrefab).getComponent("PromoteEquipmentSwapPopup"),this._promoteCharacterEquipmentSwapPopup.openPromoteEquipmentSwapPopup(this,t,e,i)},cloePromoteCharacterEquipmentSwapPopup:function(){this._promoteCharacterEquipmentSwapPopup&&(this._promoteCharacterEquipmentSwapPopup.close(),this._promoteCharacterEquipmentSwapPopup=null)},openEquipmentDetailPopup:function(t,e){this.closeEquipmentDetailPopup(),this._equipmentDetailPopup=cc.instantiate(this.equipmentDetailPopupPrefab).getComponent("EquipmentDetailPopup"),this._equipmentDetailPopup.openEquipmentDetailPopup(t,e)},closeEquipmentDetailPopup:function(){this._equipmentDetailPopup&&(this._equipmentDetailPopup.close(),this._equipmentDetailPopup=null)},requestChangeProtect:function(t,e){n.CharacterService.changeProtect([t],function(){this.reload(),e&&e()}.bind(this))},requestEquip:function(t,e){n.CharacterService.equip(t,function(){this.reload(),e&&e()}.bind(this))},createEquipCharactersEquipmentParameter:function(t,e,i){var a=o.getCharacterModelByCharacterCd(t).getCharacterEquipmentInfoArray(),n=_.map(a,function(t){return t.equipmentModel?t.equipmentModel.getEquipmentCd():void 0});return n[i]!==e?n[i]=e:n.push(e),n=_.filter(n,function(t){return t}),[this.createCharacterEquipmentParameter(t,_.uniq(n),[])]},createReleaseCharactersEquipmentParameter:function(t){var e=t.characterModel.getCharacterEquipmentInfoArray(),i=_.map(e,function(t){return t.equipmentModel?t.equipmentModel.getEquipmentCd():void 0});return i=_.filter(i,function(e){return e&&e!==t.equipmentModel.getEquipmentCd()}),[this.createCharacterEquipmentParameter(t.characterModel.getCharacterCd(),_.uniq(i),[])]},createSwapCharactersEquipmentParameter:function(t,e){var i;i=e.equipmentModel?this.createEquipCharactersEquipmentParameter(t.characterModel.getCharacterCd(),e.equipmentModel.getEquipmentCd(),t.position):this.createReleaseCharactersEquipmentParameter(t);var a=this.createEquipCharactersEquipmentParameter(e.characterModel.getCharacterCd(),t.equipmentModel.getEquipmentCd(),e.position);return i[0].characterCd===a[0].characterCd?(Array.prototype.push.apply(a[0].equipmentWeaponCds,i[0].equipmentWeaponCds),Array.prototype.push.apply(a[0].equipmentProtectorCds,i[0].equipmentProtectorCds),a):i.concat(a)},createCharacterEquipmentParameter:function(t,e,i){return{characterCd:t,equipmentWeaponCds:e,equipmentProtectorCds:i}},_createRecommendFortifyMaterialArray:function(t,e,i,a,n){this._recommendMaterialArray=t;var s=e.pop();this._recommendMaterialArray=r.filterModels(_.filter(this._recommendMaterialArray,function(t){return _.some(n,function(e){return t.getCharacterType()===e})}),this.createFortifyMaterialFilterConditions(e));var c=[];c.push({getterName:"getAddExp",order:"desc"}),this._recommendMaterialArray=r.sortModels(this._recommendMaterialArray,c);var l,u=_.filter(this._recommendMaterialArray,function(t){return t.getAttribute()===a}),h=_.filter(this._recommendMaterialArray,function(t){return t.getAttribute()!==a}),d=0;h.length>0&&(l=h[h.length-1],d=l.getAddExp()),u.length>0&&(l=u[u.length-1],(d<=0||d>l.getAddExp()*m.SAME_ATTRIBUTE_MATERIAL_BONUS_RATE)&&(d=l.getAddExp()*m.SAME_ATTRIBUTE_MATERIAL_BONUS_RATE)),s&&(this._recommendMaterialArray=u.concat(h));var p=o.getCharacterLevelMasterByLevel(this.getCurrentCharacterModel().getMaxLevel(),this.getCurrentCharacterModel().getCharacterMainMaster().getExpType()).getTotalExp(),g=[];return this._recommendMaterialArray=_.filter(this._recommendMaterialArray,function(t){return g.push(t),o.calcTotalMaterialExp(g,this.getCurrentCharacterModel())+this.getCurrentCharacterModel().getCharacterExp()<=p+d||(g.pop(),!1)}.bind(this)),this._recommendMaterialArray.length>i&&(this._recommendMaterialArray.length=i),this._recommendMaterialArray},createFortifyMaterialFilterConditions:function(t){for(var e=[],i=l.PROPERTY_NAME,a=0;a<t.length;a+=1)this._isFilteringOn(a,t[a])&&e.push({propertyName:i,getterName:l.MATERIAL_CHARACTER_FILTER_FUNC_NAME[Object.keys(l.MATERIAL_CHARACTER_FILTER_TYPE)[a]]});return e},_createRecommendSellMaterialArray:function(t,e){return this._recommendMaterialArray=o.getCharacterModelArrayByCharacterTypes([m.CHARACTER_TYPE.NORMAL,m.CHARACTER_TYPE.FORTIFY,m.CHARACTER_TYPE.SKILL_UP,m.CHARACTER_TYPE.SELL]),this._recommendMaterialArray=_.filter(this._recommendMaterialArray,function(t){return!s.isDeckUnit(t.getCharacterCd())&&!t.getIsProtect()}),this._recommendMaterialArray=r.filterModels(this._recommendMaterialArray,this.createMaterialSellFilterConditions(t)),this._recommendMaterialArray.length>e&&(this._recommendMaterialArray.length=e),this._recommendMaterialArray},createMaterialSellFilterConditions:function(t){for(var e=[],i=l.PROPERTY_NAME,a=0;a<t.length;a+=1)t[a]||e.push({propertyName:i,getterName:l.RECOMMEND_SELL_FILTER_FUNC_NAME[Object.keys(l.RECOMMEND_SELL_FILTER_TYPE)[a]]});return e},_isFilteringOn:function(t,e){return t<l.MATERIAL_FILTER_RARITY_COUNT&&!e||t>=l.MATERIAL_FILTER_RARITY_COUNT&&e},transitionShop:function(){var t={ShopSelectSubRoot:{shopCategory:p.SHOP_CATEGORY.BOX}};this.pushScene("ShopScene",this.getCurrentSceneName(),t,{PromoteCharacterSelectSubRoot:{}})}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterFilterConst:"CharacterFilterConst",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",EquipmentSortConst:"EquipmentSortConst",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",Singleton:"Singleton"}],PromoteCharacterSelectListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"4353e08XvNLNqF7vt+o9N1a","PromoteCharacterSelectListViewBase");var a=t("ListViewBase"),n=t("MatrixPageViewBase"),o=(t("ResourceUtils"),t("CharacterUtils")),r=t("DeckUtils"),s=t("CharacterSortConst"),c=t("CharacterFilterConst");cc.Class({extends:a,properties:{matrixPageView:n},resetListView:function(){this.node.active=!1},initListView:function(t){this.matrixPageView.setCallBackToConvertSortText(o.convertSortTypeToText),this.matrixPageView.setCallBackToThumbnail(this._callbackToThumbnail.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this.matrixPageView.setCallBackToCreateSortConditions(this._callbackToCreateSortConditions.bind(this)),this.matrixPageView.setCallBackToCreateFilterConditions(this._callbackToCreateFilterConditions.bind(this)),this.matrixPageView.setSortParam(t.getCurrentSortType(!1),t.getCurrentSortOrder(!1)),this.matrixPageView.setFilterCheckList(t.getCurrentFilterCheckList()),this.matrixPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilter.bind(this)),this._super(t),this.matrixPageView.node.active=!0},_setListContent:function(t){this._initMatrixPageView()},_initMatrixPageView:function(){cc.error("_initMatrixPageView()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_callbackToCreateSortFilterPopup:function(){cc.error("_callbackToCreateSortFilterPopup()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_callbackToCreateThumbnailNode:function(t,e){var i;e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");var a=o.convertViewSortType(this._root.getCurrentSortType(!1));return i.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),o.getSortParameter(t,a),a),i.setProtected(t.getIsProtect()),i.setEventBoost(t.getEventBoost()),i.setBottomLabel(r.getDeckOrganizedText(t.getCharacterCd())),i.node},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:s.SORT_FUNC_NAME[Object.keys(s.SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_callbackToCreateFilterConditions:function(t){for(var e=[],i=c.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:c.FILTER_FUNC_NAME[Object.keys(c.FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(c.FILTER_GROUP_END).indexOf(t)>=0},_callbackToSortAndFilter:function(t,e,i){this._root.setSortAndFilterParam(t,e,i,!1)},_callbackToThumbnail:function(){cc.error("_callbackToThumbnail(arguments)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")}});cc._RF.pop()},{CharacterFilterConst:"CharacterFilterConst",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",DeckUtils:"DeckUtils",ListViewBase:"ListViewBase",MatrixPageViewBase:"MatrixPageViewBase",ResourceUtils:"ResourceUtils"}],PromoteCharacterSelectPopupTabView:[function(t,e,i){"use strict";cc._RF.push(e,"421dayXqTxNfIKT9QVlwKEQ","PromoteCharacterSelectPopupTabView");var a=t("TabViewBase"),n=t("CommonScrollView");cc.Class({extends:a,properties:{nodeDescription:cc.Label,scrollView:n},_strDescriptionList:null,_root:null,initPromoteCharacterEquipmentSelectPopupTabView:function(t,e){this._root=t,this._initStrDescriptionList(e),this.initTabViewBase(),this._setCurrentTab(0),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray.hasOwnProperty(t)&&this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this.nodeDescription.string=this._strDescriptionList[t]},_initStrDescriptionList:function(t){var e="";this._strDescriptionList=[];for(var i=0;i<t.length;i+=1){e="";for(var a=0;a<t[i].length;a+=1)e+=t[i][a]+"\n";this._strDescriptionList.push(e)}}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",TabViewBase:"TabViewBase"}],PromoteCharacterSelectRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"0bd98IAqwNNIZLX+DUsWzia","PromoteCharacterSelectRootUtils");var a=t("Singleton");e.exports={openPromoteCharacterSelectSubRoot:function(t,e){cc.log("openPromoteCharacterSelectSubRoot"),cc.log(e),t.promoteCharacterSelectSubRoot||(t.promoteCharacterSelectSubRoot=new cc.instantiate(t.promoteCharacterSelectSubRootPrefab).getComponent("PromoteCharacterSelectSubRoot"),t.subRootParent.addChild(t.promoteCharacterSelectSubRoot.node)),t.setCurrentTab(e.tabIndex),t.promoteCharacterSelectSubRoot.initPromoteCharacterSelectSubRoot(t)},closePromoteCharacterSelectSubRoot:function(t,e){cc.log("closePromoteCharacterSelectSubRoot"),cc.log(e),t.promoteCharacterSelectSubRoot&&(t.promoteCharacterSelectSubRoot.node.destroy(),t.promoteCharacterSelectSubRoot=null)},openPromoteCharacterEquipmentSelectSubRoot:function(t,e){if(cc.log("openPromoteCharacterEquipmentSelectSubRoot"),cc.log(e),!t.promoteCharacterEquipmentSelectSubRoot){var i={characterModel:a.dao[a.USER_CHARACTER].find(function(t){return t.getCharacterCd()===e.characterCd}),frameName:e.frameName,equipmentType:e.equipmentType,position:e.position,needExceedLimit:e.needExceedLimit,isReleased:e.isReleased,equipmentModel:a.dao[a.USER_EQUIPMENT].find(function(t){return t.getEquipmentCd()===e.equipmentCd})};t.promoteCharacterEquipmentSelectSubRoot=cc.instantiate(t.promoteCharacterEquipmentSelectSubRootPrefab).getComponent("PromoteCharacterEquipmentSelectSubRoot"),t.promoteCharacterEquipmentSelectSubRoot.initPromoteCharacterEquipmentSelectSubRoot(t,i),t.subRootParent.addChild(t.promoteCharacterEquipmentSelectSubRoot.node)}},closePromoteCharacterEquipmentSelectSubRoot:function(t,e){cc.log("closePromoteCharacterEquipmentSelectSubRoot"),cc.log(e),t.promoteCharacterEquipmentSelectSubRoot&&(t.promoteCharacterEquipmentSelectSubRoot.node.destroy(),t.promoteCharacterEquipmentSelectSubRoot=null)}},cc._RF.pop()},{Singleton:"Singleton"}],PromoteCharacterSelectRoot:[function(t,e,i){"use strict";cc._RF.push(e,"11fdcv6UlxE06pVx8dzNZbn","PromoteCharacterSelectRoot");var a=t("Singleton"),n=t("PromoteCharacterRootBase"),o=(t("PromoteCharacterDetailRoot"),t("PromoteCharacterSelectSubRoot"),t("PromoteCharacterSelectViewSetting")),r=t("GameConst"),s=(t("LocalDataConst"),t("ResourceConst"));cc.Class({extends:n,properties:{promoteCharacterSelectSubRootPrefab:cc.Prefab,promoteCharacterEquipmentSelectSubRootPrefab:cc.Prefab,promoteCharacterSellConfirmPopupPrefab:cc.Prefab,promoteCharacterSellCompletePopupPrefab:cc.Prefab},_currentTab:0,_promoteCharacterSellConfrimPopup:null,_promoteCharacterSellCompletePopup:null,initData:function(){this._super(),this._currentTab=0},initResource:function(){this._super(),this.requestRes(s.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_BASE,cc.Prefab),this.requestRes(s.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_FORTIFY,cc.Prefab),this.requestRes(s.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_SELL,cc.Prefab)},initialize:function(){this.initOutGameRootBase();this._initOpenFirstView({PromoteCharacterSelectSubRoot:{}})},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,o.PROMOTECHARACTERSELECT_SETTING)},redraw:function(){this.redrawUIHeader(),this.promoteCharacterSelectSubRoot&&this.promoteCharacterSelectSubRoot.initPromoteCharacterSelectSubRoot(this)},setCurrentTab:function(t){this._currentTab=t||0},getCurrentTab:function(){return this._currentTab},pushPromoteCharacterEquipmentSelectSubRoot:function(t){var e="";t.equipmentModel&&(e=t.equipmentModel.getEquipmentCd());var i={PromoteCharacterEquipmentSelectSubRoot:{characterCd:t.characterModel.getCharacterCd(),frameName:t.frameName,equipmentType:t.equipmentType,position:t.position,needExceedLimit:t.needExceedLimit,isReleased:t.isReleased,equipmentCd:e}},a={PromoteCharacterSelectSubRoot:{targetCharacterCd:t.characterModel.getCharacterCd()}};this.pushScene("PromoteCharacterSelectScene","PromoteCharacterSelectScene",i,a)},openPromoteCharacterSellConfirmPopup:function(t){this.closePromoteCharacterSellConfirmPopup(),this._promoteCharacterSellConfrimPopup=cc.instantiate(this.promoteCharacterSellConfirmPopupPrefab).getComponent("PromoteCharacterSellConfirmPopup"),this._promoteCharacterSellConfrimPopup.openPromoteCharacterSellConfirmPopup(t,this.requestSell.bind(this))},closePromoteCharacterSellConfirmPopup:function(){this._promoteCharacterSellConfrimPopup&&(this._promoteCharacterSellConfrimPopup.close(),this._promoteCharacterSellConfrimPopup=null)},openPromoteCharacterSellCompletePopup:function(t){this.closePromoteCharacterSellCompletePopup(),this._promoteCharacterSellCompletePopup=cc.instantiate(this.promoteCharacterSellCompletePopupPrefab).getComponent("PromoteCharacterSellCompletePopup"),this._promoteCharacterSellCompletePopup.openPromoteCharacterSellCompletePopup(t,this.redraw.bind(this))},closePromoteCharacterSellCompletePopup:function(){this._promoteCharacterSellCompletePopup&&(this._promoteCharacterSellCompletePopup.close(),this._promoteCharacterSellCompletePopup=null)},pushModeChange:function(t){var e={PromoteCharacterSelectSubRoot:{checkMode:t}},i={PromoteCharacterSelectSubRoot:{checkMode:r.CHECK_STATE.NONE}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),e,i)},requestSell:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].getCharacterCd());a.CharacterService.sell(e,function(){this.reload(),this.openPromoteCharacterSellCompletePopup(t)}.bind(this))},requestProtect:function(t,e){for(var i=[],n=0;n<t.length;n++)i.push(t[n].getCharacterCd());a.CharacterService.changeProtect(i,function(){this.reload(),e&&e(),this.redrawUIHeader()}.bind(this))},transitionPromoteDetail:function(t){var e={PromoteCharacterDetailSubRoot:{targetCharacterCd:t.getCharacterCd(),openTab:0}},i={PromoteCharacterSelectSubRoot:{targetCharacterCd:t.getCharacterCd()}};this.pushScene("PromoteCharacterDetailScene",this.getCurrentSceneName(),e,i)}});cc._RF.pop()},{GameConst:"GameConst",LocalDataConst:"LocalDataConst",PromoteCharacterDetailRoot:"PromoteCharacterDetailRoot",PromoteCharacterRootBase:"PromoteCharacterRootBase",PromoteCharacterSelectSubRoot:"PromoteCharacterSelectSubRoot",PromoteCharacterSelectViewSetting:"PromoteCharacterSelectViewSetting",ResourceConst:"ResourceConst",Singleton:"Singleton"}],PromoteCharacterSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"d5fe07Y2OdFWIG6zvis/fGy","PromoteCharacterSelectSubRoot");var a=t("PromoteCharacterSelectTabView"),n=t("WindowBase");cc.Class({extends:n,properties:{promoteCharacterSlectTabView:a},initPromoteCharacterSelectSubRoot:function(t){this.promoteCharacterSlectTabView.initPromoteCharacterSelectTabView(t,t.getCurrentTab())}});cc._RF.pop()},{PromoteCharacterSelectTabView:"PromoteCharacterSelectTabView",WindowBase:"WindowBase"}],PromoteCharacterSelectTabView:[function(t,e,i){"use strict";cc._RF.push(e,"9e3f5f4G5dEW4fQ7KXDBF0p","PromoteCharacterSelectTabView");var a=t("TabViewBase"),n=(t("CharacterConst"),t("CharacterUtils"),t("NoticeBadgeCheckUtils")),o=t("ViewUtils"),r=t("PromoteCharacterSelectListViewBase"),s=0,c=1,l={POSITION:cc.v2(57,18),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{listViewArray:[r]},_root:null,_promoteCharacterMatrixPageView:null,initPromoteCharacterSelectTabView:function(t,e){this._root=t,this.initTabViewBase(),this._setCurrentTab(e),this._activateTab(this.getCurrentTab()),n.hasPromotableCharacter()?o.addNoticeBadge(this.tabBtnArray[s].node,l.POSITION,l.SCALE):o.hideNoticeBadge(this.tabBtnArray[s].node),n.hasSellMaterial()?o.addNoticeBadge(this.tabBtnArray[c].node,l.POSITION,l.SCALE):o.hideNoticeBadge(this.tabBtnArray[c].node)},_tabEvent:function(t,e,i){this._root.setCurrentTab(e),this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_resetTabContent:function(){for(var t in this.listViewArray)this.listViewArray[t].resetListView()},_switchTabContent:function(t){this._resetTabContent(),this.listViewArray[t].initListView(this._root)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",PromoteCharacterSelectListViewBase:"PromoteCharacterSelectListViewBase",TabViewBase:"TabViewBase",ViewUtils:"ViewUtils"}],PromoteCharacterSelectViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"22a00qNdL1AMZqiTg2BHf+t","PromoteCharacterSelectViewSetting");var a=t("PromoteCharacterSelectRootUtils");e.exports={PROMOTECHARACTERSELECT_SETTING:{PromoteCharacterSelectSubRoot:{open:a.openPromoteCharacterSelectSubRoot,close:a.closePromoteCharacterSelectSubRoot},PromoteCharacterEquipmentSelectSubRoot:{open:a.openPromoteCharacterEquipmentSelectSubRoot,close:a.closePromoteCharacterEquipmentSelectSubRoot}}},cc._RF.pop()},{PromoteCharacterSelectRootUtils:"PromoteCharacterSelectRootUtils"}],PromoteCharacterSellCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"dff26QZAn5OXZ+VfFugCaNX","PromoteCharacterSellCompletePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CharacterUtils"),r=t("ItemUtils"),s=t("GameConst"),c=t("CommonUtils");cc.Class({extends:a,properties:{topCurrencyNameLabel:cc.Label,centerCurrencyNameLabel:cc.Label,getPriceLabel:cc.Label,beforeCurrencyCountLabel:cc.Label,afterCurrencyCountLabel:cc.Label,okBtn:n},onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openPromoteCharacterSellCompletePopup:function(t,e){this.setCloseCallBack(e),this._initPromoteCharacterSellCompletePopup(t),this.open()},_initPromoteCharacterSellCompletePopup:function(t){var e=r.getItemMaster(s.ITEM_ID_GOLD),i=r.getUserItemCount(s.ITEM_ID_GOLD),a=o.calcTotalSellPrice(t);this.topCurrencyNameLabel.string="["+e.getName()+"]x",this.centerCurrencyNameLabel.string="\u6240\u6301["+e.getName()+"]",this.getPriceLabel.string=c.convertToCommaDelimited(a),this.beforeCurrencyCountLabel.string=c.convertToCommaDelimited(i-a),this.afterCurrencyCountLabel.string=c.convertToCommaDelimited(i)},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],PromoteCharacterSellConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"a66cc9OyIhBWbIhoh7IqzMB","PromoteCharacterSellConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("ResourceUtils"),t("CharacterUtils")),r=t("ItemUtils"),s=t("GameConst"),c=t("CommonUtils");cc.Class({extends:a,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,currencyNameLabel:cc.Label,priceLabel:cc.Label,executeBtn:n,cancelBtn:n},_materialCharacterModelArray:null,_callbackToExecutBtn:null,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openPromoteCharacterSellConfirmPopup:function(t,e){this._materialCharacterModelArray=t,this._callbackToExecutBtn=e,this._initPromoteCharacterSellConfirmPopup(t),this.thumbnailParentNode.active=!1,this.open(function(){this.thumbnailParentNode.active=!0}.bind(this))},_initPromoteCharacterSellConfirmPopup:function(t){for(var e in this.currencyNameLabel.string="["+r.getItemMaster(s.ITEM_ID_GOLD).getName()+"]x",this.priceLabel.string=c.convertToCommaDelimited(o.calcTotalSellPrice(t)),this.thumbnailParentNode.destroyAllChildren(),t){var i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");i.initCharacterMatrixThumbnail(t[e].getCharacterMainMaster(),t[e].getExceedLimit(),t[e].getLevel(),1),this.thumbnailParentNode.addChild(i.node)}},_onTapExecuteBtn:function(){this._callbackToExecutBtn(this._materialCharacterModelArray),this.close()},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],PromoteCharacterSellSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"81fb43ADYZHF6EZ+qSNNXW3","PromoteCharacterSellSelectListView");var a=t("CharacterUtils"),n=t("DeckUtils"),o=t("Singleton"),r=t("GameConst"),s=t("ResourceUtils"),c=t("CharacterSortConst"),l=t("CharacterConst"),u=t("ResourceConst"),h=t("CharacterFilterConst"),d=(l=t("CharacterConst"),t("PromoteCharacterSelectListViewBase")),p=t("PromoteCharacterSellSelectSideView");cc.Class({extends:d,properties:{countLabel:cc.Label,maxCountLabel:cc.Label,materialCountLabel:cc.Label,materialMaxCountLabel:cc.Label,promoteCharacterSelectSideView:p},initListView:function(t){this.countLabel.string=""+a.getPlayableUserCharacterModelArray().length,this.maxCountLabel.string=""+o.dao[o.USER].getCharacterMaxCount(),this.materialCountLabel.string=""+a.getNonPlayableUserCharacterModelArray().length,this.materialMaxCountLabel.string=""+r.MAX_MATERIAL_COUNT,this.matrixPageView.setCallBackToIsImageActive(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsThumbnailEnabled.bind(this)),t.setCurrentCharacterCd(""),this._super(t),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtn.bind(this),this._callbackToSideResetBtn.bind(this),this._callbackToSideThumbnail.bind(this))},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView("getCharacterCd",this._getSellableCharacters(),o.dao[o.USER].getCharacterMaxCount(),[],this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(s.getResource(u.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_SELL)).getComponent("SortFilterPopup")},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:"getIsProtect"}),i.push({getterName:"getIsDeckUnit"}),i.push({getterName:c.SORT_FUNC_NAME[Object.keys(c.SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_getCheckLimit:function(){return r.SELL_MAX_MATERIAL},_callbackToThumbnail:function(t){this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_callbackToSideThumbnail:function(t){this._setRecommendSelectMaterials(t)},_callbackIsThumbnailEnabled:function(t,e){return!t.getIsProtect()&&!n.isDeckUnit(t.getCharacterCd())&&!(e.length>=this._getCheckLimit()&&!e.find(function(e){return e.getCharacterCd()===t.getCharacterCd()}))},_callbackToSideResetBtn:function(){this.matrixPageView.clearCheckedModelArray(),this.matrixPageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_callbackToRecommendSelectBtn:function(){this._root.openRecommendedSellMaterialSelectPopup("\u4ee5\u4e0a\u306e\u6761\u4ef6\u3067\u3001\u58f2\u5374\u3059\u308b\u30e6\u30cb\u30c3\u30c8\u3092\n\u6700\u5927"+r.SELL_MAX_MATERIAL+"\u4f53\u9078\u629e\u3057\u307e\u3059\u3002",r.SELL_MAX_MATERIAL,this._setRecommendSelectMaterials.bind(this))},_setRecommendSelectMaterials:function(t){var e=this.matrixPageView.getPageIndex();this.matrixPageView.initMatrixPageView("getCharacterCd",this._getSellableCharacters(),o.dao[o.USER].getCharacterMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.matrixPageView.redraw(),this.matrixPageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_getSellableCharacters:function(){return a.getCharacterModelArrayByCharacterTypes([l.CHARACTER_TYPE.NORMAL,l.CHARACTER_TYPE.FORTIFY,l.CHARACTER_TYPE.SELL,l.CHARACTER_TYPE.SKILL_UP,l.CHARACTER_TYPE.EXCEED_LIMIT,l.CHARACTER_TYPE.ABILITY_UP])},_callbackToCreateFilterConditions:function(t){for(var e=[],i=h.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:h.SELL_FILTER_FUNC_NAME[Object.keys(h.SELL_FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(h.SELL_FILTER_GROUP_END).indexOf(t)>=0}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterFilterConst:"CharacterFilterConst",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",PromoteCharacterSelectListViewBase:"PromoteCharacterSelectListViewBase",PromoteCharacterSellSelectSideView:"PromoteCharacterSellSelectSideView",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],PromoteCharacterSellSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"39dfeKgqF9FhI1hIfVzIg9x","PromoteCharacterSellSelectSideView");var a=t("CommonButton"),n=(t("EquipmentUtils"),t("CommonUtils")),o=t("PopupUtils"),r=t("CharacterUtils"),s=(t("ResourceUtils"),t("GameConst")),c=t("MaterialCharacterInfoView");cc.Class({extends:cc.Component,properties:{materialCharacterInfoView:c,thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,sellPriceLabel:cc.Label,recommendSelectBtn:a,resetBtn:a,executeBtn:a},_root:null,_materialCharacterModelArray:null,_callbackToRecommendSelectBtn:null,_callbackToResetBtn:null,_callbackToSideThumbnail:null,onLoad:function(){this.recommendSelectBtn.setTapEvent(this._onTapRecommentSelectBtn.bind(this)),this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacerSelectSideView:function(t,e,i,a){this._root=t,this._callbackToRecommendSelectBtn=e,this._callbackToResetBtn=i,this._callbackToSideThumbnail=a,this.sellPriceLabel.string="0",this.materialCharacterInfoView.initMaterialCharacterInfoView(t,null),this._drawMaterials([])},drawPromoteCharacterSelectSideView:function(t){this._drawMaterials(t),this.sellPriceLabel.string=n.convertToCommaDelimited(r.calcTotalSellPrice(t))},_drawMaterials:function(t){this._materialCharacterModelArray=t,t.length>0?(this.resetBtn.switchBtnImage(!0),this.executeBtn.switchBtnImage(!0),this.materialCharacterInfoView.drawMaterialCharacterInfoView(t[t.length-1])):(this.resetBtn.switchBtnImage(!1),this.executeBtn.switchBtnImage(!1),this.materialCharacterInfoView.drawMaterialCharacterInfoView(null));for(var e=0;e<s.SELL_MAX_MATERIAL;e+=1){var i;this.thumbnailParentNode.children[e]?((i=this.thumbnailParentNode.children[e].getComponent("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail(),i.initPlainMatrixThumbnail()):(i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.thumbnailParentNode.addChild(i.node)),t[e]?(i.initCharacterMatrixThumbnail(t[e].getCharacterMainMaster(),t[e].getExceedLimit(),t[e].getLevel(),1),i.setCallbackToThumbnailBtn(function(t){var e=this._materialCharacterModelArray.filter(function(e){return e.getCharacterCd()!==t.getCharacterCd()});this._callbackToSideThumbnail(e)}.bind(this,t[e])),i.initDisablePlainMatrixThumbnail()):i.initPlainMatrixThumbnail()}},_onTapRecommentSelectBtn:function(){this._callbackToRecommendSelectBtn()},_onTapResetBtn:function(){this._callbackToResetBtn()},_onTapExecuteBtn:function(){this.executeBtn.getBtnImageSwitchState()?this._root.openPromoteCharacterSellConfirmPopup(this._materialCharacterModelArray):o.openSimpleMessageWindow("\u58f2\u5374\u7d20\u6750\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",MaterialCharacterInfoView:"MaterialCharacterInfoView",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils"}],PromoteCharacterSimpleAppendListView:[function(t,e,i){"use strict";cc._RF.push(e,"67fe0Mo2O5OaLgYsp30cECz","PromoteCharacterSimpleAppendListView");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node},drawPromoteCharacterSimpleAppendListView:function(t){this.thumbnailParentNode.destroyAllChildren(),this._drawForSkillThumbnail([t.getCharacterSkillInfo()]),this._drawForAbilityThumbnail(t.getCharacterAbilityInfoArray())},_drawForSkillThumbnail:function(t){for(var e in t){var i=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterSimpleAppendThumbnail");i.initPromoteCharacterSimpleSkillThumbnail(t[e]),this.thumbnailParentNode.addChild(i.node)}},_drawForAbilityThumbnail:function(t){for(var e in t){var i=cc.instantiate(this.thumbnailPrefab).getComponent("PromoteCharacterSimpleAppendThumbnail");i.initPromoteCharacterSimpleAbilityThumbnail(t[e]),this.thumbnailParentNode.addChild(i.node)}}});cc._RF.pop()},{}],PromoteCharacterSimpleAppendThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"98607cu139EjazdEYxSqfFP","PromoteCharacterSimpleAppendThumbnail");var a=cc.Enum({MAIN:0,SUPPORT:1});cc.Class({extends:cc.Component,properties:{skillDisplayNode:cc.Node,abilityDisplayNodeArray:[cc.Node],nameLabel:cc.Label,levelLabel:cc.Label,lockedDispNode:cc.Node},initPromoteCharacterSimpleSkillThumbnail:function(t){this.skillDisplayNode.active=!0,this.abilityDisplayNodeArray.forEach(function(t){t.active=!1}),this.nameLabel.string=t.skillMainMaster.getName(),this.levelLabel.string="Lv."+t.skillLevel},initPromoteCharacterSimpleAbilityThumbnail:function(t){this.skillDisplayNode.active=!1,this._switchDisplayMainOrSupportAbility(t.isSupportAbility),this.nameLabel.string=t.abilityMainMaster.getName(),this.levelLabel.string="Lv."+t.abilityLevel,this.lockedDispNode.active=!t.isReleased},_switchDisplayMainOrSupportAbility:function(t){this.abilityDisplayNodeArray.forEach(function(t){t.active=!1}),t?this.abilityDisplayNodeArray[a.SUPPORT].active=!0:this.abilityDisplayNodeArray[a.MAIN].active=!0}});cc._RF.pop()},{}],PromoteCharacterSkillFortifyCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"32577nMjupFKJ5oWvdidYtp","PromoteCharacterSkillFortifyCompletePopup");var a=t("PopupBase"),n=(t("ItemUtils"),t("CommonUtils"),t("CommonButton")),o=(t("ResourceUtils"),t("ViewUtils")),r=t("GameConst"),s=cc.Enum({SUCCESS:0,FAILURE:1});cc.Class({extends:a,properties:{characterThumbnailPrefab:cc.Prefab,characterThumbnailParentNode:cc.Node,appendThumbnailPrefab:cc.Prefab,skillLayoutNode:cc.Node,beforeThumbnailParentNode:cc.Node,afterThumbnailParentNode:cc.Node,resultAnimation:cc.Animation,beforeLevelLabel:cc.Label,afterLevelLabel:cc.Label,maxLevelLabel:cc.Label,okBtn:n},_callbackToOkBtn:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openPromoteCharacterSkillFortifyCompletePopup:function(t,e,i,a){this.setCloseCallBack(a),this._setCharacterThumbnail(t),this.beforeLevelLabel.string=e.skillLevel+"",this.afterLevelLabel.string=i.skillLevel+"",this.maxLevelLabel.string=i.maxSkillLevel+"",this.afterLevelLabel.node.color=o.getParamChangeColor(e.skillLevel,i.skillLevel),this.skillLayoutNode.opacity=0,this.open(function(){e.skillLevel<i.skillLevel?this.resultAnimation.play(this.resultAnimation.getClips()[s.SUCCESS].name):this.resultAnimation.play(this.resultAnimation.getClips()[s.FAILURE].name),this._setSkillThumbnails(e,i)}.bind(this))},_setCharacterThumbnail:function(t){this.characterThumbnailParentNode.destroyAllChildren();var e=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail");e.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),t.getLevel(),1),this.characterThumbnailParentNode.addChild(e.node)},_setSkillThumbnails:function(t,e){this.beforeThumbnailParentNode.destroyAllChildren(),this.afterThumbnailParentNode.destroyAllChildren();var i=cc.instantiate(this.appendThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");i.initPromoteCharacterDetailStatusSkillThumbnail(t,!1,!0),this.beforeThumbnailParentNode.addChild(i.node);var a=cc.instantiate(this.appendThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");a.initPromoteCharacterDetailStatusSkillThumbnail(e,t.skillLevel<e.skillLevel,!0),a.setDescriptionRichText(o.insertDiffTag(t.skillText,e.skillText,r.RICH_TEXT_TAG_STATE.WHITE.START,r.RICH_TEXT_TAG_STATE.WHITE.END,r.RICH_TEXT_TAG_STATE.PLUS.START,r.RICH_TEXT_TAG_STATE.PLUS.END)),this.afterThumbnailParentNode.addChild(a.node),this.skillLayoutNode.runAction(cc.fadeIn(.1))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterSkillFortifyConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"835b4h1g4tAwLyx5A20YZq4","PromoteCharacterSkillFortifyConfirmPopup");var a=t("CommonUtils"),n=(t("ResourceUtils"),t("CharacterSkillUtils")),o=t("GameConst"),r=t("ViewUtils"),s=t("PromoteCharacterConfirmPopupBase");cc.Class({extends:s,properties:{appendThumbnailPrefab:cc.Prefab,skillLayoutNode:cc.Node,beforeThumbnailParentNode:cc.Node,afterThumbnailParentNode:cc.Node},openPromoteCharacterSkillFortifyConfirmPopup:function(t,e,i,o,r){this._initPromoteCharacterConfirmPopup(a.convertToCommaDelimited(n.calcSkillFortifyPrice(o,e,t)),r),this._setMaterials(o),this.skillLayoutNode.opacity=0,this.open(function(){this._setSkillThumbnails(e,i)}.bind(this))},_setMaterials:function(t){for(var e in this.thumbnailParentNode.destroyAllChildren(),t){var i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");i.initCharacterMatrixThumbnail(t[e].getCharacterMainMaster(),t[e].getExceedLimit(),t[e].getLevel(),1),this.thumbnailParentNode.addChild(i.node)}},_setSkillThumbnails:function(t,e){this.beforeThumbnailParentNode.destroyAllChildren(),this.afterThumbnailParentNode.destroyAllChildren();var i=cc.instantiate(this.appendThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");i.initPromoteCharacterDetailStatusSkillThumbnail(t,!1,!0),this.beforeThumbnailParentNode.addChild(i.node);var a=cc.instantiate(this.appendThumbnailPrefab).getComponent("PromoteCharacterDetailStatusSkillAbilityThumbnail");a.initPromoteCharacterDetailStatusSkillThumbnail(e,t.skillLevel<e.skillLevel,!0),a.setDescriptionRichText(r.insertDiffTag(t.skillText,e.skillText,o.RICH_TEXT_TAG_STATE.WHITE.START,o.RICH_TEXT_TAG_STATE.WHITE.END,o.RICH_TEXT_TAG_STATE.PLUS.START,o.RICH_TEXT_TAG_STATE.PLUS.END)),this.afterThumbnailParentNode.addChild(a.node),this.skillLayoutNode.runAction(cc.fadeIn(.1))}});cc._RF.pop()},{CharacterSkillUtils:"CharacterSkillUtils",CommonUtils:"CommonUtils",GameConst:"GameConst",PromoteCharacterConfirmPopupBase:"PromoteCharacterConfirmPopupBase",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterSkillFortifyMaterialSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"4b025RFBS5JX4BObPopHJuK","PromoteCharacterSkillFortifyMaterialSelectListView");var a=t("Singleton"),n=t("CommonButton"),o=t("CharacterUtils"),r=t("CharacterSkillUtils"),s=t("DeckUtils"),c=t("ResourceUtils"),l=t("WarehouseUtils"),u=t("WarehouseConvertUtils"),h=t("CommonUtils"),d=(r=t("CharacterSkillUtils"),t("PromoteCharacterSelectListViewBase")),p=t("PromoteCharacterSkillFortifyMaterialSelectSideView"),m=t("MatrixMultipleSelectCountUpPageView"),g=t("GameConst"),C=t("CharacterConst"),f=t("CharacterSortConst"),E=t("StaticResourceConst"),T=t("ResourceConst"),S=t("CharacterFilterConst"),R=t("WarehouseConst"),A=t("LocalDataConst");cc.Class({extends:d,properties:{dataTypeLabel:cc.Label,warehouseSwitchBtn:n,countUpMatrixWarehousePageView:m,promoteCharacterSelectSideView:p},onLoad:function(){this.warehouseSwitchBtn.setTapEvent(this._onTapWarehouseSwitchBtn.bind(this))},initPromoteCharacterSkillFortifyMaterialSelectListView:function(t){switch(this._root=t,t.materialDataType){case C.MATERIAL_DATA_TYPE.CHARACTER:this.initListView(t);break;case C.MATERIAL_DATA_TYPE.WAREHOUSE:this.initWarehouseCharacterListView(t)}},initListView:function(t){this._drawDataType(t.materialDataType),this.matrixPageView.node.active=!0,this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this.matrixPageView.setCallBackToIsImageActive(this._callbackIsThumbnailEnabled.bind(this)),this.matrixPageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsThumbnailEnabled.bind(this)),this._super(t),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtn.bind(this),this._callbackToSideResetBtn.bind(this),this._callbackToSideThumbnail.bind(this)),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(this._root.getMaterialCharacterModelArray())},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView("getCharacterCd",r.getSkillUpMaterialCharacterModelArray(this._root.getCurrentCharacterModel().getCharacterGroupId(),this._root.getCurrentCharacterModel().getCharacterCd()),a.dao[a.USER].getCharacterMaxCount(),this._root.getMaterialCharacterModelArray(),this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this))},_callbackToCreateThumbnailNode:function(t,e){var i;e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");var a=o.convertViewSortType(this._root.getCurrentSortType(!1));return i.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),o.getSortParameter(t,a),a),i.setProtected(t.getIsProtect()),i.setBottomLabel(s.getDeckOrganizedText(t.getCharacterCd())),i.setEventBoost(t.getEventBoost()),i.node},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:"getIsProtect"}),i.push({getterName:"getIsDeckUnit"}),i.push({getterName:f.SORT_FUNC_NAME[Object.keys(f.SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getCharacterCd"}),i},_callbackToCreateFilterConditions:function(t){for(var e=[],i=S.PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:S.SKILL_FILTER_FUNC_NAME[Object.keys(S.SKILL_FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(S.FILTER_GROUP_END).indexOf(t)>=0},_getCheckLimit:function(){return g.SKILL_FORTIFY_MAX_MATERIAL},_callbackToThumbnail:function(t){this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_callbackToSideThumbnail:function(t){this._setRecommendSelectMaterials(t)},_callbackIsThumbnailEnabled:function(t,e){return!t.getIsProtect()&&!s.isDeckUnit(t.getCharacterCd())&&!((e.length>=this._getCheckLimit()||r.calcTotalSkillUpRate(e,this._root.getCurrentCharacterModel().getCharacterSkillInfo(),this._root.getCurrentCharacterModel())>=g.MAX_SKILL_UP_RATE)&&!e.find(function(e){return e.getCharacterCd()===t.getCharacterCd()}))},_callbackToSideResetBtn:function(){this._root.resetSelectMaterials(),this.matrixPageView.clearCheckedModelArray(),this.matrixPageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(c.getResource(T.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_FORTIFY)).getComponent("SortFilterPopup")},_callbackToRecommendSelectBtn:function(){},_setRecommendSelectMaterials:function(t){var e=this.matrixPageView.getPageIndex();this.matrixPageView.initMatrixPageView("getCharacterCd",r.getSkillUpMaterialCharacterModelArray(this._root.getCurrentCharacterModel().getCharacterGroupId(),this._root.getCurrentCharacterModel().getCharacterCd()),a.dao[a.USER].getCharacterMaxCount(),t,this._getCheckLimit(),this._callbackToCreateThumbnailNode.bind(this)),this.matrixPageView.redraw(),this.matrixPageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_onTapWarehouseSwitchBtn:function(){switch(this._toggleDataType(),this._resetActiveListView(),this._root.materialDataType){case C.MATERIAL_DATA_TYPE.CHARACTER:this.initListView(this._root);break;case C.MATERIAL_DATA_TYPE.WAREHOUSE:this.initWarehouseCharacterListView(this._root)}},_toggleDataType:function(){switch(this._root.materialDataType){case C.MATERIAL_DATA_TYPE.CHARACTER:this._root.materialDataType=C.MATERIAL_DATA_TYPE.WAREHOUSE;break;case C.MATERIAL_DATA_TYPE.WAREHOUSE:this._root.materialDataType=C.MATERIAL_DATA_TYPE.CHARACTER}},_drawDataType:function(t){switch(t){case C.MATERIAL_DATA_TYPE.CHARACTER:this.dataTypeLabel.string="\u30e6\u30cb\u30c3\u30c8";break;case C.MATERIAL_DATA_TYPE.WAREHOUSE:this.dataTypeLabel.string="\u5009\u5eab"}},_resetActiveListView:function(){this._root.resetSelectMaterials(),this.matrixPageView.node.active=!1,this.countUpMatrixWarehousePageView.node.active=!1},initWarehouseCharacterListView:function(t){this._drawDataType(t.materialDataType),this.countUpMatrixWarehousePageView.node.active=!0,this.countUpMatrixWarehousePageView.setCallBackToIsImageActive(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixWarehousePageView.setCallBackToIsThumbnailTouchEnabled(this._callbackIsWarehouseThumbnailEnabled.bind(this)),this.countUpMatrixWarehousePageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopupForWarehouseCharacter.bind(this)),this.countUpMatrixWarehousePageView.setCallBackToConvertSortText(l.convertSortTypeToTextForMaterial),this.countUpMatrixWarehousePageView.setCallBackToCreateSortConditions(l.createSortConditionsForCharacter),this.countUpMatrixWarehousePageView.setCallBackToCreateFilterConditions(l.createFilterConditionsForCharacter),this.countUpMatrixWarehousePageView.setSortParam(this._getCurrentSortTypeForWarehouseCharacter(),this._getCurrentSortOrderForWarehouseCharacter()),this.countUpMatrixWarehousePageView.setFilterCheckList(this._getCurrentFilterCheckListForWarehouseCharacter()),this.countUpMatrixWarehousePageView.setCallBackToSortAndFilter(this._callbackToSortAndFilterForWarehouseCharacter.bind(this)),this.countUpMatrixWarehousePageView.setCallBackToThumbnail(this._callbackToWarehouseThumbnail.bind(this)),this._initMatrixPageViewForWarehouse(),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToRecommendSelectBtn.bind(this),this._callbackToSideResetBtnForWarehouseMaterial.bind(this),this._callbackToSideThumbnailForWarehouseMaterial.bind(this)),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(this._root.getMaterialCharacterModelArray())},_initMatrixPageViewForWarehouse:function(){this.countUpMatrixWarehousePageView.initMatrixPageView("getCharacterCd","getCount",this._getWarehouseMaterialModelArray(),a.dao[a.USER].getCharacterMaxCount(),this._root.getMaterialSelectCountInfoArray(),this._getCheckLimit(),this._callbackToCreateWarehouseCharacterThumbnailNode.bind(this))},_callbackToCreateWarehouseCharacterThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(c.getResource(E.CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("CharacterMatrixThumbnail"),i.initCharacterMatrixThumbnail(t.getMainMaster(),t.getExceedLimit(),void 0,void 0),i.setBottomParams("x",t.getCount()),i.node},_callbackIsWarehouseThumbnailEnabled:function(t,e){var i=_.sumBy(e,function(t){return t.count}),a=u.convertWarehouseModelCountInfoArrayToCharacters(e,R.WAREHOUSE_STORAGE_TYPE.CHARACTER);return i<this._getCheckLimit()&&r.calcTotalSkillUpRate(a,this._root.getCurrentCharacterModel().getCharacterSkillInfo(),this._root.getCurrentCharacterModel())<g.MAX_SKILL_UP_RATE},_callbackToWarehouseThumbnail:function(t,e){this._root.setMaterialSelectCountInfoArray(this.countUpMatrixWarehousePageView.getCountInfoArray()),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(u.convertWarehouseModelCountInfoArrayToCharacters(this.countUpMatrixWarehousePageView.getCountInfoArray(),R.WAREHOUSE_STORAGE_TYPE.CHARACTER))},_callbackToSideResetBtnForWarehouseMaterial:function(){this._root.resetSelectMaterials(),this.countUpMatrixWarehousePageView.clearCountInfoArray(),this.countUpMatrixWarehousePageView.redraw(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView([])},_callbackToSideThumbnailForWarehouseMaterial:function(t){this._setRecommendSelectMaterialsForWarehouseMaterial(t)},_setRecommendSelectMaterialsForWarehouseMaterial:function(t){var e=this.countUpMatrixWarehousePageView.getPageIndex(),i=[];Array.prototype.push.apply(i,u.convertCharactersToWarehouseModelCountInfoArray(t,R.WAREHOUSE_STORAGE_TYPE.MATERIAL)),Array.prototype.push.apply(i,u.convertCharactersToWarehouseModelCountInfoArray(t,R.WAREHOUSE_STORAGE_TYPE.CHARACTER)),this._root.setMaterialSelectCountInfoArray(i),this._initMatrixPageViewForWarehouse(),this.countUpMatrixWarehousePageView.redraw(),this.countUpMatrixWarehousePageView.switchPageContent(e),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(t)},_getWarehouseMaterialModelArray:function(){var t=[];return Array.isArray(a.dao.warehouseCharacters)&&Array.prototype.push.apply(t,_.filter(a.dao.warehouseCharacters,function(t){return t.getCount()>0&&t.getCharacterGroupId()===this._root.getCurrentCharacterModel().getCharacterGroupId()}.bind(this))),Array.isArray(a.dao.warehouseMaterials)&&Array.prototype.push.apply(t,_.filter(a.dao.warehouseMaterials,function(t){return t.getCount()>0&&t.getCategory()===R.MATERIAL_CATEGORY.CHARACTER&&t.getMaterialType()===C.CHARACTER_TYPE.SKILL_UP})),t},_callbackToCreateSortFilterPopupForWarehouseCharacter:function(){return cc.instantiate(c.getResource(T.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_CHARACTER_WAREHOUSE)).getComponent("SortFilterPopup")},_getCurrentSortTypeForWarehouseCharacter:function(){return h.loadLocalStorage(A.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_CHARACTER,R.WAREHOUSE_STORAGE_CHARACTER_SORT_TYPE.UPDATING,A.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrderForWarehouseCharacter:function(){return h.loadLocalStorage(A.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_CHARACTER,g.SORT_ORDER.ASC,A.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_getCurrentFilterCheckListForWarehouseCharacter:function(){return a.localData[A.FILTER.TEN.WAREHOUSE_STORAGE_CHARACTER]},_callbackToSortAndFilterForWarehouseCharacter:function(t,e,i){h.saveLocalStorage(A.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_CHARACTER,t),h.saveLocalStorage(A.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_CHARACTER,e)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterFilterConst:"CharacterFilterConst",CharacterSkillUtils:"CharacterSkillUtils",CharacterSortConst:"CharacterSortConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MatrixMultipleSelectCountUpPageView:"MatrixMultipleSelectCountUpPageView",PromoteCharacterSelectListViewBase:"PromoteCharacterSelectListViewBase",PromoteCharacterSkillFortifyMaterialSelectSideView:"PromoteCharacterSkillFortifyMaterialSelectSideView",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",WarehouseConst:"WarehouseConst",WarehouseConvertUtils:"WarehouseConvertUtils",WarehouseUtils:"WarehouseUtils"}],PromoteCharacterSkillFortifyMaterialSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"806c95yV2RI3bRvOYwEv/i/","PromoteCharacterSkillFortifyMaterialSelectSideView");var a=t("CommonButton"),n=t("CommonUtils"),o=(t("CharacterUtils"),t("ResourceUtils"),t("GameConst")),r=t("ViewUtils"),s=t("CharacterSkillUtils"),c=t("CharacterConst"),l=t("MaterialCharacterInfoView"),u=t("PromoteCharacterDetailStatusSkillAbilityThumbnail");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,materialCharacterInfoView:l,afterSkillThumbnail:u,levelUpRateLabel:cc.Label,priceLabel:cc.Label,resetBtn:a,executeBtn:a},_root:null,_materialCharacterModelArray:null,_callbackToRecommendSelectBtn:null,_callbackToResetBtn:null,_callbackToSideThumbnail:null,onLoad:function(){this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),a.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.executeBtn.switchBtnImage(!0)},initPromoteCharacerSelectSideView:function(t,e,i,a){this._root=t,this._callbackToRecommendSelectBtn=e,this._callbackToResetBtn=i,this._callbackToSideThumbnail=a,this.priceLabel.string="0",this.materialCharacterInfoView.initMaterialCharacterInfoView(t,this._root.getCurrentCharacterModel()),this._drawMaterials([],0),this._drawSkillThumbnails(t.getCurrentCharacterModel().getCharacterSkillInfo(),t.getCurrentCharacterModel().getNextCharacterSkillInfo()),this._drawSkillUpRate(0,!1),this._switchBtnActives(!1)},drawPromoteCharacterSelectSideView:function(t){var e=s.calcTotalSkillUpRate(t,this._root.getCurrentCharacterModel().getCharacterSkillInfo(),this._root.getCurrentCharacterModel());this._drawMaterials(t,e),this._drawSkillThumbnails(this._root.getCurrentCharacterModel().getCharacterSkillInfo(),this._root.getCurrentCharacterModel().getNextCharacterSkillInfo()),this._drawSkillUpRate(e,e>c.SKILL_FORTIFY_MAX_RATE),t.length>0?this._switchBtnActives(!0):this._switchBtnActives(!1)},_drawSkillThumbnails:function(t,e){this._materialCharacterModelArray.length<=0?(this.afterSkillThumbnail.initPromoteCharacterDetailStatusSkillThumbnail(t,!1,!0),this.afterSkillThumbnail.appendLevelLabel.string=""+t.skillLevel):(this.afterSkillThumbnail.initPromoteCharacterDetailStatusSkillThumbnail(e,!0,!0),this.afterSkillThumbnail.appendLevelLabel.string=""+e.skillLevel,this.afterSkillThumbnail.setDescriptionRichText(r.insertDiffTag(t.skillText,e.skillText,o.RICH_TEXT_TAG_STATE.WHITE.START,o.RICH_TEXT_TAG_STATE.WHITE.END,o.RICH_TEXT_TAG_STATE.PLUS.START,o.RICH_TEXT_TAG_STATE.PLUS.END)))},_drawMaterials:function(t,e){this._materialCharacterModelArray=t,this.thumbnailParentNode.destroyAllChildren();for(var i=0;i<o.SKILL_FORTIFY_MAX_MATERIAL;i+=1){var a=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail");t[i]?(a.initCharacterMatrixThumbnail(t[i].getCharacterMainMaster(),t[i].getExceedLimit(),t[i].getLevel(),1),a.setCallbackToThumbnailBtn(function(t){var e=this._materialCharacterModelArray.filter(function(e){return e.getCharacterCd()!==t.getCharacterCd()});this._callbackToSideThumbnail(e)}.bind(this,t[i]))):(a.initPlainMatrixThumbnail(),e>=o.MAX_SKILL_UP_RATE&&a.setActive(!1)),this.thumbnailParentNode.addChild(a.node)}this.priceLabel.string=n.convertToCommaDelimited(s.calcSkillFortifyPrice(t,this._root.getCurrentCharacterModel().getCharacterSkillInfo(),this._root.getCurrentCharacterModel()))},_drawSkillUpRate:function(t,e){e&&(t=o.MAX_SKILL_UP_RATE),this.levelUpRateLabel.string=t+""},_switchBtnActives:function(t){this.resetBtn.switchBtnImage(t),this.resetBtn.setTouchEnable(t)},_onTapResetBtn:function(){this._callbackToResetBtn()},_onTapExecuteBtn:function(){this._root.setMaterialCharacterModelArray(this._materialCharacterModelArray),this._root.popScene()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterSkillUtils:"CharacterSkillUtils",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",MaterialCharacterInfoView:"MaterialCharacterInfoView",PromoteCharacterDetailStatusSkillAbilityThumbnail:"PromoteCharacterDetailStatusSkillAbilityThumbnail",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PromoteCharacterSkillFortifyMaterialSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"eab30vC4blG9qdMAv47rd0V","PromoteCharacterSkillFortifyMaterialSelectSubRoot");var a=t("WindowBase"),n=t("PromoteCharacterSkillFortifyMaterialSelectListView");cc.Class({extends:a,properties:{promoteCharacterSkillFortifyMaterialSelectListView:n},initPromoteCharacterSkillFortifyMaterialSelectSubRoot:function(t){this.promoteCharacterSkillFortifyMaterialSelectListView.initPromoteCharacterSkillFortifyMaterialSelectListView(t)}});cc._RF.pop()},{PromoteCharacterSkillFortifyMaterialSelectListView:"PromoteCharacterSkillFortifyMaterialSelectListView",WindowBase:"WindowBase"}],PromoteCharacterSkillFortifyThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"0a96aW20axL9Jj3jIcmFuYt","PromoteCharacterSkillFortifyThumbnail");var a=t("CommonButton");t("CommonUtils"),cc.Class({extends:cc.Component,properties:{activeNode:cc.Node,inactiveNode:cc.Node,nameLabel:cc.Label,levelLabel:cc.Label,infoBtn:a,executeBtn:a},_characterSkillInfo:null,_callbackToInfoBtn:null,_callbackToExecuteBtn:null,onLoad:function(){this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),""),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacterSkillFortifyThumbnail:function(t,e,i){this._characterSkillInfo=t,this._callbackToInfoBtn=e,this._callbackToExecuteBtn=i,t.skillLevel<t.maxSkillLevel?(this.activeNode.active=!0,this.inactiveNode.active=!1):(this.activeNode.active=!1,this.inactiveNode.active=!0),this.nameLabel.string=t.skillMainMaster.getName(),this.levelLabel.string="Lv."+t.skillLevel+"/"+t.maxSkillLevel},_onTapInfoBtn:function(){this._callbackToInfoBtn(this._characterSkillInfo,this.infoBtn.node.parent)},_onTapExecuteBtn:function(){this._callbackToExecuteBtn(this._characterSkillInfo)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils"}],PromoteCharacterTargetSelectListView:[function(t,e,i){"use strict";cc._RF.push(e,"82b44CfZsVLQpeWzTLIYCze","PromoteCharacterTargetSelectListView");var a=t("CharacterUtils"),n=t("Singleton"),o=t("ResourceUtils"),r=t("CommonButton"),s=t("ViewUtils"),c=t("PromoteCharacterSelectListViewBase"),l=t("PromoteCharacterTargetSelectSideView"),u=t("ResourceConst"),h={POSITION:cc.v2(52,-52),SCALE:cc.v2(1,1)};cc.Class({extends:c,properties:{promoteCharacterSelectSideView:l,addCircleBtn:r},onLoad:function(){this.addCircleBtn.setTapEvent(this._onAddCircleBtn.bind(this))},initListView:function(t){this._super(t),this.promoteCharacterSelectSideView.initPromoteCharacerSelectSideView(t,this._callbackToSideProtectBtn.bind(this))},_initMatrixPageView:function(){this.matrixPageView.initMatrixPageView(a.getPlayableUserCharacterModelArray(),n.dao[n.USER].getCharacterMaxCount(),this._callbackToCreateThumbnailNode.bind(this))},_resetActiveThumbnails:function(){var t=this.matrixPageView.content.getComponentsInChildren("MatrixThumbnailBase");for(var e in t)t[e].setSelectedNodeActive(!1)},_callbackToCreateThumbnailNode:function(t,e){var i=this._super(t,e);return t.hasExceedableMaterial()||t.hasAbilityFotifyableMaterial()?i?s.addNoticeBadge(i,h.POSITION,h.SCALE):e&&s.addNoticeBadge(e,h.POSITION,h.SCALE):i?s.hideNoticeBadge(i):e&&s.hideNoticeBadge(e),i},_callbackToThumbnail:function(t,e){this._resetActiveThumbnails(),t.setSelectedNodeActive(!0),this._root.setCurrentCharacterCd(e.getCharacterCd()),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(e)},_callbackToSideProtectBtn:function(t){this._root.requestProtect([t],function(){this.matrixPageView.setDataList(a.getPlayableUserCharacterModelArray()),this.matrixPageView.sortAndFilter(),this.matrixPageView.redrawSimply(),this.promoteCharacterSelectSideView.drawPromoteCharacterSelectSideView(this._root.getCurrentCharacterModel())}.bind(this))},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(o.getResource(u.SORT_FILTER_POPUP_PREFAB_PATH.CHARACTER_BASE)).getComponent("SortFilterPopup")},_onAddCircleBtn:function(){this._root.transitionShop()}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",PromoteCharacterSelectListViewBase:"PromoteCharacterSelectListViewBase",PromoteCharacterTargetSelectSideView:"PromoteCharacterTargetSelectSideView",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],PromoteCharacterTargetSelectSideView:[function(t,e,i){"use strict";cc._RF.push(e,"594bbybKKdOk5w/2WGTvD7n","PromoteCharacterTargetSelectSideView");var a=t("CommonButton"),n=(t("ResourceUtils"),t("CommonUtils")),o=t("CharacterConst"),r=t("BattleParameterView"),s=t("PromoteCharacterSimpleAppendListView");cc.Class({extends:cc.Component,properties:{activeNode:cc.Node,inactiveNode:cc.Node,mainNameLabel:cc.Label,totalPowerLabel:cc.Label,battleParameterView:r,characterThumbnailPrefab:cc.Prefab,characterThumbnailParentNode:cc.Node,characterLevelProgressViewPrefab:cc.Prefab,characterLevelProgressViewParentNode:cc.Node,characterExceedLimitProgressViewPrefab:cc.Prefab,characterExceedLimitProgressViewParentNode:cc.Node,equipmentThumbnailPrefab:cc.Prefab,equipmentThumbnailParentNode:cc.Node,appendListView:s,infoBtn:a,protectBtn:a,executeBtn:a},_characterModel:null,_callbackToProtectBtn:null,_root:null,_characterThumbnail:null,_characterLevelProgressView:null,_characterExceedLimitProgressView:null,_equipmentThumbnailArray:null,onLoad:function(){this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),""),this.protectBtn.setTapEvent(this._onTapProtectBtn.bind(this),a.SE_NAME.EQUIP),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},initPromoteCharacerSelectSideView:function(t,e){this._root=t,this._callbackToProtectBtn=e,this.activeNode.active=!1,this.inactiveNode.active=!0,this._addCharacterThumbnail(),this._addLevelProgressView(),this._addExceedLimitProgressView(),this._addEquipmentThumbnail()},_addCharacterThumbnail:function(){this._characterThumbnail||(this._characterThumbnail=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.characterThumbnailParentNode.addChild(this._characterThumbnail.node))},_addLevelProgressView:function(){this._characterLevelProgressView||(this._characterLevelProgressView=cc.instantiate(this.characterLevelProgressViewPrefab).getComponent("CharacterLevelProgressView"),this.characterLevelProgressViewParentNode.addChild(this._characterLevelProgressView.node))},_addExceedLimitProgressView:function(){this._characterExceedLimitProgressView||(this._characterExceedLimitProgressView=cc.instantiate(this.characterExceedLimitProgressViewPrefab).getComponent("CharacterExceedLimitProgressView"),this.characterExceedLimitProgressViewParentNode.addChild(this._characterExceedLimitProgressView.node))},_addEquipmentThumbnail:function(){if(!this._equipmentThumbnailArray){this._equipmentThumbnailArray=[];for(var t=0;t<o.EQUIPMENT_MAX_COUNT;t+=1){var e=cc.instantiate(this.equipmentThumbnailPrefab).getComponent("EquipmentMatrixThumbnail");this._equipmentThumbnailArray.push(e),this.equipmentThumbnailParentNode.addChild(e.node)}}},drawPromoteCharacterSelectSideView:function(t){this.activeNode.active=!0,this.inactiveNode.active=!1,this._characterModel=t,this.protectBtn.switchBtnImage(t.getIsProtect()),this.mainNameLabel.node.parent.opacity=0,this.mainNameLabel.node.parent.runAction(cc.fadeIn(.3)),this.mainNameLabel.string=t.getShortName()+"["+t.getSkinName()+"]",this._characterThumbnail.initCharacterMatrixThumbnail(t.getCharacterMainMaster(),t.getExceedLimit(),t.getLevel(),1),this.totalPowerLabel.string=n.convertToCommaDelimited(t.getTotalPower()),this.battleParameterView.initBattleParameterView(t.getTotalHp(),t.getTotalAtk(),t.getTotalDef()),this.appendListView.drawPromoteCharacterSimpleAppendListView(t),this._drawLevelProgress(t),this._characterExceedLimitProgressView.initCharacterExceedLimitProgressView(t.getExceedLimit(),t.getExceedLimit(),t.getExceedLimitMaxCount()),this._drawEquipmentThumbnails(t)},_drawLevelProgress:function(t){var e=t.getExpRateForNextLevel(),i=t.getNeedExpForNextLevel(),a=t.getMaxLevel(),n=t.getLevel();this._characterLevelProgressView.initCharacterLevelProgressView(0,n,0,a,0,i,e)},_drawEquipmentThumbnails:function(t){for(var e=t.getCharacterEquipmentInfoArray(),i=0;i<this._equipmentThumbnailArray.length;i+=1)e[i]?e[i].isReleased?e[i].equipmentModel?(this._equipmentThumbnailArray[i].node.active=!0,this._equipmentThumbnailArray[i].setLimited(!1),this._equipmentThumbnailArray[i].switchEmptyNodeActive(!1),this._equipmentThumbnailArray[i].initEquipmentMatrixThumbnail(e[i].equipmentModel.getEquipmentId(),e[i].equipmentModel.getAttribute(),e[i].equipmentModel.getRarity(),e[i].equipmentModel),this._equipmentThumbnailArray[i].setParameter("Lv.",e[i].equipmentModel.getLevel())):(this._equipmentThumbnailArray[i].node.active=!0,this._equipmentThumbnailArray[i].setLimited(!1),this._equipmentThumbnailArray[i].switchEmptyNodeActive(!0)):(this._equipmentThumbnailArray[i].node.active=!0,this._equipmentThumbnailArray[i].setLimited(!0),this._equipmentThumbnailArray[i].switchEmptyNodeActive(!0)):this._equipmentThumbnailArray[i].node.active=!1},_onTapInfoBtn:function(){this._root.openPromoteCharacterDetailPopup(this._characterModel)},_onTapProtectBtn:function(){this._callbackToProtectBtn(this._characterModel)},_onTapExecuteBtn:function(){this._root.transitionPromoteDetail(this._characterModel)}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CharacterConst:"CharacterConst",CommonButton:"CommonButton",CommonUtils:"CommonUtils",PromoteCharacterSimpleAppendListView:"PromoteCharacterSimpleAppendListView",ResourceUtils:"ResourceUtils"}],PromoteEquipmentSwapPopup:[function(t,e,i){"use strict";cc._RF.push(e,"b0a28JlwlxGUIpnO0IUKxeE","PromoteEquipmentSwapPopup");var a=t("PopupBase"),n=t("CommonButton");t("ResourceUtils"),cc.Class({extends:a,properties:{okBtn:n,cancelBtn:n,closeBtn:n,beforeNode:cc.Node,afterNode:cc.Node,matrixThumbnailPrefab:cc.Prefab},_root:null,_characterEquipmentInfoBefore:null,_characterEquipmentInfoAfter:null,openPromoteEquipmentSwapPopup:function(t,e,i,a){this._initPromoteEquipmentSwapPopup(t,e,i,a),this._initButtons(),this.open()},_initPromoteEquipmentSwapPopup:function(t,e,i,a){this._root=t,this._callback=a,this._characterEquipmentInfoBefore=e;var n=cc.instantiate(this.matrixThumbnailPrefab).getComponent("CharacterMatrixThumbnail");n.initCharacterMatrixThumbnail(this._characterEquipmentInfoBefore.characterModel.getCharacterMainMaster(),this._characterEquipmentInfoBefore.characterModel.getExceedLimit()),this.beforeNode.addChild(n.node),this._characterEquipmentInfoAfter=i;var o=cc.instantiate(this.matrixThumbnailPrefab).getComponent("CharacterMatrixThumbnail");o.initCharacterMatrixThumbnail(this._characterEquipmentInfoAfter.characterModel.getCharacterMainMaster(),this._characterEquipmentInfoAfter.characterModel.getExceedLimit()),this.afterNode.addChild(o.node)},_initButtons:function(){this.okBtn.setTapEvent(this._eventOKBtn.bind(this)),this.cancelBtn.setTapEvent(this._eventCancelBtn.bind(this),n.SE_NAME.CANCEL),this.closeBtn.setTapEvent(this._eventCancelBtn.bind(this),n.SE_NAME.CANCEL)},_eventOKBtn:function(){this._root.requestEquip(this._root.createSwapCharactersEquipmentParameter(this._characterEquipmentInfoBefore,this._characterEquipmentInfoAfter),function(){this.close(),this._callback()}.bind(this))},_eventCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],PublicRaidBattleListView:[function(t,e,i){"use strict";cc._RF.push(e,"d80ffBDUe9IYrsgwCATRLT/","PublicRaidBattleListView");var a=t("RaidBattleListViewBase");cc.Class({extends:a,_getBattleSessions:function(t){return t.getCurrentRaidBattleList().getPublicRaidBattleSessions()},_addThumbnailParameter:function(t,e){var i=this._root.getRaidBattleMasterMap()[e.stageId];return t.setCostPoint(i.getBattlePoint()),t.switchActiveRescueBand(!0),t.setCallbackToInfoBtn(function(){this._root.requestGetDetail(e.sessionId)}.bind(this)),t.setCallbackToStartBtn(function(){this._root.pushRaidBattleStartConfirmSubRoot(e.stageId,e,"RaidScene",{RaidBattleSelectSubRoot:{tabIndex:1}})}.bind(this)),t},_getEmptyText:function(){return"\u6551\u63f4\u4f9d\u983c\u306e\u51fa\u3055\u308c\u3066\u3044\u308b\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002"}});cc._RF.pop()},{RaidBattleListViewBase:"RaidBattleListViewBase"}],PvPApis:[function(t,e,i){"use strict";cc._RF.push(e,"0e353oK/TBK9qm5e0QzuSIY","PvPApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.PVP_GET_MASTER_DATA,path:"pvp/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.PVP_GET_USER_DATA,path:"pvp/getUserData",method:"POST"}),a.RESTClient.graft({name:n.PVP_GET_BATTLE_PLAYERS,path:"pvp/getBattlePlayers",method:"POST"}),a.RESTClient.graft({name:n.PVP_UPDATE_BATTLE_PLAYERS,path:"pvp/updateBattlePlayers",method:"POST"}),a.RESTClient.graft({name:n.PVP_START_BATTLE,path:"pvp/startBattle",method:"POST"}),a.RESTClient.graft({name:n.PVP_END_BATTLE,path:"pvp/endBattle",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],PvPBattlePlayerDetailView:[function(t,e,i){"use strict";cc._RF.push(e,"aa9a3rHODRFQbl5TVsBXEiC","PvPBattlePlayerDetailView");var a=t("ResourceUtils"),n=t("PvPUtils"),o=t("GameConst"),r=t("DeckConst"),s=t("CharacterSortConst");cc.Class({extends:cc.Component,properties:{pvpClassImageSprite:cc.Sprite,pvpClassNameLabel:cc.Label,playerNameLabel:cc.Label,playerLevelLabel:cc.Label,deckTotalPowerLabel:cc.Label,deckParentNode:cc.Node,deckCharacterThumbnailPrefab:cc.Prefab},initPvPBattlePlayerDetailView:function(t){this._drawBattlePlayerStatus(t),this._drawBattlePlayerDeck(t.playerDetail.deck[r.DECK_TYPE.PVP][o.DECK_ID_ORIGIN])},_drawBattlePlayerStatus:function(t){a.addSprite(this.pvpClassImageSprite,a.getFileNamePvPClassIcon(t.playerBase.pvpClass)),this.pvpClassNameLabel.string=n.getPvPClassMasterByClassOrder(t.playerBase.pvpClass).getName(),this.playerNameLabel.string=t.playerBase.userName,this.playerLevelLabel.string=t.playerBase.level+""},_drawBattlePlayerDeck:function(t){this.deckParentNode.destroyAllChildren(),this.deckTotalPowerLabel.string=t.getTotalPower()+"";for(var e=o.DECK_ID_ORIGIN;e<r.DECK_LEADER_POSITION+r.DECK_UNIT_COUNT_MAX;e+=1){var i=cc.instantiate(this.deckCharacterThumbnailPrefab).getComponent("CharacterMatrixThumbnail");if(t[e]){var a=t[e][r.ROLE_TYPE.MAIN];i.initCharacterMatrixThumbnail(a.getCharacterMainMaster(),a.getExceedLimit(),a.getLevel(),s.SORT_TYPE.LEVEL)}else i.initEmptyMatrixThumbnail();this.deckParentNode.addChild(i.node)}}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",DeckConst:"DeckConst",GameConst:"GameConst",PvPUtils:"PvPUtils",ResourceUtils:"ResourceUtils"}],PvPBattlePlayerListView:[function(t,e,i){"use strict";cc._RF.push(e,"03658Pbc6REi4OfjKkipR0x","PvPBattlePlayerListView");var a=t("Singleton"),n=t("CommonButton"),o=t("PopupUtils"),r=t("TimeUtils"),s=t("PvPListViewBase"),c=t("PvPPlayerThumbnail"),l=t("GameConst"),u=t("DeckConst"),h=t("LocalDataConst");cc.Class({extends:s,properties:{fullCountColor:cc.Color,midCountColor:cc.Color,challengeRemainCountLabel:cc.Label,challengeMaxCountLabel:cc.Label,nextRecoveryTimeLabel:cc.Label,nextRecoveryCountLabel:cc.Label,reloadBtn:n,pvpPlayerThumbnail:c,reloadCountDownLabel:cc.Label},onLoad:function(){this.reloadBtn.switchBtnImage(!0),this.reloadBtn.setTapEvent(this._onTapReloadBtn.bind(this),n.SE_NAME.COUNT)},initListView:function(t){this._super(t),this._drawChallengeCount(t),this._drawNextRecovery(t),this._drawPvPPlayerThumbnail(t)},_drawChallengeCount:function(t){this.challengeRemainCountLabel.node.color=t.getPvPUserData().getStamina()===t.getPvPUserData().getMaxStamina()?this.fullCountColor:this.midCountColor,this.challengeRemainCountLabel.string=t.getPvPUserData().getStamina(),this.challengeMaxCountLabel.string=t.getPvPUserData().getMaxStamina()},_drawNextRecovery:function(t){this.nextRecoveryTimeLabel.string=this._convertNextRecoveryTime(t.getPvPUserData().getNextStaminaRecoveryTime()),this.nextRecoveryCountLabel.string=""+t.getPvPUserData().getRecoveryStamina()},_convertNextRecoveryTime:function(t){return t?parseInt(t.slice(0,-4))+":00":"00:00"},_drawPvPPlayerThumbnail:function(t){a.dao.userPvP;var e=a.dao[a.USER];this.pvpPlayerThumbnail.setPlayerName(e.getUserName()),this.pvpPlayerThumbnail.setPlayerLevel(e.getLevel());var i=_.find(t.deckInfoArray,function(t){return t.deckId===a.localData[h.SELECT_PVP_DECK_ORDER]});i&&i.deck&&(this.pvpPlayerThumbnail.setTotalPower(i.deck.getTotalPower()),this.pvpPlayerThumbnail.setDeck(i.deck)),this.pvpPlayerThumbnail.setCallbackToDeckEditBtn(this._onTapDeckEditBtn.bind(this))},_setListContent:function(t){var e=t.pvpBattlePlayerArray;for(var i in e)this._addThumbnail(e[i])},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("PvPBattlePlayerThumbnail");e.setPlayerName(t.playerBase.userName),e.setPlayerLevel(t.playerBase.level),e.setTotalPower(t.playerDetail.deck[u.DECK_TYPE.PVP][l.DECK_ID_ORIGIN].getTotalPower()),e.setDeck(t.playerDetail.deck[u.DECK_TYPE.PVP][l.DECK_ID_ORIGIN]),e.setClass(t.playerBase.pvpClass),e.setCallbackToThumbnailBtn(function(){this._callbackToThumbnail(t)}.bind(this)),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){this._root.getPvPUserData().getStamina()>0?this._root.pushPvPBattleStartConfirmSubRoot(t.playerBase.userCd):o.openSimpleMessageWindow("\u6311\u6226\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u307e\u3059\u3002")},_onTapDeckEditBtn:function(){this._root.pushPvPDeckSelectSubRoot()},_onTapReloadBtn:function(){this._root.requestUpdateBattlePlayers(function(){this.initListView(this._root),this._executeCountUpSecond(5,function(){this.reloadCountDownLabel.string="5",this.reloadCountDownLabel.node.active=!0,this.reloadBtn.switchBtnImage(!1),this.reloadBtn.setTouchEnable(!1)}.bind(this),function(t){this.reloadCountDownLabel.string=""+(5-t)}.bind(this),function(){this.reloadCountDownLabel.node.active=!1,this.reloadBtn.switchBtnImage(!0),this.reloadBtn.setTouchEnable(!0)}.bind(this))}.bind(this))},_executeCountUpSecond:function(t,e,i,a){var n=r.getNowCountSeconds(),o=cc.director.getScheduler(),s=this;e(),o.schedule(function e(){var c=Math.floor(r.getNowCountSeconds()-n);t<=c?(a(),o.unschedule(e,s)):i(c)},s,0)}});cc._RF.pop()},{CommonButton:"CommonButton",DeckConst:"DeckConst",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",PvPListViewBase:"PvPListViewBase",PvPPlayerThumbnail:"PvPPlayerThumbnail",Singleton:"Singleton",TimeUtils:"TimeUtils"}],PvPBattlePlayerThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"0169diasZFMT43NL5E8AQMh","PvPBattlePlayerThumbnail");var a=t("CommonButton"),n=t("PvPUtils"),o=t("ResourceUtils"),r=t("PvPPlayerThumbnailBase");cc.Class({extends:r,properties:{classImageSprite:cc.Sprite,classNameLabel:cc.Label,thumbnailBtn:a},_callbackToThumbnailBtn:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this))},setClass:function(t){var e=n.getPvPClassMasterByClassOrder(t);this.classNameLabel.string=e.getName(),o.addSprite(this.classImageSprite,o.getFileNamePvPClassIcon(e.getClass()))},setCallbackToThumbnailBtn:function(t){this._callbackToThumbnailBtn=t},_onTapThumbnailBtn:function(){this._callbackToThumbnailBtn()}});cc._RF.pop()},{CommonButton:"CommonButton",PvPPlayerThumbnailBase:"PvPPlayerThumbnailBase",PvPUtils:"PvPUtils",ResourceUtils:"ResourceUtils"}],PvPBattleStartConfirmSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"84c74TJsWVNOqQaH5wSF08Q","PvPBattleStartConfirmSubRoot");var a=t("CommonButton"),n=t("DeckConst"),o=(t("ResourceUtils"),t("PvPBattlePlayerDetailView")),r=t("PopupUtils");cc.Class({extends:cc.Component,properties:{pvpBattlePlayerDetailView:o,playerLevelLabel:cc.Label,beforeCountLabel:cc.Label,afterCountLabel:cc.Label,cancelBtn:a,battleStartBtn:a,deckTabSimpleViewPositionNode:cc.Node,deckTabSimpleViewPrefab:cc.Prefab},_pvpBattlePlayerData:null,_root:null,_deckTabSimpleView:null,onLoad:function(){this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),a.SE_NAME.CANCEL),this.battleStartBtn.setTapEvent(this._onTapBattleStartBtn.bind(this))},initPvPBattleStartConfirmSubRoot:function(t,e,i,a){this._root=t,this._pvpBattlePlayerData=t.getPvPBattlePlayerDataByCd(a),this.pvpBattlePlayerDetailView.initPvPBattlePlayerDetailView(this._pvpBattlePlayerData),this._drawPlayerStatus(t.getUserBasicData(),t.getPvPUserData()),this._initDeckTabSimpleView(t,e,i)},_drawPlayerStatus:function(t,e){this.playerLevelLabel.string=t.getLevel(),this.beforeCountLabel.string=e.getStamina(),this.afterCountLabel.string=e.getStamina()-1>=0?e.getStamina()-1:0},_initDeckTabSimpleView:function(t,e,i){this._deckTabSimpleView=cc.instantiate(this.deckTabSimpleViewPrefab).getComponent("DeckTabSimpleView"),this._deckTabSimpleView.initDeckTabSimpleView(t,e,n.DECK_TYPE.PVP,i,n.DECK_COUNT_MAX.PVP),this.deckTabSimpleViewPositionNode.addChild(this._deckTabSimpleView.node)},_onTapCancelBtn:function(){this._root.popScene()},_onTapBattleStartBtn:function(){this._deckTabSimpleView.getCurrentDeck()?this._root.requestStartPvPBattle(this._pvpBattlePlayerData.playerBase.userCd,this._pvpBattlePlayerData):r.openCommonPopupOk("","\u30e6\u30cb\u30c3\u30c8\u3092\uff11\u4f53\u4ee5\u4e0a\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002","",!1,function(){})}});cc._RF.pop()},{CommonButton:"CommonButton",DeckConst:"DeckConst",PopupUtils:"PopupUtils",PvPBattlePlayerDetailView:"PvPBattlePlayerDetailView",ResourceUtils:"ResourceUtils"}],PvPCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"5ef40BT5UVP/5V0u7anqdGf","PvPCharacterModel");var a=t("CharacterModel");cc.Class({extends:a,_pictureBookDetailModelMap:void 0,_equipmentModelMap:void 0,ctor:function(){this._pictureBookDetailModelMap=arguments[1],this._equipmentModelMap=arguments[2]},_getPictureBookDetailModel:function(){return this._pictureBookDetailModelMap[this.getCharacterId()]},getAvailableEquipmentWeaponModelList:function(){if(!this._equipmentWeaponModelList){this._equipmentWeaponModelList=[];var t=this.getCharacterExceedLimitMaster().getEquipmentWeaponCount(),e=this.userData.getEquipmentWeaponCds();if(e)for(var i=Math.min(e.length,t),a=0;a<i;a++){var n=e[a];n&&this._equipmentWeaponModelList.push(this._equipmentModelMap[n])}}return this._equipmentWeaponModelList},getAvailableEquipmentProtectorModelList:function(t){if(!this._equipmentProtectorModelList){this._equipmentProtectorModelList=[];var e=this.getCharacterExceedLimitMaster().getEquipmentProtectorCount(),i=this.userData.getEquipmentProtectorCds();if(i)for(var a=Math.min(i.length,e),n=0;n<a;n++){var o=i[n];o&&this._equipmentProtectorModelList.push(this._equipmentModelMap[o])}}return this._equipmentProtectorModelList}});cc._RF.pop()},{CharacterModel:"CharacterModel"}],PvPClassListView:[function(t,e,i){"use strict";cc._RF.push(e,"5a0c3yLKkBP8Kednj0KlPfW","PvPClassListView");var a=t("PvPUtils"),n=(t("Singleton"),t("PvPListViewBase"));cc.Class({extends:n,properties:{},_setListContent:function(t){var e=a.getPvPClassInfoArray();for(var i in e)this._addThumbnail(e[i])},_addThumbnail:function(t){if(!(t.pvpClassRewardMasterArray.length<=0)){var e=cc.instantiate(this.thumbnailPrefab).getComponent("PvPClassThumbnail");e.initPvPClassThumbnail(t,this._root.getPvPUserData().getPvpClass()),this.thumbnailParentNode.addChild(e.node)}},_callbackToThumbnail:function(t){}});cc._RF.pop()},{PvPListViewBase:"PvPListViewBase",PvPUtils:"PvPUtils",Singleton:"Singleton"}],PvPClassModel:[function(t,e,i){"use strict";cc._RF.push(e,"f24810Zi+VI+KBPXYib0/7G","PvPClassModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getWinPoint:function(){if(this._isKeyFieldAvailable("winPoint"))return this._data.winPoint;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: winPoint")},getPointFrom:function(){if(this._isKeyFieldAvailable("pointFrom"))return this._data.pointFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: pointFrom")},getClass:function(){if(this._isKeyFieldAvailable("class"))return this._data.class;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: class")},getPointTo:function(){if(this._isKeyFieldAvailable("pointTo"))return this._data.pointTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: pointTo")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],PvPClassRewardModel:[function(t,e,i){"use strict";cc._RF.push(e,"c5f9agl2NhAMoRr5lL5qjND","PvPClassRewardModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getClass:function(){if(this._isKeyFieldAvailable("class"))return this._data.class;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: class")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],PvPClassThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"040c7Mza9BCMZKotExnkTcz","PvPClassThumbnail");var a=t("CommonUtils"),n=t("ResourceUtils"),o=t("MatrixThumbnailUtils");cc.Class({extends:cc.Component,properties:{rewardParentNode:cc.Node,achievedDispNode:cc.Node,classNameLabel:cc.Label,needPointLabel:cc.Label,classImageSprite:cc.Sprite},initPvPClassThumbnail:function(t,e){this.achievedDispNode.active=t.pvpClassMaster.getClass()<=e,this.classNameLabel.string=t.pvpClassMaster.getName(),this.needPointLabel.string=a.convertToCommaDelimited(t.pvpClassMaster.getPointFrom()),n.addSprite(this.classImageSprite,n.getFileNamePvPClassIcon(t.pvpClassMaster.getClass())),this._addRewardThumbnails(t.pvpClassRewardMasterArray)},_addRewardThumbnails:function(t){for(var e in this.rewardParentNode.destroyAllChildren(),t){var i={prefix:"x",count:t[e].getCount()},a=o.createMatrixThumbnailByItemType(t[e].getItemId(),t[e].getItemType(),i);this.rewardParentNode.addChild(a.node)}}});cc._RF.pop()},{CommonUtils:"CommonUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils"}],PvPDeckModel:[function(t,e,i){"use strict";cc._RF.push(e,"af631rsgopIGJ8ohs8Q/hBN","PvPDeckModel");var a=t("DeckModel");cc.Class({extends:a});cc._RF.pop()},{DeckModel:"DeckModel"}],PvPDeckSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"f113erqUBlO1ro0CHSg9SJi","PvPDeckSelectSubRoot");t("CommonButton"),t("CharacterUtils");var a=t("DeckConst");cc.Class({extends:cc.Component,properties:{deckSelectViewPrefab:cc.Prefab},_root:null,_deckTabView:null,initPvPDeckSelectSubRoot:function(t,e,i){this._root=t,this._deckTabView||(this._deckTabView=cc.instantiate(this.deckSelectViewPrefab).getComponent("DeckTabView"),this._deckTabView.initDeckTabView(t,e,a.DECK_TYPE.PVP,i,a.DECK_COUNT_MAX.PVP),this._deckTabView.switchActiveExecuteDeckEditBtn(!0),this.node.addChild(this._deckTabView.node))},setDeckArray:function(t){this._deckTabView.setDeckArray(t)},redraw:function(){this._deckTabView.redraw()}}),cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",DeckConst:"DeckConst"}],PvPEnemyUnitCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"da6adIeyZxE76fCx9I94x2x","PvPEnemyUnitCtrl");var a=t("MonsterUnitCtrl"),n=(t("Singleton"),t("ResourceUtils"),t("CharacterConst")),o=t("BattleFunction"),r=cc.Class({extends:a,playBeAttacked:function(t,e){var i=this.myBattleUnit.mainAvatar;e.isDead;if(this.nowPlayingDeath)t();else{this.myBattleUnit.mainAvatar.setAnimation(0,"damage"+this.getAnimationAddName(),!1);var a=this;i.setCompleteListener(function(e,n){i.setCompleteListener(null),i.setAnimation(0,"idle"+a.getAnimationAddName(),!0),t()}),o.playRandomBattleVoice(this.myBattleUnit.textMasterArray,n.TEXT_GROUP_TYPE.BATTLE.DAMAGE)}},playDead:function(t,e){o.playRandomBattleVoice(this.myBattleUnit.textMasterArray,n.TEXT_GROUP_TYPE.BATTLE.DEATH),this._super(t,e)}});e.exports=r,cc._RF.pop()},{BattleFunction:"BattleFunction",CharacterConst:"CharacterConst",MonsterUnitCtrl:"MonsterUnitCtrl",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],PvPEquipmentModel:[function(t,e,i){"use strict";cc._RF.push(e,"97e71vrNL1NsryAwpUQNwx3","PvPEquipmentModel");var a=t("EquipmentModel");cc.Class({extends:a});cc._RF.pop()},{EquipmentModel:"EquipmentModel"}],PvPListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"b6b7bULAJ5KGqeRv0Cxl1US","PvPListViewBase");var a=t("ListViewBase");cc.Class({extends:a,properties:{}});cc._RF.pop()},{ListViewBase:"ListViewBase"}],PvPMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"d8226fx1MlBII/i/8zdtCF9","PvPMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSeason:function(){if(this._isKeyFieldAvailable("season"))return this._data.season;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: season")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getMaxStamina:function(){if(this._isKeyFieldAvailable("maxStamina"))return this._data.maxStamina;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxStamina")},getRecoveryTime:function(){if(this._isKeyFieldAvailable("recoveryTime"))return this._data.recoveryTime;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: recoveryTime")},getRecoveryStamina:function(){if(this._isKeyFieldAvailable("recoveryStamina"))return this._data.recoveryStamina;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: recoveryStamina")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getTurn:function(){if(this._isKeyFieldAvailable("turn"))return this._data.turn;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: turn")},getWinPointBasic:function(){if(this._isKeyFieldAvailable("winPointBasic"))return this._data.winPointBasic;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: winPointBasic")},getLostTurnPointBasic:function(){if(this._isKeyFieldAvailable("lostTurnPointBasic"))return this._data.lostTurnPointBasic;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lostTurnPointBasic")},getLostAnnihilationPointBasic:function(){if(this._isKeyFieldAvailable("lostAnnihilationPointBasic"))return this._data.lostAnnihilationPointBasic;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lostAnnihilationPointBasic")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],PvPModel:[function(t,e,i){"use strict";cc._RF.push(e,"5b0ebRUnlRIcqDmYkE5VQX5","PvPModel");var a=t("UserPvPModel"),n=t("Singleton"),o=t("TimeUtils");cc.Class({userData:void 0,_pvpMainMaster:void 0,_pvpClassMaster:void 0,_nextPvPClassMaster:void 0,_pvpStaminaRecoveryTimeArray:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._pvpMainMaster=null,this._pvpClassMaster=null,this._nextPvPClassMaster=null,this._pvpStaminaRecoveryTimeArray=null},getPvPMainMaster:function(){return this._pvpMainMaster||(this._pvpMainMaster=n.dao.PvPMainMasters.find(function(t){return t.getSeason()===this.userData.getSeason()}.bind(this))),this._pvpMainMaster},getPvPClassMaster:function(){return this._pvpClassMaster||(this._pvpClassMaster=n.dao.PvPClassMasters.find(function(t){return t.getClass()===this.getPvpClass()}.bind(this))),this._pvpClassMaster},getNextPvPClassMaster:function(){return this._nextPvPClassMaster||(this._nextPvPClassMaster=n.dao.PvPClassMasters.find(function(t){return t.getClass()===this.getPvpClass()+1}.bind(this))),this._nextPvPClassMaster},_getStaminaRecoveryTimeArray:function(){return this._pvpStaminaRecoveryTimeArray||(this.getPvPMainMaster()?(this._pvpStaminaRecoveryTimeArray=""+this.getPvPMainMaster().getRecoveryTime(),this._pvpStaminaRecoveryTimeArray=this._pvpStaminaRecoveryTimeArray.split(",")):this._pvpStaminaRecoveryTimeArray=[]),this._pvpStaminaRecoveryTimeArray},getName:function(){return this.getPvPClassMaster().getName()},getMaxStamina:function(){return this.getPvPMainMaster()?this.getPvPMainMaster().getMaxStamina():0},getRecoveryStamina:function(){return this.getPvPMainMaster()?this.getPvPMainMaster().getRecoveryStamina():0},getNextStaminaRecoveryTime:function(){var t=this._getStaminaRecoveryTimeArray().find(function(t){return parseInt(t)>parseInt(o.getNowTime())});return t||this._getStaminaRecoveryTimeArray()[0]},getPoint:function(){return this.userData.getPoint()},getNextClassNeedPoint:function(){return this.getNextClassPoint()-this.getPoint()>0?this.getNextClassPoint()-this.getPoint():0},getNextClassPoint:function(){return this.getNextPvPClassMaster()?this.getNextPvPClassMaster().getPointFrom():0},getPvpClass:function(){return this.userData.getPvpClass()},getFromDate:function(){return this.getPvPMainMaster()?this.getPvPMainMaster().getFromDate():""},getToDate:function(){return this.getPvPMainMaster()?this.getPvPMainMaster().getToDate():""},getStamina:function(){return this._calculateStamina()},_calculateStamina:function(){var t=o.getNowDateTime();if(!this.userData.getLastRecoveryDate())return this.getMaxStamina();var e=(o.getDiffDayLineCount(this.userData.getLastRecoveryDate())+1)*this._getStaminaRecoveryTimeArray().length,i=_.filter(this._getStaminaRecoveryTimeArray(),function(t){return t<=this.userData.getLastRecoveryDate().substr(8)}.bind(this)).length,a=_.filter(this._getStaminaRecoveryTimeArray(),function(e){return e>t.substr(8)}).length,n=this.userData.getStamina()+(e-i-a)*this.getRecoveryStamina();return Math.max(0,Math.min(this.getMaxStamina(),n))},getUpdateCount:function(){return this.userData.getUpdateCount()},getWinCount:function(){return this.userData.getWinCount()},getMaxScore:function(){return this.userData.getMaxScore()},getPvPMedalItemId:function(){return this.getPvPMainMaster()?this.getPvPMainMaster().getItemId():0}});cc._RF.pop()},{Singleton:"Singleton",TimeUtils:"TimeUtils",UserPvPModel:"UserPvPModel"}],PvPPictureBookDetailModel:[function(t,e,i){"use strict";cc._RF.push(e,"69f34mE7ztFMLcSVDh3ILL5","PvPPictureBookDetailModel");var a=t("PictureBookDetailModel");cc.Class({extends:a});cc._RF.pop()},{PictureBookDetailModel:"PictureBookDetailModel"}],PvPPlayerStatusView:[function(t,e,i){"use strict";cc._RF.push(e,"0a0feWs1qVLZIhfgapZqcqa","PvPPlayerStatusView");var a=t("ResourceUtils"),n=(t("PvPUtils"),t("Singleton")),o=t("TimeUtils"),r=t("ViewUtils"),s=(t("GameConst"),t("DeckConst"));cc.Class({extends:cc.Component,properties:{rankingLabel:cc.Label,className:cc.Label,classPointLabel:cc.Label,nextClassNeedPointLabel:cc.Label,pvpResetRemainTimeLabel:cc.Label,pvpResetRemainSuffixLabel:cc.Label,classImageSprite:cc.Sprite,characterStandViewParentNode:cc.Node},_characterStandView:null,onLoad:function(){this.node.runAction(cc.repeatForever(cc.sequence(cc.delayTime(1),cc.callFunc(this._setRemaintTimeLabel.bind(this)))))},drawPvPPlayerStatusView:function(){this._setLabels(n.dao.userPvP),this._setImages(n.dao.userPvP,n.dao[n.USER])},_setLabels:function(t){this.className.string=t.getName(),this.classPointLabel.string=t.getPoint(),this.nextClassNeedPointLabel.string=t.getNextClassNeedPoint(),this._setRemaintTimeLabel()},_setImages:function(t,e){this._initCharacterStandView(),a.addSprite(this.classImageSprite,a.getFileNamePvPClassIcon(t.getPvpClass())),this._setCharacterStandImage(e.getPartnerId(s.DECK_TYPE.PVP))},_setRemaintTimeLabel:function(){o.parseMsToDay(o.getDiffMS(n.dao.userPvP.getToDate()))>0?(this.pvpResetRemainTimeLabel.string=o.parseMsToDay(o.getDiffMS(n.dao.userPvP.getToDate()))+"",this.pvpResetRemainSuffixLabel.string="\u65e5"):o.parseMsToHour(o.getDiffMS(n.dao.userPvP.getToDate()))>0?(this.pvpResetRemainTimeLabel.string=o.parseMsToHour(o.getDiffMS(n.dao.userPvP.getToDate()))+"",this.pvpResetRemainSuffixLabel.string="\u6642\u9593"):(this.pvpResetRemainTimeLabel.string=o.parseMsToMinute(o.getDiffMS(n.dao.userPvP.getToDate()))+"",this.pvpResetRemainSuffixLabel.string="\u5206")},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=r.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_setCharacterStandImage:function(t){this._characterStandView.setCharacterStandImage(t)}});cc._RF.pop()},{DeckConst:"DeckConst",GameConst:"GameConst",PvPUtils:"PvPUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",ViewUtils:"ViewUtils"}],PvPPlayerThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"f1c12kXzU9LDIV2PyoehpOT","PvPPlayerThumbnailBase");t("GameConst");var a=t("DeckConst"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("StaticResourceConst");t("CharacterSortConst"),cc.Class({extends:cc.Component,properties:{deckCharacterParentNode:cc.Node,playerNameLabel:cc.Label,playerLevelLabel:cc.Label,totalPowerLabel:cc.Label},setPlayerName:function(t){this.playerNameLabel.string=t},setPlayerLevel:function(t){this.playerLevelLabel.string=t+""},setTotalPower:function(t){this.totalPowerLabel.string=n.convertToCommaDelimited(t)},setDeck:function(t){this.deckCharacterParentNode.destroyAllChildren();for(var e=a.DECK_LEADER_POSITION;e<=a.DECK_UNIT_COUNT_MAX;e+=1){var i=cc.instantiate(o.getResource(r.CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("CharacterMatrixThumbnail");t[e]?i.initCharacterMatrixThumbnail(t[e][a.ROLE_TYPE.MAIN].getCharacterMainMaster(),t[e][a.ROLE_TYPE.MAIN].getExceedLimit(),t[e][a.ROLE_TYPE.MAIN].getLevel(),1):i.initEmptyMatrixThumbnail(),this.deckCharacterParentNode.addChild(i.node)}}});cc._RF.pop()},{CharacterSortConst:"CharacterSortConst",CommonUtils:"CommonUtils",DeckConst:"DeckConst",GameConst:"GameConst",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],PvPPlayerThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"2cba28NnvNE2aMGoVp441Xi","PvPPlayerThumbnail");var a=t("CommonButton"),n=t("PvPPlayerThumbnailBase");cc.Class({extends:n,properties:{deckEditBtn:a},_callbackToDeckEditBtn:null,onLoad:function(){this.deckEditBtn.setTapEvent(this._onTapDeckEditBtn.bind(this))},setCallbackToDeckEditBtn:function(t){this._callbackToDeckEditBtn=t},_onTapDeckEditBtn:function(){this._callbackToDeckEditBtn()}});cc._RF.pop()},{CommonButton:"CommonButton",PvPPlayerThumbnailBase:"PvPPlayerThumbnailBase"}],PvPRankingPlayerThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"2219bTggRpKo7DKh1A2XQGn","PvPRankingPlayerThumbnail");t("CommonButton");var a=t("PvPUtils"),n=t("ResourceUtils"),o=t("PvPPlayerThumbnailBase"),r=cc.Enum({OTHER:0,FIRST:1,SECOND:2,THIRD:3});cc.Class({extends:o,properties:{rankingBaseNodeArray:[cc.Node],rankingLabel:cc.Label,classNameLabel:cc.Label,classImageSprite:cc.Sprite},setRanking:function(t){for(var e in this.rankingBaseNodeArray)this.rankingBaseNodeArray[e].active=!1;switch(this.rankingLabel.string=t+"\u4f4d",t){case r.FIRST:this.rankingBaseNodeArray[r.FIRST].active=!0;break;case r.SECOND:this.rankingBaseNodeArray[r.SECOND].active=!0;break;case r.THIRD:this.rankingBaseNodeArray[r.THIRD].active=!0;break;default:this.rankingBaseNodeArray[r.OTHER].active=!0}},setClass:function(t){var e=a.getPvPClassMasterByClassOrder(t);this.classNameLabel.string=e.getName(),n.addSprite(this.classImageSprite,n.getFileNamePvPClassIcon(e.getClass()))}});cc._RF.pop()},{CommonButton:"CommonButton",PvPPlayerThumbnailBase:"PvPPlayerThumbnailBase",PvPUtils:"PvPUtils",ResourceUtils:"ResourceUtils"}],PvPRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"ee962fyIYRCBZ6bBvHAfIf0","PvPRootUtils"),e.exports={openPvPTopSubRoot:function(t,e){cc.log("openPvPTopSubRoot"),cc.log(e),t.pvpTopSubRoot||(t.pvpTopSubRoot=cc.instantiate(t.pvpTopSubRootPrefab).getComponent("PvPTopSubRoot"),t.pvpTopSubRoot.initPvPTopSubRoot(t),t.subRootParent.addChild(t.pvpTopSubRoot.node))},closePvPTopSubRoot:function(t,e){cc.log("closePvPTopSubRoot"),t.pvpTopSubRoot&&(t.pvpTopSubRoot.node.destroy(),t.pvpTopSubRoot=null)},openPvPDeckSelectSubRoot:function(t,e){cc.log(e),t.pvpDeckSelectSubRoot||(t.pvpDeckSelectSubRoot=cc.instantiate(t.pvpDeckSelectSubRootPrefab).getComponent("PvPDeckSelectSubRoot"),t.pvpDeckSelectSubRoot.initPvPDeckSelectSubRoot(t,t.deckInfoArray,e.deckId),t.subRootParent.addChild(t.pvpDeckSelectSubRoot.node))},closePvPDeckSelectSubRoot:function(t,e){cc.log(e),t.pvpDeckSelectSubRoot&&(t.pvpDeckSelectSubRoot.node.destroy(),t.pvpDeckSelectSubRoot=null)},openPvPBattleStartConfirmSubRoot:function(t,e){cc.log(e),t.pvpBattleStartConfirmSubRoot||(t.pvpBattleStartConfirmSubRoot=cc.instantiate(t.pvpBattleStartConfirmSubRootPrefab).getComponent("PvPBattleStartConfirmSubRoot"),t.pvpBattleStartConfirmSubRoot.initPvPBattleStartConfirmSubRoot(t,t.deckInfoArray,e.deckId,e.userCd),t.subRootParent.addChild(t.pvpBattleStartConfirmSubRoot.node))},closePvPBattleStartConfirmSubRoot:function(t,e){cc.log(e),t.pvpBattleStartConfirmSubRoot&&(t.pvpBattleStartConfirmSubRoot.node.destroy(),t.pvpBattleStartConfirmSubRoot=null)}},cc._RF.pop()},{}],PvPRoot:[function(t,e,i){"use strict";cc._RF.push(e,"60bebtPa55C2Z4waDYTDAwG","PvPRoot");var a=t("DeckRootBase"),n=t("PvPUtils"),o=t("DeckUtils"),r=(t("Async"),t("Singleton")),s=t("CommonUtils"),c=t("PopupUtils"),l=t("PvPViewSetting"),u=t("BattleFunction"),h=t("GameConst"),d=t("DeckConst"),p=t("ExchangeConst"),m=t("LocalDataConst");cc.Class({extends:a,properties:{pvpTopSubRootPrefab:cc.Prefab,pvpDeckSelectSubRootPrefab:cc.Prefab,pvpBattleStartConfirmSubRootPrefab:cc.Prefab},pvpBattlePlayerArray:null,deckInfoArray:null,_getSceneBgmName:function(){return h.BGM.QUEST},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,l.PVP_SETTING)},initData:function(){this.getPvPUserData().getPvPMainMaster()&&(this.deckInfoArray=[],this.reload(),this._initPvPBattlePlayerArray())},_initPvPBattlePlayerArray:function(){this.getPvPUserData().getStamina()>0&&(this.requestURLCount++,this.pvpBattlePlayerArray?this.requestUpdateBattlePlayers():this.requestGetBattlePlayers())},initialize:function(){if(this.getPvPUserData().getPvPMainMaster()){this.initOutGameRootBase(),this.setCurrencyUIHeader(h.ITEM_ID_PVP,null),this.redrawUIHeader();this._initOpenFirstView({PvPTopSubRoot:{}})}else c.openSimpleMessageWindow("\u73fe\u5728\u958b\u50ac\u4e2d\u306e\u30a2\u30ea\u30fc\u30ca\u306f\u3042\u308a\u307e\u305b\u3093\u3002",this.popScene.bind(this))},reload:function(){this.deckInfoArray=o.getDeckArrayByDeckTypes([d.DECK_TYPE.PVP])},pushPvPDeckSelectSubRoot:function(){var t={PvPDeckSelectSubRoot:{deckId:r.localData[m.SELECT_PVP_DECK_ORDER]}},e=this.getCurrentSceneName(),i=this.sceneParam;Object.keys(t)[0]===Object.keys(i)[0]&&(e=null,i=null),this.pushScene("PvPScene",e,t,i)},pushPvPBattleStartConfirmSubRoot:function(t){var e={PvPBattleStartConfirmSubRoot:{deckId:r.localData[m.SELECT_PVP_DECK_ORDER],userCd:t}},i=this.getCurrentSceneName(),a=this.sceneParam;Object.keys(e)[0]===Object.keys(a)[0]&&(i=null,a=null),this.pushScene("PvPScene",i,e,a)},transitionExchangeScene:function(){var t={ExchangeSubRoot:{exchangeId:p.EXCHANGE_TAB_TYPE.PVP}},e=this.getCurrentSceneName(),i=this.sceneParam;Object.keys(t)[0]===Object.keys(i)[0]&&(e=null,i=null),this.pushScene("ExchangeScene",e,t,i)},transitionPvPBattleScene:function(t,e){this.pushScene("battleLoading",t,{},e)},requestGetBattlePlayers:function(t){this.pvpBattlePlayerArray=[],n.requestGetBattlePlayers(function(e,i){i?this._requestEndBattlePlayers(e,function(){c.openCommonPopupOk("\u65b0\u30b7\u30fc\u30ba\u30f3","\u30b7\u30fc\u30ba\u30f3\u304c\u5207\u308a\u66ff\u308f\u308a\u307e\u3057\u305f\u3002","",!1,function(){return t&&t()},void 0)}):this._requestEndBattlePlayers(e,t)}.bind(this))},requestUpdateBattlePlayers:function(t){this.pvpBattlePlayerArray=[],n.requestUpdateBattlePlayers(function(e,i){i?c.openCommonPopupOk("\u65b0\u30b7\u30fc\u30ba\u30f3","\u30b7\u30fc\u30ba\u30f3\u304c\u5207\u308a\u66ff\u308f\u308a\u307e\u3057\u305f\u3002","",!1,function(){this._requestEndBattlePlayers(e,function(){this.reload(),this.setCurrencyUIHeader(h.ITEM_ID_PVP,null),this.redrawUIHeader(),this.pvpTopSubRoot.initPvPTopSubRoot(this)}.bind(this))}.bind(this),void 0):this._requestEndBattlePlayers(e,t)}.bind(this))},_requestEndBattlePlayers:function(t,e){if(this.pvpBattlePlayerArray=t,this.requestURLCount-=1,e)return e()},requestStartPvPBattle:function(t,e,i){r.PvPService.startBattle(t,r.localData[m.SELECT_PVP_DECK_ORDER],function(t){cc.log(t),t.isNewSeason?c.openCommonPopupOk("\u65b0\u30b7\u30fc\u30ba\u30f3","\u30b7\u30fc\u30ba\u30f3\u304c\u5207\u308a\u66ff\u308f\u308a\u307e\u3057\u305f\u3002","",!1,function(){this.popScene()}.bind(this),void 0):(u.setPvPStartBattleData(e,u.createPvPSessionObjectData(t.sessionId),u.createPvPBattleCallbacks(this.requestEndBattle,this.requestEndBattle,this.transitionEventForEndBattle)),i&&i(t),this.transitionPvPBattleScene())}.bind(this))},getUserBasicData:function(){return r.dao.userBasicData},getPvPUserData:function(){return r.dao.userPvP},getPvPBattlePlayerDataByCd:function(t){return this.pvpBattlePlayerArray.find(function(e){return e.playerBase.userCd===t})},requestEndBattle:function(t,e){r.PvPService.endBattle(t,function(t){t.isNewSeason?c.openCommonPopupOk("\u65b0\u30b7\u30fc\u30ba\u30f3","\u30b7\u30fc\u30ba\u30f3\u304c\u5207\u308a\u66ff\u308f\u308a\u307e\u3057\u305f\u3002","",!1,function(){s.getRoot().popScene()},void 0):e&&e(t)})},transitionEventForEndBattle:function(){s.getRoot().popScene()},_deckUpdateCallbackEvent:function(){this.reload(),this.pvpDeckSelectSubRoot&&(this.pvpDeckSelectSubRoot.setDeckArray(this.deckInfoArray),this.pvpDeckSelectSubRoot.redraw())}});cc._RF.pop()},{Async:"Async",BattleFunction:"BattleFunction",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckRootBase:"DeckRootBase",DeckUtils:"DeckUtils",ExchangeConst:"ExchangeConst",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",PvPUtils:"PvPUtils",PvPViewSetting:"PvPViewSetting",Singleton:"Singleton"}],PvPService:[function(t,e,i){"use strict";cc._RF.push(e,"fece9gjuLpAXIpv1FF+7l2z","PvPService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getBattlePlayers:function(t){this._requestCallApi(n.PVP_GET_BATTLE_PLAYERS,{},function(e,i){return t(e?void 0:i)})},updateBattlePlayers:function(t){this._requestCallApi(n.PVP_UPDATE_BATTLE_PLAYERS,{},function(e,i){return t(e?void 0:i)})},startBattle:function(t,e,i){var a={playerId:t,deckId:e};this._requestCallApi(n.PVP_START_BATTLE,a,function(t,e){return i(t?void 0:e)})},endBattle:function(t,e){var i={parameter:t};this._requestCallApi(n.PVP_END_BATTLE,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],PvPStartAnimGameRoot:[function(t,e,i){"use strict";cc._RF.push(e,"529b24lkptKPrxzvL3XUl57","PvPStartAnimGameRoot");var a=t("GameRootBase");cc.Class({extends:a,properties:{pvpStartAnimPrefab:cc.Prefab},initialize:function(){var t=cc.instantiate(this.pvpStartAnimPrefab).getComponent("PvPStartAnimSubRoot");t.initPvPStartAnimSubRoot(this),this.node.addChild(t.node)},updateChild:function(){}});cc._RF.pop()},{GameRootBase:"GameRootBase"}],PvPStartAnimPlayerInfoView:[function(t,e,i){"use strict";cc._RF.push(e,"c23573BGYRFT4LgOhfLil29","PvPStartAnimPlayerInfoView");var a=t("PvPUtils"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{pvpCharacterImageSprite:cc.Sprite,pvpClassImageSprite:cc.Sprite,pvpClassNameLabel:cc.Label,pvpPlayerNameLabel:cc.Label},initPvPStartAnimPlayerInfoView:function(t,e,i){this._setUserName(t),this._setCharacterImage(e),this._setClass(i)},_setUserName:function(t){this.pvpPlayerNameLabel.string=t},_setCharacterImage:function(t){n.addSprite(this.pvpCharacterImageSprite,n.getFileNameCharacterStand(t))},_setClass:function(t){var e=a.getPvPClassMasterByClassOrder(t);this.pvpClassNameLabel.string=e.getName(),n.addSprite(this.pvpClassImageSprite,n.getFileNamePvPClassIcon(e.getClass()))}}),cc._RF.pop()},{PvPUtils:"PvPUtils",ResourceUtils:"ResourceUtils"}],PvPStartAnimSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"52c88P9tdxN7qTfCOqAnHx4","PvPStartAnimSubRoot");var a=t("PvPStartAnimPlayerInfoView"),n=t("BattleData"),o=t("Singleton"),r=t("GameConst"),s=t("DeckConst");cc.Class({extends:cc.Component,properties:{pvpStartAnimation:cc.Animation,pvpPlayerInfoView:a,pvpTargetInfoView:a},_root:null,initPvPStartAnimSubRoot:function(t){this._root=t,this._initStartAnimation(),this._playStartAnimation(function(){cc.director.loadScene("ArenaScene.fire")})},_initStartAnimation:function(){this.pvpPlayerInfoView.initPvPStartAnimPlayerInfoView(o.dao.userBasicData.getUserName(),o.dao.userBasicData.getPartnerId(s.DECK_TYPE.PVP),o.dao.userPvP.getPvpClass()),this.pvpTargetInfoView.initPvPStartAnimPlayerInfoView(n.pvpBattlePlayerData.playerDetail.playerName,this._getTargetCharacterId(),n.pvpBattlePlayerData.playerBase.pvpClass)},_getTargetCharacterId:function(){return 0===n.pvpBattlePlayerData.playerBase.partnerId?n.pvpBattlePlayerData.playerDetail.deck[s.DECK_TYPE.PVP][r.DECK_ID_ORIGIN][s.DECK_LEADER_POSITION][s.ROLE_TYPE.MAIN].getCharacterId():n.pvpBattlePlayerData.playerBase.partnerId},_playStartAnimation:function(t){this.pvpStartAnimation.once("finished",function(e){return t(e)},this),this.pvpStartAnimation.play(this.pvpStartAnimation.getClips()[0].name)}}),cc._RF.pop()},{BattleData:"BattleData",DeckConst:"DeckConst",GameConst:"GameConst",PvPStartAnimPlayerInfoView:"PvPStartAnimPlayerInfoView",Singleton:"Singleton"}],PvPTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"d0e95zUfm5Fmbo0zfvzQXmX","PvPTopSubRoot");var a=t("CommonButton"),n=(t("GameConst"),t("CommonUtils"),t("ItemUtils"),t("DeckUtils"),t("ResourceUtils"),t("NoticeBadgeCheckUtils")),o=t("ViewUtils"),r=t("PvPPlayerStatusView"),s=t("PvPTopTabView"),c={POSITION:cc.v2(28,32),SCALE:cc.v2(1,1)};cc.Class({extends:cc.Component,properties:{pvpPlayerStatusView:r,pvpTopTabView:s,exchangeBtn:a},_root:null,onLoad:function(){this.exchangeBtn.setTapEvent(this._onTapExchangeBtn.bind(this),a.SE_NAME.SELECT),n.hasNewArenaExchangeItem()&&o.addNoticeBadge(this.exchangeBtn.node,c.POSITION,c.SCALE)},initPvPTopSubRoot:function(t){this._root=t,this.pvpPlayerStatusView.drawPvPPlayerStatusView(),this.pvpTopTabView.initPvPTopTabView(t,0)},_onTapExchangeBtn:function(){this._root&&this._root.transitionExchangeScene()}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",PvPPlayerStatusView:"PvPPlayerStatusView",PvPTopTabView:"PvPTopTabView",ResourceUtils:"ResourceUtils",ViewUtils:"ViewUtils"}],PvPTopTabView:[function(t,e,i){"use strict";cc._RF.push(e,"cf267vRZTVGMrhRJiNA93mw","PvPTopTabView");var a=t("TabViewBase"),n=t("PvPListViewBase");cc.Class({extends:a,properties:{pvpListViewArray:[n]},_root:null,initPvPTopTabView:function(t,e){this._root=t,this.initTabViewBase(),this._setCurrentTab(e),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetListView(),this.pvpListViewArray[t].initListView(this._root)},_resetListView:function(){for(var t in this.pvpListViewArray)this.pvpListViewArray[t].resetListView()}});cc._RF.pop()},{PvPListViewBase:"PvPListViewBase",TabViewBase:"TabViewBase"}],PvPUtils:[function(t,e,i){"use strict";cc._RF.push(e,"017d4MOGf9O3rzgwXNZtxzz","PvPUtils");var a=t("CommonUtils"),n=t("Singleton"),o=t("DeckUtils"),r=t("PvPCharacterModel"),s=t("PvPPictureBookDetailModel"),c=t("PvPEquipmentModel"),l=t("PvPDeckModel"),u=(t("CharacterConst"),t("GameConst"),null);function h(t){var e=_.maxBy(n.dao.PvPClassMasters,function(t){return t.getClass()}),i=_.minBy(n.dao.PvPClassMasters,function(t){return t.getClass()}),a=t?Math.max(Math.min(t,e.getClass()),i.getClass()):i.getClass();return n.dao.PvPClassMasters.find(function(t){return t.getClass()===a})}function d(){u=[];var t=n.dao.PvPClassMasters,e=[];for(var i in e.push({getterName:"getClass",order:"desc"}),t=a.sortModels(t,e)){var o=t[i].getClass();u.push(T(t[i],p(o)))}return u}function p(t){return n.dao.PvPClassRewardMasters.filter(function(e){return e.getClass()===t})}function m(t){for(var e=[],i=0;i<t.battlePlayers.length;i+=1){var a=g(t.battlePlayers[i]);e.push({playerBase:t.battlePlayers[i],playerDetail:a})}return e}function g(t){return C(t.userName,t.level,f(t.targetEquipments,t.targetPictureBookDetail,t.targetCharacters,t.targetDecks))}function C(t,e,i){return{playerName:t,playerLevel:e,deck:i}}function f(t,e,i,a){for(var n={},u=0;u<t.length;u+=1){var h=t[u],d=new c(h);n[d.getEquipmentCd()]=d}for(var p={},m=0;m<e.length;m+=1)p[e[m].characterId]=new s(e[m]);for(var _=[],g=0;g<i.length;g+=1){var C=i[g],f=new r(C,p,n);_.push(f)}for(var E=[],T=0;T<a.length;T+=1){var S=a[T],R=new l(S);E.push(R)}return o.createDeckMapByModels(_,E)}function E(t,e){return{userCd:t.userCd,level:t.level,classPoint:t.point,pvpClass:t.pvpClass,pvpRank:e,deckTotalPower:t.deckPower,userName:t.userName,deckMap:f([],[],t.characters,t.decks)}}function T(t,e){return{pvpClassMaster:t,pvpClassRewardMasterArray:e}}e.exports={getPvPClassMasterByClassOrder:h,getPvPClassInfoArray:function(){return u||(u=d()),u},requestGetRankingData:function(t){n.PvPService.getRankingData(function(e){var i=e.rankingData,n=[],o=0,r=-1;n.push({propertyName:"point",order:"desc"}),i=a.sortModels(i,n);var s=[];for(var c in i)i[c].point!==r&&(o+=1),s.push(E(i[c],o)),r=i[c].point;return t(s,e.isNewSeason)})},requestGetBattlePlayers:function(t){n.PvPService.getBattlePlayers(function(e){var i=m(e);return t(i,e.isNewSeason)})},requestUpdateBattlePlayers:function(t){n.PvPService.updateBattlePlayers(function(e){var i=m(e);return t(i,e.isNewSeason)})},getPvpClassMasterByPoint:function(t){return n.dao.PvPClassMasters.find(function(e){return e.getPointFrom()<=t&&t<=e.getPointTo()})},getCurExpOnZeroBasePvpClassMaster:function(t,e){var i=h(e);return i?t-i.getPointFrom():t},getNextPointPvpClass:function(t){var e=_.maxBy(n.dao.PvPClassMasters,function(t){return t.getClass()});if(t<_.minBy(n.dao.PvPClassMasters,function(t){return t.getClass()}).getClass()||t>=e.getClass())return 0;var i=h(t);return h(t+1).getPointFrom()-i.getPointFrom()}},cc._RF.pop()},{CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",PvPCharacterModel:"PvPCharacterModel",PvPDeckModel:"PvPDeckModel",PvPEquipmentModel:"PvPEquipmentModel",PvPPictureBookDetailModel:"PvPPictureBookDetailModel",Singleton:"Singleton"}],PvPViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"72209tSCE9E9oTneD8wXr6a","PvPViewSetting");var a=t("PvPRootUtils");e.exports={PVP_SETTING:{PvPTopSubRoot:{open:a.openPvPTopSubRoot,close:a.closePvPTopSubRoot},PvPDeckSelectSubRoot:{open:a.openPvPDeckSelectSubRoot,close:a.closePvPDeckSelectSubRoot},PvPBattleStartConfirmSubRoot:{open:a.openPvPBattleStartConfirmSubRoot,close:a.closePvPBattleStartConfirmSubRoot}}},cc._RF.pop()},{PvPRootUtils:"PvPRootUtils"}],QualitySettingPopup:[function(t,e,i){"use strict";cc._RF.push(e,"3857bmV7gpOraa6B+ec6jA1","QualitySettingPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=t("LocalDataConst"),s=t("GameConst"),c=t("DownManifestManager"),l=t("PopupUtils"),u=t("ViewUtils"),h=t("Singleton"),d=t("SingletonConst");cc.Class({extends:a,properties:{pcDispNode:cc.Node,spDispNode:cc.Node,qualitySwitchBtnArray:[n],okBtn:n,hdNeedCapacityNode:cc.Node,ldNeedCapacityNode:cc.Node,hdNeedCapacityGbLabel:cc.Label,ldNeedCapacityGbLabel:cc.Label,hdNeedCapacityMbLabel:cc.Label,ldNeedCapacityMbLabel:cc.Label},_quality:0,openQualitySettingPopup:function(t){this.setCloseCallBack(t),this._quality=o.loadLocalStorage(r.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,r.LOCAL_STORAGE_GET_TYPE.INTEGER),h.localData[r.RES_QUALITY]=this._quality,this._initQualitySwitchBtnArray(),cc.sys.isNative?(this.pcDispNode.active=!1,this.spDispNode.active=!0,this._setRequireCapacity(),this.hdNeedCapacityNode.active=!0,this.ldNeedCapacityNode.active=!0):(this.pcDispNode.active=!0,this.spDispNode.active=!1,this.hdNeedCapacityNode.active=!1,this.ldNeedCapacityNode.active=!1),this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.open()},_initQualitySwitchBtnArray:function(){for(var t=0;t<this.qualitySwitchBtnArray.length;t+=1)this._setCallbatkToQualitySwitchBtn(this.qualitySwitchBtnArray[t],t);var e=Math.max(0,this._quality-1);this.qualitySwitchBtnArray[e].switchBtnImage(!0)},_setCallbatkToQualitySwitchBtn:function(t,e){t.setTapEvent(this._onTapQualitySwitchBtn.bind(this,t,e+s.DEFAULT_RESOURCE_QUALITY))},_resetQualitySwitchBtnArray:function(){for(var t=0;t<this.qualitySwitchBtnArray.length;t+=1)this.qualitySwitchBtnArray[t].switchBtnImage(!1)},_onTapQualitySwitchBtn:function(t,e){this.isOverMaxTextureSize(e)?(this._quality=e,this._resetQualitySwitchBtnArray(),t.switchBtnImage(!0)):l.openCommonPopupOk("","\u3053\u306e\u7aef\u672b\u3067\u306f\u9ad8\u89e3\u50cf\u5ea6\u3092\u9078\u629e\u3059\u308b\u3068\n\u8868\u793a\u304c\u4e71\u308c\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002","",!1,function(){this._quality=e,this._resetQualitySwitchBtnArray(),t.switchBtnImage(!0)}.bind(this))},_onTapOkBtn:function(){this._quality!==o.loadLocalStorage(r.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,r.LOCAL_STORAGE_GET_TYPE.INTEGER)?(h.localData[r.RES_QUALITY]=this._quality,o.saveLocalStorage(r.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,this._quality),this.requestDownMainfest()):this.close()},requestDownMainfest:function(){u.addModalLayer();var t=this;c.instance.loadDownLoadMainfest(function(e){u.removeModalLayer(),e?l.openCommonPopupOk("",e,"",!1,function(){t.requestDownMainfest()}):this.close()}.bind(this))},_setRequireCapacity:function(){var t=c.instance.getNeedCapacity(),e=t[0],i=t[1];this.ldNeedCapacityGbLabel.string=o.convertToCommaDelimited((e/1024).toFixed(2))+"GB",this.hdNeedCapacityGbLabel.string=o.convertToCommaDelimited((i/1024).toFixed(2))+"GB",this.ldNeedCapacityMbLabel.string="("+o.convertToCommaDelimited(e.toFixed(2))+"MB)",this.hdNeedCapacityMbLabel.string="("+o.convertToCommaDelimited(i.toFixed(2))+"MB)"},isOverMaxTextureSize:function(t){if(cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID&&t===s.RESOURCE_QUALITY.HIGH){var e=h[d.ENVIRONMENT];return!(jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","getMaxTextureSize","()I")<s.MAX_TEXTURE_SIZE)}return!0}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupBase:"PopupBase",PopupUtils:"PopupUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",ViewUtils:"ViewUtils"}],QuestAchieveModel:[function(t,e,i){"use strict";cc._RF.push(e,"8f36aabdUFMdINyMDypKtRR","QuestAchieveModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getConditionValue:function(){if(this._isKeyFieldAvailable("conditionValue"))return this._data.conditionValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionValue")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getAchieveId:function(){if(this._isKeyFieldAvailable("achieveId"))return this._data.achieveId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: achieveId")},getAchieveType:function(){if(this._isKeyFieldAvailable("achieveType"))return this._data.achieveType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: achieveType")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestApis:[function(t,e,i){"use strict";cc._RF.push(e,"ca594vF0TZJiIQ7KvP7t0Ti","QuestApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.QUEST_GET_MASTER_DATA,path:"quest/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.QUEST_GET_USER_DATA,path:"quest/getUserData",method:"POST"}),a.RESTClient.graft({name:n.QUEST_START_BATTLE,path:"quest/startBattle",method:"POST"}),a.RESTClient.graft({name:n.QUEST_END_BATTLE,path:"quest/endBattle",method:"POST"}),a.RESTClient.graft({name:n.QUEST_START_BATTLE_TRANSACTION,path:"quest/startBattleTransaction",method:"POST"}),a.RESTClient.graft({name:n.QUEST_SAVE_BATTLE_TRANSACTION,path:"quest/saveBattleTransaction",method:"POST"}),a.RESTClient.graft({name:n.QUEST_CLEAR_BATTLE_TRANSACTION,path:"quest/clearBattleTransaction",method:"POST"}),a.RESTClient.graft({name:n.QUEST_SKIP_BATTLE,path:"quest/skipBattle",method:"POST"}),a.RESTClient.graft({name:n.QUEST_UNLOCK,path:"quest/unlockQuest",method:"POST"}),a.RESTClient.graft({name:n.QUEST_STAGE_DATA,path:"quest/getStageData",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],QuestAreaListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"4702dq+Q5FG6aW7d1ZanQqg","QuestAreaListViewBase");var a=t("QuestUtils"),n=t("GameConst"),o=t("QuestListViewBase");cc.Class({extends:o,getBackListTitle:function(){return""},getCallbackToSwitchThumbnailImage:function(){},isStageListView:function(){return!1},_setListContent:function(t){t.selectDifficult||(t.selectDifficult=n.QUEST_DIFFICULT.NORMAL.NORMAL);var e=a.getUserQuestDifficultMapByWorldId(t.selectWorldId,t.selectDifficult),i={},o={};for(var r in e){a.checkNowWeekByAreaId(parseInt(r))?i[r]=e[r]:o[r]=e[r]}this._addAreaThumbnailList(i),this._addAreaThumbnailList(o)},_addThumbnail:function(t){if(a.checkNowWeekByAreaId(t.getAreaId())){var e=cc.instantiate(this.thumbnailPrefab).getComponent("AreaThumbnailView");e.initAreaThumbnailView(this._root,t.getAreaId(),t),this.thumbnailParentNode.addChild(e.node)}},_callbackToThumbnail:function(t){cc.warn("_callbackToThumbnail\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u4e0b\u3055\u3044")},_addAreaThumbnailList:function(t){for(var e in t){var i=t[e],a=i[Object.keys(i)[0]].getQuestAreaMaster();this._addThumbnail(a)}}});cc._RF.pop()},{GameConst:"GameConst",QuestListViewBase:"QuestListViewBase",QuestUtils:"QuestUtils"}],QuestAreaModel:[function(t,e,i){"use strict";cc._RF.push(e,"7c142TeLuNNYpZ71LOxMd4e","QuestAreaModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getRewardItemId:function(){if(this._isKeyFieldAvailable("rewardItemId"))return this._data.rewardItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemId")},getAreaId:function(){if(this._isKeyFieldAvailable("areaId"))return this._data.areaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: areaId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getStartTime:function(){if(this._isKeyFieldAvailable("startTime"))return this._data.startTime;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: startTime")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getRewardItemCount:function(){if(this._isKeyFieldAvailable("rewardItemCount"))return this._data.rewardItemCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemCount")},getImageName:function(){if(this._isKeyFieldAvailable("imageName"))return this._data.imageName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: imageName")},getWorldId:function(){if(this._isKeyFieldAvailable("worldId"))return this._data.worldId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: worldId")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getEndTime:function(){if(this._isKeyFieldAvailable("endTime"))return this._data.endTime;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endTime")},getRewardItemType:function(){if(this._isKeyFieldAvailable("rewardItemType"))return this._data.rewardItemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemType")},getWeekTypes:function(){if(this._isKeyFieldAvailable("weekTypes"))return this._data.weekTypes;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: weekTypes")},getDifficult:function(){if(this._isKeyFieldAvailable("difficult"))return this._data.difficult;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: difficult")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestAreaNormalListView:[function(t,e,i){"use strict";cc._RF.push(e,"c41e1HVTitDKrybpuMxV2Kb","QuestAreaNormalListView");t("QuestUtils");var a=t("GameConst"),n=t("QuestAreaListViewBase");cc.Class({extends:n,getListTitle:function(){return"\u30a8\u30ea\u30a2\u9078\u629e"},getBackListTitle:function(){return"\u30ef\u30fc\u30eb\u30c9\u9078\u629e"},getTextGroup:function(){return a.QUEST_TEXT_GROUP.NORMAL},_callbackToThumbnail:function(t){}});cc._RF.pop()},{GameConst:"GameConst",QuestAreaListViewBase:"QuestAreaListViewBase",QuestUtils:"QuestUtils"}],QuestAreaStageSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"13a8bpEucNLSI3TEFreH6J3","QuestAreaStageSelectSubRoot");var a=t("WindowBase"),n=t("QuestUtils"),o=t("GameConst"),r=t("AreaThumbnailView"),s=(t("DeckUtils"),t("Singleton")),c=t("LocalDataConst"),l=t("CharacterUtils"),u=t("PictureBookUtils"),h=(t("ResourceUtils"),t("ViewUtils")),d=t("CharacterConst");cc.Class({extends:a,properties:{questNormalExTabViewPrefab:cc.Prefab,areaThumbnailViewPrefab:cc.Prefab,characterStandViewParentNode:cc.Node,serifWindowPos:cc.Node},_root:null,_selectedWorldId:0,_selectedWorldCategory:0,_questNormalExTabView:null,_questUserMap:null,_characterMainModelArray:null,_iCharacterLength:null,_iCurrentCharacter:null,_characterStandView:null,_serifBalloon:null,initQuestAreaStageSelectSubRoot:function(t,e,i,a){this._root=t,e||(e=s.localData[c.SELECT_WORLD_ID]),this._selectedWorldId=e,this._setInitQuestData(e),this._root.selectDifficult=a||o.QUEST_DIFFICULT.NORMAL.NORMAL,this._questNormalExTabView||(this._questNormalExTabView=cc.instantiate(this.questNormalExTabViewPrefab).getComponent("QuestNormalExTabView"),this.node.addChild(this._questNormalExTabView.node));var r=n.getUserQuestDifficultMapByWorldId(this._selectedWorldId,o.QUEST_DIFFICULT.NORMAL.EX),l=Object.keys(r).length>0,u=n.isAreaDifficultByWorldId(e,o.QUEST_DIFFICULT.NORMAL.EX);this._questNormalExTabView.initQuestNormalExTabView(t,u,l),this._initCharacterStandView(),this._reloadCharacterStandImage(),this._serifBalloon||(this._serifBalloon=h.createSerifWindow(),this.serifWindowPos.addChild(this._serifBalloon.node)),this._reloadSerifBalloon(),this._root.redrawBackGround(e)},initAreaScrollView:function(t){t||(t=o.QUEST_DIFFICULT.NORMAL.NORMAL),this._questNormalExTabView.initAreaScrollView(this._root,n.getUserQuestDifficultMapByWorldId(this._selectedWorldId,t),"\u30a8\u30ea\u30a2\u9078\u629e",this._createAreaThumbnail.bind(this))},initStageScrollView:function(t,e){e||(e=o.QUEST_DIFFICULT.NORMAL.NORMAL),this._questNormalExTabView.initStageScrollView(this._root,t,n.getUserQuestDifficultMapByWorldId(this._selectedWorldId,e),"\u30b9\u30c6\u30fc\u30b8\u9078\u629e")},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=h.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_reloadCharacterStandImage:function(){this._characterStandView.setCharacterStandImage(this._root.getNavigatorCharacterId())},_setInitQuestData:function(t){var e=t;e?(this._selectedWorldId=e,this._selectedWorldCategory=this._convertWorldCategory(e)):(this._selectedWorldId=0,this._selectedWorldCategory=o.WORLD_CATEGORY.NORMAL,this._setQuestData())},_setQuestData:function(){0===this._selectedWorldId&&(this._selectedWorldId=this._getSelectedWorldId(this._selectedWorldCategory))},_convertWorldCategory:function(t){switch(parseInt(t/1e3)){case 1:return o.WORLD_CATEGORY.NORMAL;default:return o.WORLD_CATEGORY.EVENT}},_getSelectedWorldId:function(t){var e=n.getUserWorldArrayByWorldCategory(t),i=null;switch(t){case o.WORLD_CATEGORY.NORMAL:i=e[e.length-1].getWorldId();break;case o.WORLD_CATEGORY.EVENT:i=e[0].getWorldId()}return i},_createAreaThumbnail:function(t){if(n.checkNowWeekByAreaId(t.getAreaId())){var e=cc.instantiate(this.areaThumbnailViewPrefab).getComponent(r);return e.initAreaThumbnailView(this._root,t.getAreaId(),t),e.node}return null},_reloadSerifBalloon:function(){var t=[],e=[],i=l.getCharacterMainModelByCharacterId(this._root.getNavigatorCharacterId());u.getCharacterTextMasterArray(i.getCharacterId(),d.TEXT_SCENE_TYPE.QUEST,this._questNormalExTabView.getCurrentListTextGroup()).forEach(function(i){t.push(i.getText()),e.push(i.getVoiceFile())}),this._serifBalloon.setSerifContent(i.getCharacterId(),i.getShortName(),t,e),this._serifBalloon.playRandomSerifAnimation()}}),cc._RF.pop()},{AreaThumbnailView:"AreaThumbnailView",CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PictureBookUtils:"PictureBookUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",ViewUtils:"ViewUtils",WindowBase:"WindowBase"}],QuestAreaWeekListView:[function(t,e,i){"use strict";cc._RF.push(e,"4ee5cljKdFCwIlsrEYrxaM9","QuestAreaWeekListView");var a=t("QuestUtils"),n=t("GameConst"),o=t("TimeUtils"),r=t("CommonUtils"),s=t("QuestAreaListViewBase");cc.Class({extends:s,getListTitle:function(){return"\u30af\u30a8\u30b9\u30c8\u9078\u629e"},getTextGroup:function(){return n.QUEST_TEXT_GROUP.WEEK},_setListContent:function(t){var e=this.thumbnailParentNode.getComponent(cc.Layout);e&&(e.verticalDirection=cc.Layout.VerticalDirection.TOP_TO_BOTTOM),t.selectDifficult||(t.selectDifficult=n.QUEST_DIFFICULT.NORMAL.NORMAL);var i=a.getUserQuestDifficultMapByWorldId(t.selectWorldId,t.selectDifficult),o=a.getAreaMasterMap(),s=Object.keys(i).map(function(t){return this._createWeekAreaInfo(parseInt(t),o)}.bind(this)),c=[];for(var l in c.push({propertyName:"unlockFlag",order:"desc"}),c.push({propertyName:"remainingMS",order:"asc"}),c.push({propertyName:"index",order:"asc"}),s=r.sortModels(s,c)){var u={};u[s[l].areaId]=i[s[l].areaId],this._addAreaThumbnailList(u)}},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("AreaWeekThumbnailView");e.initAreaWeekThumbnailView(this._root,t.getAreaId(),t,this._callbackToThumbnail.bind(this)),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(){this.initListView(this._root)},_getRemainingTime:function(t,e){switch(e){case n.LOCK_STATE.BOOST_UNLOCK:return o.getDiffMS(t.nowUnlockUserBoost.getEndDate());case n.LOCK_STATE.WEEK_UNLOCK:return o.getDiffMS(o.getNowDate()+"235959");default:return 99999999}},_getLockState:function(t,e){return a.checkNowWeekByAreaId(t)?n.LOCK_STATE.WEEK_UNLOCK:e.nowUnlockUserBoost?n.LOCK_STATE.BOOST_UNLOCK:e.todayUnlockUserBoosts.length>=this._unlockCount?n.LOCK_STATE.LOCK:n.LOCK_STATE.FREE_LOCK},_createWeekAreaInfo:function(t,e){var i=a.getTodayUnlockUserBoostByQuestId(n.QUEST_TYPE.AREA,t,[n.BOOST_TYPE.QUEST_UNLOCK,n.BOOST_TYPE.QUEST_LIMITED_UNLOCK]),o=this._getLockState(t,i),r=this._getRemainingTime(i,o);return{areaId:t,index:e[t].getIndex(),unlockFlag:o===n.LOCK_STATE.BOOST_UNLOCK||o===n.LOCK_STATE.WEEK_UNLOCK,lockState:o,remainingMS:r}}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",QuestAreaListViewBase:"QuestAreaListViewBase",QuestUtils:"QuestUtils",TimeUtils:"TimeUtils"}],QuestConditionUtils:[function(t,e,i){"use strict";cc._RF.push(e,"7618afvPEBPvadbXcmQtIZd","QuestConditionUtils");var a=t("Singleton"),n=t("GameConst"),o=t("QuestConst"),r=t("TimeUtils"),s=t("QuestUtils");function c(t){return t.getMaxClearCount()<=0||t.getMaxClearCount()>t.getClearCount()}function l(t){return!!(s.getTodayUnlockUserBoostByQuestId(n.QUEST_TYPE.WORLD,t.getWorldId(),[n.BOOST_TYPE.QUEST_UNLOCK]).nowUnlockUserBoost||s.getTodayUnlockUserBoostByQuestId(n.QUEST_TYPE.AREA,t.getAreaId(),[n.BOOST_TYPE.QUEST_UNLOCK]).nowUnlockUserBoost||s.getTodayUnlockUserBoostByQuestId(n.QUEST_TYPE.STAGE,t.getStageId(),[n.BOOST_TYPE.QUEST_UNLOCK]).nowUnlockUserBoost)||(t.getMaxDayPlayCount()<=0||t.getMaxDayPlayCount()>t.getTodayPlayCount())}function u(t,e){return t.getMaxSkipCount()<=0||e<=0||t.getMaxSkipCount()>=t.getTodaySkipCount()+e}function h(t){if(!t)return!1;var e=_.find(a.dao.QuestWorldMasters,function(e){return e.getWorldId()===t.getWorldId()});if(!e)return!1;if(!r.isRangeOfDate(e.getFromDate(),e.getToDate()))return!1;var i=_.find(a.dao.QuestAreaMasters,function(e){return e.getAreaId()===t.getAreaId()});return!!i&&!!r.isRangeOfDate(i.getFromDate(),i.getToDate())}function d(t){var e=_.find(a.dao.EventMainMasters,function(e){return e.getEventId()===t});return!!r.isRangeOfDate(e.getFromDate(),e.getToDate())&&p(e.getConditionType(),e.getConditionFrom(),e.getConditionTo())}function p(t,e,i){if(t===n.OPEN_CONDITION_TYPE.NON)return!0;var o=a.dao.userBasicData;if(t===n.OPEN_CONDITION_TYPE.RANK){var s=o.getLevel();return s>=e&&s<=i}if(t===n.OPEN_CONDITION_TYPE.REGISTER_DATE){var c=r.addMinute(o.getTutorialEndDate(),e),l=r.addMinute(o.getTutorialEndDate(),i);return r.isRangeOfDate(c,l)}return!1}e.exports={getStageConditionState:function(t,e,i){var n=_.find(a.dao.userQuests,function(e){return e.getStageId()===t});return n?h(n.getQuestStageMaster())?i&&!d(i)?o.STAGE_CONDITION_STATE.OUT_RANGE_PERIOD:c(n)?l(n)?u(n,e)?o.STAGE_CONDITION_STATE.ENABLED:o.STAGE_CONDITION_STATE.TODAY_SKIP_OVER_LIMIT:o.STAGE_CONDITION_STATE.TODAY_OVER_LIMIT:o.STAGE_CONDITION_STATE.TOTAL_OVER_LIMIT:o.STAGE_CONDITION_STATE.OUT_RANGE_PERIOD:o.STAGE_CONDITION_STATE.NOT_FOUND},isTotalClearCountEnabled:c,isTodaySkipCountEnabled:u,isStageOnPeriod:h,isEventOnPeriod:d},cc._RF.pop()},{GameConst:"GameConst",QuestConst:"QuestConst",QuestUtils:"QuestUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],QuestConst:[function(t,e,i){"use strict";cc._RF.push(e,"d1afeB9wn5J85p74eoeBnPu","QuestConst"),e.exports={STAGE_CONDITION_STATE:{ENABLED:0,NOT_FOUND:1,OUT_RANGE_PERIOD:2,TOTAL_OVER_LIMIT:3,TODAY_OVER_LIMIT:4,TODAY_SKIP_OVER_LIMIT:5},BATTLE_END_STATE:{NONE:0,SUCCESS:1}},cc._RF.pop()},{}],QuestDropInfoPopup:[function(t,e,i){"use strict";cc._RF.push(e,"d690e+XpfpBtLAbMu3SWp24","QuestDropInfoPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonScrollView"),s=t("QuestUtils"),c=(t("ResourceUtils"),t("MatrixThumbnailUtils")),l=t("EquipmentUtils"),u=t("ItemConst"),h="\u30c9\u30ed\u30c3\u30d7\u8a73\u7d30",d="\u8a0e\u4f10\u5831\u916c\u8a73\u7d30";cc.Class({extends:a,properties:{titleLabel:cc.Label,scrollView:r,okBtn:o},openQuestDropInfoPopup:function(t){this.titleLabel.string=h;var e=s.getDropMasterArrayByStageId(t,!0,!0);this.scrollView.content.destroyAllChildren();for(var i=0;i<e.length;i+=1){var a={};e[i].getItemType()===u.ITEM_TYPE.EQUIPMENT&&(a.rarity=l.getRarityByEquipmentIdAndExceedLimit(e[i].getItemId(),e[i].getExceedLimit()));var n=c.createMatrixThumbnailByItemType(e[i].getItemId(),e[i].getItemType(),a);this.scrollView.content.addChild(n.node)}this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.open()},openRaidRewardInfoPopup:function(t,e){this.titleLabel.string=d,this._initRaidRewardContent(t,e),this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.open()},_initRaidRewardContent:function(t,e){this.scrollView.content.destroyAllChildren();var i=_.find(n.dao.RaidBattleMasters,function(i){return i.getEventId()===t&&i.getStageId()===e});if(i){var a=_.find(n.dao.RaidRewardMasters,function(t){return t.getRewardId()===i.getRewardId()});if(a)for(var o=_.filter(n.dao.RaidRewardGroupMasters,function(t){return t.getRewardGroupId()===a.getNormalRewardGroupId()}),r=0;r<o.length;r+=1){var s=o[r],l=c.createMatrixThumbnailByItemType(s.getItemId(),s.getItemType());this.scrollView.content.addChild(l.node)}}},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupBase:"PopupBase",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],QuestDropModel:[function(t,e,i){"use strict";cc._RF.push(e,"5d086cI7hhE8rfj3iZMJUh2","QuestDropModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCountFrom:function(){if(this._isKeyFieldAvailable("countFrom"))return this._data.countFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: countFrom")},getCountTo:function(){if(this._isKeyFieldAvailable("countTo"))return this._data.countTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: countTo")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getDropType:function(){if(this._isKeyFieldAvailable("dropType"))return this._data.dropType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dropType")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestEnemyInfoPopup:[function(t,e,i){"use strict";cc._RF.push(e,"d9eb54+h8NCNYcBn6KKQdam","QuestEnemyInfoPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=t("ResourceUtils"),s=t("GameConst");cc.Class({extends:a,properties:{enemyThumbnailPrefab:cc.Prefab,scrollView:o,okBtn:n},openQuestEnemyInfoPopup:function(t){this.scrollView.content.destroyAllChildren();for(var e=0;e<t.length;e+=1){var i=cc.instantiate(this.enemyThumbnailPrefab).getComponent("EnemyMatrixThumbnail");i.initEnemyMatrixThumbnail(r.getFileNameEnemyThumbnail(t[e].path),r.getFileNameAttributeIcon(t[e].attribute),r.getFileNameRarityRing(s.RARITY.SR)),this.scrollView.content.addChild(i.node)}this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.open()},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",GameConst:"GameConst",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],QuestEventBannerThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"650d5+rZ7JJx5ihhvTIuq2/","QuestEventBannerThumbnail");var a=t("Singleton"),n=t("CommonButton"),o=t("ResourceUtils"),r=t("TimeUtils"),s=t("GameConst"),c=t("NoticeBadgeCheckUtils"),l=t("ViewUtils"),u=(t("LocalDataConst"),{POSITION:cc.v2(240,70),SCALE:cc.v2(1,1)});cc.Class({extends:cc.Component,properties:{eventBannerSprite:cc.Sprite,eventBannerButton:n,remainingDateNode:cc.Node,remainingDateLabel:cc.Label,remainingTimeNode:cc.Node,remainingTimeLabel:cc.Label},_root:null,_eventMainMaster:null,_callback:null,initQuestEventBannerThumbnail:function(t,e,i){this._root=t,this._eventMainMaster=e,this._callback=i,o.addSprite(this.eventBannerSprite,o.getFileNameEventThumbnailByEventId(this._eventMainMaster.getEventId())),this._setRemainingNode(),this._setButtonEvent()},_setButtonEvent:function(){this.eventBannerButton.setTapEvent(function(){this._callback&&this._callback(this._eventMainMaster.getEventId())}.bind(this))},_setRemainingNode:function(){this.remainingDateNode.active=!1,this.remainingTimeNode.active=!1;var t=r.getDiffMS(this._eventMainMaster.getToDate());if(this._eventMainMaster.getConditionType()===s.OPEN_CONDITION_TYPE.REGISTER_DATE){var e=a.dao.userBasicData,i=r.addMinute(e.getTutorialEndDate(),this._eventMainMaster.getConditionTo());t=r.getDiffMS(i),c.hasUnclearedBeginerQuest()&&l.addNoticeBadge(this.node,u.POSITION,u.SCALE)}else c.isNewEventQuest(this._eventMainMaster.getEventId())&&l.addNoticeBadge(this.node,u.POSITION,u.SCALE);var n=r.parseMsToDay(t),o=r.parseMsToHour(t),h=r.parseMsToMinute(t);n>=1?(this.remainingDateNode.active=!0,this.remainingDateLabel.string=n+"\u65e5"):o>=1?(this.remainingTimeNode.active=!0,h-=60*o,this.remainingTimeLabel.string=o+"\u6642\u9593"+h+"\u5206"):(this.remainingTimeNode.active=!0,this.remainingTimeLabel.string=h+"\u5206")}}),cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",LocalDataConst:"LocalDataConst",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",ViewUtils:"ViewUtils"}],QuestEventListView:[function(t,e,i){"use strict";cc._RF.push(e,"a2740mOszpJdqk9JK6NlvKR","QuestEventListView");var a=t("ListViewBase"),n=t("EventUtils"),o=t("CommonUtils"),r=t("EventQuestConst");cc.Class({extends:a,properties:{},_openEventMainMasterArray:null,initQuestEventListView:function(t){this._initOpenEventData(),this.initListView(t)},_initOpenEventData:function(){this._openEventMainMasterArray=n.getOpenEventMainMasterArray().filter(function(t){return t.getEventType()!==r.EVENT_TYPE.RAID}),this._openEventMainMasterArray=o.sortModels(this._openEventMainMasterArray,[{getterName:"getIndex",order:"asc"}])},_setListContent:function(t){for(var e=0;e<this._openEventMainMasterArray.length;e+=1)this._addThumbnail(this._openEventMainMasterArray[e])},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("QuestEventBannerThumbnail");e.initQuestEventBannerThumbnail(this._root,t,this._callbackToThumbnail.bind(this)),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){this._root.transitionEventQuestScene(t)}});cc._RF.pop()},{CommonUtils:"CommonUtils",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",ListViewBase:"ListViewBase"}],QuestEventPointModel:[function(t,e,i){"use strict";cc._RF.push(e,"deb16wluMhF07cVBlsr3q+g","QuestEventPointModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getCountFrom:function(){if(this._isKeyFieldAvailable("countFrom"))return this._data.countFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: countFrom")},getCountTo:function(){if(this._isKeyFieldAvailable("countTo"))return this._data.countTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: countTo")},getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestEventSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"47bc1RQfKZAn5jkq0QgaeS0","QuestEventSelectSubRoot");t("Singleton");var a=t("ViewUtils"),n=(t("DeckUtils"),t("CharacterUtils")),o=t("PictureBookUtils"),r=t("GameConst"),s=t("CharacterConst");t("LocalDataConst"),cc.Class({extends:cc.Component,properties:{characterStandViewParentNode:cc.Node,serifWindowPos:cc.Node,questEventListViewParentNode:cc.Node,questEventListViewPrefab:cc.Prefab},_root:null,_characterStandView:null,_serifBalloon:null,_questEventListView:null,_characterMainModelArray:null,_iCharacterLength:null,_iCurrentCharacter:null,init:function(t,e){this._root=t,this._root.redrawBackGround(r.DEFAULT_QUEST_BG),this._initCharacterStandView(),this._initSerifWindow(),this._initQuestEventListView(),this._reloadCharacterStandImage(),this._reloadSerifBalloon()},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=a.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_initSerifWindow:function(){this._serifBalloon||(this._serifBalloon=a.createSerifWindow(),this.serifWindowPos.addChild(this._serifBalloon.node))},_initQuestEventListView:function(){this._questEventListView||(this._questEventListView=cc.instantiate(this.questEventListViewPrefab).getComponent("QuestEventListView"),this._questEventListView.initQuestEventListView(this._root),this.questEventListViewParentNode.addChild(this._questEventListView.node))},_reloadCharacterStandImage:function(){this._characterStandView.setCharacterStandImage(this._root.getNavigatorCharacterId())},_reloadSerifBalloon:function(){var t=[],e=[],i=n.getCharacterMainModelByCharacterId(this._root.getNavigatorCharacterId());o.getCharacterTextMasterArray(i.getCharacterId(),s.TEXT_SCENE_TYPE.QUEST,r.QUEST_TEXT_GROUP.EVENT_SELECT).forEach(function(i){t.push(i.getText()),e.push(i.getVoiceFile())}),this._serifBalloon.setSerifContent(i.getCharacterId(),i.getShortName(),t,e),this._serifBalloon.playRandomSerifAnimation()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PictureBookUtils:"PictureBookUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],QuestFreeUnlockPopup:[function(t,e,i){"use strict";cc._RF.push(e,"866fdmN5cRFI6FDDu4kTDA8","QuestFreeUnlockPopup");var a=t("PopupBase"),n=t("CommonButton");t("QuestUtils"),cc.Class({extends:a,properties:{remainingNum:cc.Label,challengeBtn:n,cancelBtn:n},_root:null,_questType:null,_questId:null,_unlockType:null,_itemId:null,_callFunc:null,onLoad:function(){this.challengeBtn.setTapEvent(this._onTapChallengeBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openQuestFreeUnlockPopup:function(t,e,i,a,n,o,r){this._initQuestFreeUnlockPopup(t,e,i,a,n,o,r),this.open()},_initQuestFreeUnlockPopup:function(t,e,i,a,n,o,r){this._root=t,this._questType=e,this._questId=i,this._unlockType=a,this._itemId=n,this._callFunc=o,this.remainingNum.string=r},_onTapChallengeBtn:function(){this._root.requestUnlockQuest(this._questType,this._questId,this._unlockType,this._itemId,this._callFunc.bind(this)),this.close()},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",QuestUtils:"QuestUtils"}],QuestGameManager:[function(t,e,i){"use strict";cc._RF.push(e,"af69aTvIqBB3bhK3TGiharh","QuestGameManager");var a=t("BaseGameManager"),n=t("GameEffectQueue").EffectQuery,o=t("GameEffectQueue").EffectData,r=t("BattleData"),s=t("EnumTypes"),c=t("BattleFunction"),l=t("BattleResult"),u=t("Singleton"),h=t("SingletonConst"),d=(t("CharacterConst"),cc.Class({extends:a,properties:{},ctor:function(){cc.log("QuestGameManager ctor !!!!")},startGameManager:function(){cc.log("QuestGameManager startGameManager!!"),this._super();for(var t=this.getCurEnemyList(),e=0;e<t.length;e++){var i=t[e];this.equipmentController.initAllTimeBuff(i)}this.initBeginLoopByBattleLoadType(),r.GM.soundManager.continuePlayBGM(r.GM.getPlayBgm())},initBeginLoopByBattleLoadType:function(){var t=r.battleLoadType;if(t==s.BattleLoadType.QUEST_START_BATTLE){var e=this,i=function(t){cc.log("send save transac succ"),e.loop.beginLoop(e.showBattleStartEffect)}.bind(this);cc.log("Its questStartBattle!!"),this.sendBattleTransaction(i)}else t==s.BattleLoadType.FROM_BATTLE_TRANSACTION&&(cc.log("Its fromBattleTransaction data !!"),this.initForInterruptData(),this.loop.beginLoop(this.showBattleStartEffect))},initForInterruptData:function(){var t=r.savedBattleTransaction.battleUnitData;cc.log(t);var e=r.ourUnitList;for(var i in t){var a=e[i],n=t[i];a&&n?a.restoreBattleTransaction(n):cc.log("curBattleUnit or curBattleUnitData error")}r.UI_M.set_turn_label(r.cur_TurnCount),r.UI_M.set_wave_label(r.cur_waveCount,r.curBattleQuest.getMaxWaveCount())},_executeWin:function(){return r.GM.clearCurrentEnemy(),r.cur_waveCount++,r.curWaveChecked=!1,r.cur_waveCount<r.curBattleQuest.getMaxWaveCount()?r.GM.loop.nextAction(2):(r.GM.showResult(),null)},_executeLose:function(){return r.GM.showResult(),null},executeDraw:function(){return r.GM._executeLose(),null},checkAfterAction:function(){var t=r.GM,e=null;if(t.checkLastUnit())r.gameResult===s.GameResult.PLAYER_WIN?e=r.GM._executeWin():r.gameResult===s.GameResult.ENEMY_WIN?e=r.GM._executeLose():cc.error("not exist result");else if(r.GM.getWaitRageUnit())cc.log("getWaitRageUnit",r.GM.getWaitRageUnit()),e=t.loop.nextAction();else{var i=null;i=r.isNowPlayerTurn?r.ourUnitList:t.getCurEnemyList(),e=r.curUnitIdx<i.length?t.loop.nextAction():t.loop.nextAction(1)}e&&e()},showWaveStart:function(){var t=r.GM;t.soundManager.continuePlayBGM(t.getPlayBgm()),this._super()},playRageAnimation:function(t,e){var i=r.GM.cameraController,a=r.ourUnitList.filter(function(t){return 0!==t.unitController.node.opacity}),s=new n,c={};for(var l in c.targetNode=t.avatarController.mainUnitAdjustPos,s.addAction(new o(c,i.subCameraMonsterZoomIn.bind(i))),s.addAction(new o({},r.UI_M.stopAllAvatarAction.bind(r.UI_M))),a){(p={}).targetNode=a[l].unitController.node,p.fadeTime=.3,p.color=cc.color(255,255,255),p.opacity=0,s.addAction(new o(p,r.UI_M.fadeToNode.bind(r.UI_M)))}r.GM.effectQueue.addQuery(s);var u={delayTime:.5};(s=new n).addAction(new o(u,r.UI_M.delayTime.bind(r.UI_M))),r.GM.effectQueue.addQuery(s),s=new n;var h={};h.targetNode=r.GM.gameRoot.frontWhiteNode,h.blinkCount=1,h.blinkTime=.3,h.fadeTime=.3,h.color=cc.color(255,255,255),s.addAction(new o(h,r.UI_M.flashNode.bind(r.UI_M)));var d={shakeTime:.08,shakeCount:6};for(var l in d.targetNode=r.GM.gameRoot.bgBattleNode,d.shakeRangeX=50,d.shakeRangeY=50,s.addAction(new o(d,r.UI_M.shakeNode.bind(r.UI_M))),s.addAction(new o({},t.unitController.playRage.bind(t.unitController))),s.addAction(new o({},r.UI_M.resumeAllAvatarAction.bind(r.UI_M))),r.GM.effectQueue.addQuery(s),t.checkCanAction()&&e||((s=new n).addAction(new o({},i.subCameraRestore.bind(i))),r.GM.effectQueue.addQuery(s)),s=new n,a){var p;(p={}).targetNode=a[l].unitController.node,p.fadeTime=.3,p.color=cc.color(255,255,255),p.opacity=255,s.addAction(new o(p,r.UI_M.fadeToNode.bind(r.UI_M)))}r.GM.effectQueue.addQuery(s)},showResult:function(){r.UI_M.b_canInputUI=!1;var t=r.GM,e=function(t){r.battleResult=t?l.createBattleResult(t):l.create_temp_battleResult(),r.UI_M.showResultWindow()},i=function(i){t.sendBattleResult(e)};if(r.gameResult===s.GameResult.PLAYER_WIN){var a=new n("show_win");a.addAction(r.UI_M.showYouWin.bind(r.UI_M)),t.effectQueue.addQuery(a),r.GM.effectQueue.play(function(){t.saveBattleSetting(i)}),t.playWinVoice()}else t.saveBattleSetting(i),t.playLoseVoice()},sendBattleResult:function(t){var e=this._createEndBattleParams(r.gameResult);r.requestEndBattleFunc?r.requestEndBattleFunc(e,r.selectedQuestModel.getStageId(),function(e){t&&t(e),this.resetBattleSession()}.bind(this)):cc.error("\u30d0\u30c8\u30eb\u7d42\u4e86\u6642\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")},sendBattleRetire:function(t){var e=this._createEndBattleParams(r.gameResult);r.requestRetireBattleFunc&&r.requestRetireBattleFunc(e,r.selectedQuestModel.getStageId(),function(e){t&&t(e),this.resetBattleSession()}.bind(this))},_createEndBattleParams:function(t){var e=c.getEndBattleParam(t),i=r.sessionObjectData.sessionId,a=c.objectToEncryptString(e,i);return u[h.ENVIRONMENT].getDebugEnctypt()&&(a=JSON.stringify(e)),cc.log("strParam = "+a),a},onPushKeyInBattle:function(t){switch(t.keyCode){case cc.macro.KEY.t:cc.log("t pushed"),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onPushKeyInBattle,this),cc.director.loadScene("SetTestBattleScene.fire")}},getRemainTurnCount:function(){return 9999},getWaitRageUnit:function(){for(var t=c.getUnitList(!0),e=0;e<t.length;e++)if(t[e].isWaittingRage())return t[e];return null},getPlayBgm:function(){r.GM;return c.chackBossWave()?r.RM.bossWaveBgm:r.RM.normalWaveBgm}}));e.exports=d,cc._RF.pop()},{BaseGameManager:"BaseGameManager",BattleData:"BattleData",BattleFunction:"BattleFunction",BattleResult:"BattleResult",CharacterConst:"CharacterConst",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestGameRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ef5fcCRRb9D652cs2rKFqQG","QuestGameRoot");var a=t("GameRoot"),n=t("Singleton"),o=t("SingletonConst"),r=t("BattleData"),s=t("QuestUtils"),c=t("BattleConstants"),l=t("MemoryManager"),u=t("DownManifestManager");cc.Class({extends:a,start:function(){var t=r.GM;t.gameRoot=this,r.GM.cameraController=this.cameraController,r.GM.battleEventController=this.battleEventController;var e=this.battleUIManagerNode.getComponent("BattleUIManager");e.battleEffect_Prefabs=r.battleEffect_Prefabs,t.battleOBJ_Prefabs=r.battleOBJ_Prefabs,r.UI_M=e,t.startGameManager(),r.isAuto&&this.poolManager.openAutoRunWindow(r.maxAutoCount-r.autoCount+1,r.maxAutoCount),n[o.ENVIRONMENT].getDebugQueue()&&(this.buttonDebugQueue.active=!0);var i=s.getStageMasterByStageId(r.stageObjectData.stageId).getBackground(),a=c.BACKGROUND_DIRECTORY+i,h=r.RM.resourceBackground[a],d=u.instance.getFileScaleData(a);if(d/=c.BACKGROUND_EXPANSION_RATE,".spine"===a.match(c.EXTENSION_GROUPING_PATTERN)[2]){var p=(new cc.Node).addComponent(sp.Skeleton);p.skeletonData=h,p.node.scale/=d,this.bgBattleNode.addChild(p.node),p.setAnimation(0,c.BACKGROUND_SPINE_ANIM_NAME,!0),l.instance.storeRes(p.skeletonData,sp.SkeletonData)}else{var m=(new cc.Node).addComponent(cc.Sprite);m.spriteFrame=h,m.node.scale/=d,this.bgBattleNode.addChild(m.node),l.instance.storeRes(m.spriteFrame,cc.SpriteFrame)}},nextQuery:function(){r.GM.effectQueue.nextQuery()},updateChild:function(){}});e.exports=a,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",DownManifestManager:"DownManifestManager",GameRoot:"GameRoot",MemoryManager:"MemoryManager",QuestUtils:"QuestUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestItemUnlockPopup:[function(t,e,i){"use strict";cc._RF.push(e,"a29a2PxM4dFaIYnz8n8zyWg","QuestItemUnlockPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("QuestUtils"),t("ResourceUtils")),r=t("PopupUtils"),s=t("ItemUtils");t("ItemConst"),cc.Class({extends:a,properties:{itemSprite:cc.Sprite,possessionBaseNum:cc.Label,possessionAfterNum:cc.Label,challengeBtn:n,cancelBtn:n},_root:null,_questType:null,_questId:null,_unlockType:null,_itemId:null,_callFunc:null,_userItemCount:null,onLoad:function(){this.challengeBtn.setTapEvent(this._onTapChallengeBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openQuestItemUnlockPopup:function(t,e,i,a,n,o){this._initQuestItemUnlockPopup(t,e,i,a,n,o),this.open()},_initQuestItemUnlockPopup:function(t,e,i,a,n,r){this._root=t,this._questType=e,this._questId=i,this._unlockType=a,this._itemId=n,this._callFunc=r,this._userItemCount=s.getUserItemCount(this._itemId),this._userItemCount>0?(this.possessionBaseNum.string=this._userItemCount.toString(),this.possessionAfterNum.string=(this._userItemCount-1).toString()):(this.possessionBaseNum.string=0,this.possessionAfterNum.string=0),o.addSprite(this.itemSprite,o.getFileNameItemThumbnail(n))},_onTapChallengeBtn:function(){this._userItemCount<=0?r.openSimpleMessageWindow("\u66dc\u65e5\u30af\u30a8\u30b9\u30c8\u958b\u653e\u30ab\u30ae\u304c\u8db3\u308a\u307e\u305b\u3093"):(this._root.requestUnlockQuest(this._questType,this._questId,this._unlockType,this._itemId,this._callFunc.bind(this)),this.close())},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils"}],QuestListSwitchView:[function(t,e,i){"use strict";cc._RF.push(e,"d3c6d5fGuZJwbC8aXim/htW","QuestListSwitchView");var a=t("CommonButton"),n=t("CommonUtils"),o=t("QuestUtils"),r=t("GameConst"),s=t("QuestListViewBase"),c=cc.Enum({AREA_NORMAL:0,AREA_WEEK:1,STAGE_NORMAL:2,STAGE_WEEK:3,STAGE_EVENT:4});cc.Class({extends:cc.Component,properties:{listTitleLabel:cc.Label,backListTitleLabel:cc.Label,switchThumbnailImageBtn:a,backListBtn:a,questListViewArray:[s],progressCount:cc.Label},_root:null,_currentQuestListView:null,_callbackToSwitchThumbnailImage:null,onLoad:function(){this.switchThumbnailImageBtn.setTapEvent(this._onTapSwitchThumbnailImageBtn.bind(this)),this.backListBtn.setTapEvent(this._onTapBackListBtn.bind(this),a.SE_NAME.CANCEL),this.backListBtn.setOverEvent(function(){this.backListBtn.switchBtnImage(!0)}.bind(this),function(){this.backListBtn.switchBtnImage(!1)}.bind(this))},initQuestListSwitchView:function(t){this._root=t,this._switchListViewContent(t)},getCurrentTextGroup:function(){return this._currentQuestListView.getTextGroup()},isStageListView:function(){return this._currentQuestListView.isStageListView()},_switchListViewContent:function(t){this._resetListView(),this._currentQuestListView=this._getQuestListView(t.selectWorldId,t.selectAreaId,t.selectStageId,t.selectDifficult),cc.log(this._currentQuestListView),this._currentQuestListView.initListView(t),this.listTitleLabel.string=this._currentQuestListView.getListTitle(),this.backListBtn.node.active=!!this._currentQuestListView.getBackListTitle(),this.backListTitleLabel.string=this._currentQuestListView.getBackListTitle(),this._setCallbackToSwitchThumbnailImage(this._currentQuestListView.getCallbackToSwitchThumbnailImage()),this._initProgressCountTag(t.selectWorldId,t.selectAreaId)},_resetListView:function(){this._currentQuestListView&&this._currentQuestListView.resetListView()},_getQuestListView:function(t,e,i,a){switch(o.getWorldMasterMap()[t].getCategory()){case r.WORLD_CATEGORY.WEEK:return e?this.questListViewArray[c.STAGE_WEEK]:this.questListViewArray[c.AREA_WEEK];case r.WORLD_CATEGORY.EVENT:return this.questListViewArray[c.STAGE_EVENT];default:return e?this.questListViewArray[c.STAGE_NORMAL]:this.questListViewArray[c.AREA_NORMAL]}},_setCallbackToSwitchThumbnailImage:function(t){this.switchThumbnailImageBtn.node.active=!!t,this._callbackToSwitchThumbnailImage=t},_onTapSwitchThumbnailImageBtn:function(){this._callbackToSwitchThumbnailImage&&this._callbackToSwitchThumbnailImage()},_onTapBackListBtn:function(){"\u30a4\u30d9\u30f3\u30c8TOP"===this._currentQuestListView.getBackListTitle()?this._root.popEventQuestAnimation(function(){n.getRoot().popScene()}):this._root.popScene()},_initProgressCountTag:function(t,e){this.progressCount&&(this.progressCount.node.parent.active=!1,o.getWorldMasterMap()[t].getCategory()!==r.WORLD_CATEGORY.NORMAL||e||(this._setProgressCount(),this.progressCount.node.parent.active=!0))},_setProgressCount:function(){var t=this._root.selectWorldId,e=this._root.selectDifficult,i=o.getStageCountByWorldIdAndDifficult(t,e),a=o.getUserStageClearCountByWorldIdAndDifficult(t,e);this.progressCount.string="\u9032\u884c\u5ea6"+a+"/"+i}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",QuestListViewBase:"QuestListViewBase",QuestUtils:"QuestUtils"}],QuestListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"082791W+v1CP5lLQL55UiYL","QuestListViewBase");var a=t("ListViewBase");cc.Class({extends:a,getListTitle:function(){return cc.error("getListTitle() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),""},getBackListTitle:function(){return cc.error("getBackListTitle() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),""},getTextGroup:function(){return cc.error("getTextGroup() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),-1},getCallbackToSwitchThumbnailImage:function(){cc.error("getCallbackToSwitchThumbnailImage() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")},isStageListView:function(){cc.error("isStageListView() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9")}});cc._RF.pop()},{ListViewBase:"ListViewBase"}],QuestModel:[function(t,e,i){"use strict";cc._RF.push(e,"4802cbnktJPtbZXkCcHnpoN","QuestModel");var a=t("UserQuestModel"),n=(t("CommonUtils"),t("Singleton")),o=t("StoryUtils"),r=t("TimeUtils"),s=t("CampaignUtils");cc.Class({userData:void 0,_questWorldMaster:void 0,_questAreaMaster:void 0,_questStageMaster:void 0,_questAchieveMaster1:void 0,_questAchieveMaster2:void 0,_questAchieveMaster3:void 0,_questDropMasterArray:void 0,_questEventPointMaster:void 0,_questStartStoryMaster:void 0,_questEndStoryMaster:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._questAchieveMaster1=null,this._questAchieveMaster2=null,this._questAchieveMaster3=null,this._questAreaMaster=null,this._questDropMasterArray=null,this._questEventPointMaster=null,this._questStageMaster=null,this._questWorldMaster=null,this._questStartStoryMaster=null,this._questEndStoryMaster=null},getQuestStageMaster:function(){return this._questStageMaster||(this._questStageMaster=n.dao.QuestStageMasters.find(function(t){return t.getStageId()===this.userData.getStageId()}.bind(this))),this._questStageMaster},getQuestWorldMaster:function(){return this._questWorldMaster||(this._questWorldMaster=n.dao.QuestWorldMasters.find(function(t){return t.getWorldId()===this.getQuestStageMaster().getWorldId()}.bind(this))),this._questWorldMaster},getQuestAreaMaster:function(){return this._questAreaMaster||(this._questAreaMaster=n.dao.QuestAreaMasters.find(function(t){return t.getAreaId()===this.getQuestStageMaster().getAreaId()}.bind(this))),this._questAreaMaster},getQuestAchieveMaster1:function(){return this._questAchieveMaster1||(this._questAchieveMaster1=n.dao.QuestAchieveMasters.find(function(t){return t.getAchieveId()===this.getQuestStageMaster().getAchieveId1()}.bind(this))),this._questAchieveMaster1},getQuestAchieveMaster2:function(){return this._questAchieveMaster2||(this._questAchieveMaster2=n.dao.QuestAchieveMasters.find(function(t){return t.getAchieveId()===this.getQuestStageMaster().getAchieveId2()}.bind(this))),this._questAchieveMaster2},getQuestAchieveMaster3:function(){return this._questAchieveMaster3||(this._questAchieveMaster3=n.dao.QuestAchieveMasters.find(function(t){return t.getAchieveId()===this.getQuestStageMaster().getAchieveId3()}.bind(this))),this._questAchieveMaster3},getQuestDropMasterArray:function(){return this._questDropMasterArray||(this._questDropMasterArray=n.dao.QuestDropMasters.filter(function(t){return t.getStageId()===this.getQuestStageMaster().getStageId()}.bind(this))),this._questDropMasterArray},getQuestStartStoryMaster:function(){return null===this._questStartStoryMaster&&(this._questStartStoryMaster=n.dao.StoryQuestMasters.concat(n.dao.StoryEventMasters,n.dao.StoryOtherMasters).find(function(t){return t.getStageId()===this.getStageId()&&1===t.getPlayType()}.bind(this))),this._questStartStoryMaster},getQuestEndStoryMaster:function(){return null===this._questEndStoryMaster&&(this._questEndStoryMaster=n.dao.StoryQuestMasters.concat(n.dao.StoryEventMasters,n.dao.StoryOtherMasters).find(function(t){return t.getStageId()===this.getStageId()&&2===t.getPlayType()}.bind(this))),this._questEndStoryMaster},getQuestStartUserStoryModel:function(){return this.getQuestStartStoryMaster()?o.getUserStoryModelByStoryId(this.getQuestStartStoryMaster().getStoryId()):void 0},getQuestEndUserStoryModel:function(){return this.getQuestEndStoryMaster()?o.getUserStoryModelByStoryId(this.getQuestEndStoryMaster().getStoryId()):void 0},getWorldCategory:function(){return this.getQuestWorldMaster().getCategory()},getWorldId:function(){return this.getQuestWorldMaster().getWorldId()},getWorldName:function(){return this.getQuestWorldMaster().getName()},getAreaId:function(){return this.getQuestAreaMaster().getAreaId()},getAreaName:function(){return this.getQuestAreaMaster().getName()},getAreaDifficult:function(){return this.getQuestAreaMaster().getDifficult()},getAreaText:function(){return this.getQuestAreaMaster().getText()},getStageId:function(){return this.getQuestStageMaster().getStageId()},getStageName:function(){return this.getQuestStageMaster().getName()},getRecommendPower:function(){return this.getQuestStageMaster().getRecommendPower()},getIsClearMission1:function(){return this.userData.getIsClearMission1()},getIsClearMission2:function(){return this.userData.getIsClearMission2()},getIsClearMission3:function(){return this.userData.getIsClearMission3()},getIsCompletedMissions:function(){return 1===this.getIsClearMission1()&&1===this.getIsClearMission2()&&1===this.getIsClearMission3()},getPlayCount:function(){return this.userData.getPlayCount()},getClearCount:function(){return this.userData.getClearCount()},getCategory:function(){return this.getQuestWorldMaster().getCategory()},getStamina:function(){return this.getQuestStageMaster().getStamina()},getTodaySkipCount:function(){return 0!==this.getMaxDayPlayCount()?this.getTodayPlayCount():r.getNowDate()===(this.userData.getLastSkipDate()?this.userData.getLastSkipDate().substr(0,8):"")?this.userData.getTodaySkipCount():0},getMaxSkipCount:function(){return s.getMaxDayPlayCount(this.getQuestStageMaster(),!0)},getTodayPlayCount:function(){return r.getNowDate()===(this.userData.getLastPlayDate()?this.userData.getLastPlayDate().substr(0,8):"")?this.userData.getTodayPlayCount():0},getMaxDayPlayCount:function(){return s.getMaxDayPlayCount(this.getQuestStageMaster(),!1)},getMaxClearCount:function(){return this.getQuestStageMaster().getMaxClearCount()},getIsDayChallengeCountRemain:function(){return this.getMaxDayPlayCount()<=0||this.getTodayPlayCount()<this.getMaxDayPlayCount()},getReleaseStageId:function(){return this.getQuestStageMaster().getReleaseStageId()}});cc._RF.pop()},{CampaignUtils:"CampaignUtils",CommonUtils:"CommonUtils",Singleton:"Singleton",StoryUtils:"StoryUtils",TimeUtils:"TimeUtils",UserQuestModel:"UserQuestModel"}],QuestNormalExTabView:[function(t,e,i){"use strict";cc._RF.push(e,"50184CHQyBD+Yhf6IVfwKIn","QuestNormalExTabView");var a=t("TabViewBase"),n=t("Singleton"),o=(t("QuestUtils"),t("CommonUtils")),r=t("ViewUtils"),s=t("UnlockEffectUtils"),c=t("QuestListSwitchView"),l=t("GameConst"),u=t("LocalDataConst"),h=t("UnlockEffectConst"),d=cc.Enum({NORMAL:0,EX:1});cc.Class({extends:a,properties:{questListSwitchView:c,tabBtnGrayOutNodeArray:[cc.Node],exLockIconNode:cc.Node},_root:null,_isExistExStage:!1,_isOpenExStage:!1,initQuestNormalExTabView:function(t,e,i){this._root=t,this._isExistExStage=e,this._isOpenExStage=i;var a=this._root.selectDifficult===l.QUEST_DIFFICULT.NORMAL.NORMAL?d.NORMAL:d.EX;this.initTabViewBase(),this._setCurrentTab(a),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this.questListSwitchView.isStageListView()&&(this._root.selectAreaId=null,this._root.popScene(!0)),this._activateTab(e)},_resetTab:function(t){this.tabBtnGrayOutNodeArray[d.NORMAL].active=!1,this.tabBtnGrayOutNodeArray[d.EX].active=!1,this._isExistExStage?this._switchTabImageForLockEffect(t):(this.tabBtnArray[d.NORMAL].node.active=!1,this.tabBtnArray[d.EX].node.active=!1)},_switchTabImageForLockEffect:function(t){o.loadLocalStorage(h.TRIGGER_PREFIX_NAME.EXTRA_QUEST+n.localData[u.SELECT_WORLD_ID],!1,u.LOCAL_STORAGE_GET_TYPE.BOOLEAN)?(o.removeLocalStorage(h.TRIGGER_PREFIX_NAME.EXTRA_QUEST+n.localData[u.SELECT_WORLD_ID]),r.addModalLayer(),this.tabBtnGrayOutNodeArray[d.EX].active=!0,s.playUnLockEffectAnimationNormal(this.exLockIconNode,function(){this.tabBtnGrayOutNodeArray[d.EX].active=!1,this.tabBtnArray[d.NORMAL].switchBtnImage(t===d.NORMAL),this.tabBtnArray[d.EX].switchBtnImage(t===d.EX),r.removeModalLayer(),this._root.openQuestDifficultyUnlockPopup()}.bind(this))):this._isOpenExStage?(this.tabBtnArray[d.NORMAL].switchBtnImage(t===d.NORMAL),this.tabBtnArray[d.EX].switchBtnImage(t===d.EX)):(this.tabBtnArray[d.NORMAL].switchBtnImage(!0),this.tabBtnArray[d.EX].node.active=!1,this.tabBtnGrayOutNodeArray[d.EX].active=!0)},_activateTab:function(t){this._resetTab(t),this._switchTabContent(t)},_switchTabContent:function(t){switch(t){case d.NORMAL:this._root.selectDifficult=l.QUEST_DIFFICULT.NORMAL.NORMAL;break;case d.EX:this._root.selectDifficult=l.QUEST_DIFFICULT.NORMAL.EX}this.questListSwitchView.initQuestListSwitchView(this._root)},getCurrentListTextGroup:function(){return this.questListSwitchView.getCurrentTextGroup()}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",QuestListSwitchView:"QuestListSwitchView",QuestUtils:"QuestUtils",Singleton:"Singleton",TabViewBase:"TabViewBase",UnlockEffectConst:"UnlockEffectConst",UnlockEffectUtils:"UnlockEffectUtils",ViewUtils:"ViewUtils"}],QuestResultExpGaugeView:[function(t,e,i){"use strict";cc._RF.push(e,"8d2ceycMRBAxam+TL85T0eY","QuestResultExpGaugeView");var a=t("ResultPlayerRankView");cc.Class({extends:a,properties:{addGoldCoinNumLabel:cc.Label},initQuestResultExpGaugeView:function(t,e,i,a){this._setGoldCoin(a),this.initResultPlayerRankView(t,e,i)},_setGoldCoin:function(t){this.addGoldCoinNumLabel.string=t.toString()}});cc._RF.pop()},{ResultPlayerRankView:"ResultPlayerRankView"}],QuestRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"02737R3+UZDP7Dfy/AQGPSi","QuestRootBase");var a=t("DeckRootBase"),n=t("Singleton"),o=t("CommonUtils"),r=t("ResourceUtils"),s=t("QuestUtils"),c=t("PopupUtils"),l=t("ExtensionAdvUtils"),u=t("ExtensionAdvUtils"),h=t("UnlockEffectUtils"),d=t("CharacterUtils"),p=t("QuestConditionUtils"),m=t("EquipmentUtils"),g=t("GameConst"),C=t("DeckConst"),f=t("SceneConst"),E=t("QuestConst"),T=t("ResourceConst"),S=t("LocalDataConst"),R=t("ItemConst"),A=(t("BattleStartConfirmSubRoot"),t("BattleFunction")),b=cc.Class({extends:a,properties:{battleStartConfirmSubRootPrefab:cc.Prefab,skipDetailPopupPrefab:cc.Prefab,questSkipResultPopupPrefab:cc.Prefab,autoDetailPopupPrefab:cc.Prefab,questSkipResultRankUpPopupPrefab:cc.Prefab},battleStartConfirmSubRoot:null,openStageQuestModel:null,selectWorldId:0,selectAreaId:0,selectStageId:0,selectDifficult:0,_skipDetailPopup:null,_questSkipResultPopup:null,_autoDetailPopup:null,_questSkipResultRankUpPopup:null,_getSceneBgmName:function(){return g.BGM.QUEST},redraw:function(){this.battleStartConfirmSubRoot&&this.battleStartConfirmSubRoot.redraw()},setListViewParam:function(t,e,i,a){this.selectWorldId=t?parseInt(t):t,this.selectAreaId=e?parseInt(e):e,this.selectStageId=i?parseInt(i):i,this.selectDifficult=a?parseInt(a):a},getListViewParam:function(){return{worldId:this.selectWorldId,areaId:this.selectAreaId,stageId:this.selectStageId,difficult:this.selectDifficult}},transitionDeckSceneDeckUnitDetailSubRoot:function(t,e,i){var a={DeckUnitDetailSubRoot:{mainCharacterCd:e?e.getCharacterCd():0,supportCharacterCd:i?i.getCharacterCd():0}},n={BattleStartConfirmSubRoot:{stageId:t}};this.pushScene("DeckScene",this.getCurrentSceneName(),a,n)},transitionDeckSceneDeckSelectSubRoot:function(t){var e={DeckSelectSubRoot:{deckId:n.localData[S.SELECT_QUEST_DECK_ORDER]}},i={BattleStartConfirmSubRoot:{stageId:t}};this.pushScene("DeckScene",this.getCurrentSceneName(),e,i)},openSkipDetailPopup:function(t){this.closeSkipDetailPopup(),this._skipDetailPopup=cc.instantiate(this.skipDetailPopupPrefab).getComponent("SkipDetailPopup"),this._skipDetailPopup.openSkipDetailPopup(this,t)},closeSkipDetailPopup:function(){this._skipDetailPopup&&(this._skipDetailPopup.close(),this._skipDetailPopup=null)},openQuestSkipResultPopup:function(t,e,i){for(var a=null,o=0;o<n.dao.userQuests.length;o++)if(n.dao.userQuests[o].userData._data.stageId===t){a=n.dao.userQuests[o];break}this.closeQuestSkipResultPopup(),this._questSkipResultPopup=cc.instantiate(this.questSkipResultPopupPrefab).getComponent("QuestSkipResultPopup"),this._questSkipResultPopup.openQuestSkipResultPopup(this,i,a,e,function(){this.redrawUIHeader(),this.redraw()}.bind(this))},closeQuestSkipResultPopup:function(){this._questSkipResultPopup&&(this._questSkipResultPopup.close(),this._questSkipResultPopup=null)},openAutoDetailPopup:function(t){this.closeAutoDetailPopup(),this._autoDetailPopup=cc.instantiate(this.autoDetailPopupPrefab).getComponent("AutoDetailPopup"),this._autoDetailPopup.openAutoDetailPopup(this,t)},closeAutoDetailPopup:function(){this._autoDetailPopup&&(this._autoDetailPopup.close(),this._autoDetailPopup=null)},openQuestSkipResultRankUpPopup:function(t){this.closeQuestSkipResultRankUpPopup(),this._questSkipResultRankUpPopup=cc.instantiate(this.questSkipResultRankUpPopupPrefab).getComponent("QuestSkipResultRankUpPopup"),this._questSkipResultRankUpPopup.openQuestSkipResultRankUpPopup(this,t)},closeQuestSkipResultRankUpPopup:function(){this._questSkipResultRankUpPopup&&(this._questSkipResultRankUpPopup.close(),this._questSkipResultRankUpPopup=null)},openQuestDifficultyUnlockPopup:function(){this.closeQuestDifficultyUnlockPopup()},closeQuestDifficultyUnlockPopup:function(){},transitionEventForEndBattle:function(t){var e=s.createUserStageFlatMap()[t].getQuestEndUserStoryModel();if(!e||e.getIsRead())o.getRoot().popScene();else{var i=e.getStoryGroupId(),a=e.getStoryId(),c=e.getResourceId();n.StoryService.readStory(a,function(){u.startAdv(a,0,[l.createAdvTextInfo(a,r.getFileNameStoryQuestScript(i,c),r.getFileNameStoryQuestSynopsis(i,c))],null,null,function(){o.getRoot().popScene()})})}},startBattleByCondition:function(t,e){switch(p.getStageConditionState(this.selectStageId,t,this._eventId)){case E.STAGE_CONDITION_STATE.ENABLED:var i=s.getCampaignAPValueByStageId(this.openStageQuestModel.getStageId()),a=this.openStageQuestModel.getStamina();if(i&&(a=Math.ceil(a*i/1e3)),a>n.dao[n.USER].getCurrentStaminaInfo().currentStamina)return void c.openSimpleMessageWindow("\u30b9\u30bf\u30df\u30ca\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002");if(!this._checkStartBattleByUserItemsCondition())return;e?e():cc.error("\u30d0\u30c8\u30eb\u958b\u59cb\u95a2\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");break;case E.STAGE_CONDITION_STATE.OUT_RANGE_PERIOD:c.openCommonPopupOk("\u958b\u50ac\u671f\u9593\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002","\u5bfe\u8c61\u306e\u30b9\u30c6\u30fc\u30b8\u306f\u73fe\u5728\u958b\u50ac\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",void 0,!1,function(){this.clearScene(),this.pushScene(f.SCENE.FILE_NAME.QUEST,f.SCENE.FILE_NAME.HOME)}.bind(this),void 0);break;case E.STAGE_CONDITION_STATE.TOTAL_OVER_LIMIT:c.openSimpleMessageWindow("\u4e0a\u9650\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f\u3002");break;case E.STAGE_CONDITION_STATE.TODAY_OVER_LIMIT:case E.STAGE_CONDITION_STATE.TODAY_SKIP_OVER_LIMIT:c.openSimpleMessageWindow("\u672c\u65e5\u306e\u4e0a\u9650\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f\u3002");break;default:c.openSimpleMessageWindow("\u30b9\u30c6\u30fc\u30b8\u304c\u958b\u653e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")}},_checkStartBattleByUserItemsCondition:function(){return d.getPlayableUserCharacterModelArray().length>n.dao[n.USER].userData.getCharacterMaxCount()?(c.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):d.getNonPlayableUserCharacterModelArray().length>g.MAX_MATERIAL_COUNT?(c.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):m.getEquipmentModelArrayByEquipmentType(R.EQUIPMENT_TYPE.ATK).length>n.dao[n.USER].userData.getEquipmentMaxCount()?(c.openSimpleMessageWindow("\u88c5\u5099\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):m.getEquipmentModelArrayByEquipmentTypes([R.EQUIPMENT_TYPE.FORTIFY_MATERIAL,R.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL]).length>g.MAX_MATERIAL_COUNT?(c.openSimpleMessageWindow("\u88c5\u5099\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):!(n.dao.userItems.length>n.dao[n.USER].userData.getItemMaxCount())||(c.openSimpleMessageWindow("\u30a2\u30a4\u30c6\u30e0\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1)},requestReedStory:function(t,e){n.StoryService.readStory(t,function(t){e&&e()})},requestUnlockQuest:function(t,e,i,a,o){n.QuestService.unlockQuest(t,e,i,a,function(t){o&&o(t)})},requestStartBattle:function(t,e,i,a,o){var s=n.localData[S.SELECT_QUEST_DECK_ORDER];n.QuestService.startBattle(t,s,i,function(t){cc.log("startBattle : \u901a\u4fe1\u5b8c\u4e86");var i=e.getQuestStartUserStoryModel();if(!i||i.getIsRead())this.transitionBattleScene(e,t,a,o);else{var n=i.getStoryGroupId(),s=i.getStoryId(),c=i.getResourceId();this.requestReedStory(s,function(){u.startAdv(s,0,[l.createAdvTextInfo(s,r.getFileNameStoryQuestScript(n,c),r.getFileNameStoryQuestSynopsis(n,c))],null,null,function(){this.transitionBattleScene(e,t,a,o)}.bind(this))}.bind(this))}}.bind(this))},requestSaveBattleTransaction:function(t,e){n.QuestService.saveBattleTransaction(t,function(t){e&&e(t)})},requestEndBattle:function(t,e,i){var a=n.dao.userQuests,o=_.find(n.dao.userQuests,function(t){return t.getStageId()===e});n.QuestService.endBattle(t,function(t){b.prototype.saveNextNormalStage(e),h.saveUnLockEffectForExtraQuest(o,a),h.saveUnLockEffectForNormalWorld(o,a),i&&i(t)})},saveNextNormalStage:function(t){var e=_.find(n.dao.userQuests,function(e){return e.getStageId()===t});if(1===e.getClearCount()){var i=_.find(n.dao.userQuests,function(t){return t.getReleaseStageId()===e.getStageId()&&t.getWorldCategory()===g.WORLD_CATEGORY.NORMAL});i&&(n.localData[S.NEW_RELEASE_NORMAL_STAGE_ID]=i.getStageId())}},skipBattle:function(t,e,i){n.QuestService.skipBattle(t,e,i)},setSelectedQuestId:function(t,e,i,a){switch(t){case g.WORLD_CATEGORY.NORMAL:n.localData[S.SELECT_WORLD_ID]=e,n.localData[S.SELECT_AREA_ID]=i,n.localData[S.SELECT_STAGE_ID]=a}},setSelectedWorldId:function(t){n.localData[S.SELECT_WORLD_ID]=t},redrawBackGround:function(t){if(t===g.DEFAULT_QUEST_BG){var e=this.backgroundParent.getChildByName(this.bgPrefab.name);r.addSprite(e.getComponent(cc.Sprite),T.QUEST_DEFAULT_QUEST_BG)}else{e=this.backgroundParent.getChildByName(this.bgPrefab.name);r.addSprite(e.getComponent(cc.Sprite),r.getFileNameWorldBG(t))}},transitionBattleScene:function(t,e,i,a){A.setQuestStartBattleData(t,e.stage,A.createSessionObjectData(e.session.sessionId,e.session.stageId,e.session.deckId,C.DECK_TYPE.QUEST),A.createBattleCallbacks(this.requestSaveBattleTransaction,this.requestEndBattle,this.requestEndBattle,this.transitionEventForEndBattle.bind(this))),n.soundManager.bgmStop(),i&&"function"==typeof i&&i();this.pushScene("battleLoading",void 0,{},void 0),a&&"function"==typeof a&&a()}});cc._RF.pop()},{BattleFunction:"BattleFunction",BattleStartConfirmSubRoot:"BattleStartConfirmSubRoot",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckRootBase:"DeckRootBase",EquipmentUtils:"EquipmentUtils",ExtensionAdvUtils:"ExtensionAdvUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestConditionUtils:"QuestConditionUtils",QuestConst:"QuestConst",QuestUtils:"QuestUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",UnlockEffectUtils:"UnlockEffectUtils"}],QuestRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"b95b4Su+dRIF5wTsE1+1qwg","QuestRootUtils");var a=t("Singleton"),n=t("TimeUtils"),o=t("QuestTopSubRoot"),r=t("BattleStartConfirmSubRoot"),s=t("QuestEventSelectSubRoot"),c=t("GameConst"),l=t("EventQuestConst");function u(t,e,i){switch(t.getEventType()){case l.EVENT_TYPE.POINT:case l.EVENT_TYPE.ITEM:return{sceneName:"EventQuestScene",viewParam:{BattleStartConfirmSubRoot:{eventId:t.getEventId(),areaId:e.getAreaId(),stageId:i,hideSkip:!0}}};case l.EVENT_TYPE.ADVENT_WAR:return{sceneName:"EventRegularQuestScene",viewParam:{BattleStartConfirmSubRoot:{eventId:t.getEventId(),areaId:e.getAreaId(),stageId:i,hideSkip:!0}}};case l.EVENT_TYPE.EQUIPMENT_FORTIFY:return{sceneName:"EventRegularQuestScene",viewParam:{EventRegularQuestEquipmentBattleStartConfirmSubRoot:{eventId:t.getEventId(),areaId:e.getAreaId(),stageId:i,hideSkip:!0}}};default:cc.error("\u5b58\u5728\u3057\u306a\u3044\u30a4\u30d9\u30f3\u30c8\u30bf\u30a4\u30d7\u3067\u3059")}}e.exports={openWorldView:function(t,e){void 0===t.questTopSubRoot||null===t.questTopSubRoot?(t.questTopSubRoot=cc.instantiate(t.questTopSubRootPrefab).getComponent(o),t.questTopSubRoot.initQuestTopSubRoot(t,e.worldId),t.subRootParent.addChild(t.questTopSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002")},closeWorldView:function(t,e){t.questTopSubRoot&&(t.questTopSubRoot.node.destroy(),t.questTopSubRoot=null)},openBattleStartConfirmSubRoot:function(t,e){t.setListViewParam(t.selectWorldId,t.selectAreaId,e.stageId,t.selectDifficult);for(var i=parseInt(e.stageId,10),n=0;n<a.dao.userQuests.length;n++)if(a.dao.userQuests[n].userData._data.stageId===i){t.openStageQuestModel=a.dao.userQuests[n];break}void 0===t.battleStartConfirmSubRoot||null===t.battleStartConfirmSubRoot?(t.battleStartConfirmSubRoot=cc.instantiate(t.battleStartConfirmSubRootPrefab).getComponent(r),t.battleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,t.openStageQuestModel,e.hideSkip),t.subRootParent.addChild(t.battleStartConfirmSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002")},closeBattleStartConfirmSubRoot:function(t,e){t.battleStartConfirmSubRoot&&(t.battleStartConfirmSubRoot.node.destroy(),t.battleStartConfirmSubRoot=null)},openQuestEventSelectSubRoot:function(t,e){var i=cc.instantiate(t.questEventSelectSubRootPrefab).getComponent(s);i.init(t,e),t.questEventSelectSubRoot=i,t.subRootParent.addChild(i.node)},closeQuestEventSelectSubRoot:function(t,e){t.questEventSelectSubRoot&&(t.questEventSelectSubRoot.node.destroy(),t.questEventSelectSubRoot=null)},createBattleStartTransitionParams:function(t){var e=_.find(a.dao.QuestStageMasters,function(e){return e.getStageId()===t});if(e){var i=_.find(a.dao.QuestAreaMasters,function(t){return t.getAreaId()===e.getAreaId()&&n.isRangeOfDate(t.getFromDate(),t.getToDate())});if(i){var o=_.find(a.dao.QuestWorldMasters,function(t){return t.getWorldId()===e.getWorldId()&&n.isRangeOfDate(t.getFromDate(),t.getToDate())});if(o){switch(o.getCategory()){case c.WORLD_CATEGORY.TOWER:return{sceneName:"TowerScene",viewParam:void 0};case c.WORLD_CATEGORY.RAID:return{sceneName:"RaidScene",viewParam:void 0};case c.WORLD_CATEGORY.EVENT:break;default:return{sceneName:"QuestScene",viewParam:{BattleStartConfirmSubRoot:{stageId:t}}}}var r=_.find(a.dao.EventMainMasters,function(t){return t.getWorldId()===e.getWorldId()&&n.isRangeOfDate(t.getFromDate(),t.getToDate())});if(r)return u(r,i,t)}}}}},cc._RF.pop()},{BattleStartConfirmSubRoot:"BattleStartConfirmSubRoot",EventQuestConst:"EventQuestConst",GameConst:"GameConst",QuestEventSelectSubRoot:"QuestEventSelectSubRoot",QuestTopSubRoot:"QuestTopSubRoot",Singleton:"Singleton",TimeUtils:"TimeUtils"}],QuestRoot:[function(t,e,i){"use strict";cc._RF.push(e,"57baadhdYpFTaWUbtAbQwST","QuestRoot");var a=t("QuestRootBase"),n=t("Singleton"),o=t("LocalDataConst"),r=t("QuestUtils"),s=t("EventUtils"),c=t("SceneConst"),l=t("GameConst"),u=t("PopupUtils"),h=(t("DeckUtils"),t("EventQuestConst")),d=(t("QuestTopSubRoot"),t("QuestViewSetting"));cc.Class({extends:a,properties:{questTopSubRootPrefab:cc.Prefab,questEventSelectSubRootPrefab:cc.Prefab},questTopSubRoot:null,eventMainMasters:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,d.QUEST_SETTING)},initData:function(){},initialize:function(){if(!n.localData[o.SELECT_WORLD_ID]){var t=r.getUserWorldArrayByWorldCategory(l.WORLD_CATEGORY.NORMAL);n.localData[o.SELECT_WORLD_ID]=t[t.length-1].getWorldId()}this.eventMainMasters=s.getOpenEventMainMasterArray().filter(function(t){return t.getEventType()!==h.EVENT_TYPE.RAID});var e={QuestTopSubRoot:{worldId:n.localData[o.SELECT_WORLD_ID]}};this._initOpenFirstView(e)},pushStageScrollView:function(t){var e={QuestTopSubRoot:{worldId:r.getAreaMasterByAreaId(t).getWorldId(),areaId:t}},i={QuestTopSubRoot:{worldId:r.getAreaMasterByAreaId(t).getWorldId()}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),e,i)},pushQuestEventSelectScene:function(){this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),{QuestEventSelectSubRoot:{}},{QuestTopSubRoot:{}})},pushBattleStartConfirmSubRoot:function(t,e){var i={BattleStartConfirmSubRoot:{stageId:t}},a={QuestTopSubRoot:{worldId:r.getAreaMasterByAreaId(e).getWorldId(),areaId:e}};t&&e?(cc.log(this.getCurrentSceneName()),this.pushScene("QuestScene",this.getCurrentSceneName(),i,a)):cc.error("stageId\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},transitionNormalScene:function(t){var e={WorldSelectSubRoot:{worldId:t}};this.pushScene(c.SCENE.FILE_NAME.NORMAL_QUEST,this.getCurrentSceneName(),e,{QuestTopSubRoot:{}})},transitionWeekScene:function(){this.pushScene(c.SCENE.FILE_NAME.WEEK,this.getCurrentSceneName(),{WeekTopSubRoot:{}},{QuestTopSubRoot:{}})},transitionTowerScene:function(){this.pushScene(c.SCENE.FILE_NAME.TOWER,this.getCurrentSceneName(),null,{QuestTopSubRoot:{}})},transitionPvPScene:function(){this.pushScene(c.SCENE.FILE_NAME.PVP,this.getCurrentSceneName(),{PvPTopSubRoot:{}},{QuestTopSubRoot:{}})},transitionRaidScene:function(){this.pushScene(c.SCENE.FILE_NAME.RAID,this.getCurrentSceneName(),{RaidTopSubRoot:{}},{QuestTopSubRoot:{}})},transitionEventQuestScene:function(t){if(!s.isEventOpenByEventId(t))return u.openSimpleMessageWindow("\u30a4\u30d9\u30f3\u30c8\u306f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002");var e=s.getTransitionEventSceneData(t);this.pushScene(e.sceneName,this.getCurrentSceneName(),e.sceneParam,{QuestEventSelectSubRoot:{}})},questRootPopClose:function(){this.popScene()}});cc._RF.pop()},{DeckUtils:"DeckUtils",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestRootBase:"QuestRootBase",QuestTopSubRoot:"QuestTopSubRoot",QuestUtils:"QuestUtils",QuestViewSetting:"QuestViewSetting",SceneConst:"SceneConst",Singleton:"Singleton"}],QuestService:[function(t,e,i){"use strict";cc._RF.push(e,"8d7c9fo8tJD7aAphNEiQ5EH","QuestService");var a=t("BaseService"),n=t("ApiConstants");t("PopupUtils"),t("QuestConst"),cc.Class({extends:a,startBattle:function(t,e,i,a){var o={stageId:t,deckId:e,isAutoBattle:i};this._requestCallApi(n.QUEST_START_BATTLE,o,function(t,e){return a(t?void 0:e)})},endBattle:function(t,e){var i={parameter:t};this._requestCallApi(n.QUEST_END_BATTLE,i,function(t,i){return e(t?void 0:i)})},startBattleTransaction:function(t){this._requestCallApi(n.QUEST_START_BATTLE_TRANSACTION,{},function(e,i){if(e)return t(void 0);t(i)})},saveBattleTransaction:function(t,e){var i={saveData:t};this._requestCallApi(n.QUEST_SAVE_BATTLE_TRANSACTION,i,function(t,i){if(t)return e(void 0);e(i)})},clearBattleTransaction:function(t){this._requestCallApi(n.QUEST_CLEAR_BATTLE_TRANSACTION,void 0,function(e,i){if(e)return t(void 0);t(i)})},skipBattle:function(t,e,i){var a={stageId:t,skipCount:e};this._requestCallApi(n.QUEST_SKIP_BATTLE,a,function(t,e){if(t)return i(void 0);i(e)})},unlockQuest:function(t,e,i,a,o){var r={questType:t,questId:e,unlockType:i,itemId:a};this._requestCallApi(n.QUEST_UNLOCK,r,function(t,e){if(t)return o(void 0);o(e)})},getStageData:function(t,e){var i={stageId:t};this._requestCallApi(n.QUEST_STAGE_DATA,i,function(t,i){if(t)return e(void 0);e(i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService",PopupUtils:"PopupUtils",QuestConst:"QuestConst"}],QuestSkipCharacterAnimationView:[function(t,e,i){"use strict";cc._RF.push(e,"2e9290N2uhPUoxUYdduAiqa","QuestSkipCharacterAnimationView");var a=t("Singleton"),n=t("AnimationEventComponent"),o=t("CommonUtils"),r=t("ResourceUtils"),s=t("CharacterConst");cc.Class({extends:cc.Component,properties:{animationWidthTargetNode:cc.Node,normalSkipAnimation:cc.Animation,movePositionCount:5,normalSkipAnimationTopNodeArray:[cc.Node],normalSkipAnimationUnisonThumbnailSpriteArray:[cc.Sprite],finishSkipAnimation:cc.Animation,finishSkipAnimationCharacterSpine:sp.Skeleton},playNormalSkipAnimation:function(t,e){_.forEach(this.normalSkipAnimationTopNodeArray,function(t){t.opacity=0});var i=o.getRandom(0,this.normalSkipAnimation.getClips().length-1),a=this.normalSkipAnimationTopNodeArray[i].getPosition();this.normalSkipAnimation.once("finished",function(t,i){if(this.normalSkipAnimationTopNodeArray[t].position=cc.v2(i.x,i.y),this.normalSkipAnimationUnisonThumbnailSpriteArray[t].spriteFrame=new cc.SpriteFrame,e)return e()}.bind(this,i,a),this);var n=this._calcNormalAnimationRandomPosX();this.normalSkipAnimationTopNodeArray[i].position=cc.v2(n,a.y),r.addSprite(this.normalSkipAnimationUnisonThumbnailSpriteArray[i],r.getFileNameCharacterUnison(t.getCharacterId())),this.normalSkipAnimation.play(this.normalSkipAnimation.getClips()[i].name)},playFinishSkipAnimation:function(t,e){_.forEach(this.normalSkipAnimationTopNodeArray,function(t){t.opacity=0}),this.finishSkipAnimation.node.addComponent(n).setAnimationEvent("QuestSkip_Finish_Anim",[e],[null]);var i=t.getSpineDirectoryPath(),o=r.getFileNameCharacterRoomSpine(i);this.finishSkipAnimationCharacterSpine.skeletonData=a.res[o],this._playSpineAction(s.ROOM_SPINE_SKIN_TYPE.SMILE,s.ROOM_SPINE_ANIM_TYPE.IDLE),this.finishSkipAnimation.play(this.finishSkipAnimation.getClips()[0].name)},_calcNormalAnimationRandomPosX:function(){this.movePositionCount<=0&&(this.movePositionCount=5);var t=this.animationWidthTargetNode.width;return t/2-t/(this.movePositionCount+1)*o.getRandom(1,this.movePositionCount)},getAnimDuration:function(){var t=0;return _.forEach(this.normalSkipAnimation.getClips(),function(e){t<e.duration&&(t=e.duration)}),t},_playSpineAction:function(t,e){var i=Object.keys(s.ROOM_SPINE_SKIN_TYPE).find(function(e){return s.ROOM_SPINE_SKIN_TYPE[e]===t});if(i?this._setSkin(s.ROOM_SPINE_SKIN_TYPE[i]):this._setRandomSkin(),e){if(this.finishSkipAnimationCharacterSpine.animation===e)return void this.finishSkipAnimationCharacterSpine.setSlotsToSetupPose();this._setAnimation(e)}else this._setRandomAnimation();this.finishSkipAnimationCharacterSpine.setSlotsToSetupPose()},_playRandomSpineAction:function(){this._setRandomSkin(),this._setRandomAnimation(),this.finishSkipAnimationCharacterSpine.setSlotsToSetupPose()},_setRandomSkin:function(){var t=o.getRandom(1,Object.keys(this.finishSkipAnimationCharacterSpine.skeletonData.skeletonJson.skins).length-1),e=Object.keys(this.finishSkipAnimationCharacterSpine.skeletonData.skeletonJson.skins)[t];e&&this._setSkin(e)},_setSkin:function(t){this.finishSkipAnimationCharacterSpine.skeletonData.skeletonJson.skins[t]?(this.finishSkipAnimationCharacterSpine.defaultAnimation=t,this.finishSkipAnimationCharacterSpine.setSkin(t)):cc.error("skin "+t+"\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002")},_setRandomAnimation:function(){var t=o.getRandom(0,Object.keys(this.finishSkipAnimationCharacterSpine.skeletonData.skeletonJson.animations).length-1),e=Object.keys(this.finishSkipAnimationCharacterSpine.skeletonData.skeletonJson.animations)[t];this.finishSkipAnimationCharacterSpine.animation!==e&&this._setAnimation(e)},_setAnimation:function(t){this.finishSkipAnimationCharacterSpine.node.opacity=0,this.finishSkipAnimationCharacterSpine.node.color=cc.color(0,0,0),this.finishSkipAnimationCharacterSpine.node.runAction(cc.spawn(cc.fadeIn(.2),cc.tintTo(.2,255,255,255))),this.finishSkipAnimationCharacterSpine.setAnimation(0,t,1)},_setFadeOut:function(t,e,i){t.getComponent(sp.Skeleton)&&(t.getComponent(sp.Skeleton).premultipliedAlpha=!1),t.runAction(cc.sequence(cc.spawn(cc.fadeOut(e),cc.tintTo(e,0,0,0)),cc.callFunc(function(){i&&i()},this)))},fadeOutAllSpine:function(t,e){this.finishSkipAnimationCharacterSpine.node.runAction(cc.sequence(cc.fadeOut(t),cc.callFunc(function(){e&&e()},this)));for(var i=this.finishSkipAnimationCharacterSpine.node.getComponentsInChildren(sp.Skeleton),a=0;a<i.length;a+=1)this._setFadeOut(i[a].node,t)}});cc._RF.pop()},{AnimationEventComponent:"AnimationEventComponent",CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],QuestSkipListThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"b74a5wCzvBAk79V8rnD4mSq","QuestSkipListThumbnail");var a=t("ResourceUtils"),n=t("GameConst");cc.Class({extends:cc.Component,properties:{isLastResult:!1,skipNumLabel:cc.Label,expNumLabel:cc.Label,goldNumLabel:cc.Label,goldImageSprite:cc.Sprite,itemIconFramePrefab:cc.Prefab,listAnimation:cc.Animation,dropItemContent:cc.Node,listBase:cc.Node},_root:null,_dropArray:null,_itemDelayTimeBase:null,initQuestSkipListThumbnail:function(t,e,i,o,r,s){this._root=t,this.isLastResult||(this.skipNumLabel.string=e),this.goldNumLabel.string=i,this.goldNumLabel.node.opacity=0,this.expNumLabel.string=o,this.expNumLabel.node.opacity=0,this._itemDelayTimeBase=s||.1,a.addSprite(this.goldImageSprite,a.getFileNameItemImage(n.ITEM_ID_GOLD)),this._dropArray=[];for(var c=0;c<r.length;c++){for(var l=!1,u=0;u<this._dropArray.length;u++)if(this._dropArray[u].itemId===r[c].itemId&&this._dropArray[u].itemType===r[c].itemType&&this._dropArray[u].exceedLimit===r[c].exceedLimit){if(this._dropArray[u].count+r[c].count<=99){this._dropArray[u].count+=r[c].count,l=!0;break}if(this._dropArray[u].count<99){var h=99-this._dropArray[u].count;this._dropArray[u].count=99,r[c].count-=h}}l||this._dropArray.push(r[c])}this.initItemThumbnail()},initItemThumbnail:function(){for(var t=0;t<this._dropArray.length;t++){var e=cc.instantiate(this.itemIconFramePrefab).getComponent("QuestSkipResultDropItemThumbnail");e.initQuestSkipResultDropItemThumbnail(this._root,this._dropArray[t]),this.dropItemContent.addChild(e.node)}},getDropItemArray:function(){return this._dropArray},playSkipListThumbnailAnimation:function(t){this.listAnimation.once("finished",function(){if(t)return t()},this);for(var e=[],i=this._itemDelayTimeBase/this.dropItemContent.childrenCount,a=0;a<this.dropItemContent.childrenCount;a+=1)e.push(cc.callFunc(function(t){this.dropItemContent.children[t].getComponent("QuestSkipResultDropItemThumbnail").playItemAnimation()}.bind(this,a))),e.push(cc.delayTime(i));e.length>=2&&this.dropItemContent.runAction(cc.sequence(e)),this.listAnimation.play(),this.goldNumLabel.node.opacity=255,this.expNumLabel.node.opacity=255},resizeHeight:function(){if(this.listBase){var t=this.dropItemContent.children[0],e=t?t.height:75,i=Math.max(this.dropItemContent.height-e,0);this.node.height+=i,this.listBase.height+=i;for(var a=0;a<this.listBase.childrenCount;a++){var n=this.listBase.children[a].getComponent(cc.Widget);n&&n.updateAlignment()}}return this.node.height}});cc._RF.pop()},{GameConst:"GameConst",ResourceUtils:"ResourceUtils"}],QuestSkipResultDropItemThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"fc7c89B52ZPUJpCAE1rGOJp","QuestSkipResultDropItemThumbnail");var a=t("MatrixThumbnailUtils"),n=t("EquipmentUtils"),o=t("ItemConst");cc.Class({extends:cc.Component,properties:{itemAnimation:cc.Animation,thumbParent:cc.Node},_root:null,initQuestSkipResultDropItemThumbnail:function(t,e){var i={prefix:"x",count:e.count};e.itemType===o.ITEM_TYPE.EQUIPMENT&&void 0!==e.exceedLimit&&(i.rarity=n.getRarityByEquipmentIdAndExceedLimit(e.itemId,e.exceedLimit));var r=a.createMatrixThumbnailByItemType(e.itemId,e.itemType,i);this.thumbParent.addChild(r.node),this.node.scale=0},playItemAnimation:function(t){this.itemAnimation.once("finished",function(){if(t)return t()},this),this.itemAnimation.play()}}),cc._RF.pop()},{EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",MatrixThumbnailUtils:"MatrixThumbnailUtils"}],QuestSkipResultPopup:[function(t,e,i){"use strict";cc._RF.push(e,"cce73/+9xNJPbKqz+GHt34a","QuestSkipResultPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonScrollView"),s=t("DeckUtils"),c=t("CommonUtils"),l=t("ResourceUtils"),u=t("PopupUtils"),h=t("GameConst"),d=t("DeckConst"),p=t("LocalDataConst"),m=cc.Enum({STANDBY_OPEN:0,SKIP_ANIM:1,SKIP_CLEAR_ANIM:2,STANDBY_CLOSE:3}),g=cc.Enum({MOUSE_ENTER:cc.Node.EventType.MOUSE_ENTER,MOUSE_LEAVE:cc.Node.EventType.MOUSE_LEAVE,MOUSE_WHEEL:cc.Node.EventType.MOUSE_WHEEL,TOUCH_START:cc.Node.EventType.TOUCH_START,TOUCH_MOVE:cc.Node.EventType.TOUCH_MOVE,TOUCH_END:cc.Node.EventType.TOUCH_END,TOUCH_CANCEL:cc.Node.EventType.TOUCH_CANCEL});cc.Class({extends:a,properties:{questSkipCharacterAnimationViewParentNode:cc.Node,questSkipCharacterAnimationViewPrefab:cc.Prefab,skipListThumbnailViewPrefab:cc.Prefab,skipResultListThumbnailPrefab:cc.Prefab,OkBtn:o,skipListScrollView:r,contentModalNode:cc.Node,skipListGroupNode:cc.Node},_root:null,_requestCount:0,_skipResponse:null,_skipStageModel:null,_skipCount:null,_callback:null,_totalDropItemArray:null,_animationCount:0,_divisionOffsetArray:null,_characterMainModelArray:null,_questSkipCharacterAnimationView:null,_statusType:0,_skipListThumbnailViewArray:null,_endOffset:null,onLoad:function(){this.OkBtn.switchBtnImage(!0),this.OkBtn.setTapEvent(this._onTapOkBtnEvent.bind(this))},openQuestSkipResultPopup:function(t,e,i,a,n){this._root=t,this._skipResponse=e,this._skipStageModel=i,this._skipCount=a,this._callback=n,this._setStatusType(m.STANDBY_OPEN),this._switchContentModalNodeEvent(!0),this._initSkipResultData(),this._initSkipCharacterData(),this._initQuestSkipCharacterAnimationView(),this._requestCharacterResource()},_initSkipResultData:function(){this.skipListGroupNode.destroyAllChildren(),this._totalDropItemArray=[],this._createSkipListThumbnail()},_initSkipCharacterData:function(){this._characterMainModelArray=[];var t=s.createDeckMap()[d.DECK_TYPE.QUEST][n.localData[p.SELECT_QUEST_DECK_ORDER]],e=Object.keys(t);_.forEach(e,function(e){this._characterMainModelArray.push(t[e][d.ROLE_TYPE.MAIN].getCharacterMainMaster())}.bind(this))},_initQuestSkipCharacterAnimationView:function(){this._questSkipCharacterAnimationView||(this._questSkipCharacterAnimationView=cc.instantiate(this.questSkipCharacterAnimationViewPrefab).getComponent("QuestSkipCharacterAnimationView"),this.questSkipCharacterAnimationViewParentNode.addChild(this._questSkipCharacterAnimationView.node))},_openCallbackEvent:function(){this._setStatusType(m.SKIP_ANIM),this.skipListScrollView.scrollToTop(0);var t=this._questSkipCharacterAnimationView.getAnimDuration()/2;this._animationCount=0,this._divisionOffsetArray=[],this._endOffset=cc.v2(0,0);for(var e=this.skipListGroupNode.getComponent(cc.Layout).spacingY,i=0;i<this._skipListThumbnailViewArray.length;i++){var a=this._skipListThumbnailViewArray[i].resizeHeight();this._divisionOffsetArray[i]=cc.v2(0,a+e),i!==this._skipListThumbnailViewArray.length-1&&(this._endOffset=this._endOffset.add(this._divisionOffsetArray[i]))}this._playStageSkipResultAnimation(t,this._animationCount)},_openMaxLimitPopup:function(t,e,i){var a=[];if(e.addWarehouseCharacters.length+e.updateWarehouseCharacters.length>0&&a.push("\u30e6\u30cb\u30c3\u30c8"),e.addWarehouseEquipments.length+e.updateWarehouseEquipments.length>0&&a.push("\u88c5\u5099"),e.addWarehouseMaterials.length+e.updateWarehouseMaterials.length>0&&a.push("\u7d20\u6750"),!(a.length>0))return i(t,e);u.openCommonPopupOk("\u6240\u6301\u4e0a\u9650","["+_.join(a,", ")+"]\u304c\u6240\u6301\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n\u5009\u5eab\u306b\u9001\u3089\u308c\u307e\u3057\u305f\u3002",void 0,!1,function(){i(t,e)})},_onTapOkBtnEvent:function(){if(this._getStatusType()===m.SKIP_ANIM){this.OkBtn.switchBtnImage(!1),this.skipListScrollView.stopAutoScroll(),this.skipListScrollView.scrollToOffset(this._endOffset,0),this._setStatusType(m.SKIP_CLEAR_ANIM),this.skipListGroupNode.childrenCount-this._animationCount>0&&(this.skipListGroupNode.stopAllActions(),this._playStageSkipResultAnimation(.01,this._animationCount))}else this._getStatusType()===m.STANDBY_CLOSE&&(this._questSkipCharacterAnimationView.fadeOutAllSpine(.5,void 0),this._openMaxLimitPopup(this._root,this._skipResponse,function(t,e){e.addUserLevel>0&&t.openQuestSkipResultRankUpPopup(e)}),this._callback&&this._callback(),this.close())},_switchContentModalNodeEvent:function(t){for(var e in g)t?this.contentModalNode.on(g[e],this._modalTouchEvent,this):this.contentModalNode.off(g[e],this._modalTouchEvent,this)},_modalTouchEvent:function(t){t.stopPropagation()},_playStageSkipResultAnimation:function(t,e,i){var a=[];a.push(cc.delayTime(t));for(var n=e;n<this.skipListGroupNode.childrenCount;n+=1)a.push(cc.callFunc(function(t){t>=this.skipListGroupNode.childrenCount-1?(this._setStatusType(m.SKIP_CLEAR_ANIM),this.OkBtn.switchBtnImage(!1),this._playFinishSkipAnimation(function(t){this.skipListGroupNode.children[t].getComponent("QuestSkipListThumbnail").playSkipListThumbnailAnimation(function(){this._switchContentModalNodeEvent(!1),this._setStatusType(m.STANDBY_CLOSE)}.bind(this))}.bind(this,t))):(this.skipListGroupNode.children[t].getComponent("QuestSkipListThumbnail").playSkipListThumbnailAnimation(),this._getStatusType()===m.SKIP_ANIM&&this._playNormalSkipAnimation()),this._animationCount=t+1}.bind(this,n))),a.push(cc.delayTime(t)),a.push(cc.callFunc(function(){if(this._getStatusType()===m.SKIP_ANIM&&this.skipListGroupNode.childrenCount>0){var e=this._divisionOffsetArray.shift();this.skipListScrollView.scrollToOffset(this.skipListScrollView.getScrollOffset().add(e),t)}}.bind(this))),a.push(cc.delayTime(t));i&&a.push(cc.callFunc(i)),this.skipListGroupNode.runAction(cc.sequence(a))},_playNormalSkipAnimation:function(t){var e=c.getRandom(0,this._characterMainModelArray.length-1);this._questSkipCharacterAnimationView.playNormalSkipAnimation(this._characterMainModelArray[e],t)},_playFinishSkipAnimation:function(t){this._questSkipCharacterAnimationView.playFinishSkipAnimation(this._characterMainModelArray[0],t)},_setStatusType:function(t){this._statusType=t},_getStatusType:function(){return this._statusType},_createSkipListThumbnail:function(){var t=0,e=[],i=null;this._skipListThumbnailViewArray=[];for(var a=0;a<this._skipCount;a+=1)(i=cc.instantiate(this.skipListThumbnailViewPrefab).getComponent("QuestSkipListThumbnail")).initQuestSkipListThumbnail(this._root,a+1,this._skipResponse.addGolds[a],this._skipResponse.addUserExps[a],this._skipResponse.dropItems[a]),this.skipListGroupNode.addChild(i.node),this._skipListThumbnailViewArray.push(i),t+=this._skipResponse.addGolds[a],_.forEach(i.getDropItemArray(),function(t){e.push(t)});this._createTotalDropItemArray(e),(i=cc.instantiate(this.skipResultListThumbnailPrefab).getComponent("QuestSkipListThumbnail")).initQuestSkipListThumbnail(this._root,null,t,this._skipResponse.addUserExp,this._totalDropItemArray),this.skipListGroupNode.addChild(i.node),this._skipListThumbnailViewArray.push(i)},_createTotalDropItemArray:function(t){for(var e=0;e<t.length;e+=1){for(var i=!1,a=0;a<this._totalDropItemArray.length;a+=1)if(this._totalDropItemArray[a].itemId===t[e].itemId&&this._totalDropItemArray[a].itemType===t[e].itemType&&this._totalDropItemArray[a].exceedLimit===t[e].exceedLimit){if(this._totalDropItemArray[a].count+t[e].count<=99){this._totalDropItemArray[a].count+=t[e].count,i=!0;break}if(this._totalDropItemArray[a].count<99){var n=99-this._totalDropItemArray[a].count;this._totalDropItemArray[a].count=99,t[e].count-=n}}i||this._totalDropItemArray.push(t[e])}},_addWindow:function(){var t=new cc.Node("ModalLayer");t.setContentSize(cc.winSize),t.zIndex=-1,t.active=!0;var e=-1*this.node.getPosition().x,i=-1*this.node.getPosition().y;t.setPosition(cc.v2(e,i)),this.node.addChild(t),this.windowNode&&(this.windowNode.on("touchstart",function(t){t.stopPropagation()}),this.windowNode.on("touchend",function(t){t.stopPropagation()})),t.on("touchstart",function(t){t.stopPropagation()}),t.on("touchend",function(t){this.windowNode&&!this._bSystemPopup&&this._getStatusType()===m.STANDBY_CLOSE&&(this._questSkipCharacterAnimationView.fadeOutAllSpine(.5,void 0),this._openMaxLimitPopup(this._root,this._skipResponse,function(t,e){e.addUserLevel>0&&t.openQuestSkipResultRankUpPopup(e)}),this._callback&&this._callback(),this.close()),t.stopPropagation()}.bind(this)),t.on(cc.Node.EventType.MOUSE_WHEEL,function(t){t.stopPropagation()}),this._setNodeGroup(this.node);var a=this._bSystemPopup?h.Z_ORDER.SYSTEM_POPUP:h.Z_ORDER.POPUP;cc.director.getScene().getChildByName("Canvas").addChild(this.node,a)},_requestCharacterResource:function(){this._requestCount=0;var t=[];this._requestCount+=1,t.push(this._requestRoomSpineResource.bind(this,this._characterMainModelArray[0],this._isFinishedRequest.bind(this)));for(var e=0;e<this._characterMainModelArray.length;e+=1)this._requestCount+=1,t.push(this._requestCharacterUnisonResource.bind(this,this._characterMainModelArray[e],this._isFinishedRequest.bind(this)));_.forEach(t,function(t){t()})},_requestRoomSpineResource:function(t,e){this._root.requestRes(l.getFileNameCharacterRoomSpine(t.getSpineDirectoryPath()),sp.SkeletonData,function(){if(e)return e()})},_requestCharacterUnisonResource:function(t,e){this._root.requestRes(l.getFileNameCharacterUnison(t.getCharacterId()),cc.SpriteFrame,function(){if(e)return e()})},_isFinishedRequest:function(){this._requestCount<=1?this.open(this._openCallbackEvent.bind(this)):this._requestCount-=1}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckUtils:"DeckUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupBase:"PopupBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],QuestSkipResultRankUpPopup:[function(t,e,i){"use strict";cc._RF.push(e,"54a08dNBwVGuJu95d9tIsce","QuestSkipResultRankUpPopup");var a=t("Singleton"),n=t("RankUpPopupBase");cc.Class({extends:n,_root:null,_questSkipResponse:null,onLoad:function(){this._super()},openQuestSkipResultRankUpPopup:function(t,e){this._root=t,this._questSkipResponse=e,this.openRankUpPopup()},_createLevelParam:function(){var t=a.dao[a.USER];return{beforeLv:a.dao.UserMainMasters.find(function(e){return e.getUserLevel()===t.getLevel()-this._questSkipResponse.addUserLevel}.bind(this)).getUserLevel(),afterLv:t.getLevel()}},_callbackFinishedOpenFunc:function(){},_onTapOkBtn:function(){this.close()}}),cc._RF.pop()},{RankUpPopupBase:"RankUpPopupBase",Singleton:"Singleton"}],QuestStageEventListView:[function(t,e,i){"use strict";cc._RF.push(e,"80b6ckQ5aVOJba/NocgGUDB","QuestStageEventListView");var a=t("GameConst"),n=t("QuestStageListViewBase");cc.Class({extends:n,getListTitle:function(){return"\u30b9\u30c6\u30fc\u30b8\u9078\u629e"},getBackListTitle:function(){return"\u30a4\u30d9\u30f3\u30c8TOP"},getTextGroup:function(){return a.QUEST_TEXT_GROUP.NORMAL}});cc._RF.pop()},{GameConst:"GameConst",QuestStageListViewBase:"QuestStageListViewBase"}],QuestStageListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"0331dlt2ZhLHKCLu8ms0SD3","QuestStageListViewBase");var a=t("QuestUtils"),n=(t("StoryConst"),t("GameConst")),o=t("QuestListViewBase"),r="detailStatus",s="detailAchieve";cc.Class({extends:o,_thumbImageType:null,getCallbackToSwitchThumbnailImage:function(){return this._switchThumbnailImage.bind(this)},isStageListView:function(){return!0},_setListContent:function(t){t.selectDifficult||(t.selectDifficult=n.QUEST_DIFFICULT.NORMAL.NORMAL);var e=a.getUserQuestDifficultMapByWorldId(t.selectWorldId,t.selectDifficult)[t.selectAreaId];for(var i in e)this._addThumbnail(e[i]);this._thumbImageType=r},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("QuestStageThumbnail");e.initQuestStageThumbnail(t.getQuestStageMaster(),t,this._callbackToThumbnail.bind(this)),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){var e=t.getStageId(),i=t.getAreaId();this._root.pushBattleStartConfirmSubRoot(e,i,this._root.selectDifficult)},_switchThumbnailImage:function(){switch(this._thumbImageType||(this._thumbImageType=r),this._thumbImageType){case r:this._thumbImageType=s;break;case s:this._thumbImageType=r}this._redrawListView()},_redrawListView:function(){for(var t in this.thumbnailParentNode.children)this.thumbnailParentNode.children[t].getComponent("QuestStageThumbnail").switchDisplayMode(this._thumbImageType)}});cc._RF.pop()},{GameConst:"GameConst",QuestListViewBase:"QuestListViewBase",QuestUtils:"QuestUtils",StoryConst:"StoryConst"}],QuestStageModel:[function(t,e,i){"use strict";cc._RF.push(e,"22278avLPdMY6Ocfzz1jZxq","QuestStageModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getWorldId:function(){if(this._isKeyFieldAvailable("worldId"))return this._data.worldId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: worldId")},getAreaId:function(){if(this._isKeyFieldAvailable("areaId"))return this._data.areaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: areaId")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getReleaseStageId:function(){if(this._isKeyFieldAvailable("releaseStageId"))return this._data.releaseStageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: releaseStageId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getRecommendPower:function(){if(this._isKeyFieldAvailable("recommendPower"))return this._data.recommendPower;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: recommendPower")},getStamina:function(){if(this._isKeyFieldAvailable("stamina"))return this._data.stamina;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stamina")},getMaxBattleCount:function(){if(this._isKeyFieldAvailable("maxBattleCount"))return this._data.maxBattleCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxBattleCount")},getIsSkip:function(){if(this._isKeyFieldAvailable("isSkip"))return this._data.isSkip;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isSkip")},getMaxSkipCount:function(){if(this._isKeyFieldAvailable("maxSkipCount"))return this._data.maxSkipCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxSkipCount")},getMaxClearCount:function(){if(this._isKeyFieldAvailable("maxClearCount"))return this._data.maxClearCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxClearCount")},getUserExpFrom:function(){if(this._isKeyFieldAvailable("userExpFrom"))return this._data.userExpFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userExpFrom")},getUserExpTo:function(){if(this._isKeyFieldAvailable("userExpTo"))return this._data.userExpTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userExpTo")},getCharacterExpFrom:function(){if(this._isKeyFieldAvailable("characterExpFrom"))return this._data.characterExpFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterExpFrom")},getCharacterExpTo:function(){if(this._isKeyFieldAvailable("characterExpTo"))return this._data.characterExpTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterExpTo")},getGoldFrom:function(){if(this._isKeyFieldAvailable("goldFrom"))return this._data.goldFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: goldFrom")},getGoldTo:function(){if(this._isKeyFieldAvailable("goldTo"))return this._data.goldTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: goldTo")},getAchieveId1:function(){if(this._isKeyFieldAvailable("achieveId1"))return this._data.achieveId1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: achieveId1")},getAchieveId2:function(){if(this._isKeyFieldAvailable("achieveId2"))return this._data.achieveId2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: achieveId2")},getAchieveId3:function(){if(this._isKeyFieldAvailable("achieveId3"))return this._data.achieveId3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: achieveId3")},getRewardItemType:function(){if(this._isKeyFieldAvailable("rewardItemType"))return this._data.rewardItemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemType")},getRewardItemId:function(){if(this._isKeyFieldAvailable("rewardItemId"))return this._data.rewardItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemId")},getRewardItemCount:function(){if(this._isKeyFieldAvailable("rewardItemCount"))return this._data.rewardItemCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemCount")},getBackground:function(){if(this._isKeyFieldAvailable("background"))return this._data.background;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: background")},getNormalWaveBgm:function(){if(this._isKeyFieldAvailable("normalWaveBgm"))return this._data.normalWaveBgm;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: normalWaveBgm")},getBossWaveBgm:function(){if(this._isKeyFieldAvailable("bossWaveBgm"))return this._data.bossWaveBgm;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bossWaveBgm")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestStageNormalListView:[function(t,e,i){"use strict";cc._RF.push(e,"6b68bsRNe5DrKBilfcoLuHz","QuestStageNormalListView");var a=t("GameConst"),n=t("QuestStageListViewBase");cc.Class({extends:n,getListTitle:function(){return"\u30b9\u30c6\u30fc\u30b8\u9078\u629e"},getBackListTitle:function(){return"\u30a8\u30ea\u30a2\u9078\u629e"},getTextGroup:function(){return a.QUEST_TEXT_GROUP.NORMAL}});cc._RF.pop()},{GameConst:"GameConst",QuestStageListViewBase:"QuestStageListViewBase"}],QuestStageThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"932c7d1Qz1AQLj9FFQY2bhP","QuestStageThumbnail");var a=t("CommonButton"),n=t("CommonScrollLabel"),o=t("PopupUtils"),r=t("QuestUtils"),s=t("MatrixThumbnailUtils"),c=t("EquipmentUtils"),l=t("CampaignUtils"),u=t("ItemConst");cc.Class({extends:cc.Component,properties:{itemThumbnailParentNode:cc.Node,questStageNewSprite:cc.Sprite,questStageCompleteSprite:cc.Sprite,questAchieveLabel1:n,questAchieveLabel2:n,questAchieveLabel3:n,questAchieveNode1:cc.Node,questAchieveNode2:cc.Node,questAchieveNode3:cc.Node,questStatusAchieveNodeParent:cc.Node,questStatusAchieveNode1:cc.Node,questStatusAchieveNode2:cc.Node,questStatusAchieveNode3:cc.Node,questStatusNode:cc.Node,questAchieveNode:cc.Node,questStageNameLabel:cc.Label,consumeApLabel:cc.Label,challengeCountNode:cc.Node,challengeCountLabel:cc.Label,thumbnailBtn:a},_questStageMaster:null,_userStageModel:null,_selectedDetailMode:null,_callbackBoThumbnailBtn:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbanilBtn.bind(this))},initQuestStageThumbnail:function(t,e,i){this._questStageMaster=t,this._userStageModel=e,this._callbackBoThumbnailBtn=i,this.questStageNameLabel.string=t.getName();var a=r.getCampaignAPValueByStageId(t.getStageId()),n=t.getStamina();a&&(n=Math.ceil(n*a/1e3)),this.consumeApLabel.string=n,this._questDropItem(t),this._setChallengeCount(t,e),e?this._setUserData(e):this._resetUserData()},_setUserData:function(t){this.questStatusAchieveNode1.active=t.getIsClearMission1(),this.questStatusAchieveNode2.active=t.getIsClearMission2(),this.questStatusAchieveNode3.active=t.getIsClearMission3(),this.questAchieveLabel1.setString(t.getQuestAchieveMaster1().getText()),this.questAchieveLabel2.setString(t.getQuestAchieveMaster2().getText()),this.questAchieveLabel3.setString(t.getQuestAchieveMaster3().getText()),this.questAchieveNode1.active=t.getIsClearMission1(),this.questAchieveNode2.active=t.getIsClearMission2(),this.questAchieveNode3.active=t.getIsClearMission3();var e=r.getStageStatus(t);this.questStageNewSprite.node.active=e.newLabel,this.questStageCompleteSprite.node.active=e.completeLabel,e.newLabel||e.completeLabel?this.questStatusAchieveNodeParent.active=!1:this.questStatusAchieveNodeParent.active=!0},_resetUserData:function(){this.questStageNewSprite.node.active=!1,this.questStageCompleteSprite.node.active=!1,this.questStatusAchieveNode1.active=!1,this.questStatusAchieveNode2.active=!1,this.questStatusAchieveNode3.active=!1,this.questAchieveNode1.active=!1,this.questAchieveNode2.active=!1,this.questAchieveNode3.active=!1},switchDisplayMode:function(t){this._selectedDetailMode=t,this._changeMode()},_changeMode:function(){switch(this.questStatusNode.active=!1,this.questAchieveNode.active=!1,this._selectedDetailMode){case"detailStatus":this.questStatusNode.active=!0;break;case"detailAchieve":this.questAchieveNode.active=!0}},_questDropItem:function(t){for(var e=r.getDropMasterArrayByStageId(t.getStageId(),!0,!0),i=0;i<5;i+=1){if(e[i]){var a={};e[i].getItemType()===u.ITEM_TYPE.EQUIPMENT&&(a.rarity=c.getRarityByEquipmentIdAndExceedLimit(e[i].getItemId(),e[i].getExceedLimit()));var n=s.createMatrixThumbnailByItemType(e[i].getItemId(),e[i].getItemType(),a);this.itemThumbnailParentNode.addChild(n.node)}}},_setChallengeCount:function(t,e){var i=l.getMaxDayPlayCount(t);if(i<=0)this.challengeCountNode.active=!1;else{this.challengeCountNode.active=!0;var a=e?i-e.getTodayPlayCount():i;this.challengeCountLabel.string=a+"/"+i}},_onTapThumbanilBtn:function(){var t=l.getMaxDayPlayCount(this._questStageMaster);if(t>0&&this._userStageModel&&this._userStageModel.getTodayPlayCount()>=t)return o.openSimpleMessageWindow("\u672c\u65e5\u306e\u4e0a\u9650\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f\u3002");this._callbackBoThumbnailBtn(this._questStageMaster)}});cc._RF.pop()},{CampaignUtils:"CampaignUtils",CommonButton:"CommonButton",CommonScrollLabel:"CommonScrollLabel",EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils"}],QuestStageWeekListView:[function(t,e,i){"use strict";cc._RF.push(e,"c94baksgMNESobYyR+f5msr","QuestStageWeekListView");t("QuestUtils");var a=t("GameConst"),n=t("QuestStageListViewBase");cc.Class({extends:n,_setListContent:function(t){var e=this.thumbnailParentNode.getComponent(cc.Layout);e&&(e.verticalDirection=cc.Layout.VerticalDirection.BOTTOM_TO_TOP),this._super(t)},getListTitle:function(){return"\u96e3\u6613\u5ea6\u9078\u629e"},getBackListTitle:function(){return"\u30af\u30a8\u30b9\u30c8\u9078\u629e"},getTextGroup:function(){return a.QUEST_TEXT_GROUP.WEEK}});cc._RF.pop()},{GameConst:"GameConst",QuestStageListViewBase:"QuestStageListViewBase",QuestUtils:"QuestUtils"}],QuestSubMissionPopup:[function(t,e,i){"use strict";cc._RF.push(e,"c64449E/NFMe7nwRgXN5pbx","QuestSubMissionPopup");var a=t("PopupBase"),n=(t("CommonButton"),t("CommonScrollLabel"));cc.Class({extends:a,properties:{questStageNameLabel:cc.Label,questAchieveLabel1:n,questAchieveLabel2:n,questAchieveLabel3:n,questStatusAchieveNode1:cc.Node,questStatusAchieveNode2:cc.Node,questStatusAchieveNode3:cc.Node},_callback:null,openQuestSubMissionPopup:function(t,e,i){this._initQuestSubMissionPopup(t,e,i),this.open()},_initQuestSubMissionPopup:function(t,e,i){this._callback=i,this.questStageNameLabel.string="\u30df\u30c3\u30b7\u30e7\u30f3",e?(this.questStatusAchieveNode1.active=e.getIsClearMission1(),this.questStatusAchieveNode2.active=e.getIsClearMission2(),this.questStatusAchieveNode3.active=e.getIsClearMission3(),this.questAchieveLabel1.setString(e.getQuestAchieveMaster1().getText()),this.questAchieveLabel2.setString(e.getQuestAchieveMaster2().getText()),this.questAchieveLabel3.setString(e.getQuestAchieveMaster3().getText())):(this.questStatusAchieveNode1.active=!1,this.questStatusAchieveNode2.active=!1,this.questStatusAchieveNode3.active=!1)}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollLabel:"CommonScrollLabel",PopupBase:"PopupBase"}],QuestTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"763888s3+JCKZ7Tupj+qH3b","QuestTopSubRoot");var a=t("WindowBase"),n=t("CommonButton"),o=t("PopupUtils"),r=t("Singleton"),s=t("LocalDataConst"),c=t("QuestUtils"),l=(t("ResourceUtils"),t("TimeUtils")),u=t("EventUtils"),h=t("NoticeBadgeCheckUtils"),d=t("ViewUtils"),p=t("UserUtils"),m=t("EventQuestConst"),g=t("SingletonConst"),C=t("GameConst"),f={POSITION_1:cc.v2(120,90),POSITION_2:cc.v2(185,90),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{normalButton:n,weekButton:n,eventButton:n,towerButton:n,arenaButton:n,raidButton:n,normalCampaignNode:cc.Node,weekCampaignNode:cc.Node,eventCampaignNode:cc.Node,raidCampaignNode:cc.Node,weekLimitNode:cc.Node,towerLimitNode:cc.Node,weekRemainingLabel:cc.Label,towerRemainingLabel:cc.Label,arenaRemainingLabel:cc.Label,raidRemainingDateTopNode:cc.Node,raidRemainingDateNode:cc.Node,raidRemainingDatePrefixLabel:cc.Label,raidRemainingDateLabel:cc.Label,raidRemainingTimeNode:cc.Node,raidRemainingTimePrefixLabel:cc.Label,raidRemainingTimeLabel:cc.Label},_root:null,initQuestTopSubRoot:function(t,e){this._root=t,e||(e=r.localData[s.SELECT_WORLD_ID]),this._root.redrawBackGround(C.DEFAULT_QUEST_BG),this._setButtonEvent(e),this._initTags()},_setButtonEvent:function(t){this.normalButton.setTapEvent(function(){this._root.transitionNormalScene(t)}.bind(this)),this.weekButton.setTapEvent(function(){this._root.transitionWeekScene()}.bind(this)),this.eventButton.setTapEvent(function(){this._root.pushQuestEventSelectScene()}.bind(this)),this.towerButton.setTapEvent(function(){this._isAppearTower()?this._root.transitionTowerScene():o.openSimpleMessageWindow("\u30bf\u30ef\u30fc\u6e96\u5099\u671f\u9593\u4e2d\u3067\u3059")}.bind(this)),this.arenaButton.setTapEvent(function(){this._isAppearArena()?this._root.transitionPvPScene():o.openSimpleMessageWindow("\u30a2\u30ea\u30fc\u30ca\u6e96\u5099\u671f\u9593\u4e2d\u3067\u3059")}.bind(this)),this._setRaidButton()},_setRaidButton:function(){this.raidButton.switchBtnImage(!0);var t=p.getUserSceneProgressInfo("RaidScene");!r[g.ENVIRONMENT].getDebugContentsRelease()&&t&&(t.isReleased||this.raidButton.switchBtnImage(!1)),u.getOpenEventMainMasterArray().find(function(t){return t.getEventType()===m.EVENT_TYPE.RAID})?(this.raidButton.node.active=!0,this.raidButton.setTapEvent(function(){this._root.transitionRaidScene()}.bind(this))):this.raidButton.node.active=!1},_initTags:function(){this._initNormalQuestButton(),this._initEventQuestButton(),this._initWeekQuestButton(),this._initArenaButton(),this._initTowerButton(),this._initRaidButton()},_initNormalQuestButton:function(){this._isNormalCampaign()?this.normalCampaignNode.active=!0:this.normalCampaignNode.active=!1},_initEventQuestButton:function(){this._isEventCampaign()?this.eventCampaignNode.active=!0:this.eventCampaignNode.active=!1,(h.hasNewEventQuest()||h.hasUnclearedBeginerQuest())&&d.addNoticeBadge(this.eventButton.node,f.POSITION_2,f.SCALE)},_initWeekQuestButton:function(){this.weekRemainingLabel.string=this._getWeekRemainingLabel(),this._isWeekCampaign()?this.weekCampaignNode.active=!0:this.weekCampaignNode.active=!1,this.weekLimitNode.active=this._isLimitWeek(),h.hasWeekUnlockCount()&&d.addNoticeBadge(this.weekButton.node,f.POSITION_1,f.SCALE)},_isAppearArena:function(){return _.some(r.dao.PvPMainMasters,function(t){return l.isRangeOfDate(t.getFromDate(),t.getToDate())})},_initArenaButton:function(){this._isArenaEnabled()?(this.arenaButton.switchBtnImage(!0),this.arenaRemainingLabel.string=this._getArenaRemainingLabel(),h.hasPvPChallengeCount()&&d.addNoticeBadge(this.arenaButton.node,f.POSITION_2,f.SCALE)):this.arenaButton.switchBtnImage(!1)},_isAppearTower:function(){return _.some(r.dao.TowerMainMasters,function(t){return l.isRangeOfDate(t.getDateFrom(),t.getDateTo())})},_initTowerButton:function(){if(this._isAppearTower()){this.towerButton.switchBtnImage(!0);var t=p.getUserSceneProgressInfo("TowerScene");r[g.ENVIRONMENT].getDebugContentsRelease()||!t||t.isReleased?(this.towerRemainingLabel.string=this._getTowerRemainingLabel(),this.towerLimitNode.active=this._isLimitTower(),h.hasTowerChallengerCount()&&d.addNoticeBadge(this.towerButton.node,f.POSITION_1,f.SCALE)):this.towerButton.switchBtnImage(!1)}else this.towerButton.switchBtnImage(!1)},_initRaidButton:function(){this._isRaidCampaign()?(this.raidCampaignNode.active=!0,this.raidRemainingDateTopNode.active=!1):(this.raidCampaignNode.active=!1,this.raidRemainingDateTopNode.active=!0),this._setRaidRemainingDateNode()},_isNormalCampaign:function(){return!!c.getCampaignMasterArray().find(function(t){var e=!!t.getTargetIds().split(",").find(function(t){return parseInt(c.getAreaMasterByAreaId(parseInt(t)).getWorldId()/1e3)===C.WORLD_CATEGORY.NORMAL});return 2===t.getTargetType()&&e&&t.getCampaignType()<6})},_isWeekCampaign:function(){return!!c.getCampaignMasterArray().find(function(t){var e=!!t.getTargetIds().split(",").find(function(t){return parseInt(c.getAreaMasterByAreaId(parseInt(t)).getWorldId()/1e3)===C.WORLD_CATEGORY.WEEK});return 2===t.getTargetType()&&e&&t.getCampaignType()<6})},_isEventCampaign:function(){return!!c.getCampaignMasterArray().find(function(t){var e=!!t.getTargetIds().split(",").find(function(t){return parseInt(c.getAreaMasterByAreaId(parseInt(t)).getWorldId()/1e3)===C.WORLD_CATEGORY.EVENT});return 2===t.getTargetType()&&e&&t.getCampaignType()<6})},_isArenaEnabled:function(){var t=p.getUserSceneProgressInfo("PvPScene");return!(!r[g.ENVIRONMENT].getDebugContentsRelease()&&t&&!t.isReleased)&&!!r.dao.userPvP.getPvPMainMaster()},_isRaidCampaign:function(){return!!c.getCampaignMasterArray().find(function(t){var e=!!t.getTargetIds().split(",").find(function(t){return parseInt(c.getAreaMasterByAreaId(parseInt(t)).getWorldId()/1e3)===C.WORLD_CATEGORY.RAID});return 2===t.getTargetType()&&e&&t.getCampaignType()<6})},_getWeekRemainingLabel:function(){var t=c.getUserWorldArrayByWorldCategory(C.WORLD_CATEGORY.WEEK)[0].getWorldId(),e=c.getCampaignRemainingUnlockCountInfoByWorldId(t);return"\u6b8b\u308a\u958b\u653e\u56de\u6570 "+(e.MaxUnlockCount-e.MaxTodayUnlockCount).toString()+"/"+e.MaxUnlockCount.toString()},_getTowerRemainingLabel:function(){return"\u6b8b\u308a\u6311\u6226\u56de\u6570 "+(r.dao.towerSession.getTowerSelectMaxCount()-r.dao.towerSession.getTowerSelectCount())+"/"+r.dao.towerSession.getTowerSelectMaxCount()},_getArenaRemainingLabel:function(){return"\u6b8b\u308a\u6311\u6226\u56de\u6570 "+r.dao.userPvP.getStamina()+"/"+r.dao.userPvP.getMaxStamina()},_setRaidRemainingDateNode:function(){if(this.raidRemainingDateTopNode.active){this.raidRemainingDateNode.active=!1,this.raidRemainingTimeNode.active=!1;var t=u.getOpenEventMainMasterArray().find(function(t){return t.getEventType()===m.EVENT_TYPE.RAID});if(t){var e=c.getWorldMasterByWorldId(t.getWorldId());if(e){var i=l.getDiffMS(e.getToDate(),!0);if(i<=0){if((i=l.getDiffMS(t.getToDate(),!0))<=0)return;this.raidRemainingDatePrefixLabel.string="\u53d7\u53d6\u671f\u9593\u7d42\u4e86\u307e\u3067\u3042\u3068",this.raidRemainingTimePrefixLabel.string="\u53d7\u53d6\u7d42\u4e86\u307e\u3067\u3042\u3068"}var a=l.parseMsToDay(i),n=l.parseMsToHour(i),o=l.parseMsToMinute(i);a>=1?(this.raidRemainingDateNode.active=!0,this.raidRemainingDateLabel.string=a+"\u65e5"):n>=1?(this.raidRemainingTimeNode.active=!0,o-=60*n,this.raidRemainingTimeLabel.string=n+"\u6642\u9593"+o+"\u5206"):(this.raidRemainingTimeNode.active=!0,this.raidRemainingTimeLabel.string=o+"\u5206")}}}},_isLimitWeek:function(){var t=c.getUserWorldArrayByWorldCategory(C.WORLD_CATEGORY.WEEK)[0].getWorldId(),e=c.getCampaignRemainingUnlockCountInfoByWorldId(t);return!this._isWeekCampaign()&&e.MaxUnlockCount<=e.MaxTodayUnlockCount},_isLimitTower:function(){return r.dao.towerSession.getTowerSelectMaxCount()-r.dao.towerSession.getTowerSelectCount()==0}});cc._RF.pop()},{CommonButton:"CommonButton",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",TimeUtils:"TimeUtils",UserUtils:"UserUtils",ViewUtils:"ViewUtils",WindowBase:"WindowBase"}],QuestUtils:[function(t,e,i){"use strict";cc._RF.push(e,"a70d6rSlLpKKbnm8PQZLffc","QuestUtils");var a=t("Singleton"),n=t("GameConst"),o=t("TimeUtils"),r=t("CommonUtils"),s=t("QuestModel");function c(){var t={},e=a.dao.QuestWorldMasters;for(var i in e){t[e[i].getWorldId()]=e[i]}return t}function l(){return u()}function u(){var t={},e=a.dao.QuestAreaMasters;for(var i in e){t[e[i].getAreaId()]=e[i]}return t}function h(){return d()}function d(){var t={},e=a.dao.QuestStageMasters;for(var i in e)t[e[i].getStageId()]=e[i];return t}function p(t,e,i){if(t===n.OPEN_CONDITION_TYPE.NON)return!0;var r=a.dao.userBasicData;if(t===n.OPEN_CONDITION_TYPE.RANK){var s=r.getLevel();return s>=e&&s<=i}if(t===n.OPEN_CONDITION_TYPE.REGISTER_DATE){var c=o.addMinute(r.getTutorialEndDate(),e),l=o.addMinute(r.getTutorialEndDate(),i);return o.isRangeOfDate(c,l)}return!1}function m(t){return a.dao[a.USER_QUEST].filter(function(e){return e.getQuestWorldMaster().getCategory()===t})}function g(t){for(var e=m(t),i=a.dao.QuestWorldMasters.filter(function(e){return e.getCategory()===t}),n=[],o=0;o<i.length;o++)for(var r=0;r<e.length;r++)if(i[o].getWorldId()===e[r].getWorldId()){n.push(i[o]);break}return n}function C(t){for(var e=a.dao[a.USER_QUEST].filter(function(e){return e.getWorldId()===t}),i={},n=0;n<e.length;n+=1){var o=e[n].getAreaId();i[o]||(i[o]={});var r=e[n].getStageId();i[o][r]||(i[o][r]=e[n])}return i}function f(t,e){for(var i=a.dao[a.USER_QUEST].filter(function(e){return e.getWorldId()===t}),n={},o=0;o<i.length;o+=1)if(i[o].getAreaDifficult()===e){var r=i[o].getAreaId();n[r]||(n[r]={});var s=i[o].getStageId();n[r][s]||(n[r][s]=i[o])}return n}function E(t){return a.dao.QuestWorldMasters.find(function(e){return e.getWorldId()===t})}function T(t){return a.dao.QuestAreaMasters.find(function(e){return e.getAreaId()===t})}function S(t){return a.dao.QuestStageMasters.find(function(e){return e.getStageId()===t})}function R(t){return a.dao.QuestStageMasters.filter(function(e){return e.getWorldId()===t})}function A(t){return a.dao.QuestStageMasters.filter(function(e){return e.getAreaId()===t})}function b(t){var e=A(t);return e=r.sortModels(e,[{getterName:"getStageId"}]),h()[e[0].getReleaseStageId()]}function M(t){var e=T(t);if(!e.getWeekTypes())return!0;var i=e.getWeekTypes().split(","),a=o.getNowWeek();return!!i.find(function(t){return parseInt(t)===a})}function v(t,e,i){var r=[];switch(t){case n.QUEST_TYPE.WORLD:var s=E(e);a.dao.QuestWorldMasters.forEach(function(t){t.getCategory()===s.getCategory()&&r.push(t.getWorldId())});break;case n.QUEST_TYPE.AREA:var c=T(e);a.dao.QuestAreaMasters.forEach(function(t){t.getWorldId()===c.getWorldId()&&r.push(t.getAreaId())});break;case n.QUEST_TYPE.STAGE:var l=S(e);a.dao.QuestStageMasters.forEach(function(t){t.getAreaId()===l.getAreaId()&&r.push(t.getStageId())})}var u=a.dao.userBoosts.filter(function(t){var e=o.parseTimeToYmd(t.getStartDate()),a=o.parseTimeToYmd(o.getNowDateTime());return _.some(i,function(e){return e===t.getBoostType()})&&r.find(function(e){return e===t.getParameter().questId})&&e===a});return{todayUnlockUserBoosts:u,nowUnlockUserBoost:_.find(u,function(t){return o.isRangeOfDate(t.getStartDate(),t.getEndDate())&&t.getParameter().questId===e})}}function P(){var t=o.getNowDateTime();return a.dao.CampaignMasters.filter(function(e){return o.isDateInRange(t,e.getFromDate(),e.getToDate())})}function I(t){return P().filter(function(e){return!!e.getTargetIds().split(",").find(function(e){return parseInt(e)===t})})}e.exports={getWorldMasterMap:function(){return c()},getAreaMasterMap:l,getStageMasterMap:h,createUserStageFlatMap:function(){var t={},e=a.dao[a.USER_QUEST];for(var i in e)t[e[i].getStageId()]=e[i];return t},createReleaseUserStageFlatMap:function(){var t=a.dao.QuestWorldMasters.filter(function(t){var e=a.dao.EventMainMasters.find(function(e){return t.getWorldId()===e.getWorldId()});return!(e&&!p(e.getConditionType(),e.getConditionFrom(),e.getConditionTo()))&&(!t.getFromDate()||t.getFromDate()<=o.getNowDate())&&(!t.getToDate()||o.getNowDate()<=t.getToDate())}),e=[];a.dao.QuestAreaMasters.filter(function(e){return!!t.find(function(t){return t.getWorldId()===e.getWorldId()})&&(!e.getFromDate()||e.getFromDate()<=o.getNowDate())&&(!e.getToDate()||o.getNowDate()<=e.getToDate())&&M(e.getAreaId())}).forEach(function(t){var i=A(t.getAreaId());Array.prototype.push.apply(e,i.filter(function(t){return!!a.dao[a.USER_QUEST].find(function(e){return t.getStageId()===e.getStageId()})}).map(function(t){return t.getStageId()}))});var i=[];a.dao.userBoosts.filter(function(t){return t.getBoostType()===n.BOOST_TYPE.QUEST_UNLOCK&&o.isDateInRange(o.getNowDateTime(),t.getStartDate(),t.getEndDate())}).forEach(function(t){var e=t.getParameter();switch(e.questType){case n.QUEST_TYPE.WORLD:Array.prototype.push.apply(i,R(e.questId).map(function(t){return t.getStageId()}));break;case n.QUEST_TYPE.AREA:Array.prototype.push.apply(i,A(e.questId).map(function(t){return t.getStageId()}));break;case n.QUEST_TYPE.STAGE:i.push(e.stageId)}}),Array.prototype.push.apply(e,i.filter(function(t){return!!a.dao[a.USER_QUEST].find(function(e){return t===e.getStageId()})}));var r={};return e.forEach(function(t){if(!r[t]){var e=a.dao[a.USER_QUEST].find(function(e){return e.getStageId()===t});r[t]=e||new s({stageId:t,todayPlayCount:0,todaySkipCount:0,playCount:0,clearCount:0,isClearMission1:0,isClearMission2:0,isClearMission3:0})}}),r},getUserQuestMapByWorldId:C,getUserQuestDifficultMapByWorldId:f,getQuestMasterMapByWorldId:function(t){for(var e=a.dao.QuestStageMasters.filter(function(e){return e.getWorldId()===t}),i={},n=0;n<e.length;n+=1){var o=e[n].getAreaId();i[o]||(i[o]={});var r=e[n].getStageId();i[o][r]||(i[o][r]=e[n])}return i},getUserStageArrayByWorldCategory:m,getUserWorldArrayByWorldCategory:g,getUserQuestMapByWorldCategory:function(t){for(var e=g(t),i={},a=0;a<e.length;a+=1){var n=e[a].getWorldId();i[n]=C(n)}return i},getAreaProgress:function(t){var e,i=!1,n=!1,o=!1,r=a.dao[a.USER_QUEST].filter(function(e){return e.getQuestAreaMaster().getAreaId()===t}),s=r.length,c=0,l=0;e=s>0;for(var u=0;u<s;u++){var h=r[u];if(0===h.userData.getPlayCount()){i=!0;break}h.userData.getClearCount()>=1&&(l++,3===h.userData.getIsClearMission1()+h.userData.getIsClearMission2()+h.userData.getIsClearMission3()&&c++)}return c===s?o=!0:l===s&&(n=!0),{releasedFlg:e,newFlg:i,clearFlg:n,completeFlg:o}},getStageStatus:function(t){var e=!1,i=!1,a=!1;return 1===t.getIsClearMission1()&&1===t.getIsClearMission2()&&1===t.getIsClearMission3()?a=!0:t.getClearCount()>=1?i=!0:0===t.getPlayCount()&&(e=!0),{newLabel:e,clearLabel:i,completeLabel:a}},getWorldMasterByWorldId:E,getWorldMasterArray:function(t){return a.dao.QuestWorldMasters.filter(function(e){return e.getCategory()===t})},getAreaMasterByAreaId:T,getStageMasterByStageId:S,getAreaMasterByStageId:function(t){return T(a.dao.QuestStageMasters.find(function(e){return e.getStageId()===t}).getAreaId())},getWorldMasterByStageId:function(t){var e=a.dao.QuestStageMasters.find(function(e){return e.getStageId()===t});return a.dao.QuestWorldMasters.find(function(t){return t.getWorldId()===e.getWorldId()})},getDropMasterArrayByStageId:function(t,e,i){var n=_.filter(a.dao.QuestDropMasters,function(e){return e.getStageId()===t});return n&&(i&&(n=_.uniqBy(n,function(t){return""+t.getItemId()+t.getItemType()+t.getExceedLimit()})),e&&(n=r.sortModels(n,[{getterName:"getOrder"}]))),n},getStageMasterArrayByWorldId:R,getStageMasterArrayByAreaId:A,getStageMasterByReleaseAreaId:b,getAreaMasterByReleaseAreaId:function(t){var e=A(t);return e=r.sortModels(e,[{getterName:"getStageId"}]),l()[b(t).getAreaId()]},checkNowWeekByAreaId:M,getNextWeekTypeByAreaId:function(t){var e=T(t),i=o.getNowWeek();if(e.getWeekTypes()){var a=new Array(7);e.getWeekTypes().split(",").forEach(function(t){var e=(parseInt(t)+7-i)%7;a[e]=parseInt(t)});for(var n=0;n<a.length;n+=1)if("number"==typeof a[n])return a[n]}return i},getItemQuestLockMasterByQuestId:function(t){return a.dao.ItemQuestLockMasters.find(function(e){return e.getQuestIds().split(",").find(function(e){return parseInt(e)===t})})},getTodayUnlockUserBoostByQuestId:v,isAreaDifficultByWorldId:function(t,e){return!!a.dao.QuestAreaMasters.find(function(i){return i.getWorldId()===t&&i.getDifficult()===e})},getCampaignMasterArray:P,getCampaignMasterArrayByAreaId:I,getCampaignAPValueByStageId:function(t){var e=null,i=I(S(t).getAreaId()).find(function(t){return 1===t.getCampaignType()});return i&&(e=i.getCampaignValue()),e},getCampaignCategoryObjectByAreaId:function(t){var e=I(t),i=null,a=null,o=null,s=null,c=null,l=0,u=0,h="";for(var d in e)if(e[d].getCampaignType()===n.CAMPAIGN.UNLOCK.CATEGORY)l=parseInt(e[d].getCampaignValue());else if(e[d].getCampaignType()===n.CAMPAIGN.LIMIT_COUNT.CATEGORY)u=parseInt(e[d].getCampaignValue());else{if(e[d].getCampaignValue()<1e3){var p=r.getFractionForLessThanThousand(e[d].getCampaignValue());h=p.numerator+"/"+p.denominator}else h=e[d].getCampaignValue()%1e3==0?parseInt(e[d].getCampaignValue()/1e3)+"\u500d":parseFloat(e[d].getCampaignValue()/1e3).toFixed(1)+"\u500d";switch(e[d].getCampaignType()){case n.CAMPAIGN.AP.CATEGORY:i=h;break;case n.CAMPAIGN.CAHRA_EXP.CATEGORY:a=h;break;case n.CAMPAIGN.DROP.CATEGORY:o=h;break;case n.CAMPAIGN.USER_EXP.CATEGORY:s=h;break;case n.CAMPAIGN.GOLD.CATEGORY:c=h}}return{ap:i,charaExp:a,drop:o,userExp:s,gold:c,unlock:l,limitCount:u}},getCampaignRemainingUnlockCountInfoByWorldId:function(t){var e=f(t,n.QUEST_DIFFICULT.NORMAL.NORMAL),i=Object.keys(e).map(function(t){return parseInt(t)}),a=1;i.forEach(function(t){var e=I(t).find(function(t){return t.getCampaignType()===n.CAMPAIGN.UNLOCK.CATEGORY});if(e){var i=parseInt(e.getCampaignValue());a<i&&(a=i)}});var o=0;return i.forEach(function(t){var e=v(n.QUEST_TYPE.AREA,t,[n.BOOST_TYPE.QUEST_UNLOCK,n.BOOST_TYPE.QUEST_LIMITED_UNLOCK]);o=a<=e.todayUnlockUserBoosts.length?a:e.todayUnlockUserBoosts.length}),{MaxUnlockCount:a,MaxTodayUnlockCount:o}},convertWeekIntToString:function(t){switch(t){case 0:return"\u65e5";case 1:return"\u6708";case 2:return"\u706b";case 3:return"\u6c34";case 4:return"\u6728";case 5:return"\u91d1";case 6:return"\u571f"}},getStageCountByWorldIdAndDifficult:function(t,e){var i=R(t);return(i=i.filter(function(t){return T(t.getAreaId()).getDifficult()===e})).length},getUserStageClearCountByWorldIdAndDifficult:function(t,e){return a.dao[a.USER_QUEST].filter(function(i){return i.getQuestStageMaster().getWorldId()===t&&i.getAreaDifficult()===e&&i.getClearCount()>0}).length},getTodayUserStageClearCountByWorldId:function(t){var e=C(t),i=0;return Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(a){i+=e[t][a].getTodayPlayCount()})}),i},getTodayActiveUserBoostCountByWorldId:function(t){var e=C(t),i=0;return Object.keys(e).forEach(function(t){v(n.QUEST_TYPE.AREA,parseInt(t),[n.BOOST_TYPE.QUEST_UNLOCK,n.BOOST_TYPE.QUEST_LIMITED_UNLOCK]).nowUnlockUserBoost&&(i+=1)}),i}},cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",QuestModel:"QuestModel",Singleton:"Singleton",TimeUtils:"TimeUtils"}],QuestViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"456c8mkS4dFKKy8vEDgzuaI","QuestViewSetting");var a=t("QuestRootUtils");e.exports={QUEST_SETTING:{QuestTopSubRoot:{open:a.openWorldView,close:a.closeWorldView},BattleStartConfirmSubRoot:{open:a.openBattleStartConfirmSubRoot,close:a.closeBattleStartConfirmSubRoot},QuestEventSelectSubRoot:{open:a.openQuestEventSelectSubRoot,close:a.closeQuestEventSelectSubRoot}}},cc._RF.pop()},{QuestRootUtils:"QuestRootUtils"}],QuestWorldModel:[function(t,e,i){"use strict";cc._RF.push(e,"cc45bLMeH5KsKC+sChtNfME","QuestWorldModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getWorldId:function(){if(this._isKeyFieldAvailable("worldId"))return this._data.worldId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: worldId")},getCategory:function(){if(this._isKeyFieldAvailable("category"))return this._data.category;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: category")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getImageName:function(){if(this._isKeyFieldAvailable("imageName"))return this._data.imageName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: imageName")},getMaxBattleCount:function(){if(this._isKeyFieldAvailable("maxBattleCount"))return this._data.maxBattleCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxBattleCount")},getRewardItemType:function(){if(this._isKeyFieldAvailable("rewardItemType"))return this._data.rewardItemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemType")},getRewardItemId:function(){if(this._isKeyFieldAvailable("rewardItemId"))return this._data.rewardItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemId")},getRewardItemCount:function(){if(this._isKeyFieldAvailable("rewardItemCount"))return this._data.rewardItemCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardItemCount")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],QuestWorldSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"e2861kLWc5ITYm4BOQn87yG","QuestWorldSelectSubRoot");var a=t("WindowBase"),n=(t("CommonButton"),t("QuestUtils")),o=t("GameConst"),r=t("WorldPageScrollView");cc.Class({extends:a,properties:{worldPageScrollView:r},_root:null,initQuestWorldSelectSubRoot:function(t){this._root=t,this._root.redrawBackGround(o.DEFAULT_QUEST_BG);var e=n.getWorldMasterArray(o.WORLD_CATEGORY.NORMAL),i=n.getUserQuestMapByWorldCategory(o.WORLD_CATEGORY.NORMAL),a=[],r=[];Object.keys(e).forEach(function(t){r.push(parseInt(e[t].getWorldId()))}),Object.keys(i).forEach(function(t){a.push(parseInt(t))}),this.worldPageScrollView.initWorldPageScrollView(t,this,r,a),this._initTags()},_initTags:function(){this.worldPageScrollView.initTags()}}),cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",QuestUtils:"QuestUtils",WindowBase:"WindowBase",WorldPageScrollView:"WorldPageScrollView"}],QuestionnaireAnswerButtonThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"9cf51T7X8pOx7xDZAE9RYxn","QuestionnaireAnswerButtonThumbnail");var a=t("CommonButton"),n=t("QuestionnaireConst");cc.Class({extends:cc.Component,properties:{answerBtn:a},_root:null,_main:void 0,_inputThumbnailArray:null,onLoad:function(){this.answerBtn.setTapEvent(function(){var t=this._checkAnswer();t?this._root.openInputConfirmPopup(t):this._requestAnswer()}.bind(this))},initQuestionnaireAnswerButtonThumbnail:function(t,e,i,a){this._root=t,this._main=e,this._inputThumbnailArray=a},_checkAnswer:function(){for(var t=0;t<this._inputThumbnailArray.length;t+=1){var e=this._inputThumbnailArray[t].getInputInfo(),i=_.trimEnd(e.content.text,"\uff0a");switch(e.content.inputType){case n.QUESTIONNAIRE_INPUT_TYPE.TEXT:if(e.content.isRequired&&_.isEmpty(e.inputText))return"\u300c"+i+"\u300d\u304c\u672a\u5165\u529b\u3067\u3059\u3002";if(_.size(_.toString(e.inputText))>e.inputTextMaxLength)return"\u300c"+i+"\u300d\u304c"+e.inputTextMaxLength+"\u6587\u5b57\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002";break;case n.QUESTIONNAIRE_INPUT_TYPE.RADIO:if(e.content.isRequired&&e.inputRadioIndex<=-1)return"\u300c"+i+"\u300d\u304c\u672a\u9078\u629e\u3067\u3059\u3002"}}return null},_requestAnswer:function(){for(var t=[],e=0;e<this._inputThumbnailArray.length;e+=1){var i=this._inputThumbnailArray[e].getInputInfo();switch(i.content.inputType){case n.QUESTIONNAIRE_INPUT_TYPE.TEXT:t.push({contentId:i.content.contentId,select:i.inputText});break;case n.QUESTIONNAIRE_INPUT_TYPE.RADIO:t.push({contentId:i.content.contentId,select:i.inputRadioIndex})}}this._root.requestAnswer(this._main.listId,t)}});cc._RF.pop()},{CommonButton:"CommonButton",QuestionnaireConst:"QuestionnaireConst"}],QuestionnaireApis:[function(t,e,i){"use strict";cc._RF.push(e,"b65c40AEpJOFolBpKsXGxTi","QuestionnaireApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.QUESTIONNAIRE_GET_LIST,path:"questionnaire/getQuestionnaireList",method:"POST"}),a.RESTClient.graft({name:n.QUESTIONNAIRE_ANSWER,path:"questionnaire/answer",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],QuestionnaireConst:[function(t,e,i){"use strict";cc._RF.push(e,"1963auhLhxJ47X+UDzmM5aD","QuestionnaireConst");cc.Class({statics:{QUESTIONNAIRE_INPUT_TYPE:cc.Enum({TEXT:1,RADIO:2})}});cc._RF.pop()},{}],QuestionnaireInputConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"8aec0uulqJByYRpQovzLiTJ","QuestionnaireInputConfirmPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{msgLabel:cc.Label,okBtn:n},openQuestionnaireInputConfirmPopup:function(t){this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.msgLabel.string=t,this.open()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],QuestionnaireInputThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"3a2f4T+Y8ZF+ZbXvjGIJNhQ","QuestionnaireInputThumbnail");var a=t("GameConst"),n=t("QuestionnaireConst");cc.Class({extends:cc.Component,properties:{questionRichText:cc.RichText,inputTextNode:cc.Node,inputTextEditBox:cc.EditBox,inputToggleContainer:cc.ToggleContainer,inputRadioNode:cc.Node,inputRadioPrefab:cc.Prefab,grayOutNode:cc.Node},_root:null,_content:void 0,initQuestionnaireInputThumbnail:function(t,e,i){switch(this._root=t,this._content=e,this._addQuestionText(e),this.inputTextNode.active=!1,this.inputRadioNode.active=!1,e.inputType){case n.QUESTIONNAIRE_INPUT_TYPE.TEXT:this._addInputText(e,i),this.inputTextNode.active=!0;break;case n.QUESTIONNAIRE_INPUT_TYPE.RADIO:this._addInputRadio(e,i),this.inputRadioNode.active=!0}i?(this.grayOutNode.active=!0,this.node.on(cc.Node.EventType.SIZE_CHANGED,function(){this.grayOutNode.setContentSize(this.node.getContentSize())}.bind(this),this)):this.grayOutNode.active=!1},getInputInfo:function(){return{inputRadioIndex:_.findIndex(this.inputToggleContainer.toggleItems,"isChecked"),inputText:this.inputTextEditBox.string,inputTextMaxLength:this.inputTextEditBox.maxLength,content:this._content}},_addQuestionText:function(t){var e=a.RICH_TEXT_TAG_STATE.BLUE.START+t.text;t.inputType===n.QUESTIONNAIRE_INPUT_TYPE.TEXT&&(e+="("+this.inputTextEditBox.maxLength+"\u6587\u5b57)"),e+=a.RICH_TEXT_TAG_STATE.BLUE.END,t.isRequired&&(e+=a.RICH_TEXT_TAG_STATE.RED.START+"\uff0a"+a.RICH_TEXT_TAG_STATE.RED.END),this.questionRichText.string=e},_addInputText:function(t,e){e?this.inputTextEditBox.string=e.select:this.inputTextEditBox.placeholder=t.select+"("+this.inputTextEditBox.maxLength+"\u6587\u5b57)"},_addInputRadio:function(t,e){var i=_.split(t.select,",");this.inputToggleContainer.enabled=!1,_.forEach(i,function(t,i){var a=cc.instantiate(this.inputRadioPrefab).getComponent("QuestionnaireRadioButton");a.initQuestionnaireRadioButton(t,this.inputToggleContainer),e?a.setChecked(_.toInteger(e.select)===i):a.setChecked(!1),this.inputRadioNode.addChild(a.node)}.bind(this))}});cc._RF.pop()},{GameConst:"GameConst",QuestionnaireConst:"QuestionnaireConst"}],QuestionnaireListView:[function(t,e,i){"use strict";cc._RF.push(e,"3c6cbjDYTpAPpM+ncApU1Qb","QuestionnaireListView");var a=t("CommonScrollView");cc.Class({extends:cc.Component,properties:{commonScrollView:a,titleThumbnail:cc.Prefab,inputThumbnail:cc.Prefab,answerBtnThumbnail:cc.Prefab},_root:null,_inputThumbnailArray:null,initQuestionnaireListView:function(t,e){this._root=t,this.commonScrollView.content.destroyAllChildren(),this.commonScrollView.scrollToTop(),this._addTitleThumbnail(e),this._addInputThumbnail(e),this._addAnswerBtnThumbnail(e)},_addTitleThumbnail:function(t){var e=cc.instantiate(this.titleThumbnail).getComponent("QuestionnaireTitleThumbnail");e.initQuestionnaireTitleThumbnail(this._root,t.main,t.histories),this.commonScrollView.content.addChild(e.node)},_addInputThumbnail:function(t){this._inputThumbnailArray=[],_.forEach(t.contents,function(e){var i=_.find(t.histories,function(i){return i.listId===t.main.listId&&i.contentId===e.contentId}),a=cc.instantiate(this.inputThumbnail).getComponent("QuestionnaireInputThumbnail");a.initQuestionnaireInputThumbnail(this._root,e,i),this.commonScrollView.content.addChild(a.node),this._inputThumbnailArray.push(a)}.bind(this))},_addAnswerBtnThumbnail:function(t){if(!(t.histories&&t.histories.length>0)){var e=cc.instantiate(this.answerBtnThumbnail).getComponent("QuestionnaireAnswerButtonThumbnail");e.initQuestionnaireAnswerButtonThumbnail(this._root,t.main,t.contents,this._inputThumbnailArray),this.commonScrollView.content.addChild(e.node)}}});cc._RF.pop()},{CommonScrollView:"CommonScrollView"}],QuestionnaireRadioButton:[function(t,e,i){"use strict";cc._RF.push(e,"e3379ucOOVGUayxjO/W+Vlj","QuestionnaireRadioButton");cc.Class({extends:cc.Toggle,properties:{radioLabel:cc.Label},initQuestionnaireRadioButton:function(t,e){t?(this.radioLabel.string=t,this.radioLabel.node.active=!0):this.radioLabel.node.active=!1,this.node.once("click",function(){e.enabled=!0},this)},setChecked:function(t){this.isChecked=t}});cc._RF.pop()},{}],QuestionnaireRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"7c58fZn3OVNN6AoYvsOkh3u","QuestionnaireRootUtils");var a=t("QuestionnaireSubRoot");e.exports={openQuestionnaireSubRoot:function(t,e){cc.log("openQuestionnaireSubRoot"),cc.log(e),t.questionnaireSubRoot?cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(t.questionnaireSubRoot=cc.instantiate(t.questionnaireSubRootPrefab).getComponent(a),t.questionnaireSubRoot.initQuestionnaireSubRoot(t),t.subRootParent.addChild(t.questionnaireSubRoot.node))},closeQuestionnaireSubRoot:function(t,e){cc.log("closeQuestionnaireSubRoot"),cc.log(e),t.questionnaireSubRoot||(t.questionnaireSubRoot.node.destroy(),t.questionnaireSubRoot=null)}},cc._RF.pop()},{QuestionnaireSubRoot:"QuestionnaireSubRoot"}],QuestionnaireRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ea172Jo4FtD+phnCjcUNbW0","QuestionnaireRoot");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("QuestionnaireViewSetting"),r=t("MatrixThumbnailUtils"),s=t("ItemUtils");cc.Class({extends:a,properties:{questionnaireSubRootPrefab:cc.Prefab,questionnaireThumbnailTextPopupPrefab:cc.Prefab,questionnaireInputConfirmPopupPrefab:cc.Prefab},_questionnaireArray:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,o.QUESTIONNAIRE_SETTING)},redraw:function(){this.redrawUIHeader(),this.questionnaireSubRoot&&this.questionnaireSubRoot.redrawQuestionnaireSubRoot(this)},initData:function(){this.requestURLCount+=1,n.QuestionnaireService.getQuestionnaireList(function(t){this._questionnaireArray=t.questionnaire,this.requestURLCount-=1}.bind(this))},initialize:function(){this.initOutGameRootBase();this._initOpenFirstView({QuestionnaireSubRoot:{}})},getQuestionnaireArray:function(){return this._questionnaireArray},requestAnswer:function(t,e){n.QuestionnaireService.answer(t,e,function(e){this.openRewardPopup(t),this._questionnaireArray=e.questionnaire,this.redraw()}.bind(this))},openRewardPopup:function(t){this.closeRewardPopup();var e=_.find(this._questionnaireArray,function(e){return e.main.listId===t}),i=r.createMatrixThumbnailByItemType(e.main.itemId,e.main.itemType,{prefix:"x",count:e.main.count}),a=s.getItemInfo(e.main.itemType,e.main.itemId).name;this._rewardPopup=cc.instantiate(this.questionnaireThumbnailTextPopupPrefab).getComponent("ThumbnailTextPopup"),this._rewardPopup.openThumbnailTextPopup(i.node,"",a+"x"+e.main.count+"\u3092\u53d7\u3051\u53d6\u308a\u307e\u3057\u305f",function(){},void 0,"OK",void 0)},closeRewardPopup:function(){this._rewardPopup&&(this._rewardPopup.close(),this._rewardPopup=null)},openInputConfirmPopup:function(t){this.closeInputConfirmPopup(),this._inputConfirmPopup=cc.instantiate(this.questionnaireInputConfirmPopupPrefab).getComponent("QuestionnaireInputConfirmPopup"),this._inputConfirmPopup.openQuestionnaireInputConfirmPopup(t)},closeInputConfirmPopup:function(){this._inputConfirmPopup&&(this._inputConfirmPopup.close(),this._inputConfirmPopup=null)}});cc._RF.pop()},{ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",OutGameRootBase:"OutGameRootBase",QuestionnaireViewSetting:"QuestionnaireViewSetting",Singleton:"Singleton"}],QuestionnaireService:[function(t,e,i){"use strict";cc._RF.push(e,"1eb3fmpKYlAuZf2HBP2JqEX","QuestionnaireService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getQuestionnaireList:function(t){this._requestCallApi(n.QUESTIONNAIRE_GET_LIST,{},function(e,i){return t(e?void 0:i)})},answer:function(t,e,i){var a={listId:t,input:e};this._requestCallApi(n.QUESTIONNAIRE_ANSWER,a,function(t,e){return i(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],QuestionnaireSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"2fc531ucwlHybhACktFL8VH","QuestionnaireSubRoot");var a=t("QuestionnaireTabView");cc.Class({extends:cc.Component,properties:{questionnaireTabView:a},_root:null,initQuestionnaireSubRoot:function(t){cc.log("QuestionnaireSubRoot"),this._root=t,this.questionnaireTabView.initQuestionnaireTabView(this._root,0)},redrawQuestionnaireSubRoot:function(t){this._root=t,this.questionnaireTabView.redrawQuestionnaireTabView(this._root)}}),cc._RF.pop()},{QuestionnaireTabView:"QuestionnaireTabView"}],QuestionnaireTabButton:[function(t,e,i){"use strict";cc._RF.push(e,"863166dBJpJZI2A6suZc+eZ","QuestionnaireTabButton");var a=t("TabButton");cc.Class({extends:a,properties:{answeredActiveNode:cc.Node,answeredInActiveNode:cc.Node},setAnswered:function(t){this.answeredActiveNode.active=t,this.answeredInActiveNode.active=t}});cc._RF.pop()},{TabButton:"TabButton"}],QuestionnaireTabView:[function(t,e,i){"use strict";cc._RF.push(e,"2b85bvBzY5NdbGXTRXzWDIs","QuestionnaireTabView");var a=t("VariableTabViewBase"),n=t("QuestionnaireListView");cc.Class({extends:a,properties:{emptyDisplayNode:cc.Node,tabParentScrollView:cc.ScrollView,questionnaireListView:n},_root:null,_questionnaireTabMap:null,onLoad:function(){},initQuestionnaireTabView:function(t,e){this._root=t,this._createQuestionnaireTabMap(this._root.getQuestionnaireArray());var i=this._createTabButtons(this._questionnaireTabMap);this.initVariableTabViewBase(t,i),this._resetSelectedTab(),this._setCurrentTab(_.toInteger(e)),this._activateTab(this.getCurrentTab())},redrawQuestionnaireTabView:function(t){this.initQuestionnaireTabView(t,this.getCurrentTab())},_createQuestionnaireTabMap:function(t){var e=_.sortBy(t,[function(t){return t.main.listId}]);this._questionnaireTabMap=_.zipObject(_.times(e.length),e)},_createTabButtons:function(t){for(var e=[],i=_.size(t),a=0;a<i;a+=1){var n=cc.instantiate(this.getTabButtonPrefab(a,_.size(t))).getComponent("QuestionnaireTabButton");e.push(n),n.initTabButton(t[a].main.name,!0),this.setTabBtn(n,a),n.setAnswered(t[a].histories&&t[a].histories.length>0)}return e},_resetSelectedTab:function(){for(var t=0;t<this.tabBtnArray.length;t+=1)this.tabBtnArray[t].switchBtnImage(!1)},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t]?(this.emptyDisplayNode.active=!1,this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)):this.emptyDisplayNode.active=!0},_switchTabContent:function(t){this.questionnaireListView.initQuestionnaireListView(this._root,this._questionnaireTabMap[t])}});cc._RF.pop()},{QuestionnaireListView:"QuestionnaireListView",VariableTabViewBase:"VariableTabViewBase"}],QuestionnaireTitleThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"6671bOVYDJHJpzzJ6Duc//M","QuestionnaireTitleThumbnail");var a=t("EventUtils");cc.Class({extends:cc.Component,properties:{titleLabel:cc.Label,noticeNode:cc.Node,answeredNode:cc.Node},_root:null,initQuestionnaireTitleThumbnail:function(t,e,i){if(this._root=t,this.titleLabel.string=e.name,e.eventId){var n=a.getEventMainMaterByEventId(e.eventId);n&&(this.titleLabel.string=n.getName())}var o=i&&i.length>0;this.noticeNode.active=!o,this.answeredNode.active=o}});cc._RF.pop()},{EventUtils:"EventUtils"}],QuestionnaireViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"7fd5aA24PlIPbNej7SWhWnN","QuestionnaireViewSetting");var a=t("QuestionnaireRootUtils");e.exports={QUESTIONNAIRE_SETTING:{QuestionnaireSubRoot:{open:a.openQuestionnaireSubRoot,close:a.closeQuestionnaireSubRoot}}},cc._RF.pop()},{QuestionnaireRootUtils:"QuestionnaireRootUtils"}],RESTClient:[function(t,e,i){"use strict";cc._RF.push(e,"af57bo5QjNKLJTYMgHgNcZZ","RESTClient");var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=t("Http"),o=t("ErrorCode"),r=t("SingletonConst"),s=t("Singleton"),c=t("LocalDataConst");t("CommonUtils");function l(t,e){return encodeURIComponent(t)+"="+encodeURIComponent(e.toString())}function u(t,e,i,a){t._lockMutex()?("function"==typeof i?i=[a=i]:i[i.length]=a,i[i.length-1]=function(e,i){i&&(void 0===i.result||(i.result,o.SESSION_ERROR)),t._unlockMutex(),a(e,i)},e.apply(t,i)):t._queue.push(function(){u(t,e,i,a)})}function h(){}function d(t){this.rootUrl=t,this._queue=[]}Object.defineProperty(d,"graft",{enumerable:!1,value:function(t){var e=s[r.ERROR_MANAGER],i="_"+t.name+"Impl";this===d?(d.prototype[i]=function(i,l,u){var h=function(t,e){u(t||void 0,e)};"function"==typeof i&&(u=i,i=void 0),"function"==typeof l&&(u=l,"GET"===t.method?l=void 0:(l=i,i=void 0));var d,p=s[r.OAUTH],m=s[r.ENVIRONMENT].getApiPrefix()+t.path,_=this._prepareUrl(m,i),g={masterVersion:s.localData[c.USER_VERSION].masterVersion,webVersion:s.localData[c.USER_VERSION].webVersion,apkVersion:s.localData[c.USER_VERSION].apkVersion,apkHotUpdateVersion:s.localData[c.USER_VERSION].apkHotUpdateVersion};return"GET"===t.method?((d={authorization:p.getAuthorization(t.method,_)})["x-deep-one-app-version"]=JSON.stringify(g),"binary"===t.type?n.httpGetBinary(_,d,h):n.httpGetJson(_,d,h)):"POST"===t.method?("object"===(void 0===l?"undefined":a(l))&&(l=JSON.stringify(l)),(d={authorization:p.getAuthorization(t.method,_)})["x-deep-one-app-version"]=JSON.stringify(g),n.httpPostJson(_,l,d,h)):void e.throwError(o.API_METHOD_NOT_SUPPORTED,void 0,void 0,"Unsupported API method: "+t.method)},d.prototype[t.name]=function(){var e,a,n=[],o=this,r=arguments;for(a in arguments)arguments.hasOwnProperty(a)&&(n[a]=arguments[a]);e=n.pop(),u(this,this[i],n,function(i,a){if(e=e||h,i)return i.retryAPI=function(){o[t.name].apply(o,r)},i.api={name:t.name,path:t.path},void e(i);t.postProcess?t.postProcess.call(o,a,e):e(void 0,a)})}):e.throwError(o.TYPE_ERROR,void 0,void 0,"You may only graft to the RESTClient class, not instances")}}),d.prototype={_mutex:void 0,_prepareUrl:function(t,e){var i,a=this.rootUrl+"/"+t;if(e)for(i=0;i<e.length;i+=1)a+=0===i?"?":"&",a+=l(e[i].key,e[i].value);return a},_lockMutex:function(){return!this._mutex&&(this._mutex=s[r.SCHEDULER].setTimeout(this._unlockMutex.bind(this),45e3),!0)},_unlockMutex:function(){var t;this._mutex&&(s[r.SCHEDULER].clearTimeout(this._mutex),this._mutex=void 0,(t=this._queue.shift())&&t())}},e.exports={RESTClient:d},cc._RF.pop()},{CommonUtils:"CommonUtils",ErrorCode:"ErrorCode",Http:"Http",LocalDataConst:"LocalDataConst",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RaidApis:[function(t,e,i){"use strict";cc._RF.push(e,"41f57V0fUZODphUPqAtxvCf","RaidApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.RAID_GET_MASTER_DATA,path:"raid/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.RAID_GET_LIST,path:"raid/getList",method:"POST"}),a.RESTClient.graft({name:n.RAID_GET_DETAIL,path:"raid/getDetail",method:"POST"}),a.RESTClient.graft({name:n.RAID_SEND_RESCUE,path:"raid/sendRescue",method:"POST"}),a.RESTClient.graft({name:n.RAID_APPEAR_BATTLE,path:"raid/appearBattle",method:"POST"}),a.RESTClient.graft({name:n.RAID_START_BATTLE,path:"raid/startBattle",method:"POST"}),a.RESTClient.graft({name:n.RAID_END_BATTLE,path:"raid/endBattle",method:"POST"}),a.RESTClient.graft({name:n.RAID_RECEIVE_RESULT,path:"raid/receiveResult",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],RaidBattleAppearView:[function(t,e,i){"use strict";cc._RF.push(e,"63b96gyn1lEbY3og4wF4+vd","RaidBattleAppearView");var a=t("WindowBase"),n=t("CommonUtils"),o=t("CommonButton"),r=t("ItemConst"),s=t("ResourceUtils"),c=t("RaidUtils"),l=t("EventUtils"),u=t("ItemUtils"),h=t("BPProgressView");cc.Class({extends:a,properties:{isFinishedDispNode:cc.Node,isEntryDispNode:cc.Node,isRescueDispNode:cc.Node,bossImageSprite:cc.Sprite,eventPointImageSprite:cc.Sprite,eventPointCountLabel:cc.Label,bpProgressView:h,raidBattleBtn:o},_eventId:0,_raidBattleList:null,_preSceneName:null,_preViewParam:null,onLoad:function(){this.raidBattleBtn.setTapEvent(this._onTapRaidBattleBtn.bind(this));var t=cc.sequence(cc.delayTime(1),cc.callFunc(this.redraw.bind(this))),e=cc.repeatForever(t);this.node.runAction(e)},_onTapRaidBattleBtn:function(){var t={RaidBattleSelectSubRoot:{tabIndex:0}};c.getFinishedRaidBattleSessions(this._raidBattleList.getEntryRaidBattleSessions()).length>0?t.RaidBattleSelectSubRoot.tabIndex=2:this._raidBattleList.getEntryRaidBattleSessions().length>0&&(t.RaidBattleSelectSubRoot.tabIndex=1),n.getRoot().pushScene("RaidScene",this._preSceneName,t,this._preViewParam)},initRaidBattleAppearView:function(t,e,i,a){this._eventId=t,this._raidBattleList=e,this._preSceneName=i,this._preViewParam=a,this._drawBoss(),this._drawRaidBattleState(),this._drawRaidChallengeItem(),this.redraw()},redraw:function(){this.bpProgressView.redraw()},_drawBoss:function(){var t=l.getEventMainMasterMap()[this._eventId];s.addSprite(this.bossImageSprite,s.getFileNameWorldSmallThumbnail(t.getWorldId()))},_drawRaidChallengeItem:function(){s.addSprite(this.eventPointImageSprite,s.getFileNameItemImage(r.RAID_CHALLENGE_ITEM)),this.eventPointCountLabel.string=n.convertToCommaDelimited(u.getUserItemCount(r.RAID_CHALLENGE_ITEM))},_drawRaidBattleState:function(){this.isFinishedDispNode.active=!1,this.isEntryDispNode.active=!1,this.isRescueDispNode.active=!1,c.getFinishedRaidBattleSessions(this._raidBattleList.getEntryRaidBattleSessions()).length>0?this.isFinishedDispNode.active=!0:this._raidBattleList.getEntryRaidBattleSessions().length>0?this.isEntryDispNode.active=!0:this._raidBattleList.getPublicRaidBattleSessions().length>0&&(this.isRescueDispNode.active=!0)}});cc._RF.pop()},{BPProgressView:"BPProgressView",CommonButton:"CommonButton",CommonUtils:"CommonUtils",EventUtils:"EventUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",RaidUtils:"RaidUtils",ResourceUtils:"ResourceUtils",WindowBase:"WindowBase"}],RaidBattleBossUnit:[function(t,e,i){"use strict";cc._RF.push(e,"30672z9Tq5D3JwbwH/8raKq","RaidBattleBossUnit");var a=t("BattleBossUnit"),n=t("BattleConstants"),o=t("BattleData"),r=cc.Class({extends:a,properties:{_continueHp:0,continueHp:{get:function(){return this._continueHp},set:function(t){this._continueHp=parseInt(t)}}},ctor:function(){this.continueHp=o.raidBattleSession.bossHp,this.curHp=o.raidBattleSession.bossHp},isWaittingRage:function(){return this.curHp/this.continueHp<n.RAGE_MODE_RATIO&&!this.isRageMode}});e.exports=r,cc._RF.pop()},{BattleBossUnit:"BattleBossUnit",BattleConstants:"BattleConstants",BattleData:"BattleData"}],RaidBattleDetailConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"67b418/RmZLLY9qPMQLNRgX","RaidBattleDetailConfirmPopup");var a=t("RaidBattleDetailPopupBase");cc.Class({extends:a,properties:{},openRaidBattleDetailConfirmPopup:function(t,e,i,a,n,o,r){this._openRaidBattleDetailPopupBase(t,e,i,a,n,o,r)},_updateThumbnailParameter:function(t,e){t.setNumberingRank(e)}});cc._RF.pop()},{RaidBattleDetailPopupBase:"RaidBattleDetailPopupBase"}],RaidBattleDetailPopupBase:[function(t,e,i){"use strict";cc._RF.push(e,"421c31aeexGiJrZNTnxBEBd","RaidBattleDetailPopupBase");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=t("Singleton"),s=t("ResourceUtils"),c=t("TimeUtils"),l=(t("RaidUtils"),t("QuestUtils")),u=t("RaidBattleThumbnail");cc.Class({extends:a,properties:{titleLabel:cc.Label,raidBattleThumbnail:u,thumbnailPrefab:cc.Prefab,scrollView:o,okBtn:n},_openRaidBattleDetailPopupBase:function(t,e,i,a,n,o,r){this.titleLabel.string=t,this._drawHeader(e,a,n),this.setCloseCallBack(r),this.okBtn.setTapEvent(this.close.bind(this)),this.open(function(){this._drawContent(e,i,o)}.bind(this))},_drawHeader:function(t,e,i){var a=this.raidBattleThumbnail;a.setMainImage(s.getFileNameAreaThumbnail(e.getAreaId())),a.setEnemyName(e.getName()),parseInt(c.getNowDateTime())<parseInt(t.endDate)?(a.setRemainTime(c.getDiffHms(t.endDate)),a.schedule(function(){a.setRemainTime(c.getDiffHms(t.endDate))},1)):a.setRemainTime("0:00:00"),a.setEntryCount(t.entryCount,i.getMaxUserCount());var n=l.getAreaMasterByStageId(t.stageId);a.setDifficult(n.getDifficult(),n.getName()),a.setAttributeImage(s.getFileNameAreaImage(n.getAreaId())),a.setHpProgress(Math.max(t.bossHp,0),t.bossMaxHp);var o=t.damageRanking.find(function(t){return!!t.users.find(function(t){return t===r.dao[r.USER].getUserCd()})});a.setPlayerTotalDamage(o?o.score:0)},_findUserDetail:function(t,e){return t.find(function(t){return t.userCd===e})},_drawContent:function(t,e,i){this.scrollView.content.destroyAllChildren(),i=i>0&&i<=t.damageRanking.length?i:t.damageRanking.length;for(var a=1,n=0;n<i;n+=1){for(var o=0;o<t.damageRanking[n].users.length;o+=1){var r=cc.instantiate(this.thumbnailPrefab).getComponent("RaidRankingPlayerThumbnail"),s=this._findUserDetail(e,t.damageRanking[n].users[o]);this._addThumbnail(r,s,t.damageRanking[n]),this._updateThumbnailParameter(r,a)}a+=1}},_addThumbnail:function(t,e,i){t.setPartnerImage(s.getFileNameCharacterThumbnail(e.partnerId)),t.setPlayerName(e.name),t.setPlayerLevel(e.level),t.setPlayerTotalDamage(i.score),this.scrollView.content.addChild(t.node)},_updateThumbnailParameter:function(t,e){cc.warn("_updateThumbnailParameter(thumbnail, rank) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",PopupBase:"PopupBase",QuestUtils:"QuestUtils",RaidBattleThumbnail:"RaidBattleThumbnail",RaidUtils:"RaidUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],RaidBattleListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"320bdObumJIn5LYAaof4nn0","RaidBattleListViewBase");var a=t("ListViewBase"),n=(t("CommonScrollView"),t("ResourceUtils")),o=t("QuestUtils"),r=(t("RaidUtils"),t("TimeUtils"));cc.Class({extends:a,properties:{emptyLabel:cc.Label},_root:null,_getBattleSessions:function(t){return cc.error("_getBattleSessions(root)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),t.getCurrentRaidBattleList().getPublicRaidBattleSessions()},_setListContent:function(t){var e=this._getBattleSessions(t);for(var i in e)this._addThumbnail(e[i]);this.emptyLabel.node.parent.active=e.length<=0,this.emptyLabel.string=this._getEmptyText()},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("RaidBattleThumbnail");e.setDiscovererName(t.discovererName),parseInt(r.getNowDateTime())<parseInt(t.endDate)?(e.setRemainTime(r.getDiffHms(t.endDate)),e.schedule(function(){e.setRemainTime(r.getDiffHms(t.endDate))},1)):e.setRemainTime("0:00:00");var i=this._root.getStageMasterFlatMap()[t.stageId];e.setMainImage(n.getFileNameAreaThumbnail(i.getAreaId())),e.setEnemyName(i.getName());var a=this._root.getRaidBattleMasterMap()[i.getStageId()],s=this._root.getRaidBattleTypeMasterMap()[a.getRaidBattleType()];e.setEntryCount(t.entryCount,s.getMaxUserCount());var c=o.getAreaMasterByStageId(t.stageId);e.setDifficult(c.getDifficult(),c.getName()),e.setAttributeImage(n.getFileNameAreaImage(c.getAreaId())),e.setHpProgress(Math.max(t.bossHp,0),t.bossMaxHp),e=this._addThumbnailParameter(e,t),this.thumbnailParentNode.addChild(e.node)},_addThumbnailParameter:function(t,e){return cc.error("_addThumbnailParameter(thumbnail, raidBattleSession) \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),t},_getEmptyText:function(){return cc.warn("_getEmptyText() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),"\u3042\u308a\u307e\u305b\u3093"}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",ListViewBase:"ListViewBase",QuestUtils:"QuestUtils",RaidUtils:"RaidUtils",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils"}],RaidBattleModel:[function(t,e,i){"use strict";cc._RF.push(e,"8cde8EijaZAqrYGqBBExbin","RaidBattleModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getRaidBattleType:function(){if(this._isKeyFieldAvailable("raidBattleType"))return this._data.raidBattleType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: raidBattleType")},getBattlePoint:function(){if(this._isKeyFieldAvailable("battlePoint"))return this._data.battlePoint;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: battlePoint")},getAppearCostItemType:function(){if(this._isKeyFieldAvailable("appearCostItemType"))return this._data.appearCostItemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: appearCostItemType")},getAppearCostItemId:function(){if(this._isKeyFieldAvailable("appearCostItemId"))return this._data.appearCostItemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: appearCostItemId")},getAppearCostItemCount:function(){if(this._isKeyFieldAvailable("appearCostItemCount"))return this._data.appearCostItemCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: appearCostItemCount")},getRewardId:function(){if(this._isKeyFieldAvailable("rewardId"))return this._data.rewardId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RaidBattleSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"052d5DjARlKbKcEtNl3nDB7","RaidBattleSelectSubRoot");var a=t("WindowBase"),n=t("CommonButton"),o=t("TimeUtils"),r=t("RaidBattleSelectTabView");cc.Class({extends:a,properties:{raidBattleSelectTabView:r,topBtn:n,reloadBtn:n,reloadCountDownLabel:cc.Label},_root:null,onLoad:function(){this.topBtn.setTapEvent(this._onTapTopBtn.bind(this)),this.reloadBtn.setTapEvent(this._onTapReloadBtn.bind(this),n.SE_NAME.COUNT)},_onTapTopBtn:function(){this._root.popScene(!0),this._root.pushRaidTopSubRoot()},_onTapReloadBtn:function(){this._root.requestGetList(function(){this._root.reload(),this._root.redraw(),this._executeCountUpSecond(5,function(){this.reloadCountDownLabel.string="5",this.reloadCountDownLabel.node.active=!0,this.reloadBtn.switchBtnImage(!1),this.reloadBtn.setTouchEnable(!1)}.bind(this),function(t){this.reloadCountDownLabel.string=""+(5-t)}.bind(this),function(){this.reloadCountDownLabel.node.active=!1,this.reloadBtn.switchBtnImage(!0),this.reloadBtn.setTouchEnable(!0)}.bind(this))}.bind(this))},initRaidBattleSelectSubRoot:function(t,e){this._root=t,this.raidBattleSelectTabView.initRaidBattleSelectTabView(t,e)},redrawRaidBattleSelectSubRoot:function(){this.raidBattleSelectTabView.initRaidBattleSelectTabView(this._root,this.raidBattleSelectTabView.getCurrentTab())},getCurrentTab:function(){return this.raidBattleSelectTabView.getCurrentTab()},_executeCountUpSecond:function(t,e,i,a){var n=o.getNowCountSeconds(),r=cc.director.getScheduler(),s=this;e(),r.schedule(function e(){var c=Math.floor(o.getNowCountSeconds()-n);t<=c?(a(),r.unschedule(e,s)):i(c)},s,0)}});cc._RF.pop()},{CommonButton:"CommonButton",RaidBattleSelectTabView:"RaidBattleSelectTabView",TimeUtils:"TimeUtils",WindowBase:"WindowBase"}],RaidBattleSelectTabView:[function(t,e,i){"use strict";cc._RF.push(e,"104d5WGsitCO4/mdy7LxzGZ","RaidBattleSelectTabView");var a=t("TabViewBase"),n=t("RaidBattleListViewBase");cc.Class({extends:a,properties:{raidBattleListViewArray:[n]},_root:null,initRaidBattleSelectTabView:function(t,e){this._root=t,this.initTabViewBase(),this._setCurrentTab(e),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetListView(),this.raidBattleListViewArray[t].initListView(this._root)},_resetListView:function(){for(var t in this.raidBattleListViewArray)this.raidBattleListViewArray[t].node.active=!1}});cc._RF.pop()},{RaidBattleListViewBase:"RaidBattleListViewBase",TabViewBase:"TabViewBase"}],RaidBattleStartConfirmSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"245b8O0FfBKIZvX7BPrfpxG","RaidBattleStartConfirmSubRoot");var a=t("BattleStartConfirmSubRootBase"),n=t("CommonButton"),o=t("Singleton"),r=t("TimeUtils"),s=t("ItemUtils"),c=t("CommonUtils"),l=t("PopupUtils"),u=t("MatrixThumbnailUtils"),h=t("GameConst"),d=t("LocalDataConst");cc.Class({extends:a,properties:{appearCostItemParentNode:cc.Node,appearCostItemCountLabel:cc.Label,appearCostItemCurrentLabel:cc.Label,appearCostItemAfterLabel:cc.Label,appearCostPointParentNode:cc.Node,appearCostPointCountLabel:cc.Label,appearCostPointCurrentLabel:cc.Label,appearCostPointAfterLabel:cc.Label,remainTimeLabel:cc.Label,isRescueEnableBtn:n},_stageId:null,_raidBattleMaster:null,_raidBattleSession:null,onLoad:function(){this._super(),this.isRescueEnableBtn.switchBtnImage(c.loadLocalStorage(d.LOCAL_STORAGE_KEY.RAID_SEND_RESCUE_WHEN_APPEAR,!0,d.LOCAL_STORAGE_GET_TYPE.BOOLEAN)),this.isRescueEnableBtn.setTapEvent(this._onTapIsRescueEnableBtn.bind(this))},_onTapIsRescueEnableBtn:function(){this.isRescueEnableBtn.switchBtnImage(!this.isRescueEnableBtn.getBtnImageSwitchState()),c.saveLocalStorage(d.LOCAL_STORAGE_KEY.RAID_SEND_RESCUE_WHEN_APPEAR,this.isRescueEnableBtn.getBtnImageSwitchState())},initBattleStartConfirmSubRoot:function(t,e,i){this._stageId=e,this._raidBattleSession=i,this.isRescueEnableBtn.node.active=!i,this._raidBattleMaster=t.getRaidBattleMasterMap()[e];var a=t.getRaidBattleTypeMasterMap()[this._raidBattleMaster.getRaidBattleType()];this._drawRemainTime(a,i),this._super(t,t.getStageMasterFlatMap()[e])},redraw:function(){this._super(),this._drawCostVariance(this._raidBattleMaster,this._raidBattleSession)},getStageId:function(){return this._stageId},getRaidBattleSession:function(){return this._raidBattleSession},_drawDropItems:function(){this.itemThumbnailParentNode.destroyAllChildren();var t=_.find(o.dao.RaidRewardMasters,function(t){return t.getRewardId()===this._raidBattleMaster.getRewardId()}.bind(this));if(t)for(var e=_.filter(o.dao.RaidRewardGroupMasters,function(e){return e.getRewardGroupId()===t.getNormalRewardGroupId()}),i=0;i<e.length;i+=1){var a=e[i];if(a){var n=u.createMatrixThumbnailByItemType(a.getItemId(),a.getItemType());this.itemThumbnailParentNode.addChild(n.node),n.setCallbackToThumbnailBtn(this._onTapItemThumbnail.bind(this,n.node,a.getItemType(),a.getItemId(),n.node.parent.scale))}}},_openDropInfoPopup:function(){this._closeDropInfoPopup(),this._dropInfoPopup=cc.instantiate(this.dropInfoPopupPrefab).getComponent("QuestDropInfoPopup"),this._dropInfoPopup.openRaidRewardInfoPopup(this._raidBattleMaster.getEventId(),this._raidBattleMaster.getStageId())},_drawRemainTime:function(t,e){e?(this.remainTimeLabel.string=r.getDiffHms(e.endDate),this.schedule(function(){this.remainTimeLabel.string=r.getDiffHms(e.endDate)}.bind(this),1)):this.remainTimeLabel.string=r.parseSecondToHms(t.getAppearancePeriod())},_drawCostVariance:function(t,e){this.appearCostItemParentNode.active=!1,this.appearCostPointParentNode.active=!1,!e&&t.getAppearCostItemCount()>0?this._drawCostItemVariance(t,e):this._drawCostPoiintVariance(t,e)},_drawCostItemVariance:function(t,e){this.appearCostItemParentNode.active=!0,this.appearCostItemCountLabel.string=""+t.getAppearCostItemCount();var i=s.getUserItemCount(t.getAppearCostItemId()),a=i-t.getAppearCostItemCount();if(a>=0)this.appearCostItemAfterLabel.node.color=h.COLOR_STATE.MINUS,this.battleBtn.switchBtnImage(!0),this._aleartFunc=null;else{this.appearCostItemAfterLabel.node.color=h.COLOR_STATE.ALERT,this.battleBtn.switchBtnImage(!1);var n=s.getItemMaster(t.getAppearCostItemId());this._aleartFunc=function(){l.openCommonPopupOk("\u30a2\u30a4\u30c6\u30e0\u78ba\u8a8d","\u51fa\u6483\u306b\u5fc5\u8981\u306a"+n.getName()+"\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002")}}this.appearCostItemCurrentLabel.string=""+i,this.appearCostItemAfterLabel.string=""+a},_drawCostPoiintVariance:function(t,e){this.appearCostPointParentNode.active=!0,this.appearCostPointCountLabel.string=""+t.getBattlePoint();var i=o.dao[o.USER].getCurrentBattlePointInfo(),a=i.currentValue-t.getBattlePoint();a>=0?(this.appearCostPointAfterLabel.node.color=h.COLOR_STATE.MINUS,this.battleBtn.switchBtnImage(!0),this._aleartFunc=null):(this.appearCostPointAfterLabel.node.color=h.COLOR_STATE.ALERT,this.battleBtn.switchBtnImage(!1),this._aleartFunc=function(){l.openCommonPopupOk("BP\u78ba\u8a8d","\u51fa\u6483\u306b\u5fc5\u8981\u306aBP\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002")}),this.appearCostPointCurrentLabel.string=""+i.currentValue,this.appearCostPointAfterLabel.string=""+a},_startBattle:function(){this._aleartFunc?this._aleartFunc():this._raidBattleSession?this._root.requestStartBattle(this._raidBattleSession.sessionId,o.localData[d.SELECT_QUEST_DECK_ORDER]):this._root.requestAppearBattle(this._raidBattleMaster.getEventId(),this._raidBattleMaster.getStageId(),o.localData[d.SELECT_QUEST_DECK_ORDER],this.isRescueEnableBtn.getBtnImageSwitchState()?1:0)}});cc._RF.pop()},{BattleStartConfirmSubRootBase:"BattleStartConfirmSubRootBase",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupUtils:"PopupUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],RaidBattleThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"1a812eiJohCyZOk+FMeQ5RG","RaidBattleThumbnail");var a=t("CommonButton"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("GameConst"),s=t("RaidConst"),c={NORMAL:cc.color(30,53,165,255),HARD:cc.color(125,53,9,255),EX:cc.color(134,19,33,255)};cc.Class({extends:cc.Component,properties:{costItemParentNode:cc.Node,costItemImageSprite:cc.Sprite,costItemCountLabel:cc.Label,costPointParentNode:cc.Node,costPointCountLabel:cc.Label,resultParentNode:cc.Node,resultSuccessDispNode:cc.Node,resultFailureDispNode:cc.Node,difficultBackImageSprite:cc.Sprite,difficultIconImageSprite:cc.Sprite,difficultIconLabel:cc.Label,mainImageSprite:cc.Sprite,attributeImageSprite:cc.Sprite,enemyNameLabel:cc.Label,maxHpLabel:cc.Label,maxEntryCountLabel:cc.Label,publicDispNode:cc.Node,hpProgressBar:cc.ProgressBar,hpLabel:cc.Label,entryCountLabel:cc.Label,remainTimeLabel:cc.Label,discovererNameLabel:cc.Label,playerTotalDamageLabel:cc.Label,rescueBtn:a,startBtn:a,receiveBtn:a,resultBtn:a,infoBtn:a},_entryCount:null,_maxCount:null,setMainImage:function(t){o.addSprite(this.mainImageSprite,t)},setAttributeImage:function(t){o.addSprite(this.attributeImageSprite,t)},setDifficult:function(t,e){o.addSprite(this.difficultBackImageSprite,o.getFileNameDifficultThumbnailBack(t)),o.addSprite(this.difficultIconImageSprite,o.getFileNameDifficultIcon(t)),this.difficultIconLabel.string=e,this.difficultIconLabel.node.getComponent(cc.LabelOutline).color=this._convertDifficultToColor(t)},_convertDifficultToColor:function(t){switch(t){case r.QUEST_DIFFICULT.TOWER.NORMAL:return c.NORMAL;case r.QUEST_DIFFICULT.TOWER.HARD:return c.HARD;case r.QUEST_DIFFICULT.TOWER.EX:return c.EX}return cc.color(0,0,0,255)},setCostItem:function(t,e){this.costPointParentNode.active=!1,this.costItemParentNode.active=!0,o.addSprite(this.costItemImageSprite,t),this.costItemCountLabel.string=""+e},setCostPoint:function(t){this.costItemParentNode.active=!1,this.costPointParentNode.active=!0,this.costPointCountLabel.string=""+t},setHpProgress:function(t,e){this.hpLabel.string=n.convertToCommaDelimited(t),this.maxHpLabel.string=n.convertToCommaDelimited(e),this.hpProgressBar.progress=t/e},setEnemyName:function(t){this.enemyNameLabel.string=t},setRemainTime:function(t){this.remainTimeLabel.string=t},setEntryCount:function(t,e){this._entryCount=t,this._maxCount=e,this.entryCountLabel.string=""+this._entryCount,this.maxEntryCountLabel.string=""+this._maxCount},setDiscovererName:function(t){this.discovererNameLabel.string=t},setPlayerTotalDamage:function(t){this.playerTotalDamageLabel.string=n.convertToCommaDelimited(t)},switchActiveRescueBand:function(t){this.publicDispNode.active=t},setResult:function(t){switch(t){case s.RAID_FINISH_STATUS.NON:this.resultParentNode.active=!1;break;case s.RAID_FINISH_STATUS.WIN:this.resultParentNode.active=!0,this.resultSuccessDispNode.active=!0,this.resultFailureDispNode.active=!1;break;case s.RAID_FINISH_STATUS.TIME_OVER:this.resultParentNode.active=!0,this.resultSuccessDispNode.active=!1,this.resultFailureDispNode.active=!0}},setCallbackToRescueBtn:function(t){this._entryCount>=this._maxCount?this.rescueBtn.node.active=!1:this.rescueBtn.node.active=!0,this.rescueBtn.setTapEvent(t)},setCallbackToStartBtn:function(t){this.startBtn.node.active=!0,this.startBtn.setTapEvent(t)},setCallbackToReceiveBtn:function(t){this.receiveBtn.node.active=!0,this.receiveBtn.setTapEvent(t)},setCallbackToResultBtn:function(t){this.resultBtn.node.active=!0,this.resultBtn.setTapEvent(t)},setCallbackToInfoBtn:function(t){this.infoBtn.node.active=!0,this.infoBtn.setTapEvent(t,"")}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",RaidConst:"RaidConst",ResourceUtils:"ResourceUtils"}],RaidBattleTypeModel:[function(t,e,i){"use strict";cc._RF.push(e,"ca9eaZTkcxKUogJDaWMZOpt","RaidBattleTypeModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getRaidBattleType:function(){if(this._isKeyFieldAvailable("raidBattleType"))return this._data.raidBattleType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: raidBattleType")},getMaxUserCount:function(){if(this._isKeyFieldAvailable("maxUserCount"))return this._data.maxUserCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxUserCount")},getRescueInterval:function(){if(this._isKeyFieldAvailable("rescueInterval"))return this._data.rescueInterval;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rescueInterval")},getAppearancePeriod:function(){if(this._isKeyFieldAvailable("appearancePeriod"))return this._data.appearancePeriod;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: appearancePeriod")},getMaxTurn:function(){if(this._isKeyFieldAvailable("maxTurn"))return this._data.maxTurn;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxTurn")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RaidBattleUIManager:[function(t,e,i){"use strict";cc._RF.push(e,"9aaa1VriXRO9paInWto7a6B","RaidBattleUIManager");t("BattleData");var a=t("BattleUIManager"),n=(t("GameEffectQueue").EffectData,cc.Class({extends:a,showResultWindow:function(){var t=cc.instantiate(this.battleResultPrefab).getComponent("RaidResultSubRoot");this.battleResultNode.addChild(t.node),this.battleResultNode.active=!0,t.show()}}));e.exports=n,cc._RF.pop()},{BattleData:"BattleData",BattleUIManager:"BattleUIManager",GameEffectQueue:"GameEffectQueue"}],RaidConst:[function(t,e,i){"use strict";cc._RF.push(e,"8346eXfrShNYJhxRtdY0ux8","RaidConst"),e.exports={RAID_FINISH_STATUS:cc.Enum({NON:0,WIN:1,TIME_OVER:2}),RAID_RESULT_STATUS:cc.Enum({NON:0,WIN:1,TIME_OVER:2,OTHER_WIN:3,OTHER_TIME_OVER:4,MAX_APPEAR_COUNT_OVER:11,MAX_ENTRY_COUNT_OVER:12,ENTRY_LIMIT_OVER:13,NOT_ENTRY:14,FINISHED:15}),RAID_REWARD_TYPE:cc.Enum({NORMAL:0,DISCOVERER:1,MVP:2,SEMI_MVP:3}),RAID_ENTRY_LIMIT_COUNT:3,RAID_APPEAR_LIMIT_COUNT:1},cc._RF.pop()},{}],RaidGachaDescriptionPopup:[function(t,e,i){"use strict";cc._RF.push(e,"85132Rk86BPta7wzJC/apcU","RaidGachaDescriptionPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{titleLabel:cc.Label,descriptionLabel:cc.Label,okBtn:n},openRaidGachaDescriptionPopup:function(t,e){this.titleLabel.string=t||"",this.descriptionLabel.string=e||"",this.okBtn.setTapEvent(this.close.bind(this)),this.open()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],RaidGachaLineupPopup:[function(t,e,i){"use strict";cc._RF.push(e,"53844lyiqZM54tlwVFGJxF7","RaidGachaLineupPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("RaidGachaLineupTabView");cc.Class({extends:a,properties:{lineupTabView:o,stepCountLabel:cc.Label,okBtn:n},openRaidGachaLineupPopup:function(t){this.lineupTabView.initRaidGachaLineupTabView(t),this.stepCountLabel.string=t.step,this.okBtn.setTapEvent(this.close.bind(this)),this.open()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",RaidGachaLineupTabView:"RaidGachaLineupTabView"}],RaidGachaLineupRewardHeaderThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"0aea2mP/M5GaKFswR73R2DU","RaidGachaLineupRewardHeaderThumbnail");cc.Class({extends:cc.Component,properties:{resetLabelNode:cc.Node,normalLabelNode:cc.Node,remainNode:cc.Node,totalNode:cc.Node,remainCountLabel:cc.Label,remainMaxCountLabel:cc.Label,totalCountLabel:cc.Label},onLoad:function(){},initRaidGachaLineupRewardHeaderThumbnail:function(t,e,i,a){this.remainCountLabel.string=a,this.remainMaxCountLabel.string=i,this.totalCountLabel.string=i,this.resetLabelNode.active=t,this.normalLabelNode.active=!t,this.remainNode.active=e,this.remainCountLabel.node.active=e,this.remainMaxCountLabel.node.active=e,this.totalNode.active=!e,this.totalCountLabel.node.active=!e}});cc._RF.pop()},{}],RaidGachaLineupRewardThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"c0871JtBm5LT7XjqmkcIFtG","RaidGachaLineupRewardThumbnail");var a=t("GameConst"),n=t("ItemUtils"),o=t("MatrixThumbnailUtils");cc.Class({extends:cc.Component,properties:{itemThumbnailAddNode:cc.Node,itemNameRichText:cc.RichText,countLabel:cc.Label,maxCountLabel:cc.Label},onLoad:function(){},initRaidGachaLineupRewardThumbnail:function(t,e,i){this._initThumbnail(t),this._initItemNameText(t),this._initCountLabel(t,e,i)},_initThumbnail:function(t){var e=o.createMatrixThumbnailByItemType(t.itemId,t.itemType,void 0);this.itemThumbnailAddNode.addChild(e.node)},_initItemNameText:function(t){var e=n.getItemInfo(t.itemType,t.itemId);this.itemNameRichText.string=a.RICH_TEXT_TAG_STATE.OUTLINE.START+e.name+" x "+a.RICH_TEXT_TAG_STATE.GREEN.START+t.count+a.RICH_TEXT_TAG_STATE.GREEN.END+a.RICH_TEXT_TAG_STATE.OUTLINE.END},_initCountLabel:function(t,e,i){var a=0;a=t.step===i?_.size(_.filter(e,function(e){return e.lineupId===t.lineupId})):t.step>i?t.totalCount:0,this.countLabel.string=""+a,this.maxCountLabel.string=t.totalCount}});cc._RF.pop()},{GameConst:"GameConst",ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils"}],RaidGachaLineupTabButton:[function(t,e,i){"use strict";cc._RF.push(e,"41782eqH79J+506fclRXU7v","RaidGachaLineupTabButton");var a=t("TabButton");cc.Class({extends:a,properties:{clearNode:cc.Node},setClear:function(t){this.clearNode.active=t}});cc._RF.pop()},{TabButton:"TabButton"}],RaidGachaLineupTabView:[function(t,e,i){"use strict";cc._RF.push(e,"3d26a+HAZFAuIYUhE6ZghTG","RaidGachaLineupTabView");var a=t("VariableTabViewBase"),n=t("RaidGachaLineupView");cc.Class({extends:a,properties:{tabParentScrollView:cc.ScrollView,lineupView:n},_boxGachaDetail:null,onLoad:function(){},initRaidGachaLineupTabView:function(t){this._boxGachaDetail=t;var e=this._createLineupTabButtons(_.size(t.allLineups),t.step);this.initVariableTabViewBase(void 0,e),this._resetSelectedLineupTab(),this._setCurrentTab(t.step-1),this._activateTab(t.step-1),this.lineupView.initRaidGachaLineupView(t,t.step);var i=(t.step-1)/(e.length-1);this.scheduleOnce(function(){this.tabParentScrollView.scrollToPercentHorizontal(i,0,!0)}.bind(this))},_createLineupTabButtons:function(t,e){for(var i=[],a=0;a<t;a+=1){var n=cc.instantiate(this.getTabButtonPrefab(a,t)).getComponent("RaidGachaLineupTabButton");i.push(n),n.initTabButton(this._createTabName(a,t),!0),this.setTabBtn(n,a),n.setClear(a<e-1)}return i},_resetSelectedLineupTab:function(){for(var t=0;t<this.tabBtnArray.length;t+=1)this.tabBtnArray[t].switchBtnImage(!1)},_createTabName:function(t,e){var i=t+1+"\u56de\u76ee";return t===e-1&&(i+="\u301c"),i},_tabEvent:function(t,e,i){cc.warn("RaidGachaLineupTabView","selectedTab = "+e," recentTab = "+i),this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this.lineupView.initRaidGachaLineupView(this._boxGachaDetail,t+1)}});cc._RF.pop()},{RaidGachaLineupView:"RaidGachaLineupView",VariableTabViewBase:"VariableTabViewBase"}],RaidGachaLineupView:[function(t,e,i){"use strict";cc._RF.push(e,"57874gR79RBAZ5UUrm4ksg3","RaidGachaLineupView");var a=t("CommonScrollView");cc.Class({extends:cc.Component,properties:{commonScrollView:a,lineupRewardHeaderThumbnail:cc.Prefab,lineupRewardThumbnail:cc.Prefab},onLoad:function(){},initRaidGachaLineupView:function(t,e){this.commonScrollView.content.destroyAllChildren();var i=[],a=[];_.forEach(t.allLineups[e],function(t){1===t.isReset?i.push(t):a.push(t)});var n=t.step===e,o=this._getLineupCount(t,i,n),r=this._getLineupCount(t,a,n);i.length>0&&(this._addRewardHeaderThumbnail(i,o,!0,n),this._addRewardThumbnail(i,t.boxLineups,t.step)),a.length>0&&(this._addRewardHeaderThumbnail(a,r,!1,n),this._addRewardThumbnail(a,t.boxLineups,t.step))},_getLineupCount:function(t,e,i){var a=0;return i&&(a=_.size(_.filter(e,function(e){return _.some(t.boxLineups,function(t){return e.lineupId===t.lineupId})}))),a},_addRewardHeaderThumbnail:function(t,e,i,a){var n=cc.instantiate(this.lineupRewardHeaderThumbnail).getComponent("RaidGachaLineupRewardHeaderThumbnail");n.initRaidGachaLineupRewardHeaderThumbnail(i,a,t.length,e),this.commonScrollView.content.addChild(n.node)},_addRewardThumbnail:function(t,e,i){_.forEach(t,function(t){var a=cc.instantiate(this.lineupRewardThumbnail).getComponent("RaidGachaLineupRewardThumbnail");a.initRaidGachaLineupRewardThumbnail(t,e,i),this.commonScrollView.content.addChild(a.node)}.bind(this))}});cc._RF.pop()},{CommonScrollView:"CommonScrollView"}],RaidGachaPlayCountConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"9f111Coe1ROlIuDPBKGjPzL","RaidGachaPlayCountConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonCountView"),r=t("ItemUtils"),s=t("CommonUtils"),c=t("LocalDataConst"),l=t("GachaCurrencyThumbnail");cc.Class({extends:a,properties:{costItemTopLabel:cc.Label,costItemThumbnail:l,costItemAfterCountLabel:cc.Label,countView:o,getResetFlgBtn:n,executeBtn:n,cancelBtn:n},_buttonData:null,_userCostCount:0,_callbackToExecute:null,openRaidGachaPlayCountConfirmPopup:function(t,e,i){this._buttonData=t,this._callbackToExecute=i;var a=r.getItemMaster(t.costId);this.costItemTopLabel.string=a.getName(),this.costItemThumbnail.initGachaCurrencyThumbnail(null,t.costId),this._userCostCount=r.getUserItemCount(t.costId);var o=Math.floor(this._userCostCount/t.costCount),l=Math.min(e.length,o,99);this.countView.initCommonCountView(this._onChangeCount.bind(this),1,l);var u=s.loadLocalStorage(c.LOCAL_STORAGE_KEY.RAID_GACHA_GET_RESET_STOP+this._buttonData.gachaId,!1,c.LOCAL_STORAGE_GET_TYPE.BOOLEAN);this.getResetFlgBtn.setTapEvent(this._onTapGetResetFlgBtn.bind(this)),this.getResetFlgBtn.switchBtnImage(u),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL),this.open()},_onChangeCount:function(t){this.costItemAfterCountLabel.string=Math.floor(this._userCostCount-t*this._buttonData.costCount)},_onTapGetResetFlgBtn:function(){var t=!this.getResetFlgBtn.getBtnImageSwitchState();this.getResetFlgBtn.switchBtnImage(t),s.saveLocalStorage(c.LOCAL_STORAGE_KEY.RAID_GACHA_GET_RESET_STOP+this._buttonData.gachaId,t)},_onTapExecuteBtn:function(){if(this._callbackToExecute){var t=this.getResetFlgBtn.getBtnImageSwitchState()?1:0;this._callbackToExecute(this.countView.getCountNum(),t)}this.close()},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",GachaCurrencyThumbnail:"GachaCurrencyThumbnail",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",PopupBase:"PopupBase"}],RaidGachaResetConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"b2a168EZxBMaoHHTKa7J64I","RaidGachaResetConfirmPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{stepLabel:cc.Label,cancelBtn:n,resetBtn:n},openRaidGachaResetConfirmPopup:function(t,e){this.stepLabel.string=t,this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.resetBtn.setTapEvent(function(){this.setCloseCallBack(e),this.close()}.bind(this),n.SE_NAME.CANCEL),this.open()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],RaidGachaResultListView:[function(t,e,i){"use strict";cc._RF.push(e,"1d49c941AxDJ4CUmiVAtUbn","RaidGachaResultListView");var a=t("CommonScrollView"),n=t("MatrixThumbnailUtils"),o=t("ListViewBase");t("ItemConst"),cc.Class({extends:o,properties:{currentCountLabel:cc.Label,maxCountLabel:cc.Label,scrollView:a},_isSkip:!1,_index:0,_result:null,_endFunc:null,initRaidGachaResultListView:function(t,e,i){this._isSkip=e.isGachaEffectSkip,this._index=0,this._result=e,this._endFunc=i,this.initListView(t)},resetRaidGachaResultListView:function(){this.thumbnailParentNode.destroyAllChildren()},setSkip:function(t){this._isSkip=t},_setListContent:function(t){this._initItems(this._result.cardList),this.currentCountLabel.string="0",this.maxCountLabel.string=""+this.thumbnailParentNode.children.length,this._playContinuousResultAnimation(this._index)},_initItems:function(t){if(this.resetRaidGachaResultListView(),Array.isArray(t))for(var e=0;e<t.length;e+=1){var i=n.createMatrixThumbnailByItemType(t[e].itemId,t[e].itemType,{prefix:"x",count:t[e].count});i.node.scale=0,i.node.active=!1,this.thumbnailParentNode.addChild(i.node)}},_playContinuousResultAnimation:function(t){var e=this.thumbnailParentNode.children[t];if(!e)return this._onEndContinuousResultAnimation();var i=e.getComponent("MatrixThumbnailBase");if(!i)return this._onEndContinuousResultAnimation();this._index+=1,this.currentCountLabel.string=""+this._index,this._isSkip?(i.node.active=!0,i.playPopAnim(),this._playContinuousResultAnimation(this._index)):(i.node.active=!0,i.playPopAnim(this._playContinuousResultAnimation.bind(this,this._index)),this.scrollView.scrollToPercentVertical(0,.1,!0))},_onEndContinuousResultAnimation:function(){return this.scheduleOnce(function(){this.scrollView.scrollToPercentVertical(0,.1,!0)}.bind(this)),this._endFunc?this._endFunc():void 0}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",ItemConst:"ItemConst",ListViewBase:"ListViewBase",MatrixThumbnailUtils:"MatrixThumbnailUtils"}],RaidGachaResultRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"85482SPT0RCfqa5/8Kyj9rY","RaidGachaResultRootUtils"),e.exports={openRaidGachaResultSubRoot:function(t,e){cc.log("openRaidGachaResultSubRoot"),cc.log(e),t.raidGachaResultSubRoot||(t.raidGachaResultSubRoot=cc.instantiate(t.raidGachaResultSubRootPrefab).getComponent("RaidGachaResultSubRoot"),t.subRootParent.addChild(t.raidGachaResultSubRoot.node)),t.raidGachaResultSubRoot.initRaidGachaResultSubRoot(t)},closeRaidGachaResultSubRoot:function(t,e){cc.log("closeRaidGachaResultSubRoot"),cc.log(e),t.raidGachaResultSubRoot&&(t.raidGachaResultSubRoot.node.destroy(),t.raidGachaResultSubRoot=null)}},cc._RF.pop()},{}],RaidGachaResultRoot:[function(t,e,i){"use strict";cc._RF.push(e,"2474c9jGjJNnKiG4LBaN/n/","RaidGachaResultRoot");var a=t("RaidGachaRootBase"),n=t("Singleton"),o=t("RaidGachaResultViewSetting");cc.Class({extends:a,properties:{raidGachaResultSubRootPrefab:cc.Prefab},_raidGachaResultData:void 0,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,o.RAID_GACHA_RESULT_SETTING)},onLoad:function(){this._addBG(),this._setErrorHandling(),this._addBand(),this._setTapEffect()},reload:function(){},redraw:function(){this.raidGachaResultSubRoot&&this.raidGachaResultSubRoot.redraw()},initData:function(){if(this.sceneParam){var t=JSON.parse(this.sceneParam),e=t[Object.keys(t)[0]];this.requestPlayBox(e.buttonData,e.count,e.isGetResetStop,e.isGachaEffectSkip,void 0)}},initialize:function(){this._initOpenFirstView({RaidGachaResultSubRoot:{}})},requestPlayBox:function(t,e,i,a,o){this.requestURLCount+=1,n.GachaService.playBox(t.gachaId,t.buttonId,e,t.skuId,i,function(e){this.setRaidGachaResultData(e,t,a),o&&o(e),this.requestURLCount-=1}.bind(this))},setRaidGachaResultData:function(t,e,i){this._raidGachaResultData={beforeButtonData:e,afterButtonData:t.button,cardList:t.cards,isGachaEffectSkip:i,boxLineups:t.boxLineups,isLimitOver:t.isLimitOver,isLimitOverCharacter:t.addWarehouseCharacters.length+t.updateWarehouseCharacters.length>0,isLimitOverEquipment:t.addWarehouseEquipments.length+t.updateWarehouseEquipments.length>0,isLimitOverMaterial:t.addWarehouseMaterials.length+t.updateWarehouseMaterials.length>0}},getRaidGachaResultData:function(){return this._raidGachaResultData?this._raidGachaResultData:{}}});cc._RF.pop()},{RaidGachaResultViewSetting:"RaidGachaResultViewSetting",RaidGachaRootBase:"RaidGachaRootBase",Singleton:"Singleton"}],RaidGachaResultSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"c754dTHc7hHAIdbBds8+MEk","RaidGachaResultSubRoot");var a=t("CommonButton"),n=t("ItemUtils"),o=(t("Singleton"),t("RaidGachaResultListView")),r=t("GachaCurrencyThumbnail");cc.Class({extends:cc.Component,properties:{raidGachaResultListView:o,ealyDispNode:cc.Node,lateDispNode:cc.Node,costItemThumbnail:r,skipBtn:a,backBtn:a,retryBtn:a,giftReceiveDescriptionLabel:cc.Label},_root:null,onLoad:function(){this.skipBtn.setTapEvent(this._onTapSkipBtn.bind(this)),this.backBtn.setTapEvent(this._onTapBackBtn.bind(this),a.SE_NAME.CANCEL),this.retryBtn.setTapEvent(this._onTapRetryBtn.bind(this))},initRaidGachaResultSubRoot:function(t){this._root=t,this.redraw()},redraw:function(){var t=this._root.getRaidGachaResultData();this.skipBtn.setTouchEnable(!0),this.backBtn.setTouchEnable(!1),this.retryBtn.setTouchEnable(!1),this.ealyDispNode.active=t.cardList.length>1,this.ealyDispNode.opacity=255,this.lateDispNode.active=!1;var e=t.afterButtonData?t.afterButtonData:t.beforeButtonData;this.costItemThumbnail.initGachaCurrencyThumbnail(null,e.costId),this._initRaidGachaResultListView(this._root,t);var i=[];t.isLimitOverCharacter&&i.push("\u30e6\u30cb\u30c3\u30c8"),t.isLimitOverEquipment&&i.push("\u88c5\u5099"),t.isLimitOverMaterial&&i.push("\u7d20\u6750"),i.length>0?(this.giftReceiveDescriptionLabel.string="["+_.join(i,", ")+"]\u304c\u6240\u6301\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u5009\u5eab\u306b\u9001\u3089\u308c\u307e\u3057\u305f\u3002",this.giftReceiveDescriptionLabel.node.active=!0):this.giftReceiveDescriptionLabel.node.active=!1},_initRaidGachaResultListView:function(t,e){var i=this.node.parent.getComponent(cc.Animation);i&&i.getAnimationState(i.getClips()[0].name).isPlaying?i.on("finished",function(i){this.raidGachaResultListView.initRaidGachaResultListView(t,e,this._onEndResultAnimation.bind(this))}.bind(this),this):this.raidGachaResultListView.initRaidGachaResultListView(t,e,this._onEndResultAnimation.bind(this))},_onEndResultAnimation:function(){if(this._root.getRaidGachaResultData().cardList.length<=1)this._showLateDispNode();else{this.skipBtn.setTouchEnable(!1);var t=cc.v2(this.ealyDispNode.getPosition().x,this.ealyDispNode.getPosition().y+50);this.ealyDispNode.opacity=255,this.ealyDispNode.runAction(cc.sequence(cc.spawn(cc.moveTo(.2,t).easing(cc.easeSineOut()),cc.fadeOut(.2)),cc.callFunc(function(){this.ealyDispNode.active=!1,this.ealyDispNode.setPosition(this.ealyDispNode.getPosition().x,this.ealyDispNode.getPosition().y-50),this._showLateDispNode()}.bind(this),this)))}},_showLateDispNode:function(){var t=this._root.getRaidGachaResultData();this.retryBtn.node.active=t.afterButtonData&&n.getUserItemCount(t.afterButtonData.costId)>=t.afterButtonData.costCount&&_.size(t.boxLineups)>0,this.lateDispNode.active=!0;for(var e=0;e<this.lateDispNode.children.length;e+=1){var i=this.lateDispNode.children[e],a=i.getPosition(),o=cc.v2(a.x,a.y+50);i.setPosition(o),i.opacity=0,i.runAction(cc.sequence(cc.delayTime(.1*e),cc.spawn(cc.moveTo(.2,a).easing(cc.easeSineOut()),cc.fadeIn(.2)),cc.callFunc(function(){this.backBtn.setTouchEnable(!0),this.retryBtn.setTouchEnable(!0)}.bind(this))))}},_onTapSkipBtn:function(){this.raidGachaResultListView.setSkip(!0)},_onTapBackBtn:function(){this.raidGachaResultListView.resetRaidGachaResultListView(),this._root.popScene()},_onTapRetryBtn:function(){var t=this._root.getRaidGachaResultData(),e=t.afterButtonData?t.afterButtonData:t.beforeButtonData;0===e.drawCount?this._root.openRaidGachaPlayCountConfirmPopup(t.afterButtonData,t.boxLineups,function(e,i){this._requestGachaDetail(t,e,i)}.bind(this)):this._requestGachaDetail(t,e.drawCount,0)},_requestGachaDetail:function(t,e,i){this.raidGachaResultListView.resetRaidGachaResultListView(),this._root.requestPlayBox(t.afterButtonData,e,i,t.isGachaEffectSkip,function(){this._root.redraw()}.bind(this))}});cc._RF.pop()},{CommonButton:"CommonButton",GachaCurrencyThumbnail:"GachaCurrencyThumbnail",ItemUtils:"ItemUtils",RaidGachaResultListView:"RaidGachaResultListView",Singleton:"Singleton"}],RaidGachaResultViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"d6809Z+ja5FXKcQdznT0kZy","RaidGachaResultViewSetting");var a=t("RaidGachaResultRootUtils");e.exports={RAID_GACHA_RESULT_SETTING:{RaidGachaResultSubRoot:{open:a.openRaidGachaResultSubRoot,close:a.closeRaidGachaResultSubRoot}}},cc._RF.pop()},{RaidGachaResultRootUtils:"RaidGachaResultRootUtils"}],RaidGachaRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"0d60dpLxaxH8Ii1Q5bRMlLu","RaidGachaRootBase");var a=t("OutGameRootBase"),n=t("GameConst");cc.Class({extends:a,properties:{raidGachaPlayCountConfirmPopupPrefab:cc.Prefab},_raidGachaPlayCountConfirmPopup:null,_getSceneBgmName:function(){return n.BGM.QUEST},openRaidGachaPlayCountConfirmPopup:function(t,e,i){this.closeRaidGachaPlayCountConfirmPopup(),this._raidGachaPlayCountConfirmPopup=cc.instantiate(this.raidGachaPlayCountConfirmPopupPrefab).getComponent("RaidGachaPlayCountConfirmPopup"),this._raidGachaPlayCountConfirmPopup.openRaidGachaPlayCountConfirmPopup(t,e,i)},closeRaidGachaPlayCountConfirmPopup:function(){this._raidGachaPlayCountConfirmPopup&&(this._raidGachaPlayCountConfirmPopup.close(),this._raidGachaPlayCountConfirmPopup=null)}});cc._RF.pop()},{GameConst:"GameConst",OutGameRootBase:"OutGameRootBase"}],RaidGachaRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"a6d92APJtpP4ZNXFHBHUap5","RaidGachaRootUtils"),e.exports={openRaidGachaTopSubRoot:function(t,e){cc.log("openRaidGachaTopSubRoot"),cc.log(e),t.hideBpProgressView(),t.raidGachaTopSubRoot||(t.raidGachaTopSubRoot=cc.instantiate(t.raidGachaTopSubRootPrefab).getComponent("RaidGachaTopSubRoot"),t.subRootParent.addChild(t.raidGachaTopSubRoot.node)),t.raidGachaTopSubRoot.initRaidGachaTopSubRoot(t)},closeRaidGachaTopSubRoot:function(t,e){cc.log("closeRaidGachaTopSubRoot"),cc.log(e),t.raidGachaTopSubRoot&&(t.raidGachaTopSubRoot.node.destroy(),t.raidGachaTopSubRoot=null)}},cc._RF.pop()},{}],RaidGachaRoot:[function(t,e,i){"use strict";cc._RF.push(e,"047c34oINJM1IZIP/K0l1JN","RaidGachaRoot");var a=t("RaidGachaRootBase"),n=t("RaidGachaViewSetting"),o=(t("GameConst"),t("EventQuestConst")),r=t("PopupUtils"),s=t("EventUtils"),c=t("Singleton"),l=t("SceneConst"),u=t("ResourceUtils");t("ResourceConst"),t("CommonUtils"),cc.Class({extends:a,properties:{raidGachaTopSubRootPrefab:cc.Prefab,raidGachaLineupPopupPrefab:cc.Prefab,raidGachaDescriptionPopupPrefab:cc.Prefab,raidGachaResetConfirmPopupPrefab:cc.Prefab},_raidGachaLineupPopup:null,_raidGachaDescriptionPopup:null,_raidGachaResetConfirmPopup:null,_boxGachaDetail:null,_eventMainMaster:null,_eventCharacterMasterArray:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,n.RAID_GACHA_SETTING)},onLoad:function(){this._super()},initData:function(){this._eventMainMaster=s.getOpenEventMainMasterArray().find(function(t){return t.getEventType()===o.EVENT_TYPE.RAID}),this._eventMainMaster&&(this._eventCharacterMasterArray=s.getEventCharacterMasterGroupByEventId()[this.getEventId()],this.reload(),this.requestGachaDetail())},initialize:function(){if(this._eventMainMaster){this.initOutGameRootBase(),this.redrawUIHeader();this._initOpenFirstView({RaidGachaTopSubRoot:{}}),this._redrawBackGround(this.getEventMainMaster().getWorldId())}else r.openSimpleMessageWindow("\u73fe\u5728\u958b\u50ac\u4e2d\u306e\u30ec\u30a4\u30c9\u306f\u3042\u308a\u307e\u305b\u3093\u3002")},reload:function(){},redraw:function(){this.redrawUIHeader(),this.raidGachaTopSubRoot&&this.raidGachaTopSubRoot.redraw()},_createPreViewParam:function(){return this.raidGachaTopSubRoot,{RaidGachaTopSubRoot:{}}},openRaidGachaLineupPopup:function(){this.closeRaidGachaLineupPopup(),this._raidGachaLineupPopup=cc.instantiate(this.raidGachaLineupPopupPrefab).getComponent("RaidGachaLineupPopup"),this._raidGachaLineupPopup.openRaidGachaLineupPopup(this.getBoxGachaDetail())},closeRaidGachaLineupPopup:function(){this._raidGachaLineupPopup&&(this._raidGachaLineupPopup.close(),this._raidGachaLineupPopup=null)},openRaidGachaDescriptionPopup:function(t,e){this.closeRaidGachaDescriptionPopup(),this._raidGachaDescriptionPopup=cc.instantiate(this.raidGachaDescriptionPopupPrefab).getComponent("RaidGachaDescriptionPopup"),this._raidGachaDescriptionPopup.openRaidGachaDescriptionPopup(t,e)},closeRaidGachaDescriptionPopup:function(){this._raidGachaDescriptionPopup&&(this._raidGachaDescriptionPopup.close(),this._raidGachaDescriptionPopup=null)},openRaidGachaResetConfirmPopup:function(t,e){this.closeRaidGachaResetConfirmPopup(),this._raidGachaResetConfirmPopup=cc.instantiate(this.raidGachaResetConfirmPopupPrefab).getComponent("RaidGachaResetConfirmPopup"),this._raidGachaResetConfirmPopup.openRaidGachaResetConfirmPopup(t,e)},closeRaidGachaResetConfirmPopup:function(){this._raidGachaResetConfirmPopup&&(this._raidGachaResetConfirmPopup.close(),this._raidGachaResetConfirmPopup=null)},openRaidGachaResetResultPopup:function(t){r.openCommonPopupOk("\u30ea\u30bb\u30c3\u30c8\u5b8c\u4e86","\u5831\u916c\u30e9\u30a4\u30f3\u30ca\u30c3\u30d7\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u307e\u3057\u305f\u3002","",!1,t,void 0,!1)},openRaidGachaLineupCompletePopup:function(t){r.openCommonPopupOk("\u5831\u916c\u30ea\u30bb\u30c3\u30c8","\u73fe\u5728\u306e\u30e9\u30a4\u30f3\u30ca\u30c3\u30d7\u5831\u916c\u3092\u5168\u3066\u5f15\u304d\u7d42\u3048\u307e\u3057\u305f\u3002\n\u6b21\u306e\u30e9\u30a4\u30f3\u30ca\u30c3\u30d7\u306b\u5207\u308a\u66ff\u3048\u308b\u5834\u5408\u306f\u3001\n\u5831\u916c\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002","",!1,t,void 0,!1)},pushRaidGachaResultScene:function(t,e,i,a){var n={RaidGachaResultSubRoot:{buttonData:t,count:e,isGetResetStop:i,isGachaEffectSkip:a}};this.pushScene(l.SCENE.FILE_NAME.RAID_GACHA_RESULT,this.getCurrentSceneName(),n,this._createPreViewParam())},requestGachaDetail:function(t){this.requestURLCount+=1,c.GachaService.getBoxDetail(this.getEventMainMaster().getGachaId(),function(e){if(this.requestURLCount-=1,this._boxGachaDetail=e,t)return t()}.bind(this))},requestResetBox:function(t){c.GachaService.resetBox(this.getEventMainMaster().getGachaId(),function(e){if(t)return t()})},showBpProgressView:function(){this._uiHeader.showBpProgressView()},hideBpProgressView:function(){this._uiHeader.hideBpProgressView()},getBoxGachaDetail:function(){return this._boxGachaDetail},getEventMainMaster:function(){return this._eventMainMaster},getEventId:function(){return this._eventMainMaster.getEventId()},getEventCharacterMasterArray:function(){return this._eventCharacterMasterArray},_redrawBackGround:function(t){var e=this.backgroundParent.getChildByName(this.bgPrefab.name);u.addSprite(e.getComponent(cc.Sprite),u.getFileNameWorldBG(t))}});cc._RF.pop()},{CommonUtils:"CommonUtils",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",PopupUtils:"PopupUtils",RaidGachaRootBase:"RaidGachaRootBase",RaidGachaViewSetting:"RaidGachaViewSetting",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton"}],RaidGachaTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"5d2a7XZ7JJCa4SRmdOKTxEp","RaidGachaTopSubRoot");var a=t("CommonUtils"),n=t("ViewUtils"),o=t("ResourceUtils"),r=t("ItemUtils"),s=t("QuestUtils"),c=t("TimeUtils"),l=t("CommonButton"),u=t("LocalDataConst"),h=t("GachaCurrencyThumbnail");cc.Class({extends:cc.Component,properties:{characterStandViewParentNode:cc.Node,raidLogoImageSprite:cc.Sprite,gachaLogoImageSprite:cc.Sprite,raidEndLabel:cc.Label,raidEndDateLabel:cc.Label,gachaEndDateLabel:cc.Label,infoBtn:l,lineupBtn:l,resetBtn:l,singlePlayBtn:l,costItemSpriteArray:[cc.Sprite],continuousPlayBtn:l,gachaEffectSkipCheckBtn:l,currencyThumbnail:h},_root:null,onLoad:function(){},initRaidGachaTopSubRoot:function(t){cc.warn("initRaidGachaTopSubRoot"),this._root=t,this._initBtnTapEvent(),this._initEventDateLabel(),this._initEffectSkipToggle(),this._initCostItem(),this._initRaidLogo(),this._initGachaLogo(),this._initCharacterStandView(),this._reloadCharacterStandImage(),this.redraw()},redraw:function(){this._initBtnEnabled(),_.size(this._root.getBoxGachaDetail().boxLineups)<=0&&this._root.openRaidGachaLineupCompletePopup()},_initBtnTapEvent:function(){this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),""),this.lineupBtn.setTapEvent(this._onTapLineupBtn.bind(this)),this.resetBtn.setTapEvent(this._onTapResetBtn.bind(this),l.SE_NAME.CANCEL),this.singlePlayBtn.setTapEvent(this._onTapSinglePlayBtn.bind(this)),this.continuousPlayBtn.setTapEvent(this._onTapContinuousPlayBtn.bind(this))},_initBtnEnabled:function(){this.infoBtn.switchBtnImage(!!this._root.getBoxGachaDetail().description),this.infoBtn.setTouchEnable(!!this._root.getBoxGachaDetail().description),this.resetBtn.switchBtnImage(this._root.getBoxGachaDetail().isReset),this.resetBtn.setTouchEnable(this._root.getBoxGachaDetail().isReset);var t={1:this.singlePlayBtn,2:this.continuousPlayBtn},e=this._root.getBoxGachaDetail();_.forEach(e.buttons,function(i){var a=r.getUserItemCount(i.costId)>=i.costCount&&_.size(e.boxLineups)>0;t[i.buttonId].switchBtnImage(a),t[i.buttonId].setTouchEnable(a)})},_initEventDateLabel:function(){var t=s.getWorldMasterByWorldId(this._root.getEventMainMaster().getWorldId());c.isRangeOfDate(void 0,t.getToDate())?(this.raidEndDateLabel.string=c.parseTimeToYmdhm(t.getToDate()),this.raidEndLabel.node.active=!1,this.raidEndDateLabel.node.active=!0):(this.raidEndLabel.node.active=!0,this.raidEndDateLabel.node.active=!1),this.gachaEndDateLabel.string=c.parseTimeToYmdhm(this._root.getBoxGachaDetail().toDate)},_initEffectSkipToggle:function(){var t=a.loadLocalStorage(u.LOCAL_STORAGE_KEY.RAID_GACHA_EFFECT_SKIP+this._root.getBoxGachaDetail().gachaId,!1,u.LOCAL_STORAGE_GET_TYPE.BOOLEAN);this.gachaEffectSkipCheckBtn.switchBtnImage(t),this.gachaEffectSkipCheckBtn.setTapEvent(function(){var t=!this.gachaEffectSkipCheckBtn.getBtnImageSwitchState();this.gachaEffectSkipCheckBtn.switchBtnImage(t),a.saveLocalStorage(u.LOCAL_STORAGE_KEY.RAID_GACHA_EFFECT_SKIP+this._root.getBoxGachaDetail().gachaId,t)}.bind(this))},_initCostItem:function(){var t=_.head(this._root.getBoxGachaDetail().buttons);_.forEach(this.costItemSpriteArray,function(e){e&&o.addSprite(e,o.getFileNameItemImage(t.costId),void 0)}),this.currencyThumbnail.initGachaCurrencyThumbnail(void 0,t.costId,void 0)},_initRaidLogo:function(){o.addSprite(this.raidLogoImageSprite,o.getFileNameLogoByEventId(this._root.getEventId()),void 0)},_initGachaLogo:function(){o.addSprite(this.gachaLogoImageSprite,o.getFileNameEventGachaLogo(this._root.getEventId()),void 0)},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=n.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_reloadCharacterStandImage:function(){var t=this._root.getEventCharacterMasterArray(),e=a.getRandom(0,t.length-1);this._characterStandView.setCharacterStandImage(t[e].getCharacterId())},_onTapInfoBtn:function(){var t="",e="";this._root.getBoxGachaDetail().description&&(t=this._root.getBoxGachaDetail().description.title,e=this._root.getBoxGachaDetail().description.text),this._root.openRaidGachaDescriptionPopup(t,e)},_onTapLineupBtn:function(){this._root.openRaidGachaLineupPopup()},_onTapResetBtn:function(){this._root.openRaidGachaResetConfirmPopup(this._root.getBoxGachaDetail().step,this._requestResetBox.bind(this))},_onTapSinglePlayBtn:function(){var t=_.find(this._root.getBoxGachaDetail().buttons,function(t){return 1===t.drawCount});t&&this._root.pushRaidGachaResultScene(t,t.drawCount,0,this.gachaEffectSkipCheckBtn.getBtnImageSwitchState())},_onTapContinuousPlayBtn:function(){var t=_.find(this._root.getBoxGachaDetail().buttons,function(t){return 0===t.drawCount});t&&this._root.openRaidGachaPlayCountConfirmPopup(t,this._root.getBoxGachaDetail().boxLineups,function(e,i){this._root.pushRaidGachaResultScene(t,e,i,this.gachaEffectSkipCheckBtn.getBtnImageSwitchState())}.bind(this))},_requestResetBox:function(){this._root.requestResetBox(this._openRaidGachaResetResultPopup.bind(this))},_openRaidGachaResetResultPopup:function(){this._root.openRaidGachaResetResultPopup(this._requestGachaDetail.bind(this))},_requestGachaDetail:function(){this._root.requestGachaDetail(function(){this._root.redraw()}.bind(this))}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GachaCurrencyThumbnail:"GachaCurrencyThumbnail",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils",ViewUtils:"ViewUtils"}],RaidGachaViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"292b9stMqBO6qb+NIsqYe19","RaidGachaViewSetting");var a=t("RaidGachaRootUtils");e.exports={RAID_GACHA_SETTING:{RaidGachaTopSubRoot:{open:a.openRaidGachaTopSubRoot,close:a.closeRaidGachaTopSubRoot}}},cc._RF.pop()},{RaidGachaRootUtils:"RaidGachaRootUtils"}],RaidGameManager:[function(t,e,i){"use strict";cc._RF.push(e,"5b32565XAtP1a5cGubt03Ql","RaidGameManager");var a=t("QuestGameManager"),n=t("BattleData"),o=t("BattleResult"),r=t("EnumTypes"),s=cc.Class({extends:a,properties:{},ctor:function(){cc.log("RaidGameManager ctor !!!!")},_executeWin:function(){return n.GM.clearCurrentEnemy(),n.cur_waveCount++,n.curWaveChecked=!1,n.cur_waveCount<n.curBattleQuest.getMaxWaveCount()?n.GM.loop.nextAction(2):(n.GM.showResult(),null)},_executeLose:function(){return n.GM.showResult(),null},showResult:function(){n.UI_M.b_canInputUI=!1;var t=n.GM;t.saveBattleSetting(function(){t.sendBattleResult(function(t){n.battleResult=t?o.createBattleResult(t):o.create_temp_battleResult(),n.UI_M.showResultWindow()})})},sendBattleResult:function(t){n.gameResult===r.GameResult.PLAYER_WIN&&(n.playerTotalDamageGiven=n.raidBattleSession.bossHp);var e=this._createEndBattleParams(n.gameResult);n.requestEndBattleFunc?n.requestEndBattleFunc(e,n.selectedQuestModel.getStageId(),n.raidBattleSession.sessionId,function(e){if(t)return t(e);this.resetBattleSession()}.bind(this)):cc.error("\u30d0\u30c8\u30eb\u7d42\u4e86\u6642\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")},sendBattleRetire:function(t){var e=this._createEndBattleParams(n.gameResult);n.requestRetireBattleFunc&&n.requestRetireBattleFunc(e,n.selectedQuestModel.getStageId(),n.raidBattleSession.sessionId,function(e){if(t)return t(e);this.resetBattleSession()}.bind(this))},getRemainTurnCount:function(){return n.maxTurnCount-n.cur_TurnCount}});e.exports=s,cc._RF.pop()},{BattleData:"BattleData",BattleResult:"BattleResult",EnumTypes:"EnumTypes",QuestGameManager:"QuestGameManager"}],RaidModel:[function(t,e,i){"use strict";cc._RF.push(e,"2c050vL8FVO5bZVRKdrnT4D","RaidModel");var a=t("UserRaidModel");cc.Class({userData:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t)},getEntryRaidBattleSessions:function(){return this.userData.getEntryRaidBattleSessions()},getPublicRaidBattleSessions:function(){return this.userData.getPublicRaidBattleSessions()},getNextRescueEnableDateList:function(){return this.userData.getNextRescueEnableDateList()}});cc._RF.pop()},{UserRaidModel:"UserRaidModel"}],RaidQuestListView:[function(t,e,i){"use strict";cc._RF.push(e,"893d17FKGNDF444uNQO/hNZ","RaidQuestListView");var a=t("CommonScrollView"),n=t("PopupUtils"),o=t("QuestUtils"),r=t("ResourceUtils"),s=t("CommonUtils"),c=t("UnlockEffectUtils"),l=t("RaidConst"),u=t("UnlockEffectConst");cc.Class({extends:cc.Component,properties:{storyThumbnailPrefab:cc.Prefab,stageThumbnailPrefab:cc.Prefab,scrollView:a},_root:null,initRaidQuestListView:function(t){this._root=t,this._setListContent(t)},_setListContent:function(t){this.scrollView.content.destroyAllChildren();for(var e=o.getStageMasterArrayByWorldId(t.getEventMainMaster().getWorldId()),i=!0,a=e.length-1,n=0;n<e.length;n+=1){var r=this._root.getStageStoryInfo(e[n]),c=this._switchCreateRaidQuestThumbnailNode(e[n],t.getUserStageFlatMap()[e[n].getStageId()],r,i);if(c){var l=this._isClearedStage(i,t.getUserStageFlatMap()[e[n].getStageId()],r);i!==l&&(a=Math.max(0,this.scrollView.content.childrenCount)),this.scrollView.content.addChild(c),i=l}}this.scrollView.scrollToPercentVertical(s.getScrollPercentage(a,this.scrollView.content.childrenCount-1),.1)},_switchCreateRaidQuestThumbnailNode:function(t,e,i,a){return i?this._createStoryThumbnailNode(t,e,i,a):this._createStageThumbnailNode(t,e,a)},_createStoryThumbnailNode:function(t,e,i,a){var n=cc.instantiate(this.storyThumbnailPrefab).getComponent("RaidQuestStoryThumbnail");return n.setStageName(t.getName()),n.setGrayOut(!a),n.setCallbackToThumbnail(function(){a&&this._root.requestReadStory(e)}.bind(this)),n.node},_createStageThumbnailNode:function(t,e,i){var a=o.getAreaMasterByStageId(t.getStageId()),h=this._root.getRaidBattleMasterMap()[t.getStageId()];if(!h)return null;this._root.getRaidBattleTypeMasterMap()[h.getRaidBattleType()];var d=cc.instantiate(this.stageThumbnailPrefab).getComponent("RaidQuestStageThumbnail");return d.setStageName(t.getName()),e&&s.loadLocalStorage(u.TRIGGER_PREFIX_NAME.RAID_BOSS+e.getAreaId())<=0?(d.setGrayOut(!0),c.playUnLockEffectAnimationNormal(d.getLockIconNode(),function(){d.setGrayOut(!i)})):d.setGrayOut(!i),d.setThumbnailImage(r.getFileNameAreaThumbnail(t.getAreaId())),d.setAttributeImage(r.getFileNameAreaImage(t.getAreaId())),d.setDifficult(a.getDifficult(),a.getName()),h.getAppearCostItemCount()>0?(d.switchActiveConsumeDispNode(!1),d.setConsumeCountLabel(h.getAppearCostItemCount())):(d.switchActiveConsumeDispNode(!0),d.setConsumeCountLabel(h.getBattlePoint())),d.setClearDispNode(!1),d.setNewDispNode(!1),i&&e&&(e.getClearCount()>0?d.setClearDispNode(!0):e.getPlayCount()<=0&&d.setNewDispNode(!0)),d.setCallbackToThumbnail(function(){i&&(this._root.getFinishedRaidBattleSessions().length>0?n.openCommonPopupYesNo("\u7d50\u679c\u672a\u78ba\u8a8d","\u7d50\u679c\u3092\u78ba\u8a8d\u3057\u3066\u3044\u306a\u3044\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u304c\u3042\u308a\u307e\u3059\u3002","",!1,this._root.pushRaidBattleSelectSubRoot.bind(this._root,2,"RaidScene",{RaidQuestSelectSubRoot:{}}),function(){},"\u78ba\u8a8d\u3059\u308b","\u9589\u3058\u308b"):this._root.getCurrentRaidBattleList().getEntryRaidBattleSessions().length>=l.RAID_ENTRY_LIMIT_COUNT?n.openCommonPopupOk("\u53c2\u52a0\u5236\u9650","\u540c\u6642\u306b\u53c2\u52a0\u3067\u304d\u308b\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u306f\n\u6700\u5927"+l.RAID_ENTRY_LIMIT_COUNT+"\u3064\u307e\u3067\u3067\u3059\u3002","",!1,function(){}):this._root.getSelfRaidBattleSessions().length>=l.RAID_APPEAR_LIMIT_COUNT?n.openCommonPopupOk("\u6311\u6226\u5236\u9650","\u30af\u30a8\u30b9\u30c8\u9078\u629e\u304b\u3089\u958b\u59cb\u3067\u304d\u308b\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u306f\n\u6700\u5927"+l.RAID_APPEAR_LIMIT_COUNT+"\u3064\u307e\u3067\u3067\u3059\u3002","",!1,function(){}):this._root.pushRaidBattleStartConfirmSubRoot(e.getStageId(),null,this._root.getCurrentSceneName(),{RaidQuestSelectSubRoot:{}}))}.bind(this)),d.node},_isClearedStage:function(t,e,i){return!!t&&(i?!!i.userStoryModel&&i.userStoryModel.getIsRead():!!e&&e.getClearCount()>0)}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",RaidConst:"RaidConst",ResourceUtils:"ResourceUtils",UnlockEffectConst:"UnlockEffectConst",UnlockEffectUtils:"UnlockEffectUtils"}],RaidQuestSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"cb14fJ3DhtKzYVoeFNsM3DF","RaidQuestSelectSubRoot");var a=t("CommonButton"),n=t("ViewUtils"),o=t("ResourceUtils"),r=t("TimeUtils"),s=t("EventQuestPointFrameThumbnail"),c=t("RaidQuestListView");cc.Class({extends:cc.Component,properties:{logoImageSprite:cc.Sprite,characterStandViewParentNode:cc.Node,endDateLabel:cc.Label,eventQuestPointFrameThumbnail:s,raidQuestListView:c,raidTopBtn:a},_root:null,_characterStandView:null,onLoad:function(){this.raidTopBtn.setTapEvent(this._onTapRaidTopBtn.bind(this))},initRaidQuestSelectSubRoot:function(t){this._root=t,this._initCharacterStandView(),this._drawLogo(),this._drawEndDate(),this._reloadCharacterStandImage(),this.eventQuestPointFrameThumbnail.initWindowFrame(),this.raidQuestListView.initRaidQuestListView(t)},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=n.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_drawLogo:function(){o.addSprite(this.logoImageSprite,o.getFileNameLogoByEventId(this._root.getEventId()))},_drawEndDate:function(){var t="\u7d42\u4e86\u65e5\u6642\uff1a"+r.parseTimeToYmdhm(this._root.getWorldMaster().getToDate())+" \u307e\u3067";this.endDateLabel.string=t},_reloadCharacterStandImage:function(){this._characterStandView.setCharacterStandImage(this._root.getEventCharacterId())},_onTapRaidTopBtn:function(){this._root.popScene(!0),this._root.pushRaidTopSubRoot()}});cc._RF.pop()},{CommonButton:"CommonButton",EventQuestPointFrameThumbnail:"EventQuestPointFrameThumbnail",RaidQuestListView:"RaidQuestListView",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils",ViewUtils:"ViewUtils"}],RaidQuestStageThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"9163beT5utE3ILZ+GDsSRRM","RaidQuestStageThumbnail");var a=t("RaidQuestThumbnailBase"),n=t("ResourceUtils"),o=t("ItemConst"),r=t("GameConst"),s={NORMAL:cc.color(30,53,165,255),HARD:cc.color(125,53,9,255),EX:cc.color(134,19,33,255)};cc.Class({extends:a,properties:{attributeImageSprite:cc.Sprite,thumbnailImageSprite:cc.Sprite,difficultBackImageSprite:cc.Sprite,difficultIconImageSprite:cc.Sprite,difficultIconLabel:cc.Label,consumeCountLabel:cc.Label,consumeStaminaDispNode:cc.Node,consumeItemDispNode:cc.Node,eventPointImageSprite:cc.Sprite,isNewDispNode:cc.Node,isClearDispNode:cc.Node,lockIconNode:cc.Node},getLockIconNode:function(){return this.lockIconNode},setThumbnailImage:function(t){n.addSprite(this.thumbnailImageSprite,t)},setAttributeImage:function(t){n.addSprite(this.attributeImageSprite,t)},setDifficult:function(t,e){n.addSprite(this.difficultBackImageSprite,n.getFileNameDifficultThumbnailBack(t)),n.addSprite(this.difficultIconImageSprite,n.getFileNameDifficultIcon(t)),this.difficultIconLabel.node.getComponent(cc.LabelOutline).color=this._convertDifficultToColor(t),this.difficultIconLabel.string=e},setDifficultText:function(t){this.difficultIconLabel.string=t},setConsumeCountLabel:function(t){this.consumeCountLabel.string=t+""},switchActiveConsumeDispNode:function(t){this.consumeStaminaDispNode.active=t,this.consumeItemDispNode.active=!t,this.consumeItemDispNode.active&&n.addSprite(this.eventPointImageSprite,n.getFileNameItemImage(o.RAID_CHALLENGE_ITEM))},setNewDispNode:function(t){this.isNewDispNode.active=t},setClearDispNode:function(t){this.isClearDispNode.active=t},_convertDifficultToColor:function(t){switch(t){case r.QUEST_DIFFICULT.TOWER.NORMAL:return s.NORMAL;case r.QUEST_DIFFICULT.TOWER.HARD:return s.HARD;case r.QUEST_DIFFICULT.TOWER.EX:return s.EX}return cc.color(0,0,0,255)}});cc._RF.pop()},{GameConst:"GameConst",ItemConst:"ItemConst",RaidQuestThumbnailBase:"RaidQuestThumbnailBase",ResourceUtils:"ResourceUtils"}],RaidQuestStoryThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"762d9tIggZHzaKyVVBzmzxY","RaidQuestStoryThumbnail");var a=t("RaidQuestThumbnailBase");cc.Class({extends:a,properties:{}});cc._RF.pop()},{RaidQuestThumbnailBase:"RaidQuestThumbnailBase"}],RaidQuestThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"d7524KxqaNL1JswbDmfT8h/","RaidQuestThumbnailBase");var a=t("CommonButton");cc.Class({extends:cc.Component,properties:{stageNameLabel:cc.Label,grayoutNode:cc.Node,thumbnailBtn:a},setStageName:function(t){this.stageNameLabel.string=t},setGrayOut:function(t){this.grayoutNode.active=t},setCallbackToThumbnail:function(t){this.thumbnailBtn.setTapEvent(t)}});cc._RF.pop()},{CommonButton:"CommonButton"}],RaidRankingPlayerThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"a6c1ezpWspPSL30XpV3f0/G","RaidRankingPlayerThumbnail");var a=t("CommonUtils"),n=t("ResourceUtils"),o=t("RaidConst"),r=cc.Enum({NORMAL:0,FIRST:1,SECOND:2,THIRD:3});cc.Class({extends:cc.Component,properties:{rankBordNodeArray:[cc.Node],rankNumberingBordNodeArray:[cc.Node],rankNumberingLabel:cc.Label,partnerImageSprite:cc.Sprite,playerLevelLabel:cc.Label,playerNameLabel:cc.Label,playerTotalDamageLabel:cc.Label},_resetRankBord:function(){for(var t in this.rankNumberingBordNodeArray)this.rankNumberingBordNodeArray[t].active=!1;for(var e in this.rankBordNodeArray)this.rankBordNodeArray[e].active=!1},setNumberingRank:function(t){switch(this._resetRankBord(),this.rankBordNodeArray[o.RAID_REWARD_TYPE.NORMAL].active=!0,t){case r.FIRST:case r.SECOND:case r.THIRD:this.rankNumberingBordNodeArray[t].active=!0;break;default:this.rankNumberingBordNodeArray[r.NORMAL].active=!0}this.rankNumberingLabel.string=t+"\u4f4d"},setMvpRank:function(t){switch(this._resetRankBord(),t){case r.FIRST:this.rankBordNodeArray[o.RAID_REWARD_TYPE.MVP].active=!0;break;case r.SECOND:this.rankBordNodeArray[o.RAID_REWARD_TYPE.SEMI_MVP].active=!0;break;default:this.setNumberingRank(t)}},switchActiveDiscover:function(t){this._resetRankBord(),this.rankBordNodeArray[o.RAID_REWARD_TYPE.DISCOVERER].active=t},setPartnerImage:function(t){n.addSprite(this.partnerImageSprite,t)},setPlayerLevel:function(t){this.playerLevelLabel.string=""+t},setPlayerName:function(t){this.playerNameLabel.string=t},setPlayerTotalDamage:function(t){this.playerTotalDamageLabel.string=a.convertToCommaDelimited(t)}});cc._RF.pop()},{CommonUtils:"CommonUtils",RaidConst:"RaidConst",ResourceUtils:"ResourceUtils"}],RaidResultDamageView:[function(t,e,i){"use strict";cc._RF.push(e,"cb7d9/YW1BCdoMZ9o544A7m","RaidResultDamageView");cc.Class({extends:cc.Component,properties:{raidResultDamageAnimation:cc.Animation,enemyHpLabel:cc.Label,enemyMaxHpLabel:cc.Label,addDamageLabel:cc.Label,enemyHpProgressBar:cc.ProgressBar},_result:null,_delayCount:0,_addDamage:0,_entryRaidBattleSession:null,_enemyData:void 0,_callback:null,initRaidResultDamageView:function(t,e,i,a){this._result=t,this._delayCount=e,this._addDamage=Math.floor(i),this._entryRaidBattleSession=a,this.node.active=!1;var n=Math.floor(this._entryRaidBattleSession.bossHp+this._addDamage);this.enemyHpLabel.string=""+n,this.enemyMaxHpLabel.string=""+this._entryRaidBattleSession.bossMaxHp,this.enemyHpProgressBar.progress=n/this._entryRaidBattleSession.bossMaxHp,this.addDamageLabel.string=""+this._addDamage,this._enemyData={beforeHp:n,maxHp:this._entryRaidBattleSession.bossMaxHp,addDt:0}},playRaidResultDamageSlidInAnimation:function(t){var e=cc.sequence(cc.delayTime(.3*this._delayCount),cc.callFunc(function(){this.raidResultDamageAnimation.on("finished",function(e){return t(e)},this),this.node.active=!0,this.raidResultDamageAnimation.play(this.raidResultDamageAnimation.getClips()[0].name)}.bind(this)));this._result.node.runAction(e)},playRaidResultDamageAnimation:function(t){this._callback=t,this._callbackDrawRaidResultDamageAction=this._drawRaidResultDamageAction.bind(this),this._result.updateCallbacks.push(this._callbackDrawRaidResultDamageAction)},_drawRaidResultDamageAction:function(t){var e=!1;if(this._addDamage>0){this._enemyData.addDt+=t,1<this._enemyData.addDt&&(this._enemyData.addDt=1,e=!0);var i=this._addDamage*(this._enemyData.addDt/1),a=this._enemyData.beforeHp-i;a<0&&(a=0),this.addDamageLabel.string=""+Math.floor(this._addDamage-i),this.enemyHpLabel.string=""+Math.floor(a),this.enemyHpProgressBar.progress=a/this._enemyData.maxHp}else e=!0;if(e){var n=this._result.updateCallbacks.indexOf(this._callbackDrawRaidResultDamageAction);return this._result.updateCallbacks.splice(n,1),this._callback()}}});cc._RF.pop()},{}],RaidResultExpGaugeView:[function(t,e,i){"use strict";cc._RF.push(e,"9f96etJVIJO3KzbturmJlvL","RaidResultExpGaugeView");var a=t("ResultPlayerRankView"),n=t("ResourceUtils"),o=t("GameConst");cc.Class({extends:a,properties:{addRaidCoinSprite:cc.Sprite,addRaidCoinNumLabel:cc.Label},initRaidResultExpGaugeView:function(t,e,i,a){this._setRaidCoin(a),this.initResultPlayerRankView(t,e,i)},_setRaidCoin:function(t){n.addSprite(this.addRaidCoinSprite,n.getFileNameItemImage(o.ITEM_ID_RAID)),this.addRaidCoinNumLabel.string=t.toString()}});cc._RF.pop()},{GameConst:"GameConst",ResourceUtils:"ResourceUtils",ResultPlayerRankView:"ResultPlayerRankView"}],RaidResultPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e9989uc+sdAcLEhJnSNa5qi","RaidResultPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("EventUtils"),s=t("EventQuestConst"),c=(t("ResultDropItemWindow"),t("Async")),l=t("QuestUtils"),u=t("RaidUtils");cc.Class({extends:a,properties:{battleClearNode:cc.Node,battleClearPrefab:cc.Prefab,resultTitleAnimation:cc.Animation,resultTitleLabel:cc.Label,dropWindowAddNode:cc.Node,dropItemWindowPrefab:cc.Prefab,eventPointWindowPrefab:cc.Prefab,dropRewardAudioClip:{type:cc.AudioClip,default:null},resultWinPopup:cc.Prefab,okBtnSlidInAnimation:cc.Animation,okBtn:o},_res:null,battleResultEventItemMap:null,_dropItemWindow:null,openRaidResultPopup:function(t,e){this._res=t,this._initResult(),this.setCloseCallBack(e),this.okBtn.setTapEvent(function(){this.close()}.bind(this));var i=this._getAnimationTask();this.open(function(){c.waterfall(i)})},_initResult:function(){this._createAddEventItem(),this._initResultDropItemWindow(),this._initResultEventPointWindow(),this.resultTitleLabel.string="\u30d0\u30c8\u30eb\u7d50\u679c"},_getAnimationTask:function(){var t=[];return t.push(this._playClearAnimation.bind(this)),t.push(function(t){var e=[this._playResultTitleAnimation.bind(this),this._playDropItemWindowOpenAnimation.bind(this),this._playEventPointWindowOpenAnimation.bind(this),this._playOkBtnSlidInAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),t.push(this._openRaidResultWinPopup.bind(this)),t.push(this._playDropItemThumbnailOpenAnimation.bind(this)),t},_createAddEventItem:function(){if(!this.battleResultEventItemMap)for(var t in this.battleResultEventItemMap={},s.EVENT_TYPE)this.battleResultEventItemMap[s.EVENT_TYPE[t]]||(this.battleResultEventItemMap[s.EVENT_TYPE[t]]={});if(void 0!==this._res.addEventPointItems&&Array.isArray(this._res.addEventPointItems))for(var e=this._res.addEventPointItems,i=0;i<e.length;i+=1){var a=parseInt(r.getEventMainMasterByItemId(e[i].itemId).getEventType(),10);this.battleResultEventItemMap[a]||(this.battleResultEventItemMap[a]={}),this.battleResultEventItemMap[a][e[i].itemId]?this.battleResultEventItemMap[a][e[i].itemId].count+=e[i].count:this.battleResultEventItemMap[a][e[i].itemId]=e[i]}},_initResultDropItemWindow:function(){var t=[];for(var e in this.battleResultEventItemMap[s.EVENT_TYPE.ITEM])t.push(this.battleResultEventItemMap[s.EVENT_TYPE.ITEM][e]);var i=[];if(this._res.dropItems)for(var a in this._res.dropItems)for(var n in this._res.dropItems[a]){var o=this._res.dropItems[a][n];i.push(o)}this._dropItemWindow=cc.instantiate(this.dropItemWindowPrefab).getComponent("ResultDropItemWindow"),this._dropItemWindow.initResultDropItemWindow(null,null,t,i,this._res.raidRewards),this.dropWindowAddNode.addChild(this._dropItemWindow.node)},_initResultEventPointWindow:function(){this._eventPointWindow=cc.instantiate(this.eventPointWindowPrefab).getComponent("ResultEventPointWindow"),this._eventPointWindow.initResultEventPointWindow(this.battleResultEventItemMap[s.EVENT_TYPE.POINT]),this.dropWindowAddNode.addChild(this._eventPointWindow.node)},_parallelAnimation:function(t,e){var i=t.length;t.forEach(function(t){t(function(){if((i-=1)<=0)return e()})})},_playClearAnimation:function(t){var e=cc.instantiate(this.battleClearPrefab);this.battleClearNode.addChild(e);var i=e.getComponent(cc.Animation);i.once("finished",function(){return t()},this),this.battleClearNode.active=!0,i.play(i.getClips()[0].name)},_playResultTitleAnimation:function(t){this.resultTitleAnimation.once("finished",function(e){return t(e)},this),this.resultTitleAnimation.node.active=!0,this.resultTitleAnimation.play(this.resultTitleAnimation.getClips()[0].name)},_playDropItemWindowOpenAnimation:function(t){this._dropItemWindow.playDropItemWindowOpenAnimation(t)},_playEventPointWindowOpenAnimation:function(t){this._eventPointWindow.playEventPointWindowOpenAnimation(t)},_playOkBtnSlidInAnimation:function(t){this.okBtnSlidInAnimation.once("finished",function(e){return t(e)},this),this.okBtnSlidInAnimation.node.opacity=0,this.okBtnSlidInAnimation.node.active=!0,this.okBtnSlidInAnimation.play(this.okBtnSlidInAnimation.getClips()[0].name)},_playDropItemThumbnailOpenAnimation:function(t){this._dropItemWindow.playDropItemThumbnailOpenAnimation(t),n.soundManager.playSE(this.dropRewardAudioClip)},_openRaidResultWinPopup:function(t){var e=l.getStageMasterByStageId(this._res.raidBattleSession.stageId),i=u.createRaidBattleMasterMap(this._res.raidBattleSession.eventId)[this._res.raidBattleSession.stageId],a=u.createRaidBattleTypeMasterMap()[i.getRaidBattleType()];cc.instantiate(this.resultWinPopup).getComponent("RaidResultWinPopup").openRaidResultWinPopup("\u30ec\u30a4\u30c9\u8a73\u7d30",this._res.raidBattleSession,this._res.entryUsers,e,a,2,t)}});cc._RF.pop()},{Async:"Async",CommonButton:"CommonButton",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",PopupBase:"PopupBase",QuestUtils:"QuestUtils",RaidUtils:"RaidUtils",ResultDropItemWindow:"ResultDropItemWindow",Singleton:"Singleton"}],RaidResultSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"cc668WeBFNO57+XRk4nzj7z","RaidResultSubRoot");var a=t("BattleData"),n=t("BattleFunction"),o=t("Singleton"),r=t("EnumTypes"),s=t("EventUtils"),c=(t("EventQuestConst"),t("LocalDataConst")),l=t("CommonButton"),u=t("Async"),h=t("RaidResultDamageView"),d=t("ResultPlayerRankView"),p=t("ResultDropItemWindow"),m=t("ResourceUtils"),g=t("StaticResourceConst"),C=(t("GameConst"),t("DeckConst")),f=t("RaidConst"),E=t("QuestUtils"),T=t("RaidUtils"),S=t("PopupUtils");t("ItemConst"),cc.Class({extends:cc.Component,properties:{resultTitleLabel:cc.Label,resultBgGraySprite:cc.Sprite,battleClearNode:cc.Node,battleCharacterSlidInAnimation:cc.Animation,battleCharacterSkeleton:[sp.Skeleton],resultTitleAnimation:cc.Animation,damageView:h,playerRankView:d,damageViewUiSlideOutAnimation:cc.Animation,upSlideOutAnimation:cc.Animation,characterExpPrefab:cc.Prefab,characterExpAddNode:cc.Node,downSlideOutAnimation:cc.Animation,rankUpPopupPrefab:cc.Prefab,dropWindowAddNode:cc.Node,dropItemWindowPrefab:cc.Prefab,resultWinPopup:cc.Prefab,nextRetryBtnSlidInAnimation:cc.Animation,nextRetryBtnGroupNode:cc.Node,nextButton:l,retryButton:l},updateCallbacks:null,_battleUnitList:null,_battleResult:null,_characterExpViewArray:null,_dropItemWindow:p,_raidBattleSession:null,_raidBattleUpdateStatus:0,_entryUsers:null,isPlayCharacterExpArray:null,ctor:function(){this.updateCallbacks=[],this.isPlayCharacterExpArray=[]},show:function(){this._battleResult=a.battleResult,this._battleUnitList=n.getUnitList(!1),this._raidBattleSession=this._battleResult._res.raidBattleSession,this._raidBattleUpdateStatus=this._battleResult._res.raidResultStatus,this._entryUsers=this._battleResult._res.entryUsers,this._initResult();var t=this._getAnimationTask();u.waterfall(t)},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e-=1)this.updateCallbacks[e](t)},_initResult:function(){this._createCharacterExpView(),this._createAddEventItem(),this._initRaidResultDamageView(),this._initPlayerRankView(),this._initResultDropItemWindow(),this._initButtons(),this.resultTitleLabel.string="RESULT"},_getAnimationTask:function(){var t=[];switch(t.push(this._playBattleEndAnimation.bind(this)),t.push(function(t){var e=[this._playBattleCharacterSlidInAnimation.bind(this),this._playBattleUiFadeOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),t.push(this._playResultBgGrayFadeIn.bind(this)),t.push(this._playResultTitleAnimation.bind(this)),t.push(this.damageView.playRaidResultDamageSlidInAnimation.bind(this.damageView)),t.push(this._openRaidUpdateStatusPopup.bind(this)),this._raidBattleUpdateStatus){case f.RAID_RESULT_STATUS.NON:case f.RAID_RESULT_STATUS.WIN:t.push(this._playRaidResultDamageAnimation.bind(this)),t.push(this._openRaidResultWinPopup.bind(this)),t.push(this._playDamageViewUiUpSlideOutAnimation.bind(this)),t.push(this._playPlayerRankSlidInAnimation.bind(this)),t.push(this._playPlayerRankExpAnimation.bind(this)),t.push(this._openResultRankUpPopup.bind(this)),t.push(this._playCharacterExpAnimation.bind(this)),t.push(function(t){var e=[this._playUiUpSlideOutAnimation.bind(this),this._playUiDownSlideOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),t.push(function(t){var e=[this._playDropItemWindowOpenAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),t.push(this._playDropItemThumbnailOpenAnimation.bind(this)),t.push(this._playNextRetryBtnSlidInAnimation.bind(this));break;default:t.push(this._nextQuest.bind(this))}return t.push(this._endBattleResult.bind(this)),t},_initButtons:function(){switch(this.nextButton.setTapEvent(this._nextQuest.bind(this)),this.retryButton.setTapEvent(this._retryQuest.bind(this)),this._raidBattleUpdateStatus){case f.RAID_RESULT_STATUS.NON:break;default:this.retryButton.node.active=!1}},_initRaidResultDamageView:function(){this.damageView.initRaidResultDamageView(this,0,a.playerTotalDamageGiven,this._raidBattleSession)},_initPlayerRankView:function(){var t=o.dao.EventItemMasters.find(function(t){return t.getEventId()===a.raidBattleSession.eventId}),e=0;if(t){var i=t.getItemId();e=_.reduce(_.filter(this._battleResult.addEventPointItems,function(t){return t.itemId===i}),function(t,e){return t+e.count},0)}this.playerRankView.initRaidResultExpGaugeView(this,1,this._battleResult.getPlayerExp,e)},_initResultDropItemWindow:function(){this._dropItemWindow=cc.instantiate(this.dropItemWindowPrefab).getComponent("ResultDropItemWindow"),this._dropItemWindow.initResultDropItemWindow(void 0,void 0,[],this._battleResult.dropItemList,this._battleResult.raidRewards),this.dropWindowAddNode.addChild(this._dropItemWindow.node)},_createAddEventItem:function(){this._addBattleResultEventItemMap(this._battleResult,this._battleResult.raidRewards)},_addBattleResultEventItemMap:function(t,e){if(void 0!==e&&Array.isArray(e))for(var i=0;i<e.length;i+=1){var a=s.getEventMainMasterByItemId(e[i].itemId);if(a){var n=parseInt(a.getEventType(),10);t.addEventPointItemMap[n][e[i].itemId]?t.addEventPointItemMap[n][e[i].itemId].count+=e[i].count:t.addEventPointItemMap[n][e[i].itemId]={itemId:e[i].itemId,itemType:e[i].itemType,count:e[i].count}}}},_createCharacterExpView:function(){this._characterExpViewArray=[];for(var t=0;t<this._battleUnitList.length;t+=1){var e=cc.instantiate(this.characterExpPrefab).getComponent("ResultCharacterExpView");this.characterExpAddNode.addChild(e.node),e.initResultCharacterExpView(this,1,t,this._battleUnitList[t],this._battleResult.mainU_getExpList[t]),this._characterExpViewArray.push(e)}},_nextQuest:function(){o.soundManager.bgmStop(),a.transitionEndBattleFunc?(a.transitionEndBattleFunc(a.sessionObjectData.stageId),a.requestSaveBattleFunc=null,a.requestEndBattleFunc=null,a.transitionEndBattleFunc=null):cc.director.loadScene("QuestScene.fire")},_retryQuest:function(){var t=a.selectedQuestModel.getStageId(),e=T.createRaidBattleMasterMap(a.raidBattleSession.eventId)[t];if(o.dao[o.USER].getCurrentBattlePointInfo().currentValue-e.getBattlePoint()>=0){var i=this._battleResult._clearQuestData;this._startBattle(t,i)}else S.openCommonPopupOk("BP\u78ba\u8a8d","\u51fa\u6483\u306b\u5fc5\u8981\u306aBP\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002","\u30ec\u30a4\u30c9\u30af\u30a8\u30b9\u30c8\u9078\u629e\u753b\u9762\u3078\u623b\u308a\u307e\u3059",!0,this._nextQuest.bind(this))},_startBattle:function(t,e,i,r){var s=o.localData[c.SELECT_QUEST_DECK_ORDER];o.RaidService.startBattle(this._raidBattleSession.sessionId,s,function(t){this._raidBattleUpdateStatus=t.resultStatus,this._executeRaidUpdateStatusFunc(function(){n.setRaidStartBattleData(e,t.stage,t.raidBattleSession,a.maxTurnCount,n.createSessionObjectData(t.session.sessionId,t.session.stageId,t.session.deckId,C.DECK_TYPE.QUEST),null),o.soundManager.bgmStop(),i&&"function"==typeof i&&i(),cc.director.loadScene("battleLoading.fire",function(){r&&"function"==typeof r&&r()})},function(){this._openOtherWinPopup(this._nextQuest.bind(this))}.bind(this),function(){this._openOtherWinPopup(this._nextQuest.bind(this))}.bind(this),function(){this._openTimeOverPopup(this._nextQuest.bind(this))}.bind(this))}.bind(this))},_parallelAnimation:function(t,e){var i=t.length;t.forEach(function(t){t(function(){if((i-=1)<=0)return e()})})},_playBattleEndAnimation:function(t){switch(a.gameResult){case r.GameResult.PLAYER_WIN:this._executeRaidUpdateStatusFunc(function(){this._playBattleClearAnimation(t)}.bind(this),function(){this._playBattleClearAnimation(t)}.bind(this),function(){this._playBattleClearAnimation(t)}.bind(this),function(){this._playBattleLoseAnimation(t)}.bind(this));break;case r.GameResult.ENEMY_WIN:case r.GameResult.DRAW:this._executeRaidUpdateStatusFunc(function(){this._playBattleLoseAnimation(t)}.bind(this),function(){this._playBattleClearAnimation(t)}.bind(this),function(){this._playBattleLoseAnimation(t)}.bind(this),function(){this._playBattleLoseAnimation(t)}.bind(this));break;default:return t()}},_executeRaidUpdateStatusFunc:function(t,e,i,a){switch(this._raidBattleUpdateStatus){case f.RAID_RESULT_STATUS.NON:t();break;case f.RAID_RESULT_STATUS.WIN:e();break;case f.RAID_RESULT_STATUS.FINISHED:i();break;case f.RAID_RESULT_STATUS.TIME_OVER:a()}},_playBattleClearAnimation:function(t){var e=a.battleEffect_Prefabs.BattleWin,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleLoseAnimation:function(t){var e=a.battleEffect_Prefabs.BattleLose,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleCharacterSlidInAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)this.battleCharacterSkeleton[e].skeletonData=this._battleUnitList[e].mainAvatar.skeletonData,this.battleCharacterSkeleton[e].setAnimation(0,"idle",!0),this._battleUnitList[e].unitController.node.runAction(cc.fadeOut(.5));this.battleCharacterSlidInAnimation.once("finished",function(e){return t(e)},this),this.battleCharacterSlidInAnimation.play(this.battleCharacterSlidInAnimation.getClips()[0].name)},_playBattleUiFadeOutAnimation:function(t){var e=[function(t){this._startBattleUiFadeOutAnimation(a.UI_M.waveTurnPanel_Root,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SkillBtn_Pos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SpeedBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.PauseBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.BattleInfoBtnBasePos,t)}.bind(this)];this._parallelAnimation(e,t)},_startBattleUiFadeOutAnimation:function(t,e){t.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){t.active=!1,e()})))},_playResultBgGrayFadeIn:function(t){var e=cc.sequence(cc.delayTime(0),cc.fadeIn(.3),cc.callFunc(function(e){return t(e)}));this.resultBgGraySprite.node.opacity=0,this.resultBgGraySprite.node.active=!0,this.resultBgGraySprite.node.runAction(e)},_playResultTitleAnimation:function(t){this.resultTitleAnimation.once("finished",function(e){return t(e)},this),this.resultTitleAnimation.node.active=!0,this.resultTitleAnimation.play(this.resultTitleAnimation.getClips()[0].name)},_playPlayerRankSlidInAnimation:function(t){var e=[];s.hasEventPointMaster(this._raidBattleSession.eventId)&&(e=this._getPlayerRankSlidInAnimation(e)),e=this._getCharacterExpSlidInAnimation(e),this._parallelAnimation(e,t)},_getPlayerRankSlidInAnimation:function(t){return t.push(this.playerRankView.playPlayerRankSlidInAnimation.bind(this.playerRankView)),t},_getCharacterExpSlidInAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)t.push(this._characterExpViewArray[e].playResultCharacterExpSlidInAnimation.bind(this._characterExpViewArray[e]));return t},_openRaidUpdateStatusPopup:function(t){this._executeRaidUpdateStatusFunc(t,t,function(){this._openOtherWinPopup(t)}.bind(this),function(){this._openTimeOverPopup(t)}.bind(this))},_openOtherWinPopup:function(t){var e=cc.instantiate(m.getResource(g.DIALOG_PREFAB_PATH)).getComponent("CommonPopup");e.initOk("\u30d0\u30c8\u30eb\u7d50\u679c","\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u304c\u30ec\u30a4\u30c9\u30dc\u30b9\u3092\u8a0e\u4f10\u3057\u307e\u3057\u305f\u3002","",!1,t,"OK"),e.setNodeGroup("UI"),e.open()},_openTimeOverPopup:function(t){var e=cc.instantiate(m.getResource(g.DIALOG_PREFAB_PATH)).getComponent("CommonPopup");e.initOk("\u6642\u9593\u5236\u9650","\u51fa\u6483\u3057\u305f\u30ec\u30a4\u30c9\u306f\u5236\u9650\u6642\u9593\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002","\u5236\u9650\u6642\u9593\u3092\u904e\u304e\u3066\u8a0e\u4f10\u3057\u305f\u5834\u5408\u3001\n\u8a0e\u4f10\u5931\u6557\u3068\u306a\u308a\u307e\u3059\u3002",!0,t,"OK"),e.setNodeGroup("UI"),e.open()},_playRaidResultDamageAnimation:function(t){this.damageView.playRaidResultDamageAnimation(t)},_playPlayerRankExpAnimation:function(t){this.playerRankView.playPlayerRankExpAnimation(t)},_openResultRankUpPopup:function(t){if(a.beforePlayerLv===o.dao.userBasicData.getLevel())return t();cc.instantiate(this.rankUpPopupPrefab).getComponent("ResultRankUpPopup").openResultRankUpPopup(t)},_playCharacterExpAnimation:function(t){var e=[];e=this._getCharacterExpAnimation(e),this._parallelAnimation(e,function(){this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(t)))}.bind(this)),this._setPlayingCharacterExpSE()},_getCharacterExpAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)t.push(this._characterExpViewArray[e].playResultCharacterExpAnimation.bind(this._characterExpViewArray[e]));return t},_setPlayingCharacterExpSE:function(){for(var t in this._battleUnitList)this.isPlayCharacterExpArray.push(!0);var e=this._playCharacterExpSEUpdateCallBack.bind(this);this.updateCallbacks.push(e)},_playCharacterExpSEUpdateCallBack:function(){this.isPlayCharacterExpArray.find(function(t){return t})&&a.GM.soundManager.playSE(a.RM.soundResourceList.ExperiencePointsRise)},_playDamageViewUiUpSlideOutAnimation:function(t){this.damageViewUiSlideOutAnimation.once("finished",function(e){return t(e)},this),this.damageViewUiSlideOutAnimation.play(this.damageViewUiSlideOutAnimation.getClips()[0].name)},_playUiUpSlideOutAnimation:function(t){this.upSlideOutAnimation.once("finished",function(e){return t(e)},this),this.upSlideOutAnimation.play(this.upSlideOutAnimation.getClips()[0].name)},_playUiDownSlideOutAnimation:function(t){this.downSlideOutAnimation.once("finished",function(e){return t(e)},this),this.downSlideOutAnimation.play(this.downSlideOutAnimation.getClips()[0].name)},_playDropItemWindowOpenAnimation:function(t){if(!this._isDropEnabled())return t();this._dropItemWindow.playDropItemWindowOpenAnimation(t)},_isDropEnabled:function(){return this._battleResult.dropItemList&&this._battleResult.dropItemList.length>0||this._battleResult.raidRewards&&this._battleResult.raidRewards.length>0},_playDropItemThumbnailOpenAnimation:function(t){this._dropItemWindow.playDropItemThumbnailOpenAnimation(t),a.GM.soundManager.playSE(a.RM.soundResourceList.DropReward)},_openRaidResultWinPopup:function(t){switch(this._raidBattleUpdateStatus){case f.RAID_RESULT_STATUS.WIN:var e=E.getStageMasterByStageId(this._raidBattleSession.stageId),i=T.createRaidBattleMasterMap(this._raidBattleSession.eventId)[this._raidBattleSession.stageId],a=T.createRaidBattleTypeMasterMap()[i.getRaidBattleType()],n=cc.instantiate(this.resultWinPopup).getComponent("RaidResultWinPopup");n.setNodeGroup("UI"),n.openRaidResultWinPopup("\u30ec\u30a4\u30c9\u8a73\u7d30",this._raidBattleSession,this._entryUsers,e,a,2,t);break;default:var o=cc.sequence(cc.delayTime(2),cc.callFunc(t));return this.damageView.node.runAction(o)}},_playNextRetryBtnSlidInAnimation:function(t){this.nextRetryBtnSlidInAnimation.once("finished",function(e){return t(e)},this),this.nextRetryBtnGroupNode.opacity=0,this.nextRetryBtnGroupNode.active=!0,this.nextRetryBtnSlidInAnimation.play(this.nextRetryBtnSlidInAnimation.getClips()[0].name)},_endBattleResult:function(t){return a.autoBattleResultDropItemMap=null,a.battleResultEventItemMap=null,t()}});cc._RF.pop()},{Async:"Async",BattleData:"BattleData",BattleFunction:"BattleFunction",CommonButton:"CommonButton",DeckConst:"DeckConst",EnumTypes:"EnumTypes",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",RaidConst:"RaidConst",RaidResultDamageView:"RaidResultDamageView",RaidUtils:"RaidUtils",ResourceUtils:"ResourceUtils",ResultDropItemWindow:"ResultDropItemWindow",ResultPlayerRankView:"ResultPlayerRankView",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],RaidResultWinPopup:[function(t,e,i){"use strict";cc._RF.push(e,"080a56AWGNNvZQaEU0UEDhb","RaidResultWinPopup");var a=t("RaidBattleDetailPopupBase");cc.Class({extends:a,properties:{},openRaidResultWinPopup:function(t,e,i,a,n,o,r){this._openRaidBattleDetailPopupBase(t,e,i,a,n,o,r)},_addDiscoverer:function(t,e,i){var a=cc.instantiate(this.thumbnailPrefab).getComponent("RaidRankingPlayerThumbnail"),n=this._findUserDetail(e,t.discovererId),o=t.damageRanking.find(function(e){return e.users.find(function(e){return e===t.discovererId})});a.switchActiveDiscover(!0),this._addThumbnail(a,n,o)},_drawContent:function(t,e,i){this.scrollView.content.destroyAllChildren(),i=i>0&&i<=t.damageRanking.length?i:t.damageRanking.length,this._addDiscoverer(t,e,i);for(var a=1,n=0;n<i;n+=1){for(var o=0;o<t.damageRanking[n].users.length;o+=1){var r=cc.instantiate(this.thumbnailPrefab).getComponent("RaidRankingPlayerThumbnail"),s=this._findUserDetail(e,t.damageRanking[n].users[o]);t.damageRanking[n]&&t.damageRanking[n].score>0&&(this._addThumbnail(r,s,t.damageRanking[n]),this._updateThumbnailParameter(r,a))}a+=1}},_updateThumbnailParameter:function(t,e){t.setMvpRank(e)}});cc._RF.pop()},{RaidBattleDetailPopupBase:"RaidBattleDetailPopupBase"}],RaidRewardGroupModel:[function(t,e,i){"use strict";cc._RF.push(e,"ddb586pPjFJy7eowc1d8bLy","RaidRewardGroupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getRewardGroupId:function(){if(this._isKeyFieldAvailable("rewardGroupId"))return this._data.rewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardGroupId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getRate:function(){if(this._isKeyFieldAvailable("rate"))return this._data.rate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RaidRewardModel:[function(t,e,i){"use strict";cc._RF.push(e,"e596605WatLRbEJYa0o2qLT","RaidRewardModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getRewardId:function(){if(this._isKeyFieldAvailable("rewardId"))return this._data.rewardId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardId")},getNormalRewardGroupId:function(){if(this._isKeyFieldAvailable("normalRewardGroupId"))return this._data.normalRewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: normalRewardGroupId")},getDiscovererRewardGroupId:function(){if(this._isKeyFieldAvailable("discovererRewardGroupId"))return this._data.discovererRewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: discovererRewardGroupId")},getMvpRewardGroupId:function(){if(this._isKeyFieldAvailable("mvpRewardGroupId"))return this._data.mvpRewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: mvpRewardGroupId")},getSemiMvpRewardGroupId:function(){if(this._isKeyFieldAvailable("semiMvpRewardGroupId"))return this._data.semiMvpRewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: semiMvpRewardGroupId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RaidRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"0446dTEWfRNKocJC6MxoRW4","RaidRootUtils"),e.exports={openRaidTopSubRoot:function(t,e){cc.log("openRaidTopSubRoot"),cc.log(e),t.hideBpProgressView(),t.raidTopSubRoot||(t.raidTopSubRoot=cc.instantiate(t.raidTopSubRootPrefab).getComponent("RaidTopSubRoot"),t.subRootParent.addChild(t.raidTopSubRoot.node),t.playSubRootAnimation()),t.backgroundParent.active=!1,t.raidTopSubRoot.initRaidTopSubRoot(t)},closeRaidTopSubRoot:function(t,e){cc.log("closeRaidTopSubRoot"),cc.log(e),t.raidTopSubRoot&&(t.raidTopSubRoot.node.destroy(),t.raidTopSubRoot=null),t.backgroundParent.active=!0},openRaidQuestSelectSubRoot:function(t,e){cc.log("openRaidQuestSelectSubRoot"),cc.log(e),t.showBpProgressView(),t.raidQuestSelectSubRoot||(t.raidQuestSelectSubRoot=cc.instantiate(t.raidQuestSelectSubRootPrefab).getComponent("RaidQuestSelectSubRoot"),t.subRootParent.addChild(t.raidQuestSelectSubRoot.node),t.playSubRootAnimation()),t.raidQuestSelectSubRoot.initRaidQuestSelectSubRoot(t)},closeRaidQuestSelectSubRoot:function(t,e){cc.log("closeRaidQuestSelectSubRoot"),cc.log(e),t.raidQuestSelectSubRoot&&(t.raidQuestSelectSubRoot.node.destroy(),t.raidQuestSelectSubRoot=null)},openRaidBattleSelectSubRoot:function(t,e){cc.log("openRaidBattleSelectSubRoot"),cc.log(e),t.showBpProgressView(),t.raidBattleSelectSubRoot||(t.raidBattleSelectSubRoot=cc.instantiate(t.raidBattleSelectSubRootPrefab).getComponent("RaidBattleSelectSubRoot"),t.subRootParent.addChild(t.raidBattleSelectSubRoot.node),t.playSubRootAnimation()),t.raidBattleSelectSubRoot.initRaidBattleSelectSubRoot(t,e.tabIndex)},closeRaidBattleSelectSubRoot:function(t,e){cc.log("closeRaidBattleSelectSubRoot"),cc.log(e),t.raidBattleSelectSubRoot&&(t.raidBattleSelectSubRoot.node.destroy(),t.raidBattleSelectSubRoot=null)},openRaidBattleStartConfirmSubRoot:function(t,e){cc.log("openRaidBattleStartConfirmSubRoot"),cc.log(e),t.showBpProgressView(),t.battleStartConfirmSubRoot||(t.battleStartConfirmSubRoot=cc.instantiate(t.battleStartConfirmSubRootPrefab).getComponent("RaidBattleStartConfirmSubRoot"),t.subRootParent.addChild(t.battleStartConfirmSubRoot.node),t.playSubRootAnimation()),t.battleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,e.stageId,e.raidBattleSession)},closeRaidBattleStartConfirmSubRoot:function(t,e){cc.log("closeRaidBattleStartConfirmSubRoot"),cc.log(e),t.battleStartConfirmSubRoot&&(t.battleStartConfirmSubRoot.node.destroy(),t.battleStartConfirmSubRoot=null)}},cc._RF.pop()},{}],RaidRoot:[function(t,e,i){"use strict";cc._RF.push(e,"d3165hPwKlLKJDqyRQc1gwg","RaidRoot");var a=t("QuestRootBase"),n=t("Singleton"),o=t("EventUtils"),r=t("RaidUtils"),s=t("CharacterUtils"),c=t("ResourceUtils"),l=t("QuestUtils"),u=t("StoryUtils"),h=t("ExtensionAdvUtils"),d=t("ExtensionAdvUtils"),p=t("PopupUtils"),m=t("UnlockEffectUtils"),g=t("CommonUtils"),C=t("RaidViewSetting"),f=t("EventQuestConst"),E=t("StoryConst"),T=t("LocalDataConst"),S=t("BattleFunction"),R=(t("GameConst"),t("DeckConst")),A=t("RaidConst"),b=t("UnlockEffectConst"),M=t("SceneConst");cc.Class({extends:a,properties:{raidTopSubRootPrefab:cc.Prefab,raidQuestSelectSubRootPrefab:cc.Prefab,raidBattleSelectSubRootPrefab:cc.Prefab,eventQuestPointRewardListPopupPrefab:cc.Prefab,eventQuestHowToPlayPopupPrefab:cc.Prefab,raidSendRescueConfirmPopupPrefab:cc.Prefab,raidBattleDetailConfirmPopupPrefab:cc.Prefab,raidResultPopupPrefab:cc.Prefab},_eventQuestPointRewardListPopup:null,_eventQuestHowToPlayPopup:null,_eventMainMaster:null,_worldMaster:null,_eventCharacterMasterArray:null,_stageMasterFlatMap:null,_userStageFlatMap:null,_questStoryInfoMap:null,_raidBattleMasterMap:null,_raidBattleTypeMasterMap:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,C.RAID_SETTING)},onLoad:function(){this._super(),this.backgroundParent.active=!1},initData:function(){this._eventMainMaster=o.getOpenEventMainMasterArray().find(function(t){return t.getEventType()===f.EVENT_TYPE.RAID}),this._eventMainMaster&&(this._worldMaster=l.getWorldMasterByWorldId(this._eventMainMaster.getWorldId()),this._eventCharacterMasterArray=o.getEventCharacterMasterGroupByEventId()[this.getEventId()],this._stageMasterFlatMap=l.getStageMasterMap(),this._raidBattleMasterMap=r.createRaidBattleMasterMap(this._eventMainMaster.getEventId()),this._raidBattleTypeMasterMap=r.createRaidBattleTypeMasterMap(),this.reload(),this.requestGetList())},initResource:function(){if(this._super(),this._eventMainMaster){var t=o.getEventCharacterMasterGroupByEventId()[this.getEventId()],e=s.getCharacterSkillMainMasterMapIndexBySkillId();t.forEach(function(t){var i=s.getCharacterMainModelByCharacterId(t.getCharacterId()),a=e[i.getSkillId()],n=e[i.getSkillId()].getSpineName(),o=c.getDirectoryIngameSkillSpine(a.getSpineDirectoryPath()),r=a.getHitEffectName(),l=c.getDirectoryIngameHitSpine(a.getSpineDirectoryPath());this.requestRes(o+n,sp.SkeletonData,this._requestEventsSpineRes.bind(this,n,o,r,l))}.bind(this))}},_requestEventsSpineRes:function(t,e,i,a){var n=e+t,o=this.getResource(n);o&&_.forEach(o.skeletonJson.animations.home.events,function(t){if(0!==t.name.indexOf("gr_se_")&&0!==t.name.indexOf("se_")&&0!==t.name.indexOf("vo_"))switch(t.name){case i:this.requestRes(a+t.name,sp.SkeletonData);break;default:this.requestRes(e+t.name,sp.SkeletonData)}}.bind(this))},initialize:function(){if(this._eventMainMaster){this.initOutGameRootBase(),this.redrawUIHeader();this._initOpenFirstView({RaidTopSubRoot:{}}),this.redrawBackGround(this.getEventMainMaster().getWorldId())}else p.openSimpleMessageWindow("\u73fe\u5728\u958b\u50ac\u4e2d\u306e\u30ec\u30a4\u30c9\u306f\u3042\u308a\u307e\u305b\u3093\u3002")},reload:function(){this._userStageFlatMap=l.createUserStageFlatMap(),this._questStoryInfoMap=u.createQuestStoryInfoMap(E.STORY_CATEGORY.EVENT,u.createUserStoryFlatMap(),this._userStageFlatMap)},showBpProgressView:function(){this._uiHeader.showBpProgressView()},hideBpProgressView:function(){this._uiHeader.hideBpProgressView()},createPreViewParam:function(){var t={};return this.raidTopSubRoot&&(t.RaidTopSubRoot={}),this.raidQuestSelectSubRoot&&(t.RaidQuestSelectSubRoot={}),this.raidBattleSelectSubRoot&&(t.RaidBattleSelectSubRoot={tabIndex:this.raidBattleSelectSubRoot.getCurrentTab()}),this.battleStartConfirmSubRoot&&(t.RaidBattleStartConfirmSubRoot={stageId:this.battleStartConfirmSubRoot.getStageId(),raidBattleSession:this.battleStartConfirmSubRoot.getRaidBattleSession()}),t},redraw:function(){this.redrawUIHeader(),this.raidBattleSelectSubRoot&&this.raidBattleSelectSubRoot.redrawRaidBattleSelectSubRoot(),this._super()},playSubRootAnimation:function(){var t=this.subRootParent.getComponent(cc.Animation);t&&!t.getAnimationState("SubRoot_Start").isPlaying&&t.play("SubRoot_Start")},pushRaidTopSubRoot:function(){this.pushScene(this.getCurrentSceneName(),null,{RaidTopSubRoot:{}},null)},pushRaidQuestSelectSubRoot:function(){this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),{RaidQuestSelectSubRoot:{}},{RaidTopSubRoot:{}})},pushRaidBattleSelectSubRoot:function(t,e,i){var a={RaidBattleSelectSubRoot:{tabIndex:t}};this.pushScene(this.getCurrentSceneName(),e,a,i)},pushRaidBattleStartConfirmSubRoot:function(t,e,i,a){var n={RaidBattleStartConfirmSubRoot:{stageId:t,raidBattleSession:e}};this.pushScene(this.getCurrentSceneName(),i,n,a)},openEventQuestPointRewardListPopup:function(){this.closeEventQuestPointRewardListPopup(),this._eventQuestPointRewardListPopup=cc.instantiate(this.eventQuestPointRewardListPopupPrefab).getComponent("EventQuestPointRewardListPopup"),this._eventQuestPointRewardListPopup.openEventQuestPointRewardListPopup(this.getEventId())},closeEventQuestPointRewardListPopup:function(){this._eventQuestPointRewardListPopup&&(this._eventQuestPointRewardListPopup.close(),this._eventQuestPointRewardListPopup=null)},openEventQuestHowToPlayPopup:function(){this.closeEventQuestPointRewardListPopup(),this._eventQuestHowToPlayPopup=cc.instantiate(this.eventQuestHowToPlayPopupPrefab).getComponent("EventQuestHowToPlayPopup"),this._eventQuestHowToPlayPopup.openEventQuestHowToPlayPopup(this.getEventId())},closeEventQuestHowToPlayPopup:function(){this._eventQuestHowToPlayPopup&&(this._eventQuestHowToPlayPopup.close(),this._eventQuestHowToPlayPopup=null)},openRaidBattleDetailConfirmPopup:function(t,e,i,a,n){var o=this.getStageMasterFlatMap()[e.stageId],r=this.getRaidBattleMasterMap()[e.stageId],s=this.getRaidBattleTypeMasterMap()[r.getRaidBattleType()];this.closeRaidBattleDetailConfirmPopup(),this._raidBattleDetailConfirmPopup=cc.instantiate(this.raidBattleDetailConfirmPopupPrefab).getComponent("RaidBattleDetailConfirmPopup"),this._raidBattleDetailConfirmPopup.openRaidBattleDetailConfirmPopup(t,e,i,o,s,a,n)},closeRaidBattleDetailConfirmPopup:function(){this._raidBattleDetailConfirmPopup&&(this._raidBattleDetailConfirmPopup.close(),this._raidBattleDetailConfirmPopup=null)},openRaidSendRescueConfirmPopup:function(t,e,i){this.closRaidSendRescueConfirmPopup(),this._raidSendRescueConfirmPopup=cc.instantiate(this.raidSendRescueConfirmPopupPrefab).getComponent("RaidSendRescueConfirmPopup"),this._raidSendRescueConfirmPopup.openRaidSendRescueConfirmPopup(t,e,i)},closRaidSendRescueConfirmPopup:function(){this._raidSendRescueConfirmPopup&&(this._raidSendRescueConfirmPopup.close(),this._raidSendRescueConfirmPopup=null)},openRaidResultPopup:function(t){this.closeRaidResultPopup(),this._raidResultPopup=cc.instantiate(this.raidResultPopupPrefab).getComponent("RaidResultPopup"),this._raidResultPopup.openRaidResultPopup(t,function(){t.raidRewards.find(function(t){return t.rewardType===A.RAID_REWARD_TYPE.NORMAL})?(this.reload(),this.redraw()):p.openCommonPopupOk("\u30ea\u30b6\u30eb\u30c8\u78ba\u8a8d","\u7dcf\u4e0e\u30c0\u30e1\u30fc\u30b8\u304c0\u306e\u305f\u3081\u53c2\u52a0\u5831\u916c\u3092\u5f97\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002","",!1,function(){this.reload(),this.redraw()}.bind(this))}.bind(this))},closeRaidResultPopup:function(){this._raidResultPopup&&(this._raidResultPopup.close(),this._raidResultPopup=null)},transitionMissionScene:function(){var t={MissionTabView:{selectedTab:3}};this.pushScene("MissionScene",this.getCurrentSceneName(),t,{RaidTopSubRoot:{}})},transitionRaidGachaTopSubRoot:function(){this.pushScene(M.SCENE.FILE_NAME.RAID_GACHA,this.getCurrentSceneName(),{RaidGachaTopSubRoot:{}},{RaidTopSubRoot:{}})},transitionAdvScene:function(t){var e=this;h.startAdv(t.getStoryId(),0,[d.createAdvTextInfo(t.getStoryId(),c.getFileNameStoryEventScript(t.getStoryGroupId(),t.getResourceId()),c.getFileNameStoryEventSynopsis(t.getStoryGroupId(),t.getResourceId()))],null,null,function(){e.pushScene("RaidScene",null,{RaidQuestSelectSubRoot:{}},null)})},transitionBattleScene:function(t,e,i,a){var o=this.getRaidBattleMasterMap()[t.getStageId()],r=this.getRaidBattleTypeMasterMap()[o.getRaidBattleType()];S.setRaidStartBattleData(t,e.stage,e.raidBattleSession,r.getMaxTurn(),S.createSessionObjectData(e.session.sessionId,e.session.stageId,e.session.deckId,R.DECK_TYPE.QUEST),S.createBattleCallbacks(this.requestSaveBattleTransaction,this.requestEndBattle,this.requestEndBattle,this.transitionEventForEndBattle.bind(this))),n.soundManager.bgmStop(),i&&"function"==typeof i&&i();this.pushScene("battleLoading",void 0,{},void 0),a&&"function"==typeof a&&a()},transitionEventForEndBattle:function(t){g.getRoot().popScene()},requestGetList:function(t){n.RaidService.getList(this.getEventId(),function(e){t&&t()})},requestGetDetail:function(t,e){n.RaidService.getDetail(t,function(t){e&&e(),this.openRaidBattleDetailConfirmPopup("\u30ec\u30a4\u30c9\u8a73\u7d30",t.raidBattleSession,t.entryUsers,0)}.bind(this))},requestReadStory:function(t,e){var i=t.getQuestStartUserStoryModel(),a=t.getQuestStartStoryMaster(),o=g.loadLocalStorage(b.TRIGGER_PREFIX_NAME.RAID_BOSS+t.getAreaId(),0,T.LOCAL_STORAGE_GET_TYPE.INTEGER);i?n.StoryService.readStory(a.getStoryId(),function(){!i.getIsRead()&&o>0&&g.saveLocalStorage(b.TRIGGER_PREFIX_NAME.RAID_BOSS+t.getAreaId(),o-1),this.transitionAdvScene(a)}.bind(this)):n.StoryService.addStory(a.getStoryId(),function(){n.StoryService.readStory(a.getStoryId(),function(){o>0&&g.saveLocalStorage(b.TRIGGER_PREFIX_NAME.RAID_BOSS+t.getAreaId(),o-1),this.transitionAdvScene(a)}.bind(this))}.bind(this))},requestAppearBattle:function(t,e,i,a,o){var r=this._userStageFlatMap[e];n.RaidService.appearBattle(t,e,i,a,function(t){switch(cc.log(t),o&&o(t),t.resultStatus){case A.RAID_RESULT_STATUS.MAX_ENTRY_COUNT_OVER:p.openCommonPopupOk("\u53c2\u52a0\u5236\u9650","\u540c\u6642\u306b\u53c2\u52a0\u3067\u304d\u308b\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u306f\n\u6700\u5927"+A.RAID_ENTRY_LIMIT_COUNT+"\u3064\u307e\u3067\u3067\u3059\u3002","",!1,this.popScene.bind(this),"OK");break;case A.RAID_RESULT_STATUS.MAX_APPEAR_COUNT_OVER:p.openCommonPopupOk("\u6311\u6226\u5236\u9650","\u30af\u30a8\u30b9\u30c8\u9078\u629e\u304b\u3089\u958b\u59cb\u3067\u304d\u308b\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u306f\n\u6700\u5927"+A.RAID_APPEAR_LIMIT_COUNT+"\u3064\u307e\u3067\u3067\u3059\u3002","",!1,function(){});break;default:this.transitionBattleScene(r,t,null,null)}}.bind(this))},requestStartBattle:function(t,e,i){n.RaidService.startBattle(t,e,function(t){switch(i&&i(),t.resultStatus){case A.RAID_RESULT_STATUS.NON:var e=this.getStageMasterFlatMap()[t.session.stageId];this.transitionBattleScene(e,t,null,null);break;case A.RAID_RESULT_STATUS.FINISHED:this.requestGetList(),p.openCommonPopupOk("\u30d0\u30c8\u30eb\u7d50\u679c","\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u304c\u30ec\u30a4\u30c9\u30dc\u30b9\u3092\u8a0e\u4f10\u3057\u307e\u3057\u305f\u3002","",!1,this.popScene.bind(this),"OK");break;case A.RAID_RESULT_STATUS.TIME_OVER:case A.RAID_RESULT_STATUS.OTHER_TIME_OVER:this.requestGetList(),p.openCommonPopupOk("\u6642\u9593\u5236\u9650","\u51fa\u6483\u3057\u305f\u30ec\u30a4\u30c9\u306f\u5236\u9650\u6642\u9593\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002","",!1,this.popScene.bind(this),"OK");break;case A.RAID_RESULT_STATUS.MAX_ENTRY_COUNT_OVER:this.requestGetList(),p.openCommonPopupOk("\u53c2\u52a0\u5236\u9650","\u540c\u6642\u306b\u53c2\u52a0\u3067\u304d\u308b\u30ec\u30a4\u30c9\u30d0\u30c8\u30eb\u306f\n\u6700\u5927"+A.RAID_ENTRY_LIMIT_COUNT+"\u3064\u307e\u3067\u3067\u3059\u3002","",!1,this.popScene.bind(this),"OK");break;case A.RAID_RESULT_STATUS.ENTRY_LIMIT_OVER:this.requestGetList(),p.openCommonPopupOk("\u4eba\u6570\u5236\u9650","\u51fa\u6483\u3057\u305f\u30ec\u30a4\u30c9\u306f\u6700\u5927\u53c2\u52a0\u4eba\u6570\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002","",!1,this.popScene.bind(this),"OK")}}.bind(this))},requestEndBattle:function(t,e,i,a){var o=n.dao.userQuests,r=_.find(n.dao.userQuests,function(t){return t.getStageId()===e});n.RaidService.endBattle(t,function(t){m.saveUnLockEffectForRaidBoss(r,o),cc.log(t),a&&a(t)})},requestSendRescue:function(t,e){n.RaidService.sendRescue(t,function(t){cc.log(t),e&&e(t),this.reload(),this.redraw()}.bind(this))},requestReceiveResult:function(t,e){n.RaidService.receiveResult(t,function(t){t.raidBattleSession.finishStatus===A.RAID_FINISH_STATUS.WIN?this.openRaidResultPopup(t):this.openRaidBattleDetailConfirmPopup("\u30ec\u30a4\u30c9\u78ba\u8a8d",t.raidBattleSession,t.entryUsers,3,function(){this.reload(),this.redraw()}.bind(this)),e&&e(t)}.bind(this))},getEventId:function(){return this._eventMainMaster.getEventId()},getEventMainMaster:function(){return this._eventMainMaster},getWorldMaster:function(){return this._worldMaster},getEventCharacterId:function(){return this._eventCharacterMasterArray[0].getCharacterId()},getUserStageFlatMap:function(){return this._userStageFlatMap},getStageMasterFlatMap:function(){return this._stageMasterFlatMap},getStageStoryInfo:function(t){if(this._questStoryInfoMap[t.getWorldId()]&&this._questStoryInfoMap[t.getWorldId()][t.getAreaId()])return this._questStoryInfoMap[t.getWorldId()][t.getAreaId()].storyInfoArray.find(function(e){return e.storyMaster.getStageId()===t.getStageId()})},getRaidBattleMasterMap:function(){return this._raidBattleMasterMap},getRaidBattleTypeMasterMap:function(){return this._raidBattleTypeMasterMap},getCurrentRaidBattleList:function(){return n.dao.userRaid},getSelfRaidBattleSessions:function(){return this.getCurrentRaidBattleList().getEntryRaidBattleSessions().filter(function(t){return t.discovererId===n.dao[n.USER].getUserCd()})},getUnfinishedRaidBattleSessions:function(){return this.getCurrentRaidBattleList().getEntryRaidBattleSessions().filter(function(t){return t.finishStatus===A.RAID_FINISH_STATUS.NON})},getFinishedRaidBattleSessions:function(){return r.getFinishedRaidBattleSessions(this.getCurrentRaidBattleList().getEntryRaidBattleSessions())},getNextRescueEnableDate:function(t){return cc.log(this.getCurrentRaidBattleList()),this.getCurrentRaidBattleList().getNextRescueEnableDateList().find(function(e){return e.sessionId===t})}});cc._RF.pop()},{BattleFunction:"BattleFunction",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckConst:"DeckConst",EventQuestConst:"EventQuestConst",EventUtils:"EventUtils",ExtensionAdvUtils:"ExtensionAdvUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestRootBase:"QuestRootBase",QuestUtils:"QuestUtils",RaidConst:"RaidConst",RaidUtils:"RaidUtils",RaidViewSetting:"RaidViewSetting",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",StoryConst:"StoryConst",StoryUtils:"StoryUtils",UnlockEffectConst:"UnlockEffectConst",UnlockEffectUtils:"UnlockEffectUtils"}],RaidSendRescueConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"b807erEyWRNG7T/Hf9Z0yXc","RaidSendRescueConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("TimeUtils");cc.Class({extends:a,properties:{remainTimeParentNode:cc.Node,remainTimeLabel:cc.Label,descriptionLabel:cc.Label,cancelBtn:n,executeBtn:n},_nextRescueEnableDate:null,openRaidSendRescueConfirmPopup:function(t,e,i){this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.executeBtn.setTapEvent(function(){this.close(),i()}.bind(this)),this._initRaidSendRescueConfirmPopup(t,e),this.open()},_initRaidSendRescueConfirmPopup:function(t,e){this._nextRescueEnableDate=t,this.descriptionLabel.string="\u6551\u63f4\u4f9d\u983c\u306f"+Math.floor(e.getRescueInterval()/60)+"\u5206\u304a\u304d\u306b\u9001\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002",o.getDiffMS(this._nextRescueEnableDate.date,!0)<0?(this.remainTimeParentNode.active=!1,this.executeBtn.setTouchEnable(!0),this.executeBtn.switchBtnImage(!0)):(this.executeBtn.setTouchEnable(!1),this.executeBtn.switchBtnImage(!1),this.remainTimeParentNode.active=!0,this._updateRemainTime(),this.schedule(this._updateRemainTime.bind(this),1))},_updateRemainTime:function(){if(o.getDiffMS(this._nextRescueEnableDate.date,!0)<0)return this.executeBtn.setTouchEnable(!0),this.executeBtn.switchBtnImage(!0),this.unschedule(this._updateRemainTime.bind(this)),void(this.remainTimeParentNode.active=!1);var t=o.getDiffHms(this._nextRescueEnableDate.date).split(":");t.splice(0,1),this.remainTimeLabel.string=t.join(":")}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",TimeUtils:"TimeUtils"}],RaidService:[function(t,e,i){"use strict";cc._RF.push(e,"ec2f33jnVpPxZSTIrSC+FQj","RaidService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getList:function(t,e){var i={eventId:t};this._requestCallApi(n.RAID_GET_LIST,i,function(t,i){return e(t?void 0:i)})},getDetail:function(t,e){var i={raidCd:t};this._requestCallApi(n.RAID_GET_DETAIL,i,function(t,i){return e(t?void 0:i)})},sendRescue:function(t,e){var i={raidCd:t};this._requestCallApi(n.RAID_SEND_RESCUE,i,function(t,i){return e(t?void 0:i)})},appearBattle:function(t,e,i,a,o){var r={eventId:t,stageId:e,deckId:i,isAutoRescue:a};this._requestCallApi(n.RAID_APPEAR_BATTLE,r,function(t,e){return o(t?void 0:e)})},startBattle:function(t,e,i){var a={raidCd:t,deckId:e};this._requestCallApi(n.RAID_START_BATTLE,a,function(t,e){return i(t?void 0:e)})},endBattle:function(t,e){var i={parameter:t};this._requestCallApi(n.RAID_END_BATTLE,i,function(t,i){return e(t?void 0:i)})},receiveResult:function(t,e){var i={raidCd:t};this._requestCallApi(n.RAID_RECEIVE_RESULT,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],RaidTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"8b362ngr3dNuLXa5E0Gl45p","RaidTopSubRoot");var a=t("CommonButton"),n=t("PopupUtils"),o=t("ResourceUtils"),r=t("TimeUtils"),s=t("EventUtils"),c=t("CommonUtils"),l=t("EventQuestTopSubRootBase"),u=t("EventQuestPointFrameThumbnail");cc.Class({extends:l,properties:{raidBattleAppearViewPrefab:cc.Prefab,raidBattleAppearViewParentNode:cc.Node,eventQuestPointFrameThumbnail:u,gachaBannerImageSprite:cc.Sprite,rewardBtn:a,gachaBtn:a},_root:null,_raidBattleAppearView:null,onLoad:function(){this._super(),s.hasEventPointMaster(c.getRoot().getEventId())?this.rewardBtn.setTapEvent(this._onTapRewardBtn.bind(this)):this.rewardBtn.node.parent.active=!1,this.gachaBtn.setTapEvent(this._onTapGachaBtn.bind(this))},initRaidTopSubRoot:function(t){this._root=t,this.eventStageSelectBtn.switchBtnImage(r.isRangeOfDate(this._root.getWorldMaster().getFromDate(),this._root.getWorldMaster().getToDate())),this._initEventCharacterInfo(),this._setCharacterAvatar(),this._initRaidBattleAppearView(t),this._initLogo(),this._initEndDate(),this._initGachaBanner(),this.eventQuestPointFrameThumbnail.initWindowFrame()},_initRaidBattleAppearView:function(t){this._raidBattleAppearView||(this._raidBattleAppearView=cc.instantiate(this.raidBattleAppearViewPrefab).getComponent("RaidBattleAppearView"),this.raidBattleAppearViewParentNode.addChild(this._raidBattleAppearView.node)),this._raidBattleAppearView.initRaidBattleAppearView(t.getEventId(),t.getCurrentRaidBattleList(),t.getCurrentSceneName(),{RaidTopSubRoot:{}})},_initGachaBanner:function(){o.addSprite(this.gachaBannerImageSprite,o.getFileNameEventGachaBanner(this._root.getEventId()))},_initEndDate:function(){var t="\u7d42\u4e86\u65e5\u6642\uff1a"+r.parseTimeToYmdhm(this._root.getWorldMaster().getToDate())+" \u307e\u3067";this.endDateLabel.string=t},_onTapRewardBtn:function(){this._root.openEventQuestPointRewardListPopup()},_onTapMissionBtn:function(){this._root.transitionMissionScene()},_onTapHowToPlayBtn:function(){this._root.openEventQuestHowToPlayPopup()},_onTapGachaBtn:function(){this._root.transitionRaidGachaTopSubRoot()},_onTapEventStageSelectBtn:function(){r.isRangeOfDate(this._root.getWorldMaster().getFromDate(),this._root.getWorldMaster().getToDate())?this._root.pushRaidQuestSelectSubRoot():n.openSimpleMessageWindow("\u30a4\u30d9\u30f3\u30c8\u30af\u30a8\u30b9\u30c8\u6311\u6226\u671f\u9593\u306f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002")}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EventQuestPointFrameThumbnail:"EventQuestPointFrameThumbnail",EventQuestTopSubRootBase:"EventQuestTopSubRootBase",EventUtils:"EventUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils"}],RaidUtils:[function(t,e,i){"use strict";cc._RF.push(e,"d14dcji6Y1IX7R0+jTxIgwG","RaidUtils");var a=t("Singleton"),n=t("RaidConst");e.exports={getFinishedRaidBattleSessions:function(t){return t.filter(function(t){return t.finishStatus!==n.RAID_FINISH_STATUS.NON})},createRaidBattleMasterMap:function(t){var e=a.dao.RaidBattleMasters.filter(function(e){return e.getEventId()===t}),i={};for(var n in e)i[e[n].getStageId()]=e[n];return i},createRaidBattleTypeMasterMap:function(){var t=a.dao.RaidBattleTypeMasters,e={};for(var i in t)e[t[i].getRaidBattleType()]=t[i];return e},calcRaidEntryCount:function(t){return t.reduce(function(t,e){return t+e.users.length},0)},calcRaidTotalDamage:function(t,e){return e=e||0,t.reduce(function(t,e){return t+e.score*e.users.length},e)}},cc._RF.pop()},{RaidConst:"RaidConst",Singleton:"Singleton"}],RaidViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"2cc5emAT69OC7hfQ9+XY0xB","RaidViewSetting");var a=t("RaidRootUtils");e.exports={RAID_SETTING:{RaidTopSubRoot:{open:a.openRaidTopSubRoot,close:a.closeRaidTopSubRoot},RaidQuestSelectSubRoot:{open:a.openRaidQuestSelectSubRoot,close:a.closeRaidQuestSelectSubRoot},RaidBattleSelectSubRoot:{open:a.openRaidBattleSelectSubRoot,close:a.closeRaidBattleSelectSubRoot},RaidBattleStartConfirmSubRoot:{open:a.openRaidBattleStartConfirmSubRoot,close:a.closeRaidBattleStartConfirmSubRoot}}},cc._RF.pop()},{RaidRootUtils:"RaidRootUtils"}],RankUpPopupBase:[function(t,e,i){"use strict";cc._RF.push(e,"40984Q5FRZHQq+lylQWxy3B","RankUpPopupBase");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=t("UserUtils"),s=cc.Enum({START:0,LOOP:1});cc.Class({extends:a,properties:{rankUpAnimation:cc.Animation,beforeLevelLabel:cc.Label,afterLevelLabel:cc.Label,beforeMaxApLabel:cc.Label,afterMaxApLabel:cc.Label,beforeMaxBpLabel:cc.Label,afterMaxBpLabel:cc.Label,beforeEtcLabel:cc.Label,afterEtcLabel:cc.Label,okButton:n},onLoad:function(){this.okButton.setTapEvent(this._onTapOkBtn.bind(this))},openRankUpPopup:function(){var t=this._createLevelParam();this._setParameter(t.beforeLv,t.afterLv),this.open(function(){this._callbackOpenedAnim(),this._callbackFinishedOpenFunc()}.bind(this))},_createLevelParam:function(){return cc.warn("_createBeforeAfterLevel()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),{beforeLv:1,afterLv:1}},_callbackFinishedOpenFunc:function(){cc.warn("_callbackFinishedOpenFunc()\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_callbackOpenedAnim:function(){this.rankUpAnimation.once("finished",function(){this.rankUpAnimation.play(this.rankUpAnimation.getClips()[s.LOOP].name)},this),this.rankUpAnimation.play(this.rankUpAnimation.getClips()[s.START].name)},_setBeforeAfterLabel:function(t,e,i,a){i<=-1&&a<=-1?t.node.parent.active=!1:(t.string=o.convertToCommaDelimited(i),e.string=o.convertToCommaDelimited(a))},_setBeforeAfterLevel:function(t,e){this._setBeforeAfterLabel(this.beforeLevelLabel,this.afterLevelLabel,t,e)},_setBeforeAfterAp:function(t,e){var i=r.getMaxStaminaByLevel(t),a=r.getMaxStaminaByLevel(e);this._setBeforeAfterLabel(this.beforeMaxApLabel,this.afterMaxApLabel,i,a)},_setBeforeAfterBp:function(t,e){var i=r.getMaxBpByLevel(t),a=r.getMaxBpByLevel(e);this._setBeforeAfterLabel(this.beforeMaxBpLabel,this.afterMaxBpLabel,i,a)},_setBeforeAfterEtc:function(t,e){this._setBeforeAfterLabel(this.beforeEtcLabel,this.afterEtcLabel,-1,-1)},_setParameter:function(t,e){this._setBeforeAfterLevel(t,e),this._setBeforeAfterAp(t,e),this._setBeforeAfterBp(t,e),this._setBeforeAfterEtc(t,e)},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",PopupBase:"PopupBase",UserUtils:"UserUtils"}],RecommendedMaterialSelectPopup:[function(t,e,i){"use strict";cc._RF.push(e,"2659ba3S3VISL6z6LLlX26p","RecommendedMaterialSelectPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{checkBoxToggleArray:[cc.Toggle],centerLabel:cc.Label,executeBtn:n,cancelBtn:n},onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},_callbackToExecuteBtn:null,openRecommendedMaterialSelectPopup:function(t,e,i){this.centerLabel.string=t,this._callbackToExecuteBtn=i,this._initCheckBoxToggleArray(e),this.open()},_initCheckBoxToggleArray:function(t){for(var e=0;e<this.checkBoxToggleArray.length;e+=1)this.checkBoxToggleArray[e].isChecked=!!t[e]},_createFilterCheckList:function(){var t=[];for(var e in this.checkBoxToggleArray)t.push(this.checkBoxToggleArray[e].isChecked);return t},_onTapExecuteBtn:function(){this.close(),this._callbackToExecuteBtn(this._createFilterCheckList(this.checkBoxToggleArray))},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],ResLeakChecker:[function(t,e,i){"use strict";cc._RF.push(e,"10defSMr/RMyoN8rkHaOgWh","ResLeakChecker");var a=function(){function t(){this.resFilter=null,this._checking=!1,this._log=new Map}return t.findCharPos=function(t,e,i){for(var a=t.indexOf(e),n=a,o=0;o<i;o++){if(-1==(a=t.indexOf(e,a+1)))return n;n=a}return n},t.getCallStack=function(e){var i=(new Error).stack,a=t.findCharPos(i,"\n",e);return a>0&&(i=i.slice(a)),i},t.prototype.checkFilter=function(t){return!!this._checking&&(!this.resFilter||this.resFilter(t))},t.prototype.logLoad=function(e,i,a){if(this.checkFilter(e)){this._log.has(e)||this._log.set(e,new Map);var n=this._log.get(e);n.has(i)&&console.warn("ResLeakChecker doubel same use "+e+" : "+i+", stack "+n[i]),n.set(i,a||t.getCallStack(2))}},t.prototype.logRelease=function(t,e){if(this.checkFilter(t))if(this._log.has(t)){var i=this._log.get(t);i.has(e)?i.delete(e):console.warn("ResLeakChecker use nofound "+t+" : "+e)}else console.warn("ResLeakChecker url nofound "+t+" : "+e)},t.prototype.startCheck=function(){this._checking=!0},t.prototype.stopCheck=function(){this._checking=!1},t.prototype.getLog=function(){return this._log},t.prototype.resetLog=function(){this._log=new Map},t.prototype.dump=function(){this._log.forEach(function(t,e){cc.log(e),t.forEach(function(t,e){cc.log(e+" : "+t)})})},t}();e.exports={ResLeakChecker:a},cc._RF.pop()},{}],ResLoader:[function(t,e,i){"use strict";cc._RF.push(e,"182fel6aA1EtrOLfZDxcv2D","ResLoader");var a=t("ResLeakChecker"),n=cc.js.isChildClassOf;n||(n=cc.isChildClassOf);var o=cc.loader,r=function(){function t(){var t=this;this._resMap=new Map,this._globalUseId=0,this._lastScene=null,this._sceneDepends=null,this.resLeakChecker=null,this.tmpInfo={path:"",type:null};var e=cc.director.getScene();e&&this._cacheScene(e),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,function(e){t._cacheScene(e)})}return t.prototype._getResItem=function(t,e){var i=o._cache[t];if(!i){var a=o._getResUuid(t,e,!1);if(a){var n=o._getReferenceKey(a);i=o._cache[n]}}return i},t.makeLoadResArgs=function(){if(arguments.length<1)return console.error("_makeLoadResArgs error "+arguments),null;var t={};if("string"==typeof arguments[0])t.url=arguments[0];else{if(!(arguments[0]instanceof Array))return console.error("_makeLoadResArgs error "+arguments),null;t.urls=arguments[0]}for(var e=1;e<arguments.length;++e)1==e&&n(arguments[e],cc.RawAsset)?t.type=arguments[e]:e==arguments.length-1&&"string"==typeof arguments[e]?t.use=arguments[e]:"function"==typeof arguments[e]&&(arguments.length>e+1&&"function"==typeof arguments[e+1]?t.onProgess=arguments[e]:t.onCompleted=arguments[e]);return t},t.makeReleaseResArgs=function(){if(arguments.length<1)return console.error("_makeReleaseResArgs error "+arguments),null;var t={};if("string"==typeof arguments[0])t.url=arguments[0];else{if(!(arguments[0]instanceof Array))return console.error("_makeReleaseResArgs error "+arguments),null;t.urls=arguments[0]}for(var e=1;e<arguments.length;++e)"string"==typeof arguments[e]?t.use=arguments[e]:t.type=arguments[e];return t},t.prototype.makeUseKey=function(t,e,i){return void 0===e&&(e="none"),void 0===i&&(i=""),"use_"+t+"_by_"+e+"_for_"+i},t.prototype.nextUseKey=function(){return"@"+ ++this._globalUseId},t.prototype.getCacheInfo=function(t){return this._resMap.has(t)||this._resMap.set(t,{refs:new Set,uses:new Set}),this._resMap.get(t)},t.prototype.getUrlByAsset=function(t){var e=t;return e&&e._uuid?o._getReferenceKey(e._uuid):(console.error("getUrlByAssets error "+t),null)},t.prototype.addUse=function(t,e){if(this._resMap.has(t)){var i=this._resMap.get(t).uses;return!i.has(e)&&(i.add(e),this.resLeakChecker&&this.resLeakChecker.logLoad(t,e),!0)}return!1},t.prototype._buildDepend=function(t,e){if(t&&t.dependKeys&&Array.isArray(t.dependKeys))for(var i=0,a=t.dependKeys;i<a.length;i++){var n=a[i];if(!this.getCacheInfo(n).refs.has(e)){this.getCacheInfo(n).refs.add(e);var o=cc.loader._cache[n];o&&this._buildDepend(o,o.id)}}},t.prototype._cacheItem=function(t,e,i){if(t&&t.id){var a=this.getCacheInfo(t.id);return e&&(a.uses.add(e),this.resLeakChecker&&this.resLeakChecker.logLoad(t.id,e,i)),a.refs.has(t.id)||(a.refs.add(t.id),this._buildDepend(t,t.id)),!0}return!1},t.prototype._finishItem=function(t,e,i,a){var n=this._getResItem(t,e);this._cacheItem(n,i,a)||cc.log("addDependKey item error! for "+t)},t.prototype._releaseSceneDepend=function(){if(this._sceneDepends){for(var e=0;e<this._sceneDepends.length;++e)this.releaseRes(this._sceneDepends[e],t._sceneUseKey);this._sceneDepends=null}},t.prototype._cacheSceneDepend=function(t,e){for(var i=0;i<t.length;++i){var a=o._cache[t[i]];this._cacheItem(a,e)}return t},t.prototype._cacheScene=function(e){if(e.name!=this._lastScene){var i=o._getReferenceKey(e.uuid),a=o._cache[i],n="@Scene"+this.nextUseKey(),r=null;if(a)r=this._cacheSceneDepend(a.dependKeys,n);else{if(!e.dependAssets)return void console.error("cache scene faile "+e);r=this._cacheSceneDepend(e.dependAssets,n)}this._releaseSceneDepend(),this._lastScene=e.name,t._sceneUseKey=n,this._sceneDepends=r}},t.prototype.loadRes=function(){var e,i=this,n=t.makeLoadResArgs.apply(this,arguments);this.resLeakChecker&&this.resLeakChecker.checkFilter(n.url)&&(e=a.ResLeakChecker.getCallStack(1));var o=function(t,a){t||i._finishItem(n.url,n.type,n.use,e),n.onCompleted&&n.onCompleted(t,a)},r=cc.loader.getRes(n.url,n.type);r?o(null,r):cc.loader._getResUuid(n.url,n.type,!1)?cc.loader.loadRes(n.url,n.type,n.onProgess,o):cc.loader.load(n.url,n.onProgess,o)},t.prototype.loadArray=function(){var e,i=this,a=t.makeLoadResArgs.apply(this,arguments);this.resLeakChecker&&this.resLeakChecker.checkFilter(a.url)&&(e=ResLeakChecker_1.ResLeakChecker.getCallStack(1));cc.loader.loadResArray(a.urls,a.type,a.onProgess,function(t,n,o){if(!t)for(var r=0;r<a.urls.length;++r)i._finishItem(a.urls[r],a.type,a.use,e);a.onCompleted&&a.onCompleted(t,n)})},t.prototype.loadResDir=function(){var e,i=this,a=t.makeLoadResArgs.apply(this,arguments);this.resLeakChecker&&this.resLeakChecker.checkFilter(a.url)&&(e=ResLeakChecker_1.ResLeakChecker.getCallStack(1));cc.loader.loadResDir(a.url,a.type,a.onProgess,function(t,n,o){if(!t&&o)for(var r=0;r<o.length;++r)i._finishItem(o[r],a.type,a.use,e);a.onCompleted&&a.onCompleted(t,n,o)})},t.prototype.releaseArray=function(){for(var e=t.makeReleaseResArgs.apply(this,arguments),i=0;i<e.urls.length;++i)this.releaseRes(e.urls[i],e.type,e.use)},t.prototype.releaseResDir=function(){var e=t.makeReleaseResArgs.apply(this,arguments),i=[];cc.loader._assetTables.assets.getUuidArray(e.url,e.type,i);for(var a=0;a<i.length;++a)this.releaseRes(i[a],e.type,e.use)},t.prototype.releaseAsset=function(t,e){if(t&&t._uuid){var i=o._getReferenceKey(t._uuid);if(i){var a=o._cache[i];if(a){var n=this.getCacheInfo(i);e&&(n.uses.delete(e),this.resLeakChecker&&this.resLeakChecker.logRelease(i,e)),0==n.uses.size&&this._release(a,i)}}}},t.prototype.releaseRes=function(){var e=t.makeReleaseResArgs.apply(this,arguments),i=this._getResItem(e.url,e.type);if(i){var a=this.getCacheInfo(i.id);e.use&&(a.uses.delete(e.use),this.resLeakChecker&&this.resLeakChecker.logRelease(i.id,e.use)),0==a.uses.size&&this._release(i,i.id)}},t.prototype._release=function(t,e){var i=this.getCacheInfo(t.id);if(t&&i.refs.has(e)){i.refs.delete(e);var a=cc.loader;if(0==i.uses.size&&0==i.refs.size){if(t.dependKeys&&Array.isArray(t.dependKeys))for(var n=0,o=t.dependKeys;n<o.length;n++){var r=o[n],s=a._cache[r];s&&this._release(s,t.id)}t.uuid?cc.loader.release(t.uuid):cc.loader.release(t.id),this._resMap.delete(t.id)}}},t.prototype._isSceneDepend=function(t){var e=cc.director.getScene();if(!e)return!1;for(var i=e.dependAssets.length,a=0;a<i;++a)if(e.dependAssets[a]==t)return!0;return!1},t.prototype.canRelease=function(t,e){var i=this.getCacheInfo(t);return!(i.refs.size>1||!i.refs.has(t))&&!(i.uses.size>1||!i.uses.has(e))},t.prototype.checkReleaseUse=function(){var e=t.makeReleaseResArgs.apply(this,arguments),i=this._getResItem(e.url,e.type);if(!i)return cc.log("cant release,item is null "+e.url+" "+e.type),!0;var a=this.getCacheInfo(i.id),n=!1,o=!1;return n=!(e.use&&a.uses.size>0)||!(1!=a.uses.size||!a.uses.has(e.use)),o=!!(1==a.refs.size&&a.refs.has(i.id)||0==a.refs.size),n&&o},t.prototype.getOrgUrlOfItem=function(t){},t.prototype.showAllCacheInfo=function(){var t=cc.loader,e={};for(var i in t._cache){var a=t._cache[i],n=a.type;"js"==n?e[i]=n:"uuid"==n&&(e[a.uuid]=n)}},t}();e.exports={loader:new r},cc._RF.pop()},{ResLeakChecker:"ResLeakChecker"}],ResourceConst:[function(t,e,i){"use strict";cc._RF.push(e,"1132fyN65dEaKpVs9U++ptB","ResourceConst");cc.Class({statics:{SOUND_FILE_PATH_PREFIX:"download/sound/",SOUND_FILE_PATH_CONJUNCTION:cc.Enum({BGM:"bgm/",SE:"se/",VOICE:"voice/"}),BACKGROUND_FILE_PATH_PREFIX:"download/bg/",SORT_FILTER_POPUP_PREFAB_PATH:{CHARACTER_BASE:"prefab/outGame/common/sortFilter/CharacterBaseSortFilterPopup",CHARACTER_FORTIFY:"prefab/outGame/common/sortFilter/CharacterFortifySortFilterPopup",CHARACTER_SELL:"prefab/outGame/common/sortFilter/CharacterSellSortFilterPopup",EQUIPMENT_BASE:"prefab/outGame/common/sortFilter/EquipmentBaseSortFilterPopup",EQUIPMENT_FORTIFY:"prefab/outGame/common/sortFilter/EquipmentFortifySortFilterPopup",EQUIPMENT_WAREHOUSE:"prefab/outGame/common/sortFilter/WarehouseEquipmentSortFilterPopup",STORAGE_CHARACTER_WAREHOUSE:"prefab/outGame/common/sortFilter/WarehouseStorageCharacterSortFilterPopup",STORAGE_EQUIPMENT_WAREHOUSE:"prefab/outGame/common/sortFilter/WarehouseStorageEquipmentSortFilterPopup",STORAGE_MATERIAL_WAREHOUSE:"prefab/outGame/common/sortFilter/WarehouseStorageMaterialSortFilterPopup"},DECK_EQUIPMENT_ALL_REMOVE_CONFIRM_POPUP_PREFAB_PATH:"prefab/outGame/deck/window/EquipmentAllRemoveConfirmPopup",CHARACTER_FILE_PATH_PREFIX:"download/character/",CHARACTER_FILE_PATH_CONJUNCTION:cc.Enum({IMAGE:"/image/",SOUND:"/sound/",SPINE:"/spine/",SE:"/se/"}),CHARACTER_FILE_PATH_SUFFIX:cc.Enum({STAND:"stand",MAIN:"main",MAIN_D:"main_d",MAIN_F:"main_f",MAIN_C:"main_c",MAIN_M:"main_m",MAIN_S:"main_s",COSTUME:"costume",MINIGAME:"minigame",ROOM_CARD:"img_room_card",THUMB:"thumb",THUMB_PARTY_SUB:"thumb_party_sub",BATTLE_THUMB:"battle_thumb",CUTIN:"cutin",UNISON_THUMB:"unison_thumb",SPINE_DEF:"def/",SPINE_HIT:"hit/",SPINE_SKILL:"skill/",SPINE_ROOM:"room/room",SPINE_HOME:"home/",SPINE_SD:"sd/sd"}),CHARACTER_GROUP_FILE_PATH_PREFIX:"download/charactergroup/",CHARACTER_GROUP_FILE_PATH_CONJUNCTION:cc.Enum({IMAGE:"/image/",SOUND:"/sound/"}),CHARACTER_GROUP_FILE_PATH_SUFFIX:cc.Enum({STAND:"stand",ROOM_CARD:"img_room_card"}),MONSTER_FILE_PATH_PREFIX:"download/monster/",MONSTER_FILE_PATH_CONJUNCTION:cc.Enum({IMAGE:"/image/",SOUND:"/sound/",SPINE:"/spine/"}),MONSTER_FILE_PATH_SUFFIX:cc.Enum({THUMB:"thumb",CUTIN:"cutin",SP_DEF:"def/",SPINE_HIT:"hit/",SPINE_SKILL:"skill/"}),FURNITURE_IMAGE_PATH:"download/furniture/image/",FURNITURE_SMALL_PATH:"download/furniture/small/",FURNITURE_THUMBNAIL_PATH:"download/furniture/thumb/",EQUIPMENT_THUMBNAIL_PATH:"download/equipment/thumbnail/",ITEM_THUMBNAIL_PATH:"download/item/thumbnail/",ITEM_IMAGE_PATH:"download/item/image/",MYPAGE_BANNER_PATH:"download/banner/image/",USER_HELP_PATH:"download/help/",PVP_CLASS_ICON_PATH:"download/pvp/class/icon/",QUEST_WORLD_PATH_PREFIX:"download/quest/world/",QUEST_WORLD_PATH_SUFFIX:cc.Enum({BG:"bg/",THUMB:"thumbnail/",THUMB_S:"thumbnail_s/"}),QUEST_DEFAULT_QUEST_BG:"download/quest/world/bg/questTop_01",QUEST_AREA_PATH_PREFIX:"download/quest/area/",QUEST_AREA_PATH_SUFFIX:cc.Enum({BG:"bg/",IMAGE:"image/",THUMB:"thumbnail/"}),QUEST_TOWER_PATH_PREFIX:"download/quest/tower/",QUEST_TOWER_PATH_SUFFIX:cc.Enum({BG:"bg/"}),QUEST_EVENT_PATH:"download/quest/event/",QUEST_EVENT_PATH_SUFFIX:cc.Enum({BANNER:"/banner",THUMBNAIL:"/thumbnail",GACHA_BANNER:"/gacha_banner",GACHA_LOGO:"/gacha_logo",LOGO:"/logo"}),QUEST_DIFFICULT_PATH_PREFIX:"download/quest/difficult/",QUEST_DIFFICULT_PATH_SUFFIX:cc.Enum({BAND:"band/",ICON:"icon/",THUMBNAIL_BACK:"thumb_back/"}),STORY_QUEST_FILE_PATH:"download/adv/text/quest/",STORY_EVENT_FILE_PATH:"download/adv/text/event/",STORY_OTHER_FILE_PATH:"download/adv/text/other/",STORY_ROOM_FILE_PATH:"download/adv/text/room/",STORY_TUTORIAL_FILE_PATH:"download/adv/text/tutorial/",STORY_TUTORIAL_FILE_PATH_CONJUNCTION:cc.Enum({ADULT_R:"adultr/",ADULT_W:"adultw/"}),STORY_PICTURE_BOOK_DETAIL_FILE_PATH:"download/adv/text/character/",STORY_PICTURE_BOOK_FILE_PATH_CONJUNCTION:cc.Enum({NORMAL:"/extra/",ADULT_R:"/adultr/",ADULT_W:"/adultw/"}),STORY_CATEGORY_THUMBNAIL_PATH:"download/story/category/thumb/",SHOP_TOP_THUMBNAIL_PATH:"download/shop/main/thumbnail/",SHOP_ITEM_THUMBNAIL_PATH:"download/shop/detail/thumbnail/",SHOP_ITEM_THUMBNAIL_L_PATH:"download/shop/detail/thumbnail_l/",DMM_PURCHASE_IMAGE_PATH:"download/purchase/image/",MYPAGE_BG_PATH:"download/myPage/image/bg/",MYPAGE_NEWS_BANNER_PATH:"download/myPage/news/banner/",MYPAGE_NEWS_MAIN_CONTENT_IMAGE_PATH:"download/myPage/news/content/",GACHA_BG_PATH_PREFIX:"download/gacha/bg/",GACHA_BG_PATH_SUFFIX:cc.Enum({NON:"",STAND_BG_A:"_stand_bg_a",STAND_BG_N:"_stand_bg_n"}),GACHA_SIDE_BANNER_PATH:"download/gacha/banner/",GACHA_LOGO_PATH:"download/gacha/logo/",GACHA_STEP_UP_THUMBNAIL_PATH:"download/gacha/step/",LOGIN_BONUS_PREFAB_PATH:"prefab/outGame/loginBonus/window/",LOGIN_BONUS_BG_PATH_PREFIX:"download/loginBonus/",LOGIN_BONUS_BG_PATH_SUFFIX:cc.Enum({BG:"bg/"})}});cc._RF.pop()},{}],ResourceDownloadRoot:[function(t,e,i){"use strict";cc._RF.push(e,"df1aaLPYuBMiJrD35qhb2GE","ResourceDownloadRoot");var a=t("GameRootBase"),n=t("Singleton"),o=t("CommonUtils"),r=t("TutorialUtils"),s=t("FileLoaderManager"),c=t("SceneConst"),l=t("SingletonConst"),u=t("LocalDataConst"),h=t("GameConst"),d=(t("MovieController"),t("PopupUtils")),p=t("DownManifestManager"),m=(t("MemoryManager"),cc.Enum({INIT_DATA:0,LOOP_DATA:1,INIT_RESOURCE:2,LOOP_RESOURCE:3,INIT_SCENE:4,LOOP_SCENE:5}));cc.Class({extends:a,properties:{loadingMovie:cc.Prefab,loadingMovieR:cc.Prefab},_sendSceneName:void 0,_sendViewParam:void 0,movieCtrl:null,updateChild:function(t){},initData:function(){r.isTutorialEnded()?this._sendSceneName||this._requestGetLoginBonus():this._sendSceneName=c.SCENE.FILE_NAME.FIRST_LOGIN_AFTER},_requestGetLoginBonus:function(){this.requestURLCount+=1,n.LoginBonusService.getLoginBonus(function(t){t.loginBonus?(this._sendSceneName=c.SCENE.FILE_NAME.LOGIN_BONUS,this._sendViewParam={LoginBonusSubRoot:{loginBonus:t.loginBonus}}):this._sendSceneName=c.SCENE.FILE_NAME.RESTORE_BATTLE,this.requestURLCount-=1}.bind(this))},initResource:function(){if(cc.sys.isNative&&!n.localData[u.IS_CAPACITY_ZIP_AMPLE])switch(o.loadLocalStorage(u.LOCAL_STORAGE_KEY.RESOURCE_DL_TYPE,h.RESOURCE_DL_TYPE.NON,u.LOCAL_STORAGE_GET_TYPE.INTEGER)){case h.RESOURCE_DL_TYPE.ALL:this._resourceRemainLoadCount=100,p.instance.checkNewVersion(function(t,e){t?d.openCommonPopupOk("\u78ba\u8a8d","\u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f","",!1,function(){o.restartGame()}):e?(cc.log("start all resource download..."),o.saveLocalStorage(u.LOCAL_STORAGE_KEY.ALL_RES_POP_TYPE,h.ALL_RES_POP_TYPE.POP),this.addLoadingMovie(),this.beginDownloadAllRes()):this._resourceRemainLoadCount=0}.bind(this))}},initialize:function(){this.pushScene(this._sendSceneName,"",this._sendViewParam,void 0)},addLoadingMovie:function(){n[l.ENVIRONMENT]&&n[l.ENVIRONMENT].getAdultFlg()?this.movieCtrl=cc.instantiate(this.loadingMovieR).getComponent("MovieController"):this.movieCtrl=cc.instantiate(this.loadingMovie).getComponent("MovieController"),this.node.addChild(this.movieCtrl.node),this.movieCtrl.setTapEvent(this._onTapMovie.bind(this)),this.movieCtrl.setCompleteListener(this._onEndMovie.bind(this)),n.soundManager.bgmPause()},beginDownloadAllRes:function(){var t=this;this._resourceRemainLoadCount=100,s.instance.downloadAllResoure(function(e,i){e?d.openSystemPopupYesNo("","\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u5931\u6557\u3057\u307e\u3057\u305f\n\u30ea\u30c8\u30e9\u30a4\u3057\u307e\u3059\u304b\uff1f","",!1,function(){t.beginDownloadAllRes()},function(){t._resourceRemainLoadCount=0},"\u306f\u3044","\u3044\u3044\u3048",!0):t._resourceRemainLoadCount-=i})},_onTapMovie:function(t,e){e.isPlaying()&&(t.pauseVideo(),this.openMovieSkipConfirmPopup(this._onTapMovieSkip.bind(this,t,e),this._onTapMovieResume.bind(this,t,e)))},_onEndMovie:function(t,e){t.removeVideo(),t.node.destroy(),this.movieCtrl=null,n.soundManager.bgmResume()},_onTapMovieSkip:function(t,e){this._onEndMovie(t,e)},_onTapMovieResume:function(t,e){t.resumeVideo()},openMovieSkipConfirmPopup:function(t,e){d.openCommonPopupYesNo("\u30b9\u30ad\u30c3\u30d7\u78ba\u8a8d","\u52d5\u753b\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u304b\uff1f","",!1,t,e,"\u30b9\u30ad\u30c3\u30d7\u3059\u308b","\u30ad\u30e3\u30f3\u30bb\u30eb",!0)},update:function(t){switch(this._super(),this._sceneState){case m.LOOP_RESOURCE:null!==this.movieCtrl?this._loadView&&(this._loadView.node.active=!1):this._loadView&&(this._loadView.node.active=!0)}}});cc._RF.pop()},{CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",GameRootBase:"GameRootBase",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",MovieController:"MovieController",PopupUtils:"PopupUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst",TutorialUtils:"TutorialUtils"}],ResourceManager:[function(t,e,i){"use strict";cc._RF.push(e,"5c998U+YV1EmKSCi2zgHMRG","ResourceManager");var a=t("EnumTypes"),n=t("BattleFunction"),o=t("ResourceUtils"),r=t("BattleConstants"),s=t("FileLoaderManager"),c=t("PictureBookUtils"),l=t("CharacterConst"),u=t("Singleton");function h(t,e,i){s.instance.loadFile(t,e,function(e,a){if(!e)return i(a);cc.error(e+", filename:"+t)})}function d(t,e){s.instance.loadFile(t,cc.SpriteFrame,function(t,i){if(!t)return e(i);cc.error(t),cc.log(t)})}var p=cc.Class({properties:{resourceList:[],particleResFolder:"particle/inGame/spineEffectUse/",stage_bgm:null,normalWaveBgm:null,bossWaveBgm:null,soundResourceList:[],resourceBackground:[]},_playerResourceRemainCount:0,_callBackCompletePlayerResource:null,_completePlayerResource:function(){if(this._playerResourceRemainCount--,this._playerResourceRemainCount<=0)return this._callBackCompletePlayerResource()},loadPlayerResource:function(t,e){this._playerResourceRemainCount=0,this._callBackCompletePlayerResource=e,t.forEach(function(t){var e=t.deckUnit.mainChara.getSpineDirectoryPath(),i=t.deckUnit.mainChara.getSpineName(),r=o.getDirectoryIngameDefSpine(e),s=r+i,p=o.getDirectoryIngameHitSpine(e),m=o.getDirectoryIngameSe(e);this._playerResourceRemainCount++,h(s,sp.SkeletonData,function(e){t.unitObjectSpine=e;var i=t.myNormalAttack.getAniName(),s=t.unitObjectSpine;this._playerResourceRemainCount++,this.loadSpineEventResource(t,r,p,m,s,i,this._completePlayerResource.bind(this));var c=t.mySkill;if(c){var l=c.getEffectShowType();if(l===a.SkillEffectShowType.SPINE_ANI_SHOW){var u=c.getSpineDirectoryPath(),d=c.getAniName(),_=(o.getDirectoryIngameSkillSpine(u),t.unitObjectSpine);this._playerResourceRemainCount++,this.loadSpineEventResource(t,r,p,m,_,d,this._completePlayerResource.bind(this))}else if(l===a.SkillEffectShowType.FULL_SPINE_EFFECT_BY_SPINE_EVENT){var g=c.getSpineName(),C=n.getRefName(t.getId(),g);if(!this.checkExist(C)){this.checkLoadingResource(C);var f=c.getSpineDirectoryPath(),E=c.getAniName(),T=o.getDirectoryIngameSkillSpine(f),S=T+g;this._playerResourceRemainCount++,h(S,sp.SkeletonData,function(e){this.resourceList[C]=e,this.loadSpineEventResource(t,T,p,m,e,E,this._completePlayerResource.bind(this))}.bind(this));var R=c.getHitEffectName(),A=p+R,b=n.getRefName(t.getId(),R);this._playerResourceRemainCount++,h(A,sp.SkeletonData,function(e){this.resourceList[b]=e;var i=t.getHitEffectAniNameFromMultiple(c);this.loadSpineEventResource(t,T,p,m,e,i,this._completePlayerResource.bind(this))}.bind(this))}}}this._completePlayerResource()}.bind(this));var _=t.deckUnit.mainChara.getCharaId(),g=o.getFileNameIngameCharacterCutin(_);this._playerResourceRemainCount++,d(g,function(e){t.cutinTextureResource=e,this._completePlayerResource()}.bind(this)),t.textMasterArray=c.getCharacterTextMasterArray(_,l.TEXT_SCENE_TYPE.BATTLE,null);for(var C=0;C<t.textMasterArray.length;C+=1){var f=t.textMasterArray[C];this._playerResourceRemainCount++,u.fileLoaderManager.loadFile(o.getFileNameCharacterSound(f.getCharacterId(),f.getVoiceFile()),cc.AudioClip,function(t,e){t&&cc.error(t),this._completePlayerResource()}.bind(this))}t.deckUnit.supportChara&&this.loadSupportCharadcterResource(t)},this),this._playerResourceRemainCount<=0&&e()},loadSupportCharadcterResource:function(t){var e=t.deckUnit.supportChara.getCharaId(),i=o.getFileNameIngameCharacterCutin(e);this._playerResourceRemainCount++,d(i,function(e){t.supportCutinTextureResource=e,this._completePlayerResource()}.bind(this));var a=o.getFileNameCharacterUnison(e);this._playerResourceRemainCount++,d(a,function(e){t.supportUnisonTextureResource=e,this._completePlayerResource()}.bind(this));var s=t.deckUnit.supportChara.getSpineDirectoryPath(),c=o.getDirectoryIngameHitSpine(s),l=o.getDirectoryIngameSe(s),u=t.deckUnit.supportChara.getNormalAttackData().getHitEffectName(),p=u;0===u.indexOf("gr_")&&(p=u.substr(3,u.length-3),c=r.GENERAL_SPINE);var m=n.getRefName(t.deckUnit.supportChara.getCharaId(),u);this._playerResourceRemainCount++,h(c+p,sp.SkeletonData,function(e){this.resourceList[m]=e,this._playerResourceRemainCount++,this._loadSupportCharaNormalAttackSE(e,t.deckUnit.supportChara,l,this._completePlayerResource.bind(this)),this._completePlayerResource()}.bind(this))},_loadSupportCharaNormalAttackSE:function(t,e,i,a){var o=0,s=this,c=function(t,e){if(s.setResource(t,e),o--,a&&o<=0)return a()},l=function(t,e,i){h(t,i,function(t){c(e,t)})},u=t.skeletonJson;for(var d in u.animations){var p=u.animations[d].events;for(var m in p){var _=p[m].name;if(0===_.indexOf("gr_se_")||0===_.indexOf("se_")){var g=n.getRefName(e.getCharaId(),_);if(!s.checkExist(g)){o++,s.checkLoadingResource(g);var C=i+_;0===_.lastIndexOf("gr_",0)&&(_=_.substr(3,_.length-3),C=r.GENERAL_SE+_),l(C,g,cc.AudioClip)}}}}if(a&&o<=0)return a()},loadSpineEventResource:function(t,e,i,a,o,s,c){var l=0,u=this,d=function(t,e,i){if(u.setResource(t,i),l--,c&&l<=0)return c()},p=function(n,o,r){if(u.setResource(n,r),u.loadSpineEventResource(t,e,i,a,r,s,null),l--,c&&l<=0)return c()},m=function(t,e,i){h(t,i,function(t){d(e,0,t)})},_=o.skeletonJson;for(var s in _.animations){var g=_.animations[s].events;for(var C in g){var f,E,T,S,R=g[C],A=R.name,b=R.name.split(","),M=null;if(R.string&&(M=R.string.split(",")),!M||"spine"!==M[0]&&"spine_on_target"!==M[0]&&"eventkey"!==M[0]){if(M&&"particle"===M[0]){var v=n.getRefName(t.getId(),A);if(!u.checkExist(v))u.checkLoadingResource(v),l++,m(e+A,v,cc.ParticleAsset)}else if(0===A.indexOf("gr_se_")||0===A.indexOf("se_")){var P=n.getRefName(t.getId(),A);if(!u.checkExist(P)){l++,u.checkLoadingResource(P);var I=a+A;0===A.lastIndexOf("gr_",0)&&(A=A.substr(3,A.length-3),I=r.GENERAL_SE+A),m(I,P,cc.AudioClip)}}else if(0===A.indexOf("vo_")){P=n.getRefName(t.getId(),A);if(!u.checkExist(P))l++,u.checkLoadingResource(P),m(I=a.replace("/se/","/sound/")+A.substr(3,A.length-3),P,cc.AudioClip)}}else(function(){var a=!1;b.length>1&&(A=b[0]);var o=n.getRefName(t.getId(),A);if(0==A.lastIndexOf("gr_",0)&&(a=!0),!u.checkExist(o)){u.checkLoadingResource(o),l++;var s=e+A;f=t.myNormalAttack,E=f.getHitEffectName(),A===E&&(s=i+A),T=t.mySkill,S=T.getHitEffectName(),A===S&&(s=i+A),a&&(A=A.substr(3,A.length-3),s=r.GENERAL_SPINE+A),h(s,sp.SkeletonData,function(t){p(o,sp.SkeletonData,t)})}})()}}if(l<=0&&c)return c()},checkLoadingResource:function(t){this.resourceList[t]="nowLoading"},checkExist:function(t){return t in this.resourceList},loadStageObject:function(t,e){h(r.BGM_RES_FOLDER+"bgm014",cc.AudioClip,function(t){this.stage_bgm=t,e()}.bind(this))},loadMonsterResource:function(t,e){var i=this,s=0,c=function(){if(--s<=0)return e()};t.forEach(function(t){t.forEach(function(t){var e=t.battleMonsterModel.getSpineDirectoryPath(),l=t.battleMonsterModel.getSpineName(),u=o.getDirectoryIngameMonsterSpine(e)+l,p=o.getDirectoryIngameMonsterSpine(e),m=o.getDirectoryIngameMonsterHitSpine(e),_=o.getDirectoryIngameMonsterSe(e);s++,h(u,sp.SkeletonData,function(e){t.unitObjectSpine=e;var o=t.myNormalAttack.getAniName(),l=t.unitObjectSpine;s++,i.loadSpineEventResource(t,p,m,_,l,o,c);var u=t.battleSkillList;for(var d in u){var g=u[d].getEffectShowType();if(g==a.SkillEffectShowType.SPINE_ANI_SHOW){var C=u[d].getAniName(),f=r.SPINE_EFFECT_RES_FOLDER+u[d].getSpineDirectoryPath();s++,i.loadSpineEventResource(t,f,m,_,l,C,c)}else g==a.SkillEffectShowType.FULL_SPINE_EFFECT_BY_SPINE_EVENT&&function(){var e=u[d].getSpineName(),a=n.getRefName(t.getId(),e);if(!i.checkExist(a)){i.checkLoadingResource(a);var o=u[d].getAniName(),l=r.SPINE_EFFECT_RES_FOLDER+u[d].getSpineDirectoryPath();s++,h(r.SPINE_EFFECT_RES_FOLDER+l+e,sp.SkeletonData,function(e){i.setResource(a,e),i.loadSpineEventResource(t,l,m,_,e,o,c)})}}()}c()});var g=t.battleMonsterModel.getIconName();s++,d(r.SPRITE_FRAME_RES_FOLDER+g,function(e){t.monsterUnitIconResource=e,c()})},this)},this);var l="download/monster/90101/spine/def/ef_raging_red";h(l,sp.SkeletonData,function(t){i.setResource(l,t)}),s<=0&&e()},setResource:function(t,e){this.resourceList[t]=e},getResource:function(t){return this.resourceList[t]},loadBattleEffect_Prefab:function(t){s.instance.loadDirFile(r.BATTLE_UI_FOLDER_NAME,cc.Prefab,function(e,i){e?cc.error(e):t(i)})},loadBattleObject_Prefab:function(t){s.instance.loadDirFile(r.BATTLE_OBJ_FOLDER_NAME,cc.Prefab,function(e,i){e?cc.error(e):t(i)})},loadBattleSE_Dir:function(t){s.instance.loadDirFile(r.BATTLE_SE_FOLDER_NAME,cc.AudioClip,function(e,i,a){e?cc.error("loadBattleSE_Dir err"):t(i,a)})},loadBattleSE_Each:function(t,e){s.instance.loadFile(t,cc.AudioClip,function(t,i){if(!t)return e(i);cc.error(t)})},loadBackground:function(t,e){s.instance.loadFile(r.BACKGROUND_DIRECTORY+t,cc.SpriteFrame,function(t,i){return t?(cc.error(t),e(i)):e(i)})},loadBackgroundSpine:function(t,e){s.instance.loadFile(r.BACKGROUND_DIRECTORY+t,sp.SkeletonData,function(t,i){if(!t)return e(i);cc.error(t)})},loadBattleBgm:function(t,e){s.instance.loadFile(r.BGM_RES_FOLDER+t,cc.AudioClip,function(t,i){if(!t)return e(i);cc.error(t)})}});e.exports=p,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleFunction:"BattleFunction",CharacterConst:"CharacterConst",EnumTypes:"EnumTypes",FileLoaderManager:"FileLoaderManager",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ResourceUtils:[function(t,e,i){"use strict";cc._RF.push(e,"86ea8//9sVC1JMORUGcNZK5","ResourceUtils");var a=t("Singleton"),n=t("SingletonConst"),o=(t("GameConst"),t("StaticResourceConst")),r=t("ResourceConst"),s=t("ItemConst"),c=t("ItemUtils"),l=t("QuestUtils"),u=(t("AsyncFileLoader"),t("FileLoaderManager")),h=t("MemoryManager"),d=t("DownManifestManager");function p(t){t.sizeMode==cc.Sprite.SizeMode.CUSTOM?t.trim=!0:t.sizeMode==cc.Sprite.SizeMode.RAW&&(t.trim=!1),t.enabled=!0}function m(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.THUMB}function _(t){return r.FURNITURE_THUMBNAIL_PATH+t}function g(t){return r.EQUIPMENT_THUMBNAIL_PATH+t}function C(t){return r.ITEM_THUMBNAIL_PATH+t}e.exports={addSprite:function(t,e,i,o){if(!e)return t.spriteFrame=new cc.SpriteFrame,void(t.enabled=!1);var r=d.instance.getFileScaleData(e);a.res[e]&&!o&&a.res[e].isValid?(p(t),t.spriteFrame=a.res[e],a.res[e+"_scene"]=cc.director.getScene().name,t.sizeMode===cc.Sprite.SizeMode.CUSTOM||t.node.isScaled||(t.node.scale*=1/r,t.node.isScaled=!0),i&&i()):a[n.ENVIRONMENT].getDebugResource()?cc.loader.loadRes(e,cc.SpriteFrame,function(n,o){null===n?(a.res[e]=o,t.node&&(p(t),t.spriteFrame=a.res[e],i&&i())):cc.error(n)}):u.instance.loadFile(e,cc.SpriteFrame,function(n,o){null===n?(a.res[e]=o,t.node&&(p(t),t.spriteFrame=a.res[e],t.sizeMode===cc.Sprite.SizeMode.CUSTOM||t.node.isScaled||(t.node.scale*=1/r,t.node.isScaled=!0),h.instance.storeRes(t.spriteFrame,cc.SpriteFrame),i&&i())):cc.error(n)})},addMovie:function(t,e,i){e&&(a[n.ENVIRONMENT].getDebugResource()?cc.loader.loadRes(e,cc.VideoPlayer,function(n,o){null===n?(a.res[e]=o,t.node&&(t.clip=a.res[e],i&&i())):cc.error(n)}):u.instance.loadFile(e,cc.VideoPlayer,function(n,o){null===n?(a.res[e]=o,t.node&&(cc.sys.isNative?t.clip=o:(t.resourceType=0,t.remoteURL=o),h.instance.storeRes(t.clip,cc.VideoPlayer),i&&i())):cc.error(n)}))},getResource:function(t){var e=null;return a.staticRes[t]?e=a.staticRes[t]:a.res[t]?e=a.res[t]:cc.error("{ "+t+" } \u306f\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),e},getFileNameBGM:function(t){return r.SOUND_FILE_PATH_PREFIX+r.SOUND_FILE_PATH_CONJUNCTION.BGM+t},getFileNameSE:function(t){return r.SOUND_FILE_PATH_PREFIX+r.SOUND_FILE_PATH_CONJUNCTION.SE+t},getFileNameVoice:function(t){return r.SOUND_FILE_PATH_PREFIX+r.SOUND_FILE_PATH_CONJUNCTION.VOICE+t},getFileNameRarityIcon:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.ICON+t},getFileNameRarityStrIcon:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.ICON_STR+t},getFileNameRarityStrSIcon:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.ICON_STR_S+t},getFileNameRarityFrame:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.FRAME+t},getFileNameRaritySubFrame:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.FRAME_S+t},getFileNameRarityWideFrame:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.FRAME_W+t},getFileNameRarityCharacterFrame:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.FRAME_C+t},getFileNameRarityEquipmentFrame:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.FRAME_E+t},getFileNameRarityExceedLimitFrame:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.FRAME_EL+t},getFileNameRarityExceedLimitFrameBg:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.FRAME_BG+t},getFileNameRarityRing:function(t){return o.RARITY_IMAGE_PATH_PREFIX+o.RARITY_IMAGE_PATH_CONJUNCTION.RING+t},getFileNameAttributeIcon:function(t){return o.ATTRIBUTE_ICON_PATH+t},getFileNameBackGround:function(t){return r.BACKGROUND_FILE_PATH_PREFIX+t},getFileNameHelp:function(t,e){return r.USER_HELP_PATH+t+"/"+e},getFileNamePvPClassIcon:function(t){return r.PVP_CLASS_ICON_PATH+t},getFileNameBuffIcon:function(t){return o.BUFF_ICON_PATH+t},getFileNameStoryQuestScript:function(t,e){return r.STORY_QUEST_FILE_PATH+t+"/"+e},getFileNameStoryQuestSynopsis:function(t,e){return r.STORY_QUEST_FILE_PATH+t+"/s_"+e},getFileNameStoryEventScript:function(t,e){return r.STORY_EVENT_FILE_PATH+t+"/"+e},getFileNameStoryEventSynopsis:function(t,e){return r.STORY_EVENT_FILE_PATH+t+"/s_"+e},getFileNameStoryOtherScript:function(t,e){return r.STORY_OTHER_FILE_PATH+t+"/"+e},getFileNameStoryOtherSynopsis:function(t,e){return r.STORY_OTHER_FILE_PATH+t+"/s_"+e},getFileNameStoryPictureBookDetailNormalScript:function(t,e){return r.STORY_PICTURE_BOOK_DETAIL_FILE_PATH+t+r.STORY_PICTURE_BOOK_FILE_PATH_CONJUNCTION.NORMAL+e},getFileNameStoryPictureBookDetailNormalSynopsis:function(t,e){return r.STORY_PICTURE_BOOK_DETAIL_FILE_PATH+t+r.STORY_PICTURE_BOOK_FILE_PATH_CONJUNCTION.NORMAL+"s_"+e},getFileNameStoryPictureBookDetailAdultScript:function(t,e){return a[n.ENVIRONMENT].getAdultFlg()?r.STORY_PICTURE_BOOK_DETAIL_FILE_PATH+t+r.STORY_PICTURE_BOOK_FILE_PATH_CONJUNCTION.ADULT_R+e:r.STORY_PICTURE_BOOK_DETAIL_FILE_PATH+t+r.STORY_PICTURE_BOOK_FILE_PATH_CONJUNCTION.ADULT_W+e},getFileNameStoryPictureBookDetailAdultSynopsis:function(t,e){return r.STORY_PICTURE_BOOK_DETAIL_FILE_PATH+"synopsis_adult"},getFileNameStoryRoomScript:function(t){return r.STORY_ROOM_FILE_PATH+t},getFileNameStoryRoomSynopsis:function(t){return r.STORY_ROOM_FILE_PATH+"s_"+t},getFileNameTutorialScript:function(t){return a[n.ENVIRONMENT].getAdultFlg()?r.STORY_TUTORIAL_FILE_PATH+r.STORY_TUTORIAL_FILE_PATH_CONJUNCTION.ADULT_R+t:r.STORY_TUTORIAL_FILE_PATH+r.STORY_TUTORIAL_FILE_PATH_CONJUNCTION.ADULT_W+t},getFileNameTutorialSynopsis:function(t){return a[n.ENVIRONMENT].getAdultFlg()?r.STORY_TUTORIAL_FILE_PATH+r.STORY_TUTORIAL_FILE_PATH_CONJUNCTION.ADULT_R+"s_"+t:r.STORY_TUTORIAL_FILE_PATH+r.STORY_TUTORIAL_FILE_PATH_CONJUNCTION.ADULT_W+"s_"+t},getFileNameStoryCategoryThumbnail:function(t){return r.STORY_CATEGORY_THUMBNAIL_PATH+t},getFileNameThumbnailByItemType:function(t,e){switch(e){case s.ITEM_TYPE.CHARACTER:return m(t);case s.ITEM_TYPE.EQUIPMENT_RECIPE:return g(c.getItemRecipeMaster(t).getItemId());case s.ITEM_TYPE.EQUIPMENT:return g(t);case s.ITEM_TYPE.FURNITURE:return _(t);default:return C(t)}},getFileNameCharacterSound:function(t,e){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SOUND+e},getFileNameCharacterGroupSound:function(t,e){return r.CHARACTER_GROUP_FILE_PATH_PREFIX+t+r.CHARACTER_GROUP_FILE_PATH_CONJUNCTION.SOUND+e},getFileNameCharacterGroupStand:function(t){return r.CHARACTER_GROUP_FILE_PATH_PREFIX+t+r.CHARACTER_GROUP_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_GROUP_FILE_PATH_SUFFIX.STAND},getFileNameCharacterStand:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.STAND},getFileNameCharacterMain:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.MAIN},getFileNameCharacterQuestDeck:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.MAIN_D},getFileNameCharacterMainMid:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.MAIN_F},getFileNameCharacterMainDeck:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.MAIN_M},getFileNameCharacterMainDetail:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.MAIN_C},getFileNameCharacterRoomCard:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.ROOM_CARD},getFileNameCharacterGroupRoomCard:function(t){return r.CHARACTER_GROUP_FILE_PATH_PREFIX+t+r.CHARACTER_GROUP_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_GROUP_FILE_PATH_SUFFIX.ROOM_CARD},getFileNameCharacterCostumeByCostumeId:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.COSTUME},getFileNameCharacterMainSmall:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.MAIN_S},getFileNameCharacterThumbnail:m,getFileNameCharacterSupportThumbnail:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.THUMB_PARTY_SUB},getFileNameIngameCharacterThumbnail:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.BATTLE_THUMB},getFileNameCharacterRoomSpine:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SPINE+r.CHARACTER_FILE_PATH_SUFFIX.SPINE_ROOM},getFileNameCharacterHomeSpine:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SPINE+r.CHARACTER_FILE_PATH_SUFFIX.SPINE_HOME},getFileNameCharacterSDSpine:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SPINE+r.CHARACTER_FILE_PATH_SUFFIX.SPINE_SD},getFileNameWorldBG:function(t){return r.QUEST_WORLD_PATH_PREFIX+r.QUEST_WORLD_PATH_SUFFIX.BG+l.getWorldMasterMap()[t].getImageName()},getFileNameWorldThumbnail:function(t){return r.QUEST_WORLD_PATH_PREFIX+r.QUEST_WORLD_PATH_SUFFIX.THUMB+l.getWorldMasterMap()[t].getImageName()},getFileNameWorldSmallThumbnail:function(t){return r.QUEST_WORLD_PATH_PREFIX+r.QUEST_WORLD_PATH_SUFFIX.THUMB_S+l.getWorldMasterMap()[t].getImageName()},getFileNameAreaBG:function(t){return r.QUEST_AREA_PATH_PREFIX+r.QUEST_AREA_PATH_SUFFIX.BG+l.getAreaMasterMap()[t].getImageName()},getFileNameAreaImage:function(t){return r.QUEST_AREA_PATH_PREFIX+r.QUEST_AREA_PATH_SUFFIX.IMAGE+l.getAreaMasterMap()[t].getImageName()},getFileNameAreaThumbnail:function(t){return r.QUEST_AREA_PATH_PREFIX+r.QUEST_AREA_PATH_SUFFIX.THUMB+l.getAreaMasterMap()[t].getImageName()},getFileNameTowerBG:function(t){return r.QUEST_TOWER_PATH_PREFIX+r.QUEST_TOWER_PATH_SUFFIX.BG+l.getAreaMasterMap()[t].getImageName()},getFileNameDifficultBand:function(t){return r.QUEST_DIFFICULT_PATH_PREFIX+r.QUEST_DIFFICULT_PATH_SUFFIX.BAND+t},getFileNameDifficultIcon:function(t){return r.QUEST_DIFFICULT_PATH_PREFIX+r.QUEST_DIFFICULT_PATH_SUFFIX.ICON+t},getFileNameDifficultThumbnailBack:function(t){return r.QUEST_DIFFICULT_PATH_PREFIX+r.QUEST_DIFFICULT_PATH_SUFFIX.THUMBNAIL_BACK+t},getFileNameBannerByEventId:function(t){return r.QUEST_EVENT_PATH+t+r.QUEST_EVENT_PATH_SUFFIX.BANNER},getFileNameEventThumbnailByEventId:function(t){return r.QUEST_EVENT_PATH+t+r.QUEST_EVENT_PATH_SUFFIX.THUMBNAIL},getFileNameEventGachaBanner:function(t){return r.QUEST_EVENT_PATH+t+r.QUEST_EVENT_PATH_SUFFIX.GACHA_BANNER},getFileNameEventGachaLogo:function(t){return r.QUEST_EVENT_PATH+t+r.QUEST_EVENT_PATH_SUFFIX.GACHA_LOGO},getFileNameLogoByEventId:function(t){return r.QUEST_EVENT_PATH+t+r.QUEST_EVENT_PATH_SUFFIX.LOGO},getDirectoryHelpByEventId:function(t){return r.QUEST_EVENT_PATH+t+"/"},getDirectoryIngameDefSpine:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SPINE+r.CHARACTER_FILE_PATH_SUFFIX.SPINE_DEF},getFileNameIngameCharacterCutin:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.CUTIN},getFileNameCharacterUnison:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.UNISON_THUMB},getDirectoryIngameHitSpine:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SPINE+r.CHARACTER_FILE_PATH_SUFFIX.SPINE_HIT},getDirectoryIngameSkillSpine:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SPINE+r.CHARACTER_FILE_PATH_SUFFIX.SPINE_SKILL},getDirectoryIngameSe:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SE},getFileNameEnemyThumbnail:function(t){return r.MONSTER_FILE_PATH_PREFIX+t+r.MONSTER_FILE_PATH_CONJUNCTION.IMAGE+r.MONSTER_FILE_PATH_SUFFIX.THUMB},getFileNameIngameMonsterCutin:function(t){return r.MONSTER_FILE_PATH_PREFIX+t+r.MONSTER_FILE_PATH_CONJUNCTION.IMAGE+r.MONSTER_FILE_PATH_SUFFIX.CUTIN},getDirectoryIngameMonsterSpine:function(t){return r.MONSTER_FILE_PATH_PREFIX+t+r.MONSTER_FILE_PATH_CONJUNCTION.SPINE+r.MONSTER_FILE_PATH_SUFFIX.SP_DEF},getDirectoryIngameMonsterHitSpine:function(t){return r.MONSTER_FILE_PATH_PREFIX+t+r.MONSTER_FILE_PATH_CONJUNCTION.SPINE+r.MONSTER_FILE_PATH_SUFFIX.SPINE_HIT},getDirectoryIngameMonsterSe:function(t){return r.MONSTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.SE},getDirectoryIngameMonsterCommon:function(t){return r.MONSTER_FILE_PATH_PREFIX+"common"},getFileNameFurnitureImage:function(t){return r.FURNITURE_IMAGE_PATH+t},getFileNameFurnitureSmall:function(t){return r.FURNITURE_SMALL_PATH+t},getFileNameFurnitureThumbnail:_,getFileNameEquipmentThumbNail:g,getFileNameItemImage:function(t){return r.ITEM_IMAGE_PATH+t},getFileNameItemThumbnail:C,getFileNameShopTopThumbnail:function(t){return r.SHOP_TOP_THUMBNAIL_PATH+t},getFileNameShopItemThumbnail:function(t){return r.SHOP_ITEM_THUMBNAIL_PATH+t},getFileNameShopItemLargeThumbnail:function(t){return r.SHOP_ITEM_THUMBNAIL_L_PATH+t},getFileNameDmmPurchaseImage:function(t){return r.DMM_PURCHASE_IMAGE_PATH+t},getFileNameMyPageBg:function(t){return r.MYPAGE_BG_PATH+t},getFileNameBanner:function(t){return r.MYPAGE_BANNER_PATH+t},getFileNameMyPageNewsBanner:function(t){return r.MYPAGE_NEWS_BANNER_PATH+t},getFileNameMyPageNewsMainContentImage:function(t){return r.MYPAGE_NEWS_MAIN_CONTENT_IMAGE_PATH+t},getFileNameGachaBg:function(t,e){var i=e.split(",");return i.length<=1?r.GACHA_BG_PATH_PREFIX+t+"/"+i[0]:a[n.ENVIRONMENT].getAdultFlg()?r.GACHA_BG_PATH_PREFIX+t+"/"+i[0]:r.GACHA_BG_PATH_PREFIX+t+"/"+i[1]},getFileNameGachaBanner:function(t){return r.GACHA_SIDE_BANNER_PATH+t},getFileNameGachaLogo:function(t){return r.GACHA_LOGO_PATH+t},getFileNameGachaStepUpThumbnail:function(t,e){return r.GACHA_STEP_UP_THUMBNAIL_PATH+t+"/"+e},getFileNameLoginBonusPrefab:function(t){return r.LOGIN_BONUS_PREFAB_PATH+t},getFileNameLoginLoginBonusBG:function(t){return r.LOGIN_BONUS_BG_PATH_PREFIX+r.LOGIN_BONUS_BG_PATH_SUFFIX.BG+t},getFileNameCharacterMinigame:function(t){return r.CHARACTER_FILE_PATH_PREFIX+t+r.CHARACTER_FILE_PATH_CONJUNCTION.IMAGE+r.CHARACTER_FILE_PATH_SUFFIX.MINIGAME}},cc._RF.pop()},{AsyncFileLoader:"AsyncFileLoader",DownManifestManager:"DownManifestManager",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",MemoryManager:"MemoryManager",QuestUtils:"QuestUtils",ResourceConst:"ResourceConst",Singleton:"Singleton",SingletonConst:"SingletonConst",StaticResourceConst:"StaticResourceConst"}],RestoreBattleRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ac354VacGVKqoqh7fXX50oP","RestoreBattleRoot");var a=t("GameRootBase"),n=t("Singleton"),o=t("QuestUtils"),r=t("EventUtils"),s=t("QuestConditionUtils"),c=t("PopupUtils"),l=t("QuestRoot"),u=t("EventQuestRoot"),h=(t("FileLoaderManager"),t("BattleFunction")),d=t("GameConst"),p=t("SceneConst"),m=t("QuestConst"),g=t("DeckConst"),C=t("BattleData"),f=t("LocalDataConst");cc.Class({extends:a,properties:{},updateChild:function(t){},initData:function(){},initResource:function(){},initialize:function(){this._transitionScene(p.SCENE.FILE_NAME.HOME)},_transitionScene:function(t){var e=n.dao.battleSession;if(e){if(o.getWorldMasterByStageId(e.getStageId()).getCategory()===d.WORLD_CATEGORY.RAID)return this.clearScene(),void this.pushScene(t,void 0,void 0,void 0);var i=e.getSessionId(),a=e.getSaveData();i&&a?this._restoreSceneBySessionAndSaveData(t,a,e):i?this._restoreSceneBySession(t,e):this._clearBattleTransaction(t)}else this.clearScene(),this.pushScene(t,void 0,void 0,void 0)},_restoreSceneBySessionAndSaveData:function(t,e,i){var a,n=e;if(n)try{a=JSON.parse(n)}catch(e){return void this.pushScene(t,void 0,void 0,void 0)}a.battleData?this._checkOpenStage(i.getStageId())?this._openRestartBattlePopup(i,a,t):this._clearBattleTransaction(t):(cc.log("corrupted data !!"),this.pushScene(t,void 0,void 0,void 0))},_restoreSceneBySession:function(t,e){this._checkOpenStage(e.getStageId())?this._openRestartBattlePopup(e,void 0,t):this._clearBattleTransaction(t)},_checkOpenStage:function(t){return m.STAGE_CONDITION_STATE.ENABLED===s.getStageConditionState(t,0,this._getEventId(t))},_getEventId:function(t){var e,i=o.getWorldMasterByStageId(t);if(i&&i.getCategory()===d.WORLD_CATEGORY.EVENT){var a=r.getEventMainMasterByWorldId(i.getWorldId());e=a?a.getEventId():void 0}return e},_openRestartBattlePopup:function(t,e,i){c.openCommonPopupYesNo("","\u4e2d\u65ad\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u3059\u3002\u7d9a\u3051\u307e\u3059\u304b\uff1f","",!1,function(){n.localData[f.SELECT_QUEST_DECK_ORDER]=t.getDeckId(),e?this._restartBattle(t,e):this._restartBattleNonSaveData(t)}.bind(this),function(){this._clearBattleTransaction(i),C.autoBattleResultDropItemMap=null,C.autoBattleResultEventItemMap=null,C.battleResultDropLimitOverCountMap={}}.bind(this),"\u306f\u3044","\u3044\u3044\u3048",!0)},_clearBattleTransaction:function(t){n.QuestService.clearBattleTransaction(function(e){n.dao.battleSession=null,cc.log(e),this.pushScene(t,void 0,void 0,void 0)}.bind(this))},_restartBattle:function(t,e){var i,a;this._getEventId(t.getStageId())?(i=h.createBattleCallbacks(u.prototype.requestSaveBattleTransaction,u.prototype.requestEndBattle,u.prototype.requestEndBattle,u.prototype.transitionEventForEndBattle),a=h.setEventReStartBattleData):(i=h.createBattleCallbacks(l.prototype.requestSaveBattleTransaction,l.prototype.requestEndBattle,l.prototype.requestEndBattle,l.prototype.transitionEventForEndBattle),a=h.setQuestReStartBattleData),n.QuestService.startBattleTransaction(function(o){a(e,o.stage,h.createSessionObjectData(t.getSessionId(),t.getStageId(),t.getDeckId(),g.DECK_TYPE.QUEST),i),n.soundManager.bgmStop(),this.pushScene(p.SCENE.FILE_NAME.BATTLE_LOADING,p.SCENE.FILE_NAME.HOME,void 0,void 0)}.bind(this))},_restartBattleNonSaveData:function(t){var e;e=this._getEventId(t.getStageId())?h.createBattleCallbacks(u.prototype.requestSaveBattleTransaction,u.prototype.requestEndBattle,u.prototype.requestEndBattle,u.prototype.transitionEventForEndBattle):h.createBattleCallbacks(l.prototype.requestSaveBattleTransaction,l.prototype.requestEndBattle,l.prototype.requestEndBattle,l.prototype.transitionEventForEndBattle),n.QuestService.startBattleTransaction(function(i){var a=_.find(n.dao.userQuests,function(e){return e.getStageId()===t.getStageId()});h.setQuestStartBattleData(a,i.stage,h.createSessionObjectData(t.getSessionId(),t.getStageId(),t.getDeckId(),g.DECK_TYPE.QUEST),e),n.soundManager.bgmStop(),this.pushScene(p.SCENE.FILE_NAME.BATTLE_LOADING,p.SCENE.FILE_NAME.HOME,void 0,void 0)}.bind(this))}});cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",DeckConst:"DeckConst",EventQuestRoot:"EventQuestRoot",EventUtils:"EventUtils",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",GameRootBase:"GameRootBase",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestConditionUtils:"QuestConditionUtils",QuestConst:"QuestConst",QuestRoot:"QuestRoot",QuestUtils:"QuestUtils",SceneConst:"SceneConst",Singleton:"Singleton"}],ResultCharacterExpView:[function(t,e,i){"use strict";cc._RF.push(e,"7ee8c5ytp1A1beAhOqr5xiD","ResultCharacterExpView");var a=t("BattleFunction");t("BattleData");cc.Class({extends:cc.Component,properties:{characterExpAnimation:cc.Animation,characterLevelLabel:cc.Label,characterAddExpLabel:cc.Label,characterExpProgressBar:cc.ProgressBar},_result:null,_idx:0,_position:0,_battleUnit:null,_addExp:0,_unitData:void 0,_callback:null,_sumDt:0,initResultCharacterExpView:function(t,e,i,n,o){this._result=t,this._idx=e,this._position=i,this._battleUnit=n,this._addExp=o;var r=n.deckUnit.mainChara;this.characterLevelLabel.string=""+r.level,this.characterAddExpLabel.string="+"+o;var s=r.getCharaterModel().getCharacterMainMaster().getExpType(),c=a.getNextExpChara(r.level,s),l=a.getCurExpOnZeroBaseChara(r.curExp,r.level,s);this.characterExpProgressBar.progress=l/c,this._sumDt=0,this._unitData={mainChara:r,currentLevel:r.level,currentExp:l,needExp:c,plusExp:0,remainExp:o}},playResultCharacterExpSlidInAnimation:function(t){var e=cc.sequence(cc.delayTime(.3*this._idx),cc.callFunc(function(){this.characterExpAnimation.once("finished",function(e){return t(e)},this),this.characterExpAnimation.play(this.characterExpAnimation.getClips()[0].name)}.bind(this)));this._result.node.runAction(e)},playResultCharacterExpAnimation:function(t){this._callback=t,this._callbackDrawCharacterExpUpAction=this._drawCharacterExpUpAction.bind(this),this._result.updateCallbacks.push(this._callbackDrawCharacterExpUpAction)},_drawCharacterExpUpAction:function(t){var e=!1;if(this._unitData.remainExp>0){this._sumDt+=t,this._sumDt>=1&&(this._sumDt=1,e=!0);var i=this._addExp*(this._sumDt/1),n=this._unitData.currentExp+i-this._unitData.plusExp;if(n>=this._unitData.needExp){this._unitData.plusExp=i,this._unitData.currentExp=this._unitData.currentExp+i-this._unitData.needExp,n=this._unitData.currentExp,this._unitData.currentLevel+=1;var o=this._unitData.mainChara.getCharaterModel().getCharacterMainMaster().getExpType();this._unitData.needExp=a.getNextExpChara(this._unitData.currentLevel,o),this.characterLevelLabel.string=""+this._unitData.currentLevel,this.characterExpAnimation.play(this.characterExpAnimation.getClips()[2].name)}this.characterExpProgressBar.progress=n/this._unitData.needExp,this.characterAddExpLabel.string="+"+parseInt(this._unitData.remainExp-i)}else e=!0;if(e){this._result.isPlayCharacterExpArray[this._position]&&(this._result.isPlayCharacterExpArray[this._position]=!1);var r=this._result.updateCallbacks.indexOf(this._callbackDrawCharacterExpUpAction);return this._result.updateCallbacks.splice(r,1),this._callback()}}}),cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction"}],ResultDropItemWindow:[function(t,e,i){"use strict";cc._RF.push(e,"80022ni1GlLwYiq/7gO72Ob","ResultDropItemWindow");var a=t("CommonScrollView"),n=t("ItemConst"),o=(t("ResourceUtils"),t("RaidConst")),r=t("CommonUtils"),s=t("ItemUtils"),c=t("GameConst"),l=cc.Enum({ACHIEVE:1,NORMAL:2,EVENT:3,RAID:4});cc.Class({extends:cc.Component,properties:{dropItemUiAnimation:cc.Animation,bgGraySprite:cc.Sprite,dropItemScrollView:a,matrixThumbnailPrefab:cc.Prefab,detailPopupPrefab:cc.Prefab},_dropItemMatrixThumbnails:null,_beforeQuestData:null,_afterQuestData:null,initResultDropItemWindow:function(t,e,i,a,n){this.node.active=!1,this._beforeQuestData=t,this._afterQuestData=e,this._dropItemMatrixThumbnails=[],this.dropItemScrollView.content.destroyAllChildren(),this._createDropThumbnail(this._getAchievedItemArray(),l.ACHIEVE),this._createDropThumbnail(i,l.EVENT),this._createDropThumbnail(n,l.RAID),this._createDropThumbnail(a,l.NORMAL)},playDropItemWindowOpenAnimation:function(t){var e=this.dropItemUiAnimation.getClips()[0];this.dropItemUiAnimation.once("finished",function(e){return t(e)},this),this.node.setScale(0,0),this.node.active=!0,this.bgGraySprite.node.opacity=0,this.bgGraySprite.node.active=!0,this.dropItemUiAnimation.play(e.name),this.bgGraySprite.node.runAction(cc.fadeIn(e.duration))},playDropItemThumbnailOpenAnimation:function(t){if(!(this._dropItemMatrixThumbnails.length>0))return t();for(var e=0;e<this._dropItemMatrixThumbnails.length;e+=1){var i=this._dropItemMatrixThumbnails[e];this._dropItemMatrixThumbnails.length===e+1?this.node.runAction(this._getDropItemThumbnailOpenAnimation(e,i,t)):this.node.runAction(this._getDropItemThumbnailOpenAnimation(e,i,void 0))}},_createDropThumbnail:function(t,e){for(var i=0;i<t.length;i+=1){var a=t[i],r=cc.instantiate(this.matrixThumbnailPrefab).getComponent("ResultMatrixThumbnail");switch(r.initItemMatrixThumbnail(a),a.itemType===n.ITEM_TYPE.CHARACTER&&1===a.newFlg&&r.setNew(!0),e){case l.ACHIEVE:r.setSubMissionReward(a.subMissionIdx);break;case l.EVENT:r.setAddReward();break;case l.RAID:a.rewardType===o.RAID_REWARD_TYPE.MVP?r.setRaidMvpReward("MVP"):a.rewardType===o.RAID_REWARD_TYPE.SEMI_MVP&&r.setRaidMvpReward("\u6e96MVP");break;case l.NORMAL:}r.setCallbackToThumbnailBtn(this._onTapThumbnail.bind(this,r.node,a)),r.node.active=!1,this.dropItemScrollView.content.addChild(r.node),this._dropItemMatrixThumbnails.push(r)}},_getDropItemThumbnailOpenAnimation:function(t,e,i){return cc.sequence(cc.delayTime(.3*t),cc.callFunc(function(){e.node.active=!0,e.playOpenAnimation(i)}))},_getAchievedItemArray:function(){var t=[];if(this._beforeQuestData&&this._afterQuestData)for(var e=null,i=0;i<3;i+=1)0===(e=this._getSubMission(i)).isBeforeClearMission&&1===e.isAfterClearMission&&t.push({itemId:e.master.getName(),itemType:e.master.getItemType(),count:e.master.getCount(),subMissionIdx:i+1});return t},_getSubMission:function(t){switch(t){case 0:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission1(),isAfterClearMission:this._afterQuestData.getIsClearMission1(),master:this._afterQuestData.getQuestAchieveMaster1()};case 1:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission2(),isAfterClearMission:this._afterQuestData.getIsClearMission2(),master:this._afterQuestData.getQuestAchieveMaster2()};case 2:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission3(),isAfterClearMission:this._afterQuestData.getIsClearMission3(),master:this._afterQuestData.getQuestAchieveMaster3()}}},_onTapThumbnail:function(t,e){if(this.detailPopupPrefab){var i=cc.instantiate(this.detailPopupPrefab).getComponent("ModelDetailPopup"),a=cc.instantiate(t),n=cc.instantiate(t),o=t.convertToWorldSpaceAR(cc.v2(0,0)),l=r.getRoot().node.convertToNodeSpaceAR(o);r.getRoot().node.addChild(n,c.Z_ORDER.POPUP),n.setPosition(l);var u=s.getItemInfo(e.itemType,e.itemId),h=s.getUserItemCount(e.itemId,e.itemType);i.setNodeGroup("UI"),i.openModelDetailPopup(a,u.name,u.text,function(){n.destroy()},h)}}}),cc._RF.pop()},{CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",RaidConst:"RaidConst",ResourceUtils:"ResourceUtils"}],ResultEventPointWindow:[function(t,e,i){"use strict";cc._RF.push(e,"74f89sB2ftEKLhaEcpmRX2v","ResultEventPointWindow");var a=t("Singleton"),n=t("SingletonConst"),o=t("EventUtils"),r=t("ItemUtils"),s=t("CommonUtils");cc.Class({extends:cc.Component,properties:{eventPointWindowUiAnimation:cc.Animation,eventPointNameLabel:cc.Label,receivedEventPointNumLabel:cc.Label,beforeTotalEventPointNumLabel:cc.Label,afterTotalEventPointNumLabel:cc.Label},_isAnimationFlag:!1,_eventId:0,initResultEventPointWindow:function(t){this._isAnimationFlag=!1;var e=Object.keys(t);if(e.length>0){var i=r.getItemMaster(parseInt(e[0],10));this._eventId=o.getEventMainMasterByItemId(i.getItemId()).getEventId();var a=o.getTotalEventPointByEventIdAndItemId(this._eventId,i.getItemId()),n=t[e[0]].count;this.eventPointNameLabel.string=i.getName(),this.receivedEventPointNumLabel.string=s.convertToCommaDelimited(n),this.beforeTotalEventPointNumLabel.string=s.convertToCommaDelimited(a-n),this.afterTotalEventPointNumLabel.string=s.convertToCommaDelimited(a),this._isAnimationFlag=!0}},playEventPointWindowOpenAnimation:function(t){if(!this._isAnimationFlag)return t();var e=this.eventPointWindowUiAnimation.getClips()[0];this.eventPointWindowUiAnimation.once("finished",function(e){return this._sendNoticeEvent(),t(e)},this),this.node.setScale(0,0),this.node.active=!0,this.eventPointWindowUiAnimation.play(e.name)},_sendNoticeEvent:function(){for(var t=o.getNextReceivedEventRewardMasterArrayByEventIdAndEventPoint(this._eventId,this.beforeTotalEventPointNumLabel.string,this.afterTotalEventPointNumLabel.string),e="",i=0;i<t.length;i+=1){e=r.getItemMaster(t[i].getItemId()).getName()+"\u3092"+t[i].getCount()+"\u500b\u3092\u7372\u5f97\u3057\u307e\u3057\u305f\u3002",a[n.NOTICE_MANAGER].sendSimpleNoticeMessage(e,!0)}}}),cc._RF.pop()},{CommonUtils:"CommonUtils",EventUtils:"EventUtils",ItemUtils:"ItemUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ResultMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"ffcb39WwuxOEKZNSW+iMB33","ResultMatrixThumbnail");var a=t("MatrixThumbnailUtils"),n=t("EquipmentUtils"),o=t("ItemConst"),r=t("MatrixThumbnailBase"),s=cc.Enum({OPEN:0,NEW:1});cc.Class({extends:r,properties:{isFirstClearNode:cc.Node,isSubMissionRewardNode:cc.Node,subMissionRewardLabel:cc.Label,isRaidMvpRewardNode:cc.Node,raidMvpRewardLabel:cc.Label,isAddRewardNode:cc.Node,isNewNode:cc.Node,matrixThumbnailAnimationWhiteOutNode:cc.Node,matrixThumbnailAnimation:cc.Animation,matrixThumbParent:cc.Node},_matrixThumb:null,initItemMatrixThumbnail:function(t){var e={prefix:"x",count:t.count};t.itemType===o.ITEM_TYPE.EQUIPMENT&&void 0!==t.exceedLimit&&(e.rarity=n.getRarityByEquipmentIdAndExceedLimit(t.itemId,t.exceedLimit)),this._matrixThumb=a.createMatrixThumbnailByItemType(t.itemId,t.itemType,e),this.matrixThumbParent.addChild(this._matrixThumb.node)},setCallbackToThumbnailBtn:function(t){this._matrixThumb.setCallbackToThumbnailBtn(t)},setFirstClear:function(t){this.isFirstClearNode.active=t},setSubMissionReward:function(t){this.isSubMissionRewardNode.active=!0,this.subMissionRewardLabel.string=Array(t+1).join("\u2605")},setRaidMvpReward:function(t){this.isRaidMvpRewardNode.active=!0,this.raidMvpRewardLabel.string=t},setAddReward:function(){this.isAddRewardNode.active=!0},setNew:function(t){this.isNewNode.active=t,t?this.matrixThumbnailAnimation.playAdditive(this.matrixThumbnailAnimation.getClips()[s.NEW].name):this.matrixThumbnailAnimation.stop(this.matrixThumbnailAnimation.getClips()[s.NEW].name)},playOpenAnimation:function(t){t&&this.matrixThumbnailAnimation.once("finished",function(e){return t(e)},this),this.node.setScale(0,0),this.matrixThumbnailAnimationWhiteOutNode.active=!0,this.matrixThumbnailAnimation.playAdditive(this.matrixThumbnailAnimation.getClips()[s.OPEN].name)}});cc._RF.pop()},{EquipmentUtils:"EquipmentUtils",ItemConst:"ItemConst",MatrixThumbnailBase:"MatrixThumbnailBase",MatrixThumbnailUtils:"MatrixThumbnailUtils"}],ResultPlayerRankView:[function(t,e,i){"use strict";cc._RF.push(e,"7effbxsR+RNKo9/QY0pCHx/","ResultPlayerRankView");var a=t("BattleFunction"),n=t("BattleData");cc.Class({extends:cc.Component,properties:{playerRankAnimation:cc.Animation,playerRankNumberLabel:cc.Label,playerRankNumberLevelUpLabel:cc.Label,playerRankAddExpLabel:cc.Label,playerRankExpProgressBar:cc.ProgressBar},_result:null,_delayCount:0,_addExp:0,_playerData:void 0,_callback:null,initResultPlayerRankView:function(t,e,i){this._result=t,this._delayCount=e,this._addExp=i,this.node.active=!1,this.playerRankNumberLevelUpLabel.node.active=!1;var o=n.beforePlayerLv,r=a.getCurExpOnZeroBasePlayer(n.beforePlayerExp,n.beforePlayerLv),s=a.getNextExpPlayer(n.beforePlayerLv);this.playerRankNumberLabel.string=""+o,this.playerRankExpProgressBar.progress=r/s,this.playerRankAddExpLabel.string=""+i,this._playerData={currentLevel:o,needExp:s,currentExp:r,plusExp:0,remainExp:i}},playPlayerRankSlidInAnimation:function(t){var e=cc.sequence(cc.delayTime(.3*this._delayCount),cc.callFunc(function(){this.playerRankAnimation.on("finished",function(e){return t(e)},this),this.node.active=!0,this.playerRankAnimation.play(this.playerRankAnimation.getClips()[0].name)}.bind(this)));this._result.node.runAction(e)},playPlayerRankExpAnimation:function(t){this._callback=t,this._callbackDrawPlayerExpUpAction=this._drawPlayerExpUpAction.bind(this),this._result.updateCallbacks.push(this._callbackDrawPlayerExpUpAction)},_drawPlayerExpUpAction:function(t){var e=!1;if(this._playerData.remainExp>0){var i=this._addExp*(t/1);this._playerData.plusExp+=i,this._playerData.plusExp>=this._addExp?(this._playerData.plusExp=this._addExp,this._playerData.currentExp+=this._playerData.remainExp,this._playerData.remainExp=0,e=!0):(this._playerData.currentExp+=i,this._playerData.remainExp-=i),this._playerData.currentExp>=this._playerData.needExp&&(this._playerData.currentExp-=this._playerData.needExp,this._playerData.currentLevel+=1,this._playerData.needExp=a.getNextExpPlayer(this._playerData.currentLevel),this.playerRankNumberLevelUpLabel.string=""+this._playerData.currentLevel,this.playerRankNumberLevelUpLabel.node.active=!0,this.playerRankNumberLabel.node.active=!1),this.playerRankExpProgressBar.progress=this._playerData.currentExp/this._playerData.needExp,this.playerRankAddExpLabel.string=""+parseInt(this._playerData.remainExp),n.GM.soundManager.playSE(n.RM.soundResourceList.ExperiencePointsRise)}else e=!0;if(e){var o=this._result.updateCallbacks.indexOf(this._callbackDrawPlayerExpUpAction);return this._result.updateCallbacks.splice(o,1),this._callback()}}}),cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction"}],ResultRankUpPopup:[function(t,e,i){"use strict";cc._RF.push(e,"d9827NirNFGf6j+VLnW9EtT","ResultRankUpPopup");var a=t("Singleton"),n=t("BattleData"),o=t("RankUpPopupBase");cc.Class({extends:o,onLoad:function(){this._super()},openResultRankUpPopup:function(t){this.setCloseCallBack(t),this.openRankUpPopup()},_createLevelParam:function(){return{beforeLv:n.beforePlayerLv,afterLv:a.dao[a.USER].getLevel()}},_callbackFinishedOpenFunc:function(){n.autoCount>0&&n.isAuto&&this.node.runAction(cc.sequence(cc.delayTime(3),cc.callFunc(function(){this.close()}.bind(this))))},_onTapOkBtn:function(){this.close()}}),cc._RF.pop()},{BattleData:"BattleData",RankUpPopupBase:"RankUpPopupBase",Singleton:"Singleton"}],ResultRibbonPopup:[function(t,e,i){"use strict";cc._RF.push(e,"7e9aafybepJ9Iwk0VO58q0Z","ResultRibbonPopup");var a=t("PopupBase"),n=t("GameConst");cc.Class({extends:a,properties:{resultAnimation:cc.Animation},onLoad:function(){this.resultAnimation.on("finished",this._onEndAnimation.bind(this),this)},openResultRibbonPopup:function(t,e){this.setCloseCallBack(e),this.open(),this.resultAnimation.play(this.resultAnimation.getClips()[t].name)},_openPopupBase:function(t){this._addGrayBack(cc.director.getScene().getChildByName("Canvas"),n.Z_ORDER.GRAY_BACK),this._addWindow(),this._openWindowBase()},_onEndAnimation:function(){this.close()}});cc._RF.pop()},{GameConst:"GameConst",PopupBase:"PopupBase"}],ResultSubMissionDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"c04fdYsE39OyJar5X0gB5Z0","ResultSubMissionDetailPopup");var a=t("GameConst"),n=t("ViewUtils"),o=t("TutorialUtils"),r=t("QuestSubMissionPopup");cc.Class({extends:r,properties:{},_grayBackParentNode:null,openResultSubMissionDetailPopup:function(t,e,i,a){this._grayBackParentNode=t,this.openQuestSubMissionPopup(e,i,a)},_executeCallback:function(){if(this._callback)return this._callback()},_openPopupBase:function(t){this._isDisabledOutRangeTap=void 0!==this._isDisabledOutRangeTap&&this._isDisabledOutRangeTap,this._setOpenCallBack(t),this._initPopupAnim(),this._addGrayBack(this._grayBackParentNode?this._grayBackParentNode:cc.director.getScene().getChildByName("Canvas"),a.Z_ORDER.GRAY_BACK),this._executeCallback(),this._addWindow(),this._openWindowBase(),this._playOpenAnimation(),!o.isTutorialEnded()&&o.isTutorialAdvByPopup(this.node.name)&&n.addModalLayer()},_getGrayBackSprite:function(){return this._grayBackParentNode?this._grayBackParentNode.getChildByName("PopupGrayBack")?this._grayBackParentNode.getChildByName("PopupGrayBack").getComponent(cc.Sprite):null:cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack")?cc.director.getScene().getChildByName("Canvas").getChildByName("PopupGrayBack").getComponent(cc.Sprite):null}});cc._RF.pop()},{GameConst:"GameConst",QuestSubMissionPopup:"QuestSubMissionPopup",TutorialUtils:"TutorialUtils",ViewUtils:"ViewUtils"}],ResultSubMissionStarView:[function(t,e,i){"use strict";cc._RF.push(e,"a19b8RhiqlP9Z/UKVHLjffV","ResultSubMissionStarView");var a=t("CommonButton");cc.Class({extends:cc.Component,properties:{starBtn:a,progressStarNode:cc.Node,starOnNodeArray:[cc.Node]},_beforeQuestData:null,_afterQuestData:null,initResultSubMissionStarView:function(t,e,i){this._beforeQuestData=t,this._afterQuestData=e,this.node.active=!1,this.starOnNodeArray.forEach(function(t,e){t.active=this._getSubMissionData(e).isBeforeClearMission}.bind(this)),this.starBtn.setTapEvent(i)},playSubMissionOpenAnimation:function(t){var e=cc.sequence(cc.fadeIn(.3),cc.callFunc(function(e){return t(e)}));this.node.opacity=0,this.node.active=!0,this.node.runAction(e)},playSubMissionStarOnAnimation:function(t){this.starOnNodeArray.forEach(function(t,e){var i=this._getSubMissionData(e).isBeforeClearMission,a=this._getSubMissionData(e).isAfterClearMission;i!==a&&(t.opacity=0,t.active=a,t.runAction(cc.fadeIn(.3)))}.bind(this)),this.node.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){return t()})))},getProgressStarNode:function(){return this.progressStarNode},_getSubMissionData:function(t){switch(t){case 0:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission1(),isAfterClearMission:this._afterQuestData.getIsClearMission1(),master:this._afterQuestData.getQuestAchieveMaster1()};case 1:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission2(),isAfterClearMission:this._afterQuestData.getIsClearMission2(),master:this._afterQuestData.getQuestAchieveMaster2()};case 2:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission3(),isAfterClearMission:this._afterQuestData.getIsClearMission3(),master:this._afterQuestData.getQuestAchieveMaster3()}}}});cc._RF.pop()},{CommonButton:"CommonButton"}],RollView:[function(t,e,i){"use strict";cc._RF.push(e,"434e4oAdrBDu69MCQMZ2EQM","RollView");var a=t("CommonButton");cc.Class({extends:cc.Component,properties:{content:cc.Node,pagingWidth:0,overSlideBackMove:16,movementFrame:4,easing:!0,indicatorPrefab:cc.Prefab,indicatorParentNode:cc.Node,indicatorDistance:25},_beganViewX:null,_viewX:0,_bTouch:!1,_bSwipeRight:!1,_touchNodeArea:null,_bMoveTo:!1,_iMoveX:0,_bMove:!1,_btnArray:null,_callFunc:null,_iCurrentSlide:null,_iMovementPagingWidthPerFrame:0,ctor:function(){this._viewX=0,this._fSpeed=0,this._iMoveX=0},onLoad:function(){this.init(),this.initBase()},initBase:function(){this._setTouchStartEventListener(),this._setTouchMoveEventListener(),this._setTouchEndEventListener(),this._setTouchCancelEventListener(),this._btnArray=[];for(var t=0;t<this.content.childrenCount;t++)this._addContentEvent(this.content.children[t]);this._initFrameData(),this._setIndicator()},_initFrameData:function(){if(this._iMovementPagingWidthPerFrame=this.pagingWidth/this.movementFrame,this.pagingWidth%this._iMovementPagingWidthPerFrame!=0)for(var t=parseInt(this.pagingWidth/this._iMovementPagingWidthPerFrame),e=1;e<=this.pagingWidth;e+=1)if(this.pagingWidth%e==0&&e>t){this._iMovementPagingWidthPerFrame=e;break}},_addContentEvent:function(t){for(var e=t.getComponentsInChildren(a),i=0;i<e.length;i++)e[i].bPropagationStopped=!1,e[i].node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),e[i].node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),e[i].node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),e[i].node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this._btnArray.push(e[i])},getSelectedNo:function(){var t=this._viewX+this.pagingWidth*this.content.childrenCount,e=0;return(e=parseInt(t%this.pagingWidth)<this.pagingWidth/2?t/this.pagingWidth:t/this.pagingWidth+1)<0&&(e+=this.content.childrenCount+.5),e-=this.content.childrenCount,parseInt(e)},setSelectedNo:function(t){this._bMove||(this._viewX=this.pagingWidth*t)},setSelectedNoMove:function(t){if(!this._bMove){var e=this.content.children[t].getPosition();1<this.content.childrenCount&&(e.x<0?(this._bMoveTo=!0,this._iMoveX+=e.x):this.pagingWidth<=e.x+1&&(this._bMoveTo=!0,this._iMoveX-=-e.x))}},setLoopRollChangeCallFunc:function(t){this._callFunc=t},_setTouchStartEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this)},_setTouchMoveEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},_setTouchEndEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this)},_setTouchCancelEventListener:function(){this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},_onTouchStart:function(t){if(!this._bTouch){var e=this.node.convertToNodeSpace(t.getLocation());e.x<0||e.y<0||e.x>this.node.getContentSize().x||e.y>this.node.getContentSize().y||(this._touchStartEvent(t),this._bTouch=!0,this._bMove=!1)}},_onTouchMove:function(t){if(this._bTouch&&(this._touchMoveEvent(t),!this._bMove)){var e=this.node.convertToNodeSpace(t.getStartLocation()),i=this.node.convertToNodeSpace(t.getLocation());if(!(Math.abs(e.x-i.x)<=5)){for(var a=0;a<this._btnArray.length;a++)this._btnArray[a].setTouchEnable(!1);this._bMove=!0}}},_onTouchEnd:function(t){if(this._bTouch){this._touchEndEvent(t),this._bTouch=!1;for(var e=0;e<this._btnArray.length;e++)this._btnArray[e].setTouchEnable(!0)}},_onTouchCancel:function(t){this._onTouchEnd(t)},init:function(){},update:function(t){1<this.content.childrenCount&&(this._bMoveTo?this.easing?this._adjustContentEasingTo(t):this._adjustContentMoveTo():this._bTouch||this._adjustContent(),this._drawContent(),this._iCurrentSlide!==this.getSelectedNo()&&(this._iCurrentSlide=this.getSelectedNo(),this._drawIndicator(),this._callFunc&&this._callFunc(this._iCurrentSlide)))},redraw:function(){this._drawContent()},moveToLeft:function(){1<this.content.childrenCount&&(this._bMoveTo=!0,this._iMoveX-=this.pagingWidth)},moveToRight:function(){1<this.content.childrenCount&&(this._bMoveTo=!0,this._iMoveX+=this.pagingWidth)},_adjustContent:function(){var t=this.pagingWidth*(this.content.childrenCount-1),e=parseInt(this._viewX)%this.pagingWidth;if(0!==e)if(this._viewX>t)this._viewX-=this.pagingWidth/this.overSlideBackMove;else if(this._viewX<0)this._viewX+=this.pagingWidth/this.overSlideBackMove;else{(this._bSwipeRight?this.pagingWidth-e<this.pagingWidth/4:!(e<this.pagingWidth/4))?this._viewX+=(this.pagingWidth-e)/4:this._viewX-=e/4}},_drawContent:function(){for(var t=0;t<this.content.childrenCount;t++){var e=Math.floor(this._viewX-t*this.pagingWidth);this.content.children[t].setPosition(cc.v2(-e,0))}},_adjustContentMoveTo:function(){this._iMoveX>0?this._iMovementPagingWidthPerFrame<0&&(this._iMovementPagingWidthPerFrame=-this._iMovementPagingWidthPerFrame):this._iMoveX<0&&this._iMovementPagingWidthPerFrame>0&&(this._iMovementPagingWidthPerFrame=-this._iMovementPagingWidthPerFrame);var t=this._iMovementPagingWidthPerFrame;this._iMoveX=this._iMoveX-t,this._viewX+=t,0===Math.abs(this._iMoveX)&&(this._bMoveTo=!1)},_adjustContentEasingTo:function(){var t=parseInt(this._iMoveX/this.movementFrame);this._iMoveX=this._iMoveX-t,this._viewX+=t,Math.abs(this._iMoveX)<this.pagingWidth/10&&(this._iMoveX=0,this._bMoveTo=!1)},_touchStartEvent:function(t){this._beganViewX=this._viewX,this._iMoveX=0,this._bMoveTo=!1},_touchMoveEvent:function(t){var e=this.node.convertToNodeSpace(t.getStartLocation()),i=this.node.convertToNodeSpace(t.getLocation());this._viewX=e.x-i.x+this._beganViewX},_touchEndEvent:function(t){var e=this.node.convertToNodeSpace(t.getStartLocation()),i=this.node.convertToNodeSpace(t.getLocation());this._bSwipeRight=i.x-e.x>0},_drawIndicator:function(){if(this.indicatorPrefab&&this.indicatorParentNode&&!(this._indicatorNodeArray.length<=0)){for(var t=0;t<this._indicatorNodeArray.length;t++)this._indicatorNodeArray[t].getChildByName("IndicatorEnable").active=!1;this._indicatorNodeArray[this.getSelectedNo()].getChildByName("IndicatorEnable").active=!0}},_setIndicator:function(){if(this.indicatorPrefab&&this.indicatorParentNode){this.indicatorParentNode.destroyAllChildren();var t=this.content.childrenCount;this._indicatorNodeArray=[];for(var e=-this.indicatorDistance*(t-1)/2,i=0;i<t;i++){var a=cc.instantiate(this.indicatorPrefab);a.getChildByName("IndicatorEnable").active=!1,a.getChildByName("IndicatorBase").active=!0;var n=e+this.indicatorDistance*i;a.position=cc.v2(n,a.position.y),this.indicatorParentNode.addChild(a),this._indicatorNodeArray.push(a)}this._drawIndicator()}}}),cc._RF.pop()},{CommonButton:"CommonButton"}],RoomApis:[function(t,e,i){"use strict";cc._RF.push(e,"5c0caUePdBEG7mKlVJBu0tQ","RoomApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.ROOM_GET_MASTER_DATA,path:"room/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.ROOM_GET_USER_DATA,path:"room/getUserData",method:"POST"}),a.RESTClient.graft({name:n.ROOM_SET_FURNITURE,path:"room/setFurniture",method:"POST"}),a.RESTClient.graft({name:n.ROOM_SET_CHARACTER,path:"room/setCharacter",method:"POST"}),a.RESTClient.graft({name:n.ROOM_BUY_CHARACTER_FRAME,path:"room/buyCharacterFrame",method:"POST"}),a.RESTClient.graft({name:n.ROOM_BUY_FURNITURE,path:"room/buyFurniture",method:"POST"}),a.RESTClient.graft({name:n.ROOM_SAVE_LAYOUT,path:"room/saveLayout",method:"POST"}),a.RESTClient.graft({name:n.ROOM_LOAD_LAYOUT,path:"room/loadLayout",method:"POST"}),a.RESTClient.graft({name:n.ROOM_CLEAR_LAYOUT,path:"room/clearLayout",method:"POST"}),a.RESTClient.graft({name:n.ROOM_UPDATE_LAYOUT_NAME,path:"room/updateLayoutName",method:"POST"}),a.RESTClient.graft({name:n.ROOM_COLLECT,path:"room/collect",method:"POST"}),a.RESTClient.graft({name:n.ROOM_SAVE_SELECT_CHARACTER,path:"room/saveSelectCharacter",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],RoomCardDetailContentThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"25349yV/EdDz7URbezWlCMt","RoomCardDetailContentThumbnail");var a=t("CommonButton"),n=(t("ResourceUtils"),t("SimpleThumbnail"));cc.Class({extends:n,properties:{isNewNode:cc.Node,isGetNode:cc.Node,conditionParentNode:cc.Node,conditionLabel:cc.Label,rewardImageSprite:cc.Sprite,thumbnailBtn:a},_callbackToThumbnail:null,initRoomCharacterContentThumbnail:function(t,e){this.nameLabel.string=t,this.isNewNode.active=e},setGrayOut:function(t){this.conditionParentNode.active=t},setReleaseCondition:function(t){this.conditionLabel.string=t},setContentReward:function(t,e){t>0?(this.rewardImageSprite.node.active=!0,this.isGetNode.active=!1,this.countLabel.string="x"+t):(this.rewardImageSprite.node.active=!1,this.isGetNode.active=!0)},setCallbackToThumbnail:function(t){this._callbackToThumbnail||this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this)),this._callbackToThumbnail=t},_onTapThumbnailBtn:function(){this._callbackToThumbnail()}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils",SimpleThumbnail:"SimpleThumbnail"}],RoomCardDetailContentsListView:[function(t,e,i){"use strict";cc._RF.push(e,"dbd2f/omYtIsZfZg3ARx1n2","RoomCardDetailContentsListView");var a=t("ListViewBase"),n=t("RoomConst"),o=t("PictureBookUtils"),r=t("Singleton"),s=t("ResourceUtils"),c=t("PopupUtils"),l=(t("CharacterUtils"),t("CommonUtils"),t("AsyncFileLoader"),t("FileLoaderManager")),u=cc.Enum({CONTENTS:0,FRIENDSHIP:1});cc.Class({extends:a,properties:{roomEpisodeThumbnailPrefab:cc.Prefab},_root:null,_characterId:null,_pictureBookDetailModel:null,_characterContentsInfoMap:null,_parentTabView:null,initRoomCardDetailContentsListView:function(t,e,i){this._root=t,this._characterGroupId=t.getCurrentCharacterGroupId(),this._characterId=e,this._pictureBookDetailModel=t.getPictureBookDetailModelByCharacterId(e),this._characterContentsInfoMap=this._root.getCurrentPictureBookDetailInfoMap()[e].characterContentsInfoMap,this._parentTabView=i,this._setListContent()},_setListContent:function(){var t=[n.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO,n.ROOM_CONTENTS_TYPE.ADULT_SCENARIO,n.ROOM_CONTENTS_TYPE.VOICE_SCENARIO];this.thumbnailParentNode.destroyAllChildren(),t.forEach(function(t){this._addThumbnail(t)}.bind(this))},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("RoomEpisodeContentsThumbnail");e.initRoomEpisodeContentsThumbnail(this._getContentTypeName(t));var i=this._getPictureBookContentsInfo(t);for(var a in i){var n=i[a];e.addThumbnail(this._createThumbnailByStoryInfo(n))}this.thumbnailParentNode.addChild(e.node)},_createThumbnailByStoryInfo:function(t){var e=cc.instantiate(this.roomEpisodeThumbnailPrefab).getComponent("RoomEpisodeThumbnail");return e.setName(t.storyMaster.getName()),e.setNew(t.isReleased&&t.userStoryModel&&!t.userStoryModel.getIsRead()),e.setLocked(!1),t.storyMaster.getRewardId&&t.storyMaster.getRewardType&&t.storyMaster.getRewardCount&&!this._isReadedStory(t)?e.setReward(t.storyMaster.getRewardId(),t.storyMaster.getRewardType(),t.storyMaster.getRewardCount()):e.setReward(),t.isReleased||(e.setLocked(!0),e.setUnlockConditionLabel(o.getContentsReleaseConditionText(t.contentsMaster,this._pictureBookDetailModel,this._characterContentsInfoMap))),t.contentsMaster.getContentType()===n.ROOM_CONTENTS_TYPE.VOICE_SCENARIO?this._setCallbackToThumbnailByVoiceInfo(e,t):this._setCallbackToThumbnailByStoryInfo(e,t),e},_isReadedStory:function(t){return t.isReleased&&t.userStoryModel&&t.userStoryModel.getIsRead()},_setCallbackToThumbnailByStoryInfo:function(t,e){t.setOnTapThumbnailCallBack(function(){e.isReleased?this._root.openReadStoryConfirmPopup(e.userStoryModel,this._characterGroupId,this._characterId):this._switchTransitionByUnReleaseContents(e)}.bind(this))},_setCallbackToThumbnailByVoiceInfo:function(t,e){t.setOnTapThumbnailCallBack(function(){if(e.isReleased){var i="";i=this._root.isDefaultRoomCharacter(this._characterId)?s.getFileNameCharacterGroupSound(e.characterGroupId,e.storyMaster.getResourceId()):s.getFileNameCharacterSound(e.characterId,e.storyMaster.getResourceId());var a=e.storyMaster.getStoryId();this._startVoice(i),this._root.requestReadStory(a,function(){this._root.reload(),this._parentTabView.redrawBadge(),t.setNew(!1)}.bind(this))}else this._switchTransitionByUnReleaseContents(e)}.bind(this))},_switchTransitionByUnReleaseContents:function(t){if(t.contentsMaster){var e={isCondition:o.isReleasedContentsCondition(t.contentsMaster.getConditionType1(),t.contentsMaster.getConditionValue1(),this._pictureBookDetailModel,this._characterContentsInfoMap),conditionType:t.contentsMaster.getConditionType1()},i={isCondition:o.isReleasedContentsCondition(t.contentsMaster.getConditionType2(),t.contentsMaster.getConditionValue2(),this._pictureBookDetailModel,this._characterContentsInfoMap),conditionType:t.contentsMaster.getConditionType2()};e.isCondition?i.isCondition||this._openHowToReleasePopupByConditionType(i.conditionType):this._openHowToReleasePopupByConditionType(e.conditionType)}},_openHowToReleasePopupByConditionType:function(t){switch(t){case n.RELEASE_CONDITION_TYPE.FRIENDSHIP:return void c.openCommonPopupYesNo("\u672a\u958b\u653e\u30b3\u30f3\u30c6\u30f3\u30c4","\u9069\u5408\u7387\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\u4e0a\u6607\u3055\u305b\u307e\u3059\u304b\uff1f","",!1,function(){this._parentTabView.activateTab(u.FRIENDSHIP)}.bind(this),null,"\u9069\u5408\u7387\u3078");case n.RELEASE_CONDITION_TYPE.EXCEEDLIMIT:return void c.openCommonPopupYesNo("\u672a\u958b\u653e\u30b3\u30f3\u30c6\u30f3\u30c4","\u9650\u754c\u7a81\u7834\u56de\u6570\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\u9650\u754c\u7a81\u7834\u3055\u305b\u308b\u30e6\u30cb\u30c3\u30c8\u3092\u9078\u629e\u3057\u307e\u3059\u304b\uff1f","",!1,function(){this._root.transitionPromoteCharacterSelectScene(this._pictureBookDetailModel.getCharacterGroupId(),this._characterId)}.bind(this),null,"\u30e6\u30cb\u30c3\u30c8\u3078")}},_startVoice:function(t){cc.log("roomcarddetail _startVoice:"+t),l.instance.loadFile(t,cc.AudioClip,function(t,e){if(t)cc.error(t);else{var i=r.dao.userBasicData;i?r.soundManager.setBGMVol(.2*i.getBgmVolume()):r.soundManager.setBGMVol(.2);var a=r.soundManager.playVoice(e,!0,1);cc.audioEngine.setFinishCallback(a,this._restoreVolume.bind(this))}}.bind(this))},_getContentTypeName:function(t){switch(t){case n.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO:return"\u30b7\u30ca\u30ea\u30aa";case n.ROOM_CONTENTS_TYPE.ADULT_SCENARIO:return"\u30a2\u30c0\u30eb\u30c8";case n.ROOM_CONTENTS_TYPE.VOICE_SCENARIO:return"SP\u30dc\u30a4\u30b9"}},_getPictureBookContentsInfo:function(t){return this._root.getCurrentPictureBookDetailInfoMap()[this._characterId].characterContentsInfoMap[t]},onDisable:function(){this._restoreVolume()},_restoreVolume:function(){var t=r.dao.userBasicData;t&&(r.soundManager.setBGMVol(t.getBgmVolume()),r.soundManager.voiceStop())}}),cc._RF.pop()},{AsyncFileLoader:"AsyncFileLoader",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",FileLoaderManager:"FileLoaderManager",ListViewBase:"ListViewBase",PictureBookUtils:"PictureBookUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",Singleton:"Singleton"}],RoomCardDetailFriendshipPresentThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"5ace5VOxqZEt5ydM8nE0DMN","RoomCardDetailFriendshipPresentThumbnail");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{rateNumLabel:cc.Label,countNumLabel:cc.Label,favoritDispNode:cc.Node,mainImageSprite:cc.Sprite,grayImageSprite:cc.Sprite,thumbnailBtn:a},_callbackToThumbnail:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this))},initRoomCardDetailFriendshipPresentThumbnail:function(t,e,i){n.addSprite(this.mainImageSprite,t),n.addSprite(this.grayImageSprite,t),this.grayImageSprite.node.color=cc.color(0,0,0),this.grayImageSprite.node.opacity=100,this.rateNumLabel.string=e,this.countNumLabel.string=i},setFavoritDisplay:function(t){this.favoritDispNode.active=t},setCallbackToThumbnailBtn:function(t){this._callbackToThumbnail=t},setActive:function(t){this.grayImageSprite.node.active=!t},_onTapThumbnailBtn:function(){this._callbackToThumbnail&&this._callbackToThumbnail()}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],RoomCardDetailFriendshipPresentsListView:[function(t,e,i){"use strict";cc._RF.push(e,"91fc4Z+hydPE6TKcY9qYBCx","RoomCardDetailFriendshipPresentsListView");var a=t("ListViewBase"),n=t("CommonScrollView"),o=t("ItemUtils"),r=t("ResourceUtils"),s=t("PopupUtils"),c=t("Singleton"),l=t("PictureBookUtils"),u=t("CharacterConst"),h=(t("RoomConst"),t("ItemConst"),0),d=1;cc.Class({extends:a,properties:{friendshipCharacterUpAnimation:cc.Animation,friendshipHeartUpAnimation:cc.Animation,friendshipMaxAnimation:cc.Animation,scrollView:n},_root:null,_pictureBookDetailModel:null,_characterContentsInfoMap:null,_ifRequestGiftOver:null,initRoomCardDetailFriendshipPresentsListView:function(t,e){this._root=t,this._pictureBookDetailModel=t.getCurrentPictureBookDetailModel(),this._characterContentsInfoMap=this._root.getCurrentPictureBookDetailInfoMap()[e].characterContentsInfoMap,this._ifRequestGiftOver=!0,this._setListContent()},_setListContent:function(){this.thumbnailParentNode.destroyAllChildren();var t=o.getUserGiftItemArrayBySort(this._pictureBookDetailModel);for(var e in t){var i=this._createItemThumbnail(t[e],this._pictureBookDetailModel);this._addThumbnail(i)}},_addThumbnail:function(t){this.thumbnailParentNode.addChild(t.node)},_callbackToThumbnail:function(){},_createItemThumbnail:function(t,e){var i=o.getGiftItemEffectValue(t,e),a=cc.instantiate(this.thumbnailPrefab).getComponent("RoomCardDetailFriendshipPresentThumbnail");return a.initRoomCardDetailFriendshipPresentThumbnail(r.getFileNameItemThumbnail(t.getItemId()),"+"+i+"%","X"+t.getCount()),a.setFavoritDisplay(i>t.getEffectValue()),a.setCallbackToThumbnailBtn(function(){this._onTapItemThumbnail(t,e,i,e.getFriendship()+i>=e.getMaxFriendship())}.bind(this)),t.getCount()>0?a.setActive(!0):a.setActive(!1),a},_onTapItemThumbnail:function(t,e,i,a){o.getUserItemCount(t.getItemId())<=0?s.openSimpleMessageWindow(t.getName()+" \u3092\u6240\u6301\u3057\u3066\u3044\u307e\u305b\u3093\u3002"):e.getFriendship()>=e.getMaxFriendship()?s.openSimpleMessageWindow(e.getName()+" \u306e\u9069\u5408\u7387\u306f\u65e2\u306b\u6700\u5927\u3067\u3059\u3002"):this._ifRequestGiftOver&&(this._ifRequestGiftOver=!1,this._root.requestGift(e,t.getItemId(),i,a,this._playFriendshipUpAnimation.bind(this)))},_playFriendshipUpAnimation:function(t,e,i,a,n){this.friendshipHeartUpAnimation.node.stopAllActions(),this.friendshipHeartUpAnimation.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(a,this)));var o=function(){this._root.openConditionAchievementPopup(t,e),n(),this._ifRequestGiftOver=!0}.bind(this);i?(this.friendshipMaxAnimation.once("finished",o),this.friendshipHeartUpAnimation.once("finished",this._playFriendshipMaxAnimation.bind(this)),this.friendshipHeartUpAnimation.play(this.friendshipHeartUpAnimation.getClips()[d].name),this.friendshipCharacterUpAnimation.play()):(this.friendshipHeartUpAnimation.once("finished",o),this.friendshipHeartUpAnimation.play(this.friendshipHeartUpAnimation.getClips()[h].name),this.friendshipCharacterUpAnimation.play())},_playFriendshipMaxAnimation:function(){this.friendshipMaxAnimation&&this.friendshipMaxAnimation.play();var t=l.getCharacterTextMasterArray(this._pictureBookDetailModel.getCharacterId(),u.TEXT_SCENE_TYPE.ROOM,u.TEXT_GROUP_TYPE.ROOM.FRIENDSHIP_MAX),e=_.sample(t);e&&c.fileLoaderManager.loadFile(r.getFileNameCharacterSound(e.getCharacterId(),e.getVoiceFile()),cc.AudioClip,function(t,e){t?cc.error(t):c.soundManager.playVoice(e)})}});cc._RF.pop()},{CharacterConst:"CharacterConst",CommonScrollView:"CommonScrollView",ItemConst:"ItemConst",ItemUtils:"ItemUtils",ListViewBase:"ListViewBase",PictureBookUtils:"PictureBookUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",Singleton:"Singleton"}],RoomCardDetailFriendshipView:[function(t,e,i){"use strict";cc._RF.push(e,"b1447TIsOJMwaIstKPtc1Av","RoomCardDetailFriendshipView");var a=t("RoomCardDetailFriendshipPresentsListView"),n=t("BattleParameterView"),o=t("PictureBookUtils");cc.Class({extends:cc.Component,properties:{friendshipNumLabel:cc.Label,nextReleaseFriendshipNumLabel:cc.Label,nextReleaseContentsLabel:cc.Label,friendshipProgressNode:cc.Node,maxFriendshipInactiveNodeArray:[cc.Node],friendshipSprite:cc.Sprite,friendshipBonusParameterView:n,roomCardDetailFriendshipPresentsListView:a},_root:null,_pictureBookDetailModel:null,_characterContentsInfoMap:null,initRoomCardDetailFriendshipView:function(t,e){this._root=t,this._pictureBookDetailModel=t.getPictureBookDetailModelByCharacterId(e),this._characterContentsInfoMap=this._root.getCurrentPictureBookDetailInfoMap()[e].characterContentsInfoMap,t.setCurrentPictureBookDetailModel(this._pictureBookDetailModel),this.roomCardDetailFriendshipPresentsListView.initRoomCardDetailFriendshipPresentsListView(t,e),this._initLabels(),this._initOthers()},_initLabels:function(){this.friendshipNumLabel.string=this._pictureBookDetailModel.getFriendship(),this.nextReleaseFriendshipNumLabel.string=this._pictureBookDetailModel.getNeedFriendshipForNextContentsRelease()?this._pictureBookDetailModel.getNeedFriendshipForNextContentsRelease()+"%":"";var t=this._pictureBookDetailModel.getNextReleaseFriendshipContentsMaster();if(t)var e=o.isReleasedContentsCondition(t.getConditionType2(),t.getConditionValue2(),this._pictureBookDetailModel,this._characterContentsInfoMap);var i=e?"\u89e3\u653e":"\u89e3\u653e\u6761\u4ef6\u9054\u6210";this.nextReleaseContentsLabel.string=this._pictureBookDetailModel.getNextReleaseFriendshopContentsText()?this._pictureBookDetailModel.getNextReleaseFriendshopContentsText()+i:""},_initOthers:function(){this.friendshipBonusParameterView.initBattleParameterView(this._pictureBookDetailModel.getFriendshipBonusHp(),this._pictureBookDetailModel.getFriendshipBonusAtk(),this._pictureBookDetailModel.getFriendshipBonusDef(),0),this.friendshipBonusParameterView.setPrefix("+"),this.friendshipProgressNode.height=this.friendshipSprite.node.height*(this._pictureBookDetailModel.getFriendship()/this._pictureBookDetailModel.getMaxFriendship()),this._pictureBookDetailModel.getFriendship()>=100&&this.maxFriendshipInactiveNodeArray.forEach(function(t){t.active=!1})}}),cc._RF.pop()},{BattleParameterView:"BattleParameterView",PictureBookUtils:"PictureBookUtils",RoomCardDetailFriendshipPresentsListView:"RoomCardDetailFriendshipPresentsListView"}],RoomCardDetailImageView:[function(t,e,i){"use strict";cc._RF.push(e,"c6873fsybFB17M3N/9hzej/","RoomCardDetailImageView");var a=t("Singleton"),n=(t("CommonUtils"),t("CommonButton")),o=t("CharacterUtils"),r=t("ResourceUtils"),s=t("PopupUtils"),c=t("ExtensionAdvUtils"),l=t("ViewUtils"),u=(t("CharacterStandView"),0),h=1;cc.Class({extends:cc.Component,properties:{characterNameLabel:cc.Label,characterSkinNameLabel:cc.Label,attributeIconImageSprite:cc.Sprite,rarityIconImageSprite:cc.Sprite,characterStandViewParentNode:cc.Node,characterMainMidImageSprite:cc.Sprite,favoriteMyPageBtn:n,switchImageBtn:n,wholeDisplayBtn:n,characterTextLabel:cc.Label,roomCardDetailWholeViewPrefab:cc.Prefab},_root:null,_characterId:null,_characterMainModel:null,_switchImageType:null,_roomCardDetailWholeView:null,_characterStandView:null,onLoad:function(){this.favoriteMyPageBtn.setTapEvent(this._onTapFavoriteMyPageBtn.bind(this)),this.switchImageBtn.setTapEvent(this._onTapSwitchImageBtn.bind(this),n.SE_NAME.EQUIP),this.wholeDisplayBtn.setTapEvent(this._onTapWholeDisplayBtn.bind(this))},initRoomCardDetailImageView:function(t,e){this._root=t,this._roomCardWholeView=null,this._characterId=e,this._characterMainModel=o.getCharacterMainModelByCharacterId(this._characterId),this._initSwitchImageType(),this._initHeader(),this._initBtn(),this._initCharacterText(),this._initCharacterStandView(),this._redrawCharacterImage()},_getCharacterId:function(){return this._characterId},_getCharacterModel:function(){return this._characterMainModel},_getSwitchImageType:function(){return this._switchImageType},_setSwitchImageType:function(t){this._switchImageType=t},_getCharacterRarity:function(){return this._getCharacterModel().getRarity()},_isLowRarityCharacter:function(){return this._getCharacterRarity()<=2},_initSwitchImageType:function(){this._isLowRarityCharacter()?this._setSwitchImageType(u):this._setSwitchImageType(h)},_initHeader:function(){this.characterNameLabel.string=this._getCharacterModel().getShortName(),this.characterSkinNameLabel.string="["+this._getCharacterModel().getSkinName()+"]",0!==this._getCharacterModel().getRarity()?r.addSprite(this.rarityIconImageSprite,r.getFileNameRarityStrIcon(this._getCharacterModel().getRarity())):this.rarityIconImageSprite.spriteFrame=new cc.SpriteFrame,r.addSprite(this.attributeIconImageSprite,r.getFileNameAttributeIcon(this._getCharacterModel().getAttribute()))},_initBtn:function(){this._isLowRarityCharacter()?this.switchImageBtn.node.active=!1:this.switchImageBtn.node.active=!0,this._redrawFavoriteMyPageBtn()},_initCharacterText:function(){this.characterTextLabel.string=this._getCharacterModel().getText()},_initCharacterStandView:function(){this._characterStandView=l.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node)},_isFavorite:function(){var t=a.dao[a.USER].userData.getPartner(),e=this._getCharacterId();return 0===t.isDisplayRoom&&t.partnerId===e},_redrawFavoriteMyPageBtn:function(){this.favoriteMyPageBtn.switchBtnImage(this._isFavorite())},_redrawCharacterImage:function(){switch(this._getSwitchImageType()){case u:c.setFadeOut(this.characterMainMidImageSprite.node,.3),this.characterStandViewParentNode.opacity=0,this._characterStandView.setCharacterStandImage(this._getCharacterId()),c.setFadeIn(this.characterStandViewParentNode,.3);break;case h:c.setFadeOut(this.characterStandViewParentNode,.3),this.characterMainMidImageSprite.node.opacity=0,r.addSprite(this.characterMainMidImageSprite,r.getFileNameCharacterMainMid(this._getCharacterId())),c.setFadeIn(this.characterMainMidImageSprite.node,.3)}},redrawRoomCardDetailImageView:function(){this._redrawCharacterImage()},_onTapFavoriteMyPageBtn:function(){this._isFavorite()?this._root.requestChangePartner(0,0,this._callbackRequestChangePartner.bind(this)):this._root.requestChangePartner(this._getCharacterId(),0,this._callbackRequestChangePartner.bind(this))},_callbackRequestChangePartner:function(){this._redrawFavoriteMyPageBtn(),this._isFavorite()?s.openCommonPopupOk("\u304a\u6c17\u306b\u5165\u308a\u767b\u9332","\u30db\u30fc\u30e0\u753b\u9762\u306e\u304a\u6c17\u306b\u5165\u308a\u306b\u767b\u9332\u3055\u308c\u307e\u3057\u305f\u3002"):s.openCommonPopupOk("\u304a\u6c17\u306b\u5165\u308a\u89e3\u9664","\u30db\u30fc\u30e0\u753b\u9762\u306e\u304a\u6c17\u306b\u5165\u308a\u304b\u3089\u89e3\u9664\u3055\u308c\u307e\u3057\u305f\u3002")},_onTapSwitchImageBtn:function(){this._isLowRarityCharacter()?this._setSwitchImageType(u):this._getSwitchImageType()===u?this._setSwitchImageType(h):this._setSwitchImageType(u),this.redrawRoomCardDetailImageView()},_onTapWholeDisplayBtn:function(){this._roomCardDetailWholeView||(this._roomCardDetailWholeView=cc.instantiate(this.roomCardDetailWholeViewPrefab).getComponent("RoomCardDetailWholeView"),this._roomCardDetailWholeView.openRoomCardDetailWholeView(this._root,this._getCharacterId(),this._getSwitchImageType(),function(){this._roomCardDetailWholeView=null}.bind(this)))}});cc._RF.pop()},{CharacterStandView:"CharacterStandView",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ExtensionAdvUtils:"ExtensionAdvUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],RoomCardDetailSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"9b8183Wt6BOhqWu+oKHS42H","RoomCardDetailSubRoot");var a=t("WindowBase"),n=t("RoomCardDetailImageView"),o=t("RoomCardDetailTopTabView");cc.Class({extends:a,properties:{roomCardDetailImageView:n,roomCardDetailTopTabView:o},initRoomCardDetailSubRoot:function(t,e,i){this.roomCardDetailImageView.initRoomCardDetailImageView(t,e),this.roomCardDetailTopTabView.initRoomCardDetailTopTabView(t,e,i)},redrawRoomCardDetailSubRoot:function(){this.roomCardDetailTopTabView.redrawRoomCardDetailTopTabView()}});cc._RF.pop()},{RoomCardDetailImageView:"RoomCardDetailImageView",RoomCardDetailTopTabView:"RoomCardDetailTopTabView",WindowBase:"WindowBase"}],RoomCardDetailTopTabView:[function(t,e,i){"use strict";cc._RF.push(e,"369ceL6HzRG35y0wMkjMTGm","RoomCardDetailTopTabView");var a=t("TabViewBase"),n=t("RoomCardDetailContentsListView"),o=t("RoomCardDetailFriendshipView"),r=(t("RoomConst"),t("CharacterUtils"),t("CommonUtils"),cc.Enum({CONTENTS:0,FRIENDSHIP:1}));cc.Class({extends:a,properties:{badgeNode:cc.Node,tabBtnGrayOutNodeArray:[cc.Node],roomCardDetailContentsListView:n,roomCardDetailFriendshipView:o},_root:null,_characterId:null,initRoomCardDetailTopTabView:function(t,e,i){this._root=t,this._characterId=e;var a=r.CONTENTS;null!==i&&(a=i),this.initTabViewBase(),this._setCurrentTab(a),this.activateTab(this.getCurrentTab()),this.redrawBadge()},_tabEvent:function(t,e,i){this.activateTab(e)},_resetTab:function(t){this.tabBtnGrayOutNodeArray[r.CONTENTS].active=!1,this.tabBtnGrayOutNodeArray[r.FRIENDSHIP].active=!1,this._root.isDefaultRoomCharacter(this._characterId)?(this.tabBtnArray[r.CONTENTS].switchBtnImage(!0),this.tabBtnArray[r.FRIENDSHIP].node.active=!1,this.tabBtnGrayOutNodeArray[r.FRIENDSHIP].active=!0):(this.tabBtnArray[r.CONTENTS].switchBtnImage(t===r.CONTENTS),this.tabBtnArray[r.FRIENDSHIP].switchBtnImage(t===r.FRIENDSHIP))},activateTab:function(t){this._resetTab(t),this._setCurrentTab(t),this._switchTabContent(t)},_switchTabContent:function(t){switch(this.roomCardDetailContentsListView.node.active=!1,this.roomCardDetailFriendshipView.node.active=!1,t){case r.CONTENTS:this.roomCardDetailContentsListView.node.active=!0,this.roomCardDetailContentsListView.initRoomCardDetailContentsListView(this._root,this._characterId,this);break;case r.FRIENDSHIP:this.roomCardDetailFriendshipView.node.active=!0,this.roomCardDetailFriendshipView.initRoomCardDetailFriendshipView(this._root,this._characterId)}},redrawRoomCardDetailTopTabView:function(){this._switchTabContent(this.getCurrentTab()),this.redrawBadge()},redrawBadge:function(){var t=this._root.getPictureBookDetailModelByCharacterId(this._characterId);t.isNewReleasedNormalStory()||t.isNewReleasedAdultStory()||t.isNewReleasedSpVoice()?this.badgeNode.active=!0:this.badgeNode.active=!1}}),cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",RoomCardDetailContentsListView:"RoomCardDetailContentsListView",RoomCardDetailFriendshipView:"RoomCardDetailFriendshipView",RoomConst:"RoomConst",TabViewBase:"TabViewBase"}],RoomCardDetailWholeView:[function(t,e,i){"use strict";cc._RF.push(e,"e9767XFGCVN7JM/yuvFpE2G","RoomCardDetailWholeView");var a=t("Singleton"),n=t("CommonButton"),o=t("CommonUtils"),r=t("ResourceUtils"),s=t("CharacterUtils"),c=t("GameConst"),l=t("ExtensionAdvUtils"),u=t("CharacterConst"),h=t("SingletonConst"),d=t("ErrorCode"),p=0,m=1;cc.Class({extends:cc.Component,properties:{closeBtn:n,standSpineBgPrefab:cc.Prefab,standSpineBgNode:cc.Node,standSpine:sp.Skeleton,stillSpine:sp.Skeleton},_root:null,_characterId:null,_characterMainModel:null,_switchImageType:null,_layerNodeList:null,_initFlag:null,_endFunc:null,openRoomCardDetailWholeView:function(t,e,i,a){try{this._root=t,this._characterId=e,this._switchImageType=i,this._endFunc=a,this._initFlag=!0,this._requestLoadSpine()}catch(t){this._openThrowError(t)}},_openThrowError:function(t){cc.error(t),a[h.ERROR_MANAGER]&&a[h.ERROR_MANAGER].throwError(d.OUTGAME_SPINE_ERROR)},_requestLoadSpine:function(){switch(this._characterMainModel=s.getCharacterMainModelByCharacterId(this._getCharacterId()),this._getSwitchImageType()){case p:this._root.requestRes(r.getFileNameCharacterRoomSpine(this._characterMainModel.getSpineDirectoryPath()),sp.SkeletonData,this._initRoomCardDetailWholeView.bind(this));break;case m:var t=s.getCharacterSkillMainMasterMapIndexBySkillId()[this._characterMainModel.getSkillId()],e=t.getSpineName(),i=r.getDirectoryIngameSkillSpine(t.getSpineDirectoryPath()),a=t.getHitEffectName(),n=r.getDirectoryIngameHitSpine(t.getSpineDirectoryPath());this._root.requestRes(i+e,sp.SkeletonData,this._requestEventsSpineRes.bind(this,e,i,a,n))}},_requestEventsSpineRes:function(t,e,i,a){try{var n=e+t,o=r.getResource(n);o&&_.forEach(o.skeletonJson.animations.home.events,function(t){if(0!==t.name.indexOf("gr_se_")&&0!==t.name.indexOf("se_"))switch(t.name){case i:this._root.requestRes(a+t.name,sp.SkeletonData,this._initRoomCardDetailWholeView.bind(this));break;default:this._root.requestRes(e+t.name,sp.SkeletonData,this._initRoomCardDetailWholeView.bind(this))}}.bind(this))}catch(t){this._openThrowError(t)}},_initRoomCardDetailWholeView:function(){try{if(this._root._resourceRemainLoadCount<=0&&this._initFlag)switch(this._initFlag=!1,this.node.removeFromParent(!0),this._root.node.addChild(this.node,c.Z_ORDER.POPUP),this._initBtn(),this._getSwitchImageType()){case p:this._setStandSpine();break;case m:this._setStillSpine()}}catch(t){this._openThrowError(t)}},_getCharacterId:function(){return this._characterId},_getSwitchImageType:function(){return this._switchImageType},_initBtn:function(t){this.closeBtn.setTapEvent(function(){this.closeBtn.node.active=!1,l.setFadeOutAll(this.node,.3,function(){t&&t(),this._endFunc&&this._endFunc(),this.node.destroy()}.bind(this))}.bind(this),n.SE_NAME.CANCEL)},_setStandSpine:function(){this.standSpineBgNode.addChild(cc.instantiate(this.standSpineBgPrefab));var t=this._characterMainModel.getSpineDirectoryPath(),e=r.getFileNameCharacterRoomSpine(t);this.standSpine.skeletonData=a.res[e],this.playRandomSpineAction()},playRandomSpineAction:function(){this._setRandomSkin(),this._setRandomAnimation(),this.standSpine.setSlotsToSetupPose()},_setRandomSkin:function(){var t=o.getRandom(1,Object.keys(this.standSpine.skeletonData.skeletonJson.skins).length-1),e=Object.keys(this.standSpine.skeletonData.skeletonJson.skins)[t];e&&this._setSkin(e)},_setSkin:function(t){this.standSpine.skeletonData.skeletonJson.skins[t]?(this.standSpine.defaultAnimation=t,this.standSpine.setSkin(t)):cc.error("skin "+t+"\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002")},_setRandomAnimation:function(){var t=o.getRandom(0,Object.keys(this.standSpine.skeletonData.skeletonJson.animations).length-1),e=Object.keys(this.standSpine.skeletonData.skeletonJson.animations)[t];this.standSpine.animation!==e&&this._setAnimation(e)},_setAnimation:function(t){if(l.setFadeIn(this.standSpine.node,.3),!this.standSpine.setAnimation(0,t,!0))throw this.node.destroy(),new Error(this._characterMainModel.getCharacterId()+" character spine `"+t+"` animation not found")},_setStillSpine:function(){var t=this,e=s.getCharacterSkillMainMasterMapIndexBySkillId(),i=e[this._characterMainModel.getSkillId()],a=e[this._characterMainModel.getSkillId()].getSpineName(),n=r.getDirectoryIngameSkillSpine(i.getSpineDirectoryPath());this.stillSpine.skeletonData=r.getResource(n+a);if(null===this._layerNodeList)this._layerNodeList=[];else{for(var o in this._layerNodeList)this._layerNodeList[o].destroy();this._layerNodeList=[]}if(0===this._layerNodeList.length)for(var c=0;c<10;c+=1){var h=new cc.Node;h.parent=this.stillSpine.node.parent,h.setPosition(cc.v2(0,0));var d=9-c;h.zIndex=d,this._layerNodeList.push(h)}if(this.stillSpine.setEventListener(function(e,i){var a=i.data.name.split(","),o=a[0],s=(a.length>=2&&a[1],i.stringValue?i.stringValue.split(","):[]),c=s.length>=3?s[2]-1:null,h=n+o,d=c,p=t._layerNodeList[d],m=new cc.Node,_=m.addComponent(sp.Skeleton);if(_.skeletonData=r.getResource(h),_.timeScale=1,m.parent=p,m.setPosition(cc.v2(0,0)),l.setFadeIn(m,.3),!_.setAnimation(0,u.ROOM_SPINE_ANIM_TYPE.HOME,!0))throw this.node.destroy(),new Error(this._characterMainModel.getCharacterId()+" character spine `"+u.ROOM_SPINE_ANIM_TYPE.HOME+"` animation not found")}),this.stillSpine.setCompleteListener(function(t,e){this.stillSpine.setEventListener(null),this.stillSpine.setCompleteListener(null)}.bind(this)),!this.stillSpine.setAnimation(0,u.ROOM_SPINE_ANIM_TYPE.HOME,!0))throw this.node.destroy(),new Error(this._characterMainModel.getCharacterId()+" character spine `"+u.ROOM_SPINE_ANIM_TYPE.HOME+"` animation not found")}}),cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ErrorCode:"ErrorCode",ExtensionAdvUtils:"ExtensionAdvUtils",GameConst:"GameConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RoomCardEpisodeListView:[function(t,e,i){"use strict";cc._RF.push(e,"644dawrPVpObrkMgEQEsMw0","RoomCardEpisodeListView");var a=t("ListViewBase"),n=(t("CommonUtils"),t("PopupUtils")),o=t("CharacterConst"),r=t("RoomConst");cc.Class({extends:a,properties:{},_pictureBookBaseModel:null,_root:null,initRoomCardEpisodeListView:function(t,e){this._setListContent(t,e)},_setListContent:function(t,e){this._root=t,this._pictureBookBaseModel=t.getPictureBookBaseModelMap()[e],this._pictureBookBaseModel.getCharacterMainMasterArray().forEach(function(t){this._addThumbnail(t)}.bind(this))},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("RoomCharacterCardThumbnail"),i=t.getCharacterId(),a=this._pictureBookBaseModel.getPictureBookDetailModelByCharacterId(i);e.initRoomCharacterCardThumbnail(i,this._callbackToThumbnail.bind(this)),e.setCharacterName(t.getSkinName()),e.setCharacterImage(t),a?(e.setNewLabel(a.isNewReleasedNormalStory()||a.isNewReleasedAdultStory()||a.isNewReleasedSpVoice()),t.getCharacterType()!==o.CHARACTER_TYPE.DEFAULT&&e.setPrecisionLayout(a.getFriendship())):(e.setPrecisionLayout(0),e.setInactive(!0),e.setTouchEnable(!1)),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){var e=t.getThumbnailId();this._root.isDefaultRoomCharacter(e)?this._root.pushRoomCardDetailSubRoot(e,r.ROOM_CARD_DETAIL_TOP_TAB.CONTENT):this._pictureBookBaseModel.getPictureBookDetailModelByCharacterId(e)?this._root.pushRoomCardDetailSubRoot(e,r.ROOM_CARD_DETAIL_TOP_TAB.CONTENT):n.openCommonPopupOk("\u30ab\u30fc\u30c9\u672a\u6240\u6301","\u9078\u629e\u3055\u308c\u305f\u30e6\u30cb\u30c3\u30c8\u30ab\u30fc\u30c9\u3092\u6240\u6301\u3057\u3066\u3044\u307e\u305b\u3093\u3002");this.redraw()},redraw:function(){this.redrawListContent()},redrawListContent:function(){}});cc._RF.pop()},{CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",ListViewBase:"ListViewBase",PopupUtils:"PopupUtils",RoomConst:"RoomConst"}],RoomCardEpisodeSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"42c90siEH9H4rKf5S3mLW+t","RoomCardEpisodeSubRoot");var a=t("RoomSlideSubRootBase"),n=t("RoomCardEpisodeListView");cc.Class({extends:a,properties:{roomCardEpisodeListView:n},initRoomCardEpisodeSubRoot:function(t,e){this.roomCardEpisodeListView.initRoomCardEpisodeListView(t,e),this._openTargetNodeAction(this.roomCardEpisodeListView.node)}});cc._RF.pop()},{RoomCardEpisodeListView:"RoomCardEpisodeListView",RoomSlideSubRootBase:"RoomSlideSubRootBase"}],RoomCharacterCardThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"0bf90S4rWxEELra0/IDXKzE","RoomCharacterCardThumbnail");var a=t("CommonButton"),n=(t("CharacterUtils"),t("PictureBookUtils"),t("ResourceUtils"));cc.Class({extends:cc.Component,properties:{isNewNode:cc.Node,charaNameLabel:cc.Label,precisionLayoutNode:cc.Node,precisionNumLabel:cc.Label,charaCardImageSprite:cc.Sprite,rarityImageSprite:cc.Sprite,thumbnailBtn:a,isSelectedNode:cc.Node,isInactiveNode:cc.Node},_thumbnailId:null,_callbackToThumbnail:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtnEvent.bind(this))},initRoomCharacterCardThumbnail:function(t,e){this._initParam(t),this._setBtnCallback(e)},_initParam:function(t){this._thumbnailId=t,this.charaNameLabel.node.active=!1,this.charaCardImageSprite.node.active=!1,this.rarityImageSprite.node.active=!1,this.isNewNode.active=!1,this.precisionLayoutNode.active=!1,this.isSelectedNode.active=!1,this.isInactiveNode.active=!1},setCharacterName:function(t){this.charaNameLabel.node.active=!0,this.charaNameLabel.string=t},setCharacterImage:function(t){this.charaCardImageSprite.node.active=!0,n.addSprite(this.charaCardImageSprite,n.getFileNameCharacterRoomCard(t.getCharacterId())),t.getRarity()<=0||(this.rarityImageSprite.node.active=!0,n.addSprite(this.rarityImageSprite,n.getFileNameRarityStrSIcon(t.getRarity())))},setCharacterCardImageByCharacterGroupId:function(t){this.charaCardImageSprite.node.active=!0,n.addSprite(this.charaCardImageSprite,n.getFileNameCharacterGroupRoomCard(t))},setNewLabel:function(t){this.isNewNode.active=t},setInactive:function(t){this.isInactiveNode.active=t},setPrecisionLayout:function(t){this.precisionLayoutNode.active=!0,this.precisionNumLabel.string=t},_setBtnCallback:function(t){this._callbackToThumbnail=t},_onTapThumbnailBtnEvent:function(){this._callbackToThumbnail&&this._callbackToThumbnail(this)},getThumbnailId:function(){return this._thumbnailId},setSelectedNodeActive:function(t){this.isSelectedNode.active=t},setTouchEnable:function(t){this.thumbnailBtn.setTouchEnable(t)}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils"}],RoomCharacterContentSimpleThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"0bb12MKr9pNU4m2dpjfkbDP","RoomCharacterContentSimpleThumbnail");t("CommonButton"),t("ResourceUtils");var a=t("SimpleThumbnail");cc.Class({extends:a,properties:{isReleaseDispNode:cc.Node},initRoomCharacterContentSimpleThumbnail:function(t,e,i){this.nameLabel.string=t,this.countLabel.string=e+"%",this.isReleaseDispNode.active=i}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils",SimpleThumbnail:"SimpleThumbnail"}],RoomCharacterContentThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"f4bcexbwYlHs4Etqewmcbtd","RoomCharacterContentThumbnail");var a=t("CommonButton"),n=(t("ResourceUtils"),t("SimpleThumbnail"));cc.Class({extends:n,properties:{isNewNode:cc.Node,isGetNode:cc.Node,conditionParentNode:cc.Node,conditionLabel:cc.Label,rewardImageSprite:cc.Sprite,thumbnailBtn:a},_callbackToThumbnail:null,initRoomCharacterContentThumbnail:function(t,e){this.nameLabel.string=t,this.isNewNode.active=e},setGrayOut:function(t){this.conditionParentNode.active=t},setReleaseCondition:function(t){this.conditionLabel.string=t},setContentReward:function(t,e){t>0?(this.rewardImageSprite.node.active=!0,this.isGetNode.active=!1,this.countLabel.string="x"+t):(this.rewardImageSprite.node.active=!1,this.isGetNode.active=!0)},setCallbackToThumbnail:function(t){this._callbackToThumbnail||this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this)),this._callbackToThumbnail=t},_onTapThumbnailBtn:function(){this._callbackToThumbnail()}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils",SimpleThumbnail:"SimpleThumbnail"}],RoomCharacterFrameModel:[function(t,e,i){"use strict";cc._RF.push(e,"cd529FHpmtL1YJjO/V9WQmg","RoomCharacterFrameModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterFrameCount:function(){if(this._isKeyFieldAvailable("characterFrameCount"))return this._data.characterFrameCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterFrameCount")},getCostCount:function(){if(this._isKeyFieldAvailable("costCount"))return this._data.costCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount")},getCostId:function(){if(this._isKeyFieldAvailable("costId"))return this._data.costId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId")},getCostType:function(){if(this._isKeyFieldAvailable("costType"))return this._data.costType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RoomCharacterFurnitureObjectView:[function(t,e,i){"use strict";cc._RF.push(e,"12357NKXahOhJoJiNB+jRcX","RoomCharacterFurnitureObjectView");t("CommonUtils");var a=t("ResourceUtils");t("ExtensionAdvUtils"),t("RoomConst"),cc.Class({extends:cc.Component,properties:{furnitureImageSprite:cc.Sprite},initRoomCharacterFurnitureObjectView:function(t,e,i){a.addSprite(this.furnitureImageSprite,t),this.node.setPosition(e),this.node.zIndex=i}});cc._RF.pop()},{CommonUtils:"CommonUtils",ExtensionAdvUtils:"ExtensionAdvUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst"}],RoomCharacterRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"746cdzfrfpFH4MBlkRjjwb9","RoomCharacterRootUtils");var a=t("Singleton"),n=(t("LocalDataConst"),t("GameConst"));e.exports={openRoomCharacterSubRoot:function(t,e){if(cc.log("openRoomCharacterSubRoot"),cc.log(e),t.switchActiveRoomWholeCharacterView(!0),t.switchActiveRoomWholeFurnitureView(!0),t.switchActiveUISide(!1),t.switchActiveCharacterUIView(!0),t.hideHeaderTitle(),t.switchActiveRoomBackGroundSprite(!1),t.setUIHeaderCurrencyInfo([]),t.moveInitCharacter(),!t.roomCharacterSubRoot){t.showUI();var i=e.characterGroupId?e.characterGroupId:a.dao.pictureBookBase[0].getCharacterGroupId();t.roomCharacterSubRoot=cc.instantiate(t.roomCharacterSubRootPrefab).getComponent("RoomCharacterSubRoot"),t.setCurrentPictureBookBaseModel(t.userPictureBookBaseModelMap[i]),t.roomCharacterSubRoot.initRoomCharacterSubRoot(t,i),t.subRootParent.addChild(t.roomCharacterSubRoot.node)}},closeRoomCharacterSubRoot:function(t,e){cc.log("closeRoomCharacterSubRoot"),cc.log(e),t.roomCharacterSubRoot&&(t.roomCharacterSubRoot.node.destroy(),t.roomCharacterSubRoot=null)},openRoomFurnitureSelectSubRoot:function(t,e){if(cc.log("openRoomFurnitureSelectSubRoot"),cc.log(e),t.switchActiveRoomWholeCharacterView(!0),t.switchActiveRoomWholeFurnitureView(!0),t.switchActiveUISide(!0),t.switchActiveCharacterUIView(!1),t.showHeaderTitle(),t.setHeaderTitle("\u6a21\u69d8\u66ff\u3048"),t.switchActiveRoomBackGroundSprite(!1),t.setUIHeaderCurrencyInfo([{itemId:n.ITEM_ID_ROOM,callback:null}]),t.moveInitCharacter(),!t.roomFurnitureSelectSubRoot){var i=e.furnitureId?e.furnitureId:null;t.roomFurnitureSelectSubRoot=cc.instantiate(t.roomFurnitureSelectSubRootPrefab).getComponent("RoomFurnitureSelectSubRoot"),t.roomFurnitureSelectSubRoot.initRoomFurnitureSelectSubRoot(t,i),t.subRootParent.addChild(t.roomFurnitureSelectSubRoot.node)}},closeRoomFurnitureSelectSubRoot:function(t,e){cc.log("closeRoomFurnitureSelectSubRoot"),cc.log(e),t.roomFurnitureSelectSubRoot&&(t.roomFurnitureSelectSubRoot.node.destroy(),t.roomFurnitureSelectSubRoot=null)},openRoomFurnitureShopSubRoot:function(t,e){if(cc.log("openRoomFurnitureShopSubRoot"),cc.log(e),t.switchActiveRoomWholeCharacterView(!0),t.switchActiveRoomWholeFurnitureView(!0),t.switchActiveUISide(!0),t.switchActiveCharacterUIView(!1),t.showHeaderTitle(),t.setHeaderTitle("\u5bb6\u5177\u8cfc\u5165"),t.switchActiveRoomBackGroundSprite(!1),t.setUIHeaderCurrencyInfo([{itemId:n.ITEM_ID_ROOM,callback:null}]),t.moveInitCharacter(),!t.roomFurnitureShopSubRoot){var i=e.furnitureId?e.furnitureId:null;t.roomFurnitureShopSubRoot=cc.instantiate(t.roomFurnitureSelectSubRootPrefab).getComponent("RoomFurnitureSelectSubRoot"),t.roomFurnitureShopSubRoot.initRoomFurnitureShopSubRoot(t,i),t.subRootParent.addChild(t.roomFurnitureShopSubRoot.node)}},closeRoomFurnitureShopSubRoot:function(t,e){cc.log("closeRoomFurnitureShopSubRoot"),cc.log(e),t.roomFurnitureShopSubRoot&&(t.roomFurnitureShopSubRoot.node.destroy(),t.roomFurnitureShopSubRoot=null)},openRoomCharacterSkinSelectSubRoot:function(t,e){if(cc.log("openRoomCharacterSkinSelectSubRoot"),cc.log(e),t.switchActiveRoomWholeCharacterView(!0),t.switchActiveRoomWholeFurnitureView(!0),t.switchActiveUISide(!0),t.switchActiveCharacterUIView(!0),t.showHeaderTitle(),t.setHeaderTitle("\u8863\u88c5\u5909\u66f4"),t.moveSideCharacter(),t.switchActiveRoomBackGroundSprite(!1),t.setUIHeaderCurrencyInfo([]),!t.roomCharacterSkinSelectSubRoot){var i=e.characterGroupId?e.characterGroupId:a.dao.pictureBookBase[0].getCharacterGroupId();t.roomCharacterSkinSelectSubRoot=cc.instantiate(t.roomCharacterSkinSelectSubRootPrefab).getComponent("RoomCharacterSkinSelectSubRoot"),t.subRootParent.addChild(t.roomCharacterSkinSelectSubRoot.node),t.roomCharacterSkinSelectSubRoot.initRoomCharacterSkinSelectSubRoot(t,i)}},closeRoomCharacterSkinSelectSubRoot:function(t,e){cc.log("closeRoomCharacterSkinSelectSubRoot"),cc.log(e),t.roomCharacterSkinSelectSubRoot&&(t.roomCharacterSkinSelectSubRoot.node.destroy(),t.roomCharacterSkinSelectSubRoot=null)},openRoomFurnitureEpisodeSubRoot:function(t,e){if(cc.log("openRoomFurnitureEpisodeSubRoot"),cc.log(e),t.switchActiveRoomWholeCharacterView(!0),t.switchActiveRoomWholeFurnitureView(!0),t.switchActiveUISide(!0),t.switchActiveCharacterUIView(!1),t.showHeaderTitle(),t.setHeaderTitle("\u30eb\u30fc\u30e0\u30a8\u30d4\u30bd\u30fc\u30c9"),t.moveSideCharacter(),t.switchActiveRoomBackGroundSprite(!1),t.setUIHeaderCurrencyInfo([]),!t.roomFurnitureEpisodeSubRoot){var i=e.characterGroupId?e.characterGroupId:a.dao.pictureBookBase[0].getCharacterGroupId();t.roomFurnitureEpisodeSubRoot=cc.instantiate(t.roomFurnitureEpisodeSubRootPrefab).getComponent("RoomFurnitureEpisodeSubRoot"),t.subRootParent.addChild(t.roomFurnitureEpisodeSubRoot.node),t.roomFurnitureEpisodeSubRoot.initRoomFurnitureEpisodeSubRoot(t,i)}},closeRoomFurnitureEpisodeSubRoot:function(t,e){cc.log("closeRoomFurnitureEpisodeSubRoot"),cc.log(e),t.roomFurnitureEpisodeSubRoot&&(t.roomFurnitureEpisodeSubRoot.node.destroy(),t.roomFurnitureEpisodeSubRoot=null)},openRoomCardEpisodeSubRoot:function(t,e){if(cc.log("openRoomCardEpisodeSubRoot"),cc.log(e),t.switchActiveRoomWholeCharacterView(!0),t.switchActiveRoomWholeFurnitureView(!0),t.switchActiveUISide(!0),t.switchActiveCharacterUIView(!1),t.showHeaderTitle(),t.setHeaderTitle("\u30ab\u30fc\u30c9\u30a8\u30d4\u30bd\u30fc\u30c9"),t.moveSideCharacter(),t.switchActiveRoomBackGroundSprite(!1),t.setUIHeaderCurrencyInfo([]),!t.roomCardEpisodeSubRoot){var i=e.characterGroupId?e.characterGroupId:a.dao.pictureBookBase[0].getCharacterGroupId();t.roomCardEpisodeSubRoot=cc.instantiate(t.roomCardEpisodeSubRootPrefab).getComponent("RoomCardEpisodeSubRoot"),t.subRootParent.addChild(t.roomCardEpisodeSubRoot.node),t.roomCardEpisodeSubRoot.initRoomCardEpisodeSubRoot(t,i)}},closeRoomCardEpisodeSubRoot:function(t,e){cc.log("closeRoomCardEpisodeSubRoot"),cc.log(e),t.roomCardEpisodeSubRoot&&(t.roomCardEpisodeSubRoot.node.destroy(),t.roomCardEpisodeSubRoot=null)},openRoomCardDetailSubRoot:function(t,e){if(cc.log("openRoomCardDetailSubRoot"),cc.log(e),t.switchActiveRoomWholeCharacterView(e.isDisplayRoom),t.switchActiveRoomWholeFurnitureView(e.isDisplayRoom),t.switchActiveUISide(!0),t.switchActiveCharacterUIView(!1),t.showHeaderTitle(),t.setHeaderTitle("\u30ab\u30fc\u30c9\u30a8\u30d4\u30bd\u30fc\u30c9"),t.switchActiveRoomBackGroundSprite(!0),t.setUIHeaderCurrencyInfo([]),!t.roomCardDetailSubRoot){var i=e.characterGroupId?e.characterGroupId:null,n=e.characterId?e.characterId:a.dao.pictureBookDetail[0].getCharacterId(),o=e.topTabIdx?parseInt(e.topTabIdx):0;i&&t.setCurrentPictureBookBaseModel(t.userPictureBookBaseModelMap[i]),t.roomCardDetailSubRoot=cc.instantiate(t.roomCardDetailSubRootPrefab).getComponent("RoomCardDetailSubRoot"),t.subRootParent.addChild(t.roomCardDetailSubRoot.node,1),t.roomCardDetailSubRoot.initRoomCardDetailSubRoot(t,n,o)}},closeRoomCardDetailSubRoot:function(t,e){cc.log("closeRoomCardDetailSubRoot"),cc.log(e),t.roomCardDetailSubRoot&&(t.roomCardDetailSubRoot.node.destroy(),t.roomCardDetailSubRoot=null)}},cc._RF.pop()},{GameConst:"GameConst",LocalDataConst:"LocalDataConst",Singleton:"Singleton"}],RoomCharacterRoot:[function(t,e,i){"use strict";cc._RF.push(e,"9cb30ZG/jtPj5vrj+n4YsVD","RoomCharacterRoot");var a=t("Async"),n=t("Singleton"),o=t("CommonUtils"),r=t("CharacterUtils"),s=t("PictureBookUtils"),c=t("FurnitureUtils"),l=t("RoomUtils"),u=t("PopupUtils"),h=t("ExtensionAdvUtils"),d=t("ExtensionAdvUtils"),p=t("ResourceUtils"),m=t("StoryUtils"),g=t("EventUtils"),C=t("ItemUtils"),f=t("MatrixThumbnailUtils"),E=t("GameConst"),T=t("RoomConst"),S=t("CharacterConst"),R=t("LocalDataConst"),A=t("ItemConst"),b=t("StoryConst"),M=t("SingletonConst"),v=t("RoomRootBase"),P=t("RoomCharacterViewSetting");cc.Class({extends:v,properties:{roomWholeCharacterViewPrefab:cc.Prefab,roomBackGroundSpritePrefab:cc.Prefab,roomCharacterUIViewPrefab:cc.Prefab,roomCharacterSubRootPrefab:cc.Prefab,roomFurnitureSelectSubRootPrefab:cc.Prefab,roomCharacterSkinSelectSubRootPrefab:cc.Prefab,roomFurnitureEpisodeSubRootPrefab:cc.Prefab,roomCardEpisodeSubRootPrefab:cc.Prefab,roomCardDetailSubRootPrefab:cc.Prefab,roomFurnitureBuyConfirmPopupPrefab:cc.Prefab,roomFurnitureReleaseConfirmPopupPrefab:cc.Prefab,roomFurnitureSelectConfirmPopupPrefab:cc.Prefab,roomPictureBookDetailContentsConfirmPopupPrefab:cc.Prefab,roomHowToGetFurniturePopupPrefab:cc.Prefab,roomReleaseFurnitureEpisodePopupPrefab:cc.Prefab,storyRewardConfirmPopupPrefab:cc.Prefab},_roomWholeFurnitureView:null,_roomBackGroundSprite:null,_roomWholeCharacterView:null,_roomCharacterUIView:null,_roomFurnitureSelectConfirmPopup:null,_roomFurnitureBuyConfirmPopup:null,_roomFurnitureReleaseConfirmPopup:null,_roomPictureBookDetailContentsConfirmPopup:null,_roomPictureBookFilterPopup:null,_roomHowToGetFurniturePopup:null,_roomReleaseFurnitureEpisodePopup:null,_currentPictureBookDetailInfoMap:null,_currentPictureBookBaseContentsInfoMap:null,_currentPictureBookDetailVoiceInfoMap:null,userPictureBookBaseModelMap:null,roomFurnitureModelMap:null,_currentCharacterGroupId:0,_currentCharacterId:0,_recentStories:null,_newStories:null,onLoad:function(){this._super(),this.setUIHeaderCurrencyInfo([]),this.switchActiveUISide(!1),this._initRoomWholeFurnitureView(),this._addRoomWholeCharacterView(),this._addRoomBackGroundSprite(),this._addRoomCharacterUIView(),this._uiHeader.hideTitle()},_getSceneBgmName:function(){return E.BGM.ROOM},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,P.ROOMCHARACTER_SETTING)},initData:function(){if(this.sceneParam){var t=JSON.parse(this.sceneParam),e=t[Object.keys(t)[0]];this._initRoomCharacterRootData(e)}this._newStories=[],this._recentStories=n.dao.userStories,this.reload()},initResource:function(){this._super();var t=r.getCharacterMainModelByCharacterId(this.getCurrentCharacterId()).getSpineDirectoryPath();this.requestRes(p.getFileNameCharacterRoomSpine(t),sp.SkeletonData)},initialize:function(){this.initOutGameRootBase();var t={RoomCharacterSubRoot:{characterGroupId:this.getCurrentCharacterGroupId()}};this._initOpenFirstView(t),this.redraw(),this._openAddItemPopup(this.addCharacterFriendshipStory.bind(this))},_initRoomCharacterRootData:function(t){t.characterGroupId&&this.setCurrentCharacterGroupId(t.characterGroupId),t.characterId&&this.setCurrentCharacterId(t.characterId)},_initRoomWholeFurnitureView:function(){this._roomWholeFurnitureView=this.backgroundParent.getChildByName("RoomWholeFurnitureView").getComponent("RoomWholeFurnitureView"),this._roomWholeFurnitureView.node.active=!1},_addRoomWholeCharacterView:function(){this._roomWholeCharacterView=cc.instantiate(this.roomWholeCharacterViewPrefab).getComponent("RoomWholeCharacterView"),this.subRootParent.addChild(this._roomWholeCharacterView.node)},_addRoomBackGroundSprite:function(){this._roomBackGroundSprite=cc.instantiate(this.roomBackGroundSpritePrefab).getComponent(cc.Sprite),this._roomBackGroundSprite.node.opacity=0,this.subRootParent.addChild(this._roomBackGroundSprite.node)},_addRoomCharacterUIView:function(){this._roomCharacterUIView=cc.instantiate(this.roomCharacterUIViewPrefab).getComponent("RoomCharacterUIView"),this._roomCharacterUIView.initRoomCharacterUIView(this),this.subRootParent.addChild(this._roomCharacterUIView.node,E.Z_ORDER.UI)},reload:function(){this.userPictureBookBaseModelMap=s.createUserPictureBookBaseModelMap(),this.roomFurnitureModelMap=l.createRoomFurnitureModelMap(),this.setCurrentPictureBookBaseModel(this.getCurrentPictureBookBaseModel()),this.setCurrentPictureBookDetailModel(this.getCurrentPictureBookDetailModel()),this.redrawUIHeader()},redraw:function(){this.redrawRoomWholeView(),this._roomCharacterUIView.redraw(),this.roomCharacterSubRoot&&this.roomCharacterSubRoot.initRoomCharacterSubRoot(this,this.getCurrentCharacterGroupId()),this.roomCardDetailSubRoot&&this.roomCardDetailSubRoot.redrawRoomCardDetailSubRoot(),this.roomFurnitureSelectSubRoot&&this.roomFurnitureSelectSubRoot.redrawRoomFurnitureSelectSubRoot(this),this.roomFurnitureShopSubRoot&&this.roomFurnitureShopSubRoot.redrawRoomFurnitureShopSubRoot(this)},_openAddItemPopup:function(t){if(!Array.isArray(n.localData[R.NEW_USER_ITEMS])||n.localData[R.NEW_USER_ITEMS].length<=0)return t?t():null;for(var e,i=n.localData[R.NEW_USER_ITEMS],a=C.getItemMainMasterMap(),o="",r=0;r<i.length;r+=1){var s=a[i[r].itemId];s&&(o+=s.getName()+"x"+i[r].count+"\n"),e||(e=f.createMatrixThumbnailByItemType(s.getItemId(),s.getItemType()))}if(o+="\u3092\u7372\u5f97\u3057\u307e\u3057\u305f\u3002",!e)return t?t():null;cc.instantiate(this.storyRewardConfirmPopupPrefab).getComponent("ThumbnailTextPopup").openThumbnailTextPopup(e.node,"\u8aad\u4e86\u5831\u916c\u7372\u5f97",o,function(){}),n.localData[R.NEW_USER_ITEMS]=[]},redrawRoomWholeView:function(){this._roomWholeFurnitureView.initRoomWholeFurnitureView(this.getCurrentPictureBookBaseModel()),this._roomWholeCharacterView.initRoomWholeCharacterView(this.getCurrentPictureBookBaseModel())},redrawRoomCardDetailSubRoot:function(){this.roomCardDetailSubRoot&&this.roomCardDetailSubRoot.redrawRoomCardDetailSubRoot()},pushFurnitureSelectSubRoot:function(t,e){var i={RoomFurnitureSelectSubRoot:{furnitureId:e}},a=null;t&&(a=this.getCurrentSceneName()),this.pushScene("RoomCharacterScene",a,i,t)},pushFurnitureShopSubRoot:function(t,e){var i={RoomFurnitureShopSubRoot:{furnitureId:e}},a=null;t&&(a=this.getCurrentSceneName()),this.pushScene("RoomCharacterScene",a,i,t)},pushRoomCharacterSkinSelectSubRoot:function(t){var e={RoomCharacterSkinSelectSubRoot:{characterGroupId:this.getCurrentPictureBookBaseModel().getCharacterGroupId()}},i=null;t&&(i=this.getCurrentSceneName()),this.pushScene("RoomCharacterScene",i,e,t)},pushRoomFurnitureEpisodeSubRoot:function(t){var e={RoomFurnitureEpisodeSubRoot:{characterGroupId:this.getCurrentPictureBookBaseModel().getCharacterGroupId()}},i=null;t&&(i=this.getCurrentSceneName()),this.pushScene("RoomCharacterScene",i,e,t)},pushRoomCardEpisodeSubRoot:function(t){var e={RoomCardEpisodeSubRoot:{characterGroupId:this.getCurrentPictureBookBaseModel().getCharacterGroupId()}},i=null;t&&(i=this.getCurrentSceneName()),this.pushScene("RoomCharacterScene",i,e,t)},pushRoomCardDetailSubRoot:function(t,e){var i={RoomCardDetailSubRoot:{characterId:t,topTabIdx:e,isDisplayRoom:!0}},a={RoomCardEpisodeSubRoot:{characterGroupId:this.getCurrentPictureBookBaseModel().getCharacterGroupId()}};this.pushScene("RoomCharacterScene",this.getCurrentSceneName(),i,a)},openRoomFurnitureSelectConfirmPopup:function(t,e,i){this.closeRoomFurnitureSelectConfirmPopup();var a=this.getCurrentPictureBookBaseModel();this._roomFurnitureSelectConfirmPopup=cc.instantiate(this.roomFurnitureSelectConfirmPopupPrefab).getComponent("RoomFurnitureSelectConfirmPopup"),this._roomFurnitureSelectConfirmPopup.openRoomFurnitureSelectConfirmPopup(this,t,a,e,i)},closeRoomFurnitureSelectConfirmPopup:function(){this._roomFurnitureSelectConfirmPopup&&(this._roomFurnitureSelectConfirmPopup.close(),this._roomFurnitureSelectConfirmPopup=null)},openRoomFurnitureBuyConfirmPopup:function(t,e){this.closeRoomFurnitureBuyConfirmPopup(),this._roomFurnitureBuyConfirmPopup=cc.instantiate(this.roomFurnitureBuyConfirmPopupPrefab).getComponent("RoomFurnitureBuyConfirmPopup"),this._roomFurnitureBuyConfirmPopup.openRoomfurnitureBuyConfirmPopup(this,t,e)},closeRoomFurnitureBuyConfirmPopup:function(){this._roomFurnitureBuyConfirmPopup&&(this._roomFurnitureBuyConfirmPopup.close(),this._roomFurnitureBuyConfirmPopup=null)},openRoomFurnitureReleaseConfirmPopup:function(t){this.closeRoomFurnitureReleaseConfirmPopup(),this._roomFurnitureReleaseConfirmPopup=cc.instantiate(this.roomFurnitureReleaseConfirmPopupPrefab).getComponent("RoomFurnitureReleaseConfirmPopup"),this._roomFurnitureReleaseConfirmPopup.openRoomFurnitureReleaseConfirmPopup(t,this.requestReleaseFurniture.bind(this))},closeRoomFurnitureReleaseConfirmPopup:function(){this._roomFurnitureReleaseConfirmPopup&&(this._roomFurnitureReleaseConfirmPopup.close(),this._roomFurnitureReleaseConfirmPopup=null)},openRoomPictureBookContentsConfirmPopup:function(t){this.closeRoomPictureBookContentsConfirmPopup(),this._roomPictureBookDetailContentsConfirmPopup=cc.instantiate(this.roomPictureBookDetailContentsConfirmPopupPrefab).getComponent("RoomPictureBookDetailContentsConfirmPopup"),this._roomPictureBookDetailContentsConfirmPopup.openRoomPictureBookDetailContentsConfirmPopup(t)},closeRoomPictureBookContentsConfirmPopup:function(){this._roomPictureBookDetailContentsConfirmPopup&&(this._roomPictureBookDetailContentsConfirmPopup.close(),this._roomPictureBookDetailContentsConfirmPopup=null)},openRoomPictureBookFilterPopup:function(t,e){this.closeRoomPictureBookFilterPopup(),this._roomPictureBookFilterPopup=cc.instantiate(this.roomPictureBookFilterPopupPrefab).getComponent("FilterPopup"),this._roomPictureBookFilterPopup.openFilterPopup(t,e)},closeRoomPictureBookFilterPopup:function(){this._roomPictureBookFilterPopup&&(this._roomPictureBookFilterPopup.close(),this._roomPictureBookFilterPopup=null)},openRoomHowToGetFurniturePopup:function(t,e){this.closeRoomHowToGetFurniturePopup(),this._roomHowToGetFurniturePopup=cc.instantiate(this.roomHowToGetFurniturePopupPrefab).getComponent("RoomHowToGetFurniturePopup"),this._roomHowToGetFurniturePopup.openRoomHowToGetFurniturePopup(t,this.getCurrentPictureBookBaseModel(),this.transitionEventQuestScene.bind(this),this.pushFurnitureShopSubRoot.bind(this),e)},closeRoomHowToGetFurniturePopup:function(){this._roomHowToGetFurniturePopup&&(this._roomHowToGetFurniturePopup.close(),this._roomHowToGetFurniturePopup=null)},openRoomReleaseFurnitureEpisodePopup:function(t,e){this.closeRoomReleaseFurnitureEpisodePopup(),this._roomReleaseFurnitureEpisodePopup=cc.instantiate(this.roomReleaseFurnitureEpisodePopupPrefab).getComponent("RoomReleaseFurnitureEpisodePopup"),this._roomReleaseFurnitureEpisodePopup.openRoomReleaseFurnitureEpisodePopup(t,function(t){this.pushFurnitureSelectSubRoot(this.createPreViewParam(),t)}.bind(this),e)},closeRoomReleaseFurnitureEpisodePopup:function(){this._roomReleaseFurnitureEpisodePopup&&(this._roomReleaseFurnitureEpisodePopup.close(),this._roomReleaseFurnitureEpisodePopup=null)},openReadStoryConfirmPopup:function(t,e,i){u.openCommonPopupYesNo("\u30b9\u30c8\u30fc\u30ea\u30fc\u518d\u751f\u78ba\u8a8d",t.getStoryName()+"\n\u3092\u518d\u751f\u3057\u307e\u3059\u304b\uff1f","",!1,function(){this.transitionAdvScene(t,e,i)}.bind(this),null,"\u518d\u751f\u3059\u308b",null)},openConditionAchievementPopup:function(t,e){var i=this.getCurrentPictureBookDetailModel().getCharacterFriendshipContentsMasterArray(),a=_.find(i,function(i){return t<i.getConditionValue1()&&i.getConditionValue1()<=t+e});if(a&&!s.isReleasedContentsCondition(a.getConditionType2(),a.getConditionValue2(),this.getCurrentPictureBookDetailModel(),this.getCurrentPictureBookDetailInfoMap()[this.getCurrentCharacterId()].characterContentsInfoMap)){var n;switch(a.getContentType()){case T.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO:case T.ROOM_CONTENTS_TYPE.ADULT_SCENARIO:n="\u30b7\u30ca\u30ea\u30aa";break;case T.ROOM_CONTENTS_TYPE.VOICE_SCENARIO:n="\u30dc\u30a4\u30b9"}u.openCommonPopupOk("\u9069\u5408\u7387\u6761\u4ef6\u9054\u6210",n+"\u89e3\u653e\u6761\u4ef6\u3092\u4e00\u3064\u9054\u6210\u3057\u307e\u3057\u305f\u3002","",!1)}},_openReleasedStoryConfrimPopup:function(t,e,i){var a=this.getCurrentPictureBookContentInfoByStoryId(t),n=m.getUserStoryModelByStoryId(t);return a&&a.contentsMaster&&n?a.contentsMaster.getConditionType1()===T.ROOM_CONTENTS_TYPE.NONE&&a.contentsMaster.getConditionType2()===T.ROOM_CONTENTS_TYPE.NONE?i?i():null:void(a.contentsMaster.getContentType()===T.ROOM_CONTENTS_TYPE.VOICE_SCENARIO?u.openCommonPopupOk(e,this.getCurrentPictureBookBaseModel().getName()+" \u306e\n\u30dc\u30a4\u30b9\u304c\u958b\u653e\u3055\u308c\u307e\u3057\u305f\u3002","",!1,i):u.openCommonPopupYesNo(e,this.getCurrentPictureBookBaseModel().getName()+" \u306e\n\u30b7\u30ca\u30ea\u30aa\u304c\u958b\u653e\u3055\u308c\u307e\u3057\u305f\u3002\n\u3059\u3050\u306b\u8aad\u307f\u307e\u3059\u304b\uff1f","",!1,function(){o.getRoot().transitionAdvScene(n)},null,"\u8aad\u3080","\u30ad\u30e3\u30f3\u30bb\u30eb")):i?i():null},transitionRoomScene:function(t){var e={RoomTopSubRoot:{characterGroupId:t}};this.pushScene("RoomScene",null,e,{})},transitionShopScene:function(){var t={RoomCharacterSubRoot:{characterGroupId:this.getCurrentPictureBookBaseModel().getCharacterGroupId()}};this.pushScene("ShopScene",this.getCurrentSceneName(),{ShopSelectSubRoot:{}},t)},transitionEventQuestScene:function(t){if(!g.isEventOpenByEventId(t))return u.openSimpleMessageWindow("\u30a4\u30d9\u30f3\u30c8\u306f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002");var e=g.getTransitionEventSceneData(t),i=this.createPreViewParam();this.pushScene(e.sceneName,this.getCurrentSceneName(),e.sceneParam,i)},transitionPromoteCharacterSelectScene:function(t,e){var i=this.createPreViewParam(t,e);this.pushScene("PromoteCharacterSelectScene",this.getCurrentSceneName(),{PromoteCharacterSelectSubRoot:{}},i)},transitionAdvScene:function(t,e,i){this.requestReadStory(t.getStoryId(),this._onEndReadStory.bind(this,t,e,i))},_onEndReadStory:function(t,e,i){e=e||this.getCurrentCharacterGroupId(),i=i||this.getCurrentCharacterId();var a=t.getResourceId();t.getLightResourceId()?this._openQualityConfirmPopup(e,i,t):this._startAdv(e,i,this._createAdvResourceInfo(t,a,e),t.getNextStoryId())},_openQualityConfirmPopup:function(t,e,i){u.openCommonPopupYesNo("\u518d\u751f\u78ba\u8a8d","\u3053\u306e\u30b7\u30ca\u30ea\u30aa\u306f\n\u52d5\u753b\u518d\u751f\u7248\u3068\u9759\u6b62\u753b\u518d\u751f\u7248\u3092\n\u9078\u629e\u3067\u304d\u307e\u3059\u3002\n\n\u3069\u3061\u3089\u3092\u518d\u751f\u3057\u307e\u3059\u304b\uff1f","\u3069\u3061\u3089\u3092\u9078\u629e\u3057\u3066\u3082\u521d\u56de\u8aad\u4e86\u5831\u916c\u306f\u7372\u5f97\u53ef\u80fd\u3067\u3059\u3002",!0,this._startAdv.bind(this,t,e,this._createAdvResourceInfo(i,i.getResourceId(),t,!1),i.getNextStoryId()),this._startAdv.bind(this,t,e,this._createAdvResourceInfo(i,i.getLightResourceId(),t,!0),i.getNextStoryId()),"\u52d5\u753b\u518d\u751f","\u9759\u6b62\u753b\u518d\u751f",!0)},_createAdvResourceInfo:function(t,e,i,a){var o,r,s=t.getStoryId(),c=0;switch(t.getStoryCategory()){case b.STORY_CATEGORY.ROOM:o=p.getFileNameStoryRoomScript(e),r=p.getFileNameStoryRoomSynopsis(e);break;case b.STORY_CATEGORY.PICTURE_BOOK:switch(this.getCurrentPictureBookDetailContentInfoByStoryId(s).contentsMaster.getContentType()){case T.ROOM_CONTENTS_TYPE.NORMAL_SCENARIO:o=p.getFileNameStoryPictureBookDetailNormalScript(i,e),r=p.getFileNameStoryPictureBookDetailNormalSynopsis(i,e);break;case T.ROOM_CONTENTS_TYPE.ADULT_SCENARIO:o=p.getFileNameStoryPictureBookDetailAdultScript(i,e),r=p.getFileNameStoryPictureBookDetailAdultSynopsis(i,e),c=a?n[M.ENVIRONMENT].getAdultFlg()?E.ADULT_TYPE.LIGHT_ADULT:E.ADULT_TYPE.LIGHT_NORMAL:n[M.ENVIRONMENT].getAdultFlg()?E.ADULT_TYPE.ADULT:E.ADULT_TYPE.NORMAL}}return{storyId:s,adult:c,advTextFileInfoArray:[h.createAdvTextInfo(s,o,r)]}},_startAdv:function(t,e,i,a){var o=this.createPreViewParam(t,e);d.startAdv(i.storyId,i.adult,i.advTextFileInfoArray,n.dao.userBasicData.getUserName(),null,function(){this._reTransitionRoomCharacterScene(a,o)}.bind(this))},_reTransitionRoomCharacterScene:function(t,e){t&&!m.isReleasedStory(t)?n.StoryService.addStory(t,function(t){this.pushScene("RoomCharacterScene",null,e,null)}.bind(this)):this.pushScene("RoomCharacterScene",null,e,null)},createPreViewParam:function(t,e){var i={};return this.roomCharacterSubRoot&&(i.RoomCharacterSubRoot={characterGroupId:t,characterId:e}),this.roomFurnitureSelectSubRoot&&(i.RoomFurnitureSelectSubRoot={characterGroupId:t,characterId:e}),this.roomFurnitureShopSubRoot&&(i.RoomFurnitureShopSubRoot={characterGroupId:t,characterId:e}),this.roomCharacterSkinSelectSubRoot&&(i.RoomCharacterSkinSelectSubRoot={characterGroupId:t,characterId:e}),this.roomFurnitureEpisodeSubRoot&&(i.RoomFurnitureEpisodeSubRoot={characterGroupId:t,characterId:e}),this.roomCardEpisodeSubRoot&&(i.RoomCardEpisodeSubRoot={characterGroupId:t,characterId:e}),this.roomCardDetailSubRoot&&(i.RoomCardDetailSubRoot={characterGroupId:t,characterId:e}),i=this._addPreViewParam(i)},_addPreViewParam:function(t){for(var e in t)t[e].characterGroupId||(t[e].characterGroupId=this.getCurrentCharacterGroupId()),t[e].characterId||(t[e].characterId=this.getCurrentCharacterId());return t},requestSetFurniture:function(t,e){var i=[t.getFurnitureCd()],a=[t.getMapCategory()],o=[this.getCurrentPictureBookBaseModel().getCharacterGroupId()];n.RoomService.setFurniture(i,a,o,function(){var i=this.getCurrentPictureBookBaseContentsInfoMap()[T.ROOM_CONTENTS_TYPE.ROOM_SCENARIO],a=t.getFurnitureId(),n=l.getNewReleaseRoomStoryId(i,a);n?this.requestAddStory([n],function(){e&&e(),this.reload(),this.redraw()}.bind(this),"\u30b7\u30ca\u30ea\u30aa\u958b\u653e"):(e&&e(),this.reload(),this.redraw())}.bind(this))},requestReleaseFurniture:function(t,e){var i=this._createReleaseFurnitureParams(t);i.hasReleaseCancelFurniture?u.openSimpleMessageWindow("\u64a4\u53bb\u3067\u304d\u306a\u3044\u5bb6\u5177\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002"):n.RoomService.setFurniture(i.furnitureCds,i.mapCategories,i.characterGroupIds,function(){e&&e(),this.reload(),this.redraw()}.bind(this))},_createReleaseFurnitureParams:function(t){var e={furnitureCds:[],mapCategories:[],characterGroupIds:[],hasReleaseCancelFurniture:!1};return _.forEach(t,function(t){var i=l.getDefaultUserFurniture(t.getMapCategory());i?i.getFurnitureId()!==t.getFurnitureId()?(e.furnitureCds.push(i.getFurnitureCd()),e.mapCategories.push(i.getMapCategory()),e.characterGroupIds.push(t.getCharacterGroupId())):e.hasReleaseCancelFurniture=!0:(e.furnitureCds.push(t.getFurnitureCd()),e.mapCategories.push(0),e.characterGroupIds.push(0))}),e},requestAddStory:function(t,e,i){if(Array.isArray(t)){var a=t.pop();n.StoryService.addStory(a,function(n){t.length>0?this.requestAddStory(t,e):(e&&e(),this._openReleasedStoryConfrimPopup(a,i))}.bind(this))}else cc.error("requestAddStory() \u306f \u5f15\u6570\u306b ID \u306e\u914d\u5217\u304c\u5fc5\u8981\u3067\u3059")},requestReadStory:function(t,e){n.StoryService.readStory(t,function(t){e&&e(),t.addFreeGems&&(n.localData[R.NEW_USER_ITEMS]=[{itemType:A.ITEM_TYPE.FREE_GEM,itemId:A.GEM_ITEM_ID.FREE,count:t.addFreeGems}])})},requestBuyFurniture:function(t,e,i,a){i>0?n.RoomService.buyFurniture(t,e,function(){i-=1,this.requestBuyFurniture(t,e,i,a)}.bind(this)):(a&&a(),this.reload(),u.openCommonPopupYesNo("\u8cfc\u5165\u5b8c\u4e86","\u8cfc\u5165\u3057\u307e\u3057\u305f\u3002\n\n\u3059\u3050\u306b\u914d\u7f6e\u3057\u307e\u3059\u304b\uff1f","",!1,function(){var e=l.getSettableFurnitureModelArray(c.getUserFurnitureModelArrayByFurnitureId(t),this.roomFurnitureModelMap)[0];this.requestSetFurniture(e,function(){this.reload(),this.redraw()}.bind(this))}.bind(this),function(){this.redraw()}.bind(this),"\u914d\u7f6e\u3059\u308b","\u30ad\u30e3\u30f3\u30bb\u30eb",!0))},requestSaveSelectCharacter:function(t,e,i){n.RoomService.saveSelectCharacter(t,e,function(){i&&i(),"RoomCharacterScene"===this.getCurrentSceneName()&&(this.reload(),this.redraw())}.bind(this))},requestChangePartner:function(t,e,i){n.CharacterService.changePartner([t],e,function(t){i&&i(t)})},requestGift:function(t,e,i,a,o){var r=function(){this.reload(),this.redrawRoomCardDetailSubRoot()}.bind(this);n.PictureBookService.gift(t.getCharacterId(),e,1,function(e){o?o(t.getFriendship(),i,a,r,function(){Array.prototype.push.apply(this._newStories,this._getNewReleasedStories(this._recentStories)),this._recursiveOpenReleasedStoryConfrimPopup(this._newStories)}.bind(this)):r()}.bind(this))},_getNewReleasedStories:function(t){Array.prototype.push.apply(t,this._newStories);var e=n.dao.userStories;return t.length<e.length?_.filter(e,function(e){return!_.some(t,function(t){return t.getStoryId()===e.getStoryId()})}):[]},_recursiveOpenReleasedStoryConfrimPopup:function(t){if(!(t.length<=0)){this._newStories=[],this._recentStories=n.dao.userStories;var e=[];for(var i in t)e.push(this._openReleasedStoryConfrimPopup.bind(this,t[i].getStoryId(),"\u30b3\u30f3\u30c6\u30f3\u30c4\u89e3\u653e"));a.waterfall(e)}},setCurrentPictureBookBaseModel:function(t){t&&(this.setCurrentCharacterGroupId(t.getCharacterGroupId()),this.setCurrentCharacterId(t.getRoomSelectCharacterId()),this._currentPictureBookBaseContentsInfoMap=s.createCharacterContentsInfoMap(t.getCharacterGroupId(),t.getRoomSelectCharacterId(),t.getNormalStoryMasterArray(),t.getAdultStoryMasterArray(),t.getRoomStoryMasterArray(),t.getVoiceStoryMasterArray(),t.getUserNormalStoryMap(),t.getUserAdultStoryMap(),t.getUserRoomStoryMap(),t.getUserVoiceStoryMap()),this._currentPictureBookDetailInfoMap=s.createPictureBookDetailInfoMap(this.getCurrentCharacterGroupId(),t.getCharacterMainMasterArray()))},setCurrentPictureBookDetailModel:function(t){t&&(this.setCurrentCharacterId(t.getCharacterId()),this._currentPictureBookDetailVoiceInfoMap=t.getPictureBookDetailVoiceInfoMap())},setCurrentCharacterGroupId:function(t){this._currentCharacterGroupId=t},setCurrentCharacterId:function(t){this._currentCharacterId=t},getCurrentPictureBookBaseContentsInfoMap:function(){return this._currentPictureBookBaseContentsInfoMap},getCurrentPictureBookDetailInfoMap:function(){return this._currentPictureBookDetailInfoMap},getCurrentPictureBookContentInfoByStoryId:function(t){var e=this.getCurrentPictureBookBaseContentsInfoMap();for(var i in e)for(var a in e[i])if(e[i][a]&&t===e[i][a].storyMaster.getStoryId())return e[i][a];return this.getCurrentPictureBookDetailContentInfoByStoryId(t)},getCurrentPictureBookDetailContentInfoByStoryId:function(t){var e=this.getCurrentPictureBookDetailInfoMap();for(var i in e){var a=e[i].characterContentsInfoMap;for(var n in a)for(var o in a[n])if(a[n][o]&&t===a[n][o].storyMaster.getStoryId())return a[n][o]}return null},getCurrentPictureBookDetailVoiceInfoMap:function(){return this._currentPictureBookDetailVoiceInfoMap},getCurrentCharacterGroupId:function(){return this._currentCharacterGroupId||(this._currentCharacterGroupId=n.dao.pictureBookBase[0].getCharacterGroupId()),this._currentCharacterGroupId},getCurrentCharacterId:function(){return this._currentCharacterId},getCurrentPictureBookBaseModel:function(){var t=this.getCurrentCharacterGroupId();return this.userPictureBookBaseModelMap[t]},getPictureBookBaseModelMap:function(){return this.userPictureBookBaseModelMap},getCurrentPictureBookDetailModel:function(){var t=this.getCurrentCharacterId();return t?this.getCurrentPictureBookBaseModel().getPictureBookDetailModelByCharacterId(t):null},getPictureBookDetailModelByCharacterId:function(t){return t?this.getCurrentPictureBookBaseModel().getPictureBookDetailModelByCharacterId(t):null},addCharacterFriendshipStory:function(){var t=[];this.getCurrentPictureBookBaseModel().getPictureBookDetailModelArray().forEach(function(e){var i=this.getCurrentPictureBookDetailInfoMap()[e.getCharacterId()].characterContentsInfoMap;t=t.concat(e.getReleasableFriendshipStoryIdArray(i))}.bind(this)),t.length>0&&this.requestAddStory(t,function(){this.reload()}.bind(this),"\u30b3\u30f3\u30c6\u30f3\u30c4\u958b\u653e")},switchActiveRoomBackGroundSprite:function(t){t?(this._roomBackGroundSprite.node.active=!0,this._roomBackGroundSprite.node.opacity=0,h.setFadeIn(this._roomBackGroundSprite.node,.3)):!t&&this._roomBackGroundSprite.node.active&&h.setFadeOut(this._roomBackGroundSprite.node,.3,function(){this._roomBackGroundSprite.node.active=!1}.bind(this))},switchActiveCharacterUIView:function(t){this._roomCharacterUIView.node.active=t},switchActiveUI:function(t){this._uiHeader.node.active=t,this._switchActiveBackBtn(t),this.switchActiveCharacterUIView(t),this._roomWholeCharacterView.node.active=!0,this.roomCharacterSubRoot&&(this.roomCharacterSubRoot.node.active=t),this.roomFurnitureSelectSubRoot&&(this.roomFurnitureSelectSubRoot.node.active=t),this.roomFurnitureShopSubRoot&&(this.roomFurnitureShopSubRoot.node.active=t)},switchActiveRoomWholeCharacterView:function(t){this._roomWholeCharacterView.node.active=t},switchActiveRoomWholeFurnitureView:function(t){this._roomWholeFurnitureView.node.active=t},showUI:function(){this._roomCharacterUIView.showUI()},convertToIdxCategory:function(t){return T.IDX_CATEGORY[T.MAP_CATEGORY[t]]},convertToMapCategory:function(t){return T.MAP_CATEGORY[T.IDX_CATEGORY[t]]},showHeaderTitle:function(){this._uiHeader.showTitle()},hideHeaderTitle:function(){this._uiHeader.hideTitle()},setHeaderTitle:function(t){this._uiHeader.setTitle(t)},loadSpineForRoomCharacter:function(t,e){var i=t||this.getCurrentCharacterId(),a=r.getCharacterMainModelByCharacterId(i).getSpineDirectoryPath();this.requestRes(p.getFileNameCharacterRoomSpine(a),sp.SkeletonData,e)},setDisplayCharacter:function(t,e){this.loadSpineForRoomCharacter(t,function(){this._roomWholeCharacterView.setRoomWholeCharacterViewByCharacterId(t,e)}.bind(this))},playRandomSpineAnimationForRoomCharacter:function(){this._roomWholeCharacterView.playRandomSpineAction()},playSpineAnimationForRoomCharacter:function(t){this._roomWholeCharacterView.playSpineAction(t,S.ROOM_SPINE_ANIM_TYPE.IDLE)},moveInitCharacter:function(){this._roomWholeCharacterView.moveInitCharacterSpine()},moveSideCharacter:function(){this._roomWholeCharacterView.moveSideCharacterSpine()},isDefaultRoomCharacter:function(t){return this.getCurrentPictureBookBaseModel().getDefaultRoomCharacterMainModel().getCharacterId()===t}});cc._RF.pop()},{Async:"Async",CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",EventUtils:"EventUtils",ExtensionAdvUtils:"ExtensionAdvUtils",FurnitureUtils:"FurnitureUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",PictureBookUtils:"PictureBookUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",RoomCharacterViewSetting:"RoomCharacterViewSetting",RoomConst:"RoomConst",RoomRootBase:"RoomRootBase",RoomUtils:"RoomUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",StoryConst:"StoryConst",StoryUtils:"StoryUtils"}],RoomCharacterSkinSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"871f0ebX+FMr4p/Z3qlcWlJ","RoomCharacterSkinSelectSubRoot");var a=t("RoomSlideSubRootBase"),n=t("MatrixPageViewBase"),o=t("CommonUtils"),r=t("ResourceUtils");t("CharacterUtils"),cc.Class({extends:a,properties:{matrixPageView:n,thumbnailPrefab:cc.Prefab},_root:null,_serifBalloon:null,_selectPictureBookDetailModel:null,initRoomCharacterSkinSelectSubRoot:function(t,e){this._root=t,t.setCurrentCharacterGroupId(e),this._userPictureBookBaseModel=t.getCurrentPictureBookBaseModel(),this._initMatrixPageView(),this._initSerifBalloon(t),this._openTargetNodeAction(this.matrixPageView.node)},_initMatrixPageView:function(){this.matrixPageView.setCallBackToThumbnail(this._callbackToThumbnail.bind(this));var t=this._createCostumeDataList();this.matrixPageView.initMatrixPageView(t,t.length,this._callbackToCreateThumbnailNode.bind(this)),this._userPictureBookBaseModel.getRoomSelectCharacterId()&&this._setTargetSkinPageIndex(this._userPictureBookBaseModel.getRoomSelectCharacterId())},_setTargetSkinPageIndex:function(t){if(t){for(var e=this.matrixPageView.getVisibleDataList(),i=-1,a=0;a<e.length;a+=1)if(e[a].getCharacterId()===t){i=a;break}if(-1!==i){var n=parseInt(i/12);this.matrixPageView.setPageIndex(n),this.matrixPageView.content.getComponentsInChildren("MatrixThumbnailBase")[i-12*n].setSelectedNodeActive(!0)}}},_resetActiveThumbnails:function(){var t=this.matrixPageView.content.getComponentsInChildren("MatrixThumbnailBase");for(var e in t)t[e].setSelectedNodeActive(!1)},_callbackToThumbnail:function(t,e){this._resetActiveThumbnails(),t.setSelectedNodeActive(!0),this._selectPictureBookDetailModel=e,this._setSerifContent(this._selectPictureBookDetailModel),this._root.setDisplayCharacter(e.getCharacterId(),this._serifBalloon.getCurrentCharacterSkinName())},_callbackToCreateThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("ItemMatrixThumbnail")).resetItemMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("ItemMatrixThumbnail"),i.setSelectedNodeActive(!1),i.setMainImage(r.getFileNameCharacterCostumeByCostumeId(t.getCharacterMainMaster().getCostumeId())),i.node},onDisable:function(){if(this._selectPictureBookDetailModel){var t=this._selectPictureBookDetailModel.getCharacterGroupId(),e=this._selectPictureBookDetailModel.getCharacterId();this._root.requestSaveSelectCharacter(t,e)}},_createCostumeDataList:function(){var t=this._userPictureBookBaseModel.getPictureBookDetailModelArray(),e=[];for(var i in t){var a=t[i].getCharacterMainMaster().getCostumeId();this._isDuplicateArrayElement(e,a)&&e.push(a)}e.sort(o.sortFunc);var n=[];for(var r in e)n.push(this._getLowestRarityPictureBookDetailModelByCostumeId(t,e[r]));return n},_isDuplicateArrayElement:function(t,e){return!t.find(function(t){return t===e})},_getLowestRarityPictureBookDetailModelByCostumeId:function(t,e){var i=t.filter(function(t){return t.getCharacterMainMaster().getCostumeId()===e});return i.sort(function(t,e){return t.getCharacterMainMaster().getRarity()>e.getCharacterMainMaster().getRarity()?1:-1}),i[0]}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",MatrixPageViewBase:"MatrixPageViewBase",ResourceUtils:"ResourceUtils",RoomSlideSubRootBase:"RoomSlideSubRootBase"}],RoomCharacterSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"6e6761Hi7pGdLwo7cwoLpoX","RoomCharacterSubRoot");t("WindowBase"),t("CommonUtils");var a=t("CommonButton"),n=t("CommonPageView"),o=t("ViewUtils"),r=(t("Singleton"),t("ResourceUtils"),t("AnimationUtils")),s=(t("RoomConst"),t("CharacterConst")),c=(t("StaticResourceConst"),t("PictureBookUtils"));cc.Class({extends:cc.Component,properties:{commonPageView:n,serifParentNode:cc.Node,leftArrowBtn:a,rightArrowBtn:a,characterTapBtn:a,roomEpisodeBtn:a,cardEpisodeBtn:a,roomEpisodeBadgeNode:cc.Node,cardEpisodeBadgeNode:cc.Node},_root:null,_userPictureBookBaseModelMap:null,_serifBalloon:null,_isPageChanging:void 0,initRoomCharacterSubRoot:function(t,e){this._root=t,this._userPictureBookBaseModelMap=t.userPictureBookBaseModelMap;var i=Object.keys(t.userPictureBookBaseModelMap).length,a=t.userPictureBookBaseModelMap[e];this._addSerifWindow(),this._setRoomCharacter(a);var n=this._convertPageIdx(e);this.commonPageView.initCommonPageView(null,i,n,this._switchPageEvent.bind(this),this._swipePageEvent.bind(this)),this._initButtons(),this.redrawBadge()},switchActiveUI:function(t){for(var e in this.node.children){this.node.children[e].active=t}},_setRoomCharacter:function(t,e){this._root.setCurrentPictureBookBaseModel(t),this._root.loadSpineForRoomCharacter(null,function(){this._root.redrawRoomWholeView(),this._setSerifContent(t.getRoomSelectPictureBookDetailModel()),this.redrawBadge(),e&&e()}.bind(this))},_addSerifWindow:function(){this._serifBalloon||(this._serifBalloon=o.createSerifWindow(),this.serifParentNode.addChild(this._serifBalloon.node))},_setSerifContent:function(t){var e=t.getCharacterMainMaster(),i=e.getCostumeId(),a=[],n=[],o=[];c.getCharacterTextMasterArray(i,s.TEXT_SCENE_TYPE.ROOM,1).forEach(function(t){a.push(t.getText()),n.push(t.getVoiceFile()),o.push(t.getSkinName())}),this._serifBalloon.setSerifContent(e.getCharacterId(),e.getShortName(),a,n,o),this._serifBalloon.playRandomSerifAnimation(),this._root.playSpineAnimationForRoomCharacter(this._serifBalloon.getCurrentCharacterSkinName())},_switchPageEvent:function(t){this.leftArrowBtn.setTouchEnable(!1),this.rightArrowBtn.setTouchEnable(!1);var e=this.commonPageView.getMoveDirection();r.startSlideInAnimation(.5,e,cc.Color.BLACK,function(){var i=this._userPictureBookBaseModelMap[Object.keys(this._userPictureBookBaseModelMap)[t]];this._setRoomCharacter(i,function(){this.leftArrowBtn.setTouchEnable(!0),this.rightArrowBtn.setTouchEnable(!0),r.startSlideOutAnimation(.5,e,cc.Color.BLACK),setTimeout(function(){this._isPageChanging=!1}.bind(this),500),this._root.addCharacterFriendshipStory()}.bind(this))}.bind(this))},_swipePageEvent:function(t,e){switch(e.getType()){case cc.Node.EventType.TOUCH_END:this._swipePageEndEvent(t,e)}},_swipePageEndEvent:function(t,e){this._isPageChanging||(this._isPageChanging=!0,this.commonPageView.switchPageContent(t))},_initButtons:function(){this.characterTapBtn.setTapEvent(this._onTapCharacterTapBtn.bind(this)),this.leftArrowBtn.setTapEvent(this._onTapLeftArrowBtn.bind(this),a.SE_NAME.COUNT),this.rightArrowBtn.setTapEvent(this._onTapRightArrowBtn.bind(this),a.SE_NAME.COUNT),this.roomEpisodeBtn.setTapEvent(this._onTapRoomEpisodeBtn.bind(this)),this.cardEpisodeBtn.setTapEvent(this._onTapCardEpisodeBtn.bind(this))},_onTapLeftArrowBtn:function(){this._isPageChanging||(this._isPageChanging=!0,this.commonPageView.moveToLeftPageContent())},_onTapRightArrowBtn:function(){this._isPageChanging||(this._isPageChanging=!0,this.commonPageView.moveToRightPageContent())},_onTapCharacterTapBtn:function(){cc.log("\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u30bf\u30c3\u30d7"),this._serifBalloon.playRandomSerifAnimation(),this._root.playSpineAnimationForRoomCharacter(this._serifBalloon.getCurrentCharacterSkinName())},_onTouchMoveCharacterTapBtn:function(){},_onTapCharacterGroupSelectBtn:function(){var t=this._userPictureBookBaseModelMap[Object.keys(this._userPictureBookBaseModelMap)[this.commonPageView.getPageIndex()]];this._root.transitionRoomScene(t.getCharacterGroupId())},_onTapRoomEpisodeBtn:function(){this._root.pushRoomFurnitureEpisodeSubRoot(this._createPreViewParam())},_onTapCardEpisodeBtn:function(){this._root.pushRoomCardEpisodeSubRoot(this._createPreViewParam())},_convertPageIdx:function(t){var e=0;for(var i in this._userPictureBookBaseModelMap){if(parseInt(i)===t)break;e+=1}return e},_createPreViewParam:function(){return{RoomCharacterSubRoot:{characterGroupId:this._root.getCurrentPictureBookBaseModel().getCharacterGroupId()}}},redrawBadge:function(){var t=this._root.getCurrentPictureBookBaseModel();t.isNewReleasedRoomStory()?this.roomEpisodeBadgeNode.active=!0:this.roomEpisodeBadgeNode.active=!1,t.isNewReleasedCardStory()?this.cardEpisodeBadgeNode.active=!0:this.cardEpisodeBadgeNode.active=!1}});cc._RF.pop()},{AnimationUtils:"AnimationUtils",CharacterConst:"CharacterConst",CommonButton:"CommonButton",CommonPageView:"CommonPageView",CommonUtils:"CommonUtils",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",ViewUtils:"ViewUtils",WindowBase:"WindowBase"}],RoomCharacterUIView:[function(t,e,i){"use strict";cc._RF.push(e,"eda47b42vpA1pbQU2vlh56D","RoomCharacterUIView");var a=t("Singleton"),n=(t("CommonUtils"),t("CommonButton"));t("PopupUtils");cc.Class({extends:cc.Component,properties:{furnitureSelectBtn:n,furnitureShopBtn:n,changeCostumeBtn:n,wholeDisplayBtn:n},_root:null,onLoad:function(){this._initButtons()},initRoomCharacterUIView:function(t){this._root=t},_initButtons:function(){this.furnitureSelectBtn.setTapEvent(this._onTapFurnitureSelectBtn.bind(this)),this.furnitureShopBtn.setTapEvent(this._onTapFurnitureShopBtn.bind(this)),this.changeCostumeBtn.setTapEvent(this._onTapChangeCostumeBtn.bind(this),n.SE_NAME.EQUIP),this.wholeDisplayBtn.setTapEvent(this._onTapWholeDisplayBtn.bind(this)),this.showUI()},_onTapFurnitureSelectBtn:function(){cc.log("\u5bb6\u5177\u9078\u629e\u753b\u9762\u8868\u793a"),this._root.pushFurnitureSelectSubRoot(this._createPreViewParam()),this.hideUI()},_onTapFurnitureShopBtn:function(){cc.log("\u5bb6\u5177\u8cfc\u5165\u753b\u9762\u8868\u793a"),this._root.pushFurnitureShopSubRoot(this._createPreViewParam()),this.hideUI()},_onTapWholeDisplayBtn:function(){cc.log(">UI\u6d88\u53bb");var t=new cc.Node("touchListerNode");t.setContentSize(cc.winSize),t.on(cc.Node.EventType.TOUCH_END,this._onTapHideCharacter,this),this._root.node.addChild(t),this._root.switchActiveUI(!1)},_onTapHideCharacter:function(t){cc.log(">\u80cc\u666f\u306e\u307f"),t.target.destroy();var e=new cc.Node("touchListerNode");e.setContentSize(cc.winSize),e.on(cc.Node.EventType.TOUCH_END,this._onTapDispUiBtn,this),this._root.node.addChild(e),this._root.switchActiveRoomWholeCharacterView(!1),t.stopPropagation()},_onTapDispUiBtn:function(t){cc.log(">\u901a\u5e38\u8868\u793a"),t.target.destroy(),this._root.switchActiveUI(!0),t.stopPropagation()},_onTapChangeCostumeBtn:function(){cc.log(">\u8863\u88c5\u5909\u66f4"),this._root.pushRoomCharacterSkinSelectSubRoot(this._createPreViewParam()),this.hideUI()},showUI:function(){this.furnitureSelectBtn.node.active=!0,this.furnitureShopBtn.node.active=!0,this.changeCostumeBtn.node.active=!0,this.wholeDisplayBtn.node.active=!0,this.redraw()},hideUI:function(){this.furnitureSelectBtn.node.active=!1,this.furnitureShopBtn.node.active=!1,this.changeCostumeBtn.node.active=!1,this.wholeDisplayBtn.node.active=!1},redraw:function(){},_createPreViewParam:function(){return{RoomCharacterSubRoot:{characterGroupId:this._root.getCurrentPictureBookBaseModel().getCharacterGroupId()}}},_isFavoriteRoom:function(){var t=a.dao[a.USER].userData.getPartner(),e=this._root.getCurrentCharacterId();return 0!==t.isDisplayRoom&&t.partnerId===e}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",PopupUtils:"PopupUtils",Singleton:"Singleton"}],RoomCharacterViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"945fdFVKxhOXZpNeeMPhM3R","RoomCharacterViewSetting");var a=t("RoomCharacterRootUtils");e.exports={ROOMCHARACTER_SETTING:{RoomCharacterSubRoot:{open:a.openRoomCharacterSubRoot,close:a.closeRoomCharacterSubRoot},RoomFurnitureSelectSubRoot:{open:a.openRoomFurnitureSelectSubRoot,close:a.closeRoomFurnitureSelectSubRoot},RoomFurnitureShopSubRoot:{open:a.openRoomFurnitureShopSubRoot,close:a.closeRoomFurnitureShopSubRoot},RoomCharacterSkinSelectSubRoot:{open:a.openRoomCharacterSkinSelectSubRoot,close:a.closeRoomCharacterSkinSelectSubRoot},RoomFurnitureEpisodeSubRoot:{open:a.openRoomFurnitureEpisodeSubRoot,close:a.closeRoomFurnitureEpisodeSubRoot},RoomCardEpisodeSubRoot:{open:a.openRoomCardEpisodeSubRoot,close:a.closeRoomCardEpisodeSubRoot},RoomCardDetailSubRoot:{open:a.openRoomCardDetailSubRoot,close:a.closeRoomCardDetailSubRoot}}},cc._RF.pop()},{RoomCharacterRootUtils:"RoomCharacterRootUtils"}],RoomConst:[function(t,e,i){"use strict";cc._RF.push(e,"85647ys0EdKmrYu/g2KXu1Z","RoomConst");cc.Class({statics:{MAX_FRIENDSHIP:100,CONTENTS_RELEASE_CONDITION_MAX_COUNT:2,MAP_CATEGORY:cc.Enum({INTERIOR:1,FLOOR:2,FURNITURE_1:3,FURNITURE_2:4,WALL_1:5,WALL_2:6}),IDX_CATEGORY:cc.Enum({INTERIOR:0,FLOOR:1,FURNITURE_1:2,FURNITURE_2:3,WALL_1:4,WALL_2:5}),POS_CATEGORY:{INTERIOR:cc.v2(0,0),FLOOR:cc.v2(0,0),FURNITURE_1:cc.v2(0,0),FURNITURE_2:cc.v2(0,0),WALL_1:cc.v2(0,0),WALL_2:cc.v2(0,0)},Z_ORDER_CATEGORY:{INTERIOR:1,FLOOR:0,FURNITURE_1:6,FURNITURE_2:5,WALL_1:2,WALL_2:4,INTERIOR_CURTAIN:3,INTERIOR_CEILING:7},FURNITURE_SELECT_TYPE:cc.Enum({EDIT:0,SHOP:1}),ROOM_CHARACTER_DETAIL_TOP_TAB:cc.Enum({SINGLE:0,LIST:1}),ROOM_CARD_DETAIL_TOP_TAB:cc.Enum({CONTENT:0,FRIENDSHIP:1}),ROOM_PICTURE_BOOK_DETAIL_TOP_TAB:cc.Enum({FRIENDSHIP:0,SCENARIO:1}),ROOM_PICTURE_BOOK_DETAIL_SCENARIO_TAB:cc.Enum({CHARACTER_SCENARIO:0,VOICE_SCENARIO:1,VOICE:2}),ROOM_CONTENTS_TYPE:cc.Enum({NONE:0,VOICE_SCENARIO:1,NORMAL_SCENARIO:2,ADULT_SCENARIO:3,ROOM_SCENARIO:9}),RELEASE_CONDITION_TYPE:cc.Enum({NON:0,FRIENDSHIP:1,EXCEEDLIMIT:2,STORY:3})}});cc._RF.pop()},{}],RoomEpisodeContentsThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"72488564y1AqpqJYonJKzra","RoomEpisodeContentsThumbnail"),cc.Class({extends:cc.Component,properties:{contentName:cc.Label,thumbnailParentNode:cc.Node},initRoomEpisodeContentsThumbnail:function(t){this.contentName.string=t,this.thumbnailParentNode.destroyAllChildren()},addThumbnail:function(t){this.thumbnailParentNode.addChild(t.node)}}),cc._RF.pop()},{}],RoomEpisodeThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"492f39iQyZAXrdxsEPts7AV","RoomEpisodeThumbnail");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{storyNameLabel:cc.Label,newNode:cc.Node,lockNode:cc.Node,unlockConditionLabel:cc.Label,rewardDisplayParent:cc.Node,rewardImageSprite:cc.Sprite,rewardCountLabel:cc.Label,thumbnailBtn:a},_callbackToThumbnail:null,_conditionId1:null,_conditionId2:null,_conditionId3:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtnEvent.bind(this))},setOnTapThumbnailCallBack:function(t){this._callbackToThumbnail=t},setConditionId1:function(t){this._conditionId1=t},setConditionId2:function(t){this._conditionId2=t},setConditionId3:function(t){this._conditionId3=t},getConditionId1:function(){return this._conditionId1},getConditionId2:function(){return this._conditionId2},getConditionId3:function(){return this._conditionId3},setName:function(t){this.storyNameLabel.string=t},setNew:function(t){this.newNode.active=t},setLocked:function(t){this.lockNode.active=t},setUnlockConditionLabel:function(t){this.unlockConditionLabel.string=t||""},setReward:function(t,e,i){t&&e&&i?(n.addSprite(this.rewardImageSprite,n.getFileNameItemImage(t)),this.rewardCountLabel.string="x"+i,this.rewardDisplayParent.active=!0):this.rewardDisplayParent.active=!1},_onTapThumbnailBtnEvent:function(){this._callbackToThumbnail&&this._callbackToThumbnail(this)}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],RoomFurnitureBuyConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"3641ce8ZO5CjZAQ+XcBRC73","RoomFurnitureBuyConfirmPopup");var a=t("PopupBase"),n=(t("Singleton"),t("CommonButton")),o=t("CommonCountView"),r=t("ItemUtils"),s=t("PopupUtils"),c=t("CommonUtils"),l=t("ResourceUtils");cc.Class({extends:a,properties:{furnitureImageSprite:cc.Sprite,furnitureNameLabel:cc.Label,furnitureDescriptionLabel:cc.Label,countView:o,needCostCountLabel:cc.Label,hasCostCountLabel:cc.Label,afterCostCountLabel:cc.Label,buyFurnitureBtn:n,cancelBtn:n},_root:null,_furnitureInfo:null,_exchangeItemMaxCount:0,_exchangeSelectItemcount:0,_callbackToAfterRequest:null,_buyCount:0,openRoomfurnitureBuyConfirmPopup:function(t,e,i){this._initRoomFurnitureBuyConfirmPopup(t,e,i),this.open()},_initRoomFurnitureBuyConfirmPopup:function(t,e,i){this._root=t,this._furnitureInfo=e,this._callbackToAfterRequest=i,this._buyCount=1,this._initFurnitureParams(e),this._initCountView(e),this.countView.node.active=!1,this._setButtonEvents(),this._redrawCost(this._buyCount)},_initFurnitureParams:function(t){var e=t.furnitureMainModel,i=t.furnitureCostMaster;l.addSprite(this.furnitureImageSprite,l.getFileNameFurnitureThumbnail(t.furnitureId)),this.furnitureNameLabel.string=e.getName(),this.furnitureDescriptionLabel.string=e.getDescription(),this.needCostCountLabel.string=c.convertToCommaDelimited(i.getCostCount())},_initCountView:function(t){var e=t.furnitureMainModel.getMaxCount()-t.userFurnitureModelArray.length;this.countView.initCommonCountView(this._redrawCost.bind(this),1,e,1)},_setButtonEvents:function(){this.buyFurnitureBtn.setTapEvent(this._buyFurnitureBtnEvent.bind(this)),this.cancelBtn.setTapEvent(this._closeBtnEvent.bind(this),n.SE_NAME.CANCEL)},_redrawCost:function(t){this._furnitureInfo.furnitureMainModel;var e=this._furnitureInfo.furnitureCostMaster,i=r.getUserItemCount(e.getCostId());this.hasCostCountLabel.string=c.convertToCommaDelimited(i);var a=i-e.getCostCount()*t;parseInt(this.afterCostCountLabel.string)>=0?this.afterCostCountLabel.node.color=cc.color(111,233,255):this.afterCostCountLabel.node.color=cc.color(255,128,128),this.afterCostCountLabel.string=c.convertToCommaDelimited(a)},_buyFurnitureBtnEvent:function(){if(parseInt(this.afterCostCountLabel.string)>=0){var t=this._furnitureInfo.furnitureId,e=this._furnitureInfo.furnitureCostMaster.getCostId(),i=this._buyCount;this._root.requestBuyFurniture(t,e,i,this.close.bind(this))}else s.openCommonPopupOk("\u901a\u8ca8\u4e0d\u8db3","\u901a\u8ca8\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u305f\u3081\u8cfc\u5165\u3067\u304d\u307e\u305b\u3093\u3002")},_closeBtnEvent:function(){this.close()}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],RoomFurnitureDetailCharacterListView:[function(t,e,i){"use strict";cc._RF.push(e,"ba1b897/m5Cbq2z08QxrWWX","RoomFurnitureDetailCharacterListView");t("ResourceUtils"),t("StaticResourceConst");var a=t("PictureBookUtils"),n=(t("RoomUtils"),t("CharacterUtils"));cc.Class({extends:cc.Component,properties:{scrollView:cc.ScrollView,characterThumbnailPrefab:cc.Prefab},initRoomFurnitureDetailCharacterListView:function(t,e){if(this.scrollView.content.destroyAllChildren(),t){var i=a.getPictureBookBaseModelArrayByFurnitureId(t.furnitureId);for(var n in i){var o=i[n],r=cc.instantiate(this.characterThumbnailPrefab).getComponent("CharacterMatrixThumbnail");this._initRoomFurnitureDetailCharacterThumbnail(r,o,t,e),this.scrollView.content.addChild(r.node)}}},_initRoomFurnitureDetailCharacterThumbnail:function(t,e,i,a){var o=n.getCharacterMainModelByCharacterId(e.getRoomSelectCharacterId());t.initCharacterMatrixThumbnail(o,-1,-1,-1),t.setCallbackToThumbnailBtn(function(){this._resetActiveThumbnails(),t.setSelectedNodeActive(!0),a&&a(e,i)}.bind(this))},_resetActiveThumbnails:function(){var t=this.scrollView.content.getComponentsInChildren("MatrixThumbnailBase");for(var e in t)t[e].setSelectedNodeActive(!1)}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",RoomUtils:"RoomUtils",StaticResourceConst:"StaticResourceConst"}],RoomFurnitureDetailSelectWindow:[function(t,e,i){"use strict";cc._RF.push(e,"e54af56VrFKXLpnw4mIjwMr","RoomFurnitureDetailSelectWindow");t("CommonButton");var a=t("RoomUtils"),n=(t("PictureBookUtils"),t("ResourceUtils"),t("StaticResourceConst"),t("RoomConst")),o=t("RoomFurnitureDetailWindowBase"),r=t("RoomFurnitureDetailCharacterListView");cc.Class({extends:o,properties:{roomFurnitureDetailCharacterListView:r,roomFurnitureExecuteLabel:cc.Label},_swapPictureBookBaseModel:null,setMapCategory:function(t){switch(this._super(t),t){case n.MAP_CATEGORY.INTERIOR:case n.MAP_CATEGORY.FLOOR:this.roomFurnitureDetailCharacterListView.node.active=!1;break;default:this.roomFurnitureDetailCharacterListView.node.active=!0}},setRoomFurnitureDetailParameter:function(t){this._super(t),this.roomFurnitureDetailCharacterListView.initRoomFurnitureDetailCharacterListView(t,this._callbackToCharacterThumbnailTapEvent.bind(this))},_checkActiveForRoomFurnitureExecuteBtn:function(t){if(this.roomFurnitureExecuteLabel.string="\u5909\u66f4",!t)return!1;for(var e in t.roomFurnitureModelArray)if(t.roomFurnitureModelArray[e].getCharacterGroupId()===this._root.getCurrentPictureBookBaseModel().getCharacterGroupId())return this.roomFurnitureExecuteLabel.string="\u8a2d\u5b9a\u4e2d",!1;switch(t.furnitureMainModel.getMapCategory()){case n.MAP_CATEGORY.INTERIOR:case n.MAP_CATEGORY.FLOOR:return!0}return this._swapPictureBookBaseModel?this._swapPictureBookBaseModel.getCharacterGroupId()!==this._root.getCurrentPictureBookBaseModel().getCharacterGroupId():t.userFurnitureModelArray.length-t.roomFurnitureModelArray.length>0},_callbackToCreateThumbnailNode:function(t,e,i){var a=this._super(t,e,i).getComponent("RoomFurnitureThumbnail");e&&a.resetRoomFurnitureThumbnail();var n=t.furnitureMainModel,o=this._getDenomCount(n.getMapCategory(),t.userFurnitureModelArray.length),r=t.userFurnitureModelArray.length-t.roomFurnitureModelArray.length;return a.initRoomFurnitureThumbnail(n.getFurnitureId(),r,o,0,function(){this._callbackToFurnitureThumbnailTapEvent(a,t)}.bind(this)),a.node},_callbackToFurnitureThumbnailTapEvent:function(t,e){this._swapPictureBookBaseModel=null,this._super(t,e)},_callbackToCharacterThumbnailTapEvent:function(t,e){this._swapPictureBookBaseModel=t,this._switchActiveForRoomFurnitureExecuteBtn(this._checkActiveForRoomFurnitureExecuteBtn(e))},_roomFurnitureExecuteBtnEvent:function(){if(this._super(),this._furnitureInfo&&this._swapPictureBookBaseModel)this._root.openRoomFurnitureSelectConfirmPopup(this._furnitureInfo,this._swapPictureBookBaseModel,this.redraw.bind(this));else if(this._furnitureInfo){var t=a.getSettableFurnitureModelArray(this._furnitureInfo.userFurnitureModelArray,this._root.roomFurnitureModelMap),e=null;switch(this._furnitureInfo.furnitureMainModel.getMapCategory()){case n.MAP_CATEGORY.INTERIOR:case n.MAP_CATEGORY.FLOOR:e=this._furnitureInfo.userFurnitureModelArray[0];break;default:t.length>0&&(e=t[0])}if(e){this._root.getCurrentPictureBookBaseModel().getCharacterGroupId();this._root.requestSetFurniture(e,this.redraw.bind(this))}}},_getDenomCount:function(t,e){switch(t){case n.MAP_CATEGORY.INTERIOR:case n.MAP_CATEGORY.FLOOR:e=0}return e}}),cc._RF.pop()},{CommonButton:"CommonButton",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",RoomFurnitureDetailCharacterListView:"RoomFurnitureDetailCharacterListView",RoomFurnitureDetailWindowBase:"RoomFurnitureDetailWindowBase",RoomUtils:"RoomUtils",StaticResourceConst:"StaticResourceConst"}],RoomFurnitureDetailShopWindow:[function(t,e,i){"use strict";cc._RF.push(e,"1e74f7WzmdFzpP8WW9LKjYZ","RoomFurnitureDetailShopWindow");t("CommonButton");var a=t("PictureBookUtils"),n=t("RoomFurnitureDetailWindowBase");cc.Class({extends:n,properties:{furnitureCostLabel:cc.Label,soldOutNode:cc.Node,roomFurnitureExecuteLabel:cc.Label},setRoomFurnitureDetailParameter:function(t){this._super(t),this.furnitureCostLabel.string=t?t.furnitureCostMaster.getCostCount()+"":"0"},onSetPageContent:function(t){t.childrenCount>0?this.soldOutNode.active=!1:this.soldOutNode.active=!0},_checkActiveForRoomFurnitureExecuteBtn:function(t){return this.roomFurnitureExecuteLabel.string="\u8cfc\u5165",!!t&&(!(t.furnitureMainModel.getMaxCount()-t.userBuyFurnitureModelArray.length<=0)||(this.roomFurnitureExecuteLabel.string="\u914d\u7f6e\u89e3\u9664",t.furnitureMainModel.getMaxCount()<=a.getPictureBookBaseModelArrayByFurnitureId(t.furnitureId).length))},_callbackToCreateThumbnailNode:function(t,e,i){if(!t.furnitureCostMaster)return null;var a=this._super(t,e,i).getComponent("RoomFurnitureThumbnail");e&&a.resetRoomFurnitureThumbnail();var n=t.furnitureMainModel,o=n.getMaxCount(),r=o-t.userBuyFurnitureModelArray.length;if(r>0){var s=t.furnitureCostMaster.getCostCount();return a.initRoomFurnitureThumbnail(n.getFurnitureId(),r,o,s,function(){this._callbackToFurnitureThumbnailTapEvent(a,t)}.bind(this)),a.node}s=t.furnitureCostMaster.getCostCount();return a.initRoomFurnitureThumbnail(n.getFurnitureId(),r,o,s,function(){this._callbackToFurnitureThumbnailTapEvent(a,t)}.bind(this)),a.node},_callbackToFurnitureThumbnailTapEvent:function(t,e){this._super(t,e)},_roomFurnitureExecuteBtnEvent:function(){this._super(),this._furnitureInfo.furnitureMainModel.getMaxCount()-this._furnitureInfo.userBuyFurnitureModelArray.length>0?this._root.openRoomFurnitureBuyConfirmPopup(this._furnitureInfo):this._root.openRoomFurnitureReleaseConfirmPopup(this._furnitureInfo)}}),cc._RF.pop()},{CommonButton:"CommonButton",PictureBookUtils:"PictureBookUtils",RoomFurnitureDetailWindowBase:"RoomFurnitureDetailWindowBase"}],RoomFurnitureDetailWindowBase:[function(t,e,i){"use strict";cc._RF.push(e,"af557i6ydZH0Iri7DhMLT6U","RoomFurnitureDetailWindowBase");var a=t("WindowBase"),n=t("CommonUtils"),o=t("GameConst"),r=t("ResourceUtils"),s=t("CommonButton"),c=t("Singleton"),l=t("FurnitureUtils"),u=t("RoomFurnitureReleaseCharacterListView");cc.Class({extends:a,properties:{roomFurnitureThumbnailPrefab:cc.Prefab,furnitureImageSprite:cc.Sprite,furnitureNameLabel:cc.Label,furnitureDescriptionLabel:cc.Label,roomFurnitureExecuteBtn:s,roomFurnitureReleaseCharacterListView:u},_root:null,_mapCategory:0,_furnitureInfo:null,initRoomFurnitureDetailWindow:function(t){this.node.active=!0,this._root=t,this.roomFurnitureExecuteBtn.setTapEvent(this._roomFurnitureExecuteBtnEvent.bind(this)),this.resetRoomFurnitureDetailWindow()},setMapCategory:function(t){this._mapCategory=t},onSetPageContent:function(t){},setRoomFurnitureDetailParameter:function(t){if(this._furnitureInfo=t,this._switchActiveForRoomFurnitureExecuteBtn(this._checkActiveForRoomFurnitureExecuteBtn(t)),t){var e=t.furnitureMainModel;r.addSprite(this.furnitureImageSprite,r.getFileNameFurnitureSmall(e.getFurnitureId())),this.furnitureNameLabel.string=e.getName(),this.furnitureDescriptionLabel.string=e.getDescription(),this.roomFurnitureReleaseCharacterListView.node.active=!0,this.roomFurnitureReleaseCharacterListView.initRoomFurnitureReleaseCharacterListView(this._root,t,null)}else this.furnitureImageSprite.spriteFrame=null,this.furnitureNameLabel.string="",this.furnitureDescriptionLabel.string="",this.roomFurnitureReleaseCharacterListView.node.active=!1},resetRoomFurnitureDetailWindow:function(){this.setRoomFurnitureDetailParameter(null)},_checkActiveForRoomFurnitureExecuteBtn:function(t){cc.error("_checkActiveForRoomFurnitureExecuteBtn() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_switchActiveForRoomFurnitureExecuteBtn:function(t){this.roomFurnitureExecuteBtn.setTouchEnable(t),t?n.setChildrenColorOrLabelOpacity(this.roomFurnitureExecuteBtn.node,cc.Color.WHITE,o.ACTIVATE_OPACITY):n.setChildrenColorOrLabelOpacity(this.roomFurnitureExecuteBtn.node,cc.Color.GRAY,o.DEACTIVATE_OPACITY)},redraw:function(){var t=l.createFurnitureInfo(this._furnitureInfo.furnitureMainModel,c.dao.userFurniture);this.setRoomFurnitureDetailParameter(t)},_callbackToCreateThumbnailNode:function(t,e,i){return e||cc.instantiate(this.roomFurnitureThumbnailPrefab)},_callbackToFurnitureThumbnailTapEvent:function(t,e){var i=t.node.parent.getComponentsInChildren("RoomFurnitureThumbnail");for(var a in i)i[a].switchChecker(!1);t.switchChecker(!0),this.setRoomFurnitureDetailParameter(e)},getCallbackToCreateThumbnailNode:function(){return this._callbackToCreateThumbnailNode},_roomFurnitureExecuteBtnEvent:function(){}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",FurnitureUtils:"FurnitureUtils",GameConst:"GameConst",ResourceUtils:"ResourceUtils",RoomFurnitureReleaseCharacterListView:"RoomFurnitureReleaseCharacterListView",Singleton:"Singleton",WindowBase:"WindowBase"}],RoomFurnitureEpisodeListView:[function(t,e,i){"use strict";cc._RF.push(e,"ac1e3iRnDpPXa15NDlJyFte","RoomFurnitureEpisodeListView");var a=t("Singleton"),n=t("ListViewBase"),o=(t("CommonUtils"),t("FurnitureUtils")),r=t("PictureBookUtils"),s=t("TimeUtils");cc.Class({extends:n,properties:{},_root:null,initRoomFurnitureEpisodeListView:function(t,e){this._root=t,this._setListContent(t,e)},_setListContent:function(t,e){var i=_.filter(a.dao.FurnitureMainMasters,function(t){return s.isRangeOfDate(t.getFromDate(),void 0)});this._roomStoryMasterArray=a.dao.StoryRoomMasters.filter(function(t){return t.getCondition1()===e&&_.some(i,function(e){return t.getCondition2()===e.getFurnitureId()})}),this._userRoomStoryMap=r.createUserRoomStoryMap(this._roomStoryMasterArray),this._furnitureMap=o.createAllFurnitureMap(),this._roomStoryMasterArray.forEach(function(t){var e=t.getCondition2(),i=parseInt((e+"").substring(0,1)),a=!1,n=!1;this._furnitureMap[i].find(function(t){return t.furnitureId===e}).userFurnitureModelArray.length<=0||!this._userRoomStoryMap[t.getStoryId()]?a=!0:this._userRoomStoryMap[t.getStoryId()]&&(n=!this._userRoomStoryMap[t.getStoryId()].getIsRead()),this._addThumbnail(t,e,n,a)}.bind(this)),this.redraw()},_addThumbnail:function(t,e,i,a){var n=cc.instantiate(this.thumbnailPrefab).getComponent("RoomEpisodeThumbnail");n.setOnTapThumbnailCallBack(this._callbackToThumbnail.bind(this)),n.setConditionId1(t.getStoryId()),n.setConditionId2(e),n.setName(t.getName()),n.setNew(i),i?n.setReward(t.getRewardId(),t.getRewardType(),t.getRewardCount()):n.setReward(),n.setLocked(a),this.thumbnailParentNode.addChild(n.node)},_callbackToThumbnail:function(t){var e=t.getConditionId1(),i=t.getConditionId2(),a=parseInt((i+"").substring(0,1));if(this._furnitureMap[a].find(function(t){return t.furnitureId===i}).userFurnitureModelArray.length<=0)this._root.openRoomHowToGetFurniturePopup(e);else if(this._userRoomStoryMap[e])this._root.openReadStoryConfirmPopup(this._userRoomStoryMap[e]);else{this._roomStoryMasterArray.find(function(t){return t.getStoryId()===e}).getCondition1();this._root.openRoomReleaseFurnitureEpisodePopup(e)}this.redraw()},redraw:function(){this.redrawListContent()},redrawListContent:function(){}});cc._RF.pop()},{CommonUtils:"CommonUtils",FurnitureUtils:"FurnitureUtils",ListViewBase:"ListViewBase",PictureBookUtils:"PictureBookUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],RoomFurnitureEpisodeSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"27cdfNJxHlAIqN5QqCo3nie","RoomFurnitureEpisodeSubRoot");var a=t("RoomSlideSubRootBase"),n=t("RoomFurnitureEpisodeListView");t("CommonUtils"),cc.Class({extends:a,properties:{roomFurnitureEpisodeListView:n},initRoomFurnitureEpisodeSubRoot:function(t,e){this._userPictureBookBaseModel=t.getCurrentPictureBookBaseModel(),this.roomFurnitureEpisodeListView.initRoomFurnitureEpisodeListView(t,e),this._initSerifBalloon(t),this._openTargetNodeAction(this.roomFurnitureEpisodeListView.node)}});cc._RF.pop()},{CommonUtils:"CommonUtils",RoomFurnitureEpisodeListView:"RoomFurnitureEpisodeListView",RoomSlideSubRootBase:"RoomSlideSubRootBase"}],RoomFurnitureListView:[function(t,e,i){"use strict";cc._RF.push(e,"5ba54WCJGxNE77zMyuAZJqE","RoomFurnitureListView");t("Singleton");var a=t("WindowBase"),n=t("ListPageView"),o=(t("CommonPageView"),t("FurnitureUtils"),t("RoomConst")),r=t("RoomFurnitureDetailSelectWindow"),s=t("RoomFurnitureDetailShopWindow");cc.Class({extends:a,properties:{listPageView:n,furnitureListLayout:cc.Layout,roomFurnitureSelectDetailWindow:r,roomFurnitureShopDetailWindow:s},_furnitureDetailWindow:null,initRoomFurnitureListView:function(t,e){this._initDetailWindow(t,e)},setPageContent:function(t,e){this._furnitureDetailWindow.resetRoomFurnitureDetailWindow(),this._furnitureDetailWindow.setMapCategory(t);var i=this._furnitureDetailWindow.getCallbackToCreateThumbnailNode();this.listPageView.initListPageView(null,i.bind(this._furnitureDetailWindow),e),this._furnitureDetailWindow.onSetPageContent(this.listPageView.content)},_initDetailWindow:function(t,e){switch(this.roomFurnitureSelectDetailWindow.node.active=!1,this.roomFurnitureShopDetailWindow.node.active=!1,e){case o.FURNITURE_SELECT_TYPE.EDIT:this._furnitureDetailWindow=this.roomFurnitureSelectDetailWindow;break;case o.FURNITURE_SELECT_TYPE.SHOP:this._furnitureDetailWindow=this.roomFurnitureShopDetailWindow}this._furnitureDetailWindow.initRoomFurnitureDetailWindow(t)},setRoomFurnitureDetailParameter:function(t){this._furnitureDetailWindow.setRoomFurnitureDetailParameter(t)}}),cc._RF.pop()},{CommonPageView:"CommonPageView",FurnitureUtils:"FurnitureUtils",ListPageView:"ListPageView",RoomConst:"RoomConst",RoomFurnitureDetailSelectWindow:"RoomFurnitureDetailSelectWindow",RoomFurnitureDetailShopWindow:"RoomFurnitureDetailShopWindow",Singleton:"Singleton",WindowBase:"WindowBase"}],RoomFurnitureModel:[function(t,e,i){"use strict";cc._RF.push(e,"9a517k5m0lJz4oTVz6KYQ/p","RoomFurnitureModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,_userFurnitureModel:void 0,getUserFurnitureModel:function(){return this._userFurnitureModel||(this._userFurnitureModel=n.dao.userFurniture.find(function(t){return t.getFurnitureCd()===this.getFurnitureCd()}.bind(this))),this._userFurnitureModel},getFurnitureMainMaster:function(){return this.getUserFurnitureModel().getFurnitureMainMaster()},getFurnitureId:function(){return this.getFurnitureMainMaster().getFurnitureId()},getFurnitureName:function(){return this.getFurnitureMainMaster().getName()},getMapCategory:function(){if(this._isKeyFieldAvailable("mapCategory"))return this._data.mapCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: mapCategory")},getCharacterGroupId:function(){if(this._isKeyFieldAvailable("characterGroupId"))return this._data.characterGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterGroupId")},getFurnitureCd:function(){if(this._isKeyFieldAvailable("furnitureCd"))return this._data.furnitureCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureCd")},getNextCollectDate:function(){if(this._isKeyFieldAvailable("nextCollectDate"))return this._data.nextCollectDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: nextCollectDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RoomFurnitureReleaseCharacterListView:[function(t,e,i){"use strict";cc._RF.push(e,"673ccI9ntRG+6d5aGhiGcKS","RoomFurnitureReleaseCharacterListView");var a=t("ResourceUtils"),n=t("StaticResourceConst"),o=t("PictureBookUtils"),r=(t("RoomUtils"),t("CommonUtils")),s=(t("RoomConst"),t("CharacterUtils"));cc.Class({extends:cc.Component,properties:{scrollView:cc.ScrollView},_root:null,initRoomFurnitureReleaseCharacterListView:function(t,e,i){if(this._root=t,this.scrollView.content.destroyAllChildren(),e){var a=this._createCharacterGroupIdArrayMap(e.furnitureId),n=a.released.concat(a.nonReleased);this._setScrollViewThumbnail(n,a.nonReleased)}},_createCharacterGroupIdArrayMap:function(t){var e=this._root.getPictureBookBaseModelMap(),i=[],a=[];return o.getRoomStoryMasterArrayByFurnitureId(t).forEach(function(t){var n=t.getCondition1();if(e[n]){var o=e[n].getUserRoomStoryMap();Object.keys(o).find(function(e){return parseInt(e)===t.getStoryId()})?i.push(n):a.push(n)}}),i.sort(r.sortFunc),a.sort(r.sortFunc),{released:i,nonReleased:a}},_setScrollViewThumbnail:function(t,e){for(var i=this._root.getPictureBookBaseModelMap(),o=0;o<t.length;o+=1){var r=s.getCharacterMainModelByCharacterId(i[t[o]].getRoomSelectCharacterId()),c=cc.instantiate(a.getResource(n.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");c.setMainImage(a.getFileNameCharacterThumbnail(r.getCostumeId()));for(var l=0;l<e.length;l+=1)if(t[o]===e[l]){c.setActive(!0);break}this.scrollView.content.addChild(c.node)}}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",RoomUtils:"RoomUtils",StaticResourceConst:"StaticResourceConst"}],RoomFurnitureReleaseConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"35db20e9FJGXYQ+iExciXz8","RoomFurnitureReleaseConfirmPopup");var a=t("PopupBase"),n=t("CommonUtils"),o=t("GameConst"),r=t("CommonButton"),s=t("CommonScrollView"),c=t("ResourceUtils"),l=t("CharacterUtils"),u=t("PopupUtils"),h=t("PictureBookUtils");t("StaticResourceConst"),cc.Class({extends:a,properties:{furnitureImageSprite:cc.Sprite,furnitureNameLabel:cc.Label,furnitureDescriptionLabel:cc.Label,commonScrollView:s,content:cc.Node,matrixThumbnailPrefab:cc.Prefab,releaseBtn:r,cancelBtn:r},_furnitureInfo:null,_selectedPictureBookBaseArray:null,_releaseBtnCallBack:null,onLoad:function(){this.releaseBtn.setTapEvent(this._onTapReleaseBtnEvent.bind(this),r.SE_NAME.CANCEL),this.cancelBtn.setTapEvent(this._onTapCancelBtnEvent.bind(this),r.SE_NAME.CANCEL)},openRoomFurnitureReleaseConfirmPopup:function(t,e){this._initRoomFurnitureReleaseConfirmPopup(t,e),this.open(function(){this._initContents()}.bind(this))},_initRoomFurnitureReleaseConfirmPopup:function(t,e){this._furnitureInfo=t,this._releaseBtnCallBack=e,this._initFurnitureParams()},_initFurnitureParams:function(){var t=this._furnitureInfo.furnitureMainModel;c.addSprite(this.furnitureImageSprite,c.getFileNameFurnitureThumbnail(this._furnitureInfo.furnitureId)),this.furnitureNameLabel.string=t.getName(),this.furnitureDescriptionLabel.string=t.getDescription()},_initContents:function(){this._selectedPictureBookBaseArray=[],this.content.destroyAllChildren();var t=h.getPictureBookBaseModelArrayByFurnitureId(this._furnitureInfo.furnitureId);for(var e in t){var i=t[e],a=cc.instantiate(this.matrixThumbnailPrefab).getComponent("CharacterMatrixThumbnail");this._initCharacterThumbnail(a,i,this._furnitureInfo),this.content.addChild(a.node)}this._resetActiveThumbnails(),this._redrawReleaseBtn()},_initCharacterThumbnail:function(t,e,i){var a=l.getCharacterMainModelByCharacterId(e.getRoomSelectCharacterId());t.initCharacterMatrixThumbnail(a,-1,-1,-1),t.setCallbackToThumbnailBtn(function(){t.setSelectedNodeActive(this._selectThumbnailsEvent(e)),this._redrawReleaseBtn()}.bind(this))},_resetActiveThumbnails:function(){var t=this.content.getComponentsInChildren("MatrixThumbnailBase");for(var e in t)t[e].setSelectedNodeActive(!1)},_selectThumbnailsEvent:function(t){return this._selectedPictureBookBaseArray.find(function(e){return e.getCharacterGroupId()===t.getCharacterGroupId()})?(this._selectedPictureBookBaseArray=this._selectedPictureBookBaseArray.filter(function(e){return e.getCharacterGroupId()!==t.getCharacterGroupId()}),!1):(this._selectedPictureBookBaseArray.push(t),!0)},_createReleaseFurnitureModelArray:function(){return this._furnitureInfo.roomFurnitureModelArray.filter(function(t){return this._selectedPictureBookBaseArray.find(function(e){return e.getCharacterGroupId()===t.getCharacterGroupId()})}.bind(this))},_redrawReleaseBtn:function(){this._switchActiveForReleaseBtn(this._selectedPictureBookBaseArray.length>0)},_switchActiveForReleaseBtn:function(t){this.releaseBtn.setTouchEnable(t),t?n.setChildrenColorOrLabelOpacity(this.releaseBtn.node,cc.Color.WHITE,o.ACTIVATE_OPACITY):n.setChildrenColorOrLabelOpacity(this.releaseBtn.node,cc.Color.GRAY,o.DEACTIVATE_OPACITY)},_onTapReleaseBtnEvent:function(){this._releaseBtnCallBack&&this._releaseBtnCallBack(this._createReleaseFurnitureModelArray(),function(){u.openCommonPopupOk("\u89e3\u9664\u5b8c\u4e86","\u9078\u629e\u3055\u308c\u305f\u30e6\u30cb\u30c3\u30c8\u304b\u3089\n\u300c"+this._furnitureInfo.furnitureMainModel.getName()+"\u300d\n\u3092\u89e3\u9664\u3057\u307e\u3057\u305f\u3002"),this.close()}.bind(this)),this.node.removeFromParent(!0)},_onTapCancelBtnEvent:function(){this.close()}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",GameConst:"GameConst",PictureBookUtils:"PictureBookUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],RoomFurnitureSelectConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"33f36s/TE9DKJTJquMOryaD","RoomFurnitureSelectConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("RoomUtils"),r=t("ResourceUtils");cc.Class({extends:a,properties:{executeBtn:n,cancelBtn:n,updateCharacterImageSprite:cc.Sprite,updateFurnitureImageSprite:cc.Sprite,updateCharacterNameLabel:cc.Label,updateFurnitureNameLabel:cc.Label,swapCharacterNameMainLabel:cc.Label,swapCharacterImageSprite:cc.Sprite,swapFurnitureImageSprite:cc.Sprite,swapCharacterNameLabel:cc.Label,swapFurnitureNameLabel:cc.Label},_swapRoomFurnitureModel:null,_callbackToAfterRequest:null,_initRoomFurnitureSelectConfirmPopup:function(t,e,i,a,n){var r=o.getRoomFurnitureModelByCharacterGroupIdAndMapCategory(i.getCharacterGroupId(),e.furnitureMainModel.getMapCategory()),s=o.findRoomFurnitureModelByFurnitureInfo(e,a.getCharacterGroupId());this._root=t,this._swapRoomFurnitureModel=s,this._callbackToAfterRequest=n,this._initRoomFurnitureSelectConfirmPopupProperties(i,r,a,s)},_initRoomFurnitureSelectConfirmPopupProperties:function(t,e,i,a){this.executeBtn.setTapEvent(this._executeBtnEvent.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this._initUpdateCharacterProperties(t),this._initUpdateFurnitureProperties(e),this._initSwapCharacterProperties(i),this._initSwapFurnitureProperties(a)},_initUpdateCharacterProperties:function(t){if(t){var e=t.getRoomSelectCharacterId();r.addSprite(this.updateCharacterImageSprite,r.getFileNameCharacterThumbnail(e)),this.updateCharacterNameLabel.string=t.getName()}},_initUpdateFurnitureProperties:function(t){if(t){var e=t.getFurnitureId();r.addSprite(this.updateFurnitureImageSprite,r.getFileNameFurnitureThumbnail(e)),this.updateFurnitureNameLabel.string=t.getFurnitureName()}},_initSwapCharacterProperties:function(t){if(t){var e=t.getRoomSelectCharacterId();r.addSprite(this.swapCharacterImageSprite,r.getFileNameCharacterThumbnail(e)),this.swapCharacterNameLabel.string=t.getName(),this.swapCharacterNameMainLabel.string=t.getName()+" \u30eb\u30fc\u30e0\u306b\u8a2d\u7f6e\u4e2d\u306e\n\u5bb6\u5177\u3092\u5165\u308c\u66ff\u3048\u307e\u3059\u304b\uff1f"}},_initSwapFurnitureProperties:function(t){if(t){var e=t.getFurnitureId();r.addSprite(this.swapFurnitureImageSprite,r.getFileNameFurnitureThumbnail(e)),this.swapFurnitureNameLabel.string=t.getFurnitureName()}},_executeBtnEvent:function(){this._root.requestSetFurniture(this._swapRoomFurnitureModel,function(){this.close(),this._callbackToAfterRequest&&this._callbackToAfterRequest()}.bind(this))},openRoomFurnitureSelectConfirmPopup:function(t,e,i,a,n){this._initRoomFurnitureSelectConfirmPopup(t,e,i,a,n),this.open()}}),cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",RoomUtils:"RoomUtils"}],RoomFurnitureSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"03fd8ZL7htDc6oQ0x7qy53Y","RoomFurnitureSelectSubRoot");var a=t("FurnitureUtils"),n=t("CommonButton"),o=t("Singleton"),r=t("TimeUtils"),s=t("RoomConst"),c=t("RoomFurnitureTabView");cc.Class({extends:cc.Component,properties:{roomFurnitureTabView:c,switchDisplayBtn:n},_root:null,onLoad:function(){this.switchDisplayBtn.setTapEvent(this._onTapSwitchDisplayBtn.bind(this),n.SE_NAME.EQUIP)},initRoomFurnitureSelectSubRoot:function(t,e){this.switchDisplayBtn.switchBtnImage(!1);var i=a.createUserFurnitureMap();this._initRoomFurnitureTabView(t,i,s.FURNITURE_SELECT_TYPE.EDIT,e)},redrawRoomFurnitureSelectSubRoot:function(t){var e=a.createUserFurnitureMap();this.roomFurnitureTabView.setFurnitureMap(e),this.roomFurnitureTabView.redraw()},initRoomFurnitureShopSubRoot:function(t,e){this.switchDisplayBtn.switchBtnImage(!0);var i=_.filter(o.dao.FurnitureMainMasters,function(t){return r.isRangeOfDate(t.getFromDate(),t.getToDate())}),n=a.createShopFurnitureMap(i);this._initRoomFurnitureTabView(t,n,s.FURNITURE_SELECT_TYPE.SHOP,e)},redrawRoomFurnitureShopSubRoot:function(t){var e=a.createShopFurnitureMap();this.roomFurnitureTabView.setFurnitureMap(e),this.roomFurnitureTabView.redraw()},_initRoomFurnitureTabView:function(t,e,i,a){this._root=t,this.roomFurnitureTabView.initRoomFurnitureTabView(t,e,i,a)},_onTapSwitchDisplayBtn:function(){this.switchDisplayBtn.getBtnImageSwitchState()?this._root.pushFurnitureSelectSubRoot():this._root.pushFurnitureShopSubRoot()}});cc._RF.pop()},{CommonButton:"CommonButton",FurnitureUtils:"FurnitureUtils",RoomConst:"RoomConst",RoomFurnitureTabView:"RoomFurnitureTabView",Singleton:"Singleton",TimeUtils:"TimeUtils"}],RoomFurnitureTabView:[function(t,e,i){"use strict";cc._RF.push(e,"4cd02w4uStM0YXDEOOqoEO2","RoomFurnitureTabView");var a=t("TabViewBase"),n=(t("RoomConst"),t("FurnitureUtils")),o=t("RoomFurnitureListView");cc.Class({extends:a,properties:{roomFurnitureListView:o},_root:null,_furnitureMap:null,initRoomFurnitureTabView:function(t,e,i,a){this.initTabViewBase(),this._root=t,this.roomFurnitureListView.initRoomFurnitureListView(t,i),this.setFurnitureMap(e);var o=0;if(a){var r=n.getFurnitureMainMasterByFurnitureId(a);o=this._root.convertToIdxCategory(r.getMapCategory()),this._setCurrentTab(o),this._switchTab(this.getCurrentTab());var s=this._furnitureMap[r.getMapCategory()].find(function(t){return t.furnitureId===a});s&&this.roomFurnitureListView.setRoomFurnitureDetailParameter(s)}else this._setCurrentTab(o),this._switchTab(this.getCurrentTab())},setFurnitureMap:function(t){this._furnitureMap=t},redraw:function(){this._switchTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._switchTab(e)},_switchTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0);var e=this._root.convertToMapCategory(t);this.roomFurnitureListView.setPageContent(e,this._furnitureMap[e])},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)}}),cc._RF.pop()},{FurnitureUtils:"FurnitureUtils",RoomConst:"RoomConst",RoomFurnitureListView:"RoomFurnitureListView",TabViewBase:"TabViewBase"}],RoomFurnitureThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"492ffPJmmhOh6Kmd7VV90ch","RoomFurnitureThumbnail");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{thumbnailBtn:a,checkerNode:cc.Node,furnitureImageSprite:cc.Sprite,numeCountLabel:cc.Label,denomCountLabel:cc.Label,countLabelNode:cc.Node,furnitureCostLabel:cc.Label},initRoomFurnitureThumbnail:function(t,e,i,a,o){this.checkerNode.active=!1,n.addSprite(this.furnitureImageSprite,n.getFileNameFurnitureThumbnail(t)),this._initCountLabels(e,i),this._initCostLabel(a),this.thumbnailBtn.setTapEvent(function(){o&&o()})},resetRoomFurnitureThumbnail:function(){this.checkerNode.active=!1,this._initCountLabels(void 0,void 0),this._initCostLabel(void 0),this.switchChecker(!1)},_initCountLabels:function(t,e){e?(this.numeCountLabel.string=t+"",t<=0&&(this.numeCountLabel.node.color=cc.Color.RED),this.denomCountLabel.string=e+"",this.countLabelNode.active=!0):this.countLabelNode.active=!1},_initCostLabel:function(t){t?(this.furnitureCostLabel.node.active=!0,this.furnitureCostLabel.string=t+""):this.furnitureCostLabel.node.active=!1},switchChecker:function(t){this.checkerNode.active=t}}),cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],RoomHowToGetFurniturePopup:[function(t,e,i){"use strict";cc._RF.push(e,"212edwaKsFBcY/ryIeLmkIz","RoomHowToGetFurniturePopup");var a=t("PopupBase"),n=t("Singleton"),o=(t("CommonUtils"),t("ResourceUtils")),r=t("FurnitureUtils"),s=t("CommonButton"),c=t("EventUtils");cc.Class({extends:a,properties:{storyNameLabel:cc.Label,furnitureNameLabel:cc.Label,furnitureImageSprite:cc.Sprite,furnitureDescriptionLabel:cc.Label,cancelBtn:s,thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node},_pictureBookBaseModel:null,_storyRoomMaster:null,_furnitureMainModel:null,_eventCallBack:null,_shopCallback:null,onLoad:function(){this.cancelBtn.setTapEvent(this._onTapCancelBtnEvent.bind(this),s.SE_NAME.CANCEL)},openRoomHowToGetFurniturePopup:function(t,e,i,a,o){this._pictureBookBaseModel=e,this._eventCallBack=i,this._shopCallback=a,this._storyRoomMaster=n.dao.StoryRoomMasters.find(function(e){return e.getStoryId()===t}),this._furnitureMainModel=r.getFurnitureMainMasterByFurnitureId(this._storyRoomMaster.getCondition2()),this._initParam(),this._initThumbnailList(),this.open()},_initParam:function(){this.storyNameLabel.string=this._storyRoomMaster.getName(),this.furnitureNameLabel.string=this._furnitureMainModel.getName(),o.addSprite(this.furnitureImageSprite,o.getFileNameFurnitureSmall(this._furnitureMainModel.getFurnitureId())),this.furnitureDescriptionLabel.string=this._furnitureMainModel.getDescription()},_initThumbnailList:function(){this._addEventThumbnail(),this._addShopThumbnail()},_addEventThumbnail:function(){if(this.isEventRewardFurniture()){var t=c.getEventMainMasterMap()[this._furnitureMainModel.getEventId()],e=cc.instantiate(this.thumbnailPrefab).getComponent("RoomHowToGetFurnitureThumbnail");e.initRoomHowToGetFurnitureThumbnail(function(t){this._eventCallBack(t),this.close()}.bind(this)),e.setRewardEventNameLabel(t.getName()),e.setExecutionParam(t.getEventId()),this.thumbnailParentNode.addChild(e.node)}},_addShopThumbnail:function(){if(this.isPurchaseFurniture()){var t=cc.instantiate(this.thumbnailPrefab).getComponent("RoomHowToGetFurnitureThumbnail");t.initRoomHowToGetFurnitureThumbnail(function(t){this._shopCallback(t,this._furnitureMainModel.getFurnitureId()),this.close()}.bind(this)),t.setPurchaseShopLabel(!0),t.setExecutionParam(this._createPreViewParam()),this.thumbnailParentNode.addChild(t.node)}},isPurchaseFurniture:function(){return 0===this._furnitureMainModel.getEventId()},isEventRewardFurniture:function(){return 0!==this._furnitureMainModel.getEventId()},_onTapCancelBtnEvent:function(){this.close()},_createPreViewParam:function(){return{RoomFurnitureEpisodeSubRoot:{characterGroupId:this._pictureBookBaseModel.getCharacterGroupId()}}}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",EventUtils:"EventUtils",FurnitureUtils:"FurnitureUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],RoomHowToGetFurnitureThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"3b5f07PffZADbrYTXHiaKL2","RoomHowToGetFurnitureThumbnail");var a=t("CommonButton");cc.Class({extends:cc.Component,properties:{rewardEventNameLabel:cc.Label,rewardLabel:cc.Label,purchaseShopLabel:cc.Label,executionBtn:a},_executionParam:null,_executionCallback:null,onLoad:function(){this.executionBtn.setTapEvent(this._onTapExecutionBtnEvent.bind(this))},initRoomHowToGetFurnitureThumbnail:function(t){this._executionCallback=t,this.rewardEventNameLabel.node.active=!1,this.rewardLabel.node.active=!1,this.purchaseShopLabel.node.active=!1},setPurchaseShopLabel:function(t){this.purchaseShopLabel.node.active=t},setRewardEventNameLabel:function(t){this.rewardEventNameLabel.node.active=!0,this.rewardEventNameLabel.string=t},setRewardLabel:function(t){this.rewardLabel.node.active=!0,this.rewardLabel.string=t},setExecutionParam:function(t){this._exectionParam=t},_onTapExecutionBtnEvent:function(){this._executionCallback&&this._executionCallback(this._exectionParam)}}),cc._RF.pop()},{CommonButton:"CommonButton"}],RoomMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"954dcURHGVExpls9CyiCG84","RoomMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getMaxCharacterCount:function(){if(this._isKeyFieldAvailable("maxCharacterCount"))return this._data.maxCharacterCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCharacterCount")},getMaxFloor:function(){if(this._isKeyFieldAvailable("maxFloor"))return this._data.maxFloor;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxFloor")},getSizeX:function(){if(this._isKeyFieldAvailable("sizeX"))return this._data.sizeX;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sizeX")},getSizeY:function(){if(this._isKeyFieldAvailable("sizeY"))return this._data.sizeY;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sizeY")},getMaxWall:function(){if(this._isKeyFieldAvailable("maxWall"))return this._data.maxWall;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxWall")},getMaxFurniture:function(){if(this._isKeyFieldAvailable("maxFurniture"))return this._data.maxFurniture;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxFurniture")},getMaxRug:function(){if(this._isKeyFieldAvailable("maxRug"))return this._data.maxRug;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxRug")},getMaxGoods:function(){if(this._isKeyFieldAvailable("maxGoods"))return this._data.maxGoods;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxGoods")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RoomModel:[function(t,e,i){"use strict";cc._RF.push(e,"196dehRY9VFnaeAuApSYyOl","RoomModel");var a=t("UserRoomModel"),n=t("RoomFurnitureModel");t("Singleton"),t("CharacterUtils"),cc.Class({userRoomModel:void 0,roomFurnitureList:void 0,ctor:function(){var t=arguments[0];this.userRoomModel=new a(t);var e=this.userRoomModel.getFurnitureList();for(var i in this.roomFurnitureList=[],e){var o=new n(e[i]);this.roomFurnitureList.push(o)}},getRoomFurnitureList:function(){return this.roomFurnitureList},getRoomCharacterList:function(){return this.userRoomModel.getCharacterList()}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",RoomFurnitureModel:"RoomFurnitureModel",Singleton:"Singleton",UserRoomModel:"UserRoomModel"}],RoomPictureBookDetailContentsConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"03155OO4qZAmqm9MghUelvA","RoomPictureBookDetailContentsConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("CommonUtils"),t("RoomConst")),r=t("PictureBookUtils"),s=t("StoryUtils"),c=t("CommonScrollView");cc.Class({extends:a,properties:{thumbnailPrefab:cc.Prefab,scrollView:c,okBtn:n},openRoomPictureBookDetailContentsConfirmPopup:function(t){this.scrollView.content.active=!1,this._initRoomPictureBookDetailContentsConfirmPopup(t),this.open(function(){this.scrollView.content.active=!0,this.scrollView.scrollToPercentVertical(1,0,!0)}.bind(this))},_initRoomPictureBookDetailContentsConfirmPopup:function(t){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.scrollView.content.destroyAllChildren();var e=[];for(var i in t.getCharacterFriendshipContentsMasterArray()){var a=t.getCharacterFriendshipContentsMasterArray()[i],n="";switch(a.getContentType()){case o.ROOM_CONTENTS_TYPE.VOICE_SCENARIO:n=r.getCharacterTextMasterMap()[a.getTextId()].getTitle();break;default:n=s.getStoryMasterFlatMap()[a.getStoryId()].getName()}var c=cc.instantiate(this.thumbnailPrefab).getComponent("RoomCharacterContentSimpleThumbnail"),l=a.getConditionValue1()<=t.getFriendship();c.initRoomCharacterContentSimpleThumbnail(n,a.getConditionValue1(),l),l?e.push(c):this.scrollView.content.addChild(c.node)}for(var u in e)this.scrollView.content.addChild(e[u].node)},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",PictureBookUtils:"PictureBookUtils",PopupBase:"PopupBase",RoomConst:"RoomConst",StoryUtils:"StoryUtils"}],RoomReleaseFurnitureEpisodePopup:[function(t,e,i){"use strict";cc._RF.push(e,"7105cOsNkxHzbSMRq0Cyn6p","RoomReleaseFurnitureEpisodePopup");var a=t("PopupBase"),n=t("Singleton"),o=(t("CommonUtils"),t("ResourceUtils")),r=t("FurnitureUtils"),s=t("CommonButton");cc.Class({extends:a,properties:{storyNameLabel:cc.Label,furnitureNameLabel:cc.Label,furnitureImageSprite:cc.Sprite,furnitureDescriptionLabel:cc.Label,executionBtn:s,cancelBtn:s},_storyRoomMaster:null,_furnitureMainModel:null,_executionCallback:null,onLoad:function(){this.executionBtn.setTapEvent(this._onTapExecutionBtnEvent.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtnEvent.bind(this),s.SE_NAME.CANCEL)},openRoomReleaseFurnitureEpisodePopup:function(t,e,i){this._executionCallback=e,this._storyRoomMaster=n.dao.StoryRoomMasters.find(function(e){return e.getStoryId()===t}),this._furnitureMainModel=r.getFurnitureMainMasterByFurnitureId(this._storyRoomMaster.getCondition2()),this._initParam(),this.open()},_initParam:function(){this.storyNameLabel.string=this._storyRoomMaster.getName(),this.furnitureNameLabel.string=this._furnitureMainModel.getName(),o.addSprite(this.furnitureImageSprite,o.getFileNameFurnitureSmall(this._furnitureMainModel.getFurnitureId())),this.furnitureDescriptionLabel.string=this._furnitureMainModel.getDescription()},_onTapCancelBtnEvent:function(){this.close()},_onTapExecutionBtnEvent:function(){this._executionCallback&&(this._executionCallback(this._furnitureMainModel.getFurnitureId()),this.close())}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",FurnitureUtils:"FurnitureUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],RoomRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"f5ce8yaAc9Mx5iJG+xtwTBw","RoomRootBase");var a=t("OutGameRootBase");t("Singleton"),t("GameConst"),cc.Class({extends:a,onLoad:function(){this._setErrorHandling(),this._addBG(),this._addUIHeader(),this._addUISide(),this._addBackBtn(),this._addBand(),this._setTapEffect()},switchActiveUISide:function(t){t&&!this._uiSide.node.active&&this._uiSide.node.getComponent(cc.Animation).play(this._uiSide.node.getComponent(cc.Animation).getClips()[0].name),this._uiSide.node.active=t}});cc._RF.pop()},{GameConst:"GameConst",OutGameRootBase:"OutGameRootBase",Singleton:"Singleton"}],RoomRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"9cf59wH39VBoY2dpUSpWTMh","RoomRootUtils"),e.exports={openRoomTopSubRoot:function(t,e){if(cc.log("openRoomTopSubRoot"),cc.log(e),t.setUIHeaderCurrencyInfo([]),!t.roomTopSubRoot){var i=e.topTabIndex?e.topTabIndex:0;t.roomTopSubRoot=cc.instantiate(t.roomTopSubRootPrefab).getComponent("RoomTopSubRoot"),t.subRootParent.addChild(t.roomTopSubRoot.node),t.roomTopSubRoot.initRoomTopSubRoot(t,i)}},closeRoomTopSubRoot:function(t,e){cc.log("closeRoomTopSubRoot"),cc.log(e),t.roomTopSubRoot&&(t.roomTopSubRoot.node.destroy(),t.roomTopSubRoot=null)}},cc._RF.pop()},{}],RoomRoot:[function(t,e,i){"use strict";cc._RF.push(e,"33e2fYAatBCM6StnrDGhlnk","RoomRoot");var a=t("Singleton"),n=t("CommonUtils"),o=t("PictureBookUtils"),r=t("CharacterGroupFilterConst"),s=(t("GameConst"),t("RoomRootBase")),c=t("RoomViewSetting");cc.Class({extends:s,properties:{roomTopSubRootPrefab:cc.Prefab},_filterCheckList:null,_characterGroupMasterArray:null,_currentCharacterGroupId:0,_pictureBookBaseInfoMap:null,_pictureBookDetailSortFilterPopup:null,onLoad:function(){this._super(),this.setUIHeaderCurrencyInfo([]),this.switchActiveUISide(!1)},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,c.ROOM_SETTING)},initData:function(){if(this._filterCheckList=[!0,!0,!0,!0,!0,!0],this._characterGroupMasterArray=a.dao.CharacterGroupMasters,this.sceneParam){var t=JSON.parse(this.sceneParam),e=t[Object.keys(t)[0]];this._initRoomRootData(e)}this.reload()},initialize:function(){this.initOutGameRootBase();var t={RoomTopSubRoot:{characterGroupId:a.dao.pictureBookBase[0].getCharacterGroupId(),topTabIndex:0}};this._initOpenFirstView(t)},reload:function(){this._pictureBookBaseInfoMap=o.createPictureBookBaseInfoMap(this.getFilteredCharacterGroupMasterArray())},openPictureBookDetailSortFilterPopup:function(t,e,i){this.closePictureBookDetailSortFilterPopup(),this._pictureBookDetailSortFilterPopup||(this._pictureBookDetailSortFilterPopup=cc.instantiate(this.pictureBookDetailSortFilterPopupPrefab).getComponent("SortFilterPopup"),this._pictureBookDetailSortFilterPopup.openSortFilterPopup(t,e,i))},closePictureBookDetailSortFilterPopup:function(){this._pictureBookDetailSortFilterPopup&&(this._pictureBookDetailSortFilterPopup.close(),this._pictureBookDetailSortFilterPopup=null)},transitionRoomCharacterScene:function(t){var e={RoomCharacterSubRoot:{characterGroupId:t,characterId:this.getPictureBookBaseInfoMap()[t].pictureBookBaseModel.getRoomSelectPictureBookDetailModel().getCharacterId()}},i={RoomTopSubRoot:{characterGroupId:t}};this.pushScene("RoomCharacterScene","RoomScene",e,i)},_initRoomRootData:function(t){t.characterGroupId&&this.setCurrentCharacterGroupId(t.characterGroupId)},setCurrentCharacterGroupId:function(t){this._currentCharacterGroupId=t},getCurrentCharacterGroupId:function(){return this._currentCharacterGroupId},getCurrentPictureBookBaseInfo:function(){return this.getPictureBookBaseInfoMap()[this.getCurrentCharacterGroupId()]},getPictureBookBaseInfoMap:function(){return this._pictureBookBaseInfoMap},setFilterArray:function(t){this._filterCheckList=t,this.reload()},getFilterArray:function(){return this._filterCheckList},getFilteredCharacterGroupMasterArray:function(){var t=this._createFilterConditions(this.getFilterArray());return n.filterModels(a.dao.CharacterGroupMasters,t)},_createFilterConditions:function(t){for(var e=r.PROPERTY_NAME,i=[],a=0;a<t.length;a+=1)t[a]||i.push({propertyName:e,getterName:r.FILTER_FUNC_NAME[Object.keys(r.FILTER_TYPE)[a]]});return i}});cc._RF.pop()},{CharacterGroupFilterConst:"CharacterGroupFilterConst",CommonUtils:"CommonUtils",GameConst:"GameConst",PictureBookUtils:"PictureBookUtils",RoomRootBase:"RoomRootBase",RoomViewSetting:"RoomViewSetting",Singleton:"Singleton"}],RoomService:[function(t,e,i){"use strict";cc._RF.push(e,"73961VkFMZGtaDKRUavs16W","RoomService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,setFurniture:function(t,e,i,a){var o={furnitureCds:t,mapCategories:e,characterGroupIds:i};this._requestCallApi(n.ROOM_SET_FURNITURE,o,function(t,e){return a(t?void 0:e)})},setCharacter:function(t,e,i){var a={characterId:t,position:e};this._requestCallApi(n.ROOM_SET_CHARACTER,a,function(t,e){return i(t?void 0:e)})},buyCharacterFrame:function(t){this._requestCallApi(n.ROOM_BUY_CHARACTER_FRAME,{},function(e,i){return t(e?void 0:i)})},buyFurniture:function(t,e,i){var a={furnitureId:t,itemId:e};this._requestCallApi(n.ROOM_BUY_FURNITURE,a,function(t,e){return i(t?void 0:e)})},saveLayout:function(t,e,i){var a={layoutId:t,name:e};this._requestCallApi(n.ROOM_SAVE_LAYOUT,a,function(t,e){return i(t?void 0:e)})},loadLayout:function(t,e){var i={layoutId:t};this._requestCallApi(n.ROOM_LOAD_LAYOUT,i,function(t,i){return e(t?void 0:i)})},clearLayout:function(t,e){var i={layoutId:t};this._requestCallApi(n.ROOM_CLEAR_LAYOUT,i,function(t,i){return e(t?void 0:i)})},updateLayoutName:function(t,e,i){var a={layoutId:t,name:e};this._requestCallApi(n.ROOM_UPDATE_LAYOUT_NAME,a,function(t,e){return i(t?void 0:e)})},collect:function(t,e){var i={furnitureCd:t};this._requestCallApi(n.ROOM_COLLECT,i,function(t,i){return e(t?void 0:i)})},saveSelectCharacter:function(t,e,i){var a={characterGroupId:t,characterId:e};this._requestCallApi(n.ROOM_SAVE_SELECT_CHARACTER,a,function(t,e){return i(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],RoomSlideSubRootBase:[function(t,e,i){"use strict";cc._RF.push(e,"eaeedFFTJVFS6ePkwyMS+f3","RoomSlideSubRootBase");var a=t("WindowBase"),n=t("ViewUtils"),o=(t("CommonUtils"),t("PictureBookUtils")),r=t("CharacterConst"),s=0,c=1;cc.Class({extends:a,properties:{serifParentNode:cc.Node},_serifBalloon:null,_userPictureBookBaseModel:null,_openTargetNodeAction:function(t,e){var i=t.position;switch(t.stopAllActions(),e){case s:t.position=cc.v2(i.x,2*i.y);break;case c:default:t.position=cc.v2(2*i.x,i.y)}t.runAction(cc.moveTo(.3,cc.v2(i.x,i.y)).easing(cc.easeSineOut()))},_initSerifBalloon:function(t){this._serifBalloon=n.createSerifWindow(),this.serifParentNode.addChild(this._serifBalloon.node),this._userPictureBookBaseModel||(this._userPictureBookBaseModel=t.getCurrentPictureBookBaseModel()),this._setSerifContent(this._userPictureBookBaseModel.getRoomSelectPictureBookDetailModel()),this._openTargetNodeAction(this.serifParentNode,s)},_setSerifContent:function(t){var e=t.getCharacterMainMaster(),i=e.getCostumeId(),a=[],n=[],s=[];o.getCharacterTextMasterArray(i,r.TEXT_SCENE_TYPE.ROOM,1).forEach(function(t){a.push(t.getText()),n.push(t.getVoiceFile()),s.push(t.getSkinName())}),this._serifBalloon.setSerifContent(e.getCharacterId(),e.getShortName(),a,n,s),this._serifBalloon.playRandomSerifAnimation()}});cc._RF.pop()},{CharacterConst:"CharacterConst",CommonUtils:"CommonUtils",PictureBookUtils:"PictureBookUtils",ViewUtils:"ViewUtils",WindowBase:"WindowBase"}],RoomTopCharacterGroupListView:[function(t,e,i){"use strict";cc._RF.push(e,"af21fxlKtJKiJX788sCcuhy","RoomTopCharacterGroupListView");var a=t("ListViewBase"),n=(t("CharacterUtils"),t("ResourceUtils"),t("Singleton"),t("PictureBookUtils"),t("CommonButton")),o=t("CommonScrollView"),r=(t("RoomConst"),t("CommonUtils"),t("ViewUtils"));cc.Class({extends:a,properties:{characterStandViewParentNode:cc.Node,toTopBtn:n,toBottomBtn:n,commonScrollView:o},_root:null,_characterStandView:null,_divisionPercent:0,_percentArrayByContentIdx:null,initRoomCharacterGroupListView:function(t){this._root=t,this._initBtn(),this._initCharacterStandView(),this._setRoomTopCharacterSprite(),this.initListView(t),this._percentArrayByContentIdx=[],this._divisionPercent=1/(this.thumbnailParentNode.childrenCount-5);for(var e=1,i=0;i<this.thumbnailParentNode.childrenCount-5;i+=1)this._percentArrayByContentIdx.push(e),e-=this._divisionPercent;this._contentScrollEvent()},_initCharacterStandView:function(){this._characterStandView=r.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node)},_setListContent:function(t){var e=0,i=t.getPictureBookBaseInfoMap();Object.keys(i).map(function(t){return parseInt(t)}).forEach(function(t){var a=i[t],n=a.characterGroupMaster;this._addThumbnail(t,n,a.pictureBookBaseModel),0!==e&&n.getCharacterGroupId()!==this._root.getCurrentCharacterGroupId()||(e=t)}.bind(this)),this._setCurrentPictureBookBaseInfo(i[e]),this.redraw()},_addThumbnail:function(t,e,i){var a=cc.instantiate(this.thumbnailPrefab).getComponent("RoomCharacterCardThumbnail");a.node.width=1*a.node.width,a.node.height=1*a.node.height,a.initRoomCharacterCardThumbnail(t,this._callbackToThumbnail.bind(this)),a.setCharacterName(e.getName()),i&&(a.setCharacterCardImageByCharacterGroupId(i.getCharacterGroupId()),a.setNewLabel(i.isNewReleasedAllStory())),this.thumbnailParentNode.addChild(a.node)},_callbackToThumbnail:function(t){this._root.setCurrentCharacterGroupId(t.getThumbnailId()),this.redraw(),this._root.transitionRoomCharacterScene(t.getThumbnailId())},redraw:function(){this.redrawListContent()},redrawListContent:function(){var t=this._root.getCurrentCharacterGroupId();this.thumbnailParentNode.children.forEach(function(e){var i=e.getComponent("RoomCharacterCardThumbnail");i&&i.setSelectedNodeActive(t===i.getThumbnailId())})},_getCurrentContentIndex:function(){for(var t=0;t<this.thumbnailParentNode.childrenCount;t+=1)if(this._root.getCurrentCharacterGroupId()===this.thumbnailParentNode.children[t].getComponent("RoomCharacterCardThumbnail").getThumbnailId())return t;return-1},_setCurrentPictureBookBaseInfo:function(t){if(t){var e=t.characterGroupMaster;this._root.setCurrentCharacterGroupId(e.getCharacterGroupId())}else this._root.setCurrentCharacterGroupId(0)},_initBtn:function(){this.toTopBtn.setTapEvent(this._onTapToTopBtnEvent.bind(this),n.SE_NAME.COUNT),this.toBottomBtn.setTapEvent(this._onTapToBottomBtnEvent.bind(this),n.SE_NAME.COUNT)},_onTapToTopBtnEvent:function(){for(var t=0;t<this.thumbnailParentNode.childrenCount;t+=1)if(this._root.getCurrentCharacterGroupId()===this.thumbnailParentNode.children[t].getComponent("RoomCharacterCardThumbnail").getThumbnailId()){if(0!==t){this._root.setCurrentCharacterGroupId(this.thumbnailParentNode.children[t-1].getComponent("RoomCharacterCardThumbnail").getThumbnailId());break}break}this.redraw(),this._contentScrollEvent()},_onTapToBottomBtnEvent:function(){for(var t=0;t<this.thumbnailParentNode.childrenCount;t+=1)if(this._root.getCurrentCharacterGroupId()===this.thumbnailParentNode.children[t].getComponent("RoomCharacterCardThumbnail").getThumbnailId()){if(t!==this.thumbnailParentNode.childrenCount-1){this._root.setCurrentCharacterGroupId(this.thumbnailParentNode.children[t+1].getComponent("RoomCharacterCardThumbnail").getThumbnailId());break}break}this.redraw(),this._contentScrollEvent()},_contentScrollEvent:function(){var t=0,e=0,i=0;t=2,e=1,this._getCurrentContentIndex()<t+e?this.commonScrollView.scrollToPercentVertical(this._percentArrayByContentIdx[0],.45):this._percentArrayByContentIdx.length>this._getCurrentContentIndex()-t+1?this.commonScrollView.scrollToPercentVertical(this._percentArrayByContentIdx[this._getCurrentContentIndex()-t+i],.45):this.commonScrollView.scrollToPercentVertical(0,.45)},_setRoomTopCharacterSprite:function(){this._characterStandView.setCharacterStandImage(this._root.getNavigatorCharacterId())}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",ListViewBase:"ListViewBase",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",Singleton:"Singleton",ViewUtils:"ViewUtils"}],RoomTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"c9aafrmRWVOfZDbMwBrT9br","RoomTopSubRoot");t("CommonButton");var a=t("RoomTopCharacterGroupListView");cc.Class({extends:cc.Component,properties:{roomTopCharacterGroupListView:a},initRoomTopSubRoot:function(t,e){this._initRoomTopCharacterGroupListView(t)},_initRoomTopCharacterGroupListView:function(t){this.roomTopCharacterGroupListView.initRoomCharacterGroupListView(t)}}),cc._RF.pop()},{CommonButton:"CommonButton",RoomTopCharacterGroupListView:"RoomTopCharacterGroupListView"}],RoomUtils:[function(t,e,i){"use strict";cc._RF.push(e,"c19abBPxcZM24wwDR9JZqc5","RoomUtils");var a=t("Singleton"),n=(t("CommonUtils"),t("TimeUtils"));t("RoomConst");e.exports={findRoomFurnitureModelByFurnitureInfo:function(t,e){return t.roomFurnitureModelArray.find(function(t){return t.getCharacterGroupId()===e})},getRoomFurnitureModelArrayByCharacterGroupId:function(t){return a.dao&&a.dao.userRoom?a.dao.userRoom.getRoomFurnitureList().filter(function(e){return e.getCharacterGroupId()===t}):[]},getRoomFurnitureModelByCharacterGroupIdAndMapCategory:function(t,e){return a.dao.userRoom.getRoomFurnitureList().find(function(i){return i.getCharacterGroupId()===t&&i.getMapCategory()===e})},getSettableFurnitureModelArray:function(t,e){return t.slice().filter(function(t){return!e[t.getFurnitureCd()]})},createRoomFurnitureModelMap:function(){var t=a.dao.userRoom.getRoomFurnitureList(),e={};for(var i in t){var n=t[i];e[n.getFurnitureCd()]=n}return e},getNewReleaseRoomStoryId:function(t,e){for(var i in t){var a=t[i],n=a.storyMaster;if(n.getCondition2()===e&&!a.userStoryModel)return n.getStoryId()}return 0},getCollectableRewardRoomFurnitureModelArray:function(t){return this.getRewardRoomFurnitureModelArray().filter(function(e){return n.getDiffMS(e.getNextCollectDate(),t)<=0})},getDefaultUserFurniture:function(t){return _.find(a.dao.userFurniture,function(e){return 0===e.getFurnitureCategory()&&e.getMapCategory()===t})}},cc._RF.pop()},{CommonUtils:"CommonUtils",RoomConst:"RoomConst",Singleton:"Singleton",TimeUtils:"TimeUtils"}],RoomViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"62182TC8r5DeYQR2Sw9JtM6","RoomViewSetting");var a=t("RoomRootUtils");e.exports={ROOM_SETTING:{RoomTopSubRoot:{open:a.openRoomTopSubRoot,close:a.closeRoomTopSubRoot}}},cc._RF.pop()},{RoomRootUtils:"RoomRootUtils"}],RoomWholeCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"f4851+G4ytNp7WwrW1kQo0v","RoomWholeCharacterView");var a=t("ResourceUtils"),n=t("CharacterUtils"),o=t("CommonUtils"),r=t("CharacterConst"),s=t("Singleton"),c=t("SingletonConst"),l=t("ErrorCode");cc.Class({extends:cc.Component,properties:{characterSpine:sp.Skeleton},_recentCharacterId:0,initRoomWholeCharacterView:function(t){try{var e=t.getRoomSelectCharacterId();if(e===this._recentCharacterId)return;this._recentCharacterId=e;var i=n.getCharacterMainModelByCharacterId(e).getSpineDirectoryPath();this.characterSpine.skeletonData=a.getResource(a.getFileNameCharacterRoomSpine(i)),this.playRandomSpineAction()}catch(t){this._openThrowError(t)}},_openThrowError:function(t){cc.error(t),s[c.ERROR_MANAGER]&&s[c.ERROR_MANAGER].throwError(l.OUTGAME_SPINE_ERROR)},setRoomWholeCharacterViewByCharacterId:function(t,e){try{var i=n.getCharacterMainModelByCharacterId(t).getSpineDirectoryPath();this.characterSpine.skeletonData=a.getResource(a.getFileNameCharacterRoomSpine(i)),e?this.playSpineAction(e,r.ROOM_SPINE_ANIM_TYPE.IDLE):this.playRandomSpineAction()}catch(t){this._openThrowError(t)}},playSpineAction:function(t,e){try{var i=Object.keys(r.ROOM_SPINE_SKIN_TYPE).find(function(e){return r.ROOM_SPINE_SKIN_TYPE[e]===t});if(i?this._setSkin(r.ROOM_SPINE_SKIN_TYPE[i]):this._setRandomSkin(),e){if(this.characterSpine.animation===e)return void this.characterSpine.setSlotsToSetupPose();this._setAnimation(e)}else this._setRandomAnimation();this.characterSpine.setSlotsToSetupPose()}catch(t){this._openThrowError(t)}},playRandomSpineAction:function(){try{this._setRandomSkin(),this._setRandomAnimation(),this.characterSpine.setSlotsToSetupPose()}catch(t){this._openThrowError(t)}},_setRandomSkin:function(){var t=o.getRandom(1,Object.keys(this.characterSpine.skeletonData.skeletonJson.skins).length-1),e=Object.keys(this.characterSpine.skeletonData.skeletonJson.skins)[t];e&&this._setSkin(e)},_setSkin:function(t){this.characterSpine.skeletonData.skeletonJson.skins[t]?(this.characterSpine.defaultAnimation=t,this.characterSpine.setSkin(t)):cc.error("skin "+t+"\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002")},_setRandomAnimation:function(){var t=o.getRandom(0,Object.keys(this.characterSpine.skeletonData.skeletonJson.animations).length-1),e=Object.keys(this.characterSpine.skeletonData.skeletonJson.animations)[t];this.characterSpine.animation!==e&&this._setAnimation(e)},_setAnimation:function(t){if(this.characterSpine.node.opacity=0,this.characterSpine.node.color=cc.color(0,0,0),this.characterSpine.node.runAction(cc.spawn(cc.fadeIn(.2),cc.tintTo(.2,255,255,255))),!this.characterSpine.setAnimation(0,t,1))throw new Error(this._recentCharacterId+" character spine `"+t+"` animation not found")},moveInitCharacterSpine:function(){this.node.position!==cc.v2(0,0)&&(this.node.stopAllActions(),this.node.runAction(cc.moveTo(.3,cc.v2(0,0)).easing(cc.easeSineOut())))},moveSideCharacterSpine:function(){this.node.stopAllActions(),this.node.runAction(cc.moveTo(.3,cc.v2(-180,0)).easing(cc.easeSineOut()))}}),cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",ErrorCode:"ErrorCode",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],RoomWholeFurnitureView:[function(t,e,i){"use strict";cc._RF.push(e,"63407/CEJxG9IgMt5Ro2edA","RoomWholeFurnitureView");t("CommonUtils");var a=t("RoomUtils"),n=t("ResourceUtils"),o=t("RoomConst"),r="_1",s="_2";cc.Class({extends:cc.Component,properties:{roomCharacterFurnitureObjectViewPrefab:cc.Prefab,content:cc.Node},_furnitureViewArray:null,initRoomWholeFurnitureView:function(t){var e=a.getRoomFurnitureModelArrayByCharacterGroupId(t.getCharacterGroupId());this.initRoomWholeFurnitureViewFromFurnitures(e)},initRoomWholeFurnitureViewFromFurnitures:function(t){for(var e in this._furnitureViewArray=[],this.content.destroyAllChildren(),t)this._addFurniture(t[e])},_addFurniture:function(t){switch(t.getMapCategory()){case o.MAP_CATEGORY.INTERIOR:this._addFurnitureForInterior(t);break;default:this._addFurnitureForNormal(t)}},_createRoomFurnitureObjectView:function(){var t=cc.instantiate(this.roomCharacterFurnitureObjectViewPrefab).getComponent("RoomCharacterFurnitureObjectView");return this.content.addChild(t.node),this._furnitureViewArray.push(t),t},_addFurnitureForNormal:function(t){this._createRoomFurnitureObjectView().initRoomCharacterFurnitureObjectView(n.getFileNameFurnitureImage(t.getFurnitureId()),o.POS_CATEGORY[o.MAP_CATEGORY[t.getMapCategory()]],o.Z_ORDER_CATEGORY[o.MAP_CATEGORY[t.getMapCategory()]])},_addFurnitureForInterior:function(t){this._createRoomFurnitureObjectView().initRoomCharacterFurnitureObjectView(n.getFileNameFurnitureImage(t.getFurnitureId()),o.POS_CATEGORY[o.MAP_CATEGORY[t.getMapCategory()]],o.Z_ORDER_CATEGORY[o.MAP_CATEGORY[t.getMapCategory()]]),this._createRoomFurnitureObjectView().initRoomCharacterFurnitureObjectView(n.getFileNameFurnitureImage(t.getFurnitureId())+r,o.POS_CATEGORY[o.MAP_CATEGORY[t.getMapCategory()]],o.Z_ORDER_CATEGORY.INTERIOR_CURTAIN),this._createRoomFurnitureObjectView().initRoomCharacterFurnitureObjectView(n.getFileNameFurnitureImage(t.getFurnitureId())+s,o.POS_CATEGORY[o.MAP_CATEGORY[t.getMapCategory()]],o.Z_ORDER_CATEGORY.INTERIOR_CEILING)}});cc._RF.pop()},{CommonUtils:"CommonUtils",ResourceUtils:"ResourceUtils",RoomConst:"RoomConst",RoomUtils:"RoomUtils"}],SDCharacterViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"031deohOqND16U9KFDgs8HU","SDCharacterViewBase");var a=t("CommonButton"),n=(t("CommonUtils"),t("CharacterUtils")),o=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{characterSpine:sp.Skeleton,touchBtn:a},initSDCharacterView:function(){var t=n.getCharacterMainModelByCharacterId(this._getCharacterId()).getSpineDirectoryPath();this.characterSpine.skeletonData=o.getResource(o.getFileNameCharacterSDSpine(t)),this.characterSpine.premultipliedAlpha=!0,this.characterSpine.defaultSkin=this._getDefaultSkinName(),this.characterSpine.defaultAnimation=this._getDefaultAnimationName()},setSDTapEvent:function(t){this.touchBtn.setTapEvent(function(){return t(this._getCharacterId())}.bind(this))},setSpineAnimation:function(t,e,i){this.characterSpine.setSkin(t),this.characterSpine.setAnimation(0,e,i),this.characterSpine.setSlotsToSetupPose()},_getCharacterId:function(){return cc.warn("SDCharacterViewBase._getCharacterId() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),0},_getDefaultSkinName:function(){return cc.warn("SDCharacterViewBase._getDefaultSkinName() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),"default"},_getDefaultAnimationName:function(){return cc.warn("SDCharacterViewBase._getDefaultAnimationName() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"),"idle"}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",ResourceUtils:"ResourceUtils"}],SceneConst:[function(t,e,i){"use strict";cc._RF.push(e,"86a6f3vP6NOqpJw6j6Vkij6","SceneConst"),cc.Class({statics:{SCENE:{NAME:{battle:"\u30d0\u30c8\u30eb",battleLoading:"",BootScene:"",DebugScene:"",DeckScene:"\u7de8\u6210",DummyLoginScene:"",EventQuestScene:"\u30a4\u30d9\u30f3\u30c8",EventRegularQuestScene:"\u30a4\u30d9\u30f3\u30c8",ExchangeScene:"\u4ea4\u63db\u6240",GachaAnimationScene:"",GachaScene:"\u30ac\u30c1\u30e3",HomeScene:"\u30db\u30fc\u30e0",MissionScene:"\u4efb\u52d9",PictureBookScene:"\u5bdd\u5ba4",PresentBoxScene:"\u30ae\u30d5\u30c8\u30dc\u30c3\u30af\u30b9",PromoteCharacterDetailScene:"\u30e6\u30cb\u30c3\u30c8",PromoteCharacterSelectScene:"\u30e6\u30cb\u30c3\u30c8",PvPScene:"\u30a2\u30ea\u30fc\u30ca",QuestScene:"\u51fa\u6483",RoomScene:"\u30eb\u30fc\u30e0",RoomCharacterScene:"\u30eb\u30fc\u30e0",SetTestBattleScene:"",ShopScene:"\u30b7\u30e7\u30c3\u30d7",StoryScene:"\u56de\u60f3",TestScene:"",TowerScene:"\u30bf\u30ef\u30fc",WarehouseScene:"\u5009\u5eab",NormalQuestScene:"\u901a\u5e38\u30af\u30a8\u30b9\u30c8",RaidScene:"\u30ec\u30a4\u30c9",RaidGachaScene:"\u30ec\u30a4\u30c9",RaidGachaResultScene:"\u30ec\u30a4\u30c9",WeekScene:"\u66dc\u65e5\u30af\u30a8\u30b9\u30c8",EquipmentScene:"\u88c5\u5099",LoginBonusScene:"\u30ed\u30b0\u30a4\u30f3\u30dc\u30fc\u30ca\u30b9",ProfileScene:"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb",QuestionnaireScene:"\u30a2\u30f3\u30b1\u30fc\u30c8"},FILE_NAME:cc.Enum({TITLE:"TitleScene",FIRST_LOGIN:"FirstLoginScene",FIRST_LOGIN_AFTER:"FirstLoginAfterScene",MAINTENANCE:"MaintenanceScene",RESOURCE_DOWNLOAD:"ResourceDownloadScene",RESTORE_BATTLE:"RestoreBattleScene",ARENA:"ArenaScene",PVP_START_ANIM:"PvPStartAnimScene",BATTLE:"battle",BATTLE_LOADING:"battleLoading",BOOT:"BootScene",DEBUG:"DebugScene",DECK:"DeckScene",DUMMY_LOGIN:"DummyLoginScene",EVENT:"EventQuestScene",EVENT_REGULAR:"EventRegularQuestScene",EXCHANGE:"ExchangeScene",GACHA_LOAD:"GachaLoadingScene",GACHA_ANIMATION:"GachaAnimationScene",GACHA:"GachaScene",HOME:"HomeScene",MISSION:"MissionScene",PICTURE_BOOK:"PictureBookScene",PRESENT_BOX:"PresentBoxScene",PROMOTE_CHARACTER_DETAIL:"PromoteCharacterDetailScene",PROMOTE_CHARACTER_SELECT:"PromoteCharacterSelectScene",PVP:"PvPScene",QUEST:"QuestScene",ROOM:"RoomScene",ROOM_CHARACTER:"RoomCharacterScene",SET_TEST_BATTLE:"SetTestBattleScene",SHOP:"ShopScene",STORY:"StoryScene",TEST:"TestScene",TOWER:"TowerScene",WARE_HOUSE:"WarehouseScene",NORMAL_QUEST:"NormalQuestScene",RAID:"RaidScene",RAID_BATTLE:"RaidBattleScene",RAID_GACHA:"RaidGachaScene",RAID_GACHA_RESULT:"RaidGachaResultScene",WEEK:"WeekScene",EQUIPMENT:"EquipmentScene",LOGIN_BONUS:"LoginBonusScene",PROFILE:"ProfileScene",ADV:"AdvScene",MINI_GAME:"MinigameScene",QUESTIONNAIRE:"QuestionnaireScene"})},LOADING_TYPE:{TestScene:"PROGRESS",ResourceDownloadScene:"PROGRESS",RoomCharacterScene:"PROGRESS",battleLoading:"PROGRESS",HomeScene:"PROGRESS",AdvScene:"PROGRESS",GachaLoadingScene:"PROGRESS"},INGAME_MAINTENANCE_SCENE:{battle:"\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u3067\u3059\u3002\n\u30b2\u30fc\u30e0\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n\u203bWave\u6bce\u306b\u30d0\u30c8\u30eb\u5185\u5bb9\u304c\n\u30b5\u30fc\u30d0\u30fc\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\u3002",ArenaScene:"\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u3067\u3059\u3002\n\u30b2\u30fc\u30e0\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002",RaidBattleScene:"\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u3067\u3059\u3002\n\u30b2\u30fc\u30e0\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n\u203bWave\u6bce\u306b\u30d0\u30c8\u30eb\u5185\u5bb9\u304c\n\u30b5\u30fc\u30d0\u30fc\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\u3002"},SCENE_STATE:{INIT_DATA:0,LOOP_DATA:1,INIT_RESOURCE:2,LOOP_RESOURCE:3,INIT_SCENE:4,LOOP_SCENE:5},NEED_BACK_SCENE_ON_ERROR:{GachaLoadingScene:!0}}}),cc._RF.pop()},{}],SerialCodePopup:[function(t,e,i){"use strict";cc._RF.push(e,"5fe4fiH1ltJ1bfKjVmMJc5z","SerialCodePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("PopupUtils");cc.Class({extends:a,properties:{sendBtn:n,cancelBtn:n,closeBtn:n,editBox:cc.EditBox},onLoad:function(){this._initButtonEvents()},_initButtonEvents:function(){this.sendBtn.setTapEvent(this._sendBtnEvent.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.closeBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL)},setCallbackToSendBtn:function(t){this._callbackToSendBtn=t},_sendBtnEvent:function(t){cc.log("\u30b3\u30fc\u30c9\u9001\u4fe1 = ",this.editBox.string),o.openCommonPopupOk("","\n\u30b7\u30ea\u30a2\u30eb\u30b3\u30fc\u30c9\u9001\u4fe1\n\n\u9001\u4fe1\u5185\u5bb9\n[ "+this.editBox.string+" ]\n\n\u203b\u30b7\u30ea\u30a2\u30eb\u30b3\u30fc\u30c9\u6bce\u306e\u51e6\u7406\u306f\u73fe\u5728\u672a\u5b9f\u88c5\u3067\u3059\u3002","",!1,function(){}),this._callbackToSendBtn&&this._callbackToSendBtn(this.editBox.string)}}),cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",PopupUtils:"PopupUtils"}],SerifBalloon:[function(t,e,i){"use strict";cc._RF.push(e,"2927elWeElKG6kaocjQTIz3","SerifBalloon");var a=t("CommonButton"),n=t("CommonFunction"),o=t("Singleton"),r=t("ResourceUtils");t("ResourceConst"),t("AsyncFileLoader"),t("FileLoaderManager"),cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,serifLabel:cc.Label,shrinkSerifLabel:cc.Label,voiceButton:a},_characterId:0,_characterName:null,_serifList:null,_voiceFileNameList:null,_characterSkinNameList:null,_currentIndex:0,_dispLength:0,_dispInterval:0,_lineHeightRate:0,ctor:function(){this._characterId=0,this._characterName="",this._serifList=[],this._voiceFileNameList=[],this._currentIndex=0,this._dispInterval=0,this._dispLength=0},onLoad:function(){this.voiceButton.setTapEvent(this.playVoice.bind(this),""),this._lineHeightRate=this.serifLabel.lineHeight/this.serifLabel.fontSize},setSerifContent:function(t,e,i,a,n){this._characterId=t,this._setName(e),this._setSerifList(i),this._setVoiceFileNameList(a),this._setCharacterSkinNameList(n)},playSerifAnimation:function(t){if(this.serifLabel.fontSize=this.shrinkSerifLabel.fontSize,this.serifLabel.lineHeight=this.shrinkSerifLabel.lineHeight,this._dispInterval=0,this._dispLength=0,this.serifLabel.string="",this._serifList&&!(this._serifList.length<=0)){this.animationText=this._serifList[t].replace(/\\n/g,"\n"),this.shrinkSerifLabel.string=this.animationText;cc.director.getScheduler().unscheduleAllForTarget(this),this.scheduleOnce(this._initSerifFontSize.bind(this),.25)}},_initSerifFontSize:function(){this.serifLabel.fontSize=this.shrinkSerifLabel.actualFontSize,this.serifLabel.lineHeight=this.shrinkSerifLabel.actualFontSize*this._lineHeightRate,this.shrinkSerifLabel.string=""},playRandomSerifAnimation:function(t){this._currentIndex=n.getRandomInt(0,this._serifList.length),this.playSerifAnimation(this._currentIndex),t||this.playVoice()},update:function(t){this._dispInterval+=t,this.animationText&&(this.animationText.length<=this._dispLength||this._dispInterval>=.04&&0===this.shrinkSerifLabel.string.length&&(this._dispInterval=0,this.serifLabel.string+=this.animationText[this._dispLength],this._dispLength++))},playVoice:function(){var t=this._voiceFileNameList[this._currentIndex];o.fileLoaderManager.loadFile(r.getFileNameCharacterSound(this._characterId,t),cc.AudioClip,function(t,e){t?cc.error(t):o.soundManager.playVoice(e,!0,1)})},_setName:function(t){this._characterName=t,this.nameLabel.string=t},_setSerifList:function(t){this._serifList=t},_setVoiceFileNameList:function(t){this._voiceFileNameList=t},_setCharacterSkinNameList:function(t){this._characterSkinNameList=t},getCurrentCharacterSkinName:function(){return this._characterSkinNameList[this._currentIndex]}});cc._RF.pop()},{AsyncFileLoader:"AsyncFileLoader",CommonButton:"CommonButton",CommonFunction:"CommonFunction",FileLoaderManager:"FileLoaderManager",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],ServiceManager:[function(t,e,i){"use strict";cc._RF.push(e,"e43f9aF5S9JJJVyNtkXnvNx","ServiceManager");var a=t("RESTClient"),n=t("MasterDataConstants"),o=t("MasterDataApi"),r=t("MasterDataLoadKeys"),s=t("UserDataConstants"),c=t("UserDataLoadSettings"),l=t("UserDataApi"),u=(t("CampaignModel"),t("CharacterMainModel"),t("CharacterAbilityEffectModel"),t("CharacterAbilityMainModel"),t("CharacterLevelModel"),t("CharacterMaterialModel"),t("CharacterExceedLimitModel"),t("CharacterSkillEffectModel"),t("CharacterSkillMainModel"),t("CharacterGroupModel"),t("CharacterSkillUpRateModel"),t("CharacterNormalAttackModel"),t("CharacterContentsModel"),t("CharacterFavoriteModel"),t("EquipmentMainModel"),t("EquipmentEffectModel"),t("EquipmentMaterialModel"),t("MissionMainModel"),t("MissionDetailModel"),t("MissionRewardModel"),t("UserMainModel"),t("QuestWorldModel"),t("QuestAreaModel"),t("QuestStageModel"),t("QuestAchieveModel"),t("QuestDropModel"),t("QuestEventPointModel"),t("ShopMainModel"),t("ShopDetailModel"),t("PresentMessageModel"),t("ItemMainModel"),t("ItemSetModel"),t("ItemRecipeModel"),t("ItemCategoryModel"),t("ItemSelectModel"),t("UserCharacterModel"),t("CharacterModel"),t("ItemModel"),t("UserItemModel"),t("UserEquipmentModel"),t("EquipmentModel"),t("DeckModel"),t("QuestModel"),t("UserPurchaseHistoryModel"),t("UserMissionModel"),t("UserBasicInfoModel"),t("UserModel"),t("MissionModel"),t("RoomMainModel"),t("UserRoomModel"),t("UserRoomLayoutModel"),t("UserFurnitureModel"),t("FurnitureMainModel"),t("FurnitureCostModel"),t("FurnitureCollectModel"),t("FurnitureCategoryModel"),t("FurnitureTypeModel"),t("ExchangeMainModel"),t("ExchangePointDetailModel"),t("ExchangeItemDetailModel"),t("FurnitureModel"),t("RoomModel"),t("MyPageBannerModel"),t("MyPageEventModel"),t("MyPageMainModel"),t("PvPMainModel"),t("PvPClassModel"),t("UserPvPModel"),t("PvPModel"),t("TowerMainModel"),t("TowerSessionModel"),t("UserPictureBookBaseModel"),t("UserPictureBookDetailModel"),t("PictureBookDetailModel"),t("RoomCharacterFrameModel"),t("StoryCategoryModel"),t("StoryGroupModel"),t("StoryQuestModel"),t("StoryEventModel"),t("StoryOtherModel"),t("StoryRoomModel"),t("StoryPictureBookModel"),t("UserStoryModel"),t("StoryModel"),t("UserExchangeHistoryModel"),t("GachaMainModel"),t("PictureBookBaseModel"),t("BattleSessionModel"),t("UserGachaModel"),t("DmmModel"),t("EventMainModel"),t("Singleton")),h=t("SingletonConst"),d=t("AuthService");cc.Class({_restClient:void 0,_models:void 0,ctor:function(){var t=u[h.ENVIRONMENT];this._restClient=new a.RESTClient(t.getApiHost()),this._initializeServices(),this._initializeDao(),this._initializeEvent()},dtor:function(){this._restClient=void 0},_initializeServices:function(){u[h.SERVICE_AUTH]=new d},_initializeDao:function(){u.dao={}},_initializeEvent:function(){},callAPI:function(t,e,i){var a=this;this._restClient[t](e,function(t,e){return t?i?i(t,e):void 0:(a._saveUserData(Object.keys(c),e),i?i(t,e):void 0)})},loadMasterData:function(t){this._masterDataTypes=Object.keys(n.DATA_TYPE),this._sequentiallyLoadMaster(t)},_sequentiallyLoadMaster:function(t){var e=this;if(e._masterDataTypes.length<=0)return t();this.callAPI(o[e._masterDataTypes[0]],void 0,function(i,a){if(i)return cc.log("ERROR: call api error"),u[h.ERROR_MANAGER].throwError(i.errorCode,i.retryAPI);var n=msgpack.decode(new Uint8Array(a));return e._saveMasterData([e._masterDataTypes[0]],n),e._masterDataTypes.shift(),e._sequentiallyLoadMaster(t)})},_saveMasterData:function(t,e){var i=this;t.forEach(function(t){r[t].forEach(function(t){if(e.hasOwnProperty(t.key)){var a=[];if(!n.DATA_MODEL[t.key])return;if(e[t.key]&&e[t.key].length>0&&(a=e[t.key].map(function(e){return new i._models[n.DATA_MODEL[t.key]](e)})),"add"===t.kind){var o=t.name?t.name:t.key;Array.isArray(u.dao[o+n.MODEL_SUFFIX])||(u.dao[o+n.MODEL_SUFFIX]=[]),Array.prototype.push.apply(u.dao[o+n.MODEL_SUFFIX],a)}else u.dao[t.key+n.MODEL_SUFFIX]=a;i._masterDataLoadType=void 0}})})},loadUserData:function(t,e){this._userDataTypes=Object.keys(s.DATA_TYPE),this._sequentiallyLoadUsers(t,e)},_sequentiallyLoadUsers:function(t,e){var i=this;if(i._userDataTypes.length<=0)return t();this.callAPI(l[i._userDataTypes[0]],void 0,function(a,n){return a?(cc.log("ERROR: call api error"),u[h.ERROR_MANAGER].throwError(a.errorCode,a.retryAPI)):(i._saveUserData([i._userDataTypes[0]],n),n.finishedMissionCds&&e(n.finishedMissionCds),i._userDataTypes.shift(),i._sequentiallyLoadUsers(t,e))})},_saveUserData:function(t,e){var i=this;t.forEach(function(t){c[t].forEach(function(t){var a;e.hasOwnProperty(t.key)&&("update"===t.kind?(a=e[t.key].map(function(e){return new i._models[t.model](e)})).forEach(function(e){u.dao[t.name]=u.dao[t.name].filter(function(i){return i["get"+t.cd]()!==e["get"+t.cd]()}),u.dao[t.name].push(e)}):"add"===t.kind?(a=e[t.key].map(function(e){return new i._models[t.model](e)}),Array.isArray(u.dao[t.name])||(u.dao[t.name]=[]),Array.prototype.push.apply(u.dao[t.name],a)):t.isArray?u.dao[t.name]=e[t.key].map(function(e){return new i._models[t.model](e)}):u.dao[t.name]=new i._models[t.model](e[t.key]))})})}});cc._RF.pop()},{AuthService:"AuthService",BattleSessionModel:"BattleSessionModel",CampaignModel:"CampaignModel",CharacterAbilityEffectModel:"CharacterAbilityEffectModel",CharacterAbilityMainModel:"CharacterAbilityMainModel",CharacterContentsModel:"CharacterContentsModel",CharacterExceedLimitModel:"CharacterExceedLimitModel",CharacterFavoriteModel:"CharacterFavoriteModel",CharacterGroupModel:"CharacterGroupModel",CharacterLevelModel:"CharacterLevelModel",CharacterMainModel:"CharacterMainModel",CharacterMaterialModel:"CharacterMaterialModel",CharacterModel:"CharacterModel",CharacterNormalAttackModel:"CharacterNormalAttackModel",CharacterSkillEffectModel:"CharacterSkillEffectModel",CharacterSkillMainModel:"CharacterSkillMainModel",CharacterSkillUpRateModel:"CharacterSkillUpRateModel",DeckModel:"DeckModel",DmmModel:"DmmModel",EquipmentEffectModel:"EquipmentEffectModel",EquipmentMainModel:"EquipmentMainModel",EquipmentMaterialModel:"EquipmentMaterialModel",EquipmentModel:"EquipmentModel",EventMainModel:"EventMainModel",ExchangeItemDetailModel:"ExchangeItemDetailModel",ExchangeMainModel:"ExchangeMainModel",ExchangePointDetailModel:"ExchangePointDetailModel",FurnitureCategoryModel:"FurnitureCategoryModel",FurnitureCollectModel:"FurnitureCollectModel",FurnitureCostModel:"FurnitureCostModel",FurnitureMainModel:"FurnitureMainModel",FurnitureModel:"FurnitureModel",FurnitureTypeModel:"FurnitureTypeModel",GachaMainModel:"GachaMainModel",ItemCategoryModel:"ItemCategoryModel",ItemMainModel:"ItemMainModel",ItemModel:"ItemModel",ItemRecipeModel:"ItemRecipeModel",ItemSelectModel:"ItemSelectModel",ItemSetModel:"ItemSetModel",MasterDataApi:"MasterDataApi",MasterDataConstants:"MasterDataConstants",MasterDataLoadKeys:"MasterDataLoadKeys",MissionDetailModel:"MissionDetailModel",MissionMainModel:"MissionMainModel",MissionModel:"MissionModel",MissionRewardModel:"MissionRewardModel",MyPageBannerModel:"MyPageBannerModel",MyPageEventModel:"MyPageEventModel",MyPageMainModel:"MyPageMainModel",PictureBookBaseModel:"PictureBookBaseModel",PictureBookDetailModel:"PictureBookDetailModel",PresentMessageModel:"PresentMessageModel",PvPClassModel:"PvPClassModel",PvPMainModel:"PvPMainModel",PvPModel:"PvPModel",QuestAchieveModel:"QuestAchieveModel",QuestAreaModel:"QuestAreaModel",QuestDropModel:"QuestDropModel",QuestEventPointModel:"QuestEventPointModel",QuestModel:"QuestModel",QuestStageModel:"QuestStageModel",QuestWorldModel:"QuestWorldModel",RESTClient:"RESTClient",RoomCharacterFrameModel:"RoomCharacterFrameModel",RoomMainModel:"RoomMainModel",RoomModel:"RoomModel",ShopDetailModel:"ShopDetailModel",ShopMainModel:"ShopMainModel",Singleton:"Singleton",SingletonConst:"SingletonConst",StoryCategoryModel:"StoryCategoryModel",StoryEventModel:"StoryEventModel",StoryGroupModel:"StoryGroupModel",StoryModel:"StoryModel",StoryOtherModel:"StoryOtherModel",StoryPictureBookModel:"StoryPictureBookModel",StoryQuestModel:"StoryQuestModel",StoryRoomModel:"StoryRoomModel",TowerMainModel:"TowerMainModel",TowerSessionModel:"TowerSessionModel",UserBasicInfoModel:"UserBasicInfoModel",UserCharacterModel:"UserCharacterModel",UserDataApi:"UserDataApi",UserDataConstants:"UserDataConstants",UserDataLoadSettings:"UserDataLoadSettings",UserEquipmentModel:"UserEquipmentModel",UserExchangeHistoryModel:"UserExchangeHistoryModel",UserFurnitureModel:"UserFurnitureModel",UserGachaModel:"UserGachaModel",UserItemModel:"UserItemModel",UserMainModel:"UserMainModel",UserMissionModel:"UserMissionModel",UserModel:"UserModel",UserPictureBookBaseModel:"UserPictureBookBaseModel",UserPictureBookDetailModel:"UserPictureBookDetailModel",UserPurchaseHistoryModel:"UserPurchaseHistoryModel",UserPvPModel:"UserPvPModel",UserRoomLayoutModel:"UserRoomLayoutModel",UserRoomModel:"UserRoomModel",UserStoryModel:"UserStoryModel"}],SetTestBattleBtnOBJ:[function(t,e,i){"use strict";cc._RF.push(e,"9a1b0wNkFZNZL/N3DsMJe9u","SetTestBattleBtnOBJ"),cc.Class({extends:cc.Component,properties:{onClickEvent:null},onButtonClick:function(t){this.onClickEvent&&this.onClickEvent()}}),cc._RF.pop()},{}],SetTestBattleManager:[function(t,e,i){"use strict";cc._RF.push(e,"2fec9zauFVIcLjfuPs9rHSp","SetTestBattleManager");var a=t("BattleData");cc.Class({extends:cc.Component,properties:{simpleBtnOBJ:cc.Prefab,charaSelectContent:cc.Node,charaSelectToggleContainer:cc.ToggleContainer,curSkillBase:cc.Node,skilltextLabels:[cc.Label],skillSelectBase:cc.Node,skillSelectContent:cc.Node,skillSelectToggleContainer:cc.ToggleContainer,charaSaveBtn:cc.Button,skillRateBase:cc.Node,skillRateToggle:cc.Toggle,curAbilityBase:cc.Node,abiTriggerTextLabel:cc.Label,abitextLabels:[cc.Label],abiTriggerSelectBase:cc.Node,abiTriggerSelectContent:cc.Node,abiTriggerSelectToggleContainer:cc.ToggleContainer,abiActionSelectBase:cc.Node,abiActionContent:cc.Node,abiActionToggleContainer:cc.ToggleContainer},start:function(){this.loadMasterJsonData(function(){this.initSampleData(),this.setCharaBase()}.bind(this))},loadMasterJsonData:function(t){var e=["CharaDataTest","SkillSubActionDataTest","AbilityTriggerDataTest","AbilitySubActionDataTest"],i=e.length,a=this;a.jsonMstDatas={};for(var n=function(n){var o=e[n];a.loadTextData(o,function(e){if(a.jsonMstDatas[o]=e,--i<=0)return t()})},o=0;o<e.length;o++)n(o)},loadTextData:function(t,e){cc.loader.loadRes("textData/inGameLocalData/"+t,function(t,i){if(!t)return e(i);cc.error(t)})},initSampleData:function(){if(null==a.testDataOBJ){var t={},e=this.jsonMstDatas.CharaDataTest.json,i=this.jsonMstDatas.SkillSubActionDataTest.json,n=this.jsonMstDatas.AbilityTriggerDataTest.json,o=this.jsonMstDatas.AbilitySubActionDataTest.json;for(var r in e){var s=e[r];cc.log(r);var c={};c.skillTextFirst=s.skillTextFirst,c.maxSkillRate=!1;var l=s.skillActionId;c.skillSubActionId=l;var u=i[l];c.skillSubAction=u.subActionList;var h=s.abilityTriggerId;c.abilityTriggerId=h;var d=n[h];c.abiTriggerData=d;var p=s.abilityActionId;c.abilityActionId=p;var m=o[p];c.abiActionData=m.subActionList,t[r]=c}cc.log(t),this.masterOBJ=t}else this.masterOBJ=a.testDataOBJ},setCharaBase:function(){var t=this,e=this.charaSelectContent.children;if(e)for(var i=0;i<e.length;i++)e[i].destroy();var a=this.jsonMstDatas.CharaDataTest.json,n=this,o=function(){var e=a[r],i=cc.instantiate(t.simpleBtnOBJ);t.charaSelectContent.addChild(i),i.getChildByName("nameLabel").getComponent(cc.Label).string=e.name,i.getComponent(cc.Toggle).toggleContainer=t.charaSelectToggleContainer;var o=i.getComponent("SetTestBattleBtnOBJ");o.myIdx=r,o.onButtonClick=function(){n.onSelectChara(o.myIdx)}};for(var r in a)o()},onSelectChara:function(t){cc.log(t);var e=this.masterOBJ[t];for(var i in cc.log(e),this.skilltextLabels){this.skilltextLabels[i].string=""}this.skilltextLabels[0].string=e.skillTextFirst;var a=e.skillSubAction,n=1;for(var i in a){var o=a[i];this.skilltextLabels[n++].string=o.text}this.selectedCharaOBJ=e,this.curSkillBase.active=!0,this.setSkillSelect(),this.charaSaveBtn.node.active=!1,e.maxSkillRate?this.skillRateToggle.isChecked=!0:this.skillRateToggle.isChecked=!1,this.skillRateBase.active=!0;var r=e.abiTriggerData;this.abiTriggerTextLabel.string=r.text;var s=e.abiActionData;for(var i in this.abitextLabels){this.abitextLabels[i].string=""}for(var i in s){var c=s[i];this.abitextLabels[i].string=c.text}this.curAbilityBase.active=!0,this.setAbilityTriggerSelect(),this.setAbilityActionSelect()},setSkillSelect:function(){var t=this,e=this.skillSelectContent.children;if(e)for(var i=0;i<e.length;i++)e[i].destroy();var a=this.jsonMstDatas.SkillSubActionDataTest.json,n=1;this.selectedCharaOBJ&&(n=this.selectedCharaOBJ.skillSubActionId),cc.log(n);var o=this,r=function(){var e=a[s],i=cc.instantiate(t.simpleBtnOBJ);t.skillSelectContent.addChild(i),i.getChildByName("nameLabel").getComponent(cc.Label).string=e.desc;var r=i.getComponent(cc.Toggle);r.toggleContainer=t.skillSelectToggleContainer,r.isChecked=n==s;var c=i.getComponent("SetTestBattleBtnOBJ");c.myIdx=s,c.onButtonClick=function(){o.onSelectSkill(c.myIdx)}};for(var s in a)r();this.skillSelectBase.active=!0},onSelectSkill:function(t){if(this.selectedCharaOBJ){var e=this.selectedCharaOBJ,i=this.jsonMstDatas.SkillSubActionDataTest.json[t],a=i.subActionList;for(var n in this.skilltextLabels){this.skilltextLabels[n].string=""}this.skilltextLabels[0].string=e.skillTextFirst;var o=1;for(var n in a){var r=a[n];this.skilltextLabels[o++].string=r.text}this.selectedSubId=t,this.selectedSubSkill=i}this.charaSaveBtn.node.active=!0},onClickCharaSave:function(t){this.selectedCharaOBJ&&(this.selectedSubSkill&&(this.selectedCharaOBJ.skillSubActionId=this.selectedSubId,this.selectedCharaOBJ.skillSubAction=this.selectedSubSkill.subActionList,this.selectedSubSkill=null,this.selectedSubId=null),this.selectedAbiTriggerData&&(this.selectedCharaOBJ.abilityTriggerId=this.selectedAbiTriggerId,this.selectedCharaOBJ.abiTriggerData=this.selectedAbiTriggerData,this.selectedAbiTriggerId=null,this.selectedAbiTriggerData=null),this.selectedAbiActionData&&(this.selectedCharaOBJ.abilityActionId=this.selectedAbiActionId,this.selectedCharaOBJ.abiActionData=this.selectedAbiActionData,this.selectedAbiActionId=null,this.selectedAbiActionData=null),this.selectedCharaOBJ.maxSkillRate=this.skillRateToggle.isChecked,this.selectedCharaOBJ=null,this.curSkillBase.active=!1,this.skillSelectBase.active=!1,this.charaSaveBtn.node.active=!1,this.skillRateBase.active=!1,this.curAbilityBase.active=!1,this.abiTriggerSelectBase.active=!1,this.abiActionSelectBase.active=!1),cc.log(this.masterOBJ)},onToggleSkillRate:function(t){this.selectedCharaOBJ&&this.selectedCharaOBJ.maxSkillRate!=t.isChecked&&(this.charaSaveBtn.node.active=!0)},setAbilityTriggerSelect:function(){var t=this,e=this.abiTriggerSelectContent.children;if(e)for(var i=0;i<e.length;i++)e[i].destroy();var a=this.jsonMstDatas.AbilityTriggerDataTest.json,n=1;this.selectedCharaOBJ&&(n=this.selectedCharaOBJ.abilityTriggerId);var o=this,r=function(){var e=a[s],i=cc.instantiate(t.simpleBtnOBJ);t.abiTriggerSelectContent.addChild(i),i.getChildByName("nameLabel").getComponent(cc.Label).string=e.text;var r=i.getComponent(cc.Toggle);r.toggleContainer=t.abiTriggerSelectToggleContainer,r.isChecked=n==s;var c=i.getComponent("SetTestBattleBtnOBJ");c.myIdx=s,c.onButtonClick=function(){o.onSelectAbiTrigger(c.myIdx)}};for(var s in a)r();this.abiTriggerSelectBase.active=!0},onSelectAbiTrigger:function(t){if(this.selectedCharaOBJ){var e=this.jsonMstDatas.AbilityTriggerDataTest.json[t];this.abiTriggerTextLabel.string=e.text,this.selectedAbiTriggerId=t,this.selectedAbiTriggerData=e,this.charaSaveBtn.node.active=!0}},setAbilityActionSelect:function(){var t=this,e=this.abiActionContent.children;if(e)for(var i=0;i<e.length;i++)e[i].destroy();var a=this.jsonMstDatas.AbilitySubActionDataTest.json,n=1;this.selectedCharaOBJ&&(n=this.selectedCharaOBJ.abilityActionId);var o=this,r=function(){var e=a[s],i=cc.instantiate(t.simpleBtnOBJ);t.abiActionContent.addChild(i),i.getChildByName("nameLabel").getComponent(cc.Label).string=e.desc;var r=i.getComponent(cc.Toggle);r.toggleContainer=t.skillSelectToggleContainer,r.isChecked=n==s;var c=i.getComponent("SetTestBattleBtnOBJ");c.myIdx=s,c.onButtonClick=function(){o.onSelectAbilityAction(c.myIdx)}};for(var s in a)r();this.abiActionSelectBase.active=!0},onSelectAbilityAction:function(t){if(this.selectedCharaOBJ){var e=this.jsonMstDatas.AbilitySubActionDataTest.json[t].subActionList;for(var i in this.abitextLabels){this.abitextLabels[i].string=""}for(var i in e){var a=e[i];this.abitextLabels[i].string=a.text}this.selectedAbiActionId=t,this.selectedAbiActionData=e,this.charaSaveBtn.node.active=!0}}}),cc._RF.pop()},{BattleData:"BattleData"}],ShaderController:[function(t,e,i){"use strict";cc._RF.push(e,"49d5df3sudPgoAfl5gVABPv","ShaderController");var a=t("shaderCode_GaussBlurs"),n=cc.Class({properties:{gaussBlur_program:null},init_shaderCtrl:function(){},get_blur_program:function(){var t=new cc.GLProgram;return cc.sys.isNative?t.initWithString(a.blurs_vert,a.blurs_frag):(t.initWithVertexShaderByteArray(a.blurs_vert,a.blurs_frag),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS)),t.link(),t.updateUniforms(),t},set_blur:function(t,e){var i=Number((e/10).toFixed(3));if(t.use(),cc.sys.isNative){cc.GLProgramState.getOrCreateWithGLProgram(t).setUniformFloat("bluramount",i)}else{var a=t.getUniformLocationForName("bluramount");t.setUniformLocationWith1f(a,i)}return t},apply_blur_simple:function(t,e,i){e=this.set_blur(e,i);var a=t;return t instanceof cc.Node||(a=t.node),this.setProgram(a._sgNode,e),e},apply_blur:function(t,e,i,a){var n=this.get_blur_program(i),o=t;return t instanceof cc.Node||(o=t.node),a?this.setProgram(o._sgNode,n):this.setProgram(o.getComponent(e)._sgNode,n),n},setProgram:function(t,e){if(cc.sys.isNative){var i=cc.GLProgramState.getOrCreateWithGLProgram(e);t.setGLProgramState(i)}else t.setShaderProgram(e);var a=t.children;if(a)for(var n=0;n<a.length;n++){var o=a[n];this.setProgram(o,e)}}});e.exports=n,cc._RF.pop()},{shaderCode_GaussBlurs:"shaderCode_GaussBlurs"}],ShopApis:[function(t,e,i){"use strict";cc._RF.push(e,"7da1biu1Y5Li5q4JwXfGC+X","ShopApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.SHOP_GET_MASTER_DATA,path:"shop/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.SHOP_GET_USER_DATA,path:"shop/getUserData",method:"POST"}),a.RESTClient.graft({name:n.SHOP_PURCHASE,path:"shop/purchase",method:"POST"}),a.RESTClient.graft({name:n.SHOP_EXCHANGE,path:"shop/exchange",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],ShopBoxExpansionConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"b660aq/jaVKTamUAFTpa23B","ShopBoxExpansionConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ResourceUtils"),r=(t("ItemUtils"),t("StaticResourceConst")),s=t("ItemConst");cc.Class({extends:a,properties:{headerTextBoxNameLabel:cc.Label,mainTestBoxNameLabel:cc.Label,boxNameLabel:cc.Label,thumbnailNode:cc.Node,needGemLabel:cc.Label,gemLabel:cc.Label,gemAfterLabel:cc.Label,boxLabel:cc.Label,boxAfterLabel:cc.Label,cancelBtn:n,expansionBtn:n},openShopBoxExpansionConfirmPopup:function(t,e,i){this._setMatrixThumbnail(t),this._setBoxNameLabel(t),this._setGemLabel(t,e),this._setBoxLabel(t,e),this.expansionBtn.setTapEvent(function(){this.setCloseCallBack(i),this.close()}.bind(this)),this.cancelBtn.setTapEvent(this._onTapCloseBtn.bind(this),n.SE_NAME.CANCEL),this.open()},_setMatrixThumbnail:function(t){var e=cc.instantiate(o.getResource(r.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");switch(t.shopDetailInfoArray[0].shopDetailMaster.getCostType()){case s.ITEM_TYPE.FREE_GEM:e.setMainImage(o.getFileNameItemThumbnail(s.GEM_ITEM_ID.FREE));break;case s.ITEM_TYPE.PAID_GEM:e.setMainImage(o.getFileNameItemThumbnail(s.GEM_ITEM_ID.PAID))}this.thumbnailNode.addChild(e.node)},_setBoxNameLabel:function(t){var e="";switch(t.shopDetailInfoArray[0].shopDetailMaster.getItemType()){case s.ITEM_TYPE.CHARA_POSSESSION_BORDER:e="\u30e6\u30cb\u30c3\u30c8BOX";break;case s.ITEM_TYPE.EQUIPMENT_POSSESSION_BORDER:e="\u88c5\u5099BOX"}this.headerTextBoxNameLabel.string=e,this.mainTestBoxNameLabel.string=e,this.boxNameLabel.string=e},_setGemLabel:function(t,e){this.needGemLabel.string=""+t.shopDetailInfoArray[0].shopDetailMaster.getCostCount(),this.gemLabel.string=""+e.getGem(),this.gemAfterLabel.string=""+(e.getGem()-t.shopDetailInfoArray[0].shopDetailMaster.getCostCount())},_setBoxLabel:function(t,e){var i=0;switch(t.shopDetailInfoArray[0].shopDetailMaster.getItemType()){case s.ITEM_TYPE.CHARA_POSSESSION_BORDER:i=e.getCharacterMaxCount();break;case s.ITEM_TYPE.EQUIPMENT_POSSESSION_BORDER:i=e.getEquipmentMaxCount()}this.boxLabel.string=""+i,this.boxAfterLabel.string=""+(i+t.shopDetailInfoArray[0].shopDetailMaster.getCount())},_onTapCloseBtn:function(){this.close()}}),cc._RF.pop()},{CommonButton:"CommonButton",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],ShopBoxExpansionPopup:[function(t,e,i){"use strict";cc._RF.push(e,"22a24z2KMJHaZty8S3EWGzv","ShopBoxExpansionPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ItemConst");cc.Class({extends:a,properties:{headerTextBoxNameLabel:cc.Label,mainTestBoxNameLabel:cc.Label,boxNameLabel:cc.Label,gemLabel:cc.Label,gemAfterLabel:cc.Label,boxLabel:cc.Label,boxAfterLabel:cc.Label,okBtn:n},openShopBoxExpansionPopup:function(t,e,i,a){this._setBoxNameLabel(t),this._setGemLabel(t,e,i),this._setBoxLabel(t,e,i),this.okBtn.setTapEvent(function(){this.setCloseCallBack(a),this.close()}.bind(this)),this.open()},_setBoxNameLabel:function(t){var e="";switch(t.shopDetailMaster.getItemType()){case o.ITEM_TYPE.CHARA_POSSESSION_BORDER:e="\u30e6\u30cb\u30c3\u30c8BOX";break;case o.ITEM_TYPE.EQUIPMENT_POSSESSION_BORDER:e="\u88c5\u5099BOX"}this.headerTextBoxNameLabel.string=e,this.mainTestBoxNameLabel.string=e,this.boxNameLabel.string=e},_setGemLabel:function(t,e,i){this.gemLabel.string=""+e.getGem(),this.gemAfterLabel.string=""+(e.getGem()-t.shopDetailMaster.getCostCount()*i)},_setBoxLabel:function(t,e,i){var a=0;switch(t.shopDetailMaster.getItemType()){case o.ITEM_TYPE.CHARA_POSSESSION_BORDER:a=e.getCharacterMaxCount();break;case o.ITEM_TYPE.EQUIPMENT_POSSESSION_BORDER:a=e.getEquipmentMaxCount()}this.boxLabel.string=""+a,this.boxAfterLabel.string=""+(a+t.shopDetailMaster.getCount()*i)}}),cc._RF.pop()},{CommonButton:"CommonButton",ItemConst:"ItemConst",PopupBase:"PopupBase"}],ShopBoxExpansionPurchaseConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"c6f33ePRI1JdqGhlOxRpcrF","ShopBoxExpansionPurchaseConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("ShopPurchaseItemThumbnail"),t("CommonCountView")),r=t("ItemConst"),s=t("ItemUtils"),c=t("ResourceUtils"),l=t("CommonUtils"),u=t("ShopUtils");cc.Class({extends:a,properties:{costCurrencyNameLabel:cc.Label,costCurrencyCountLabel:cc.Label,itemImageSprite:cc.Sprite,itemNameLabel:cc.Label,beforePurchaseCountLabel:cc.Label,afterPurchaseCountLabel:cc.Label,beforePurchaseMaxCountLabel:cc.Label,afterPurchaseMaxCountLabel:cc.Label,countView:o,currencyIconSprite:cc.Sprite,possessionCurrencyNameLabel:cc.Label,beforeCurrencyCountLabel:cc.Label,afterCurrencyCountLabel:cc.Label,cancelBtn:n,purchaseBtn:n},_shopDetailInfo:void 0,_nowCurrencyCount:0,_historyCount:0,_purchaseCount:0,openShopBoxExpansionPurchaseConfirmPopup:function(t,e,i,a,n){this._shopDetailInfo=t,this._nowCurrencyCount=i,this._historyCount=u.getShopItemRemainingCount(t.shopDetailMaster.getListId(),t.shopDetailMaster.getMaxCount(),t.shopDetailMaster.getResetType()),this._setLabel(t.shopDetailMaster,i,a),this._setItem(t,this._historyCount),this._initCountView(t.shopDetailMaster,this._historyCount,i),c.addSprite(this.currencyIconSprite,c.getFileNameItemImage(r.GEM_ITEM_ID.FREE)),this._setButtonEvent(n),this.open()},_setItem:function(t,e){c.addSprite(this.itemImageSprite,c.getFileNameItemThumbnail(t.shopDetailMaster.getItemId())),this.itemNameLabel.string=t.shopDetailMaster.getName(),this.beforePurchaseMaxCountLabel.string=""+t.shopDetailMaster.getMaxCount(),this.afterPurchaseMaxCountLabel.string=""+t.shopDetailMaster.getMaxCount(),this.beforePurchaseCountLabel.string=""+(t.shopDetailMaster.getMaxCount()-e),this.afterPurchaseCountLabel.string=""+(t.shopDetailMaster.getMaxCount()-e)},_setLabel:function(t,e,i){s.getItemMaster(r.GEM_ITEM_ID.FREE);var a=t.getCostCount()*i;this.costCurrencyCountLabel.string=l.convertToCommaDelimited(a),this.beforeCurrencyCountLabel.string=l.convertToCommaDelimited(e),this.afterCurrencyCountLabel.string=l.convertToCommaDelimited(e-a)},_initCountView:function(t,e,i,a){var n=Math.floor(i/t.getCostCount()),o=0;o=t.getMaxCount()<=0?n:e<n?e:n,this.countView.initCommonCountView(this._redrawCost.bind(this),1,o,a)},_setButtonEvent:function(t){this.cancelBtn.setTapEvent(function(){this.close()}.bind(this),n.SE_NAME.CANCEL),this.purchaseBtn.setTapEvent(function(){this.setCloseCallBack(function(){t(this._purchaseCount)}.bind(this)),this.close()}.bind(this))},_redrawCost:function(t){this._purchaseCount=t,this.afterPurchaseCountLabel.string=""+(this._shopDetailInfo.shopDetailMaster.getMaxCount()-this._historyCount+t),this._setLabel(this._shopDetailInfo.shopDetailMaster,this._nowCurrencyCount,t)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",ShopPurchaseItemThumbnail:"ShopPurchaseItemThumbnail",ShopUtils:"ShopUtils"}],ShopCampaignItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"ec6707SKI1JnKw8kbYcbGbs","ShopCampaignItemListView");var a=t("ItemConst"),n=t("ShopItemListViewBase");cc.Class({extends:n,properties:{},_getShopInfo:function(t){return t.getShopInfoByCategory(a.SHOP_CATEGORY.CAMPAIGN)}});cc._RF.pop()},{ItemConst:"ItemConst",ShopItemListViewBase:"ShopItemListViewBase"}],ShopDetailModel:[function(t,e,i){"use strict";cc._RF.push(e,"ef160hikWdH6qt7R9E12lH8","ShopDetailModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getShopId:function(){if(this._isKeyFieldAvailable("shopId"))return this._data.shopId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shopId")},getListId:function(){if(this._isKeyFieldAvailable("listId"))return this._data.listId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: listId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getCostType:function(){if(this._isKeyFieldAvailable("costType"))return this._data.costType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costType")},getCostId:function(){if(this._isKeyFieldAvailable("costId"))return this._data.costId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costId")},getCostCount:function(){if(this._isKeyFieldAvailable("costCount"))return this._data.costCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: costCount")},getMaxCount:function(){if(this._isKeyFieldAvailable("maxCount"))return this._data.maxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxCount")},getResetType:function(){if(this._isKeyFieldAvailable("resetType"))return this._data.resetType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resetType")},getReplenishmentDays:function(){if(this._isKeyFieldAvailable("replenishmentDays"))return this._data.replenishmentDays;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: replenishmentDays")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getNormalBonus:function(){if(this._isKeyFieldAvailable("normalBonus"))return this._data.normalBonus;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: normalBonus")},getFirstBonus:function(){if(this._isKeyFieldAvailable("firstBonus"))return this._data.firstBonus;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: firstBonus")},getIconName:function(){if(this._isKeyFieldAvailable("iconName"))return this._data.iconName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: iconName")},getSkuId:function(){if(this._isKeyFieldAvailable("skuId"))return this._data.skuId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skuId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ShopExpansionItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"718f9bFOEhBT5ggGzrNQYVm","ShopExpansionItemListView");t("Singleton");var a=t("ResourceUtils"),n=(t("ItemUtils"),t("ShopUtils")),o=t("PopupUtils"),r=(t("TimeUtils"),t("ShopItemListViewBase")),s=t("ItemConst");cc.Class({extends:r,properties:{},_getShopInfo:function(t){return t.getShopInfoByCategory(s.SHOP_CATEGORY.BOX)},_addThumbnail:function(t,e){var i=n.getShopItemRemainingCount(t.shopDetailMaster.getListId(),t.shopDetailMaster.getMaxCount(),t.shopDetailMaster.getResetType()),o=cc.instantiate(this.thumbnailPrefab).getComponent("ShopItemThumbnail");s.SHOP_CATEGORY.NORMAL===e.getCategory()?o.setMainMatrixThumbnail(a.getFileNameItemThumbnail(t.shopDetailMaster.getItemId())):o.setMainImage(a.getFileNameShopItemLargeThumbnail(t.shopDetailMaster.getListId())),o.setItemName(t.shopDetailMaster.getName()),o.setCostCount(t.shopDetailMaster.getCostCount()),this._setCostImage(o,t.shopDetailMaster.getCostType()),this._setVipRemainDate(o,i,t),this._setPurchaseProperties(o,t,i),this.thumbnailParentNode.addChild(o.node)},_onTapPurchase:function(t){var e=n.getShopItemRemainingCount(t.shopDetailMaster.getListId(),t.shopDetailMaster.getMaxCount(),t.shopDetailMaster.getResetType());this._root.getUserModel().getGem()>=t.shopDetailMaster.getCostCount()?this._root.openBoxExpansionConfirmPopup(t,e,this._root.getUserModel().getGem()):o.openCommonPopupYesNo("","\u5e7b\u5922\u77f3\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b7\u30e7\u30c3\u30d7\u3067\u8cfc\u5165\u3057\u307e\u3059\u304b\uff1f","",!1,function(){this._root.pushShopSelectSubRoot(s.SHOP_CATEGORY.GEM)}.bind(this),function(){},"\u5b9f\u884c","\u30ad\u30e3\u30f3\u30bb\u30eb")}});cc._RF.pop()},{ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",ShopItemListViewBase:"ShopItemListViewBase",ShopUtils:"ShopUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],ShopGemItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"c0ed9fq4YFOkLUx4IQ/ayN/","ShopGemItemListView");var a=t("ItemConst"),n=t("ShopItemListViewBase");cc.Class({extends:n,properties:{},_getShopInfo:function(t){return t.getShopInfoByCategory(a.SHOP_CATEGORY.GEM)}});cc._RF.pop()},{ItemConst:"ItemConst",ShopItemListViewBase:"ShopItemListViewBase"}],ShopItemListDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"3f7bceCsilN3I3ICQ2KUP8h","ShopItemListDetailPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=(t("Singleton"),t("CommonUtils")),s=(t("ItemUtils"),t("ShopUtils"),t("ShopRootUtils"));t("ItemConst"),cc.Class({extends:a,properties:{confirmTitleLabel:cc.Label,confirmDescriptionLabel:cc.Label,completeTitleLabel:cc.Label,completeDescriptionNode:cc.Node,shopItemWideThumbnailPrefab:cc.Prefab,scrollView:o,okBtn:n},_bCompleteFlg:null,openShopItemListDetailPopup:function(t,e,i){this._bCompleteFlg=e,this.scrollView.node.active=!1,e?(this.confirmTitleLabel.node.active=!1,this.confirmDescriptionLabel.node.active=!1,this.completeTitleLabel.node.active=!0,this.completeDescriptionNode.active=!0):(this.confirmTitleLabel.string=_.replace(t.shopDetailMaster.getName(),/\r?\n/g," "),this.confirmTitleLabel.node.active=!0,this.confirmDescriptionLabel.node.active=!0,this.completeTitleLabel.node.active=!1,this.completeDescriptionNode.active=!1),s.setShopThumbnailList(t.shopItemInfoArray,this.scrollView,this.shopItemWideThumbnailPrefab,this.confirmDescriptionLabel,"ShopItemWideThumbnail",e,function(t,e){t.getComponent("ShopItemWideThumbnail").initShopItemWideThumbnail(e)}),this.setCloseCallBack(i),this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.open(function(){this.scrollView.node.active=!0}.bind(this))},onDestroy:function(){var t=r.getRoot();t&&t.deleteUpdateCallbackKey("ShopItemWideThumbnail",null)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",CommonUtils:"CommonUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ShopRootUtils:"ShopRootUtils",ShopUtils:"ShopUtils",Singleton:"Singleton"}],ShopItemListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"12f0bSt3oFFgLUSzCRKJrJN","ShopItemListViewBase");var a=t("Singleton"),n=t("GameConst"),o=t("ListViewBase"),r=t("ItemConst"),s=t("ResourceUtils"),c=t("ShopUtils"),l=t("PopupUtils"),u=t("TimeUtils"),h=t("UserUtils");cc.Class({extends:o,properties:{remainingDateNode:cc.Node,remainingDateLabel:cc.Label,remainingTimeNode:cc.Node,remainingTimeLabel:cc.Label},_getShopInfo:function(t){return cc.error("_getShopInfo(root)\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),t.getShopInfoByCategory(r.SHOP_CATEGORY.CAMPAIGN)},_setListContent:function(t){var e=this._getShopInfo(t),i=_.filter(e.shopDetailInfoArray,function(t){return this._checkOpenCondition(t)}.bind(this));for(var a in i=this._getListContentArrayByType(i))this._addThumbnail(i[a],e.shopMainMaster);this._setRemainingDate(e)},_getListContentArrayByType:function(t){for(var e=[],i=[],a=0;a<t.length;a++){var n=t[a];c.getShopItemRemainingCount(n.shopDetailMaster.getListId(),n.shopDetailMaster.getMaxCount(),n.shopDetailMaster.getResetType())<=0?i.push(n):e.push(n)}return e.push.apply(e,i),e},_addThumbnail:function(t,e){var i=c.getShopItemRemainingCount(t.shopDetailMaster.getListId(),t.shopDetailMaster.getMaxCount(),t.shopDetailMaster.getResetType()),a=cc.instantiate(this.thumbnailPrefab).getComponent("ShopItemThumbnail");r.SHOP_CATEGORY.NORMAL===e.getCategory()?a.setMainMatrixThumbnail(s.getFileNameItemThumbnail(t.shopDetailMaster.getItemId())):a.setMainImage(s.getFileNameShopItemThumbnail(t.shopDetailMaster.getListId())),a.setItemName(t.shopDetailMaster.getName()),a.setCostCount(t.shopDetailMaster.getCostCount()),this._setLimited(a,t.shopDetailMaster.getToDate()),this._setCostImage(a,t.shopDetailMaster.getCostType()),this._setVipRemainDate(a,i,t),this._setPurchaseProperties(a,t,i),a.setCallbackToInfoBtn(function(){this._onTapInfo(t)}.bind(this)),a.setInfoBtnActive(r.ITEM_TYPE.SET_ITEM===t.shopDetailMaster.getItemType()),this.thumbnailParentNode.addChild(a.node)},_setVipRemainDate:function(t,e,i){if(e<=0){var n=a.dao.userPurchaseHistories.find(function(t){return t.getListId()===i.shopDetailMaster.getListId()});if(i.shopDetailMaster.getResetType()===r.SHOP_RESET_TYPE.REPLENISHMENT_DAYS){var o=u.addSecond(n.getLastPurchaseDate(),86400*i.shopDetailMaster.getReplenishmentDays()-1);t.setVipRemainDate(u.getDiffMS(o))}else if(i.shopDetailMaster.getResetType()===r.SHOP_RESET_TYPE.REPLENISHMENT_LOGIN_DAYS){o=u.addSecond(n.getLastPurchaseDate().substr(0,8)+"000000",86400*i.shopDetailMaster.getReplenishmentDays()-1);t.setVipRemainDate(u.getDiffMS(o))}}else this._setStockCount(t,i.shopDetailMaster.getMaxCount(),e)},_setLimited:function(t,e){t.switchLimited(!!e)},_setCostImage:function(t,e){switch(e){case r.ITEM_TYPE.DMM_POINT:t.setCostName("DMM\u30dd\u30a4\u30f3\u30c8");break;case r.ITEM_TYPE.FREE_GEM:t.setCostImage(s.getFileNameItemImage(r.GEM_ITEM_ID.FREE))}},_setPurchaseProperties:function(t,e,i){if(i>0)return e.shopDetailMaster.getResetType()===r.SHOP_RESET_TYPE.REPLENISHMENT_DAYS||e.shopDetailMaster.getResetType()===r.SHOP_RESET_TYPE.REPLENISHMENT_LOGIN_DAYS?t.switchActiveVipPurchaseBtn(!0):t.switchActivePurchaseBtn(!0),void t.setCallbackToPurchaseBtn(function(){this._onTapPurchase(e)}.bind(this));e.shopDetailMaster.getResetType()===r.SHOP_RESET_TYPE.REPLENISHMENT_DAYS||e.shopDetailMaster.getResetType()===r.SHOP_RESET_TYPE.REPLENISHMENT_LOGIN_DAYS?t.switchActiveVipPurchaseBtn(!1):t.switchActivePurchaseBtn(!1)},_setStockCount:function(t,e,i){e<=0||t.setStockCount(i)},_onTapInfo:function(t){this._root.openShopItemListDetailPopup(t,!1,null)},_onTapPurchase:function(t){if(this._checkOpenCondition(t))switch(t.shopDetailMaster.getCostType()){case r.ITEM_TYPE.DMM_POINT:this._root.requestPurchase(t.shopDetailMaster.getShopId(),t.shopDetailMaster.getListId(),1,t.shopDetailMaster.getSkuId(),function(){this._root.openShopItemListDetailPopup(t,!0,null)}.bind(this));break;case r.ITEM_TYPE.PAID_GEM:this._openShopPurchaseConfirmPopup(t,this._root.getUserModel().getPaidGem());break;default:this._openShopPurchaseConfirmPopup(t,this._root.getUserModel().getGem())}else l.openCommonPopupOk("\u958b\u50ac\u671f\u9593\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002","\u5bfe\u8c61\u306e\u30b7\u30e7\u30c3\u30d7\u306f\u73fe\u5728\u958b\u50ac\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",void 0,!1,function(){this._root.reload(),this._root.redraw()}.bind(this),void 0)},_openShopPurchaseConfirmPopup:function(t,e){e>=t.shopDetailMaster.getCostCount()?this._root.openShopPurchaseConfirmPopup(t):l.openCommonPopupYesNo("","\u5e7b\u5922\u77f3\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b7\u30e7\u30c3\u30d7\u3067\u8cfc\u5165\u3057\u307e\u3059\u304b\uff1f","",!1,function(){this._root.pushShopSelectSubRoot(r.SHOP_CATEGORY.GEM)}.bind(this),function(){},"\u5b9f\u884c","\u30ad\u30e3\u30f3\u30bb\u30eb")},_checkOpenCondition:function(t){var e=this._root.getShopInfoById(t.shopDetailMaster.getShopId()).shopMainMaster;return!!u.isRangeOfDate(e.getFromDate(),e.getToDate())&&(!!u.isRangeOfDate(t.shopDetailMaster.getFromDate(),t.shopDetailMaster.getToDate())&&h.checkOpenCondition(e.getConditionType(),e.getConditionFrom(),e.getConditionTo()))},_setRemainingDate:function(t){this.remainingDateNode.active=!1,this.remainingTimeNode.active=!1;var e=t.shopMainMaster,i=e.getToDate();if(e.getConditionType()===n.OPEN_CONDITION_TYPE.REGISTER_DATE){var o=a.dao.userBasicData;i=u.addMinute(o.getTutorialEndDate(),e.getConditionTo())}if(i&&""!==i&&"99991231235959"!==i){var r=u.getDiffMS(i);u.parseMsToDay(r)>=1?(this.remainingDateNode.active=!0,this.remainingDateLabel.string=this._getRemainingDate(i)):(this.remainingTimeNode.active=!0,this.remainingTimeLabel.string=this._getRemainingDate(i))}},_getRemainingDate:function(t){var e="{year}\u5e74{month}\u6708{date}\u65e5 {hour}:{minute}\u307e\u3067",i=u.parseToYmdhmsMap(t);return e=(e=(e=(e=(e=e.replace("{year}",i.year)).replace("{month}",i.month)).replace("{date}",i.date)).replace("{hour}",i.hour)).replace("{minute}",i.minute)}});cc._RF.pop()},{GameConst:"GameConst",ItemConst:"ItemConst",ListViewBase:"ListViewBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",ShopUtils:"ShopUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",UserUtils:"UserUtils"}],ShopItemThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"91990DHblpOqb6rw+2RRxTj","ShopItemThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("CommonUtils"),r=t("TimeUtils"),s=t("StaticResourceConst");cc.Class({extends:cc.Component,properties:{mainImageSprite:cc.Sprite,costImageSprite:cc.Sprite,itemNameLabel:cc.Label,costNameLabel:cc.Label,stockCountLabel:cc.Label,costCountLabel:cc.Label,vipRemainDateLabel:cc.Label,vipRenewDateLabel:cc.Label,mainItemMatrixThumbnailNode:cc.Node,limitedDispNode:cc.Node,baseGrayNode:cc.Node,infoBtn:a,purchaseBtn:a,grayOutSprite:cc.Sprite,soldOutSprite:cc.Sprite},_callbackToInfoBtn:null,_callbackToPurchaseBtn:null,setMainImage:function(t){this.mainImageSprite.node.active=!0,this.mainItemMatrixThumbnailNode.active=!1,n.addSprite(this.mainImageSprite,t)},setMainMatrixThumbnail:function(t){this.mainImageSprite.node.active=!1,this.mainItemMatrixThumbnailNode.active=!0;var e=cc.instantiate(n.getResource(s.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");e.setMainImage(t),this.mainItemMatrixThumbnailNode.addChild(e.node)},setCostImage:function(t){n.addSprite(this.costImageSprite,t)},setItemName:function(t){this.itemNameLabel.string=t},setCostName:function(t){this.costNameLabel.string=t},setCostCount:function(t){this.costCountLabel.string=o.convertToCommaDelimited(t)},setStockCount:function(t){this.stockCountLabel.node.active=!0,this.stockCountLabel.string=t+""},setVipRemainDate:function(t){this.vipRemainDateLabel.node.parent.active=!0,this.baseGrayNode.active=!0;var e=r.parseMsToDay(t),i=r.parseMsToHour(t),a=r.parseMsToMinute(t);e>=1?this.vipRemainDateLabel.string="\u6b8b\u308a"+(e+1)+"\u65e5":i>=1?(a-=60*i,this.vipRemainDateLabel.string="\u6b8b\u308a"+i+"\u6642\u9593"+a+"\u5206"):this.vipRemainDateLabel.string="\u6b8b\u308a"+a+"\u5206"},setVipRenewDate:function(t){this.vipRenewDateLabel.string=t+"\u306b\u8ffd\u52a0\u8cfc\u5165\u53ef\u80fd"},switchLimited:function(t){this.limitedDispNode.active=t},switchActivePurchaseBtn:function(t){this.purchaseBtn.switchBtnImage(t),this.purchaseBtn.setTouchEnable(t),t||(this.grayOutSprite.node.active=!0,this.soldOutSprite.node.active=!0)},switchActiveVipPurchaseBtn:function(t){this.purchaseBtn.switchBtnImage(t),this.purchaseBtn.setTouchEnable(t),this.grayOutSprite.node.active=!1,this.soldOutSprite.node.active=!1},setCallbackToInfoBtn:function(t){this._callbackToInfoBtn||this.infoBtn.setTapEvent(this._onTapInfoBtn.bind(this),""),this._callbackToInfoBtn=t},setInfoBtnActive:function(t){this.infoBtn.switchBtnImage(t)},setCallbackToPurchaseBtn:function(t){this._callbackToPurchaseBtn||this.purchaseBtn.setTapEvent(this._onTapPurchaseBtn.bind(this)),this._callbackToPurchaseBtn=t},_onTapInfoBtn:function(){this._callbackToInfoBtn()},_onTapPurchaseBtn:function(){this._callbackToPurchaseBtn()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst",TimeUtils:"TimeUtils"}],ShopItemWideThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"10a97QEZxxBlpRz9AF1nvkE","ShopItemWideThumbnail");t("ResourceUtils");var a=t("CommonUtils"),n=t("MatrixThumbnailUtils");cc.Class({extends:cc.Component,properties:{matrixThumbnailNode:cc.Node,itemNameLabel:cc.Label,itemCountLabel:cc.Label,itemDescriptionLabel:cc.Label},initShopItemWideThumbnail:function(t){var e=n.createMatrixThumbnailByItemType(t.itemId,t.itemType);this.matrixThumbnailNode.addChild(e.node),this.itemNameLabel.string=t.name,this.itemCountLabel.string=a.convertToCommaDelimited(t.count),this.itemDescriptionLabel.string=""+t.text}}),cc._RF.pop()},{CommonUtils:"CommonUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils"}],ShopMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"86612QREKZPcroroW5y71bC","ShopMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getShopId:function(){if(this._isKeyFieldAvailable("shopId"))return this._data.shopId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shopId")},getCategory:function(){if(this._isKeyFieldAvailable("category"))return this._data.category;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: category")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getShortName:function(){if(this._isKeyFieldAvailable("shortName"))return this._data.shortName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shortName")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getConditionType:function(){if(this._isKeyFieldAvailable("conditionType"))return this._data.conditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionType")},getConditionFrom:function(){if(this._isKeyFieldAvailable("conditionFrom"))return this._data.conditionFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionFrom")},getConditionTo:function(){if(this._isKeyFieldAvailable("conditionTo"))return this._data.conditionTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionTo")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ShopNormalItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"18d19YHBlpM7J7vMFr7sKPb","ShopNormalItemListView");var a=t("ItemConst"),n=t("ShopItemListViewBase");cc.Class({extends:n,properties:{},_getShopInfo:function(t){return t.getShopInfoByCategory(a.SHOP_CATEGORY.NORMAL)}});cc._RF.pop()},{ItemConst:"ItemConst",ShopItemListViewBase:"ShopItemListViewBase"}],ShopPurchaseCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"efafe0bv9hF/q+ZGRO44Zj7","ShopPurchaseCompletePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ItemConst"),r=t("ResourceUtils"),s=t("CommonUtils"),c=t("ShopRootUtils");cc.Class({extends:a,properties:{costCurrencyNameLabel:cc.Label,costCurrencyCountLabel:cc.Label,scrollView:cc.ScrollView,itemThumbnailPrefab:cc.Prefab,descriptionLabel:cc.Label,currencyIconSprite:cc.Sprite,possessionCurrencyNameLabel:cc.Label,beforeCurrencyCountLabel:cc.Label,afterCurrencyCountLabel:cc.Label,okBtn:n},_shopDetailInfo:void 0,openShopPurchaseCompletePopup:function(t,e,i,a){this._setLabel(t.shopDetailMaster,i,a),this._setThumbnailPrefab(t.shopItemInfoArray),r.addSprite(this.currencyIconSprite,r.getFileNameItemImage(o.GEM_ITEM_ID.FREE)),this._setButtonEvent(),this.open()},_setThumbnailPrefab:function(t){c.setShopThumbnailList(t,this.scrollView,this.itemThumbnailPrefab,this.descriptionLabel,"ShopPurchaseItemThumbnail",!0,function(t,e){t.getComponent("ShopPurchaseItemThumbnail").initShopPurchaseCompleteThumbnail(e)})},_setLabel:function(t,e,i){var a=t.getCostCount()*i;this.costCurrencyCountLabel.string=s.convertToCommaDelimited(a),this.beforeCurrencyCountLabel.string=s.convertToCommaDelimited(e),this.afterCurrencyCountLabel.string=s.convertToCommaDelimited(e-a)},_setButtonEvent:function(){this.okBtn.setTapEvent(function(){this.close()}.bind(this))}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",ItemConst:"ItemConst",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",ShopRootUtils:"ShopRootUtils"}],ShopPurchaseConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"526bcgl7DJA1rrKEbrBj7KJ","ShopPurchaseConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ShopPurchaseItemThumbnail"),r=t("CommonCountView"),s=t("ItemConst"),c=t("ItemUtils"),l=t("ShopUtils"),u=t("ResourceUtils"),h=t("CommonUtils");cc.Class({extends:a,properties:{costCurrencyNameLabel:cc.Label,costCurrencyCountLabel:cc.Label,itemThumbnail:o,countView:r,currencyIconSprite:cc.Sprite,possessionCurrencyNameLabel:cc.Label,beforeCurrencyCountLabel:cc.Label,afterCurrencyCountLabel:cc.Label,cancelBtn:n,purchaseBtn:n},_shopDetailInfo:void 0,_nowCurrencyCount:0,_historyCount:0,_purchaseCount:0,openShopPurchaseConfirmPopup:function(t,e,i,a,n){this._shopDetailInfo=t,this._nowCurrencyCount=i,this._historyCount=l.getShopItemRemainingCount(t.shopDetailMaster.getListId(),t.shopDetailMaster.getMaxCount(),t.shopDetailMaster.getResetType()),this._setLabel(t.shopDetailMaster,i,a),this.itemThumbnail.initShopPurchaseItemThumbnail(t,this._historyCount,e,a),this._initCountView(t.shopDetailMaster,this._historyCount,i,a),u.addSprite(this.currencyIconSprite,u.getFileNameItemImage(s.GEM_ITEM_ID.FREE)),this._setButtonEvent(n),this.open()},_setLabel:function(t,e,i){c.getItemMaster(s.GEM_ITEM_ID.FREE);var a=t.getCostCount()*i;this.costCurrencyCountLabel.string=h.convertToCommaDelimited(a),this.beforeCurrencyCountLabel.string=h.convertToCommaDelimited(e),this.afterCurrencyCountLabel.string=h.convertToCommaDelimited(e-a)},_initCountView:function(t,e,i,a){var n=Math.floor(i/t.getCostCount()),o=0;o=t.getMaxCount()<=0?n:e<n?e:n,this.countView.initCommonCountView(this._redrawCost.bind(this),1,o,a)},_setButtonEvent:function(t){this.cancelBtn.setTapEvent(function(){this.close()}.bind(this),n.SE_NAME.CANCEL),this.purchaseBtn.setTapEvent(function(){this.setCloseCallBack(function(){t(this._purchaseCount)}.bind(this)),this.close()}.bind(this))},_redrawCost:function(t){this._purchaseCount=t,this.itemThumbnail.setItemRemainingCountLabel(this._historyCount-t),this._setLabel(this._shopDetailInfo.shopDetailMaster,this._nowCurrencyCount,t)}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",ShopPurchaseItemThumbnail:"ShopPurchaseItemThumbnail",ShopUtils:"ShopUtils"}],ShopPurchaseItemThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"3c832TKZ9VNWpXE4ZFz9W9j","ShopPurchaseItemThumbnail");t("ResourceUtils");var a=t("CommonUtils"),n=t("MatrixThumbnailUtils"),o=t("ItemUtils");cc.Class({extends:cc.Component,properties:{matrixThumbnailNode:cc.Node,itemNameLabel:cc.Label,itemRemainingNode:cc.Node,limitedDispNode:cc.Node,itemRemainingCountLabel:cc.Label,beforeItemCountLabel:cc.Label},_shopDetailInfo:void 0,_beforeItemCount:0,initShopPurchaseItemThumbnail:function(t,e,i,n){this._shopDetailInfo=t,this._beforeItemCount=i,this._setThumbnailPrefab(t.shopItemInfoArray[0]),this.itemNameLabel.string=t.shopItemInfoArray[0].name,this.limitedDispNode.active=!!t.shopDetailMaster.getToDate(),t.shopDetailMaster.getMaxCount()<=0?this.itemRemainingNode.active=!1:(this.setItemRemainingCountLabel(e),this.itemRemainingNode.active=!0),this.beforeItemCountLabel.string=a.convertToCommaDelimited(i)},setItemRemainingCountLabel:function(t){this.itemRemainingCountLabel.string=a.convertToCommaDelimited(t)},_setThumbnailPrefab:function(t){var e=n.createMatrixThumbnailByItemType(t.itemId,t.itemType);this.matrixThumbnailNode.addChild(e.node)},initShopPurchaseCompleteThumbnail:function(t){this._setThumbnailPrefab(t),this.itemNameLabel.string=t.name,this.limitedDispNode.active=!1,this.itemRemainingNode.active=!1,this.beforeItemCountLabel.string=a.convertToCommaDelimited(o.getUserItemCount(t.itemId,t.itemType))}}),cc._RF.pop()},{CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils"}],ShopRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"dd1b4ISc3FDlbj3TdPVn1ol","ShopRootUtils");var a=t("ShopUtils"),n=t("ItemUtils"),o=t("Singleton"),r=t("CommonUtils"),s=t("ItemConst");function c(t,e,i,a,n,o){switch(t.itemType){case s.ITEM_TYPE.LOGIN_PACK:var r=l(t,n);_.forEach(r,function(t){p(t.shopItemInfo,t.innerShopItemInfoArray,e,i,a,n,o)});break;case s.ITEM_TYPE.SET_ITEM:p(t,h(t.itemId),e,i,a,n,o);break;default:d(t,e,i,o)}}function l(t,e){var i=n.getItemMaster(t.itemId).getEffectValue(),a=_.filter(o.dao.LoginPackRewardMasters,function(t){return t.getLoginPackId()===i}),r=_.sortedUniq(_.map(a,function(t){return t.getLoginCount()}));return e&&(r=_.intersection(r,[0,1])),_.map(r,function(e){var i=_.cloneDeep(t);return i.name=0===e?"\u8cfc\u5165\u6642":e+"\u65e5\u76ee",{shopItemInfo:i,innerShopItemInfoArray:u(_.filter(a,function(t){return t.getLoginCount()===e}))}})}function u(t){for(var e=[],i=0;i<t.length;i+=1)switch(t[i].getItemType()){case s.ITEM_TYPE.SET_ITEM:Array.prototype.push.apply(e,h(t[i].getItemId()));break;default:var n=a.createShopItemInfoByItemType(t[i].getItemType(),t[i].getItemId(),t[i].getItemCount());n&&e.push(n)}return e}function h(t){for(var e=n.getItemSetMasterArrayBySetItemId(t),i=[],o=0;o<e.length;o+=1){var r=a.createShopItemInfoByItemType(e[o].getItemType(),e[o].getItemId(),e[o].getCount());r&&i.push(r)}return i}function d(t,e,i,a){var n=cc.instantiate(i);a(n,t),e.content.addChild(n)}function p(t,e,i,a,n,o,r){var s=cc.instantiate(n.node).getComponent(cc.Label);s.node.active=!0,s.string=t.name,i.content.addChild(s.node);for(var l=0;l<e.length;l+=1)c(e[l],i,a,n,o,r);var u=cc.instantiate(n.node).getComponent(cc.Label);u.node.active=!0,u.string="________________________________________",u.node.rotation=180,i.content.addChild(u.node)}e.exports={openShopTopSubRoot:function(t,e){cc.log("openShopTopSubRoot"),cc.log(e),t.shopTopSubRoot||(t.shopTopSubRoot=cc.instantiate(t.shopTopSubRootPrefab).getComponent("ShopTopSubRoot"),t.shopTopSubRoot.initShopTopSubRoot(t),t.subRootParent.addChild(t.shopTopSubRoot.node))},closeShopTopSubRoot:function(t,e){cc.log("closeShopTopSubRoot"),cc.log(e),t.shopTopSubRoot&&(t.shopTopSubRoot.node.destroy(),t.shopTopSubRoot=null)},openShopSelectSubRoot:function(t,e){cc.log("openShopSelectSubRoot"),cc.log(e),t.shopSelectSubRoot||(t.shopSelectSubRoot=cc.instantiate(t.shopSelectSubRootPrefab).getComponent("ShopSelectSubRoot"),t.subRootParent.addChild(t.shopSelectSubRoot.node)),t.shopSelectSubRoot.initShopSelectSubRoot(t,e.shopCategory)},closeShopSelectSubRoot:function(t,e){cc.log("closeShopSelectSubRoot"),cc.log(e),t.shopSelectSubRoot&&(t.shopSelectSubRoot.node.destroy(),t.shopSelectSubRoot=null)},setShopThumbnailList:function(t,e,i,a,n,o,s){var l=r.getRoot();l.deleteUpdateCallbackKey(n,function(){return e.content.destroyAllChildren()});var u=0;l.setUpdateCallback(function(){return!t[u]||(c(t[u],e,i,a,o,s),u+=1,!1)},n)}},cc._RF.pop()},{CommonUtils:"CommonUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",ShopUtils:"ShopUtils",Singleton:"Singleton"}],ShopRoot:[function(t,e,i){"use strict";cc._RF.push(e,"e447eR713xBjrjnz2Z2H7Xh","ShopRoot");var a=t("OutGameRootBase"),n=t("Singleton"),o=t("LocalDataConst"),r=t("PopupUtils"),s=t("ShopUtils"),c=t("TimeUtils"),l=t("ItemUtils"),u=t("UserUtils"),h=t("ItemConst"),d=t("ViewUtils"),p=t("ShopViewSetting");cc.Class({extends:a,properties:{shopTopSubRootPrefab:cc.Prefab,shopSelectSubRootPrefab:cc.Prefab,shopBoxExpansionConfirmPopupPrefab:cc.Prefab,shopBoxExpansionPopupPrefab:cc.Prefab,shopItemListDetailPopupPrefab:cc.Prefab,shopPurchaseConfirmPopupPrefab:cc.Prefab,shopPurchaseCompletePopupPrefab:cc.Prefab,shopSpecifiedCommercePopupPrefab:cc.Prefab},selectedShopCategory:null,_shopInfoArray:null,_filteredShopInfoArray:null,_shopBoxExpansionConfirmPopup:null,_shopBoxExpansionPopup:null,_shopItemListDetailPopup:null,_shopPurchaseConfirmPopup:null,_shopPurchaseCompletePopup:null,_shopSpecifiedCommercePopup:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,p.SHOP_SETTING)},reload:function(){this._shopInfoArray=s.getShopInfoArray(),this._filteredShopInfoArray=this._shopInfoArray.filter(function(t){return this._isRangeOfTime(t.shopMainMaster)&&this._isOpenCondition(t.shopMainMaster)}.bind(this))},redraw:function(){this.redrawUIHeader(),this.shopSelectSubRoot&&this.shopSelectSubRoot.initShopSelectSubRoot(this,this.selectedShopCategory)},initData:function(){this.reload()},initialize:function(){this._checkPaymentSession()},_checkPaymentSession:function(){var t=n.localData[o.PAYMENT_SESSION];if(t){d.addPaymentWaitLayer();var e=this.getShopInfoById(t.saveData.shopId),i=this.getShopDetailInfo(t.saveData.shopId,t.saveData.listId);this._initOpenFirstView({ShopSelectSubRoot:{shopCategory:e.shopMainMaster.getCategory()}}),n.PaymentService.getResult(t.paymentId,function(t){n.localData[o.PAYMENT_SESSION]=void 0,d.removePaymentWaitLayer(),t?this.openShopItemListDetailPopup(i,!0,null):r.openCommonPopupOk("\u8cfc\u5165\u30a8\u30e9\u30fc","\u8cfc\u5165\u51e6\u7406\u304c\u4e2d\u65ad\u3055\u308c\u307e\u3057\u305f\u3002","",!1,function(){},"OK")}.bind(this))}else this._initOpenFirstView({ShopSelectSubRoot:{shopCategory:1}})},_isRangeOfTime:function(t){return!t.getToDate()||!!c.isRangeOfDate(t.getFromDate(),t.getToDate())},_isOpenCondition:function(t){return u.checkOpenCondition(t.getConditionType(),t.getConditionFrom(),t.getConditionTo())},getShopInfoArray:function(){return this._shopInfoArray},getFilteredShopInfoArray:function(){return this._filteredShopInfoArray},getShopInfoByCategory:function(t){return this.getShopInfoArray().find(function(e){return e.shopMainMaster.getCategory()===t})},getShopInfoById:function(t){return this.getShopInfoArray().find(function(e){return e.shopMainMaster.getShopId()===t})},getShopDetailInfo:function(t,e){return this.getShopInfoById(t).shopDetailInfoArray.find(function(t){return t.shopDetailMaster.getListId()===e})},pushShopSelectSubRoot:function(t,e){var i={ShopSelectSubRoot:{shopCategory:t}},a=null;e&&(a="ShopScene"),this.pushScene("ShopScene",a,i,e)},openBoxExpansionConfirmPopup:function(t,e,i){this.closeBoxExpansionConfirmPopup(),this._shopBoxExpansionConfirmPopup=cc.instantiate(this.shopBoxExpansionConfirmPopupPrefab).getComponent("ShopBoxExpansionPurchaseConfirmPopup"),this._shopBoxExpansionConfirmPopup.openShopBoxExpansionPurchaseConfirmPopup(t,e,i,1,function(e){var i=n.dao[n.USER];this.requestPurchase(t.shopDetailMaster.getShopId(),t.shopDetailMaster.getListId(),e,t.shopDetailMaster.getSkuId(),function(){this.redraw(),this.openBoxExpansionCompletePopup(t,i,e)}.bind(this))}.bind(this))},closeBoxExpansionConfirmPopup:function(){this._shopBoxExpansionConfirmPopup&&(this._shopBoxExpansionConfirmPopup.close(),this._shopBoxExpansionConfirmPopup=null)},openBoxExpansionCompletePopup:function(t,e,i,a){this.closeBoxExpansionCompletePopup(),this._shopBoxExpansionPopup=cc.instantiate(this.shopBoxExpansionPopupPrefab).getComponent("ShopBoxExpansionPopup"),this._shopBoxExpansionPopup.openShopBoxExpansionPopup(t,e,i,a)},closeBoxExpansionCompletePopup:function(){this._shopBoxExpansionPopup&&(this._shopBoxExpansionPopup.close(),this._shopBoxExpansionPopup=null)},openShopItemListDetailPopup:function(t,e,i){this.closeShopItemListDetailPopup(),this._shopItemListDetailPopup=cc.instantiate(this.shopItemListDetailPopupPrefab).getComponent("ShopItemListDetailPopup"),this._shopItemListDetailPopup.openShopItemListDetailPopup(t,e,i)},closeShopItemListDetailPopup:function(){this._shopItemListDetailPopup&&(this._shopItemListDetailPopup.close(),this._shopItemListDetailPopup=null)},openShopSpecifiedCommercePopup:function(){this.closeShopSpecifiedCommercePopup(),this._shopSpecifiedCommercePopup=cc.instantiate(this.shopSpecifiedCommercePopupPrefab).getComponent("ShopSpecifiedCommercePopup"),this._shopSpecifiedCommercePopup.openShopSpecifiedCommercePopup()},closeShopSpecifiedCommercePopup:function(){this._shopSpecifiedCommercePopup&&(this._shopSpecifiedCommercePopup.close(),this._shopSpecifiedCommercePopup=null)},openShopPurchaseConfirmPopup:function(t){this.closeShopPurchaseConfirmPopup(),this._shopPurchaseConfirmPopup=cc.instantiate(this.shopPurchaseConfirmPopupPrefab).getComponent("ShopPurchaseConfirmPopup");var e=l.getUserItemCount(t.shopDetailMaster.getItemId()),i=t.shopDetailMaster.getCostType()===h.ITEM_TYPE.PAID_GEM?this.getUserModel().getPaidGem():this.getUserModel().getGem();this._shopPurchaseConfirmPopup.openShopPurchaseConfirmPopup(t,e,i,1,function(a){this.requestPurchase(t.shopDetailMaster.getShopId(),t.shopDetailMaster.getListId(),a,t.shopDetailMaster.getSkuId(),function(){this.openShopPurchaseCompletePopup(t,e,i,a)}.bind(this))}.bind(this))},closeShopPurchaseConfirmPopup:function(){this._shopPurchaseConfirmPopup&&(this._shopPurchaseConfirmPopup.close(),this._shopPurchaseConfirmPopup=null)},openShopPurchaseCompletePopup:function(t,e,i,a){cc.log(t),this.closeShopPurchaseCompletePopup(),this._shopPurchaseCompletePopup=cc.instantiate(this.shopPurchaseCompletePopupPrefab).getComponent("ShopPurchaseCompletePopup"),this._shopPurchaseCompletePopup.openShopPurchaseCompletePopup(t,e,i,a)},closeShopPurchaseCompletePopup:function(){this._shopPurchaseCompletePopup&&(this._shopPurchaseCompletePopup.close(),this._shopPurchaseCompletePopup=null)},requestPurchase:function(t,e,i,a,o){n.ShopService.purchase(t,e,i,a,function(t){if(t)return this.reload(),this.redraw(),o()}.bind(this),function(){r.openCommonPopupOk("\u8cfc\u5165\u30a8\u30e9\u30fc","\u8cfc\u5165\u51e6\u7406\u304c\u4e2d\u65ad\u3055\u308c\u307e\u3057\u305f\u3002","",!1,function(){},"OK")})},getUserModel:function(){return n.dao.userBasicData},setSelectedShopCategory:function(t){this.selectedShopCategory=parseInt(t)},convertShopCategoryToTab:function(t){for(var e=this.getFilteredShopInfoArray(),i=0;i<e.length;i+=1)if(e[i].shopMainMaster.getCategory()===t)return i;return 0},convertTabToShopCategory:function(t){return this.getFilteredShopInfoArray()[t].shopMainMaster.getCategory()}});cc._RF.pop()},{ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",ShopUtils:"ShopUtils",ShopViewSetting:"ShopViewSetting",Singleton:"Singleton",TimeUtils:"TimeUtils",UserUtils:"UserUtils",ViewUtils:"ViewUtils"}],ShopSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"62c48/AjFxOubtDjmtsnO5h","ShopSelectSubRoot");var a=t("ItemConst"),n=t("CommonButton"),o=t("ShopSelectTabView");cc.Class({extends:cc.Component,properties:{specifiedBtn:n,shopSelectTabView:o,noteNode:cc.Node},_root:null,onLoad:function(){this.specifiedBtn.setTapEvent(this._onTapSpecifiedBtn.bind(this))},initShopSelectSubRoot:function(t,e){this._root=t,this._initShopSelectTabView(t,e)},_initShopSelectTabView:function(t,e){this.shopSelectTabView.initShopSelectTabView(t,t.convertShopCategoryToTab(e),this._setNoteNodeActive.bind(this))},_onTapSpecifiedBtn:function(){this._root.openShopSpecifiedCommercePopup()},_setNoteNodeActive:function(){switch(this._root.selectedShopCategory){case a.SHOP_CATEGORY.CAMPAIGN:case a.SHOP_CATEGORY.GEM:case a.SHOP_CATEGORY.SET:this.noteNode.active=!0;break;default:this.noteNode.active=!1}}});cc._RF.pop()},{CommonButton:"CommonButton",ItemConst:"ItemConst",ShopSelectTabView:"ShopSelectTabView"}],ShopSelectTabView:[function(t,e,i){"use strict";cc._RF.push(e,"708eeXaM+5LaoQM1RQ0SrRR","ShopSelectTabView");var a=t("VariableTabViewBase"),n=t("NoticeBadgeCheckUtils"),o=t("ViewUtils"),r=t("ShopItemListViewBase"),s=t("ItemConst"),c=3,l={POSITION:cc.v2(57,18),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{freeGemLabel:cc.Label,paidGemLabel:cc.Label,shopItemListViewArray:[r]},_root:null,_shopItemActiveListViewArray:null,_setNoteNodeActiveCallback:null,initShopSelectTabView:function(t,e,i){this._root=t,this._setNoteNodeActiveCallback=i,this._initShopItemActiveListViewArray(t),this._setGemLabel();var a=this._createTabButtonArray(t.getFilteredShopInfoArray());this.initVariableTabViewBase(t,a),this._setCurrentTab(e),this._activateTab(this.getCurrentTab())},_initShopItemActiveListViewArray:function(t){this._shopItemActiveListViewArray=[];var e=t.getFilteredShopInfoArray();for(var i in e){var a=s.SHOP_TAB[s.SHOP_CATEGORY[e[i].shopMainMaster.getCategory()]];this._shopItemActiveListViewArray.push(this.shopItemListViewArray[a])}},_setGemLabel:function(){this.freeGemLabel.string=this._root.getUserModel().getFreeGem(),this.paidGemLabel.string=this._root.getUserModel().getPaidGem()},_createTabButtonArray:function(t){if(t.length<=1)return[];for(var e=[],i=0;i<t.length;i+=1){var a=cc.instantiate(this.getTabButtonPrefab(i,t.length)).getComponent("TabButton");a.initTabButton(t[i].shopMainMaster.getShortName(),!0),e.push(a),this.setTabBtn(a,i),this._setNoticeBadge(a.node,t[i])}return e},_setNoticeBadge:function(t,e){switch(e.shopMainMaster.getCategory()){case c:n.hasNewShopItem()&&o.addNoticeBadge(t,l.POSITION,l.SCALE)}},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._root.setSelectedShopCategory(this._root.convertTabToShopCategory(t)),this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t),o.hideNoticeBadge(this.tabBtnArray[t].node)},_switchTabContent:function(t){this._resetListView(),this._shopItemActiveListViewArray[t].initListView(this._root),this._setNoteNodeActiveCallback&&this._setNoteNodeActiveCallback()},_resetListView:function(){for(var t in this.shopItemListViewArray)this.shopItemListViewArray[t].resetListView()}});cc._RF.pop()},{ItemConst:"ItemConst",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",ShopItemListViewBase:"ShopItemListViewBase",VariableTabViewBase:"VariableTabViewBase",ViewUtils:"ViewUtils"}],ShopService:[function(t,e,i){"use strict";cc._RF.push(e,"c6b93uuQ7VKmKpeu1vt6iO9","ShopService");var a=t("BaseService"),n=t("ApiConstants"),o=(t("CommonUtils"),t("LocalDataConst"),t("Singleton")),r=t("SingletonConst");t("ResourceUtils"),cc.Class({extends:a,purchase:function(t,e,i,a,s,c){var l=o[r.ENVIRONMENT];if(0!==a&&l.isDmmPlatform())this._requestPayment(a,i,function(t,e){return t?s(void 0):e?s(e):c()});else{var u={shopId:t,listId:e,count:i};this._requestCallApi(n.SHOP_PURCHASE,u,function(t,e){return s(t?void 0:e)})}},exchange:function(t,e,i,a){var o={exchangeId:t,items:this._createExchangeParam(e,i)};this._requestCallApi(n.SHOP_EXCHANGE,o,function(t,e){return a(t?void 0:e)})},_createExchangeParam:function(t,e){if(t.length!==e.length)return cc.error("\u5f15\u6570\u306e\u914d\u5217\u304c\u4e0d\u6b63\u3067\u3059"),null;for(var i=[],a=0;a<t.length;a+=1)i.push({listId:t[a],count:e[a]});return i}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService",CommonUtils:"CommonUtils",LocalDataConst:"LocalDataConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ShopSetItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"6686bU4dOVN5KW2ty2Q3Kw1","ShopSetItemListView");t("Singleton"),t("ItemUtils");var a=t("ResourceUtils"),n=t("ShopUtils"),o=t("TimeUtils"),r=t("NoticeBadgeCheckUtils"),s=t("CommonUtils"),c=t("ShopItemListViewBase"),l=t("ItemConst"),u=t("LocalDataConst");cc.Class({extends:c,properties:{},initListView:function(t){this._super(t),r.hasNewShopItem()&&s.saveLocalStorage(u.LOCAL_STORAGE_KEY.SHOP_UPDATE_LOOK,Math.floor(.01*parseInt(o.getNowDate())))},_getShopInfo:function(t){return t.getShopInfoByCategory(l.SHOP_CATEGORY.SET)},_addThumbnail:function(t,e){var i=n.getShopItemRemainingCount(t.shopDetailMaster.getListId(),t.shopDetailMaster.getMaxCount(),t.shopDetailMaster.getResetType()),o=cc.instantiate(this.thumbnailPrefab).getComponent("ShopItemThumbnail");l.SHOP_CATEGORY.NORMAL===e.getCategory()?o.setMainMatrixThumbnail(a.getFileNameItemThumbnail(t.shopDetailMaster.getItemId())):o.setMainImage(a.getFileNameShopItemThumbnail(t.shopDetailMaster.getListId())),o.setItemName(t.shopDetailMaster.getName()),o.setCostCount(t.shopDetailMaster.getCostCount()),this._setLimited(o,t.shopDetailMaster.getToDate()),this._setCostImage(o,t.shopDetailMaster.getCostType()),this._setPurchaseProperties(o,t,i),o.setCallbackToInfoBtn(function(){this._onTapInfo(t)}.bind(this)),o.setInfoBtnActive(l.ITEM_TYPE.SET_ITEM===t.shopDetailMaster.getItemType()),this.thumbnailParentNode.addChild(o.node),this._setVipRemainDate(o,i,t)}});cc._RF.pop()},{CommonUtils:"CommonUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",ResourceUtils:"ResourceUtils",ShopItemListViewBase:"ShopItemListViewBase",ShopUtils:"ShopUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],ShopSpecifiedCommercePopup:[function(t,e,i){"use strict";cc._RF.push(e,"966530mtdlHZIZQ4LdCblJv","ShopSpecifiedCommercePopup");var a=t("PopupBase"),n=t("CommonScrollView"),o=t("CommonButton");cc.Class({extends:a,properties:{messegeLabel:cc.Label,commonScrollView:n,okBtn:o},openShopSpecifiedCommercePopup:function(){this.okBtn.setTapEvent(function(){this.close()}.bind(this)),this.messegeLabel.node.active=!1,this.open(function(){this.messegeLabel.node.active=!0,this.commonScrollView.scrollToPercentVertical(1,0,!0)}.bind(this))}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",PopupBase:"PopupBase"}],ShopTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"56664p7TgpN+bMMxxg6W64s","ShopTopSubRoot");var a=t("CommonScrollView"),n=t("Singleton"),o=t("ResourceUtils"),r=(t("DeckUtils"),t("ViewUtils")),s=t("PictureBookUtils"),c=t("CharacterUtils"),l=t("ShopUtils"),u=(t("GameConst"),t("ItemConst")),h=t("CharacterConst"),d=(t("LocalDataConst"),t("PopupUtils"));cc.Class({extends:cc.Component,properties:{characterSprite:cc.Sprite,balloonParentNode:cc.Node,freeGemLabel:cc.Label,paidGemLabel:cc.Label,shopScrollView:a,shopTopThumbnailPrefab:cc.Prefab},_root:null,initShopTopSubRoot:function(t){this._root=t,this._initSerif(),this.redraw()},redraw:function(){this._setGemLabel(),this._setTopThumbnail()},_setGemLabel:function(){this.freeGemLabel.string=n.dao.userBasicData.getFreeGem(),this.paidGemLabel.string=n.dao.userBasicData.getPaidGem()},_initSerif:function(){var t=this._root.getNavigatorCharacterId();this._setSprite(this.characterSprite,t),this._serifBalloon||(this._serifBalloon=r.createSerifWindow(),this.balloonParentNode.addChild(this._serifBalloon.node)),this._reloadSerifBalloon(t)},_setSprite:function(t,e){o.addSprite(t,o.getFileNameCharacterStand(e))},_reloadSerifBalloon:function(t){var e=[],i=[],a=c.getCharacterMainModelByCharacterId(t);s.getCharacterTextModelListBySceneType(a.getCharacterId(),h.TEXT_SCENE_TYPE.SHOP).forEach(function(t){e.push(t.getText()),i.push(t.getVoiceFile())}),this._serifBalloon.setSerifContent(a.getCharacterId(),a.getShortName(),e,i),this._serifBalloon.playRandomSerifAnimation()},_setTopThumbnail:function(){this.shopScrollView.content.destroyAllChildren();for(var t=this._root.getShopInfoArray(),e=0;e<t.length;e+=1){var i=this._getShopRemaining(t[e]),a=cc.instantiate(this.shopTopThumbnailPrefab).getComponent("ShopTopThumbnail");a.initShopTopThumbnail(t[e],i.date,i.count,this._getTopThumbnailEvent(t[e])),this.shopScrollView.content.addChild(a.node)}},_getShopRemaining:function(t){cc.log("shopInfo",t);var e={count:0,date:""};switch(t.shopMainMaster.getCategory()){case u.SHOP_CATEGORY.BOX:e.count=l.getShopItemRemainingCount(t.shopDetailInfoArray[0].shopDetailMaster.getListId(),t.shopDetailInfoArray[0].shopDetailMaster.getMaxCount(),t.shopDetailInfoArray[0].shopDetailMaster.getResetType());break;default:t.shopMainMaster.getToDate()&&(e.date=t.shopMainMaster.getToDate())}return e},_getTopThumbnailEvent:function(t){var e=n.dao.userBasicData;switch(t.shopMainMaster.getCategory()){case u.SHOP_CATEGORY.BOX:return function(){e.getGem()>=t.shopDetailInfoArray[0].shopDetailMaster.getCostCount()?this._getBoxExpansionConfirmEvent(t,e):d.openCommonPopupYesNo("","\u5e7b\u5922\u77f3\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b7\u30e7\u30c3\u30d7\u3067\u8cfc\u5165\u3057\u307e\u3059\u304b\uff1f","",!1,function(){this._root.pushShopSelectSubRoot(u.SHOP_CATEGORY.GEM,{ShopTopSubRoot:{}})}.bind(this),function(){},"\u5b9f\u884c","\u30ad\u30e3\u30f3\u30bb\u30eb")}.bind(this);default:return function(){this._getShopSelectPushEvent(t,e)}.bind(this)}},_getBoxExpansionConfirmEvent:function(t,e){this._root.openBoxExpansionConfirmPopup(t,e,function(){this._getBoxExpansionPurchaseEvent(t,e)}.bind(this))},_getShopSelectPushEvent:function(t,e){this._root.pushShopSelectSubRoot(t.shopMainMaster.getCategory(),{ShopTopSubRoot:{}})},_getBoxExpansionPurchaseEvent:function(t,e){this._root.requestPurchase(t.shopDetailInfoArray[0].shopDetailMaster.getShopId(),t.shopDetailInfoArray[0].shopDetailMaster.getListId(),1,t.shopDetailInfoArray[0].shopDetailMaster.getSkuId(),function(){this._root.openBoxExpansionPopup(t,e,function(){this._root.redrawUIHeader(),this.redraw()}.bind(this))}.bind(this))}}),cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonScrollView:"CommonScrollView",DeckUtils:"DeckUtils",GameConst:"GameConst",ItemConst:"ItemConst",LocalDataConst:"LocalDataConst",PictureBookUtils:"PictureBookUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",ShopUtils:"ShopUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],ShopTopThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"d540aRm+BRLtJZBuUEXSZ99","ShopTopThumbnail");var a=t("ResourceUtils"),n=t("TimeUtils"),o=t("CommonButton");cc.Class({extends:cc.Component,properties:{topNameLabel:cc.Label,topSprite:cc.Sprite,remainingDateLabel:cc.Label,remainingDateBaseNode:cc.Node,remainingCountLabel:cc.Label,remainingCountBaseNode:cc.Node,thumbnailBtn:o},initShopTopThumbnail:function(t,e,i,n){this.topNameLabel.string=t.shopMainMaster.getName(),a.addSprite(this.topSprite,a.getFileNameShopTopThumbnail(t.shopMainMaster.getShopId())),this.thumbnailBtn.setTapEvent(n),this.remainingDateBaseNode.active=!1,e&&(this.remainingDateLabel.string=this._getRemainingDate(e),this.remainingDateBaseNode.active=!0),this.remainingCountBaseNode.active=!1,i&&(this.remainingCountLabel.string=""+i,this.remainingCountBaseNode.active=!0)},_getRemainingDate:function(t){var e="{year}\u5e74{month}\u6708{date}\u65e5 {hour}:{minute}\u307e\u3067",i=n.parseToYmdhmsMap(t);return e=(e=(e=(e=(e=e.replace("{year}",i.year)).replace("{month}",i.month)).replace("{date}",i.date)).replace("{hour}",i.hour)).replace("{minute}",i.minute)}}),cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils",TimeUtils:"TimeUtils"}],ShopUtils:[function(t,e,i){"use strict";cc._RF.push(e,"507dd/c9hVC+IcxOwRfEJ67","ShopUtils");var a=t("Singleton"),n=t("CommonUtils"),o=(t("ItemUtils"),t("TimeUtils")),r=t("ItemConst"),s=t("HistoryUtils"),c=null;function l(){c=[];var t=a.dao.ShopMainMasters.filter(function(t){return o.isRangeOfDate(t.getFromDate(),t.getToDate())}),e=a.dao.ShopDetailMasters,i=[];return i.push({getterName:"getOrder"}),c=t.map(function(t){var a=n.sortModels(e.filter(function(e){return t.getShopId()===e.getShopId()&&o.isRangeOfDate(e.getFromDate(),e.getToDate())}),i);return T(t,u(a))})}function u(t){for(var e=[],i=0;i<t.length;i+=1)e.push({shopDetailMaster:t[i],shopItemInfoArray:h(t[i])});return e}function h(t){var e=[];return t.getNormalBonus()>0&&e.push(p(r.ITEM_TYPE.FREE_GEM,r.GEM_ITEM_ID.FREE,t.getNormalBonus(),t.getName())),t.getFirstBonus()>0&&e.push(m(r.ITEM_TYPE.FREE_GEM,r.GEM_ITEM_ID.FREE,t.getNormalBonus(),t.getName())),Array.prototype.push.apply(e,d(t.getItemType(),t.getItemId(),t.getCount())),_.compact(e)}function d(t,e,i){var a=[];switch(t){case r.ITEM_TYPE.CHARACTER:a.push(g(t,e,i));break;case r.ITEM_TYPE.EQUIPMENT:a.push(C(t,e,i));break;case r.ITEM_TYPE.FURNITURE:a.push(f(t,e,i));break;case r.ITEM_TYPE.CHARA_POSSESSION_BORDER:case r.ITEM_TYPE.EQUIPMENT_POSSESSION_BORDER:break;default:a.push(E(t,e,i))}return a}function p(t,e,i,n){var o=_.find(a.dao.ItemMainMasters,function(t){return t.getItemId()===e});return{itemType:t,itemId:e,name:o.getName(),text:n+"\u306e\u304a\u307e\u3051\u3067\u3059\u3002",count:i}}function m(t,e,i,n){var o=_.find(a.dao.ItemMainMasters,function(t){return t.getItemId()===e});return{itemType:t,itemId:e,name:o.getName(),text:n+"\u306e\u521d\u56de\u304a\u307e\u3051\u3067\u3059\u3002",count:i}}function g(t,e,i){var n=_.find(a.dao.CharacterMainMasters,function(t){return t.getCharacterId()===e});if(n){var o=n.getSkinName()?"["+n.getSkinName()+"]":"";return{itemType:t,itemId:e,name:n.getName()+o,text:n.getShortText(),count:i}}}function C(t,e,i){var n=_.find(a.dao.EquipmentMainMasters,function(t){return t.getEquipmentId()===e});if(n)return{itemType:t,itemId:e,name:n.getName(),text:n.getText(),count:i}}function f(t,e,i){var n=_.find(a.dao.FurnitureMainMasters,function(t){return t.getFurnitureId()===e});if(n)return{itemType:t,itemId:e,name:n.getName(),text:n.getDescription(),count:i}}function E(t,e,i){var n=_.find(a.dao.ItemMainMasters,function(t){return t.getItemId()===e});if(n)return{itemType:t,itemId:e,name:n.getName(),text:n.getText(),count:i}}function T(t,e){return{shopMainMaster:t,shopDetailInfoArray:e}}function S(t){switch(t){case r.ITEM_TYPE.FREE_GEM:return a.dao[a.USER].getGem();default:return 0}}function R(t,e){var i=0;if(0===e)return r.SHOP_ITEM_STOCK_COUNT_MAX;var n=a.dao.userPurchaseHistories;i=e;for(var o=0;o<n.length;o++)t===n[o].getListId()&&(i=e-n[o].getReplenishmentDaysQuantity());return i}e.exports={getShopInfoArray:function(){return c||(c=l()),c},createItemShopItemInfo:E,createShopItemInfoByItemType:function(t,e,i){switch(t){case r.ITEM_TYPE.CHARACTER:return g(t,e,i);case r.ITEM_TYPE.EQUIPMENT:return C(t,e,i);case r.ITEM_TYPE.FURNITURE:return f(t,e,i);case r.ITEM_TYPE.CHARA_POSSESSION_BORDER:case r.ITEM_TYPE.EQUIPMENT_POSSESSION_BORDER:break;default:return E(t,e,i)}},isEnoughCost:function(t){switch(t.getCostType()){case r.ITEM_TYPE.DMM_POINT:return!0}return S(t.getCostType())-t.getCostCount()>=0},getShopItemRemainingCount:function(t,e,i){switch(i){case r.SHOP_RESET_TYPE.DAYS:return s.getRemainingCountOfToday("shop",t,e);case r.SHOP_RESET_TYPE.MONTH:return s.getRemainingCountOfMonth("shop",t,e);case r.SHOP_RESET_TYPE.REPLENISHMENT_DAYS:case r.SHOP_RESET_TYPE.REPLENISHMENT_LOGIN_DAYS:return R(t,e);default:return s.getRemainingCount("shop",t,e)}},getShopDetailMasterByItemId:function(t,e){if(!(t<=0&&e<=0)){var i=_.filter(a.dao.ShopDetailMasters,function(t){return o.isRangeOfDate(t.getFromDate(),t.getToDate())});return _.find(i,function(i){return(t<=0||i.getItemType()===t)&&(e<=0||i.getItemId()===e)})}}},cc._RF.pop()},{CommonUtils:"CommonUtils",HistoryUtils:"HistoryUtils",ItemConst:"ItemConst",ItemUtils:"ItemUtils",Singleton:"Singleton",TimeUtils:"TimeUtils"}],ShopViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"70418tMl0hPcpKIj2CxQurk","ShopViewSetting");var a=t("ShopRootUtils");e.exports={SHOP_SETTING:{ShopTopSubRoot:{open:a.openShopTopSubRoot,close:a.closeShopTopSubRoot},ShopSelectSubRoot:{open:a.openShopSelectSubRoot,close:a.closeShopSelectSubRoot}}},cc._RF.pop()},{ShopRootUtils:"ShopRootUtils"}],SimpleMessagePopup:[function(t,e,i){"use strict";cc._RF.push(e,"32b0bXtCJxH4psidnE596hO","SimpleMessagePopup");var a=t("PopupBase"),n=t("GameConst");cc.Class({extends:a,properties:{messageLabel:cc.Label},openSimpleMessagePopup:function(t,e,i){this.node.opacity=0,this.messageLabel.string=t,this._addGrayBack(this.node,-1),i?this._addUniqueWindow(i):this._addWindow(),this.setCloseCallBack(e),this.node.runAction(cc.sequence(cc.fadeIn(.3),cc.delayTime(1),cc.callFunc(function(){this.close()},this)))},_addUniqueWindow:function(t){this.node.name=t,this._setNodeGroup(this.node);var e=this._bSystemPopup?n.Z_ORDER.SYSTEM_POPUP:n.Z_ORDER.POPUP;cc.director.getScene().getChildByName("Canvas").addChild(this.node,e)},close:function(){this.node.stopAllActions(),this.node.runAction(cc.sequence(cc.fadeOut(.3),cc.callFunc(function(){this._closePopupBase()}.bind(this),this)))}});cc._RF.pop()},{GameConst:"GameConst",PopupBase:"PopupBase"}],SimpleNoticeWithClearGaugeView:[function(t,e,i){"use strict";cc._RF.push(e,"034e2VIpshL9LShDE1jkqpB","SimpleNoticeWithClearGaugeView");var a=t("NoticeViewBase"),n=t("Singleton"),o=(t("MatrixThumbnail"),t("AnimationEventComponent")),r=(t("CommonUtils"),t("ResourceUtils")),s=(t("ItemUtils"),t("StaticResourceConst"));cc.Class({extends:a,properties:{noticeTextLabel:cc.Label,clearAnimation:cc.Animation,vibrationAnimation:cc.Animation,progressBar:cc.ProgressBar,progressBaseNumLabel:cc.Label,progressMaxNumLabel:cc.Label},_beforeProgressNum:0,_afterProgressNum:0,_addProgressNum:0,_maxProgressNum:0,_updateGaugeAnimFlag:!1,_clearCallback:null,_sumDt:0,_initNoticeView:function(){this._updateGaugeAnimFlag=!1,this.noticeTextLabel.string=this._noticeData.message,this._beforeProgressNum=parseInt(this._noticeData.beforePoint),this._afterProgressNum=parseInt(this._noticeData.afterPoint),this._addProgressNum=this._afterProgressNum-this._beforeProgressNum,this._maxProgressNum=parseInt(this._noticeData.maxPoint),this._sumDt=0,this._clearCallback=this._noticeData.clearCallback,this.progressBaseNumLabel.string=this._beforeProgressNum,this.progressMaxNumLabel.string=this._maxProgressNum,this.progressBar.progress=this._beforeProgressNum/this._maxProgressNum},_displayNoticeViewAction:function(t){this._nextCallback=t,this._updateGaugeAnimFlag=!0},_clearAnimAction:function(t){var e=this;if((cc.director.isPaused()||!this.clearAnimation)&&t)return t();var i=[];i.push(cc.delayTime(e.displayTime-2*this.clearAnimation.getClips()[0].duration)),i.push(cc.callFunc(function(){if(this._clearCallback&&this._clearCallback(),t)return t()},this)),this.node.runAction(cc.sequence(i));var a=this.vibrationAnimation.play.bind(this.vibrationAnimation);this.clearAnimation.node.addComponent(o).setAnimationEvent("Clear_Anim",[a],[null]),this.clearAnimation.once("finished",function(){e.node.runAction(cc.sequence(i))},this),this.node.runAction(cc.sequence(cc.delayTime(.5*this.clearAnimation.getClips()[0].duration),cc.callFunc(function(){n.soundManager.playSE(r.getResource(s.SE.STAMP),!1)},this))),this.clearAnimation.play(this.clearAnimation.getClips()[0].name)},_noticeAction:function(t){var e=[];e.push(cc.delayTime(this.displayTime)),e.push(cc.callFunc(function(){if(t)return t()},this)),this.node.runAction(cc.sequence(e))},update:function(t){if(this._updateGaugeAnimFlag){var e=!1;this._addProgressNum>0&&(this._sumDt+=t),this._sumDt>=1&&(this._sumDt=1,e=!0);var i=this._addProgressNum*(this._sumDt/1),a=this._beforeProgressNum+i;a>=this._maxProgressNum&&(a=this._afterProgressNum),this.progressBaseNumLabel.string=parseInt(a),this.progressBar.progress=a/this._maxProgressNum,e&&(this._updateGaugeAnimFlag=!1,this._maxProgressNum===a?this._clearAnimAction(this._nextCallback.bind(this)):this._noticeAction(this._nextCallback.bind(this)))}}}),cc._RF.pop()},{AnimationEventComponent:"AnimationEventComponent",CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",MatrixThumbnail:"MatrixThumbnail",NoticeViewBase:"NoticeViewBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],SimpleNoticeWithClearStampView:[function(t,e,i){"use strict";cc._RF.push(e,"c7c6d52/pFDtZwRikIHhrog","SimpleNoticeWithClearStampView");var a=t("NoticeViewBase"),n=t("Singleton"),o=(t("MatrixThumbnail"),t("AnimationEventComponent")),r=(t("CommonUtils"),t("ResourceUtils")),s=(t("ItemUtils"),t("StaticResourceConst"));cc.Class({extends:a,properties:{noticeTextLabel:cc.Label,clearAnimation:cc.Animation,vibrationAnimation:cc.Animation},_initNoticeView:function(){this.noticeTextLabel.string=this._noticeData.message},_displayNoticeViewAction:function(t){this._noticeData.isClear?this._clearAnimAction(t):this._noticeAction(t)},_clearAnimAction:function(t){var e=this;if((cc.director.isPaused()||!this.clearAnimation)&&t)return t();var i=[];i.push(cc.delayTime(e.displayTime-2*this.clearAnimation.getClips()[0].duration)),i.push(cc.callFunc(function(){if(t)return t()},this)),this.node.runAction(cc.sequence(i));var a=this.vibrationAnimation.play.bind(this.vibrationAnimation);this.clearAnimation.node.addComponent(o).setAnimationEvent("Clear_Anim",[a],[null]),this.clearAnimation.once("finished",function(){e.node.runAction(cc.sequence(i))},this),this.node.runAction(cc.sequence(cc.delayTime(.5*this.clearAnimation.getClips()[0].duration),cc.callFunc(function(){n.soundManager.playSE(r.getResource(s.SE.STAMP),!1)},this))),this.clearAnimation.play(this.clearAnimation.getClips()[0].name)},_noticeAction:function(t){var e=[];e.push(cc.delayTime(this.displayTime)),e.push(cc.callFunc(function(){if(t)return t()},this)),this.node.runAction(cc.sequence(e))}});cc._RF.pop()},{AnimationEventComponent:"AnimationEventComponent",CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",MatrixThumbnail:"MatrixThumbnail",NoticeViewBase:"NoticeViewBase",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst"}],SimplePopup:[function(t,e,i){"use strict";cc._RF.push(e,"49a62OxYKdJ9KAimi/k33um","SimplePopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{closeBtn:n,executeBtn:n},_callback:null,onLoad:function(){this.closeBtn&&this.closeBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.executeBtn&&this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},openSimplePopup:function(t){this._callback=t,this.open()},_onTapExecuteBtn:function(){this._callback(),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],SimplePrefabArrowView:[function(t,e,i){"use strict";cc._RF.push(e,"40f6eKgDkZDionJmDj2hmSG","SimplePrefabArrowView");var a=t("SimplePrefabViewBase"),n=t("StaticResourceConst");cc.Class({extends:a,onLoad:function(){this._addPrefabNode(n.ARROW_PREFAB_PATH)}});cc._RF.pop()},{SimplePrefabViewBase:"SimplePrefabViewBase",StaticResourceConst:"StaticResourceConst"}],SimplePrefabViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"b93bcvKZShIj5USvYPcRz2A","SimplePrefabViewBase");var a=t("ResourceUtils");cc.Class({extends:cc.Component,_addPrefabNode:function(t){this.node.addChild(cc.instantiate(a.getResource(t)))}});cc._RF.pop()},{ResourceUtils:"ResourceUtils"}],SimpleThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"1595ewZOIpATITBF4RLmvIO","SimpleThumbnail");cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,countLabel:cc.Label},initSimpleThumbnail:function(t,e){this.nameLabel.string=t,this.countLabel.string="x"+e}});cc._RF.pop()},{}],SingletonConst:[function(t,e,i){"use strict";cc._RF.push(e,"30994D0E5FCL5GQz5dg4t46","SingletonConst"),e.exports={ENVIRONMENT:"Environment",OAUTH:"oauth",SCHEDULER:"scheduler",ERROR_MANAGER:"ErrorManager",NOTICE_MANAGER:"NoticeManager",SERVICE_MANAGER:"ServiceManger",SERVICE_AUTH:"AuthService",SERVICE_USER:"UserService",SERVICE_CHARACTER:"CharacterService",SERVICE_EQUIPMENT:"EquipmentService",SERVICE_ITEM:"ItemService",DAO:"DAO"},cc._RF.pop()},{}],Singleton:[function(t,e,i){"use strict";cc._RF.push(e,"ffc5cwwyFxBdbWfVtSFl018","Singleton");var a=t("UserDataLoadSettings");e.exports={dao:{},res:{},staticRes:{},localData:{},soundManager:null,loadingRes:{},fileLoaderManager:null,generateMd5:null,downManifestManager:null,memoryManager:null,persistNode:null,USER_CHARACTER:a.CHARACTER[0].name,USER_DECK:a.DECK[0].name,USER_EQUIPMENT:a.EQUIPMENT[0].name,USER_ITEM:a.ITEM[0].name,USER_QUEST:a.QUEST[0].name,USER:a.USER[0].name},cc._RF.pop()},{UserDataLoadSettings:"UserDataLoadSettings"}],SkillAbilitySimplePopup:[function(t,e,i){"use strict";cc._RF.push(e,"4272e0A035F6JQvIPQlq+zz","SkillAbilitySimplePopup");var a=t("PopupBase"),n=(t("ResourceUtils"),t("CommonUtils")),o=t("GameConst");cc.Class({extends:a,properties:{skillDispNode:cc.Node,abilityDispNode:cc.Node,nameLabel:cc.Label,levelLabel:cc.Label,descriptionLabel:cc.Label},openSkillSimplePopup:function(t,e,i){this._openSkillAbilitySimplePopup(e,i),this.skillDispNode.active=!0,this.abilityDispNode.active=!1,this.nameLabel.string=t.skillMainMaster.getName(),this.levelLabel.string="Lv."+t.skillLevel,this.descriptionLabel.string=t.skillText,this.open()},openAbilitySimplePopup:function(t,e,i){this._openSkillAbilitySimplePopup(e,i),this.skillDispNode.active=!1,this.abilityDispNode.active=!0,this.nameLabel.string=t.abilityMainMaster.getName(),this.levelLabel.string="Lv."+t.abilityLevel,this.descriptionLabel.string=t.abilityText,this.open()},_openSkillAbilitySimplePopup:function(t,e){var i=t.convertToWorldSpaceAR(cc.v2(0,0)),a=n.getRoot().node.convertToNodeSpaceAR(i);(t=cc.instantiate(t)).setPosition(a),t.zIndex=o.Z_ORDER.POPUP,n.getRoot().node.addChild(t),this.node.setPosition(cc.v2(t.x+e.x,t.y+e.y)),this.setCloseCallBack(function(){t.destroy()})}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils"}],SkillController:[function(t,e,i){"use strict";cc._RF.push(e,"9fce7eVwhlGKJiGQAmDrOTm","SkillController");var a=t("BattleData"),n=(t("CommonFunction"),t("EnumTypes")),o=t("GameEffectQueue").GameEffectQueue,r=t("GameEffectQueue").EffectQuery,s=t("GameEffectQueue").EffectData,c=t("BattleFunction"),l=cc.Class({properties:{},checkEachAction:function(t,e){var i=a.GM.actionController;if(i.checkInvoke(e)){var l,u,h=t.attacker,d=h.mySkill,p=new r;l=c.getUnitList(h.isEnemy),u=c.getUnitList(!h.isEnemy);var m=c.getTargetList(e.getTargetType(),e,h,l,u);for(var _ in m){var g=m[_],C=new o,f=new Map,E=1e3*d.getSkillId()+e.getIndex();i.excuteSubAction(C,e,h,g,E,n.BuffClass.SKILL),f.effectQueue=C,p.addAction(new s(f,i.playEffectqueue.bind(i)))}i.addQueryToWaitQueryList(p)}}});e.exports=l,cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",CommonFunction:"CommonFunction",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue"}],SkillCutinMessageView:[function(t,e,i){"use strict";cc._RF.push(e,"cad3cMyQhNK5b4+YfzK9xbw","SkillCutinMessageView");cc.Class({extends:cc.Component,properties:{labelMessage:cc.Label},init:function(t){this.labelMessage.string=t}});cc._RF.pop()},{}],SkillCutinView:[function(t,e,i){"use strict";cc._RF.push(e,"85b46Zk9ZNNLIFOi35+4gd6","SkillCutinView");cc.Class({extends:cc.Component,properties:{labelCharacterName:cc.Label,labelSkillName:cc.Label},init:function(t,e){this.labelCharacterName.string=t,this.labelSkillName.string=e}});cc._RF.pop()},{}],SkipDetailPopup:[function(t,e,i){"use strict";cc._RF.push(e,"72873y0o6pFjYdYb6zH/jux","SkipDetailPopup");var a=t("PopupBase"),n=t("Singleton"),o=t("CommonButton"),r=t("CommonCountView"),s=t("ItemConst"),c=t("QuestUtils"),l=t("CampaignUtils");cc.Class({extends:a,properties:{nameLabel:cc.Label,descriptionLabel:cc.Label,costNum:cc.Label,consumeApBaseNum:cc.Label,consumeApAfterNum:cc.Label,consumeTicketBaseNum:cc.Label,consumeTicketAfterNum:cc.Label,countViewSpace:r,cancelBtn:o,decisionBtn:o},_root:null,_questModel:null,_ticketNum:null,_haveTicketNum:null,_skipLimitNum:0,_skipMaxCount:0,openSkipDetailPopup:function(t,e){this._root=t,this._questModel=e,this._ticketNum=1;var i=n.dao.userItems.find(function(t){return t.getItemId()===s.NORMAL_QUEST_SKIP_TICKET});this._haveTicketNum=i.getCount();var a=l.getMaxDayPlayCount(this._questModel.getQuestStageMaster(),!0),r=this._questModel.getTodaySkipCount();this._skipLimitNum=a-r,this._setParameter(e),this.cancelBtn.setTapEvent(this._closeBtnEvent.bind(this),o.SE_NAME.CANCEL),this.decisionBtn.setTapEvent(this._onTapDecisionBtn.bind(this)),this.open()},_setParameter:function(t){this.nameLabel.string=t.getStageName();var e=t.getStamina(),i=c.getCampaignAPValueByStageId(t.getQuestStageMaster().getStageId());i&&(e=Math.ceil(e*i/1e3)),this.costNum.string=e;var a=n.dao[n.USER].getCurrentStaminaInfo().currentStamina;this.consumeApBaseNum.string=a,this.consumeTicketBaseNum.string=this._haveTicketNum;var o=Math.max(1,e),r=(a-a%o)/o;this._skipMaxCount=Math.min(this._skipLimitNum,this._haveTicketNum,r),this.countViewSpace.initCommonCountView(this.redraw.bind(this),1,this._skipMaxCount),this._ticketNum=this.countViewSpace.getCountNum(),this._updateReductionAfter(),this._updateConsumptionAfter()},redraw:function(){this._ticketNum=this.countViewSpace.getCountNum(),this._updateReductionAfter(),this._updateConsumptionAfter()},_onTapDecisionBtn:function(){this.decisionBtn.setTouchEnable(!1);var t=this._questModel.userData._data.stageId;this._root.skipBattle(t,this._ticketNum,function(t,e,i){this._root.redrawUIHeader(),this._root.openQuestSkipResultPopup(t,e,i),this.close()}.bind(this,t,this._ticketNum))},_closeBtnEvent:function(){this.close()},_updateReductionAfter:function(){var t=this.costNum.string*this._ticketNum,e=this.consumeApBaseNum.string-t;this.consumeApAfterNum.string=e},_updateConsumptionAfter:function(){var t=this.consumeTicketBaseNum.string-this._ticketNum;this.consumeTicketAfterNum.string=t}});cc._RF.pop()},{CampaignUtils:"CampaignUtils",CommonButton:"CommonButton",CommonCountView:"CommonCountView",ItemConst:"ItemConst",PopupBase:"PopupBase",QuestUtils:"QuestUtils",Singleton:"Singleton"}],SortButton:[function(t,e,i){"use strict";cc._RF.push(e,"b80a75rw7VIWIB3fxBVE0OL","SortButton");var a=t("CommonButton"),n=cc.Enum({ASC:180,DESC:0});cc.Class({extends:a,properties:{sortTypeLabel:cc.Label,sortOrderBtn:a},_sortType:0,_sortOrder:!1,_filterCheckList:0,_callbackToConvertSortLabel:null,_callbackToSetSortOrder:null,_callbackToOpenPopup:null,_callbackToExecuteSortFilter:null,onLoad:function(){this.setTapEvent(this._openButtonEvent.bind(this)),this.sortOrderBtn.setTapEvent(this._sortOrderBtnEvent.bind(this))},initSortButton:function(t,e,i,a,n,o,r){this._callbackToConvertSortLabel=a,this._callbackToSetSortOrder=n,this._callbackToOpenPopup=o,this._callbackToExecuteSortFilter=r,this.setSortType(t),this._setSortOrder(e),this.setFilterChecklist(i)},setSortType:function(t){this._sortType=t,this._callbackToConvertSortLabel?this.sortTypeLabel.string=this._callbackToConvertSortLabel(t):this.sortTypeLabel.string=""},_setSortOrder:function(t){this._sortOrder=t,this._callbackToSetSortOrder&&this._callbackToSetSortOrder(t),this.sortOrderBtn.node.angle=t?n.ASC:n.DESC},setFilterChecklist:function(t){this._filterCheckList=t},_openButtonEvent:function(){this._callbackToOpenPopup&&this._callbackToOpenPopup(this._sortType,this._filterCheckList)},_sortOrderBtnEvent:function(){this._setSortOrder(!this._sortOrder),this._callbackToExecuteSortFilter&&this._callbackToExecuteSortFilter(this._sortType,this._filterCheckList)}}),cc._RF.pop()},{CommonButton:"CommonButton"}],SortFilterPopup:[function(t,e,i){"use strict";cc._RF.push(e,"e9c12bmFUxCIoYMCMIUjpYT","SortFilterPopup");var a=t("PopupBase"),n=t("CommonButton"),o=(t("Singleton"),t("LocalDataConst"),t("SortFilterTabView"));cc.Class({extends:a,properties:{sortOkBtn:n,cancelBtn:n,filterOkBtn:n,checkAllBtn:n,clearAllBtn:n,tabView:o,checkBoxToggleArray:[cc.Toggle],toggleContainer:cc.ToggleContainer},openSortFilterPopup:function(t,e,i,a){this._initSortFilterPopup(t,e,i,a),this.open()},_initSortFilterPopup:function(t,e,i,a){this.tabView.initSortFilterTabView(),this._setSortType(t),this._setFilter(e),this._initButtons(i,a)},_setSortType:function(t){this.toggleContainer.allowSwitchOff=!0;for(var e=0;e<this.toggleContainer.toggleItems.length;e++)this.toggleContainer.toggleItems[e].isChecked=!1;this.toggleContainer.toggleItems[t].isChecked=!0,this.toggleContainer.allowSwitchOff=!1},_setFilter:function(t){for(var e=0;e<this.checkBoxToggleArray.length;e++)this.checkBoxToggleArray[e].isChecked=t[e]},_initButtons:function(t,e){this.setCallbackToOkBtn(t),this.setCloseCallBack(e),this.sortOkBtn.setTapEvent(this._okBtnEvent.bind(this)),this.filterOkBtn.setTapEvent(this._okBtnEvent.bind(this)),this.cancelBtn&&this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL),this.checkAllBtn.setTapEvent(function(){for(var t=0;t<this.checkBoxToggleArray.length;t++)this.checkBoxToggleArray[t].isChecked=!0}.bind(this)),this.clearAllBtn.setTapEvent(function(){for(var t=0;t<this.checkBoxToggleArray.length;t++)this.checkBoxToggleArray[t].isChecked=!1}.bind(this),n.SE_NAME.CANCEL)},_okBtnEvent:function(){this._callbackToOkBtn&&this._callbackToOkBtn(this.getSelectedIndex(),this.getCheckList()),this.close()},getSelectedIndex:function(){for(var t=0,e=0;e<this.toggleContainer.toggleItems.length;e++){if(this.toggleContainer.toggleItems[e].isChecked){t=e;break}}return t},getCheckList:function(){for(var t=[],e=0;e<this.checkBoxToggleArray.length;e++)t[e]=this.checkBoxToggleArray[e].isChecked;return t},setCallbackToOkBtn:function(t){this._callbackToOkBtn=t}});cc._RF.pop()},{CommonButton:"CommonButton",LocalDataConst:"LocalDataConst",PopupBase:"PopupBase",Singleton:"Singleton",SortFilterTabView:"SortFilterTabView"}],SortFilterTabView:[function(t,e,i){"use strict";cc._RF.push(e,"5ac39SmSIlHrbiJiCkjY2jA","SortFilterTabView");var a=t("TabViewBase");cc.Class({extends:a,properties:{tabContentNodeArray:[cc.Node]},initSortFilterTabView:function(){this.initTabViewBase(!0),this._activateTab(0)},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_resetTabContent:function(){for(var t=0;t<this.tabContentNodeArray.length;t++)this.tabContentNodeArray[t].active=!1},_switchTabContent:function(t){this._resetTabContent(),this.tabContentNodeArray[t].active=!0}});cc._RF.pop()},{TabViewBase:"TabViewBase"}],SoundManager:[function(t,e,i){"use strict";cc._RF.push(e,"067f5oiMjVNdZ5w8psjqUaG","SoundManager");var a=t("Singleton"),n=(t("CommonUtils"),cc.Class({properties:{bgmVolume:.3,seVolume:1,voiceVolume:1,soundMute:!1,curBGM_id:-1,curVoice_id:-1,playingBGM:null,bgmFadeDelayTime:.01,bgmMute:!1,seMute:!1,voiceMute:!1,curplay_loopSE_list:null,curplay_skillSE_list:null},statics:{instance:null},_bgmFadeVolume:null,_bgmVolumeDeltaCount:null,_bgmFadeRepeatAction:null,ctor:function(){n.instance=this,this.curplay_loopSE_list=new Array,this.curplay_skillSE_list=new Array},init:function(){var t=a.dao.userBasicData;t?(this.bgmVolume=Math.max(Math.min(t.getBgmVolume(),1),0),this.seVolume=Math.max(Math.min(t.getSeVolume(),1),0),this.voiceVolume=Math.max(Math.min(t.getVoiceVolume(),1),0),this.voiceMute=t.getIsVoiceMute(),this.seMute=t.getIsSeMute(),this.bgmMute=t.getIsBgmMute()):(this.bgmVolume=.5,this.seVolume=.5,this.voiceVolume=.5,this.voiceMute=!1,this.seMute=!1,this.bgmMute=!1),this._bgmFadeVolume=1,this._bgmVolumeDeltaCount=0,this._bgmFadeRepeatAction=null},playBGM:function(t){t&&(this.playingBGM=t,0==this.soundMute&&0==this.bgmMute&&(-1!=this.curBGM_id&&cc.audioEngine.stop(this.curBGM_id),this.curBGM_id=cc.audioEngine.play(t,!0,this.bgmVolume*this._bgmFadeVolume),this.setBGMVol(this.bgmVolume)))},playSE:function(t,e,i){if(t&&0==this.soundMute&&0==this.seMute&&0!=this.seVolume){var a=!!e,n=cc.audioEngine.play(t,a,this.seVolume);return a&&this.curplay_loopSE_list.push(n),i&&cc.audioEngine.setFinishCallback(n,i),n}},setMute:function(t){this.setBgmMute(t),this.setSeMute(t),this.setVoiceMute(t)},bgmPause:function(){-1!=this.curBGM_id&&cc.audioEngine.pause(this.curBGM_id)},bgmResume:function(){-1!=this.curBGM_id&&cc.audioEngine.resume(this.curBGM_id)},bgmStop:function(t){this.soundMute||this.bgmMute||0==t||void 0==t?-1!=this.curBGM_id&&(cc.director.getScene().getChildByName("Canvas").stopAction(this._bgmFadeRepeatAction),cc.audioEngine.stop(this.curBGM_id)):(this._bgmFadeVolume=-1,this._bgmVolumeDeltaCount=this._bgmFadeVolume*this.bgmFadeDelayTime/t,this._bgmFadeStart())},stopSeId:function(t){cc.audioEngine.stop(t)},stopLoopSe:function(){this.curplay_loopSE_list.forEach(function(t){this.stopSeId(t)}.bind(this)),this.curplay_loopSE_list=new Array},voiceStop:function(){-1!=this.curVoice_id&&cc.audioEngine.stop(this.curVoice_id)},stopAll:function(){cc.audioEngine.stopAll()},playSE_onQuery:function(t,e){if(0==this.soundMute&&0==this.seMute&&0!=this.seVolume){var i=e.get("seFile");this.playSE(i)}t()},playSE_skillSE:function(t){if(cc.log("playSE_skillSE = "),!this.soundMute&&!this.seMute&&0!=this.seVolume){cc.log("playSE_skillSE = "+t);var e=cc.audioEngine.play(t,!1,this.seVolume);this.curplay_skillSE_list.push(e)}},togglePauseInBattle:function(t){for(var e in this.curplay_skillSE_list){var i=this.curplay_skillSE_list[e];t?cc.audioEngine.pause(i):0==this.soundMute&&0==this.seMute&&0!=this.seVolume&&cc.audioEngine.resume(i)}},playVoice:function(t){if(t)return 0==this.soundMute&&0==this.voiceMute&&0!=this.voiceVolume&&(-1!=this.curVoice_id&&cc.audioEngine.stop(this.curVoice_id),this.curVoice_id=cc.audioEngine.play(t,!1,this.voiceVolume)),this.curVoice_id},getPlayingVoiceState:function(){return cc.audioEngine.getState(this.curVoice_id)},continuePlayBGM:function(t,e){if(e=e>0?e:0,this._fadeBgmStop(),this._bgmFadeVolume=1,this._bgmVolumeDeltaCount=e?this._bgmFadeVolume*this.bgmFadeDelayTime/e:0,this._bgmVolumeDeltaCount>0&&(this._bgmFadeVolume=0,this._bgmFadeStart()),t===this.playingBGM){var i=cc.audioEngine.getState(this.curBGM_id);cc.audioEngine.AudioState.PLAYING!==i&&this.playBGM(t)}else cc.audioEngine.stop(this.curBGM_id),this.curBGM_id=cc.audioEngine.play(t,!0,this.bgmVolume*this._bgmFadeVolume),this.setBGMVol(this.bgmVolume),this.playingBGM=t},_bgmFadeStart:function(){var t=cc.director.getScene().getChildByName("Canvas");t.stopAction(this._bgmFadeRepeatAction),this._bgmFadeVolume=this._bgmVolumeDeltaCount>0?0:1,this.setBGMVol(this.bgmVolume);var e=cc.sequence(cc.delayTime(this.bgmFadeDelayTime),cc.callFunc(this._fadeBgmVolume.bind(this)));this._bgmFadeRepeatAction=cc.repeatForever(e),t.runAction(this._bgmFadeRepeatAction)},_fadeBgmVolume:function(){if(this._bgmFadeVolume+=this._bgmVolumeDeltaCount,this._bgmFadeVolume>=1)this._fadeBgmStop();else if(this._bgmFadeVolume<0&&-1!=this.curBGM_id)return this._fadeBgmStop(),void cc.audioEngine.stop(this.curBGM_id);this.setBGMVol(this.bgmVolume)},_fadeBgmStop:function(){null==this._bgmFadeRepeatAction&&void 0==this._bgmFadeRepeatAction||(cc.director.getScene().getChildByName("Canvas").stopAction(this._bgmFadeRepeatAction),this._bgmFadeRepeatAction=null,this._bgmFadeVolume=this._bgmVolumeDeltaCount>0?1:0)},setSEVol:function(t){var e=t;for(var i in this.curplay_skillSE_list){var a=this.curplay_skillSE_list[i];this.seMute&&(e=0),cc.audioEngine.setVolume(a,e*this._bgmFadeVolume)}this.seVolume=t},setVoiceVol:function(t){if(-1!=this.curVoice_id){var e=t;this.voiceMute&&(e=0),cc.audioEngine.setVolume(this.curVoice_id,e*this._bgmFadeVolume)}this.voiceVolume=t},setBGMVol:function(t){if(-1!=this.curBGM_id){var e=t;this.bgmMute&&(e=0),cc.audioEngine.setVolume(this.curBGM_id,e*this._bgmFadeVolume)}this.bgmVolume=t},setBGMTempVol:function(t){if(-1!==this.curBGM_id){var e=t;this.bgmMute&&(e=0),cc.audioEngine.setVolume(this.curBGM_id,e*this._bgmFadeVolume)}},setSeMute:function(t){this.seMute=t,this.soundMute=this.bgmMute&&this.seMute&&this.voiceMute},setVoiceMute:function(t){this.voiceMute=t,this.soundMute=this.bgmMute&&this.seMute&&this.voiceMute,t?cc.audioEngine.setVolume(this.curVoice_id,0):this.setVoiceVol(this.voiceVolume)},setBgmMute:function(t){this.bgmMute=t,this.soundMute=this.bgmMute&&this.seMute&&this.voiceMute,-1!=this.curBGM_id&&(this.bgmMute?cc.audioEngine.setVolume(this.curBGM_id,0):cc.audioEngine.setVolume(this.curBGM_id,this.bgmVolume*this._bgmFadeVolume))},setSoundConfig:function(t){t&&(this.bgmVolume=Math.max(Math.min(t.bgmVolume,1),0),this.seVolume=Math.max(Math.min(t.seVolume,1),0),this.voiceVolume=Math.max(Math.min(t.voiceVolume,1),0),this.voiceMute=t.voiceMute,this.seMute=t.seMute,this.bgmMute=t.bgmMute)},getSoundConfig:function(){return{bgmVolume:this.bgmVolume,seVolume:this.seVolume,voiceVolume:this.voiceVolume,voiceMute:this.voiceMute,seMute:this.seMute,bgmMute:this.bgmMute}}}));e.exports=n,cc._RF.pop()},{CommonUtils:"CommonUtils",Singleton:"Singleton"}],SoundSettingView:[function(t,e,i){"use strict";cc._RF.push(e,"efc4eo0Gk5Kn4VHXciQVw4i","SoundSettingView");var a=t("CommonButton"),n=t("Singleton");cc.Class({extends:cc.Component,properties:{seSlider:cc.Slider,voiceSlider:cc.Slider,bgmSlider:cc.Slider,seProgressBar:cc.ProgressBar,voiceProgressBar:cc.ProgressBar,bgmProgressBar:cc.ProgressBar,seVolumeLabel:cc.Label,voiceVolumeLabel:cc.Label,bgmVolumeLabel:cc.Label,seMuteBtn:a,voiceMuteBtn:a,bgmMuteBtn:a,soundMasterBtn:a,setInitBtn:a},_seVolume:0,_voiceVolume:0,_bgmVolume:0,onLoad:function(){var t;t={seVolume:n.soundManager.seVolume,voiceVolume:n.soundManager.voiceVolume,bgmVolume:n.soundManager.bgmVolume,seMute:n.soundManager.seMute,voiceMute:n.soundManager.voiceMute,bgmMute:n.soundManager.bgmMute};var e=Math.max(Math.min(t.seVolume,1),0),i=Math.max(Math.min(t.voiceVolume,1),0),a=Math.max(Math.min(t.bgmVolume,1),0);this._seVolume=e,this._voiceVolume=i,this._bgmVolume=a,this._setDispSeVolume(e,t.seMute),this._setDispVoiceVolume(i,t.voiceMute),this._setDispBgmVolume(a,t.bgmMute),this.seMuteBtn.switchBtnImage(!t.seMute),this.voiceMuteBtn.switchBtnImage(!t.voiceMute),this.bgmMuteBtn.switchBtnImage(!t.bgmMute),this.seMuteBtn.setTapEvent(this._seMuteButtonEvent.bind(this)),this.voiceMuteBtn.setTapEvent(this._voiceMuteButtonEvent.bind(this)),this.bgmMuteBtn.setTapEvent(this._bgmMuteButtonEvent.bind(this)),this.soundMasterBtn.setTapEvent(this._soundMasterBtnEvent.bind(this)),this.setInitBtn.setTapEvent(this._setInitBtnEvent.bind(this))},getSoundSetting:function(){var t={};return t.se=this._seVolume,t.voice=this._voiceVolume,t.bgm=this._bgmVolume,t.seMute=!this.seMuteBtn.getBtnImageSwitchState(),t.voiceMute=!this.voiceMuteBtn.getBtnImageSwitchState(),t.bgmMute=!this.bgmMuteBtn.getBtnImageSwitchState(),t.soundMute=t.seMute&&t.voiceMute&&t.bgmMute,t},seSlideEvent:function(){n.soundManager.setSEVol(this.seSlider.progress),this._seVolume=this.seSlider.progress,this._setSeProgress(this.seSlider.progress)},voiceSlideEvent:function(){n.soundManager.setVoiceVol(this.voiceSlider.progress),this._voiceVolume=this.voiceSlider.progress,this._setVoiceProgress(this.voiceSlider.progress)},bgmSlideEvent:function(){n.soundManager.setBGMVol(this.bgmSlider.progress),this._bgmVolume=this.bgmSlider.progress,this._setBgmProgress(this.bgmSlider.progress)},_setSeProgress:function(t){this.seProgressBar&&(this.seProgressBar.progress=t),this.seVolumeLabel&&(this.seVolumeLabel.string=parseInt(100*t)),this.seMuteBtn.switchBtnImage(t>0),n.soundManager.setSeMute(t<=0),this._soundChangeEvent()},_setVoiceProgress:function(t){this.voiceProgressBar&&(this.voiceProgressBar.progress=t),this.voiceVolumeLabel&&(this.voiceVolumeLabel.string=parseInt(100*t)),this.voiceMuteBtn.switchBtnImage(t>0),n.soundManager.setVoiceMute(t<=0),this._soundChangeEvent()},_setBgmProgress:function(t){this.bgmProgressBar&&(this.bgmProgressBar.progress=t),this.bgmVolumeLabel&&(this.bgmVolumeLabel.string=parseInt(100*t)),this.bgmMuteBtn.switchBtnImage(t>0),n.soundManager.setBgmMute(t<=0),this._soundChangeEvent()},_setSeSlideProgress:function(t){this.seSlider.progress=t,this._setSeProgress(t)},_setVoiceSlideProgress:function(t){this.voiceSlider.progress=t,this._setVoiceProgress(t)},_setBgmSlideProgress:function(t){this.bgmSlider.progress=t,this._setBgmProgress(t)},_setDispSeVolume:function(t,e){e?this._setSeSlideProgress(0):(this._seVolume<=0&&(this._seVolume=.01),this._setSeSlideProgress(this._seVolume))},_setDispVoiceVolume:function(t,e){e?this._setVoiceSlideProgress(0):(this._voiceVolume<=0&&(this._voiceVolume=.01),this._setVoiceSlideProgress(this._voiceVolume))},_setDispBgmVolume:function(t,e){e?this._setBgmSlideProgress(0):(this._bgmVolume<=0&&(this._bgmVolume=.01),this._setBgmSlideProgress(this._bgmVolume))},_seMuteButtonEvent:function(){this.seMuteBtn.switchBtnImage(!this.seMuteBtn.getBtnImageSwitchState()),this._setDispSeVolume(this._seVolume,!this.seMuteBtn.getBtnImageSwitchState())},_voiceMuteButtonEvent:function(){this.voiceMuteBtn.switchBtnImage(!this.voiceMuteBtn.getBtnImageSwitchState()),this._setDispVoiceVolume(this._voiceVolume,!this.voiceMuteBtn.getBtnImageSwitchState())},_bgmMuteButtonEvent:function(){this.bgmMuteBtn.switchBtnImage(!this.bgmMuteBtn.getBtnImageSwitchState()),this._setDispBgmVolume(this._bgmVolume,!this.bgmMuteBtn.getBtnImageSwitchState())},_soundMasterBtnEvent:function(t){this.soundMasterBtn.switchBtnImage(!this.soundMasterBtn.getBtnImageSwitchState()),n.soundManager.setMute(!this.soundMasterBtn.getBtnImageSwitchState()),this.setMuteAll(!this.soundMasterBtn.getBtnImageSwitchState())},_setInitBtnEvent:function(t){n.soundManager.setBGMVol(.5),this._bgmVolume=.5,this._setDispBgmVolume(),n.soundManager.setSEVol(.5),this._seVolume=.5,this._setDispSeVolume(),n.soundManager.setVoiceVol(.5),this._voiceVolume=.5,this._setDispVoiceVolume()},_soundChangeEvent:function(){var t=this.getSoundSetting();this.soundMasterBtn.switchBtnImage(!t.soundMute),this._callbackToSoundChangeEvent&&this._callbackToSoundChangeEvent(t)},setMuteAll:function(t){this._setDispSeVolume(this._seVolume,t),this._setDispVoiceVolume(this._voiceVolume,t),this._setDispBgmVolume(this._bgmVolume,t)},setCallbackToSoundChangeEvent:function(t){this._callbackToSoundChangeEvent=t}}),cc._RF.pop()},{CommonButton:"CommonButton",Singleton:"Singleton"}],SpineEventInterpreter:[function(t,e,i){"use strict";cc._RF.push(e,"70cffoi3iNJFIOdoqQKDdJL","SpineEventInterpreter");var a=t("BattleData"),n=t("CommonFunction"),o=t("BattleFunction"),r=t("GameEffectQueue").GameEffectQueue,s=t("GameEffectQueue").EffectQuery,c=t("GameEffectQueue").EffectData,l=t("MemoryManager"),u=cc.Class({extends:cc.Component,properties:{updateCallbacks:[],endAction:{default:null}},hitEffName:null,hitEffectAniName:null,ctor:function(){this.updateCallbacks=[]},init:function(t,e){var i=this,n=a.RM.resourceList,o=e.get("damageActionArr");this.hitEffName=e.get("hitEffName"),this.hitEffectAniName=e.get("hitEffectAniName");var r=e.get("battleUnit"),s=e.get("selfEffectNode"),c=e.get("targetEffectNodeList"),l=e.get("main_spine"),u=e.get("onEndDestroy"),h=e.get("aniName"),d=l.node,p=e.get("parentNode"),m=[],_=[],g=[],C=!1,f=a.GM.soundManager,E=!1,T=a.GM.cameraController,S=!1;f&&(f.curplay_skillSE_list=[]);for(var R=0;R<10;R++){var A=new cc.Node;A.parent=p,A.setPosition(cc.v2(0,0));var b=1*R;A.zIndex=b,m[9-R]=A}var M=function(){if(t(),u){for(var e in d.destroy(),m){m[e].destroy()}_=[],i.node.destroy()}else{i.scheduleOnce(function(){for(var t in m){m[t].destroy()}_=[],i.node.destroy()}.bind(i),.2)}E&&T.subCameraRestore(null,null)};l.setCompleteListener(function(t,e){t.animation&&t.animation.name;l.setEventListener(null),l.setCompleteListener(null),f&&(f.curplay_skillSE_list=[]),S||M()}),l.setEventListener(function(a,u){var h=a.animation?a.animation.name:"";cc.log("[track %s][animation %s] event: %s, %s, %s, %s",a.trackIndex,h,u.data.name,u.intValue,u.floatValue,u.stringValue);var d=u.data.name.split(","),f=d[0],T=d.length>=2?d[1]:1,R=u.stringValue?u.stringValue.split(","):[],A=R[0],b=R.length>=2?R[1]:null,M=R.length>=3?R[2]-1:null,v=R.length>=4?R[3]:null,P=R.length>=5?R[4]:null,I=[];if("spine"===A?C=i._playCommandSpine(f,T,r,_,M,m,I,n,P,v,o,C):"spine_modify"===A?i._playCommandSpineModify(f,T,_,M,m,I,P,v):"spine_off"===A?i._playCommandSpineOff(f,T,_):"spine_on_target"===A?i._playCommandSpineOnTarget(f,T,r,M,m,I,n,P,v,o,C,c):"particle"===A?i._playCommandParticle(f,r,M,m,I,n):"particle_off"===A?i._playCommandParticleOff(f,T,_):"particle_stop"===A?i._playCommandParticleStop(f,T,_):"particle_resume"===A?i._playCommandParticleResume(f,T,_):"spine_shader"===A?i._playCommandSpineShader(f,T,_,g,R):0===f.indexOf("gr_se_")||0===f.indexOf("se_")?i._playCommandSe(f,r,n):0===f.indexOf("vo_")?i._playCommandVoice(f,r,n):"camera_move"===A?E=i._playCommandCameraMove(e,b,c,s,E):"camera_zoom"===A?E=i._playCommandCameraZoom():"camera_restore"===A?E=i._playCommandCameraRestore():"eventkey"===A?(S=!0,i._playCommandEventKey(l,f,t,r,p,i.hitEffName,i.hitEffectAniName,o,n)):cc.error("msg error : "+f+","+u.stringValue),I&&b){var y=b.split(":"),N=y[0],B=R.length>=2?Number(y[1]):0,L=R.length>=3?Number(y[2]):0;for(var w in I){var D=I[w],U=D.getPosition();"self"===N?D.parent=l.node:"pos"===N&&(U=cc.v2(-640,-360)),(B||L)&&(U=cc.v2(U.x+B,U.y+L)),D.setPosition(U)}}}),l.setAnimation(0,h,!1)},_playCommandSpine:function(t,e,i,n,r,s,c,u,h,d,p,m){var _,g=t+e,C=o.getRefName(i.getId(),t);if(null!=n[g]){var f=n[g];_=f.getComponent(sp.Skeleton),f.parent!==s[r]&&(f.parent=s[r]),!1===_.node.active&&(_.node.active=!0),c.push(f)}else if(null!=u[C]){var E=new cc.Node;(_=E.addComponent(sp.Skeleton)).skeletonData=u[C],_.timeScale=a.cur_GameSpeed,E.parent=s[r],E.setPosition(cc.v2(0,0)),n[g]=E,c.push(E),l.instance.storeRes(_.skeletonData,sp.SkeletonData)}else cc.log("not exist?!?!");var T=h;return""===h&&(T="animation"),_&&"loop"===d?(_.loop=!0,_.setCompleteListener(null)):(_.loop=!1,_.setCompleteListener(function(t,e){_.node.active=!1})),m=this.judgeHitEffectDamage(i,_,p,t,T,m),_.setAnimation(0,T,!1),m},_playCommandSpineOnTarget:function(t,e,i,n,r,s,c,u,h,d,p,m){var _=o.getRefName(i.getId(),t),g=null;if(null!=c[_])for(var C in m){var f=m[C],E=r[n],T=new cc.Node;g=T.addComponent(sp.Skeleton),T.parent=E,g.skeletonData=c[_],g.timeScale=a.cur_GameSpeed,l.instance.storeRes(g.skeletonData,sp.SkeletonData),T.setPosition(cc.v2(0,0)),s.push(T);var S=f.convertToWorldSpace(f.getAnchorPoint()),R=E.convertToNodeSpace(S);T.setPosition(R);var A=u;""===u&&(A="animation"),"loop"===h?(g.loop=!0,g.setCompleteListener(null)):(g.loop=!1,g.setCompleteListener(function(t,e){this.node.active=!1}.bind(g))),p=this.judgeHitEffectDamage(i,g,d,t,A,p),g.setAnimation(0,A,!1)}return p},_playCommandSpineModify:function(t,e,i,a,n,o,r,s){var c=t+e;if(null!=i[c]){var l=i[c],u=l.getComponent(sp.Skeleton);l.parent!==n[a]&&(l.parent=n[a]),!1===u.node.active&&(u.node.active=!0);var h=r;""===r&&(h="animation"),u&&"loop"===s?(u.loop=!0,u.setCompleteListener(null)):(u.loop=!1,u.setCompleteListener(function(t,e){u.node.active=!1})),u.setAnimation(0,h,!1),o.push(l)}},_playCommandSpineOff:function(t,e,i){var a,n=t+e;if(null!=i[n]){a=i[n];var o=i.indexOf(a);i.splice(o,1),a.destroy()}},_playCommandSpineShader:function(t,e,i,o,r){var s,c,l=t+e;if(null!=i[l]){s=i[l];var u=a.GM.shaderController,h=r[1].split(":");if("blur"===h[0]){var d=Number(h[1]);c=null!=o[l]?o[l]:u.get_blur_program(),c=u.apply_blur_simple(s,c,d),o[l]=c}else if("blur_timer"===h[0]){var p=Number(h[1]),m=Number(h[2]),_=0,g=Number(h[3]);c=null!=o[l]?o[l]:u.get_blur_program();var C=function(t){_+=t*a.cur_GameSpeed;var e=n.lerp(p,m,_/g);if(c=u.apply_blur_simple(s,c,e),_>=g){c=u.apply_blur_simple(s,c,m),o[l]=c;var i=this.updateCallbacks.indexOf(C);this.updateCallbacks.splice(i,1)}}.bind(this);this.updateCallbacks.push(C)}}},_playCommandParticle:function(t,e,i,a,n,r){var s=a[i],c=new cc.Node,l=c.addComponent(cc.ParticleSystem),u=r[o.getRefName(e.getId(),t)];u&&(l.file=u),c.parent=s,c.setPosition(cc.v2(0,0)),n.push(c)},_playCommandParticleOff:function(t,e,i){var a,n=t+e;if(i[n]){a=i[n];var o=i.indexOf(a);i.splice(o,1),a.destroy()}},_playCommandParticleStop:function(t,e,i){var a=t+e;i[a]&&i[a].stopSystem()},_playCommandParticleResume:function(t,e,i){var a=t+e;i[a]&&i[a].resetSystem()},_playCommandSe:function(t,e,i){var n=o.getRefName(e.getId(),t);null!=i[n]&&a.GM.soundManager&&a.GM.soundManager.playSE_skillSE(i[n])},_playCommandVoice:function(t,e,i){var n=o.getRefName(e.getId(),t);null!=i[n]&&a.GM.soundManager&&a.GM.soundManager.playVoice(i[n])},_playCommandCameraMove:function(t,e,i,n,o){var r=null;if("target"===e)i&&(r=i[0]);else if("self"===e)n&&(r=c);else if("target_area"===e){var s=t.get("targetAreaNode");s&&(r=s)}else if("my_area"===e){var c=t.get("myAreaNode");c&&(r=c)}return r&&(a.GM.cameraController.subCameraMoveToBySpineEvent(r),o=!0),"fix"===posMsg&&a.GM.cameraController.subCameraMoveRestoreBySpineEvent(),o},_playCommandCameraZoom:function(){return a.GM.cameraController.subCameraZoomInBySpineEvent(),!0},_playCommandCameraRestore:function(){a.GM.cameraController.subCameraRestore(null,null)},_playCommandEventKey:function(t,e,i,n,r,s,c,h,d){t.setCompleteListener(null);var p=o.getRefName(n.getId(),e);if(null!=d[p]){var m=new cc.Node,_=m.addComponent(sp.Skeleton);_.skeletonData=d[p],_.timeScale=a.cur_GameSpeed,m.parent=r,l.instance.storeRes(_.skeletonData,sp.SkeletonData);var g=new Map;g.set("battleUnit",n),g.set("parentNode",r),g.set("aniName","animation"),g.set("onEndDestroy",!0),g.set("main_spine",_),g.set("hitEffName",s),g.set("hitEffectAniName",c),g.set("damageActionArr",h);var C=new cc.Node,f=m.addComponent(u);C.parent=r,f.init(i,g)}else cc.error(e+"\u306eSpine\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002"),cc.log(p)},judgeHitEffectDamage:function(t,e,i,n,l,u){var h=0;if(n===this.hitEffName&&l===this.hitEffectAniName){var d=new r,p=new s;p.addAction(new c({},a.GM.gameRoot.poolManager.playSkillCutinMessage.bind(a.GM.gameRoot.poolManager))),d.addQuery(p),d.play(),!u&&i&&(e.setEventListener(function(e,n){if(0===n.data.name.indexOf("gr_se_")||0===n.data.name.indexOf("se_")){var r=o.getRefName(t.getId(),n.data.name);null!=a.RM.resourceList[r]&&a.GM.soundManager.playSE_skillSE(a.RM.resourceList[r])}if("evt_damage"===n.data.name){for(var s=0;s<i.length;s++){i[s][h]()}h++}}),u=!0)}return u},update:function(t){for(var e=this.updateCallbacks.length-1;e>=0;e--)this.updateCallbacks[e](t)}});cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",CommonFunction:"CommonFunction",GameEffectQueue:"GameEffectQueue",MemoryManager:"MemoryManager"}],StartRoot:[function(t,e,i){"use strict";cc._RF.push(e,"547eal5SS5G6Z7k4TGZdWGh","StartRoot");var a=t("GameRootBase"),n=t("Singleton"),o=t("StaticResourceConst"),r=t("MissionUtils"),s=t("ResourceUtils"),c=t("GameConst"),l=(t("DeckConst"),t("LocalDataConst")),u=(t("SoundManager"),t("ApiConstants")),h=(t("CommonUtils"),t("Async")),d=t("SingletonConst"),p=t("ApplicationServiceManager"),m=t("PopupUtils"),g=(t("QuestRoot"),t("SceneConst"),t("TutorialConst")),C=t("EventUtils"),f=t("EventQuestConst"),E=t("ErrorCode"),T=(t("FileLoaderManager"),t("GenerateMd5")),S=(t("EventQuestRoot"),t("QuestConst"),t("QuestUtils"),t("QuestConditionUtils"),t("UserUtils")),R=(t("BattleFunction"),t("DownManifestManager")),A=t("ResLoader");cc.Class({extends:a,ctor:function(){},onLoad:function(){this._setErrorHandling()},initData:function(){this._bootInit(),this._bootSequence()},initResource:function(){this.initResBySpriteFrame(),this.initResBySpriteFrameIcons(),this.initResByPrefab(),this.initResByAnimationClip(),this.initResBySE()},initialize:function(){n[d.ENVIRONMENT].isDmmPlatform()?cc.director.loadScene("HomeScene.fire"):(this.btnLogout.node.active=!0,this.btnGroup.active=!0)},_bootInit:function(){this._initLocalData(),cc.audioEngine.stopAll(),n.ServiceManager=new p,n.generateMd5=new T},_initLocalData:function(){n.localData[l.SORT_TYPE]=0,n.localData[l.SORT_ORDER]=c.SORT_ORDER.ASC,this._initFilters(),n.localData[l.SELECT_QUEST_DECK_ORDER]=1,n.localData[l.SELECT_TOWER_DECK_ORDER]=1,n.localData[l.SELECT_PVP_DECK_ORDER]=1,n.localData[l.SELECT_WORLD_ID]=null,n.localData[l.SELECT_AREA_ID]=null,n.localData[l.SELECT_STAGE_ID]=null,n.localData[l.MYPAGE_NEWS_FIRST_START]=!0,n.localData[l.MY_PAGE_LOGIN_VOICE]=!0,n.localData[l.TUTORIAL_SUB_STEP]=g.SUB_STEP_DISABLE,n.localData[l.IS_EXIST_GACHA_SESSION]=!1,n.localData[l.PRESENT_COUNT]=0,n.localData[l.NEW_USER_ITEMS]=[]},_initFilters:function(){for(var t in l.FILTER.THREE)n.localData[l.FILTER.THREE[t]]=[!0,!0,!0];for(var e in l.FILTER.FOUR)n.localData[l.FILTER.FOUR[e]]=[!0,!0,!0,!0];for(var i in l.FILTER.FIVE)n.localData[l.FILTER.FIVE[i]]=[!0,!0,!0,!0,!0];for(var a in l.FILTER.SIX)n.localData[l.FILTER.SIX[a]]=[!0,!0,!0,!0,!0,!0];for(var o in l.FILTER.SEVEN)n.localData[l.FILTER.SEVEN[o]]=[!0,!0,!0,!0,!1,!0,!1];for(var r in l.FILTER.TEN)n.localData[l.FILTER.TEN[r]]=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];for(var s in l.FILTER.TWELVE)n.localData[l.FILTER.TWELVE[s]]=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];for(var c in l.FILTER.THIRTEEN)n.localData[l.FILTER.THIRTEEN[c]]=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]},_bootSequence:function(){var t=[];t.push(this._checkNewVersion.bind(this)),t.push(this._authenticate.bind(this)),t.push(this._loadMasterData.bind(this)),t.push(this._login.bind(this)),t.push(this._checkHotUpdate.bind(this)),t.push(this._loadUserData.bind(this)),t.push(this._loadLoginPack.bind(this)),t.push(this._loadRaidData.bind(this)),t.push(this._loadWarehouseCharacterList.bind(this)),t.push(this._loadWarehouseEquipmentList.bind(this)),t.push(this._loadWarehouseList.bind(this)),n[d.ENVIRONMENT].getDebugTutorialSkip()&&t.push(this._initialUserData.bind(this)),this.requestURLCount=t.length,h.waterfall(t,function(){var t=n[d.ERROR_MANAGER];if(n.dao.ErrorDataMasters){var e=n.dao.ErrorDataMasters;t.setErrorMaster(e)}})},_authenticate:function(t){n[d.SERVICE_AUTH].authenticate(function(){this.requestURLCount-=1,t()}.bind(this))},_initialUserData:function(t){var e=n.dao.userBasicData.getTutorialStep(),i=n.dao.TutorialMainStepMasters.filter(function(t){return t.getStep()>=e}).sort(function(t,e){return t.getStep()<e.getStep()?-1:1});if(!i)return this.requestURLCount-=1,t();var a=[];i.forEach(function(t){a.push(function(e){n.TutorialService.updateTutorialStep(t.getStep()+1,e)})}),h.waterfall(a,function(){this.requestURLCount-=1,t()}.bind(this))},_login:function(t){n.ServiceManager.callAPI(u.LOGIN,void 0,function(e,i){if(e)return cc.error(e),n[d.ERROR_MANAGER].throwError(e.errorCode,e.retryAPI);if(i.err)return n[d.ERROR_MANAGER].throwError(i.status);if(i.resourceKey&&T.instance.setResouceKey(i.resourceKey),i.isUserDisabled)return n[d.ERROR_MANAGER].throwError(E.USER_DISABLED,void 0,void 0);if(i.isUserWarning&&(this.requestURLCount+=1,m.openSystemPopup("","\u4e0d\u6b63\u306a\u30d7\u30ec\u30a4\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\u6539\u5584\u304c\u898b\u3089\u308c\u306a\u3044\u5834\u5408\u3001\n\u30a2\u30ab\u30a6\u30f3\u30c8\u505c\u6b62\u3068\u306a\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002","\u304a\u5fc3\u5f53\u305f\u308a\u304c\u306a\u3044\u5834\u5408\u304a\u554f\u3044\u5408\u308f\u305b\u7a93\u53e3\u306b\u3054\u9023\u7d61\u304f\u3060\u3055\u3044\u3002",!1,function(){this.requestURLCount-=1}.bind(this))),i.isMaintenance)return n[d.ERROR_MANAGER].throwError(E.MAINTENANCE,void 0,i);if(i.finishedMissionCds&&r.noticeMissionUpdate(i.finishedMissionCds),i.paymentSession&&i.paymentSession.saveData&&0!==Object.keys(i.paymentSession.saveData).length&&(n.localData[l.PAYMENT_SESSION]=i.paymentSession),n.localData[l.IS_EXIST_GACHA_SESSION]=i.isExistsGachaSession,i.version){var a=JSON.parse(i.version,i.user.userCd);_.assign(n.localData[l.USER_VERSION],a)}this.startNowDateCalculation(),this.requestURLCount-=1,t()}.bind(this))},_checkNewVersion:function(t){cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID?n.UserService.getClientVersion(function(e){void 0!=e&&(this.requestURLCount-=1,t())}.bind(this)):(this.requestURLCount-=1,t())},_checkHotUpdate:function(t){var e,i,a=this,o=n[d.ENVIRONMENT];cc.sys.isNative&&!o.getHotUpdateSkip()?(i=cc.instantiate(this.hotUpdatePrefab),e=i.getComponent("HotUpdate"),this.node.addChild(i),function n(){e.startHotUpdate(function(e,o){i.active=!1,cc.log("StartRoot startHotUpdate"),o?m.openCommonPopupOk("",o,"",!1,function(){n()}):(a.requestURLCount-=1,t())}.bind(this))}()):(this.requestURLCount-=1,t())},_loadMasterData:function(t){n.ServiceManager.loadMasterData(function(){this.requestURLCount-=1,t()}.bind(this))},_loadUserData:function(t){n.ServiceManager.loadUserData(function(){S.initializeUserProgressNotice(),this.requestURLCount-=1,t()}.bind(this),r.noticeMissionUpdate)},_loadLoginPack:function(t){n.LoginPackService.getLoginPack(function(){return this.requestURLCount-=1,t()}.bind(this))},_loadRaidData:function(t){var e=this,i=C.getOpenEventMainMasterArray().find(function(t){return t.getEventType()===f.EVENT_TYPE.RAID});if(!i)return e.requestURLCount-=1,t();n.RaidService.getList(i.getEventId(),function(i){e.requestURLCount-=1,t()})},_loadWarehouseCharacterList:function(t){var e=this;n.WarehouseService.getCharacterCount(function(i){var a=[];if(i.splitCount&&i.splitCount>0)for(var o=0;o<i.splitCount;o+=1)a.push(function(t,e){n.WarehouseService.getCharacterList(t,e)}.bind(e,o));h.waterfall(a,function(){e.requestURLCount-=1,t()})})},_loadWarehouseEquipmentList:function(t){var e=this;n.WarehouseService.getEquipmentCount(function(i){var a=[];if(i.splitCount&&i.splitCount>0)for(var o=0;o<i.splitCount;o+=1)a.push(function(t,e){n.WarehouseService.getEquipmentList(t,e)}.bind(e,o));h.waterfall(a,function(){e.requestURLCount-=1,t()})})},_loadWarehouseList:function(t){var e=this;n.WarehouseService.getMaterialCount(function(i){var a=[];if(i.splitCount&&i.splitCount>0)for(var o=0;o<i.splitCount;o+=1)a.push(function(t,e){n.WarehouseService.getMaterialList(t,e)}.bind(e,o));h.waterfall(a,function(){e.requestURLCount-=1,t()})})},_loadDownMainfest:function(t){if(n[d.ENVIRONMENT].getPlainDynamicFileFlg())return this.requestURLCount-=1,t();if(n[d.ENVIRONMENT].getDebugResource())return this.requestURLCount-=1,t();var e=this;R.instance.loadDownLoadMainfest(function(i){null==i?(e.requestURLCount-=1,t()):m.openCommonPopupOk("",i,"",!1,function(){e._loadDownMainfest(t)})})},initResBySpriteFrame:function(){},initResBySpriteFrameIcons:function(){for(var t in c.ATTRIBUTE){var e=c.ATTRIBUTE[t];this.requestStaticRes(s.getFileNameAttributeIcon(e),cc.SpriteFrame)}for(var i in c.RARITY){var a=c.RARITY[i];this.requestStaticRes(s.getFileNameRarityIcon(a),cc.SpriteFrame),this.requestStaticRes(s.getFileNameRarityStrIcon(a),cc.SpriteFrame),this.requestStaticRes(s.getFileNameRarityFrame(a),cc.SpriteFrame),this.requestStaticRes(s.getFileNameRarityEquipmentFrame(a),cc.SpriteFrame),this.requestStaticRes(s.getFileNameRarityRing(a),cc.SpriteFrame)}},initResByPrefab:function(){this.requestStaticRes(o.COMMON_HEADER_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.COMMON_SIDE_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.COMMON_BADGE_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.COMMON_BACK_BUTTON_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.PAGE_BUTTON_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.AUTO_SELECT_POPUP_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.ITEM_SOURCE_LIST_POPUP_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.GRADATION_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.DIALOG_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.SIMPLE_MESSAGE_WINDOW_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.ARROW_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.HOW_TO_PLAY_POPUP_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.BALLOON_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.CHARACTER_STAND_VIEW_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.SIMPLE_NOTICE_WITH_CLEAR_STAMP_VIEW_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.SIMPLE_NOTICE_WITH_CLEAR_GAUGE_VIEW_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.ADV_SUB_ROOT_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.RESULT_RIBBON_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.NEWS_POPUP_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.USER_RENAME_POPUP_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.AP_RECOVERY_POPUP_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.BP_RECOVERY_POPUP_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.UNLOCK_EFFECT_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.UNLOCK_EFFECT_WHITE_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.EQUIPMENT_MATRIX_THUMBNAIL_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.ENEMY_MATRIX_THUMBNAIL_PREFAB_PATH,cc.Prefab),this.requestStaticRes(o.WAREHOUSE_MATERIAL_MATRIX_THUMBNAIL_PREFAB_PATH,cc.Prefab)},initResByAnimationClip:function(){this.requestStaticRes(o.POPUP_WINDOW_OPEN_ANIM_CLIP_PATH,cc.AnimationClip),this.requestStaticRes(o.POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH,cc.AnimationClip)},initResBySE:function(){for(var t in o.SE)o.SE[t]&&this.requestStaticRes(o.SE[t],cc.AudioClip)},requestStaticRes:function(t,e){if(!n.staticRes[t]){this._resourceRemainLoadCount+=1;var i=this;A.loader.loadRes(t,e,function(e,a){if(i._resourceRemainLoadCount-=1,null!==e)return i._requestStaticResList&&delete i._requestStaticResList[t],void cc.log(e);n.staticRes[t]=a,i._requestResList&&delete i._requestResList[t]},o.USE_KEY)}},startNowDateCalculation:function(){n.localData[l.NOW_DATETIME]||(this._calcNowDate(),window.setIntervalId=setInterval(function(){this._calcNowDate()}.bind(this),1e3),window.updateSystemDate=this._updateSystemDate,cc.game.on(cc.game.EVENT_SHOW,window.updateSystemDate))},_updateSystemDate:function(){n.ServiceManager.callAPI(u.GET_USER_DATA,void 0,function(t,e){t&&cc.error(t)})},_calcNowDate:function(){var t=n.dao.userBasicData.getSystemDate(),e=n.localData[l.PRE_SYSTEM_DATE],i=n.localData[l.NOW_DATETIME];e===t&&i||(i=t,n.localData[l.PRE_SYSTEM_DATE]=t),i.add("s",1),n.localData[l.NOW_DATETIME]=i},_transitionScene:function(t){this.pushScene(t,void 0,void 0,void 0)}}),cc._RF.pop()},{ApiConstants:"ApiConstants",ApplicationServiceManager:"ApplicationServiceManager",Async:"Async",BattleFunction:"BattleFunction",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DownManifestManager:"DownManifestManager",ErrorCode:"ErrorCode",EventQuestConst:"EventQuestConst",EventQuestRoot:"EventQuestRoot",EventUtils:"EventUtils",FileLoaderManager:"FileLoaderManager",GameConst:"GameConst",GameRootBase:"GameRootBase",GenerateMd5:"GenerateMd5",LocalDataConst:"LocalDataConst",MissionUtils:"MissionUtils",PopupUtils:"PopupUtils",QuestConditionUtils:"QuestConditionUtils",QuestConst:"QuestConst",QuestRoot:"QuestRoot",QuestUtils:"QuestUtils",ResLoader:"ResLoader",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst",SoundManager:"SoundManager",StaticResourceConst:"StaticResourceConst",TutorialConst:"TutorialConst",UserUtils:"UserUtils"}],StaticResourceConst:[function(t,e,i){"use strict";cc._RF.push(e,"35d85dWnX5EGKznM9vZIHYj","StaticResourceConst");cc.Class({statics:{ATTRIBUTE_ICON_PATH:"image/common/attribute/icon/",RARITY_IMAGE_PATH_PREFIX:"image/common/rarity/",RARITY_IMAGE_PATH_CONJUNCTION:cc.Enum({ICON:"icon/",ICON_STR:"icon_str/",ICON_STR_S:"icon_str_s/",FRAME:"frame/",FRAME_S:"frame_s/",FRAME_W:"frame_w/",FRAME_C:"frame_c/",FRAME_E:"frame_e/",FRAME_EL:"frame_el/",FRAME_BG:"frame_bg/",RING:"ring/"}),BUFF_ICON_PATH:"image/inGame/buff/",EDGE_BAND_PATH:"image/common/edge_band",SIMPLE_TEX_PATH:"image/common/whitePixel",COMMON_HEADER_PREFAB_PATH:"prefab/outGame/common/UIHeader",COMMON_SIDE_PREFAB_PATH:"prefab/outGame/common/UISide",COMMON_BADGE_PREFAB_PATH:"prefab/outGame/common/CommonBadge",COMMON_BACK_BUTTON_PREFAB_PATH:"prefab/outGame/common/BackButton",LOADING_SIMPLE_PREFAB_PATH:"prefab/system/loading/NowLoadingCover",LOADING_PROGRESS_PREFAB_PATH:"prefab/system/NowLoading",LOADING_PROGRESS_CHARA_PREFAB_PATH:"prefab/system/loading/NowLoadingCharacter",LOADING_PROGRESS_TIPS_PREFAB_PATH:"prefab/system/loading/NowLoadingTips",LOADING_PAYMENT_WAIT_PREFAB_PATH:"prefab/system/loading/PaymentWait",VARIABLE_TEXT_WINDOW_PREFAB_PATH:"prefab/outGame/common/VariableTextWindow",PAGE_BUTTON_PREFAB_PATH:"prefab/outGame/common/PageButtonView",AUTO_SELECT_POPUP_PREFAB_PATH:"prefab/outGame/common/AutoSelectConfirmPopup",ITEM_SOURCE_LIST_POPUP_PREFAB_PATH:"prefab/outGame/common/ItemSourceListPopup",DIALOG_PREFAB_PATH:"prefab/outGame/common/CommonPopupS",SIMPLE_MESSAGE_WINDOW_PREFAB_PATH:"prefab/outGame/common/SimpleMeesageWindow",ARROW_PREFAB_PATH:"prefab/outGame/common/CommonAfterArrow",HOW_TO_PLAY_POPUP_PREFAB_PATH:"prefab/outGame/common/HowToPlayPopup",GRADATION_PREFAB_PATH:"prefab/outGame/common/Gradation",BALLOON_PREFAB_PATH:"prefab/outGame/common/balloon",CHARACTER_STAND_VIEW_PREFAB_PATH:"prefab/outGame/common/CharacterStandView",TAP_EFFECT_PREFAB_PATH:"prefab/system/TapEffect",SIMPLE_NOTICE_WITH_CLEAR_STAMP_VIEW_PREFAB_PATH:"prefab/outGame/common/SimpleNoticeWithClearStampView",SIMPLE_NOTICE_WITH_CLEAR_GAUGE_VIEW_PREFAB_PATH:"prefab/outGame/common/SimpleNoticeWithClearGaugeView",ADV_SUB_ROOT_PREFAB_PATH:"adv/prefab/window/AdvSubRoot",RESULT_RIBBON_PREFAB_PATH:"prefab/outGame/common/ResultRibbonPopup",NEWS_POPUP_PREFAB_PATH:"prefab/outGame/common/NewsPopup",USER_RENAME_POPUP_PREFAB_PATH:"prefab/outGame/common/UserRenamePopup",AP_RECOVERY_POPUP_PREFAB_PATH:"prefab/outGame/common/ApRecoveryPopup",BP_RECOVERY_POPUP_PREFAB_PATH:"prefab/outGame/common/BpRecoveryPopup",UNLOCK_EFFECT_PREFAB_PATH:"prefab/outGame/common/LockIcon",UNLOCK_EFFECT_WHITE_PREFAB_PATH:"prefab/outGame/common/LockIconWhite",CHARACTER_MATRIX_THUMBNAIL_PREFAB_PATH:"prefab/outGame/common/thumbnail/CharacterMatrixThumbnail",ITEM_MATRIX_THUMBNAIL_PREFAB_PATH:"prefab/outGame/common/thumbnail/ItemMatrixThumbnail",EQUIPMENT_MATRIX_THUMBNAIL_PREFAB_PATH:"prefab/outGame/common/thumbnail/EquipmentMatrixThumbnail",ENEMY_MATRIX_THUMBNAIL_PREFAB_PATH:"prefab/outGame/common/thumbnail/EnemyMatrixThumbnail",WAREHOUSE_MATERIAL_MATRIX_THUMBNAIL_PREFAB_PATH:"prefab/outGame/common/thumbnail/WarehouseMaterialMatrixThumbnail",POPUP_WINDOW_OPEN_ANIM_CLIP_PATH:"animation/outGame/common/PopupWindow_Open_Anim",POPUP_WINDOW_CLOSE_ANIM_CLIP_PATH:"animation/outGame/common/PopupWindow_Close_Anim",SE:{START:"sound/se/se_001",POPUP_ON:"sound/se/se_002",POPUP_OFF:"sound/se/se_003",REWARD:"sound/se/se_004",LOGIN_BONUS:"sound/se/se_005",STAMP:"sound/se/se_006",SELECT:"sound/se/se_007",CANCEL:"sound/se/se_008",EXECUTE:"sound/se/se_009",FAILURE:"sound/se/se_025",COUNT:"sound/se/se_031",EQUIP:"sound/se/se_032",RECEIVE:"sound/se/se_033",FORTIFY:"sound/se/se_034",LEVEL_UP:"sound/se/se_035",RANK_UP:"sound/se/se_036"},USE_KEY:"STATIC_RES"}});cc._RF.pop()},{}],StoryApis:[function(t,e,i){"use strict";cc._RF.push(e,"aff48TsmLlOSr/Z4vJY7j+7","StoryApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.STORY_GET_MASTER_DATA,path:"story/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.STORY_GET_USER_DATA,path:"story/getUserData",method:"POST"}),a.RESTClient.graft({name:n.STORY_ADD_STORY,path:"story/addStory",method:"POST"}),a.RESTClient.graft({name:n.STORY_READ_STORY,path:"story/readStory",method:"POST"}),a.RESTClient.graft({name:n.STORY_GET_RESOURCE,path:"story/getResource",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],StoryAreaListView:[function(t,e,i){"use strict";cc._RF.push(e,"5013elrjwJEA7bSJrHoIdUa","StoryAreaListView");var a=t("QuestUtils"),n=t("StoryConst"),o=t("ResourceUtils"),r=t("StoryListViewBase");cc.Class({extends:r,getListTitle:function(){return"\u30a8\u30ea\u30a2\u9078\u629e"},getBackListTitle:function(){return"\u30ef\u30fc\u30eb\u30c9\u9078\u629e"},getTextGroup:function(){return n.STORY_TEXT_GROUP.AREA},_setListContent:function(t){for(var e in t.getStoryInfoMap()[t.getCurrentStoryCategory()][t.getCurrentStoryWorldId()])this._addThumbnail(e)},_addThumbnail:function(t){if(!(Object.keys(this._root.getStoryInfoMap()[this._root.getCurrentStoryCategory()][this._root.getCurrentStoryWorldId()][t].userStageModelMap).length<=0)){var e=cc.instantiate(this.thumbnailPrefab).getComponent("StoryThumbnail");e.setThumbnailImage(o.getFileNameAreaThumbnail(t)),e.setCallbackToThumbnail(function(){this._callbackToThumbnail(t)}.bind(this)),e.setThumbnailText(a.getAreaMasterMap()[t].getName()),this.thumbnailParentNode.addChild(e.node)}},_callbackToThumbnail:function(t){this._root.pushStoryListView(this._root.getCurrentStoryCategory(),null,this._root.getCurrentStoryWorldId(),t)}});cc._RF.pop()},{QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",StoryConst:"StoryConst",StoryListViewBase:"StoryListViewBase"}],StoryCategoryListView:[function(t,e,i){"use strict";cc._RF.push(e,"623aclGL4NFKZS1gQV1xHq8","StoryCategoryListView");var a=t("ResourceUtils"),n=t("NoticeBadgeCheckUtils"),o=t("ViewUtils"),r=t("StoryListViewBase"),s=t("StoryConst"),c={POSITION:cc.v2(238,68),SCALE:cc.v2(1,1)};cc.Class({extends:r,getListTitle:function(){return"\u30ab\u30c6\u30b4\u30ea\u9078\u629e"},getBackListTitle:function(){return""},getTextGroup:function(){return s.STORY_TEXT_GROUP.CATEGORY},_setListContent:function(t){for(var e in t.getStoryInfoMap())this._addThumbnail(e)},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("StoryThumbnail");e.setCallbackToThumbnail(function(){this._callbackToThumbnail(t)}.bind(this)),e.setThumbnailImage(a.getFileNameStoryCategoryThumbnail(t)),n.hasNewReleasedStoryCategory(t)&&o.addNoticeBadge(e.node,c.POSITION,c.SCALE),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){this._root.pushStoryListView(t,null,null,null)}});cc._RF.pop()},{NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",ResourceUtils:"ResourceUtils",StoryConst:"StoryConst",StoryListViewBase:"StoryListViewBase",ViewUtils:"ViewUtils"}],StoryCategoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"53a2aW3+R5KT5xy92HYUj3b","StoryCategoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getStoryCategory:function(){if(this._isKeyFieldAvailable("storyCategory"))return this._data.storyCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyCategory")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryConst:[function(t,e,i){"use strict";cc._RF.push(e,"5c026g+1HFMNp3iptguUnNt","StoryConst");cc.Class({statics:{STORY_TYPE_CATEGORY:"STORY_TYPE_CATEGORY",STORY_TYPE_AREA:"STORY_TYPE_AREA",STORY_TYPE_STAGE:"STORY_TYPE_STAGE",STORY_TEXT_GROUP:cc.Enum({CATEGORY:0,WORLD:1,AREA:2,STAGE:3,EVENT:4,SCENARIO:5}),STORY_CATEGORY:cc.Enum({MAIN:1,EVENT:2,OTHER:3,ROOM:4,PICTURE_BOOK:5,TUTORIAL:6}),STORY_GROUP_PICTURE_BOOK:cc.Enum({BASE:501,DETAIL:502}),STORY_GROUP_TUTORIAL:1}});cc._RF.pop()},{}],StoryEventModel:[function(t,e,i){"use strict";cc._RF.push(e,"13d22my1NxImbtnG9+uG3Sp","StoryEventModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getReleaseStoryId:function(){if(this._isKeyFieldAvailable("releaseStoryId"))return this._data.releaseStoryId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: releaseStoryId")},getResourceId:function(){if(this._isKeyFieldAvailable("resourceId"))return this._data.resourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resourceId")},getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getPlayType:function(){if(this._isKeyFieldAvailable("playType"))return this._data.playType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: playType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryGroupListView:[function(t,e,i){"use strict";cc._RF.push(e,"e8bb1VMrGBDeaUDd4TVpM+5","StoryGroupListView");var a=t("StoryUtils"),n=(t("PopupUtils"),t("StoryConst")),o=t("StoryListViewBase");cc.Class({extends:o,getListTitle:function(){return"\u30a4\u30d9\u30f3\u30c8\u9078\u629e"},getBackListTitle:function(){return"\u30ab\u30c6\u30b4\u30ea\u9078\u629e"},getTextGroup:function(){return n.STORY_TEXT_GROUP.EVENT},_setListContent:function(t){for(var e in t.getStoryInfoMap()[t.getCurrentStoryCategory()])this._addThumbnail(e)},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("StoryThumbnail");e.setCallbackToThumbnail(function(){this._callbackToThumbnail(t)}.bind(this)),e.setThumbnailText(a.getStoryGroupMasterMap()[t].getName()),e.setReleaseCount(this._root.getStoryInfoMap()[this._root.getCurrentStoryCategory()][t].releaseStoryCount,this._root.getStoryInfoMap()[this._root.getCurrentStoryCategory()][t].storyInfoArray.length),e.switchActive(!0),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){this._root.pushStoryListView(this._root.getCurrentStoryCategory(),t,null,null)}});cc._RF.pop()},{PopupUtils:"PopupUtils",StoryConst:"StoryConst",StoryListViewBase:"StoryListViewBase",StoryUtils:"StoryUtils"}],StoryGroupModel:[function(t,e,i){"use strict";cc._RF.push(e,"bb0d51xQOlIQr9Aj2vse7KS","StoryGroupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getStoryCategory:function(){if(this._isKeyFieldAvailable("storyCategory"))return this._data.storyCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyCategory")},getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryListSwitchView:[function(t,e,i){"use strict";cc._RF.push(e,"f9ec7WGzA1HpJo5nCPPTkVn","StoryListSwitchView");var a=t("CommonButton"),n=t("StoryConst"),o=t("StoryListViewBase"),r=cc.Enum({CATEGORY:0,GROUP:1,EVENT:2,WORLD:3,AREA:4,STAGE:5,TUTORIAL:6});cc.Class({extends:cc.Component,properties:{listTitleLabel:cc.Label,backListTitleLabel:cc.Label,backListBtn:a,storyListViewArray:[o]},_root:null,_currentStoryListView:null,onLoad:function(){this.backListBtn.setTapEvent(this._onTapBackListBtn.bind(this),a.SE_NAME.CANCEL)},initStoryListSwitchView:function(t){this._root=t,this._switchListViewContent(t)},getCurrentTextGroup:function(){return this._currentStoryListView.getTextGroup()},_switchListViewContent:function(t){this._resetStoryListView(),this._currentStoryListView=this._getStoryListView(t.getCurrentStoryCategory(),t.getCurrentStoryGroupId(),t.getCurrentStoryWorldId(),t.getCurrentStoryAreaId()),this.listTitleLabel.string=this._currentStoryListView.getListTitle(),this.backListBtn.node.active=!!this._currentStoryListView.getBackListTitle(),this.backListTitleLabel.string=this._currentStoryListView.getBackListTitle(),this._currentStoryListView.initListView(t)},_resetStoryListView:function(){this._currentStoryListView&&this._currentStoryListView.resetListView()},_getStoryListView:function(t,e,i,a){switch(t){case n.STORY_CATEGORY.MAIN:return i&&a?this.storyListViewArray[r.STAGE]:i?this.storyListViewArray[r.AREA]:this.storyListViewArray[r.WORLD];case n.STORY_CATEGORY.EVENT:case n.STORY_CATEGORY.OTHER:return e?e===n.STORY_GROUP_TUTORIAL?this.storyListViewArray[r.TUTORIAL]:this.storyListViewArray[r.EVENT]:this.storyListViewArray[r.GROUP]}return this.storyListViewArray[r.CATEGORY]},_onTapBackListBtn:function(){this._root.popScene()}});cc._RF.pop()},{CommonButton:"CommonButton",StoryConst:"StoryConst",StoryListViewBase:"StoryListViewBase"}],StoryListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"0f63fxMWYhMU44Rw0CuO+kx","StoryListViewBase");var a=t("ListViewBase");t("CommonScrollView"),t("StoryConst"),cc.Class({extends:a,getListTitle:function(){return cc.error("getListTitle() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),""},getBackListTitle:function(){return cc.error("getBackListTitle() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),""},getTextGroup:function(){return cc.error("getTextGroup() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9"),-1}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",ListViewBase:"ListViewBase",StoryConst:"StoryConst"}],StoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"98597a3mqlDXYzki7cIPXja","StoryModel");var a=t("UserStoryModel"),n=t("Singleton"),o=t("StoryConst"),r=t("RoomConst");cc.Class({userData:void 0,_storyCategoryMaster:void 0,_storyGroupMaster:void 0,_storyMaster:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._storyCategoryMaster=null,this._storyGroupMaster=null,this._storyMaster=null},getStoryMaster:function(){return this._initStoryEventMaster(),this._initStoryQuestMaster(),this._initStoryOtherMaster(),this._initStoryRoomMaster(),this._initStoryPictureBookMaster(),this._initStoryVoiceMaster(),this._initStoryTutorialMaster(),this._storyMaster},_initStoryEventMaster:function(){this._storyMaster||(this._storyMaster=n.dao.StoryEventMasters.find(function(t){return t.getStoryId()===this.userData.getStoryId()}.bind(this)))},_initStoryQuestMaster:function(){this._storyMaster||(this._storyMaster=n.dao.StoryQuestMasters.find(function(t){return t.getStoryId()===this.userData.getStoryId()}.bind(this)))},_initStoryOtherMaster:function(){this._storyMaster||(this._storyMaster=n.dao.StoryOtherMasters.find(function(t){return t.getStoryId()===this.userData.getStoryId()}.bind(this)))},_initStoryRoomMaster:function(){this._storyMaster||(this._storyMaster=n.dao.StoryRoomMasters.find(function(t){return t.getStoryId()===this.userData.getStoryId()}.bind(this)))},_initStoryPictureBookMaster:function(){this._storyMaster||(this._storyMaster=n.dao.StoryPictureBookMasters.find(function(t){return t.getStoryId()===this.userData.getStoryId()}.bind(this)))},_initStoryVoiceMaster:function(){this._storyMaster||(this._storyMaster=n.dao.StoryVoiceMasters.find(function(t){return t.getStoryId()===this.userData.getStoryId()}.bind(this)))},_initStoryTutorialMaster:function(){this._storyMaster||(this._storyMaster=n.dao.StoryTutorialMasters.find(function(t){return t.getStoryId()===this.userData.getStoryId()}.bind(this)))},getStoryGroupMaster:function(){return this._storyGroupMaster||(this._storyGroupMaster=n.dao.StoryGroupMasters.find(function(t){return t.getStoryGroupId()===this.getStoryGroupId()}.bind(this))),this._storyGroupMaster},getStoryCategoryMaster:function(){return this._storyCategoryMaster||(this._storyCategoryMaster=n.dao.StoryCategoryMaster.find(function(t){return t.getStoryCategory()===this.getStoryMaster().getStoryCategory()}.bind(this))),this._storyCategoryMaster},getStoryId:function(){return this.userData.getStoryId()},getIsRead:function(){return this.userData.getIsRead()},getStoryGroupId:function(){return this.getStoryMaster().getStoryGroupId()},getStoryCategory:function(){return this.getStoryGroupMaster().getStoryCategory()},getStoryName:function(){return this.getStoryMaster().getName()},getResourceId:function(){return this.getStoryMaster().getResourceId()},getLightResourceId:function(){return this.getStoryMaster().getLightResourceId?this.getStoryMaster().getLightResourceId():0},getContentMaster:function(){return this._characterContentsMaster||(this._characterContentsMaster=n.dao.CharacterContentsMasters.find(function(t){return t.getConditionType1()===r.RELEASE_CONDITION_TYPE.STORY&&t.getConditionValue1()===this.getStoryId()||t.getConditionType2()===r.RELEASE_CONDITION_TYPE.STORY&&t.getConditionValue2()===this.getStoryId()}.bind(this))),this._characterContentsMaster},getNextStoryMaster:function(){switch(this.getStoryCategory()){case o.STORY_CATEGORY.PICTURE_BOOK:break;default:return 0}if(void 0===this._nextStoryMaster||null===this._nextStoryMaster){var t=this.getContentMaster();this._nextStoryMaster=t?n.dao.StoryPictureBookMasters.find(function(e){return e.getStoryId()===t.getStoryId()}):0}return this._nextStoryMaster},getNextStoryId:function(){if(!this.getNextStoryMaster())return 0;var t=this.getContentMaster();if(!t)return 0;var e=_.find(n.dao.pictureBookDetail,function(e){return e.getCharacterId()===t.getContentsGroupId()}),i=_.filter(n.dao.userStories,function(t){return t.getStoryCategory()===o.STORY_CATEGORY.PICTURE_BOOK});return this._isNewReleaseContent(t,e,i)?t.getStoryId():0},_isNewReleaseContent:function(t,e,i){if(_.find(i,function(e){return e.getStoryId()===t.getStoryId()}))return!1;for(var a=0;a<r.CONTENTS_RELEASE_CONDITION_MAX_COUNT;a+=1)if(!this._isClearedCondition(a+1,t,e,i))return!1;return!0},_isClearedCondition:function(t,e,i,a){var n;switch(e["getConditionType"+t].apply(e)){case r.RELEASE_CONDITION_TYPE.FRIENDSHIP:return e["getConditionValue"+t].apply(e)<=i.getFriendship();case r.RELEASE_CONDITION_TYPE.EXCEEDLIMIT:return e["getConditionValue"+t].apply(e)<=i.getExceedLimit();case r.RELEASE_CONDITION_TYPE.STORY:return n=e["getConditionValue"+t].apply(e),!!_.find(a,function(t){return t.getStoryId()===n}).getIsRead();default:return!0}}});cc._RF.pop()},{RoomConst:"RoomConst",Singleton:"Singleton",StoryConst:"StoryConst",UserStoryModel:"UserStoryModel"}],StoryOtherModel:[function(t,e,i){"use strict";cc._RF.push(e,"3c08bNBlhdAuppPb7RXM3lR","StoryOtherModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getResourceId:function(){if(this._isKeyFieldAvailable("resourceId"))return this._data.resourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resourceId")},getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: eventId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getPlayType:function(){if(this._isKeyFieldAvailable("playType"))return this._data.playType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: playType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryPictureBookModel:[function(t,e,i){"use strict";cc._RF.push(e,"96532fcso9Dw44azPJyeB1o","StoryPictureBookModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");cc.Class({extends:a,getRewardCount:function(){if(this._isKeyFieldAvailable("rewardCount"))return this._data.rewardCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardCount")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")},getLightResourceId:function(){if(this._isKeyFieldAvailable("lightResourceId"))return this._data.lightResourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lightResourceId")},getResourceId:function(){if(this._isKeyFieldAvailable("resourceId"))return this._data.resourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resourceId")},getRewardType:function(){if(this._isKeyFieldAvailable("rewardType"))return this._data.rewardType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardType")},getRewardId:function(){if(this._isKeyFieldAvailable("rewardId"))return this._data.rewardId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryPlayConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"03d58JmT8dK+5TOscLG689h","StoryPlayConfirmPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{continuousPlayBtn:n,playBtn:n,cancelBtn:n},_storyInfo:null,_callbackToPlayBtn:null,onLoad:function(){this.continuousPlayBtn.setTapEvent(this._onTapContinuousPlayBtn.bind(this)),this.playBtn.setTapEvent(this._onTapPlayBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCloseBtn.bind(this),n.SE_NAME.CANCEL)},openStoryPlayConfirmPopup:function(t,e){this._initStoryPlayConfirmPopup(t,e),this.open()},_initStoryPlayConfirmPopup:function(t,e){this._storyInfo=t,this._callbackToPlayBtn=e,this.continuousPlayBtn.switchBtnImage(!1)},_onTapContinuousPlayBtn:function(){this.continuousPlayBtn.switchBtnImage(!this.continuousPlayBtn.getBtnImageSwitchState())},_onTapPlayBtn:function(){this._callbackToPlayBtn(this._storyInfo.userStoryModel,this.continuousPlayBtn.getBtnImageSwitchState())},_onTapCloseBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],StoryPlayEventListView:[function(t,e,i){"use strict";cc._RF.push(e,"3df025Ml1lK6YUvXfRMu62X","StoryPlayEventListView");var a=t("StoryConst"),n=t("Singleton"),o=t("StoryPlayListViewBase"),r=t("QuestConditionUtils");cc.Class({extends:o,getListTitle:function(){return"\u30b9\u30c8\u30fc\u30ea\u30fc\u9078\u629e"},getBackListTitle:function(){return"\u30a4\u30d9\u30f3\u30c8\u9078\u629e"},getTextGroup:function(){return a.STORY_TEXT_GROUP.SCENARIO},_setListContent:function(t){var e=t.getStoryInfoMap()[t.getCurrentStoryCategory()][t.getCurrentStoryGroupId()].storyInfoArray;for(var i in e)this._addThumbnail(e[i]);t.setStoryInforArray(e)},_addThumbnail:function(t){if(!this._isStoryQuestInPeriod(t.storyMaster.getEventId(),t.storyMaster.getStageId())||t.userStoryModel||t.userStageModel){var e=cc.instantiate(this.thumbnailPrefab).getComponent("StoryThumbnail");e.setCallbackToThumbnail(function(){this._callbackToThumbnail(t)}.bind(this)),e.setThumbnailText(t.storyMaster.getName()),t.userStoryModel?(e.switchActive(!0),e.switchIsNew(!t.userStoryModel.getIsRead())):e.switchActive(!1),this.thumbnailParentNode.addChild(e.node)}},_callbackToThumbnail:function(t){t.userStoryModel?this._root.openStoryPlayConfirmPopup(t):this._isStoryQuestInPeriod(t.storyMaster.getEventId(),t.storyMaster.getStageId())?this._root.openStoryReleaseConditionPopup(t):this._root.openStoryReleaseEventConditionPopup(t)},_isStoryQuestInPeriod:function(t,e){var i=_.find(n.dao.QuestStageMasters,function(t){return t.getStageId()===e});return r.isEventOnPeriod(t)&&r.isStageOnPeriod(i)}});cc._RF.pop()},{QuestConditionUtils:"QuestConditionUtils",Singleton:"Singleton",StoryConst:"StoryConst",StoryPlayListViewBase:"StoryPlayListViewBase"}],StoryPlayListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"1ccceeBKvBMZppmTnBk1U1S","StoryPlayListViewBase");var a=t("StoryListViewBase");cc.Class({extends:a,_addThumbnail:function(t){if(t.userStoryModel||t.userStageModel){var e=cc.instantiate(this.thumbnailPrefab).getComponent("StoryThumbnail");e.setCallbackToThumbnail(function(){this._callbackToThumbnail(t)}.bind(this)),e.setThumbnailText(t.storyMaster.getName()),t.userStoryModel?(e.switchActive(!0),e.switchIsNew(!t.userStoryModel.getIsRead())):e.switchActive(!1),this.thumbnailParentNode.addChild(e.node)}},_callbackToThumbnail:function(t){t.userStoryModel?this._root.openStoryPlayConfirmPopup(t):this._root.openStoryReleaseConditionPopup(t)}});cc._RF.pop()},{StoryListViewBase:"StoryListViewBase"}],StoryPlayStageListView:[function(t,e,i){"use strict";cc._RF.push(e,"49a51mVxrhLDrnALQOcD9/E","StoryPlayStageListView");t("QuestUtils"),t("Singleton");var a=t("StoryConst"),n=t("StoryPlayListViewBase");cc.Class({extends:n,getListTitle:function(){return"\u30b9\u30c6\u30fc\u30b8\u9078\u629e"},getBackListTitle:function(){return"\u30a8\u30ea\u30a2\u9078\u629e"},getTextGroup:function(){return a.STORY_TEXT_GROUP.STAGE},_setListContent:function(t){var e=t.getStoryInfoMap()[t.getCurrentStoryCategory()][t.getCurrentStoryWorldId()][t.getCurrentStoryAreaId()].storyInfoArray;for(var i in e)this._addThumbnail(e[i]);t.setStoryInforArray(e)}});cc._RF.pop()},{QuestUtils:"QuestUtils",Singleton:"Singleton",StoryConst:"StoryConst",StoryPlayListViewBase:"StoryPlayListViewBase"}],StoryPlayTutorialListView:[function(t,e,i){"use strict";cc._RF.push(e,"ce3d4Os76hMV5yvg/J+3Zrs","StoryPlayTutorialListView");var a=t("StoryConst"),n=t("StoryPlayListViewBase");t("EventUtils"),cc.Class({extends:n,getListTitle:function(){return"\u30b9\u30c8\u30fc\u30ea\u30fc\u9078\u629e"},getBackListTitle:function(){return"\u30a4\u30d9\u30f3\u30c8\u9078\u629e"},getTextGroup:function(){return a.STORY_TEXT_GROUP.SCENARIO},_setListContent:function(t){var e=t.getStoryInfoMap()[t.getCurrentStoryCategory()][t.getCurrentStoryGroupId()].storyInfoArray;for(var i in e)this._addThumbnail(e[i]);t.setStoryInforArray(e)},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("StoryThumbnail");e.setCallbackToThumbnail(function(){this._callbackToThumbnail(t)}.bind(this)),e.setThumbnailText(t.storyMaster.getName()),t.userStoryModel?(e.switchActive(!0),e.switchIsNew(!t.userStoryModel.getIsRead())):e.switchActive(!1),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){t.userStoryModel&&this._root.openStoryPlayConfirmPopup(t)}});cc._RF.pop()},{EventUtils:"EventUtils",StoryConst:"StoryConst",StoryPlayListViewBase:"StoryPlayListViewBase"}],StoryQuestModel:[function(t,e,i){"use strict";cc._RF.push(e,"b3219XyWIBDfZh3bBPwQ7hr","StoryQuestModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getResourceId:function(){if(this._isKeyFieldAvailable("resourceId"))return this._data.resourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resourceId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getPlayType:function(){if(this._isKeyFieldAvailable("playType"))return this._data.playType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: playType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryReleaseConditionPopup:[function(t,e,i){"use strict";cc._RF.push(e,"747100N2LRPWpAs4jWRGy/u","StoryReleaseConditionPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("QuestUtils");cc.Class({extends:a,properties:{areaStageNameLabel:cc.Label,releaseConditionLabel:cc.Label,questStageThumbnailParentNode:cc.Node,questStageThumbnailPrefab:cc.Prefab,cancelBtn:n},_questStageMaster:null,_callbackToStageThumbnail:null,onLoad:function(){this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openStoryReleaseConditionPopup:function(t,e){this._initStoryReleaseConditionPopup(t,e),this.open()},_initStoryReleaseConditionPopup:function(t,e){this._questStageMaster=o.getStageMasterMap()[t.storyMaster.getStageId()],this._callbackToStageThumbnail=e,this.areaStageNameLabel.string=o.getAreaMasterMap()[this._questStageMaster.getAreaId()].getName()+" "+this._questStageMaster.getName(),this.releaseConditionLabel.string=this._questStageMaster.getName()+"\n"+this._getReleaseConditionSuffixText(t),this._initStageThumbnail(this._questStageMaster)},_initStageThumbnail:function(t){this.questStageThumbnailParentNode.active=!0;var e=cc.instantiate(this.questStageThumbnailPrefab).getComponent("QuestStageThumbnail");e.initQuestStageThumbnail(t,null,this._onTapStageThumbnail.bind(this)),this.questStageThumbnailParentNode.addChild(e.node)},_getReleaseConditionSuffixText:function(t){return 1===t.storyMaster.getPlayType()?"\u306b\u6311\u6226\u3059\u308b":"\u3092\u30af\u30ea\u30a2\u3059\u308b"},_onTapStageThumbnail:function(){this._callbackToStageThumbnail(this._questStageMaster)},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",QuestUtils:"QuestUtils"}],StoryReleaseEventConditionPopup:[function(t,e,i){"use strict";cc._RF.push(e,"681c3H4ykNL76MV7LVnthKl","StoryReleaseEventConditionPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("ItemUtils"),r=t("CommonUtils"),s=t("PopupUtils"),c=t("ResourceUtils"),l=t("ItemConst"),u=t("GameConst");cc.Class({extends:a,properties:{itemThumbnailParentNode:cc.Node,itemThumbnailPrefab:cc.Prefab,keyItemNameLabel:cc.Label,remainingNumLabel:cc.Label,afterRemainingNumLabel:cc.Label,releaseBtn:n,cancelBtn:n},_root:null,_storyInfo:null,_keyItemCount:0,_keyItemMaster:null,_callback:null,onLoad:function(){this.releaseBtn.setTapEvent(this._onTapReleaseBtn.bind(this),n.SE_NAME.CANCEL),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL)},openStoryReleaseEventConditionPopup:function(t,e,i){this._root=t,this._storyInfo=e,this._callback=i,this._keyItemCount=Math.max(o.getUserItemCount(l.RELEASE_EVENT_STORY_TICKET),0),this._keyItemMaster=o.getItemMaster(l.RELEASE_EVENT_STORY_TICKET),this._setParameter(),this.open()},_setParameter:function(){this.keyItemNameLabel.string=this._keyItemMaster.getName(),this.remainingNumLabel.string=r.convertToCommaDelimited(this._keyItemCount),this._keyItemCount>0?(this.remainingNumLabel.node.color=u.COLOR_STATE.NORMAL,this.releaseBtn.switchBtnImage(!0)):(this.remainingNumLabel.node.color=u.COLOR_STATE.ALERT,this.releaseBtn.switchBtnImage(!1)),this.afterRemainingNumLabel.string=r.convertToCommaDelimited(Math.max(this._keyItemCount-1,0));var t=o.getItemMaster(l.RELEASE_EVENT_STORY_TICKET),e=cc.instantiate(this.itemThumbnailPrefab).getComponent("ItemMatrixThumbnail");this.itemThumbnailParentNode.addChild(e.node),t&&e.setMainImage(c.getFileNameThumbnailByItemType(t.getItemId(),t.getItemType()))},_executeRelease:function(){var t=this._storyInfo.storyMaster.getStoryId();this._callback&&this._callback(t,function(){s.openCommonPopupOk("\u30a4\u30d9\u30f3\u30c8\u30b7\u30ca\u30ea\u30aa\u89e3\u653e",this._storyInfo.storyMaster.getName()+"\u306e\n\u30b7\u30ca\u30ea\u30aa\u304c\u958b\u653e\u3055\u308c\u307e\u3057\u305f\u3002"),this._root.redraw()}.bind(this))},_confirmExchange:function(){s.openCommonPopupYesNo("\u30a2\u30a4\u30c6\u30e0\u4e0d\u8db3\u78ba\u8a8d","\u300c"+this._keyItemMaster.getName()+"\u300d\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\u4ea4\u63db\u6240\u3078\u884c\u304d\u307e\u3059\u304b\uff1f","",!1,function(){this._root.pushScene("ExchangeScene",this._root.getCurrentSceneName(),void 0,this._root.createPreViewParam()),this.close()}.bind(this),function(){},"\u306f\u3044","\u3044\u3044\u3048")},_onTapReleaseBtn:function(){this._keyItemCount>0?this._executeRelease():this._confirmExchange(),this.node.removeFromParent(!0)},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils"}],StoryRoomModel:[function(t,e,i){"use strict";cc._RF.push(e,"5fa8dqlRZlEOKrfUn7dY+Ux","StoryRoomModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getResourceId:function(){if(this._isKeyFieldAvailable("resourceId"))return this._data.resourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resourceId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getCondition1:function(){if(this._isKeyFieldAvailable("condition1"))return this._data.condition1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: condition1")},getCondition2:function(){if(this._isKeyFieldAvailable("condition2"))return this._data.condition2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: condition2")},getRewardType:function(){if(this._isKeyFieldAvailable("rewardType"))return this._data.rewardType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardType")},getRewardId:function(){if(this._isKeyFieldAvailable("rewardId"))return this._data.rewardId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardId")},getRewardCount:function(){if(this._isKeyFieldAvailable("rewardCount"))return this._data.rewardCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardCount")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"25b06KfrMxJ5q98P+23c80b","StoryRootUtils");t("StorySubRoot");e.exports={openStorySubRoot:function(t,e){cc.log("openStorySubRoot"),cc.log(e),t.setStoryListViewParam(e.storyCategory,e.storyGroupId,e.storyWorldId,e.storyAreaId),t.storySubRoot||(t.storySubRoot=cc.instantiate(t.storySubRootPrefab).getComponent("StorySubRoot"),t.subRootParent.addChild(t.storySubRoot.node)),t.storySubRoot.initStorySubRoot(t)},closeStorySubRoot:function(t,e){cc.log("closeStorySubRoot"),cc.log(e),t.storySubRoot&&(t.storySubRoot.destroy(),t.storySubRoot=null)}},cc._RF.pop()},{StorySubRoot:"StorySubRoot"}],StoryRoot:[function(t,e,i){"use strict";cc._RF.push(e,"633e4JMhCVAraJdGyyq7eyq","StoryRoot");var a=t("OutGameRootBase"),n=t("StoryUtils"),o=(t("CommonUtils"),t("ResourceUtils")),r=t("Singleton"),s=t("ExtensionAdvUtils"),c=t("ExtensionAdvUtils"),l=t("PopupUtils"),u=t("QuestRootUtils"),h=t("StoryViewSetting"),d=t("StoryConst"),p=t("ItemConst"),m=t("SingletonConst");t("GameConst"),cc.Class({extends:a,properties:{storySubRootPrefab:cc.Prefab,storyPlayConfirmPopupPrefab:cc.Prefab,storyReleaseConditionPopupPrefab:cc.Prefab,storyReleaseEventConditionPopupPrefab:cc.Prefab},_storyInfoMap:null,_currentStoryCategory:null,_currentStoryWorldId:null,_currentStoryAreaId:null,_currentStoryGroupId:null,_storyPlayConfirmPopup:null,_storyReleaseConditionPopup:null,_storyReleaseEventConditionPopup:null,_storyInfoArray:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,h.STORY_SETTING)},initData:function(){this.reload()},initialize:function(){this.initOutGameRootBase();var t={StorySubRoot:{storyCategory:void 0,storyGroupId:void 0,storyWorldId:void 0,storyAreaId:void 0}};this._initOpenFirstView(t)},reload:function(){this._storyInfoMap=n.createStoryInfoMap()},redraw:function(){this.reload();var t=this.getCurrentStoryCategory(),e=this.getCurrentStoryGroupId(),i=this.getCurrentStoryWorldId(),a=this.getCurrentStoryAreaId();this.pushStoryListView(t,e,i,a),this.popScene(!0)},getStoryInfoMap:function(){return this._storyInfoMap},getCurrentStoryCategory:function(){return this._currentStoryCategory},getCurrentStoryGroupId:function(){return this._currentStoryGroupId},getCurrentStoryWorldId:function(){return this._currentStoryWorldId},getCurrentStoryAreaId:function(){return this._currentStoryAreaId},getStoryInforArray:function(){return this._storyInfoArray},setStoryInforArray:function(t){this._storyInfoArray=t},setStoryListViewParam:function(t,e,i,a){this._currentStoryCategory=t?parseInt(t):t,this._currentStoryGroupId=e?parseInt(e):e,this._currentStoryWorldId=i?parseInt(i):i,this._currentStoryAreaId=a?parseInt(a):a},pushStoryListView:function(t,e,i,a){var n={StorySubRoot:{storyCategory:t,storyGroupId:e,storyWorldId:i,storyAreaId:a}},o={StorySubRoot:{storyCategory:this.getCurrentStoryCategory(),storyGroupId:this.getCurrentStoryGroupId(),storyWorldId:this.getCurrentStoryWorldId(),storyAreaId:this.getCurrentStoryAreaId()}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),n,o)},openStoryPlayConfirmPopup:function(t){this.closeStoryPlayConfirmPopup(),this._storyPlayConfirmPopup=cc.instantiate(this.storyPlayConfirmPopupPrefab).getComponent("StoryPlayConfirmPopup"),this._storyPlayConfirmPopup.openStoryPlayConfirmPopup(t,this.transitionAdvScene.bind(this))},closeStoryPlayConfirmPopup:function(){this._storyPlayConfirmPopup&&(this._storyPlayConfirmPopup.close(),this._storyPlayConfirmPopup=null)},openStoryReleaseConditionPopup:function(t){this.closeStoryReleaseConditionPopup(),this._storyReleaseConditionPopup=cc.instantiate(this.storyReleaseConditionPopupPrefab).getComponent("StoryReleaseConditionPopup"),this._storyReleaseConditionPopup.openStoryReleaseConditionPopup(t,this.transitionQuestScene.bind(this))},closeStoryReleaseConditionPopup:function(){this._storyReleaseConditionPopup&&(this._storyReleaseConditionPopup.close(),this._storyReleaseConditionPopup=null)},openStoryReleaseEventConditionPopup:function(t){this.closeStoryReleaseEventConditionPopup(),this._storyReleaseEventConditionPopup=cc.instantiate(this.storyReleaseEventConditionPopupPrefab).getComponent("StoryReleaseEventConditionPopup"),this._storyReleaseEventConditionPopup.openStoryReleaseEventConditionPopup(this,t,this.requestReleaseEventStory.bind(this))},closeStoryReleaseEventConditionPopup:function(){this._storyReleaseEventConditionPopup&&(this._storyReleaseEventConditionPopup.close(),this._storyReleaseEventConditionPopup=null)},transitionQuestScene:function(t){if(!t)return l.openSimpleMessageWindow("\u30b9\u30c6\u30fc\u30b8\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");if(!_.find(r.dao.QuestWorldMasters,function(e){return e.getWorldId()===t.getWorldId()}))return l.openSimpleMessageWindow("\u30ef\u30fc\u30eb\u30c9\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");var e=u.createBattleStartTransitionParams(t.getStageId());if(!e)return l.openSimpleMessageWindow("\u30af\u30a8\u30b9\u30c8\u958b\u50ac\u671f\u9593\u5916\u3067\u3059\u3002");var i=this.createPreViewParam();this.pushScene(e.sceneName,this.getCurrentSceneName(),e.viewParam,i)},transitionAdvScene:function(t,e){var i=t.getStoryId(),a=t.getNextStoryId(),n=this.createPreViewParam(),o=this._createPlayUserStoryModelArray(t,e);this.requestReadStory(this._getStoryIds(o),function(){c.startAdv(i,r[m.ENVIRONMENT].getAdultFlg()?1:0,this._createAdvTextSetArray(o),r.dao.userBasicData.getUserName(),null,function(){this._reTransitionStoryScene(a,n)}.bind(this))}.bind(this))},_reTransitionStoryScene:function(t,e){t&&!n.isReleasedStory(t)?r.StoryService.addStory(t,function(t){this.pushScene("StoryScene",null,e,null)}.bind(this)):this.pushScene("StoryScene",null,e,null)},_createPlayUserStoryModelArray:function(t,e){var i=[];if(e)for(var a=n.getUserStoryModelArrayByStoryGroupId(t.getStoryGroupId()),o=this.getStoryInforArray(),r=!1,s=0;s<o.length;s++){var c=o[s];if(c.userStoryModel){var l=c.userStoryModel.getStoryId();if(t.getStoryId()===l)r=!0;else if(!r)continue;var u=a.filter(function(t){return t.getStoryId()===l});i.push.apply(i,u)}}else i=[t];return i},_createAdvTextSetArray:function(t){var e=[];for(var i in t){var a,n,r=t[i],c=r.getStoryId(),l=r.getResourceId(),u=(r.getNextStoryId(),r.getStoryCategory()),h=r.getStoryGroupId();switch(u){case d.STORY_CATEGORY.MAIN:a=o.getFileNameStoryQuestScript(h,l),n=o.getFileNameStoryQuestSynopsis(h,l);break;case d.STORY_CATEGORY.EVENT:a=o.getFileNameStoryEventScript(h,l),n=o.getFileNameStoryEventSynopsis(h,l);break;case d.STORY_CATEGORY.OTHER:a=o.getFileNameStoryOtherScript(h,l),n=o.getFileNameStoryOtherSynopsis(h,l);break;case d.STORY_CATEGORY.TUTORIAL:a=o.getFileNameTutorialScript(l),n=o.getFileNameTutorialSynopsis(l)}e.push(s.createAdvTextInfo(c,a,n))}return e},createPreViewParam:function(){var t={};return this.storySubRoot&&(t.StorySubRoot={}),t=this._addPreViewParam(t)},_addPreViewParam:function(t){for(var e in t)t[e].storyCategory=this.getCurrentStoryCategory(),t[e].storyGroupId=this.getCurrentStoryGroupId(),t[e].storyWorldId=this.getCurrentStoryWorldId(),t[e].storyAreaId=this.getCurrentStoryAreaId();return t},requestReadStory:function(t,e){r.StoryService.readStory(t,function(t){e&&e()})},requestReleaseEventStory:function(t,e){r.ItemService.use(p.RELEASE_EVENT_STORY_TICKET,1,t,e)},_getStoryIds:function(t){return t.map(function(t){return t.getStoryId()})}});cc._RF.pop()},{CommonUtils:"CommonUtils",ExtensionAdvUtils:"ExtensionAdvUtils",GameConst:"GameConst",ItemConst:"ItemConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",QuestRootUtils:"QuestRootUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",StoryConst:"StoryConst",StoryUtils:"StoryUtils",StoryViewSetting:"StoryViewSetting"}],StoryService:[function(t,e,i){"use strict";cc._RF.push(e,"2c25dx1tu5Lz7yHoM+R7la+","StoryService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,addStory:function(t,e){var i={storyId:t};this._requestCallApi(n.STORY_ADD_STORY,i,function(t,i){return e(t?void 0:i)})},readStory:function(t,e){var i={storyIdArray:Array.isArray(t)?t:[t]};this._requestCallApi(n.STORY_READ_STORY,i,function(t,i){return e(t?void 0:i)})},getStoryResource:function(t,e,i){var a={storyIds:t.join(","),adult:e||0};this._requestCallApi(n.STORY_GET_RESOURCE,a,function(t,e){return i(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],StorySubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"a9963LP8jJJw7WbROsYEPwK","StorySubRoot");t("Singleton"),t("ResourceUtils"),t("GameConst");var a=t("ViewUtils"),n=t("CharacterConst"),o=t("PictureBookUtils"),r=t("CharacterUtils"),s=t("StoryListSwitchView");cc.Class({extends:cc.Component,properties:{characterStandViewParentNode:cc.Node,balloonParentNode:cc.Node,storyListSwitchView:s},_root:null,_characterStandView:null,_serifBalloon:null,initStorySubRoot:function(t){this._root=t;var e=this._root.getNavigatorCharacterId();this._initCharacterStandView(),this._setCharacterStandImage(e),this._switchListView(t),this._initSerifWindow(e),this.redraw()},redraw:function(){},_initCharacterStandView:function(){this._characterStandView||(this._characterStandView=a.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_initSerifWindow:function(t){this._addSerifWindow(),this._setSerifContent(t,this.storyListSwitchView.getCurrentTextGroup())},_addSerifWindow:function(){this._serifBalloon||(this._serifBalloon=a.createSerifWindow(),this.balloonParentNode.addChild(this._serifBalloon.node))},_setSerifContent:function(t,e){var i=[],a=[];o.getCharacterTextMasterArray(t,n.TEXT_SCENE_TYPE.STORY,e).forEach(function(t){i.push(t.getText()),a.push(t.getVoiceFile())}),this._serifBalloon.setSerifContent(t,r.getCharacterMainModelByCharacterId(t).getShortName(),i,a),this._serifBalloon.playRandomSerifAnimation()},_setCharacterStandImage:function(t){this._characterStandView.setCharacterStandImage(t)},_switchListView:function(t){this.storyListSwitchView.initStoryListSwitchView(t)}});cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",GameConst:"GameConst",PictureBookUtils:"PictureBookUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StoryListSwitchView:"StoryListSwitchView",ViewUtils:"ViewUtils"}],StoryThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"23dffE7C1BCh7prn7uA7WkY","StoryThumbnail");var a=t("CommonButton"),n=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{imageSprite:cc.Sprite,textLabel:cc.Label,numeLabel:cc.Label,denomLabel:cc.Label,releaseCountParentNode:cc.Node,isNewNode:cc.Node,glayoutNode:cc.Node,thumbnailBtn:a},_callbackToThumbnailBtn:null,onLoad:function(){this.thumbnailBtn.setTapEvent(this._onTapThumbnailBtn.bind(this))},setThumbnailImage:function(t){n.addSprite(this.imageSprite,t)},setThumbnailText:function(t){this.textLabel.string=t},setReleaseCount:function(t,e){this.numeLabel.string=t+"",this.denomLabel.string=e+"",this.releaseCountParentNode.active=!0},switchIsNew:function(t){this.isNewNode.active=t},switchActive:function(t){this.glayoutNode.active=!t,this.thumbnailBtn.switchBtnImage(t)},setCallbackToThumbnail:function(t){this._callbackToThumbnailBtn=t},_onTapThumbnailBtn:function(){this._callbackToThumbnailBtn()}});cc._RF.pop()},{CommonButton:"CommonButton",ResourceUtils:"ResourceUtils"}],StoryTutorialModel:[function(t,e,i){"use strict";cc._RF.push(e,"d1f9adAlCJDMqgCczOUGuUd","StoryTutorialModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getResourceId:function(){if(this._isKeyFieldAvailable("resourceId"))return this._data.resourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resourceId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryUtils:[function(t,e,i){"use strict";cc._RF.push(e,"4e0f5BeNlZKrYKK2TPHkIUV","StoryUtils");var a=t("Singleton"),n=t("StoryConst"),o=t("TimeUtils");function r(){var t={},e=a.dao.QuestStageMasters;for(var i in e)t[e[i].getStageId()]=e[i];return t}function s(){var t={},e=a.dao[a.USER_QUEST];for(var i in e)t[e[i].getStageId()]=e[i];return t}function c(){var t={},e=a.dao.StoryGroupMasters;for(var i in e)t[e[i].getStoryGroupId()]=e[i];return t}function l(t,e,i){e=e||d(),i=i||s();var a={},n=p(t),o=r();for(var c in n){var l=n[c].getStageId(),u=o[l].getAreaId(),h=o[l].getWorldId();a[h]||(a[h]={}),a[h][u]||(a[h][u]={storyInfoArray:[],userStageModelMap:{},releaseStoryCount:0});var m=n[c].getStoryId();a[h][u].storyInfoArray.push(g(n[c],e[m],i[l])),i[l]&&(a[h][u].userStageModelMap[l]=i[l]),e[m]&&(a[h][u].releaseStoryCount+=1)}return a}function u(t,e,i){e=e||d(),i=i||s();var r={},c=p(t);for(var l in t===n.STORY_CATEGORY.EVENT&&(c=_.filter(c,function(t){var e=_.find(a.dao.EventMainMasters,function(e){return e.getEventId()===t.getEventId()});return!!e&&o.isRangeOfDate(e.getFromDate(),void 0)})),c){var u=c[l].getStageId(),h=c[l].getStoryGroupId();r[h]||(r[h]={storyInfoArray:[],userStageModelMap:{},releaseStoryCount:0});var m=c[l].getStoryId();r[h].storyInfoArray.push(g(c[l],e[m],i[u])),i[u]&&(r[h].userStageModelMap[u]=i[u]),e[m]&&(r[h].releaseStoryCount+=1)}return r}function h(t){t=t||d();var e={},i=p(n.STORY_CATEGORY.TUTORIAL);for(var a in i=_.filter(i,function(t){return t.getStoryGroupId()===n.STORY_GROUP_TUTORIAL})){var o=i[a].getStoryGroupId();e[o]||(e[o]={storyInfoArray:[],userStageModelMap:{},releaseStoryCount:0});var r=i[a].getStoryId();e[o].storyInfoArray.push(g(i[a],t[r],null)),t[r]&&(e[o].releaseStoryCount+=1)}return e}function d(){var t={},e=a.dao.userStories;for(var i in e){var n=e[i];t[n.getStoryId()]=n}return t}function p(t){switch(t){case n.STORY_CATEGORY.MAIN:return a.dao.StoryQuestMasters;case n.STORY_CATEGORY.EVENT:return a.dao.StoryEventMasters;case n.STORY_CATEGORY.OTHER:return a.dao.StoryOtherMasters;case n.STORY_CATEGORY.ROOM:return a.dao.StoryRoomMasters;case n.STORY_CATEGORY.PICTURE_BOOK:return a.dao.StoryPictureBookMasters;case n.STORY_CATEGORY.TUTORIAL:return a.dao.StoryTutorialMasters}return[]}function m(){var t={},e=a.dao.StoryCategoryMasters;for(var i in e){var n=p(e[i].getStoryCategory());for(var o in n){var r=n[o];t[r.getStoryId()]=r}}return t}function g(t,e,i){return{storyMaster:t,userStoryModel:e,userStageModel:i}}e.exports={getStoryGroupMasterMap:function(){return c()},getStoryMasterFlatMap:function(){return m()},createStoryInfoMap:function(){var t={},e=d(),i=s();return t[n.STORY_CATEGORY.MAIN]=l(n.STORY_CATEGORY.MAIN,e,i),t[n.STORY_CATEGORY.EVENT]=u(n.STORY_CATEGORY.EVENT,e,i),t[n.STORY_CATEGORY.OTHER]=_.assign(h(e),u(n.STORY_CATEGORY.OTHER,e,i)),t},createQuestStoryInfoMap:l,getUserStoryModelArrayByStoryGroupId:function(t){return a.dao.userStories.filter(function(e){return e.getStoryGroupId()===t})},createUserStoryFlatMap:d,getUserStoryModelByStoryId:function(t){return a.dao.userStories.find(function(e){return e.getStoryId()===t})},isReleasedStory:function(t){return!!a.dao.userStories.find(function(e){return e.getStoryId()===t})}},cc._RF.pop()},{Singleton:"Singleton",StoryConst:"StoryConst",TimeUtils:"TimeUtils"}],StoryViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"3ded7sSwCdIi776d94GLJKx","StoryViewSetting");var a=t("StoryRootUtils");e.exports={STORY_SETTING:{StorySubRoot:{open:a.openStorySubRoot,close:a.closeStorySubRoot}}},cc._RF.pop()},{StoryRootUtils:"StoryRootUtils"}],StoryVoiceModel:[function(t,e,i){"use strict";cc._RF.push(e,"c9978pbx6VCbKVf3lyzuG3V","StoryVoiceModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStoryGroupId:function(){if(this._isKeyFieldAvailable("storyGroupId"))return this._data.storyGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyGroupId")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getResourceId:function(){if(this._isKeyFieldAvailable("resourceId"))return this._data.resourceId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: resourceId")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],StoryWorldListView:[function(t,e,i){"use strict";cc._RF.push(e,"28c50dn0dJHVbahPXR8BdDB","StoryWorldListView");var a=t("ResourceUtils"),n=t("QuestUtils"),o=t("StoryConst"),r=t("StoryListViewBase");cc.Class({extends:r,getListTitle:function(){return"\u30ef\u30fc\u30eb\u30c9\u9078\u629e"},getBackListTitle:function(){return"\u30ab\u30c6\u30b4\u30ea\u9078\u629e"},getTextGroup:function(){return o.STORY_TEXT_GROUP.WORLD},_setListContent:function(t){for(var e=n.getUserWorldArrayByWorldCategory(t.getCurrentStoryCategory()),i=0;i<e.length;i+=1)this._addThumbnail(e[i].getWorldId())},_addThumbnail:function(t){var e=cc.instantiate(this.thumbnailPrefab).getComponent("StoryThumbnail");e.setCallbackToThumbnail(function(){this._callbackToThumbnail(t)}.bind(this)),e.setThumbnailImage(a.getFileNameWorldSmallThumbnail(t)),e.setThumbnailText(n.getWorldMasterMap()[t].getName()),this.thumbnailParentNode.addChild(e.node)},_callbackToThumbnail:function(t){this._root.pushStoryListView(this._root.getCurrentStoryCategory(),null,t,null)}});cc._RF.pop()},{QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",StoryConst:"StoryConst",StoryListViewBase:"StoryListViewBase"}],SubMissionThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"b8889vbajxEgqcWlqaBUXZ5","SubMissionThumbnailView");var a=t("BattleData");cc.Class({extends:cc.Component,properties:{subMissionAnimation:cc.Animation,subMissionStarOnNodeArray:[cc.Node],subMissionLabel:cc.Label},_result:null,_idx:0,_beforeQuestData:null,_afterQuestData:null,initSubMissionThumbnailView:function(t,e,i,a){this._result=t,this._idx=e,this._beforeQuestData=i,this._afterQuestData=a;var n=this._getSubMission(e);1===n.isBeforeClearMission?this._setSubMissionStarOnNodeActive(!0):this._setSubMissionStarOnNodeActive(!1),this.subMissionLabel.string=n.master.getText()},playSubMissionSlidInAnimation:function(t){var e=cc.sequence(cc.delayTime(.3*this._idx),cc.callFunc(function(){this.subMissionAnimation.once("finished",function(e){return t(e)},this),this.subMissionAnimation.play(this.subMissionAnimation.getClips()[0].name),a.GM.soundManager.playSE(a.RM.soundResourceList.QuestAchieveSlidesIn)}.bind(this)));this._result.node.runAction(e)},playSubMissionStarAnimation:function(t){var e=this._getSubMission(this._idx);if(0!==e.isBeforeClearMission||1!==e.isAfterClearMission)return t();var i=cc.sequence(cc.delayTime(.1*this._idx),cc.callFunc(function(){this.subMissionAnimation.once("finished",function(e){return t(e)},this),this._setSubMissionStarOnNodeActive(!0),this.subMissionAnimation.play(this.subMissionAnimation.getClips()[1].name)}.bind(this)));this._result.node.runAction(i)},_setSubMissionStarOnNodeActive:function(t){for(var e=0;e<this.subMissionStarOnNodeArray.length;e+=1)this.subMissionStarOnNodeArray[e].active=t},_getSubMission:function(t){switch(t){case 0:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission1(),isAfterClearMission:this._afterQuestData.getIsClearMission1(),master:this._afterQuestData.getQuestAchieveMaster1()};case 1:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission2(),isAfterClearMission:this._afterQuestData.getIsClearMission2(),master:this._afterQuestData.getQuestAchieveMaster2()};case 2:return{isBeforeClearMission:this._beforeQuestData.getIsClearMission3(),isAfterClearMission:this._afterQuestData.getIsClearMission3(),master:this._afterQuestData.getQuestAchieveMaster3()}}}}),cc._RF.pop()},{BattleData:"BattleData"}],TabButton:[function(t,e,i){"use strict";cc._RF.push(e,"7ecf9b3R35B6KD6L6ZIYo3q","TabButton");var a=t("CommonButton");cc.Class({extends:a,properties:{nameLabelArray:[cc.Label],grayOutNode:cc.Node},initTabButton:function(t,e){for(var i in this.nameLabelArray)this.nameLabelArray[i].string=t;this.grayOutNode&&(this.grayOutNode.active=!e)}});cc._RF.pop()},{CommonButton:"CommonButton"}],TabViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"2f4b8JNNU5KvL4DHYoL4Suu","TabViewBase");var a=t("WindowBase"),n=t("CommonButton");cc.Class({extends:a,properties:{tabBtnArray:[n]},_iCurrentTab:0,_isInitialized:!1,_callbackToTabEvent:null,initTabViewBase:function(t){if(!this._isInitialized){for(var e=0;e<this.tabBtnArray.length;e++)this.setTabBtn(this.tabBtnArray[e],e,t);this._iCurrentTab=0,this._isInitialized=!0}},setTabBtn:function(t,e,i){t.node.name=""+e,t.setTapEvent(function(t){this._onClickTab(t)}.bind(this),i?"":n.SE_NAME.SELECT)},_setCurrentTab:function(t){(t=t||0)>=this.tabBtnArray.length?t=this.tabBtnArray.length-1:t<0&&(t=0),this._iCurrentTab=t},getCurrentTab:function(){return this._iCurrentTab},_onClickTab:function(t){var e=parseInt(t.target.name);if(this._iCurrentTab!==e){var i=this._iCurrentTab;this._tabEvent(t,e,i),this._callbackToTabEvent&&this._callbackToTabEvent(t,e,i),this._setCurrentTab(e)}},_tabEvent:function(t,e,i){cc.log("TabViewBase","selectedTab = "+e," recentTab = "+i)},setCallbackToTabEvent:function(t){this._callbackToTabEvent=t}});cc._RF.pop()},{CommonButton:"CommonButton",WindowBase:"WindowBase"}],TapEffectManager:[function(t,e,i){"use strict";cc._RF.push(e,"b7a0eNh7O5KMono/rAMT3tC","TapEffectManager");var a=t("GameConst");cc.Class({extends:cc.Component,properties:{tapEffectAnim:cc.Animation,animationNodeArray:[cc.Node]},init:function(){this._initNodeOpacity(),this._setTapEffect(),cc.director.getScene().getChildByName("Canvas").addChild(this.node,a.Z_ORDER.BAND)},_initNodeOpacity:function(){for(var t=0;t<this.animationNodeArray.length;t+=1)this.animationNodeArray[t].opacity=0},_setTapEffect:function(){this.tapEffectAnim.on("finished",function(){this.tapEffectAnim.node.active=!1}.bind(this),this),this.node.on(cc.Node.EventType.TOUCH_START,function(t){this.tapEffectAnim.node.active=!0,this._initNodeOpacity();var e=this.node.parent.convertToNodeSpace(t.getLocation());e.x-=.5*this.node.parent.getContentSize().width,e.y-=.5*this.node.parent.getContentSize().height,this.tapEffectAnim.node.setPosition(e),cc.director.isPaused()||this.tapEffectAnim.play()},this),this.node._touchListener.setSwallowTouches(!1)},hideTapEffect:function(){this.tapEffectAnim.node.active=!1}}),cc._RF.pop()},{GameConst:"GameConst"}],TemplateAdvSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"869fdI+pORBUqqGReOnFTqH","TemplateAdvSubRoot");var a=t("AdvSubRootBase"),n=t("AdvCommonButton"),o=t("AdvManager"),r=t("AdvConstants"),s=t("AdvSingleton");cc.Class({extends:a,properties:{soundMuteBtn:n,configBtn:n,autoBtn:n,skipBtn:n,logBtn:n,hideUiBtn:n},_loadUIResources:function(){o.requestAdvRes(r.ADV_POPUP_OPEN_ANIM_CLIP_PATH,cc.AnimationClip),o.requestAdvRes(r.ADV_POPUP_CLOSE_ANIM_CLIP_PATH,cc.AnimationClip)},_initButtons:function(){this.soundMuteBtn.switchBtnImage(!s.soundManager.soundMute),this.skipBtn.switchBtnImage(!1),this.autoBtn.switchBtnImage(!1),this.autoBtn.setTapEvent(this._autoBtnEvent.bind(this)),this.skipBtn.setTapEvent(this._skipBtnEvent.bind(this)),this.logBtn.setTapEvent(this._logBtnEvent.bind(this)),this.hideUiBtn.setTapEvent(this._hideUiBtnEvent.bind(this)),this.soundMuteBtn.setTapEvent(this._soundMuteBtnEvent.bind(this)),this.configBtn.setTapEvent(this._configBtnEvent.bind(this))},openLogPopup:function(){this.closeLogPopup(),this._advLogPopup=cc.instantiate(this.advLogPopupPrefab).getComponent("AdvLogPopup"),this._advLogPopup.openAdvLogPopup(this,o.getMessageLogList(),o.getVoiceLogMap())},closeLogPopup:function(){this._advLogPopup&&(this._advLogPopup.close(),this._advLogPopup=null)},openConfigPopup:function(){this.closeConfigPopup(),this._advConfigPopup=cc.instantiate(this.advConfigPopupPrefab).getComponent("AdvConfigPopup"),this._advConfigPopup.openAdvConfigPopup(o.getSynopsisText(),this._callbackToEndAdv)},closeConfigPopup:function(){this._advConfigPopup&&(this._advConfigPopup.close(),this._advConfigPopup=null)},_viewTapEvent:function(){o.tapEvent(this)},_autoBtnEvent:function(){switch(cc.log("\u30aa\u30fc\u30c8\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.getPlayState()){case r.ADV_PLAY_STATE.AUTO:this.autoBtn.switchBtnImage(!1),this.setPlayState(r.ADV_PLAY_STATE.PLAY);break;case r.ADV_PLAY_STATE.END:break;default:this.autoBtn.switchBtnImage(!0),this.skipBtn.switchBtnImage(!1),this.setPlayState(r.ADV_PLAY_STATE.AUTO)}},_skipBtnEvent:function(){switch(cc.log("\u30b9\u30ad\u30c3\u30d7\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.getPlayState()){case r.ADV_PLAY_STATE.SKIP:this.skipBtn.switchBtnImage(!1),this.setPlayState(r.ADV_PLAY_STATE.PLAY);break;case r.ADV_PLAY_STATE.END:break;default:this.skipBtn.switchBtnImage(!0),this.autoBtn.switchBtnImage(!1),this.setPlayState(r.ADV_PLAY_STATE.SKIP)}},_logBtnEvent:function(){cc.log("\u30ed\u30b0\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.openLogPopup()},_hideUiBtnEvent:function(){cc.log("UI\u6d88\u53bb\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.uiNode.active=!1;var t=new cc.Node("DispUITouchNode");t.setContentSize(cc.winSize),t.on(cc.Node.EventType.TOUCH_START,function(e){this.uiNode.active=!0,t.destroy(),e.stopPropagation()},this),cc.director.getScene().getChildByName("Canvas").addChild(t)},_soundMuteBtnEvent:function(){cc.log("\u30df\u30e5\u30fc\u30c8\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),s.soundManager.setMute(!s.soundManager.soundMute),this.soundMuteBtn.switchBtnImage(!s.soundManager.soundMute)},_configBtnEvent:function(){cc.log("\u8a2d\u5b9a\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8"),this.openConfigPopup()}}),cc._RF.pop()},{AdvCommonButton:"AdvCommonButton",AdvConstants:"AdvConstants",AdvManager:"AdvManager",AdvSingleton:"AdvSingleton",AdvSubRootBase:"AdvSubRootBase"}],TextApis:[function(t,e,i){"use strict";cc._RF.push(e,"feca6jr4uBEu4M/ibh3Kalb","TextApis");var a=t("RESTClient").RESTClient;a.graft({name:"inspection/getDmmSpInspection",path:"inspection/getDmmSpInspection",method:"POST"}),a.graft({name:"inspection/updateDmmSpInspection",path:"inspection/updateDmmSpInspection",method:"POST"}),a.graft({name:"inspection/createDmmSpInspection",path:"inspection/createDmmSpInspection",method:"POST"}),cc._RF.pop()},{RESTClient:"RESTClient"}],TextManager:[function(t,e,i){"use strict";cc._RF.push(e,"bf7cdjH57BAfIVlA4ho7u9y","TextManager");var a=t("Singleton"),n=t("SingletonConst"),o=t("ErrorCode"),r=t("DmmAndroidJsToJava"),s=0,c=-1,l=cc.Enum({GET:0,UPDATE:1});cc.Class({extends:cc.Component,_requestCaller:void 0,ctor:function(){this._requestCaller=arguments[0]},request:function(t,e,i,a,n){switch(t){case l.GET:if(!i||s!==a)return n({textId:i,status:a,text:e});this._requestUserTextData(e,i,a,n);break;case l.UPDATE:this._updateUserTextData(e,i,a,n);break;default:return n({textId:i,status:a,text:e})}},_requestUserTextData:function(t,e,i,o){if(!a[n.ENVIRONMENT].isDmmPlatform())return o({textId:e,status:i,text:t});cc.sys.isBrowser&&cc.sys.isMobile?this._requestDmmSpUserTextData(t,e,i,o):cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID?this._requestDmmAndroidUserTextData(e,o):this._requestDmmPcUserTextData(e,o)},_requestDmmSpUserTextData:function(t,e,i,r){this._requestCaller("inspection/getDmmSpInspection",{textId:e},function(t,e){return t?(cc.error(t),a[n.ERROR_MANAGER].throwError(t.errorCode,t.retryAPI)):e?e.err?a[n.ERROR_MANAGER].throwError(e.status):e.isUserDisabled?a[n.ERROR_MANAGER].throwError(o.USER_DISABLED,void 0,void 0):e.isMaintenance?a[n.ERROR_MANAGER].throwError(o.MAINTENANCE,void 0,e):r({textId:e.textId,status:e.status,text:e.text}):r({textId:"",status:c,text:""})})},_requestDmmAndroidUserTextData:function(t,e){r.requestUserTextData(t,function(t){return e(t?{textId:t.textId,status:t.status,text:t.text}:{textId:"",status:c,text:""})})},_requestDmmPcUserTextData:function(t,e){window.addEventListener("message",function t(i){if("requestUserTextData"===i.data.api)return window.removeEventListener("message",t),"requestUserTextDataSuccess"===i.data.type?e(i.data.result):e({textId:"",status:c,text:""})},!1),window.parent.postMessage({api:"requestUserTextData",param:{textId:t}},"*")},_updateUserTextData:function(t,e,i,o){if(!a[n.ENVIRONMENT].isDmmPlatform())return o({textId:e,status:i,text:t});cc.sys.isBrowser&&cc.sys.isMobile?this._updateDmmSpUserTextData(t,e,i,o):cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID?this._updateDmmAndroidUserTextData(t,e,i,o):this._updateDmmPcUserTextData(t,e,i,o)},_updateDmmSpUserTextData:function(t,e,i,r){var s={text:t},l="inspection/createDmmSpInspection";e&&(s.textId=e,l="inspection/updateDmmSpInspection"),this._requestCaller(l,s,function(s,l){return s?(cc.error(s),a[n.ERROR_MANAGER].throwError(s.errorCode,s.retryAPI)):l?l.err?a[n.ERROR_MANAGER].throwError(l.status):l.isUserDisabled?a[n.ERROR_MANAGER].throwError(o.USER_DISABLED,void 0,void 0):(cc.log("responseData.isMaintenance",l.isMaintenance),l.isMaintenance?a[n.ERROR_MANAGER].throwError(o.MAINTENANCE,void 0,l):e?void this._requestDmmSpUserTextData(t,e,i,r):r({textId:l.textId,status:l.status,text:l.text})):r({textId:"",status:c,text:""})}.bind(this))},_updateDmmAndroidUserTextData:function(t,e,i,a){var n="0"===t?t+" ":t;r.updateUserTextData(e,n,function(t){a({textId:t.textId,status:t.status,text:t.text})})},_updateDmmPcUserTextData:function(t,e,i,a){window.addEventListener("message",function n(o){if("updateUserTextData"===o.data.api)return window.removeEventListener("message",n),"updateUserTextDataSuccess"===o.data.type?a(o.data.result):a({textId:e,status:i,text:t})},!1),window.parent.postMessage({api:"updateUserTextData",param:{textId:e,text:t}},"*")}});cc._RF.pop()},{DmmAndroidJsToJava:"DmmAndroidJsToJava",ErrorCode:"ErrorCode",Singleton:"Singleton",SingletonConst:"SingletonConst"}],ThumbnailTextPopup:[function(t,e,i){"use strict";cc._RF.push(e,"eb212vaiexCcLNLdntR04Tn","ThumbnailTextPopup");var a=t("PopupBase"),n=t("CommonButton");cc.Class({extends:a,properties:{titleLabel:cc.Label,textLabel:cc.Label,thumbnailParentNode:cc.Node,okLabel:cc.Label,executeLabel:cc.Label,cancelLabel:cc.Label,okBtn:n,executeBtn:n,cancelBtn:n},openThumbnailTextPopup:function(t,e,i,a,n,o,r){this._initThumbnail(t),this._initTexts(e,i),this._initButtons(a,n,o,r),this.open()},_initThumbnail:function(t){t.position=cc.v2(0,0),t.anchorX=.5,t.anchorY=.5,this.thumbnailParentNode.addChild(t)},_initTexts:function(t,e){this.titleLabel.string=t,this.textLabel.string=e},_initButtons:function(t,e,i,a){e?(this.executeBtn.node.active=!0,this.cancelBtn.node.active=!0,this.okBtn.node.active=!1,this.executeBtn.setTapEvent(this._onTapButton.bind(this,t)),this.cancelBtn.setTapEvent(this._onTapButton.bind(this,e))):(this.executeBtn.node.active=!1,this.cancelBtn.node.active=!1,this.okBtn.node.active=!0,this.okBtn.setTapEvent(this._onTapButton.bind(this,t))),i&&(this.okLabel.string=i,this.executeLabel.string=i),a&&(this.cancelLabel.string=a)},_onTapButton:function(t){this._disableButtonsEvent(),this.setCloseCallBack(t),this.close()},_disableButtonsEvent:function(){this.okBtn.setTouchEnable(!1),this.executeBtn.setTouchEnable(!1),this.cancelBtn.setTouchEnable(!1)}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase"}],TimeUtils:[function(t,e,i){"use strict";cc._RF.push(e,"326b767MuBJfZ+G5rjmA+XK","TimeUtils");var a=t("GameConst"),n=t("Singleton"),o=t("LocalDataConst");function r(t){var e=moment(t+a.SERVER_TIME_ZONE,"YYYYMMDDHHmmssZ");return e.utcOffset(a.SERVER_TIME_ZONE),e}function s(t){return t.slice(0,4)+"/"+t.slice(4,6)+"/"+t.slice(6,8)}function c(t){return t.slice(8,10)+":"+t.slice(10,12)}function l(t){return t.slice(8,10)+":"+t.slice(10,12)+":"+t.slice(12)}function u(t){return{year:t.slice(0,4),month:t.slice(4,6),date:t.slice(6,8),hour:t.slice(8,10),minute:t.slice(10,12),second:t.slice(12)}}function h(){return n.localData[o.NOW_DATETIME].format("YYYY")}function d(){return n.localData[o.NOW_DATETIME].format("MM")}function p(){return n.localData[o.NOW_DATETIME].format("HH")}function m(){return n.localData[o.NOW_DATETIME].format("mm")}function g(t,e){var i=r(t),a=n.localData[o.NOW_DATETIME].clone(),s=i.diff(a,"milliseconds");return!e&&s<0&&(s=0),s}function C(t){return parseInt(t/36e5)}function f(t){return parseInt(t/6e4)}function E(t){return parseInt(t/1e3)}function T(t,e){return("0000000000"+t).slice(-e)}function S(){return n.localData[o.NOW_DATETIME].weekday()}function R(){return n.localData[o.NOW_DATETIME].valueOf()}function A(t){return t.getFullYear()+("0"+(1+t.getMonth())).slice(-2)+("0"+t.getDate()).slice(-2)+("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+("0"+t.getSeconds()).slice(-2)}function b(t,e){e=e||1;var i=u(t),a=new Date(i.year,i.month-1,i.date,i.hour,i.minute,i.second);return a.setSeconds(a.getSeconds()+e),A(a)}e.exports={createMoment:r,parseTimeToYmdhm:function(t){return s(t)+" "+c(t)},parseTimeToYmdhms:function(t){return s(t)+" "+l(t)},parseTimeToYmd:s,parseTimeToHm:c,parseTimeToHms:l,parseSecondToHms:function(t){var e=new Date(1900,0,0,0,0,t),i=T(e.getSeconds(),2),a=T(e.getMinutes(),2);return T(e.getHours()+24*e.getDay(),2)+":"+a+":"+i},parseToYmdhmsMap:u,getNowDateTime:function(){return n.localData[o.NOW_DATETIME].format("YYYYMMDDHHmmss")},getNowDate:function(){return n.localData[o.NOW_DATETIME].format("YYYYMMDD")},getNowTime:function(){return n.localData[o.NOW_DATETIME].format("HHmmss")},getNowYear:h,getNowMonth:d,getNowDay:function(){return n.localData[o.NOW_DATETIME].format("DD")},getNowHour:p,getNowMinute:m,getNowSecond:function(){return n.localData[o.NOW_DATETIME].format("ss")},getDiffDayLineCount:function(t){var e=r(t.substr(0,8)+"000000"),i=n.localData[o.NOW_DATETIME].clone();return Math.abs(e.diff(i.startOf("day"),"days"))},getDiffMS:g,getDiffHms:function(t){var e=g(t),i=parseInt(C(e)%24),a=parseInt(f(e)%60),n=parseInt(E(e)%60);return T(i,2)+":"+T(a,2)+":"+T(n,2)},parseMsToDay:function(t){return parseInt(t/864e5)},parseMsToHour:C,parseMsToMinute:f,parseMsToSecond:E,parseSecondToMinute:function(t){return parseInt(t/60)},getNowWeek:S,isDateInRange:function(t,e,i){return e<=t&&t<=i},getNextWeekDifferenceTime:function(t){var e=S(),i=e===t?1439:0,a=(t+7-e)%7*1440-(60*parseInt(p())+parseInt(m()))+i,n=parseInt(a/60);return{totalDay:parseInt(a/60/24)+1,totalHour:n,totalMinute:a}},getNowCountMS:R,getNowCountSeconds:function(){return R()/1e3},isRangeOfDate:function(t,e){return t=t||"20000101000000",e=e||"99991231235959",g(t,!0)<=0&&g(e,!0)>=0},isOpenWeek:function(t){if(!t)return!0;var e=t.split(","),i=S();return _.some(e,function(t){return t===i})},addMinute:function(t,e){var i=u(t),a=new Date(i.year,i.month-1,i.date,i.hour,i.minute,i.second);return a.setMinutes(a.getMinutes()+e),A(a)},addSecond:b,getLastDay:function(t,e){return t||(t=parseInt(h())),e||(e=parseInt(d())),new Date(t,e,0).getDate()},getCheckDate:function(t){return b(t,86400).substr(0,8)+"000000"}},cc._RF.pop()},{GameConst:"GameConst",LocalDataConst:"LocalDataConst",Singleton:"Singleton"}],TitleAnimation:[function(t,e,i){"use strict";cc._RF.push(e,"f5269+lsH1GR5IZCxSeO16+","TitleAnimation");var a=t("Singleton"),n=t("SingletonConst"),o=t("CommonButton"),r="start",s="start_r",c="loop",l="loop_r";cc.Class({extends:cc.Component,properties:{titleSpine:sp.Skeleton,startBtn:o,cacheClearBtn:o},_callback:void 0,onLoad:function(){this.startBtn.setTapEvent(this._onTapStartBtn.bind(this)),this.cacheClearBtn.setTapEvent(this._onTapCacheClearBtn.bind(this),o.SE_NAME.CANCEL),this._deactivateBtns()},play:function(t){this._callback=t,this._deactivateBtns(),a[n.ENVIRONMENT].getAdultFlg()?this._playTitleSpine(s,l):this._playTitleSpine(r,c)},_playTitleSpine:function(t,e){this.titleSpine.node.active=!0,this.titleSpine.defaultAnimation=t,this.titleSpine.setAnimation(0,t,!1),this.titleSpine.setCompleteListener(function(){this.titleSpine.setCompleteListener(null),this.titleSpine.setAnimation(0,e,!0),this._activateBtns()}.bind(this))},_deactivateBtns:function(){this.startBtn.node.active=!1,this.cacheClearBtn.node.active=!1},_activateBtns:function(){this.startBtn.node.active=!0},_onTapStartBtn:function(){this._callback(),this.node.destroy()},_onTapCacheClearBtn:function(){}});cc._RF.pop()},{CommonButton:"CommonButton",Singleton:"Singleton",SingletonConst:"SingletonConst"}],TitleRoot:[function(t,e,i){"use strict";cc._RF.push(e,"43a5fFLBeRLuIRWNbF5knCR","TitleRoot");var a=t("Async"),n=t("StartRoot"),o=t("CommonButton"),r=t("SceneConst"),s=t("Singleton"),c=t("SingletonConst"),l=t("GameConst"),u=t("ViewUtils"),h=t("ResourceUtils"),d=t("TutorialUtils"),p=t("PopupUtils"),m=t("MemoryManager"),g=t("CharacterConst"),C=t("PictureBookUtils"),f=t("StaticResourceConst"),E=t("LocalDataConst"),T=t("CommonUtils"),S=t("ResLoader"),R=t("MovieController"),A=t("DownManifestManager"),b=t("FileLoaderConsts"),M=0,v=1;cc.Class({extends:n,properties:{animation:cc.Animation,okButton:o,confirmParent:cc.Node,animationPrefabs:[cc.Prefab],qualitySettingPopupPrefab:cc.Prefab,movieCtrl:R,movieCtrlR:R,enhanceConfirmation:cc.Label,spLabelNode:cc.Node,platformNodeArray:[cc.Node],hotUpdatePrefab:cc.Prefab},_animation:void 0,initialize:function(){this._drawPlatform(),this._loadDownMainfest(function(){cc.sys.isMobile&&cc.sys.isBrowser&&(this.enhanceConfirmation.node.active=!1,this.spLabelNode.active=!0),this.confirmParent.active=!0}.bind(this))},onLoad:function(){this._addBand(),this._setErrorHandling(),this._setNoticeHandling()},_drawPlatform:function(){s[c.ENVIRONMENT].getAdultFlg()?(this.platformNodeArray[M].active=!1,this.platformNodeArray[v].active=!0):(this.platformNodeArray[M].active=!0,this.platformNodeArray[v].active=!1)},updateChild:function(t){},_bootSequence:function(){var t=[];t.push(this._checkNewVersion.bind(this)),t.push(this._authenticate.bind(this)),t.push(this._loadMasterData.bind(this)),t.push(this._login.bind(this)),t.push(this._checkHotUpdate.bind(this)),t.push(this._loadUserData.bind(this)),t.push(this._loadLoginPack.bind(this)),t.push(this._loadRaidData.bind(this)),t.push(this._loadWarehouseCharacterList.bind(this)),t.push(this._loadWarehouseEquipmentList.bind(this)),t.push(this._loadWarehouseList.bind(this)),s[c.ENVIRONMENT].getDebugTutorialSkip()&&t.push(this._initialUserData.bind(this)),t.push(this._createTitleAnimation.bind(this)),this.requestURLCount=t.length,this.confirmParent.active=!1,a.waterfall(t,function(){var t=s[c.ERROR_MANAGER];if(s.dao.ErrorDataMasters){var e=s.dao.ErrorDataMasters;t.setErrorMaster(e)}cc.log("load finish"),s.localData[E.PAYMENT_SESSION]?this._restoreSceneForBeforePayment():this.okButton.setTapEvent(this._onTapOkButton.bind(this))}.bind(this))},_restoreSceneForBeforePayment:function(){this.initResource();var t=[];t.push(this._loadUserData.bind(this)),t.push(this._loadRaidData.bind(this)),a.waterfall(t,function(){this.schedule(this._waitTransitionTiming.bind(this),1/60)}.bind(this))},_waitTransitionTiming:function(){if(this._sceneState===r.SCENE_STATE.LOOP_SCENE)switch(this.unscheduleAllCallbacks(),s.localData[E.PAYMENT_SESSION].paymentType){case l.PAYMENT_TYPE.SHOP:return this._transitionScene(r.SCENE.FILE_NAME.SHOP);case l.PAYMENT_TYPE.GACHA:return this._transitionScene(r.SCENE.FILE_NAME.GACHA)}},_createTitleAnimation:function(t){if(s.localData[E.PAYMENT_SESSION])return this._loadPaymentWaitLoading(t);var e=Math.floor(Math.random()*this.animationPrefabs.length),i=this.animationPrefabs[e],a=cc.instantiate(i);m.instance.localPrefabStore(i),this._animation=a.getComponent("TitleAnimation"),this.requestURLCount-=1,t()},_loadPaymentWaitLoading:function(t){S.loader.loadRes(f.LOADING_PAYMENT_WAIT_PREFAB_PATH,cc.Prefab,function(e,i){s.staticRes[f.LOADING_PAYMENT_WAIT_PREFAB_PATH]=i,u.addPaymentWaitLayer(),t()},f.USE_KEY)},_onTapOkButton:function(){var t=T.loadLocalStorage(E.LOCAL_STORAGE_KEY.FIRST_QUALITY_POP,1,E.LOCAL_STORAGE_GET_TYPE.INTEGER);(this.confirmParent.active=!1,1===s.dao[s.USER].getTutorialStep()||t===l.ALL_RES_POP_TYPE.UNPOP)?(cc.instantiate(this.qualitySettingPopupPrefab).getComponent("QualitySettingPopup").openQualitySettingPopup(this._playSplash.bind(this)),T.saveLocalStorage(E.LOCAL_STORAGE_KEY.FIRST_QUALITY_POP,l.ALL_RES_POP_TYPE.POP)):this._playSplash()},_playSplash:function(){this.animation.on("finished",this._playAnimation.bind(this)),this.animation.play("Title_Start")},_playAnimation:function(){this.animation.off("finished"),s.soundManager.init(),this._playTitlCall(),this.playSceneBgm(l.BGM.TITLE),this._animation.play(this._onTapGameStart.bind(this)),this.node.addChild(this._animation.node)},_onTapGameStart:function(){s.soundManager.playSE(h.getResource(f.SE.START),!1);var t=[],e=T.loadLocalStorage(E.LOCAL_STORAGE_KEY.ALL_RES_POP_TYPE,1,E.LOCAL_STORAGE_GET_TYPE.INTEGER);cc.sys.isBrowser&&cc.sys.isMobile?d.isTutorialEnded()?e===l.ALL_RES_POP_TYPE.POP?this.pushScene(r.SCENE.FILE_NAME.RESOURCE_DOWNLOAD):this.pushScene(r.SCENE.FILE_NAME.FIRST_LOGIN):1===s.dao[s.USER].getTutorialStep()?t.push(this._initFirstLoginMovie.bind(this)):this.pushScene(r.SCENE.FILE_NAME.FIRST_LOGIN):(this._checkRamSpace(),d.isTutorialEnded()&&e===l.ALL_RES_POP_TYPE.POP?this.pushScene(r.SCENE.FILE_NAME.RESOURCE_DOWNLOAD):this.pushScene(r.SCENE.FILE_NAME.FIRST_LOGIN)),a.waterfall(t,function(){})},_checkRamSpace:function(){if(cc.sys.isNative){var t,e=s[c.ENVIRONMENT],i=jsb.reflection.callStaticMethod(e.getAndroidDomain()+"NativeMethod","getRamSpace","()F"),a=A.instance.getNeedCapacity(),n=0;switch(T.loadLocalStorage(E.LOCAL_STORAGE_KEY.RESOURCE_QUALITY,1,E.LOCAL_STORAGE_GET_TYPE.INTEGER)){case l.RESOURCE_QUALITY.LOW:n=a[0],t=cc.sys.localStorage.getItem(b.CURRENT_LD_ALL_RES_VERSION);break;case l.RESOURCE_QUALITY.HIGH:n=a[1],t=cc.sys.localStorage.getItem(b.CURRENT_HD_ALL_RES_VERSION)}t!=b.ALL_RES_VERSION.ZIP&&(s.localData[E.IS_CAPACITY_ZIP_AMPLE]=!(i>=n)),s.localData[E.IS_CAPACITY_FULL]=!1,cc.log("freeBytes = "+i),cc.log("mbValue = "+n)}},playSceneBgm:function(t){cc.log("titleroot playSceneBgm:"+h.getFileNameBGM(t)),s.fileLoaderManager.loadFile(h.getFileNameBGM(t),cc.AudioClip,function(t,e){t?cc.error(t):s.soundManager.continuePlayBGM(e,0)})},_playTitlCall:function(){var t=C.getCharacterTextMasterArray(null,g.TEXT_SCENE_TYPE.TITLE,null),e=_.sample(t);e&&s.fileLoaderManager.loadFile(h.getFileNameCharacterSound(e.getCharacterId(),e.getVoiceFile()),cc.AudioClip,function(t,e){t?cc.error(t):s.soundManager.playVoice(e)})},_initFirstLoginMovie:function(){this.node.getChildByName("Logo").active=!1,this.node.getChildByName("Background").active=!1,this.movieCtrlR.node.active=!1,this.movieCtrl.node.active=!1;var t=s[c.ENVIRONMENT]&&s[c.ENVIRONMENT].getAdultFlg()?this.movieCtrlR:this.movieCtrl;t.node.active=!0,t.setTapEvent(this._onTapMovie.bind(this)),t.setCompleteListener(this._onEndMovie.bind(this)),s.soundManager.stopAll()},_onTapMovie:function(t,e){e.isPlaying()&&(t.pauseVideo(),this.openMovieSkipConfirmPopup(this._onTapMovieSkip.bind(this,t,e),this._onTapMovieResume.bind(this,t,e)))},openMovieSkipConfirmPopup:function(t,e){p.openCommonPopupYesNo("\u30b9\u30ad\u30c3\u30d7\u78ba\u8a8d","\u52d5\u753b\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u304b\uff1f","",!1,t,e,"\u30b9\u30ad\u30c3\u30d7\u3059\u308b","\u30ad\u30e3\u30f3\u30bb\u30eb",!0)},_onTapMovieSkip:function(t,e){this._onEndMovie(t,e)},_onTapMovieResume:function(t,e){t.resumeVideo()},_onEndMovie:function(t,e){t.removeVideo(),t.node.destroy(),this.pushScene(r.SCENE.FILE_NAME.FIRST_LOGIN)}});cc._RF.pop()},{Async:"Async",CharacterConst:"CharacterConst",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DownManifestManager:"DownManifestManager",FileLoaderConsts:"FileLoaderConsts",GameConst:"GameConst",LocalDataConst:"LocalDataConst",MemoryManager:"MemoryManager",MovieController:"MovieController",PictureBookUtils:"PictureBookUtils",PopupUtils:"PopupUtils",ResLoader:"ResLoader",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst",StartRoot:"StartRoot",StaticResourceConst:"StaticResourceConst",TutorialUtils:"TutorialUtils",ViewUtils:"ViewUtils"}],TotalBattleParameterView:[function(t,e,i){"use strict";cc._RF.push(e,"a3f7902AwRMV5oBZzR5qX9I","TotalBattleParameterView");var a=t("CommonUtils"),n=t("BattleParameterView");cc.Class({extends:n,properties:{totalPowerNumLabel:cc.Label,totalPowerAnimation:cc.Animation},initBattleParameterView:function(t,e,i,n){this._super(t,e,i),this.totalPowerNumLabel.string=isNaN(n)?n:a.convertToCommaDelimited(n)},resetBattleParameterView:function(t){this._super(t),this.totalPowerNumLabel.string=t},setPrefix:function(t){this._super(t),this.totalPowerNumLabel.string=t+this.totalPowerNumLabel.string},setSuffix:function(t){this._super(t),this.totalPowerNumLabel.string=this.totalPowerNumLabel.string+t},setActive:function(t){this._super(t),this.totalPowerNumLabel.node.active=t},setColor:function(t,e,i,a){this._super(t,e,i),this.totalPowerNumLabel.node.color=a},setScale:function(t){this._super(t),this.totalPowerNumLabel.node.scale=t},playAnimation:function(){this._super(),this.totalPowerAnimation.play()}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",CommonUtils:"CommonUtils"}],TowerApis:[function(t,e,i){"use strict";cc._RF.push(e,"daf39KabGVMTaj2M9k+i16l","TowerApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.TOWER_GET_MATER_DATA,path:"tower/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.TOWER_GET_USER_DATA,path:"tower/getUserData",method:"POST"}),a.RESTClient.graft({name:n.TOWER_SELECT_AREA,path:"tower/select",method:"POST"}),a.RESTClient.graft({name:n.TOWER_GET_AREA_DATA,path:"tower/getAreaData",method:"POST"}),a.RESTClient.graft({name:n.TOWER_RETIRE,path:"tower/retire",method:"POST"}),a.RESTClient.graft({name:n.TOWER_START_BATTLE,path:"tower/startBattle",method:"POST"}),a.RESTClient.graft({name:n.TOWER_END_BATTLE,path:"tower/endBattle",method:"POST"}),a.RESTClient.graft({name:n.TOWER_SAVE_BATTLE_TRANSACTION,path:"tower/saveBattleTransaction",method:"POST"}),a.RESTClient.graft({name:n.TOWER_CLEAR_BATTLE_TRANSACTION,path:"tower/clearBattleTransaction",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],TowerAreaSelectView:[function(t,e,i){"use strict";cc._RF.push(e,"0b372F1S6BPRI/Faj//lxgR","TowerAreaSelectView");t("ResourceUtils");var a=t("CommonButton"),n=(t("TowerUtils"),t("QuestUtils")),o=t("PopupUtils"),r=t("CommonUtils"),s=t("LoopRollView"),c=t("GameConst"),l=t("UnlockEffectConst"),u=t("LocalDataConst");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,loopRollView:s,indicatorPrefab:cc.Prefab,indicatorParentNode:cc.Node,leftBtn:a,rightBtn:a},_root:null,_selectedDirection:0,onLoad:function(){this.leftBtn.setTapEvent(this._onTapLeftBtn.bind(this),a.SE_NAME.COUNT),this.rightBtn.setTapEvent(this._onTapRightBtn.bind(this),a.SE_NAME.COUNT)},initTowerAreaSelectView:function(t,e,i){this._root=t,this._selectedDirection=c.DIRECTION_TYPE.NONE;var a=[],o=r.loadLocalStorage(l.TRIGGER_PREFIX_NAME.QUEST_AREA+t.towerWorldId,0,u.LOCAL_STORAGE_GET_TYPE.INTEGER);for(var s in t.towerQuestMasterMap){a.push(s);var h=cc.instantiate(this.thumbnailPrefab).getComponent("TowerAreaThumbnail");h.initTowerAreaThumbnail(n.getAreaMasterByAreaId(parseInt(s)),o,this._callbackToThumbnail.bind(this)),this.loopRollView.content.addChild(h.node)}if(this.loopRollView.initLoopRollView(),this.loopRollView.setLoopRollChangeCallFunc(function(){i(a[this.loopRollView.getSelectedNo()],this._selectedDirection)}.bind(this)),o){r.removeLocalStorage(l.TRIGGER_PREFIX_NAME.QUEST_AREA+t.towerWorldId);for(var d=0;d<a.length;d+=1)parseInt(a[d])===o&&(e=d);this.loopRollView.setSelectedNo(e)}else this._root.getSelectedAreaId()?(e=a.findIndex(function(t){return t===this._root.getSelectedAreaId()}.bind(this)),this.loopRollView.setSelectedNo(e)):this.loopRollView.setSelectedNo(e)},_callbackToThumbnail:function(t){if(n.getAreaProgress(t.getAreaId()).releasedFlg)this._root.getTowerChallengeRemainCount()<=0?o.openSimpleMessageWindow("\u672c\u65e5\u306e\u6311\u6226\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u307e\u3059\u3002"):this._root.openTowerStartingConfirmPopup(t);else{var e=n.getAreaMasterByReleaseAreaId(t.getAreaId());o.openSimpleMessageWindow(e.getName()+"\u3092\u30af\u30ea\u30a2\u3059\u308b\u3068\u6311\u6226\u3067\u304d\u307e\u3059\u3002")}},_onTapLeftBtn:function(){this._selectedDirection=c.DIRECTION_TYPE.LEFT,this.loopRollView.moveToLeft()},_onTapRightBtn:function(){this._selectedDirection=c.DIRECTION_TYPE.RIGHT,this.loopRollView.moveToRight()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",LoopRollView:"LoopRollView",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",TowerUtils:"TowerUtils",UnlockEffectConst:"UnlockEffectConst"}],TowerAreaThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"42a7bue3whLqL9gdYqJtOS2","TowerAreaThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("QuestUtils"),r=t("GameConst"),s=(t("TowerUtils"),t("UnlockEffectUtils")),c=t("TowerConst");cc.Class({extends:cc.Component,properties:{difficultImageSprite:cc.Sprite,difficultLabel:cc.Label,areaNameLabel:cc.Label,campaignDropLabel:cc.Label,campaignExpLabel:cc.Label,campaignCoinLabel:cc.Label,campaignDropNode:cc.Node,campaignExpNode:cc.Node,campaignCoinNode:cc.Node,grayoutDispNode:cc.Node,completeDispNode:cc.Node,lockIconNode:cc.Node,thumbnailBtn:a},initTowerAreaThumbnail:function(t,e,i){n.addSprite(this.difficultImageSprite,n.getFileNameDifficultBand(t.getDifficult())),this.difficultLabel.string=t.getName(),this.difficultLabel.node.getComponent(cc.LabelOutline).color=this._convertDifficultToColor(t.getDifficult()),this.areaNameLabel.string=t.getText(),this._drawCampaign(t.getAreaId());var a=o.getAreaProgress(t.getAreaId());t.getAreaId()===e?(this.grayoutDispNode.active=!0,s.playUnLockEffectAnimationNormal(this.lockIconNode,function(){this.grayoutDispNode.active=!1}.bind(this))):this.grayoutDispNode.active=!a.releasedFlg,this.completeDispNode.active=a.clearFlg,i?(this.thumbnailBtn.enabled=!0,this.thumbnailBtn.setTapEvent(function(){i(t)})):this.thumbnailBtn.enabled=!1},_drawCampaign:function(t){var e=o.getCampaignCategoryObjectByAreaId(t);e.charaExp?(this.campaignExpNode.active=!0,this.campaignExpLabel.string=r.CAMPAIGN.CAHRA_EXP.LABEL+e.charaExp):this.campaignExpNode.active=!1,e.drop?(this.campaignDropNode.active=!0,this.campaignDropLabel.string=r.CAMPAIGN.DROP.LABEL+e.drop):this.campaignDropNode.active=!1,e.gold?(this.campaignCoinNode.active=!0,this.campaignCoinLabel.string=r.CAMPAIGN.GOLD.LABEL+e.gold):this.campaignCoinNode.active=!1},_convertDifficultToColor:function(t){switch(t){case r.QUEST_DIFFICULT.TOWER.NORMAL:return c.DIFFICULT_LABEL_OUTLINE_COLOR.NORMAL;case r.QUEST_DIFFICULT.TOWER.HARD:return c.DIFFICULT_LABEL_OUTLINE_COLOR.HARD;case r.QUEST_DIFFICULT.TOWER.EX:return c.DIFFICULT_LABEL_OUTLINE_COLOR.EX;case r.QUEST_DIFFICULT.TOWER.EX_2:return c.DIFFICULT_LABEL_OUTLINE_COLOR.EX_2;case r.QUEST_DIFFICULT.TOWER.EX_3:return c.DIFFICULT_LABEL_OUTLINE_COLOR.EX_3}return cc.color(0,0,0,255)}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",TowerConst:"TowerConst",TowerUtils:"TowerUtils",UnlockEffectUtils:"UnlockEffectUtils"}],TowerAutoDisplayOutgameWindow:[function(t,e,i){"use strict";cc._RF.push(e,"e3c06dGgWhD06cev/mRN+Jb","TowerAutoDisplayOutgameWindow");var a=t("Singleton"),n=(t("SingletonConst"),t("WindowBase")),o=(t("GameConst"),t("BattleData")),r=(t("BattleConstants"),t("PopupUtils")),s=t("LocalDataConst");cc.Class({extends:n,initAutoDisplayWindow:function(){this.setActive(!0);var t=cc.callFunc(this.checkAutoError.bind(this)),e=cc.repeatForever(cc.sequence(t,cc.fadeOut(.5),cc.delayTime(.1),cc.fadeIn(.5),cc.delayTime(.4)));this.windowNode.runAction(e)},openAutoStopPopup:function(t){cc.director.pause(),r.openCommonPopupYesNo("AUTO\u505c\u6b62","AUTO\u9032\u884c\u3092\u505c\u6b62\u3057\u307e\u3059\u304b\uff1f","",!1,this.yesBtn.bind(this),this.noBtn.bind(this),"\u306f\u3044","\u3044\u3044\u3048",!0),t.stopPropagation()},yesBtn:function(){o.isAuto=!1,a.localData[s.TOWER_AUTO_MODE]=!1,this.setActive(!1),cc.director.resume()},noBtn:function(){cc.director.resume()},closeAutoDisplayWindow:function(){this.node.off("touchstart",this.openAutoStopPopup,this)},setActive:function(t){this.windowNode.active=t,t?this.node.on("touchstart",this.openAutoStopPopup,this):this.node.off("touchstart",this.openAutoStopPopup,this)},checkAutoError:function(){a.localData[s.TOWER_AUTO_MODE]||(o.isAuto=!1,this.setActive(!1),cc.director.resume())}}),cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",WindowBase:"WindowBase"}],TowerAutoDisplayWindow:[function(t,e,i){"use strict";cc._RF.push(e,"e2ca3ST54lLm4rDeLsBm7Yc","TowerAutoDisplayWindow");var a=t("Singleton"),n=t("SingletonConst"),o=t("WindowBase"),r=t("GameConst"),s=t("BattleData"),c=t("BattleConstants"),l=t("PopupUtils"),u=t("LocalDataConst");cc.Class({extends:o,beforeBtnNodeParent:void 0,autoBtnNode:void 0,speedBtnNode:void 0,initAutoDisplayWindow:function(){var t=cc.callFunc(this.checkAutoError.bind(this)),e=cc.repeatForever(cc.sequence(t,cc.fadeOut(.5),cc.delayTime(.1),cc.fadeIn(.5),cc.delayTime(.4)));this.windowNode.runAction(e),cc.director.getScene().getChildByName("Canvas").addChild(this.node,r.Z_ORDER.SYSTEM_WINDOW),this.autoBtnNode=s.UI_M.autoBtn.node,this.beforeBtnNodeParent=this.autoBtnNode.parent,this._reAddBtnNode(this.autoBtnNode,this.node),this.speedBtnNode=s.UI_M.speedBtn.node,this._reAddBtnNode(this.speedBtnNode,this.node),this.setActive(!0)},openAutoStopPopup:function(t){cc.director.pause(),s.GM.gameRoot.poolManager.setAutoRunWindowActive(!1),l.openCommonPopupYesNo("AUTO\u505c\u6b62","AUTO\u9032\u884c\u3092\u505c\u6b62\u3057\u307e\u3059\u304b\uff1f","",!1,this.yesBtn.bind(this),this.noBtn.bind(this),"\u306f\u3044","\u3044\u3044\u3048",!0),t.stopPropagation()},yesBtn:function(){s.isAuto=!1,a.localData[u.TOWER_AUTO_MODE]=!1,s.UI_M.action_resume(),s.GM.gameRoot.poolManager.closeAutoRunWindow()},noBtn:function(){s.GM.gameRoot.poolManager.setAutoRunWindowActive(!0),s.UI_M.action_resume()},closeAutoDisplayWindow:function(){this.node.off("touchstart",this.openAutoStopPopup,this),this._reAddBtnNode(this.autoBtnNode,this.beforeBtnNodeParent),this._reAddBtnNode(this.speedBtnNode,this.beforeBtnNodeParent)},setActive:function(t){this.windowNode.active=t,t?this.node.on("touchstart",this.openAutoStopPopup,this):this.node.off("touchstart",this.openAutoStopPopup,this)},checkAutoError:function(){a[n.ERROR_MANAGER].isError()&&(s.isAuto=!1,s.GM.gameRoot.poolManager.closeAutoRunWindow(),s.GM.gameRoot.poolManager.openAutoEndPopup(c.AUTO_END_POPUP_CONST.NETWORK_ERROR))},_reAddBtnNode:function(t,e){var i=t.convertToWorldSpaceAR(cc.v2(0,0)),a=e.convertToNodeSpaceAR(i);t.removeFromParent(!1),t.setPosition(a),e.addChild(t)}}),cc._RF.pop()},{BattleConstants:"BattleConstants",BattleData:"BattleData",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",Singleton:"Singleton",SingletonConst:"SingletonConst",WindowBase:"WindowBase"}],TowerBGView:[function(t,e,i){"use strict";cc._RF.push(e,"c4782HshkJAX4Cx5gzWO9Q1","TowerBGView");var a=t("ResourceUtils"),n=t("QuestUtils"),o=t("GameConst");cc.Class({extends:cc.Component,properties:{bgImageSprite:cc.Sprite,towerFloorListViewParentNode:cc.Node,towerFloorListViewPrefabArray:[cc.Prefab]},_instantBgNode:null,drawTowerBG:function(t,e,i,n){this._instantBgNode&&(this._instantBgNode.stopAllActions(),this._instantBgNode.destroy()),this._playBgSwitchAnimation(i),this.towerFloorListViewParentNode.destroyAllChildren(),a.addSprite(this.bgImageSprite,a.getFileNameAreaBG(e),function(){this._drawTowerFloorListView(t,e),n&&n()}.bind(this))},_playBgSwitchAnimation:function(t){if(t===o.DIRECTION_TYPE.LEFT||t===o.DIRECTION_TYPE.RIGHT){this._instantBgNode=cc.instantiate(this.bgImageSprite.node),this.bgImageSprite.node.parent.addChild(this._instantBgNode,this.bgImageSprite.node.zIndex-1);var e=this.bgImageSprite.node.getPosition().x,i=this.bgImageSprite.node.getPosition().y,a=[];switch(t){case o.DIRECTION_TYPE.LEFT:a.push(cc.spawn(cc.moveTo(.2,cc.v2(e+200,i)).easing(cc.easeSineOut()),cc.fadeOut(.2))),this.bgImageSprite.node.setPosition(cc.v2(e-200,i));break;case o.DIRECTION_TYPE.RIGHT:a.push(cc.spawn(cc.moveTo(.2,cc.v2(e-200,i)).easing(cc.easeSineOut()),cc.fadeOut(.2))),this.bgImageSprite.node.setPosition(cc.v2(e+200,i))}a.push(cc.callFunc(function(){this._instantBgNode&&(this._instantBgNode.stopAllActions(),this._instantBgNode.destroy())}.bind(this),this)),this._instantBgNode.runAction(cc.sequence(a)),this.bgImageSprite.node.opacity=0,this.bgImageSprite.node.runAction(cc.spawn(cc.moveTo(.2,cc.v2(e,i)).easing(cc.easeSineOut()),cc.fadeIn(.2)))}},drawTowerLargeBG:function(t,e){this.towerFloorListViewParentNode.active=!1,this.towerFloorListViewParentNode.destroyAllChildren(),a.addSprite(this.bgImageSprite,a.getFileNameTowerBG(t))},_drawTowerFloorListView:function(t,e){this.towerFloorListViewParentNode.active=!0;var i=n.getAreaMasterByAreaId(parseInt(e)),a=this._createTowerStageFloorViewByDifficult(i.getDifficult());a.initTowerFloorListView(t),this.towerFloorListViewParentNode.addChild(a.node),a.node.opacity=0,a.node.runAction(cc.fadeIn(.3))},_createTowerStageFloorViewByDifficult:function(t){return cc.instantiate(this.towerFloorListViewPrefabArray[this._convertDifficultToStagePrefabIdx(t)]).getComponent("TowerFloorListView")},_convertDifficultToStagePrefabIdx:function(t){return Math.floor(Math.min(Math.max(t-1,0),this.towerFloorListViewPrefabArray.length-1))}});cc._RF.pop()},{GameConst:"GameConst",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils"}],TowerBattleBossUnit:[function(t,e,i){"use strict";cc._RF.push(e,"9c0b5S8XFhG9qLQ3F6Rtaj5","TowerBattleBossUnit");var a=t("BattleBossUnit"),n=cc.Class({extends:a,properties:{},makeBattleContinueData:function(){return{index:this.battleMonsterModel.getIndex(),enemyId:this.battleMonsterModel.getEnemyId(),hp:this.curHp,skillGauge:this.curSkillRate}},restoreBattleContinueData:function(t){return this.curHp=t.hp,this.curSkillRate=t.skillGauge,this.isDead=t.hp<=0,!0}});e.exports=n,cc._RF.pop()},{BattleBossUnit:"BattleBossUnit"}],TowerBattleMonsterUnit:[function(t,e,i){"use strict";cc._RF.push(e,"6299aCozUdJdJNXvq92dRxm","TowerBattleMonsterUnit");var a=t("BattleMonsterUnit"),n=cc.Class({extends:a,properties:{},makeBattleContinueData:function(){return{index:this.battleMonsterModel.getIndex(),enemyId:this.battleMonsterModel.getEnemyId(),hp:this.curHp,skillGauge:this.curSkillRate}},restoreBattleContinueData:function(t){return this.curHp=t.hp,this.curSkillRate=t.skillGauge,this.isDead=t.hp<=0,!0}});e.exports=n,cc._RF.pop()},{BattleMonsterUnit:"BattleMonsterUnit"}],TowerBattlePlayerUnit:[function(t,e,i){"use strict";cc._RF.push(e,"bcf9f7CqzJHErthuP8g/MSM","TowerBattlePlayerUnit");var a=t("BattlePlayerUnit"),n=t("BattleData"),o=cc.Class({extends:a,properties:{},makeBattleTransactionData:function(){var t=this._super();return t.curHp=.5*this.curHp,t},makeBattleContinueData:function(){return{characterCd:this.getCharaterModel().getCharacterCd(),hp:this.curHp,skillGauge:this.curSkillRate}},restoreBattleContinueData:function(t){return this.curHp=t.hp<=this.getMaxHp()?t.hp:this.getMaxHp(),this.curSkillRate=t.skillGauge,this.checkFutureDead(0),!0},checkFutureDead:function(t){this.curHp-t<=0&&(this.isDead=!0,n.curActionData&&Array.isArray(n.curActionData.deadUnitList)&&n.curActionData.deadUnitList.push(this))}});e.exports=o,cc._RF.pop()},{BattleData:"BattleData",BattlePlayerUnit:"BattlePlayerUnit"}],TowerBattleStartConfirmSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"2d7f2IUoetEkYYqfvVR+ayr","TowerBattleStartConfirmSubRoot");var a=t("Singleton"),n=t("CommonButton"),o=(t("QuestUtils"),t("TowerUtils")),r=(t("ItemUtils"),t("PopupUtils")),s=t("ResourceUtils"),c=(t("CharacterUtils"),t("DeckUtils")),l=t("MatrixThumbnailUtils"),u=(t("EquipmentUtils"),t("BattleStartConfirmSubRootBase")),h=t("GameConst"),d=t("DeckConst"),p=t("LocalDataConst"),m=(t("ItemConst"),t("BattleData"));cc.Class({extends:u,properties:{questDropDetailInfoBtn:n,towerStageRewardParentNode:cc.Node,towerStageRewardDetailInfoBtn:n,autoBtn:n},_questModel:null,_deckTabSimpleView:null,onLoad:function(){this._super(),this._setButtonEvent()},initBattleStartConfirmSubRoot:function(t,e){this._root=t,this._questModel=e,this._questStageMaster=e.getQuestStageMaster(),this._initDeckTabSimpleView(t,c.getDeckArrayByDeckTypes([d.DECK_TYPE.TOWER]),a.localData[p.SELECT_TOWER_DECK_ORDER]),this.redraw(),this._getRequestGetStageData(this._questStageMaster.getStageId(),function(t){this._initStageData(t)}.bind(this))},redraw:function(){this._super(),this._drawTowerStageRewards(this._questStageMaster)},_getRequestGetStageData:function(t,e){e&&e(this._root.towerAreaEnemyInfoMap[t])},_initStageData:function(t){var e=1;t.forEach(function(t){e=Math.max(t.wave,e)}),this.waveNumLabel.string=""+e,this._drawEnemies(t),this.enemyInfoBtn.setTapEvent(function(){this._openEnemyInfoPopup(t.map(function(t){return{path:t.enemyMain.spineDirectoryPath,attribute:t.enemyMain.attribute}}))}.bind(this),"")},_initDeckTabSimpleView:function(t,e,i){this._deckTabSimpleView=cc.instantiate(this.deckTabSimpleViewPrefab).getComponent("DeckTabSimpleView"),this._deckTabSimpleView.initDeckWithGaugeTabSimpleView(t,e,d.DECK_TYPE.TOWER,i,d.DECK_COUNT_MAX.TOWER,!0,t.towerCharacterStatus),this.deckTabSimpleViewPositionNode.addChild(this._deckTabSimpleView.node)},_drawEnemies:function(t){this.enemyAddLayoutNode.destroyAllChildren();for(var e=0;e<5;e+=1)if(t[e]){var i=cc.instantiate(this.enemyThumbnailPrefab).getComponent("EnemyMatrixThumbnail");this.enemyAddLayoutNode.addChild(i.node),i.initEnemyMatrixThumbnail(s.getFileNameEnemyThumbnail(t[e].enemyMain.spineDirectoryPath),s.getFileNameAttributeIcon(t[e].enemyMain.attribute),s.getFileNameRarityRing(h.RARITY.SR)),i.setCallbackToThumbnailBtn(this._onTapEnemyThumbnail.bind(this,i,t[e],i.node.parent.scale)),i.setLevel(t[e].enemyMain.level),this._questStageMaster.getStageId()===this._root.towerSession.getStageId()?(i.setHpProgress(t[e].hp,t[e].enemyMain.hp),i.setSkillProgress(t[e].skillGauge,100)):this._questStageMaster.getStageId()>this._root.towerSession.getStageId()?(i.setHpProgress(t[e].enemyMain.hp,t[e].enemyMain.hp),i.setSkillProgress(0,100)):(i.setHpProgress(0,t[e].enemyMain.hp),i.setSkillProgress(0,100))}},_drawTowerStageRewards:function(t){this.towerStageRewardParentNode.destroyAllChildren();for(var e=o.getTowerRewardGroupMasterArrayByRewardGroupId(o.getTowerRewardMasterByStageId(t.getStageId()).getStageRewardGroupId()),i=0;i<7;i+=1)if(e[i]){var a=l.createMatrixThumbnailByItemType(e[i].getItemId(),e[i].getItemType());this.towerStageRewardParentNode.addChild(a.node),a.setCallbackToThumbnailBtn(this._onTapItemThumbnail.bind(this,a.node,e[i].getItemType(),e[i].getItemId(),a.node.parent.scale))}},_initBattleBtn:function(){this.battleBtn.setTapEvent(function(){var t=this._root.getDeckInfo(a.localData[p.SELECT_TOWER_DECK_ORDER]);t.deck?this._root.isDeckAnnihilation(t.deckId)?r.openSimpleMessageWindow("\u751f\u5b58\u30e6\u30cb\u30c3\u30c8\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3002"):o.checkStartBattleByUserItemsCondition()&&(a.localData[p.TOWER_AUTO_MODE]=this.autoBtn.getBtnImageSwitchState(),m.isAuto=this.autoBtn.getBtnImageSwitchState(),this._root.requestStartTowerBattle(this._questModel)):r.openSimpleMessageWindow("\u90e8\u968a\u304c\u7de8\u6210\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")}.bind(this))},_setButtonEvent:function(){this.questDropDetailInfoBtn.setTapEvent(function(){this._root.openTowerQuestDropItemListDetailPopup(this._questStageMaster.getStageId())}.bind(this),""),this.towerStageRewardDetailInfoBtn.setTapEvent(function(){this._root.openTowerStageRewardItemListDetailPopup(this._questStageMaster.getStageId())}.bind(this),""),this.autoBtn.setTapEvent(this._onTapAutoButton.bind(this)),this.autoBtn.switchBtnImage(!1)},_onTapEnemyThumbnail:function(t,e,i){if(this.enemyDetailWindow){var a=cc.instantiate(this.enemyDetailWindow).getComponent("ModelDetailPopup"),n=cc.instantiate(t.node);n.getComponent("EnemyMatrixThumbnail").switchActivePrgoress(!1);var o=cc.instantiate(t.node),r=t.node.convertToWorldSpaceAR(cc.v2(0,0)),s=this._root.node.convertToNodeSpaceAR(r);this._root.node.addChild(o,h.Z_ORDER.POPUP),o.setScale(i),o.setPosition(s),a.openModelDetailPopup(n,e.enemyMain.name,e.enemyMain.text,function(){o.destroy()})}},_onTapAutoButton:function(){this.autoBtn.switchBtnImage(!this.autoBtn.getBtnImageSwitchState())}});cc._RF.pop()},{BattleData:"BattleData",BattleStartConfirmSubRootBase:"BattleStartConfirmSubRootBase",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",DeckConst:"DeckConst",DeckUtils:"DeckUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TowerUtils:"TowerUtils"}],TowerChestWholeView:[function(t,e,i){"use strict";cc._RF.push(e,"860aa9HGU9A3Ycabb4P8ihh","TowerChestWholeView");var a="treasure_open",n="treasure_clear";cc.Class({extends:cc.Component,properties:{chestSpine:sp.Skeleton},playOpenAnimation:function(t,e){this.chestSpine.defaultAnimation=a,this.chestSpine.setAnimation(0,a,!1),this.chestSpine.setCompleteListener(function(){return this.node.destroy(),e()}.bind(this)),t.addChild(this.node)},playClearAnimation:function(t,e){this.chestSpine.defaultAnimation=n,this.chestSpine.setAnimation(0,n,!1),this.chestSpine.setCompleteListener(function(){return this.node.destroy(),e()}.bind(this)),t.addChild(this.node)}});cc._RF.pop()},{}],TowerConst:[function(t,e,i){"use strict";cc._RF.push(e,"f4306CouatEw4gKdTrUVZ6t","TowerConst"),e.exports={DIFFICULT_LABEL_OUTLINE_COLOR:{NORMAL:cc.color(30,53,165,255),HARD:cc.color(125,53,9,255),EX:cc.color(134,19,33,255),EX_2:cc.color(134,19,33,255),EX_3:cc.color(134,19,33,255)}},cc._RF.pop()},{}],TowerDeckSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"4338f45+Y9EqaJeLFkQZjv4","TowerDeckSelectSubRoot");t("CommonButton"),t("CharacterUtils");var a=t("DeckConst");cc.Class({extends:cc.Component,properties:{deckSelectViewPrefab:cc.Prefab},_root:null,_deckTabSubRoot:null,initTowerDeckSelectSubRoot:function(t,e,i){this._root=t,this._deckTabSubRoot||(this._deckTabSubRoot=cc.instantiate(this.deckSelectViewPrefab).getComponent("DeckTabView"),this._deckTabSubRoot.initDeckTabView(t,e,a.DECK_TYPE.TOWER,i,a.DECK_COUNT_MAX.TOWER),this.node.addChild(this._deckTabSubRoot.node)),this._deckTabSubRoot.switchActiveExecuteDeckEditBtn(!0)},setDeckArray:function(t){this._deckTabSubRoot.setDeckArray(t)},redraw:function(){this._deckTabSubRoot.redraw()}}),cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",DeckConst:"DeckConst"}],TowerDeckThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"216ccIXO+ZC27nl4BNvvk6p","TowerDeckThumbnailView");var a=t("ResourceUtils");cc.Class({extends:cc.Component,properties:{characterImageSprite:cc.Sprite,partyNameLabel:cc.Label},initTowerDeckThumbnailView:function(t,e){t&&a.addSprite(this.characterImageSprite,a.getFileNameCharacterThumbnail(t.getCharacterId())),this.partyNameLabel.string="\u7b2c"+e+"PT"}}),cc._RF.pop()},{ResourceUtils:"ResourceUtils"}],TowerFloorListView:[function(t,e,i){"use strict";cc._RF.push(e,"9cbfeeZI2hK0qAz4Xq4Vs9Q","TowerFloorListView");cc.Class({extends:cc.Component,properties:{topThumbnailParentNode:cc.Node,topThumbnailPrefab:cc.Prefab,botThumbnailParentNode:cc.Node,botThumbnailPrefab:cc.Prefab,midThumbnailParentNode:cc.Node,midThumbnailPrefabArray:[cc.Prefab]},initTowerFloorListView:function(t){this._initTowerFloorListContent(t)},_initTowerFloorListContent:function(t){this.topThumbnailParentNode.destroyAllChildren(),this.midThumbnailParentNode.destroyAllChildren(),this.botThumbnailParentNode.destroyAllChildren();var e=Object.keys(t);this.topThumbnailParentNode.addChild(cc.instantiate(this.topThumbnailPrefab));for(var i=e.length-2;i>0;i-=1){var a=Math.floor(i%this.midThumbnailPrefabArray.length);this.midThumbnailParentNode.addChild(cc.instantiate(this.midThumbnailPrefabArray[a]))}this.botThumbnailParentNode.addChild(cc.instantiate(this.botThumbnailPrefab))}});cc._RF.pop()},{}],TowerGameManager:[function(t,e,i){"use strict";cc._RF.push(e,"40446dSNVJCnIXLuBBuvZCq","TowerGameManager");var a=t("QuestGameManager"),n=t("BattleData"),o=t("EnumTypes"),r=t("BattleFunction"),s=(t("TowerBattleMonsterUnit"),t("TowerBattleMonsterUnit"),t("Singleton")),c=t("SingletonConst"),l=t("GameEffectQueue").EffectQuery,u=cc.Class({extends:a,properties:{},ctor:function(){cc.log("TowerGameManager ctor !!!!")},initBeginLoopByBattleLoadType:function(){var t=n.battleLoadType;if(t===o.BattleLoadType.QUEST_START_BATTLE){var e=this;cc.log("Its questStartBattle!!"),this.initForContinueData(),this.sendBattleTransaction(function(t){cc.log("send save transac succ"),e.loop.beginLoop(e.showBattleStartEffect)})}else t===o.BattleLoadType.FROM_BATTLE_TRANSACTION?(cc.log("Its fromBattleTransaction data !!"),this.initForInterruptData(),this.loop.beginLoop(this.showBattleStartEffect)):t===o.BattleLoadType.FROM_CONTINUE&&(cc.log("Its fromContinue data !!"),this.initForContinueData(),this.loop.beginLoop(this.showBattleStartEffect))},initForContinueData:function(){var t,e,i=r.getUnitList(!1);for(var a in i)e=i[a],(t=n.characterStatus.find(function(t){return t.characterCd===e.getCharaterModel().getCharacterCd()}))&&e.restoreBattleContinueData(t);var o=r.getUnitList(!0);for(var s in o)e=o[s],(t=n.enemyStatus.find(function(t){return t.index===e.getIndex()&&t.enemyId===e.getId()}))&&e.restoreBattleContinueData(t)},showEnemy:function(){for(var t=n.GM,e=new l,i=t.getCurEnemyList(),a=0;a<i.length;a++){var o=i[a];o.isDead||o.startCardShow(e,a)}t.effectQueue.addQuery(e),t.loop.callNextAction()},_createEndBattleParams:function(t){var e=r.getEndBattleParam(t),i=r.makeBattleContinueData();e.characterStatus=i.characterStatus;var a={};a.enemyStatus=i.enemyStatus,a.battleData=i.battleData,e.continueData=JSON.stringify(a),e.saveData={},cc.log(e);var o=n.sessionObjectData.sessionId,l=r.objectToEncryptString(e,o);return s[c.ENVIRONMENT].getDebugEnctypt()&&(l=JSON.stringify(e)),cc.log("strParam = "+l),l}});e.exports=u,cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",EnumTypes:"EnumTypes",GameEffectQueue:"GameEffectQueue",QuestGameManager:"QuestGameManager",Singleton:"Singleton",SingletonConst:"SingletonConst",TowerBattleMonsterUnit:"TowerBattleMonsterUnit"}],TowerItemWideThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"d522ev9U8RK/omzoZUMZMOd","TowerItemWideThumbnail");t("ResourceUtils");var a=t("ItemUtils"),n=t("CommonUtils"),o=(t("StaticResourceConst"),t("MatrixThumbnailUtils"));cc.Class({extends:cc.Component,properties:{matrixThumbnailNode:cc.Node,itemNameLabel:cc.Label,itemCountLabel:cc.Label,itemDescriptionLabel:cc.Label},initTowerItemWideThumbnail:function(t){var e=o.createMatrixThumbnailByItemType(t.getItemId(),t.getItemType());this.matrixThumbnailNode.addChild(e.node);var i=a.getItemInfo(t.getItemType(),t.getItemId());this.itemNameLabel.string=i.name,"number"==typeof count?this.itemCountLabel.string=n.convertToCommaDelimited(t.getCount()):this.itemCountLabel.node.parent.active=!1,this.itemDescriptionLabel.string=""+i.text}}),cc._RF.pop()},{CommonUtils:"CommonUtils",ItemUtils:"ItemUtils",MatrixThumbnailUtils:"MatrixThumbnailUtils",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],TowerMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"588d9x7DodCw6t2mNMA/VQs","TowerMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getDateTo:function(){if(this._isKeyFieldAvailable("dateTo"))return this._data.dateTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateTo")},getAreaId:function(){if(this._isKeyFieldAvailable("areaId"))return this._data.areaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: areaId")},getDateFrom:function(){if(this._isKeyFieldAvailable("dateFrom"))return this._data.dateFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: dateFrom")},getDeckIdFrom:function(){if(this._isKeyFieldAvailable("deckIdFrom"))return this._data.deckIdFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: deckIdFrom")},getDeckIdTo:function(){if(this._isKeyFieldAvailable("deckIdTo"))return this._data.deckIdTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: deckIdTo")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],TowerResultSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"e02f7UNWwJMIKB7XXs0kwyn","TowerResultSubRoot");var a=t("BattleData"),n=t("BattleFunction"),o=t("Singleton"),r=t("EnumTypes"),s=t("CommonButton"),c=(t("BattleConstants"),t("CharacterUtils")),l=t("Async"),u=t("LocalDataConst");cc.Class({extends:cc.Component,properties:{resultTitleLabel:cc.Label,resultBgGraySprite:cc.Sprite,battleClearNode:cc.Node,battleCharacterSlidInAnimation:cc.Animation,battleCharacterSkeleton:[sp.Skeleton],resultTitleAnimation:cc.Animation,nextBtnSlidInAnimation:cc.Animation,nextButton:s},updateCallbacks:null,ctor:function(){this.updateCallbacks=[]},show:function(){this._battleResult=a.battleResult,this._battleUnitList=n.getUnitList(!1),this._entryUsers=this._battleResult._res.entryUsers,this._initResult();var t=this._getAnimationTask();l.waterfall(t)},_initResult:function(){this.resultTitleLabel.string="RESULT",this._initButtons()},_initButtons:function(){this.nextButton.setTapEvent(this._onTapNextBtn.bind(this))},_onTapNextBtn:function(){o.localData[u.TOWER_AUTO_MODE]||this._nextTower()},_nextTower:function(){a.isQueueStop=!1,o.soundManager.bgmStop(),a.transitionEndBattleFunc?(a.transitionEndBattleFunc(a.selectedQuestModel._questStageMaster.getStageId()),a.requestSaveBattleFunc=null,a.requestEndBattleFunc=null,a.transitionEndBattleFunc=null):cc.director.loadScene("QuestScene.fire")},_getAnimationTask:function(){var t=[];return a.gameResult===r.GameResult.PLAYER_WIN?t.push(this._playBattleClearAnimation.bind(this)):a.gameResult===r.GameResult.ENEMY_WIN?t.push(this._playBattleLoseAnimation.bind(this)):cc.error("not exist result"),t.push(function(t){var e=[this._playBattleCharacterSlidInAnimation.bind(this),this._playBattleUiFadeOutAnimation.bind(this)];this._parallelAnimation(e,t)}.bind(this)),t.push(this._playResultBgGrayFadeIn.bind(this)),t.push(this._playResultTitleAnimation.bind(this)),t.push(this._playNextBtnSlidInAnimation.bind(this)),t.push(this._endBattleResult.bind(this)),t},_parallelAnimation:function(t,e){var i=t.length;if(!(t.length>0))return e();t.forEach(function(t){t(function(){if((i-=1)<=0)return e()})})},_playBattleClearAnimation:function(t){var e=a.battleEffect_Prefabs.BattleWin,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleLoseAnimation:function(t){var e=a.battleEffect_Prefabs.BattleLose,i=cc.instantiate(e);this.battleClearNode.addChild(i);var n=i.getComponent(cc.Animation);n.once("finished",function(){return n.play(n.getClips()[1].name),t()},this),n.play(n.getClips()[0].name)},_playBattleCharacterSlidInAnimation:function(t){for(var e=0;e<this._battleUnitList.length;e+=1)this.battleCharacterSkeleton[e].skeletonData=this._battleUnitList[e].mainAvatar.skeletonData,this.battleCharacterSkeleton[e].setAnimation(0,"idle",!0),this._battleUnitList[e].unitController.node.runAction(cc.fadeOut(.5));this.battleCharacterSlidInAnimation.once("finished",function(e){return t(e)},this),this.battleCharacterSlidInAnimation.play(this.battleCharacterSlidInAnimation.getClips()[0].name)},_playBattleUiFadeOutAnimation:function(t){var e=[function(t){this._startBattleUiFadeOutAnimation(a.UI_M.waveTurnPanel_Root,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SkillBtn_Pos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.SpeedBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.PauseBtnBasePos,t)}.bind(this),function(t){this._startBattleUiFadeOutAnimation(a.UI_M.BattleInfoBtnBasePos,t)}.bind(this)];this._parallelAnimation(e,t)},_startBattleUiFadeOutAnimation:function(t,e){t.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){t.active=!1,e()})))},_playResultBgGrayFadeIn:function(t){var e=cc.sequence(cc.delayTime(0),cc.fadeIn(.3),cc.callFunc(function(e){return t(e)}));this.resultBgGraySprite.node.opacity=0,this.resultBgGraySprite.node.active=!0,this.resultBgGraySprite.node.runAction(e)},_playResultTitleAnimation:function(t){this.resultTitleAnimation.once("finished",function(e){return t(e)},this),this.resultTitleAnimation.node.active=!0,this.resultTitleAnimation.play(this.resultTitleAnimation.getClips()[0].name)},_playNextBtnSlidInAnimation:function(t){this.nextBtnSlidInAnimation.once("finished",function(e){return t(e)},this),this.nextBtnSlidInAnimation.node.opacity=0,this.nextBtnSlidInAnimation.node.active=!0,this.nextBtnSlidInAnimation.play(this.nextBtnSlidInAnimation.getClips()[0].name)},_endBattleResult:function(t){return a.autoBattleResultDropItemMap=null,a.autoBattleResultEventItemMap=null,o.localData[u.TOWER_AUTO_MODE]&&this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(this._nextTower.bind(this)))),t()},_isLimitOver:function(){return c.getPlayableUserCharacterModelArray().length>o.dao[o.USER].userData.getCharacterMaxCount()||o.dao.userItems.length>o.dao[o.USER].userData.getItemMaxCount()}});cc._RF.pop()},{Async:"Async",BattleConstants:"BattleConstants",BattleData:"BattleData",BattleFunction:"BattleFunction",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",EnumTypes:"EnumTypes",LocalDataConst:"LocalDataConst",Singleton:"Singleton"}],TowerRewardGroupModel:[function(t,e,i){"use strict";cc._RF.push(e,"0686eMysU1DE6L5QmtrswJB","TowerRewardGroupModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getRewardGroupId:function(){if(this._isKeyFieldAvailable("rewardGroupId"))return this._data.rewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: rewardGroupId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],TowerRewardInfoPopup:[function(t,e,i){"use strict";cc._RF.push(e,"3b78b3l8flAxYZoO+g73ph8","TowerRewardInfoPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=t("TowerUtils"),s=(t("ResourceUtils"),t("MatrixThumbnailUtils"));cc.Class({extends:a,properties:{scrollView:o,okBtn:n},openTowerRewardInfoPopup:function(t){var e=r.getTowerRewardGroupMasterArrayByRewardGroupId(r.getTowerRewardMasterByStageId(t).getStageRewardGroupId());this.scrollView.content.destroyAllChildren();for(var i=0;i<e.length;i+=1){var a=s.createMatrixThumbnailByItemType(e[i].getItemId(),e[i].getItemType());this.scrollView.content.addChild(a.node)}this.okBtn.setTapEvent(this._onTapOkBtn.bind(this)),this.open()},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",TowerUtils:"TowerUtils"}],TowerRewardModel:[function(t,e,i){"use strict";cc._RF.push(e,"f3681Pv70JND7AC+wDji4Lt","TowerRewardModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getCompleteRewardGroupId:function(){if(this._isKeyFieldAvailable("completeRewardGroupId"))return this._data.completeRewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: completeRewardGroupId")},getStageRewardGroupId:function(){if(this._isKeyFieldAvailable("stageRewardGroupId"))return this._data.stageRewardGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageRewardGroupId")},getStageRewardType:function(){if(this._isKeyFieldAvailable("stageRewardType"))return this._data.stageRewardType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageRewardType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],TowerRewardReceivePopup:[function(t,e,i){"use strict";cc._RF.push(e,"a0988W9UexFRpzjgOLEG5A7","TowerRewardReceivePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonScrollView"),r=t("ItemUtils"),s=t("Singleton"),c=t("LocalDataConst");cc.Class({extends:a,properties:{simpleThumbnailPrefab:cc.Prefab,scrollView:o,okBtn:n},_callback:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openTowerRewardReceivePopup:function(t,e){this.setCloseCallBack(e),this.scrollView.content.destroyAllChildren();for(var i=0;i<t.length;i+=1){var a=cc.instantiate(this.simpleThumbnailPrefab).getComponent("SimpleThumbnail"),n=r.getItemInfo(t[i].getItemType(),t[i].getItemId());a.initSimpleThumbnail(n.name,t[i].getCount()),this.scrollView.content.addChild(a.node)}this.scrollView.node.active=!1,this.open(function(){this.scrollView.node.active=!0}),s.localData[c.TOWER_AUTO_MODE]&&this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(this.close.bind(this))))},_onTapOkBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonScrollView:"CommonScrollView",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",PopupBase:"PopupBase",Singleton:"Singleton"}],TowerRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"7805dgg9z5DJKVyWwtmI/fA","TowerRootUtils");var a=t("GameConst");e.exports={openTowerTopSubRoot:function(t,e){t.towerTopSubRoot||(t.towerTopSubRoot=cc.instantiate(t.towerTopSubRootPrefab).getComponent("TowerTopSubRoot"),t.subRootParent.addChild(t.towerTopSubRoot.node)),e.areaId&&t.setSelectedAreaId(e.areaId),t.towerTopSubRoot.initTowerTopSubRoot(t,t.towerSession,function(e,i,a){t.setSelectedAreaId(e),t.drawBG(e,i,a)})},closeTowerTopSubRoot:function(t,e){t.towerTopSubRoot&&(t.towerTopSubRoot.node.destroy(),t.towerTopSubRoot=null)},openTowerDeckSelectSubRoot:function(t,e){e.areaId&&t.drawBG(e.areaId,a.DIRECTION_TYPE.NONE),t.towerDeckSelectSubRoot||(t.towerDeckSelectSubRoot=cc.instantiate(t.towerDeckSelectSubRootPrefab).getComponent("TowerDeckSelectSubRoot"),t.towerDeckSelectSubRoot.initTowerDeckSelectSubRoot(t,t.deckInfoArray,e.deckId),t.subRootParent.addChild(t.towerDeckSelectSubRoot.node))},closeTowerDeckSelectSubRoot:function(t,e){t.towerDeckSelectSubRoot&&(t.towerDeckSelectSubRoot.node.destroy(),t.towerDeckSelectSubRoot=null)},openTowerStageSelectSubRoot:function(t,e){t.towerStageSelectSubRoot||(t.towerStageSelectSubRoot=cc.instantiate(t.towerStageSelectSubRootPrefab).getComponent("TowerStageSelectSubRoot"),t.subRootParent.addChild(t.towerStageSelectSubRoot.node));var i=t.towerQuestMasterMap[e.areaId],a=t.towerQuestUserMap[e.areaId];t.drawLargeBG(e.areaId),t.towerStageSelectSubRoot.initTowerStageSelectSubRoot(t,i,a,e.recentStageId,t.drawProgress.bind(t,e.recentStageId,e.isTowerClear))},closeTowerStageSelectSubRoot:function(t,e){t.towerStageSelectSubRoot&&(t.towerStageSelectSubRoot.node.destroy(),t.towerStageSelectSubRoot=null)},openTowerBattleStartConfirmSubRoot:function(t,e){e.areaId&&t.drawBG(e.areaId,a.DIRECTION_TYPE.NONE),t.towerBattleStartConfirmSubRoot||(t.towerBattleStartConfirmSubRoot=cc.instantiate(t.towerBattleStartConfirmSubRootPrefab).getComponent("TowerBattleStartConfirmSubRoot"),t.subRootParent.addChild(t.towerBattleStartConfirmSubRoot.node));var i=t.towerQuestUserMap[e.areaId][e.stageId];t.challengeDeckInfoArray.length<=0&&t.setChallengeDeckInfoArray(e.areaId),t.towerBattleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,i)},closeTowerBattleStartConfirmSubRoot:function(t,e){t.towerBattleStartConfirmSubRoot&&(t.towerBattleStartConfirmSubRoot.node.destroy(),t.towerBattleStartConfirmSubRoot=null)}},cc._RF.pop()},{GameConst:"GameConst"}],TowerRoot:[function(t,e,i){"use strict";cc._RF.push(e,"669b0Hc1GVHio8V62MUx0KY","TowerRoot");var a=t("DeckRootBase"),n=t("Async"),o=t("TimeUtils"),r=t("Singleton"),s=t("PopupUtils"),c=t("DeckUtils"),l=t("GameConst"),u=t("DeckConst"),h=t("QuestUtils"),d=t("CommonUtils"),p=t("TowerUtils"),m=t("ResourceUtils"),g=t("UnlockEffectUtils"),C=t("UserUtils"),f=t("CharacterUtils"),E=t("TowerViewSetting"),T=t("BattleFunction"),S=t("BattleData"),R=t("ExchangeConst"),A=t("LocalDataConst"),b=cc.Class({extends:a,properties:{towerTopSubRootPrefab:cc.Prefab,towerStageSelectSubRootPrefab:cc.Prefab,towerBattleStartConfirmSubRootPrefab:cc.Prefab,towerDeckSelectSubRootPrefab:cc.Prefab,towerStartingConfirmPopupPrefab:cc.Prefab,towerRetireConfirmPopupPrefab:cc.Prefab,towerDropInfoPopupPrefab:cc.Prefab,towerRewardInfoPopupPrefab:cc.Prefab,towerEnemyInfoPopupPrefab:cc.Prefab,towerRewardReceivePopupPrefab:cc.Prefab,towerChestWholeViewPrefab:cc.Prefab},towerWorldId:0,selectedAreaId:0,recentStageId:0,isTowerClear:!1,towerQuestMasterMap:null,towerQuestUserMap:null,towerAreaResponce:null,towerAreaEnemyInfoMap:null,deckInfoArray:null,challengeDeckInfoArray:null,towerSession:null,towerCharacterStatus:null,towerBattleContinueData:null,towerDeckStatusMap:null,_towerBG:null,_towerStartingConfirmPopup:null,_towerRetireConfirmPopup:null,_towerQuestDropItemListDetailPopup:null,_towerStageRewardItemListDetailPopup:null,_towerRewardReceivePopup:null,_towerChestWholeView:null,onLoad:function(){cc.director.resume(),this._super()},_getSceneBgmName:function(){return l.BGM.QUEST},callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,E.TOWER_SETTING)},_isAppearTower:function(){return _.some(r.dao.TowerMainMasters,function(t){return o.isRangeOfDate(t.getDateFrom(),t.getDateTo())})},initData:function(){this.challengeDeckInfoArray=[],this.towerWorldId=h.getUserWorldArrayByWorldCategory(l.WORLD_CATEGORY.TOWER)[0].getWorldId(),this.reload(),this._isAppearTower()&&this.towerSession.getAreaId()&&(this.requestURLCount+=1,this.requestGetTowerAreaData(this.towerSession.getAreaId(),function(){this.requestURLCount-=1}.bind(this)))},initResource:function(){this._super(),this.requestRes(m.getFileNameCharacterSDSpine(f.getCharacterMainModelByCharacterId(C.getNavigatorCharacterId()).getSpineDirectoryPath()),sp.SkeletonData)},initialize:function(){if(!this._isAppearTower()){var t=r.dao.TowerMainMasters[0];return this._towerBG=this.backgroundParent.getChildByName("TowerBG").getComponent("TowerBGView"),this.drawBG(t?t.getAreaId():300101,l.DIRECTION_TYPE.NONE),void s.openSimpleMessageWindow("\u73fe\u5728\u958b\u50ac\u4e2d\u306e\u30bf\u30ef\u30fc\u306f\u3042\u308a\u307e\u305b\u3093\u3002",this.popScene.bind(this))}var e;this.initOutGameRootBase(),this.setCurrencyUIHeader(l.ITEM_ID_TOWER,null),this.setBackButtonCallBack(this._onTapBackBtn.bind(this)),this.redrawUIHeader(),this._towerBG=this.backgroundParent.getChildByName("TowerBG").getComponent("TowerBGView"),this.towerSession.getAreaId()?e={TowerStageSelectSubRoot:{areaId:this.towerSession.getAreaId()}}:this.sceneParam||(e={TowerTopSubRoot:{}}),this.sceneParam&&this.sceneParam.TowerStageSelectSubRoot&&this.drawLargeBG(this.towerSession.getAreaId(),null),this._initOpenFirstView(e)},createPreViewParam:function(){var t={};return this.towerTopSubRoot&&(t.TowerTopSubRoot={}),this.towerDeckSelectSubRoot&&(t.TowerDeckSelectSubRoot={areaId:this.getCurrentAreaId(),deckId:1}),this.towerStageSelectSubRoot&&(t.TowerStageSelectSubRoot={areaId:this.getCurrentAreaId()}),this.towerBattleStartConfirmSubRoot&&(t.TowerBattleStartConfirmSubRoot={areaId:this.getCurrentAreaId(),stageId:this.getCurrentStageId()}),t},reload:function(){this._super(),this.towerQuestMasterMap=h.getQuestMasterMapByWorldId(this.towerWorldId),this.towerQuestUserMap=h.getUserQuestMapByWorldId(this.towerWorldId),this.deckInfoArray=c.getDeckArrayByDeckTypes([u.DECK_TYPE.TOWER]),this.challengeDeckInfoArray=[],this.towerSession=r.dao.towerSession,this.towerSession.getAreaId()&&this.setChallengeDeckInfoArray(this.towerSession.getAreaId()),this.towerSession.getContinueData()?this.towerBattleContinueData=JSON.parse(this.towerSession.getContinueData()):this.towerBattleContinueData=null},drawBG:function(t,e,i){this._towerBG.drawTowerBG(this.towerQuestMasterMap[t],t,e,i)},drawLargeBG:function(t,e){this._towerBG.drawTowerLargeBG(t,e)},drawProgress:function(t,e){if(t&&e)this._playTowerClearAnimation(t);else if(t&&this.towerSession.getStageId()<=0)this._playTowerCompleteAnimation(t);else if(this._isTowerBattleWin(t))this._playStageProgressAnimation(t);else{this.towerStageSelectSubRoot.towerStageFocusView.towerStageCharacterView.idle();var i=this.getDeckInfo(r.localData[A.SELECT_TOWER_DECK_ORDER]);r.localData[A.TOWER_AUTO_MODE]&&this.isDeckAnnihilation(i.deckId)&&(r.localData[A.TOWER_AUTO_MODE]=!1,s.openCommonPopupOk("AUTO\u9032\u884c\u505c\u6b62","\u6307\u5b9a\u30c7\u30c3\u30ad\u306b\u751f\u5b58\u30e6\u30cb\u30c3\u30c8\u304c\u3044\u307e\u305b\u3093\u3002","",!1))}this.recentStageId=t,this.isTowerClear=e},_playTowerCompleteAnimation:function(t,e){r.localData[A.TOWER_AUTO_MODE]=!1,this.towerStageSelectSubRoot.towerStageFocusView.towerStageCharacterView.idle();var i=_.find(r.dao.QuestStageMasters,function(e){return e.getStageId()===t});if(!i)return this._openTowerFailurePopup(e);var a=_.find(r.dao.QuestStageMasters,function(t){return t.getStageId()===i.getReleaseStageId()});if(!a)return this._openTowerFailurePopup(e);if(i.getAreaId()!==a.getAreaId())return this._openTowerFailurePopup(e);var n=p.getTowerRewardMasterByStageId(a.getStageId());n&&n.getCompleteRewardGroupId()?this.openTowerRewardReceivePopup(p.getTowerRewardGroupMasterArrayByRewardGroupId(n.getCompleteRewardGroupId()),this.pushTowerTopSubRoot.bind(this)):this._openTowerFailurePopup(e)},_openTowerFailurePopup:function(t){t?this.pushTowerTopSubRoot():s.openCommonPopupOk("\u30bf\u30ef\u30fc\u653b\u7565\u5b8c\u4e86","\u30bf\u30ef\u30fc\u7de8\u6210\u304c\u5168\u6ec5\u3057\u307e\u3057\u305f\u3002\n\u30bf\u30ef\u30fc\u753b\u9762\u30c8\u30c3\u30d7\u3078\u9077\u79fb\u3057\u307e\u3059\u3002","",!1,function(){this.pushTowerTopSubRoot()}.bind(this))},_isTowerBattleWin:function(t){return t&&t!==this.recentStageId&&t<this.towerSession.getStageId()},_playTowerClearAnimation:function(t){this._uiHeader.node.active=!1,this._uiSide.node.active=!1,this._switchActiveBackBtn(!1),this.towerStageSelectSubRoot.towerStageSimpleView.node.active=!1,this.towerStageSelectSubRoot.progressParentNode.active=!1,r.localData[A.TOWER_AUTO_MODE]=!1;var e=cc.instantiate(this.towerChestWholeViewPrefab).getComponent("TowerChestWholeView"),i=[];i.push(function(t){if(this.towerStageSelectSubRoot.towerStageFocusView.towerStageCharacterView.win(),t)return t()}.bind(this)),i.push(this.towerStageSelectSubRoot.playClearAnimation.bind(this.towerStageSelectSubRoot)),i.push(e.playClearAnimation.bind(e,this.node)),i.push(function(t){return this._uiHeader.node.active=!0,this._uiSide.node.active=!0,this._switchActiveBackBtn(!0),t()}.bind(this)),i.push(this.openTowerRewardReceivePopup.bind(this,p.getTowerRewardGroupMasterArrayByRewardGroupId(p.getTowerRewardMasterByStageId(t).getCompleteRewardGroupId()),this.pushTowerTopSubRoot.bind(this))),n.waterfall(i)},_playStageProgressAnimation:function(t){var e=cc.instantiate(this.towerChestWholeViewPrefab).getComponent("TowerChestWholeView");this.towerStageSelectSubRoot.towerStageSimpleView.node.active=!1;var i=[];i.push(function(t){if(this.towerStageSelectSubRoot.towerStageFocusView.towerStageCharacterView.win(),t)return t()}.bind(this)),i.push(e.playOpenAnimation.bind(e,this.node)),i.push(this.openTowerRewardReceivePopup.bind(this,p.getTowerRewardGroupMasterArrayByRewardGroupId(p.getTowerRewardMasterByStageId(t).getStageRewardGroupId()),this.towerStageSelectSubRoot.playProgressAnimation.bind(this.towerStageSelectSubRoot,t))),n.waterfall(i)},pushTowerTopSubRoot:function(){this.pushScene("TowerScene",null,{TowerTopSubRoot:{}},null)},pushTowerDeckSelectSubRoot:function(){var t={TowerDeckSelectSubRoot:{areaId:this.getCurrentAreaId(),deckId:r.localData[A.SELECT_TOWER_DECK_ORDER]}},e=this.getCurrentSceneName(),i={};_.each(_.keys(this.sceneParam),function(t){i[t]=_.assign(this.sceneParam[t],{areaId:this.getCurrentAreaId()})}.bind(this)),Object.keys(t)[0]===Object.keys(i)[0]&&(e=null,i=null),this.pushScene("TowerScene",e,t,i)},pushTowerStageSelectSubRoot:function(t){var e={TowerStageSelectSubRoot:{areaId:t}};this.towerAreaResponce?this.pushScene("TowerScene",null,e,null):this.requestGetTowerAreaData(t,function(){this.pushScene("TowerScene",null,e,null)}.bind(this))},pushTowerBattleStartConfirmSubRoot:function(t){var e={TowerBattleStartConfirmSubRoot:{areaId:this.getCurrentAreaId(),stageId:t}},i=this.getCurrentSceneName(),a=this.sceneParam;Object.keys(e)[0]===Object.keys(a)[0]&&(i=null,a=null),this.pushScene("TowerScene",i,e,a)},openTowerStartingConfirmPopup:function(t){this.closeTowerStartingConfirmPopup(),this._towerStartingConfirmPopup=cc.instantiate(this.towerStartingConfirmPopupPrefab).getComponent("TowerStartingConfirmPopup"),this._towerStartingConfirmPopup.openTowerStartingConfirmPopup(t,this.towerSession,this.requestStartTower.bind(this))},closeTowerStartingConfirmPopup:function(){this._towerStartingConfirmPopup&&(this._towerStartingConfirmPopup.close(),this._towerStartingConfirmPopup=null)},openTowerRetireConfirmPopup:function(){this.closeTowerRetireConfirmPopup(),this._towerRetireConfirmPopup=cc.instantiate(this.towerRetireConfirmPopupPrefab).getComponent("SimplePopup"),this._towerRetireConfirmPopup.openSimplePopup(this.requestRetireTower.bind(this))},closeTowerRetireConfirmPopup:function(){this._towerRetireConfirmPopup&&(this._towerRetireConfirmPopup.close(),this._towerRetireConfirmPopup=null)},openTowerQuestDropItemListDetailPopup:function(t){this.closeTowerQuestDropItemDetailPopup(),this._towerQuestDropItemListDetailPopup=cc.instantiate(this.towerDropInfoPopupPrefab).getComponent("QuestDropInfoPopup"),this._towerQuestDropItemListDetailPopup.openQuestDropInfoPopup(t)},closeTowerQuestDropItemDetailPopup:function(){this._towerQuestDropItemListDetailPopup&&(this._towerQuestDropItemListDetailPopup.close(),this._towerQuestDropItemListDetailPopup=null)},openTowerStageRewardItemListDetailPopup:function(t){this.closeTowerStageRewardItemListDetailPopup(),this._towerStageRewardItemListDetailPopup=cc.instantiate(this.towerRewardInfoPopupPrefab).getComponent("TowerRewardInfoPopup"),this._towerStageRewardItemListDetailPopup.openTowerRewardInfoPopup(t)},closeTowerStageRewardItemListDetailPopup:function(){this._towerStageRewardItemListDetailPopup&&(this._towerStageRewardItemListDetailPopup.close(),this._towerStageRewardItemListDetailPopup=null)},openTowerStageEnemyListDetailPopup:function(t){this.closeTowerStageEnemyListDetailPopup(),this._towerStageEnemyListDetailPopup=cc.instantiate(this.towerEnemyInfoPopupPrefab).getComponent("QuestEnemyInfoPopup"),this._towerStageEnemyListDetailPopup.openQuestEnemyInfoPopup(t)},closeTowerStageEnemyListDetailPopup:function(){this._towerStageEnemyListDetailPopup&&(this._towerStageEnemyListDetailPopup.close(),this._towerStageEnemyListDetailPopup=null)},openTowerRewardReceivePopup:function(t,e){this.closeTowerRewardReceivePopup(),this._towerRewardReceivePopup=cc.instantiate(this.towerRewardReceivePopupPrefab).getComponent("TowerRewardReceivePopup"),this._towerRewardReceivePopup.openTowerRewardReceivePopup(t,e)},closeTowerRewardReceivePopup:function(){this._towerRewardReceivePopup&&(this._towerRewardReceivePopup.close(),this._towerRewardReceivePopup=null)},transitionTowerBattleScene:function(t,e){this.pushScene("battleLoading",t,{},e)},reTransitionByEndBattle:function(t){var e={TowerStageSelectSubRoot:{areaId:h.getAreaMasterByStageId(t).getAreaId(),recentStageId:t}};d.getRoot().popScene(!0),d.getRoot().pushScene("TowerScene",null,e,null)},reTransitionByTowerClear:function(t){var e={TowerStageSelectSubRoot:{areaId:h.getAreaMasterByStageId(t).getAreaId(),recentStageId:t,isTowerClear:!0}};d.getRoot().popScene(!0),d.getRoot().pushScene("TowerScene",null,e,null)},transitionExchangeScene:function(){var t={ExchangeSubRoot:{exchangeId:R.EXCHANGE_TAB_TYPE.TOWER}},e=this.getCurrentSceneName(),i=this.sceneParam;Object.keys(t)[0]===Object.keys(i)[0]&&(e=null,i=null),this.pushScene("ExchangeScene",e,t,i)},requestGetTowerAreaData:function(t,e){r.TowerService.getAreaData(t,function(t){this.towerCharacterStatus=t.towerCharacterStatus,this.towerDeckStatusMap=p.createCharacterStatusMap(this.towerCharacterStatus),this.towerAreaResponce=JSON.parse(d.decrypt(t.area,this.towerSession.getSessionId())),this.towerAreaEnemyInfoMap=p.createTowerAreaEnemyInfoMap(this.towerAreaResponce,this.towerBattleContinueData),e&&e()}.bind(this))},requestStartTower:function(t,e){r.TowerService.select(t,function(i){i.isUpdateDate?s.openCommonPopupOk("","\u65e5\u4ed8\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\u518d\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002",void 0,void 0,function(){d.restartGame()},void 0,!0):(e&&e(),this.towerAreaResponce=void 0,this.reload(),this.pushTowerStageSelectSubRoot(t))}.bind(this))},requestRetireTower:function(t){this.getCurrentAreaId();var e=this.towerSession.getStageId();r.TowerService.retire(function(i){t&&t(),this._playTowerCompleteAnimation(e,!0)}.bind(this))},requestStartTowerBattle:function(t,e){var i=t.getStageId();r.TowerService.startBattle(i,r.localData[A.SELECT_TOWER_DECK_ORDER],function(i){T.setTowerStartBattleData(t,i.stage,T.createSessionObjectData(i.towerSession.battleSessionId,i.towerSession.stageId,i.towerSession.deckId,u.DECK_TYPE.TOWER),T.createBattleCallbacks(this.requestSaveTowerBattleTransaction,this.requestEndTowerBattle,this.requestEndTowerBattle,this.reTransitionByEndBattle),this.towerCharacterStatus,this.towerBattleContinueData),r.soundManager.bgmStop(),e&&e(i),this.transitionTowerBattleScene()}.bind(this))},requestEndTowerBattle:function(t,e,i){var a=r.dao.userQuests,n=_.find(r.dao.userQuests,function(t){return t.getStageId()===e});r.TowerService.endBattle(t,function(t){g.saveUnLockEffectForArea(n,a),t.isTowerClear&&(S.transitionEndBattleFunc=b.prototype.reTransitionByTowerClear),i&&i(t)})},requestSaveTowerBattleTransaction:function(t,e){r.TowerService.saveBattleTransaction(t,function(t){e&&e()})},requestClearTowerBattleTransaction:function(t){r.TowerService.clearBattleTransaction(function(e){this.towerSession.saveData=null,t&&t(e)}.bind(this))},_deckUpdateCallbackEvent:function(){this.reload(),this.towerDeckSelectSubRoot&&(this.towerDeckSelectSubRoot.setDeckArray(this.deckInfoArray),this.towerDeckSelectSubRoot.redraw())},setChallengeDeckInfoArray:function(t){this.challengeDeckInfoArray=this._createChallengeDeckArray(p.getUsableDeckCount(t))},_createChallengeDeckArray:function(t){for(var e=[],i=0;i<t;i+=1)e.push(this.deckInfoArray[i]);return e},getTowerChallengeRemainCount:function(){return this.towerSession.getTowerSelectMaxCount()-this.towerSession.getTowerSelectCount()},getCurrentAreaId:function(){return this.towerSession.getAreaId()?this.towerSession.getAreaId():this.recentStageId?h.getAreaMasterByStageId(this.recentStageId).getAreaId():this.selectedAreaId?this.getSelectedAreaId():parseInt(Object.keys(this.towerQuestUserMap)[0])},setSelectedAreaId:function(t){this.selectedAreaId=t},getSelectedAreaId:function(){return this.selectedAreaId},getCurrentStageId:function(){return this.towerSession.getStageId()?this.towerSession.getStageId():this.recentStageId?this.recentStageId:parseInt(Object.keys(this.towerQuestUserMap[this.getCurrentAreaId()])[0])},getDeckInfo:function(t){return this.deckInfoArray.find(function(e){return e.deckId===t})},isDeckAnnihilation:function(t){return!this.towerDeckStatusMap||!(!this.towerDeckStatusMap[t]||this.towerDeckStatusMap[t].deckTotalHp>0)},isAllDeckAnnihilation:function(){for(var t in this.deckInfoArray)if(!this.isDeckAnnihilation(this.deckInfoArray[t].deckId))return!1;return!0},_onTapBackBtn:function(t){return this.towerStageSelectSubRoot&&this.towerStageSelectSubRoot.towerStageFocusView&&(this.towerStageSelectSubRoot.towerStageFocusView.node.active=!1),t()}});cc._RF.pop()},{Async:"Async",BattleData:"BattleData",BattleFunction:"BattleFunction",CharacterUtils:"CharacterUtils",CommonUtils:"CommonUtils",DeckConst:"DeckConst",DeckRootBase:"DeckRootBase",DeckUtils:"DeckUtils",ExchangeConst:"ExchangeConst",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TimeUtils:"TimeUtils",TowerUtils:"TowerUtils",TowerViewSetting:"TowerViewSetting",UnlockEffectUtils:"UnlockEffectUtils",UserUtils:"UserUtils"}],TowerService:[function(t,e,i){"use strict";cc._RF.push(e,"a7a57QPFJ1CBKP3rC13hvK0","TowerService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getUserData:function(t){this._requestCallApi(n.TOWER_GET_USER_DATA,{},function(e,i){return t(e?void 0:i)})},select:function(t,e){var i={areaId:t};this._requestCallApi(n.TOWER_SELECT_AREA,i,function(t,i){return e(t?void 0:i)})},getAreaData:function(t,e){var i={areaId:t};this._requestCallApi(n.TOWER_GET_AREA_DATA,i,function(t,i){return e(t?void 0:i)})},retire:function(t){this._requestCallApi(n.TOWER_RETIRE,{},function(e,i){return t(e?void 0:i)})},startBattle:function(t,e,i){var a={stageId:t,deckId:e};this._requestCallApi(n.TOWER_START_BATTLE,a,function(t,e){return i(t?void 0:e)})},endBattle:function(t,e){var i={parameter:t};this._requestCallApi(n.TOWER_END_BATTLE,i,function(t,i){return e(t?void 0:i)})},saveBattleTransaction:function(t,e){var i={saveData:t};this._requestCallApi(n.TOWER_SAVE_BATTLE_TRANSACTION,i,function(t,i){return e(t?void 0:i)})},clearBattleTransaction:function(t){this._requestCallApi(n.TOWER_CLEAR_BATTLE_TRANSACTION,{},function(e,i){return t(e?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],TowerSessionModel:[function(t,e,i){"use strict";cc._RF.push(e,"2172dX8AkJD94p9OcpY3iJn","TowerSessionModel");var a=t("UserTowerSessionModel"),n=(t("MasterDatabase"),t("TimeUtils")),o=t("Singleton");cc.Class({userData:void 0,_recentDate:null,_towerStageMasterMap:null,_isDeckEditEnabled:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._recentDate=n.createMoment(this.getTowerSelectDate())},getSessionId:function(){return this.userData.getSessionId()},getAreaId:function(){return this.userData.getAreaId()},getBattleSessionId:function(){return this.userData.getBattleSessionId()},getStageId:function(){return this.userData.getStageId()},getDeckId:function(){return this.userData.getDeckId()},getDeckType:function(){return this.userData.getDeckType()},getContinueData:function(){return this.userData.getContinueData()},getTowerSelectDate:function(){return this.userData.getTowerSelectDate()},getTowerSelectMaxCount:function(){return this.userData.getTowerSelectMaxCount()},getRecentDate:function(){return this._recentDate},getTowerStageMasterMap:function(){return this._towerStageMasterMap||(this._towerStageMasterMap={},_.forEach(_.filter(o.dao.QuestStageMasters,function(t){return t.getAreaId()===this.getAreaId()}.bind(this)),function(t){this._towerStageMasterMap[t.getStageId()]=t}.bind(this))),this._towerStageMasterMap},isDeckEditEnabled:function(){return void 0!==this._isDeckEditEnabled&&null!==this._isDeckEditEnabled||(this._isDeckEditEnabled=this._isTowerFirstStage()),this._isDeckEditEnabled},_isTowerFirstStage:function(){if(!this.getStageId())return!0;var t=_.find(o.dao.QuestStageMasters,function(t){return t.getStageId()===this.getTowerStageMasterMap()[this.getStageId()].getReleaseStageId()}.bind(this));return!t||t.getAreaId()!==this.getTowerStageMasterMap()[this.getStageId()].getAreaId()},getTowerSelectCount:function(){return Math.max(0,Math.min(this.userData.getTowerSelectCount()+Math.floor((n.getNowCountMS()-this.getRecentDate().valueOf())/864e5),this.getTowerSelectMaxCount()))}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",TimeUtils:"TimeUtils",UserTowerSessionModel:"UserTowerSessionModel"}],TowerStageCharacterView:[function(t,e,i){"use strict";cc._RF.push(e,"d94c5u8/UhMMrVydJilhsR+","TowerStageCharacterView");var a=t("SDCharacterViewBase"),n=t("UserUtils");cc.Class({extends:a,properties:{},_characterId:null,initTowerStageCharacterView:function(){this.initSDCharacterView()},_getCharacterId:function(){return this._characterId||(this._characterId=n.getNavigatorCharacterId()),this._characterId},_getDefaultSkinName:function(){return"default"},_getDefaultAnimationName:function(){return"idle"},idle:function(){this.characterSpine.timeScale=1,this.setSpineAnimation(this._getDefaultSkinName(),this._getDefaultAnimationName(),!0)},jump:function(){this.characterSpine.timeScale=1.25,this.setSpineAnimation(this._getDefaultSkinName(),"tower",!1)},getJumpDuration:function(){return.8*this.characterSpine.findAnimation("tower").duration},win:function(){this.characterSpine.timeScale=1,this.setSpineAnimation(this._getDefaultSkinName(),"win",!0)}});cc._RF.pop()},{SDCharacterViewBase:"SDCharacterViewBase",UserUtils:"UserUtils"}],TowerStageCursorView:[function(t,e,i){"use strict";cc._RF.push(e,"ab1e2AnJLZC6LmkQSxb93eB","TowerStageCursorView");t("CommonButton"),cc.Class({extends:cc.Component,properties:{cursorImageNode:cc.Node},onLoad:function(){this.cursorImageNode.stopAllActions(),this.cursorImageNode.runAction(this._createCursorAnimation())},_createCursorAnimation:function(){return cc.repeatForever(cc.sequence(cc.moveTo(.5,cc.v2(0,10)).easing(cc.easeSineInOut()),cc.moveTo(.5,cc.v2(0,0)).easing(cc.easeSineInOut())))}});cc._RF.pop()},{CommonButton:"CommonButton"}],TowerStageFocusView:[function(t,e,i){"use strict";cc._RF.push(e,"b035e2a1ONCTp38jNZkcrvz","TowerStageFocusView");t("CommonButton");var a=t("TowerStageCharacterView"),n=t("TowerStageCursorView"),o=cc.v2(220,100),r=cc.v2(0,-250),s=.7,c=.7;cc.Class({extends:cc.Component,properties:{bgCamera:cc.Camera,stageCamera:cc.Camera,towerStageCharacterView:a,towerStageCursorView:n},onLoad:function(){},initTowerStageFocusView:function(t){this.towerStageCharacterView.initTowerStageCharacterView();var e=t.getCharacterPlacementNode().convertToWorldSpaceAR(cc.v2(0,0)),i=this.towerStageCharacterView.node.parent.convertToNodeSpaceAR(e);this.towerStageCharacterView.node.setPosition(i),this.towerStageCharacterView.node.scaleX=t.getCharacterScaleX(),this.focusToStage(t,0)},playProgressCharacter:function(t,e){t.switchImageTreasure(!0),this.towerStageCharacterView.node.scaleX=t.getCharacterScaleX();var i=t.createCharacterProgressAnimation(this.towerStageCharacterView);i.push(cc.callFunc(function(){e&&e(),t.getNextTowerStageThumbnail()&&(this.towerStageCharacterView.node.scaleX=t.getNextTowerStageThumbnail().getCharacterScaleX())},this)),this.towerStageCharacterView.node.stopAllActions(),this.towerStageCharacterView.node.runAction(cc.sequence(i)),t.getNextTowerStageThumbnail()&&this.scheduleOnce(this.focusToStage.bind(this,t.getNextTowerStageThumbnail(),2,null),.3)},focusToStage:function(t,e,i){e=e||0,this._moveCursor(t,e),this.focusToPos(this._convertStageCameraPos(this.node.convertToNodeSpaceAR(t.getCharacterPlacementNode().convertToWorldSpaceAR(cc.v2(0,0)))),e,null,i)},focusToPos:function(t,e,i,a){if(e=e||0,this.stageCamera.node.stopAllActions(),this.bgCamera.node.stopAllActions(),e>0){var n=cc.moveTo(e,t);i&&n.easing(i),this.stageCamera.node.runAction(cc.sequence(n,cc.callFunc(function(){a&&a()})));var o=cc.moveTo(e,this._convertBgCameraPos(t));i&&o.easing(i),this.bgCamera.node.runAction(o)}else this.stageCamera.node.setPosition(t),this.bgCamera.node.setPosition(this._convertBgCameraPos(t)),a&&a()},switchActiveCursor:function(t){this.towerStageCursorView.node.active=t},_moveCursor:function(t,e){var i=t.getCursorPlacementNode().convertToWorldSpaceAR(cc.v2(0,0)),a=this.towerStageCursorView.node.parent.convertToNodeSpaceAR(i);this.towerStageCursorView.node.stopAllActions(),this.towerStageCursorView.node.runAction(cc.moveTo(e,a))},_convertStageCameraPos:function(t){return cc.v2(t.x+o.x,t.y+o.y)},_convertBgCameraPos:function(t){return cc.v2(t.x*s+r.x,t.y*c+r.y)},_onFinishedProgressCharacter:function(){cc.warn("\u3053\u3053\u3067\u4f55\u304b\u4e00\u8a00 \u203b\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u304c\u3042\u308c\u3070\u518d\u751f")}});cc._RF.pop()},{CommonButton:"CommonButton",TowerStageCharacterView:"TowerStageCharacterView",TowerStageCursorView:"TowerStageCursorView"}],TowerStageListView:[function(t,e,i){"use strict";cc._RF.push(e,"f5776lO7tlMDKmU6nua1yQ4","TowerStageListView");t("TowerFloorListView");var a=cc.Enum({TOP:0,L_TO_TOP:1,R_TO_L:2,L_TO_R:3});cc.Class({extends:cc.Component,properties:{towerFloorListViewParentNode:cc.Node,towerFloorListViewPrefab:cc.Prefab,thumbnailParentNode:cc.Node,towerStageTumbnailPrefabArray:[cc.Prefab]},_root:null,_callbackToInitialized:null,_towerFloorListView:null,initTowerStageListView:function(t,e,i,a,n,o){this._root=t,this._initTowerFloorListView(e),this._initTowerStageListContent(e,i,a,n,o)},_initTowerFloorListView:function(t){this._towerFloorListView||(this._towerFloorListView=cc.instantiate(this.towerFloorListViewPrefab).getComponent("TowerFloorListView"),this.towerFloorListViewParentNode.addChild(this._towerFloorListView.node)),this._towerFloorListView.initTowerFloorListView(t)},_initTowerStageListContent:function(t,e,i,a,n){this._callbackToInitialized=a,this.thumbnailParentNode.destroyAllChildren();for(var o,r=Object.keys(t),s=r.length-1;s>=0;s-=1){var c=t[r[s]],l=(e[r[s]],c.getStageId()<i),u=(c.getStageId(),this._createTowerStageThumbnail(s,r.length-1)),h=1;1===Math.floor(s%2)&&(h=-1),u.initTowerStageThumbnail(c,o,h,l),o=u,this.thumbnailParentNode.addChild(u.node)}this.schedule(this._checkInitialized,.1,cc.macro.REPEAT_FOREVER)},_checkInitialized:function(){var t=0;for(var e in this.thumbnailParentNode.children)this.thumbnailParentNode.children[e].getComponent("TowerStageThumbnail").isInitialized()&&(t+=1);t>=this.thumbnailParentNode.childrenCount&&this._onInitialized()},_onInitialized:function(){this.thumbnailParentNode.getComponent(cc.Layout).updateLayout(),this.unschedule(this._checkInitialized),this._callbackToInitialized&&(this._callbackToInitialized(),this._callbackToInitialized=void 0)},_createTowerStageThumbnail:function(t,e){return t===e?cc.instantiate(this.towerStageTumbnailPrefabArray[a.TOP]).getComponent("TowerStageThumbnail"):t===e-1?cc.instantiate(this.towerStageTumbnailPrefabArray[a.L_TO_TOP]).getComponent("TowerStageThumbnail"):t%2==1?cc.instantiate(this.towerStageTumbnailPrefabArray[a.R_TO_L]).getComponent("TowerStageThumbnail"):cc.instantiate(this.towerStageTumbnailPrefabArray[a.L_TO_R]).getComponent("TowerStageThumbnail")},_getDefaultScrollPercentage:function(t,e){var i=Object.keys(e).length,a=Object.keys(t).length,n=(i=i<a?i-1:i)/a;return Math.min(Math.max(n,0),1)},getTowerStageThumbnailByStageId:function(t){return this.thumbnailParentNode.children.find(function(e){return e.getComponent("TowerStageThumbnail").getStageMaster().getStageId()===t}).getComponent("TowerStageThumbnail")}});cc._RF.pop()},{TowerFloorListView:"TowerFloorListView"}],TowerStageSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"3f1fe9i9LtH2aeCvuuA+jhi","TowerStageSelectSubRoot");var a=t("CommonButton"),n=t("PopupUtils"),o=t("Singleton"),r=t("QuestUtils"),s=t("TowerStageFocusView"),c=(t("TowerStageListView"),t("TowerStageSimpleView")),l=t("TowerAutoDisplayOutgameWindow"),u=t("LocalDataConst"),h=t("TowerUtils");cc.Class({extends:cc.Component,properties:{scrollControllNode:cc.Node,towerStageFocusView:s,challengeCountNumeLabel:cc.Label,challengeCountDenomLabel:cc.Label,stageCountCurrentLabel:cc.Label,stageCountMaxLabel:cc.Label,listUpBtn:a,listDownBtn:a,retireBtn:a,exchangeBtn:a,progressParentNode:cc.Node,completeSpine:sp.Skeleton,towerStageSimpleView:c,towerStageListViewParentnode:cc.Node,towerStageListViewPrefabArray:[cc.Prefab],autoDisplay:l},_root:null,_stageMasterMap:null,_keys:null,_idx:null,_towerStageListView:null,onLoad:function(){this.listUpBtn.setTapEvent(this._onTapListUpBtn.bind(this),a.SE_NAME.COUNT),this.listDownBtn.setTapEvent(this._onTapListDownBtn.bind(this),a.SE_NAME.COUNT),this.retireBtn.setTapEvent(this._onTapRetireBtn.bind(this),a.SE_NAME.CANCEL),this.exchangeBtn.setTapEvent(this._onTapExchangeBtn.bind(this),a.SE_NAME.SELECT),this._initScrollEvent()},_initScrollEvent:function(){this._initWheelEvent(),this._initSwipeEvent()},_initWheelEvent:function(){var t=0;this.scrollControllNode.on(cc.Node.EventType.MOUSE_WHEEL,function(e){this.towerStageSimpleView.node.active&&((t>0&&e.getScrollY()<0||t<0&&e.getScrollY()>0)&&(t=0),(t+=e.getScrollY())>110?(t=0,this._adjustIdx(this._idx+1)&&this._focusToStage(.1)):t<-110&&(t=0,this._adjustIdx(this._idx-1)&&this._focusToStage(.1)))}.bind(this))},_initSwipeEvent:function(){var t=0;this.scrollControllNode.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.towerStageSimpleView.node.active&&((t>0&&e.getDeltaY()<0||t<0&&e.getDeltaY()>0)&&(t=0),(t+=e.getDeltaY())<-150?(t=0,this._adjustIdx(this._idx+1)&&this._focusToStage(.1)):t>150&&(t=0,this._adjustIdx(this._idx-1)&&this._focusToStage(.1)))}.bind(this))},initTowerStageSelectSubRoot:function(t,e,i,a,n){this._root=t,this._stageMasterMap=e,this._keys=Object.keys(e);var r=a&&a!==this._root.recentStageId?a:this._root.getCurrentStageId();this._initIdx(r),this._initTowerStageListView(t,e,i,r,n),this.towerStageSimpleView.initTowerStageSimpleView(t,this._callbackToCurrentStageSelect.bind(this)),this.towerStageSimpleView.drawTowerStageSimpleView(this._stageMasterMap[this._keys[this._idx]]),this.challengeCountNumeLabel.string=""+t.getTowerChallengeRemainCount(),this.challengeCountDenomLabel.string=""+t.towerSession.getTowerSelectMaxCount(),this.stageCountCurrentLabel.string=""+(this._idx+1),this.stageCountMaxLabel.string=""+this._keys.length,o.localData[u.TOWER_AUTO_MODE]&&this.autoDisplay.initAutoDisplayWindow()},_initTowerStageListView:function(t,e,i,a,n){this._towerStageListView&&this._towerStageListView.node.destroy();var o=r.getAreaMasterByStageId(a);this._towerStageListView=this._createTowerStageListViewByDifficult(o.getDifficult()),this.towerStageListViewParentnode.addChild(this._towerStageListView.node),this._towerStageListView.initTowerStageListView(t,e,i,a,function(){this.towerStageFocusView.initTowerStageFocusView(this._towerStageListView.getTowerStageThumbnailByStageId(a)),this.towerStageFocusView.switchActiveCursor(!1),n&&n()}.bind(this),this._callbackToStageThumbnail.bind(this))},_createTowerStageListViewByDifficult:function(t){return cc.instantiate(this.towerStageListViewPrefabArray[this._convertDifficultToStagePrefabIdx(t)]).getComponent("TowerStageListView")},_convertDifficultToStagePrefabIdx:function(t){return Math.floor(Math.min(Math.max(t-1,0),this.towerStageListViewPrefabArray.length-1))},playProgressAnimation:function(t,e){this._initIdx(this._root.towerSession.getStageId()),this.towerStageFocusView.playProgressCharacter(this._towerStageListView.getTowerStageThumbnailByStageId(t),function(){if(this.towerStageSimpleView.node.active=!0,this.towerStageSimpleView.drawTowerStageSimpleView(this._stageMasterMap[this._keys[this._idx]]),o.localData[u.TOWER_AUTO_MODE]&&this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){if(o.localData[u.TOWER_AUTO_MODE]){var t=this._root.getDeckInfo(o.localData[u.SELECT_TOWER_DECK_ORDER]);if(!t.deck)return o.localData[u.TOWER_AUTO_MODE]=!1,void n.openSimpleMessageWindow("\u90e8\u968a\u304c\u7de8\u6210\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");if(this._root.isDeckAnnihilation(t.deckId))return o.localData[u.TOWER_AUTO_MODE]=!1,void n.openSimpleMessageWindow("\u6307\u5b9a\u30c7\u30c3\u30ad\u306b\u751f\u5b58\u30e6\u30cb\u30c3\u30c8\u304c\u3044\u307e\u305b\u3093\u3002");if(h.checkStartBattleByUserItemsCondition()){var e=this._root.towerQuestUserMap[this._root.getCurrentAreaId()][this._root.getCurrentStageId()];this._root.requestStartTowerBattle(e)}}}.bind(this)))),e)return e()}.bind(this))},playClearAnimation:function(t){this._playCompleteSpineAnimation();var e=this._towerStageListView.getTowerStageThumbnailByStageId(Math.floor(this._keys[0])),i=this.towerStageFocusView.node.convertToNodeSpaceAR(e.getCharacterPlacementNode().convertToWorldSpaceAR(cc.v2(0,0))),a=this._towerStageListView.getTowerStageThumbnailByStageId(Math.floor(this._keys[this._keys.length-1])),n=this.towerStageFocusView.node.convertToNodeSpaceAR(a.getCharacterPlacementNode().convertToWorldSpaceAR(cc.v2(0,0)));a.switchActiveTreasure(!1),i.x=0,n.x=0,this.towerStageFocusView.towerStageCharacterView.node.parent=this._towerStageListView.node,this.towerStageFocusView.towerStageCharacterView.node.setPosition(n);this._towerStageListView.node.stopAllActions(),this._towerStageListView.node.runAction(cc.spawn(cc.sequence(cc.delayTime(1.5*.8),cc.callFunc(function(){return t()})),cc.callFunc(this.towerStageFocusView.focusToPos.bind(this.towerStageFocusView,i,0,null,this.towerStageFocusView.focusToPos.bind(this.towerStageFocusView,n,1.5,cc.easeCubicActionInOut()))),cc.scaleTo(1.5,.8,.8).easing(cc.easeCubicActionInOut())))},_playCompleteSpineAnimation:function(){this.completeSpine.node.active=!0,this.completeSpine.defaultAnimation="",this.completeSpine.setAnimation(0,"",!1),this.completeSpine.setCompleteListener(function(){this.completeSpine.node.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){this.completeSpine.node.active=!1}.bind(this))))}.bind(this))},_initIdx:function(t){this._idx=0;for(var e=0;e<this._keys.length&&(this._idx=e,this._stageMasterMap[this._keys[e]].getStageId()!==t);e+=1);this._adjustIdx(this._idx)},_adjustIdx:function(t){this.listUpBtn.node.active=!0,this.listDownBtn.node.active=!0,t<=0?(t=0,this.listDownBtn.node.active=!1):t>=this._keys.length-1&&(t=this._keys.length-1,this.listUpBtn.node.active=!1);var e=this._idx!==t;return this._idx=t,e},_callbackToCurrentStageSelect:function(){this._initIdx(this._root.towerSession.getStageId()),this._focusToStage(.2)},_callbackToStageThumbnail:function(t){this._initIdx(t),this._focusToStage(.2)},_onTapListUpBtn:function(){this._adjustIdx(this._idx+1)&&this._focusToStage(.1)},_onTapListDownBtn:function(){this._adjustIdx(this._idx-1)&&this._focusToStage(.1)},_focusToStage:function(t){this.towerStageSimpleView.drawTowerStageSimpleView(this._stageMasterMap[this._keys[this._idx]]),this.towerStageSimpleView.node.active=!1,this.towerStageFocusView.switchActiveCursor(this._idx>0||parseInt(this._keys[this._idx])!==this._root.getCurrentStageId()),this.towerStageFocusView.focusToStage(this._towerStageListView.getTowerStageThumbnailByStageId(this._stageMasterMap[this._keys[this._idx]].getStageId()),t,function(){this.towerStageSimpleView.node.active=!0}.bind(this))},_onTapRetireBtn:function(){this._root.openTowerRetireConfirmPopup()},_onTapExchangeBtn:function(){this._root.transitionExchangeScene()}});cc._RF.pop()},{CommonButton:"CommonButton",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",Singleton:"Singleton",TowerAutoDisplayOutgameWindow:"TowerAutoDisplayOutgameWindow",TowerStageFocusView:"TowerStageFocusView",TowerStageListView:"TowerStageListView",TowerStageSimpleView:"TowerStageSimpleView",TowerUtils:"TowerUtils"}],TowerStageSimpleView:[function(t,e,i){"use strict";cc._RF.push(e,"f8141L3BB1Aa7U1/8CWNCoT","TowerStageSimpleView");t("Singleton");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("QuestUtils"),r=t("TowerUtils"),s=t("PopupUtils"),c=t("MatrixThumbnailUtils"),l=t("ItemUtils"),u=t("EquipmentUtils"),h=t("GameConst"),d=t("StaticResourceConst"),p=t("TowerConst"),m=t("ItemConst");t("LocalDataConst"),cc.Class({extends:cc.Component,properties:{difficultImageSprite:cc.Sprite,difficultLabel:cc.Label,stageNameLabel:cc.Label,enemyAddLayoutNode:cc.Node,itemThumbnailParentNode:cc.Node,rewardThumbnailParentNode:cc.Node,questDropInfoBtn:a,towerStageRewardBtn:a,towerStageEnemyInfoBtn:a,currentStageSelectBtn:a,deckEditBtn:a,smallExecuteBtn:a,largeExecuteBtn:a,modelSimplePopupPrefab:cc.Prefab},_root:null,_stageId:0,_dropMasterArray:null,_rewardGroupMasterArray:null,_callbackToCurrentStageSelect:null,onLoad:function(){this.questDropInfoBtn.setTapEvent(this._onTapQuestDropInfoBtn.bind(this),""),this.towerStageRewardBtn.setTapEvent(this._onTapTowerStageRewardInfoBtn.bind(this),""),this.towerStageEnemyInfoBtn.setTapEvent(this._onTapTowerStageEnemyInfoBtn.bind(this),""),this.currentStageSelectBtn.setTapEvent(this._onTapCurrentStageSelectBtn.bind(this)),this.deckEditBtn.setTapEvent(this._onTapDeckEditBtn.bind(this)),this.smallExecuteBtn.setTapEvent(this._onTapSmallExecuteBtn.bind(this)),this.largeExecuteBtn.setTapEvent(this._onTapLargeExecuteBtn.bind(this))},initTowerStageSimpleView:function(t,e){this._root=t,this._callbackToCurrentStageSelect=e;var i=o.getAreaMasterByAreaId(this._root.getCurrentAreaId());n.addSprite(this.difficultImageSprite,n.getFileNameDifficultBand(i.getDifficult())),this.difficultLabel.string=i.getName(),this.difficultLabel.node.getComponent(cc.LabelOutline).color=this._convertDifficultToColor(i.getDifficult())},_convertDifficultToColor:function(t){switch(t){case h.QUEST_DIFFICULT.TOWER.NORMAL:return p.DIFFICULT_LABEL_OUTLINE_COLOR.NORMAL;case h.QUEST_DIFFICULT.TOWER.HARD:return p.DIFFICULT_LABEL_OUTLINE_COLOR.HARD;case h.QUEST_DIFFICULT.TOWER.EX:return p.DIFFICULT_LABEL_OUTLINE_COLOR.EX;case h.QUEST_DIFFICULT.TOWER.EX_2:return p.DIFFICULT_LABEL_OUTLINE_COLOR.EX_2;case h.QUEST_DIFFICULT.TOWER.EX_3:return p.DIFFICULT_LABEL_OUTLINE_COLOR.EX_3}return cc.color(0,0,0,255)},drawTowerStageSimpleView:function(t){this._stageId=t.getStageId(),this.stageNameLabel.node.stopAllActions(),this.stageNameLabel.string=t.getName(),this.stageNameLabel.node.opacity=0,this.stageNameLabel.node.runAction(cc.fadeIn(.3)),this.stageNameLabel.node.setPosition(cc.v2(20,0)),this.stageNameLabel.node.runAction(cc.moveTo(.3,cc.v2(0,0)).easing(cc.easeSineOut())),this._root.towerAreaEnemyInfoMap&&this._drawStageEnemies(t,this._root.towerAreaEnemyInfoMap[t.getStageId()]),this._drawQuestDrops(t),this._drawTowerStageRewards(t),this._switchActiveBtns(t,this._root.towerSession,this._root.towerCharacterStatus)},_drawStageEnemies:function(t,e){this.enemyAddLayoutNode.destroyAllChildren();for(var i=0;i<5;i+=1)if(e[i]){var a=cc.instantiate(n.getResource(d.ENEMY_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("EnemyMatrixThumbnail");this.enemyAddLayoutNode.addChild(a.node),a.initEnemyMatrixThumbnail(n.getFileNameEnemyThumbnail(e[i].enemyMain.spineDirectoryPath),n.getFileNameAttributeIcon(e[i].enemyMain.attribute),n.getFileNameRarityRing(h.RARITY.SR)),a.setLevel(e[i].enemyMain.level),t.getStageId()===this._root.towerSession.getStageId()?(a.setHpProgress(e[i].hp,e[i].enemyMain.hp),a.setSkillProgress(e[i].skillGauge,100)):t.getStageId()>this._root.towerSession.getStageId()?(a.setHpProgress(e[i].enemyMain.hp,e[i].enemyMain.hp),a.setSkillProgress(0,100)):(a.setHpProgress(0,e[i].enemyMain.hp),a.setSkillProgress(0,100))}},_drawQuestDrops:function(t){this._dropMasterArray=o.getDropMasterArrayByStageId(t.getStageId(),!0,!0),this.itemThumbnailParentNode.destroyAllChildren();for(var e=0;e<3;e+=1){var i=this._dropMasterArray[e];if(i){var a={};i.getItemType()===m.ITEM_TYPE.EQUIPMENT&&(a.rarity=u.getRarityByEquipmentIdAndExceedLimit(i.getItemId(),i.getExceedLimit()));var n=c.createMatrixThumbnailByItemType(i.getItemId(),i.getItemType(),a);n.setCallbackToThumbnailBtn(this._onTapItemThumbnail.bind(this,n.node,i.getItemId(),i.getItemType(),this.rewardThumbnailParentNode.scale)),this.itemThumbnailParentNode.addChild(n.node)}}},_drawTowerStageRewards:function(t){this._rewardGroupMasterArray=r.getTowerRewardGroupMasterArrayByRewardGroupId(r.getTowerRewardMasterByStageId(t.getStageId()).getStageRewardGroupId()),this.rewardThumbnailParentNode.destroyAllChildren();for(var e=0;e<6;e+=1){var i=this._rewardGroupMasterArray[e];if(i){var a=c.createMatrixThumbnailByItemType(i.getItemId(),i.getItemType());a.setCallbackToThumbnailBtn(this._onTapItemThumbnail.bind(this,a.node,i.getItemId(),i.getItemType(),this.rewardThumbnailParentNode.scale)),this.rewardThumbnailParentNode.addChild(a.node)}}},_switchActiveBtns:function(t,e,i){this.currentStageSelectBtn.node.active=!1,this.deckEditBtn.node.active=!1,this.smallExecuteBtn.node.active=!1,this.largeExecuteBtn.node.active=!1,t.getStageId()!==e.getStageId()?this.currentStageSelectBtn.node.active=!0:i.length>0?this.largeExecuteBtn.node.active=!0:(this.deckEditBtn.node.active=!0,this.smallExecuteBtn.node.active=!0)},_onTapQuestDropInfoBtn:function(){this._root.openTowerQuestDropItemListDetailPopup(this._stageId)},_onTapTowerStageRewardInfoBtn:function(){this._root.openTowerStageRewardItemListDetailPopup(this._stageId)},_onTapTowerStageEnemyInfoBtn:function(){this._root.towerAreaEnemyInfoMap&&this._root.openTowerStageEnemyListDetailPopup(this._root.towerAreaEnemyInfoMap[this._stageId].map(function(t){return{path:t.enemyMain.spineDirectoryPath,attribute:t.enemyMain.attribute}}))},_onTapCurrentStageSelectBtn:function(){this._callbackToCurrentStageSelect()},_onTapDeckEditBtn:function(){this._root.pushTowerDeckSelectSubRoot()},_onTapSmallExecuteBtn:function(){r.isTowerDeckEditedAlready(this._root.deckInfoArray)?(this._root.setChallengeDeckInfoArray(this._root.getCurrentAreaId()),this._root.pushTowerBattleStartConfirmSubRoot(this._stageId)):s.openCommonPopupYesNo("\u30e6\u30cb\u30c3\u30c8\u7de8\u6210\u8b66\u544a","\u30e6\u30cb\u30c3\u30c8\u304c\u7de8\u6210\u3055\u308c\u3066\u3044\u307e\u305b\u3093","\u51fa\u6483\u3059\u308b\u306b\u306f\u5c02\u7528\u306e\u7de8\u6210\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059",!0,function(){this._root.pushTowerDeckSelectSubRoot()}.bind(this),function(){},"\u7de8\u6210","\u30ad\u30e3\u30f3\u30bb\u30eb")},_onTapLargeExecuteBtn:function(){this._root.pushTowerBattleStartConfirmSubRoot(this._stageId)},_onTapItemThumbnail:function(t,e,i,a){var n=cc.instantiate(t),o=cc.instantiate(t),r=t.convertToWorldSpaceAR(cc.v2(0,0)),s=this._root.node.convertToNodeSpaceAR(r);this._root.node.addChild(o,h.Z_ORDER.POPUP),o.setScale(a),o.setPosition(s);var c=l.getItemInfo(i,e),u=cc.instantiate(this.modelSimplePopupPrefab).getComponent("ModelDetailPopup");u.node.setPosition(cc.v2(0,s.y+130)),u.openModelDetailPopup(n,c.name,c.text,function(){o.destroy()},l.getUserItemCount(e,i))}});cc._RF.pop()},{CommonButton:"CommonButton",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",MatrixThumbnailUtils:"MatrixThumbnailUtils",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",TowerConst:"TowerConst",TowerUtils:"TowerUtils"}],TowerStageThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"5c26bEQKdxLc40sPndYpd4A","TowerStageThumbnail");var a=t("TowerStepThumbnailBase"),n=t("TowerStepThumbnail");cc.Class({extends:a,properties:{cursorPlacementNode:cc.Node,treasureCloseImageNode:cc.Node,treasureOpenImageNode:cc.Node,towerStepThumbnailArray:[n]},_isInitialized:!1,_stageMaster:null,_nextTowerStageThumbnail:null,onLoad:function(){this._isInitialized=!0},initTowerStageThumbnail:function(t,e,i,a){this._stageMaster=t,this._nextTowerStageThumbnail=e,this._characterScaleX=i,this.switchImageTreasure(a)},isInitialized:function(){return this._isInitialized&&!!this._stageMaster},getStageMaster:function(){return this._stageMaster},getNextTowerStageThumbnail:function(){return this._nextTowerStageThumbnail},getCharacterScaleX:function(){return this._characterScaleX},getCursorPlacementNode:function(){return this.cursorPlacementNode},switchImageTreasure:function(t){this.treasureOpenImageNode.active=t,this.treasureCloseImageNode.active=!t},switchActiveTreasure:function(t){this.treasureOpenImageNode.active=t,this.treasureCloseImageNode.active=t},createCharacterProgressAnimation:function(t){var e=t.node.parent,i=.5*t.getJumpDuration(),a=.2*t.getJumpDuration(),n=[cc.delayTime(.4)];for(var o in this.towerStepThumbnailArray){var r=this.towerStepThumbnailArray[o].getCharacterPlacementNode().convertToWorldSpaceAR(cc.v2(0,0)),s=e.convertToNodeSpaceAR(r);n.push(cc.callFunc(t.jump,t)),n.push(cc.delayTime(a)),n.push(cc.moveTo(i,s,20,1).easing(cc.easeInOut(.9))),n.push(cc.callFunc(this.towerStepThumbnailArray[o].startStepAnimation,this.towerStepThumbnailArray[o]))}if(this._nextTowerStageThumbnail){var c=this._nextTowerStageThumbnail.getCharacterPlacementNode().convertToWorldSpaceAR(cc.v2(0,0)),l=e.convertToNodeSpaceAR(c);n.push(cc.spawn(cc.moveTo(.38,l,20,1).easing(cc.easeInOut(.9)),cc.callFunc(t.jump,t)))}return n.push(cc.delayTime(.1)),n.push(cc.callFunc(t.idle,t)),n.push(cc.jumpTo(.3,l,30,1).easing(cc.easeOut(.9))),n}});cc._RF.pop()},{TowerStepThumbnail:"TowerStepThumbnail",TowerStepThumbnailBase:"TowerStepThumbnailBase"}],TowerStartingConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"a5fc4rXW3FFj7QwPwXgwQT/","TowerStartingConfirmPopup");var a=t("PopupBase"),n=t("CommonButton");t("GameConst"),cc.Class({extends:a,properties:{challengeTextLabel:cc.Label,challengeCountBeforeLabel:cc.Label,challengeCountAfterLabel:cc.Label,challengeBtn:n,cancelBtn:n},_areaMaster:null,_callback:null,onLoad:function(){this.challengeBtn.setTapEvent(this._onTapChallengeBtn.bind(this)),this.cancelBtn.setTapEvent(this.close.bind(this),n.SE_NAME.CANCEL)},openTowerStartingConfirmPopup:function(t,e,i){this._areaMaster=t,this._callback=i,this._setChallengeText(t,e),this.open()},_setChallengeText:function(t,e){this.challengeTextLabel.string=t.getName();var i=e.getTowerSelectMaxCount()-e.getTowerSelectCount();this.challengeCountBeforeLabel.string=i+"",this.challengeCountAfterLabel.string=i-1+""},_onTapChallengeBtn:function(){this._callback(this._areaMaster.getAreaId()),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",GameConst:"GameConst",PopupBase:"PopupBase"}],TowerStepThumbnailBase:[function(t,e,i){"use strict";cc._RF.push(e,"8a47bCwpKtDtrTV2D91hzyZ","TowerStepThumbnailBase");cc.Class({extends:cc.Component,properties:{characterPlacementNode:cc.Node},getCharacterPlacementNode:function(){return this.characterPlacementNode}});cc._RF.pop()},{}],TowerStepThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"cbb73HTE1NOqaEjSxhIyiLj","TowerStepThumbnail");var a=t("TowerStepThumbnailBase");cc.Class({extends:a,properties:{},startStepAnimation:function(){this.node.runAction(this.createStepAnimation(this.node.getPosition()))},createStepAnimation:function(t){return cc.jumpTo(.1,t,-5,1).easing(cc.easeInOut(.9))}});cc._RF.pop()},{TowerStepThumbnailBase:"TowerStepThumbnailBase"}],TowerTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"e4069/8nPRBOIgBw9RuenKb","TowerTopSubRoot");var a=t("WindowBase"),n=t("CommonButton"),o=(t("Singleton"),t("PopupUtils"),t("ViewUtils")),r=t("PictureBookUtils"),s=t("CharacterUtils"),c=(t("ResourceUtils"),t("CommonUtils")),l=t("ItemUtils"),u=t("NoticeBadgeCheckUtils"),h=t("TowerAreaSelectView"),d=(t("BattleFunction"),t("GameConst")),p=t("CharacterConst"),m={POSITION:cc.v2(28,32),SCALE:cc.v2(1,1)};cc.Class({extends:a,properties:{towerAreaSelectView:h,characterStandViewParentNode:cc.Node,serifParentNode:cc.Node,currencyCountLabel:cc.Label,challengeCountNumeLabel:cc.Label,challengeCountDenomLabel:cc.Label,characterTouchBtn:n,deckEditBtn:n,exchangeBtn:n},_root:null,_towerSession:null,_characterStandView:null,onLoad:function(){this.characterTouchBtn.setTapEvent(this._onTapCharacterTouchBtn.bind(this)),this.deckEditBtn.setTapEvent(this._onTapDeckEditBtn.bind(this),n.SE_NAME.SELECT),this.exchangeBtn.setTapEvent(this._onTapExchangeBtn.bind(this),n.SE_NAME.SELECT),u.hasNewMonthlyExchangeItem()&&o.addNoticeBadge(this.exchangeBtn.node,m.POSITION,m.SCALE)},initTowerTopSubRoot:function(t,e,i){this._root=t,this._towerSession=e,this.towerAreaSelectView.initTowerAreaSelectView(t,0,i),this._initButtons(e.getAreaId());var a=this._root.getNavigatorCharacterId();this._addSerifWindow(),this._setSerifContent(a),this._addCharacterStandView(),this._setCharacterStandImage(a),this.currencyCountLabel.string=c.convertToCommaDelimited(l.getUserItemCount(d.ITEM_ID_TOWER)),this.challengeCountNumeLabel.string=t.getTowerChallengeRemainCount()+"",this.challengeCountNumeLabel.node.color=t.getTowerChallengeRemainCount()>0?d.COLOR_STATE.NORMAL:d.COLOR_STATE.ALERT,this.challengeCountDenomLabel.string=e.getTowerSelectMaxCount()+""},_addCharacterStandView:function(){this._characterStandView||(this._characterStandView=o.createCharacterStandView(),this.characterStandViewParentNode.addChild(this._characterStandView.node))},_addSerifWindow:function(){this._serifBalloon||(this._serifBalloon=o.createSerifWindow(),this.serifParentNode.addChild(this._serifBalloon.node))},_setCharacterStandImage:function(t){this._characterStandView.setCharacterStandImage(t)},_setSerifContent:function(t){var e=s.getCharacterMainModelByCharacterId(t),i=[],a=[];r.getCharacterTextMasterArray(t,p.TEXT_SCENE_TYPE.QUEST,0).forEach(function(t){i.push(t.getText()),a.push(t.getVoiceFile())}),this._serifBalloon.setSerifContent(e.getCharacterId(),e.getShortName(),i,a),this._serifBalloon.playRandomSerifAnimation()},_initButtons:function(t){if(t){var e=this.deckEditBtn.node.getComponentsInChildren(cc.Label);for(var i in e)e[i].node.opacity=d.DEACTIVATE_OPACITY;this.deckEditBtn.node.color=cc.color(128,128,128),this.deckEditBtn.setTouchEnable(!1)}else this.deckEditBtn.setTouchEnable(!0)},_onTapCharacterTouchBtn:function(){this._serifBalloon.playRandomSerifAnimation()},_onTapDeckEditBtn:function(t){this._root.pushTowerDeckSelectSubRoot()},_onTapExchangeBtn:function(){this._root.transitionExchangeScene()}});cc._RF.pop()},{BattleFunction:"BattleFunction",CharacterConst:"CharacterConst",CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",PictureBookUtils:"PictureBookUtils",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TowerAreaSelectView:"TowerAreaSelectView",ViewUtils:"ViewUtils",WindowBase:"WindowBase"}],TowerUtils:[function(t,e,i){"use strict";cc._RF.push(e,"4b8dfRcfTdC1Y1QdNgLwkiU","TowerUtils");var a=t("Singleton"),n=t("GameConst"),o=t("DeckConst"),r=t("DeckUtils"),s=t("ItemConst"),c=t("CharacterUtils"),l=t("PopupUtils"),u=t("EquipmentUtils");function h(t){return a.dao.TowerMainMasters.find(function(e){return e.getAreaId()===t})}function d(t){return h(t).getDeckIdTo()}function p(t,e,i){return t.find(function(t){return t.index===e&&t.enemyId===i})}function m(t){var e={};for(var i in t)e[t[i].enemyId]=t[i];return e}function _(t){var e={},i=0;for(var a in t)e[i=t[a].enemyGroupId]||(e[i]=[]),e[i].push(t[a]);return e}e.exports={getTowerMainMasterByAreaId:h,createCharacterStatusMap:function(t){var e=r.createDeckCharacterModelMapByDeckType(o.DECK_TYPE.TOWER),i=null;if(t)for(var a in i={},t){var n=t[a],s=e[n.characterCd],c=s.getDeckId(),l=s.getPosition(),u={hp:n.hp,skillGauge:n.skillGauge};i[c]||(i[c]={deckTotalHp:0}),i[c].characters||(i[c].characters={}),i[c].characters[l]=u,i[c].deckTotalHp+=u.hp}return i},getChallengeTowerDeckId:function(t,e){var i=0;if(e)for(var a=r.createDeckMap(),s=d(t),c=n.DECK_ID_ORIGIN;c<=s;c+=1){var l=c,u=e[l],h=a[o.DECK_TYPE.TOWER][l];if(!u&&h){i=l;break}if(u.totalDeckHp>0){i=l;break}}else i=n.DECK_ID_ORIGIN;return i},getUsableDeckCount:d,getTowerRewardMasterByStageId:function(t){return a.dao.TowerRewardMasters.find(function(e){return e.getStageId()===t})},getTowerRewardGroupMasterArrayByRewardGroupId:function(t){return a.dao.TowerRewardGroupMasters.filter(function(e){return e.getRewardGroupId()===t})},isTowerDeckEditedAlready:function(t){return!!(t[0].deck&&t[0].deck[o.DECK_LEADER_POSITION]&&t[0].deck[o.DECK_LEADER_POSITION][o.ROLE_TYPE.MAIN])},createTowerAreaEnemyInfoMap:function(t,e){var i=m(t.enemyMains),a=_(t.enemyGroups),n={},o=0,r=0,s=0,c=0,l=0,u=0,h=0,d=e?e.enemyStatus:[];for(o=0;o<t.stageWaves.length;o+=1)for(s=t.stageWaves[o].stageId,c=t.stageWaves[o].wave,l=t.stageWaves[o].enemyGroupId,n[s]||(n[s]=[]),r=0;r<a[l].length;r+=1){var g=p(d,u=a[l][r].index,h=a[l][r].enemyId);n[s].push({wave:c,index:u,hp:g?g.hp:i[h].hp,skillGauge:g?g.skillGauge:0,enemyMain:i[h]})}return n},checkStartBattleByUserItemsCondition:function(){return c.getPlayableUserCharacterModelArray().length>a.dao[a.USER].userData.getCharacterMaxCount()?(l.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):c.getNonPlayableUserCharacterModelArray().length>n.MAX_MATERIAL_COUNT?(l.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):u.getEquipmentModelArrayByEquipmentType(s.EQUIPMENT_TYPE.ATK).length>a.dao[a.USER].userData.getEquipmentMaxCount()?(l.openSimpleMessageWindow("\u88c5\u5099\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):u.getEquipmentModelArrayByEquipmentTypes([s.EQUIPMENT_TYPE.FORTIFY_MATERIAL,s.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL]).length>n.MAX_MATERIAL_COUNT?(l.openSimpleMessageWindow("\u88c5\u5099\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):!(a.dao.userItems.length>a.dao[a.USER].userData.getItemMaxCount()&&(l.openSimpleMessageWindow("\u30a2\u30a4\u30c6\u30e0\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),1))}},cc._RF.pop()},{CharacterUtils:"CharacterUtils",DeckConst:"DeckConst",DeckUtils:"DeckUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",PopupUtils:"PopupUtils",Singleton:"Singleton"}],TowerViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"6ef58JPtJtJ9b4EgA27+HOm","TowerViewSetting");var a=t("TowerRootUtils");e.exports={TOWER_SETTING:{TowerTopSubRoot:{open:a.openTowerTopSubRoot,close:a.closeTowerTopSubRoot},TowerDeckSelectSubRoot:{open:a.openTowerDeckSelectSubRoot,close:a.closeTowerDeckSelectSubRoot},TowerStageSelectSubRoot:{open:a.openTowerStageSelectSubRoot,close:a.closeTowerStageSelectSubRoot},TowerBattleStartConfirmSubRoot:{open:a.openTowerBattleStartConfirmSubRoot,close:a.closeTowerBattleStartConfirmSubRoot}}},cc._RF.pop()},{TowerRootUtils:"TowerRootUtils"}],TrapController:[function(t,e,i){"use strict";cc._RF.push(e,"e9b95O0RZ9LaJeAvEHJ5A4B","TrapController");var a=t("TrapView");cc.Class({_trapView:null,_position:0,_aliveCharacter:0,_deathCharacter:0,_invoked:!1,createTrapView:function(t,e,i,a,n,o){return this._position=e,this._aliveCharacter=a,this._deathCharacter=n,this._createView(t,i,e,o),this._trapView},_createView:function(t,e,i,n){cc.log("createView\u3092\u5404\u7a2etrap\u3067override\u3057\u3066\u304f\u3060\u3055\u3044"),this._trapView||(this._trapView=new a),this._trapView.initialize(t,e,i)},checkInvoke:function(t){if(!this._invoked&&t>this._position)return!0},invoke:function(){this._invoked=!0,this._invokeAlive(),this._invokeDeath()}});cc._RF.pop()},{TrapView:"TrapView"}],TrapFireballController:[function(t,e,i){"use strict";cc._RF.push(e,"18581/RoatBP40BTw9NbHYS","TrapFireballController");var a=t("TrapController"),n=t("TrapFireballView"),o=t("Singleton"),r=t("ResourceUtils"),s=t("MinigameConstants");cc.Class({extends:a,getWidth:function(){return 500},_invokeAlive:function(){this._trapView.play();for(var t=0;t<this._aliveCharacter.length;t+=1)this._aliveCharacter[t].miniJump()},_invokeDeath:function(){for(var t=0;t<this._deathCharacter.length;t+=1){var e=cc.delayTime(.8),i=cc.callFunc(function(t){t.deathFireball(),o.soundManager.playSE(r.getResource(s.MINIGAME_SOUND+"meteor"))}.bind(this,this._deathCharacter[t])),a=cc.sequence(e,i);this._trapView.runAction(a)}},_createView:function(t,e,i,a){this._trapView||(this._trapView=new n),this._trapView.initialize(t,e,i,a)}});cc._RF.pop()},{MinigameConstants:"MinigameConstants",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TrapController:"TrapController",TrapFireballView:"TrapFireballView"}],TrapFireballView:[function(t,e,i){"use strict";cc._RF.push(e,"b095aF14bdKk6Oed3RRUob4","TrapFireballView");var a=t("TrapView"),n=t("MinigamePlayData");cc.Class({extends:a,initialize:function(t,e,i,a){var o=250+i+n.offsetX-e*n.laneGapX,r=400+n.offsetY-e*n.laneGapY;this.setPosition(cc.v2(o,r)),this._node=cc.instantiate(a.fireballPrefab),this.addChild(this._node)},play:function(){var t=cc.moveBy(.8,cc.v2(-500,-700)),e=cc.fadeOut(0),i=cc.sequence(t,e);this._node.runAction(i)}});cc._RF.pop()},{MinigamePlayData:"MinigamePlayData",TrapView:"TrapView"}],TrapGakeController:[function(t,e,i){"use strict";cc._RF.push(e,"893e3REWzVLWpmjt5czLUfl","TrapGakeController");var a=t("TrapController"),n=t("TrapView"),o=t("Singleton"),r=t("ResourceUtils"),s=t("MinigameConstants");cc.Class({extends:a,getWidth:function(){return 1e3},_invokeAlive:function(){o.soundManager.playSE(r.getResource(s.MINIGAME_SOUND+"long_jump"));for(var t=0;t<this._aliveCharacter.length;t+=1)this._aliveCharacter[t].jump()},_invokeDeath:function(){for(var t=0;t<this._deathCharacter.length;t+=1){var e=cc.delayTime(.3),i=cc.callFunc(function(t){t.deathFall(),o.soundManager.playSE(r.getResource(s.MINIGAME_SOUND+"fall"))}.bind(this,this._deathCharacter[t])),a=cc.sequence(e,i);this._trapView.runAction(a)}},_createView:function(t,e,i){this._trapView||(this._trapView=new n),this._trapView.initialize(t,e,i)}});cc._RF.pop()},{MinigameConstants:"MinigameConstants",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TrapController:"TrapController",TrapView:"TrapView"}],TrapIkeController:[function(t,e,i){"use strict";cc._RF.push(e,"3c0ee0mjXhA/4zmj8Kb3SJR","TrapIkeController");var a=t("TrapController"),n=t("MinigameConstants"),o=t("MinigamePlayData"),r=t("TrapView"),s=t("Singleton"),c=t("ResourceUtils");cc.Class({extends:a,getWidth:function(){return 1e3},_invokeAlive:function(){var t=cc.delayTime(.2),e=cc.callFunc(function(){s.soundManager.playSE(c.getResource(n.MINIGAME_SOUND+"water"));for(var t=0;t<this._aliveCharacter.length;t+=1)this._aliveCharacter[t].addWater();for(t=0;t<this._deathCharacter.length;t+=1)this._deathCharacter[t].addWater();o.speed=n.SPEED_SLOW}.bind(this)),i=cc.delayTime(2),a=cc.callFunc(function(){for(var t=0;t<this._aliveCharacter.length;t+=1)this._aliveCharacter[t].hideWater();o.speed=n.SPEED_NORMAL}.bind(this)),r=cc.sequence(t,e,i,a);this._trapView.runAction(r)},_invokeDeath:function(){for(var t=0;t<this._deathCharacter.length;t+=1){var e=cc.delayTime(1.5),i=cc.callFunc(function(t){t.deathWaterFall(),s.soundManager.playSE(c.getResource(n.MINIGAME_SOUND+"water"))}.bind(this,this._deathCharacter[t])),a=cc.sequence(e,i);this._trapView.runAction(a)}},_createView:function(t,e,i){this._trapView||(this._trapView=new r),this._trapView.initialize(t,e,i)}});cc._RF.pop()},{MinigameConstants:"MinigameConstants",MinigamePlayData:"MinigamePlayData",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TrapController:"TrapController",TrapView:"TrapView"}],TrapIwaController:[function(t,e,i){"use strict";cc._RF.push(e,"35b30KQ2yVMi7ZGFXSRToab","TrapIwaController");var a=t("TrapController"),n=t("TrapIwaView"),o=t("Singleton"),r=t("ResourceUtils"),s=t("MinigameConstants");cc.Class({extends:a,getWidth:function(){return 500},_invokeAlive:function(){for(var t=0;t<this._aliveCharacter.length;t+=1)this._aliveCharacter[t].isDead()||(this._aliveCharacter[t].miniJump(),o.soundManager.playSE(r.getResource(s.MINIGAME_SOUND+"stone_jump")))},_invokeDeath:function(){for(var t=0;t<this._deathCharacter.length;t+=1){var e=cc.delayTime(.2),i=cc.callFunc(function(t){t.death(),o.soundManager.playSE(r.getResource(s.MINIGAME_SOUND+"stone_crush"))}.bind(this,this._deathCharacter[t])),a=cc.sequence(e,i);this._trapView.runAction(a)}},_createView:function(t,e,i){this._trapView||(this._trapView=new n),this._trapView.initialize(t,e,i)}});cc._RF.pop()},{MinigameConstants:"MinigameConstants",ResourceUtils:"ResourceUtils",Singleton:"Singleton",TrapController:"TrapController",TrapIwaView:"TrapIwaView"}],TrapIwaView:[function(t,e,i){"use strict";cc._RF.push(e,"5056bLtAsZKN5h5NXUaghex","TrapIwaView");var a=t("TrapView"),n=t("MinigamePlayData");cc.Class({extends:a,initialize:function(t,e,i){this._super(t,e,i);var a=i+150+n.offsetX-e*n.laneGapX,o=20+n.offsetY-e*n.laneGapY;this.setPosition(cc.v2(a,o))}});cc._RF.pop()},{MinigamePlayData:"MinigamePlayData",TrapView:"TrapView"}],TrapManager:[function(t,e,i){"use strict";cc._RF.push(e,"8ce9fFr9g1F37eYDSl4rirR","TrapManager");var a=t("MinigamePlayData"),n=t("TrapGakeController"),o=t("TrapIkeController"),r=t("TrapIwaController"),s=t("TrapFireballController"),c=t("CommonUtils");cc.Class({_backgroundController:null,ctor:function(t){this._root=t},setBackgroundController:function(t){this._backgroundController=t},createTrap:function(t,e,i){if(a.characterList){for(var n=[],o=0;o<t;o+=1)n.push(-1);for(o=0;o<a.characterList.length;o+=1)if(o!==e&&o!==i){for(var r=parseInt(t/2),s=c.getRandom(0,r),l=0;l<r&&-1!==n[s];l+=1)s+=1,s%=r;n[s]=o}n.push(i);var u=1e3;for(o=0;o<n.length;o+=1){var h=n[o],d=this._randTrapKind(h),p=this._createTrapByKind(d,h),m=p.trapController.createTrapView(p.spriteFrame,u,p.lane,p.aliveCharacterList,p.deathCharacterList,this._root);this._backgroundController.addTrapView(m,p.lane),a.trapList.push(p.trapController),o!==n.length-2?u+=p.trapController.getWidth():(a.rushX=u,u+=4e3)}a.goalX=u+500}else cc.error("\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u3092\u5148\u306b\u751f\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},_randTrapKind:function(t){var e=c.getRandom(0,100),i=0;return i=e<15?0:e<30?1:e<70?2:3,-1===t&&3===i&&(i=2),i},_createTrapByKind:function(t,e){var i=null;switch(t){case 0:i=this._createAllTrap(e,this._root.spriteFrameTrap[0],n);break;case 1:i=this._createAllTrap(e,this._root.spriteFrameTrap[1],o);break;case 2:i=this._createSingleTrap(e,this._root.spriteFrameTrap[2],r);break;case 3:default:i=this._createSingleTrap(e,this._root.spriteFrameTrap[3],s)}return i},_createAllTrap:function(t,e,i){for(var n=new i,o=[],r=[],s=0;s<a.characterList.length;s+=1)t!==s?o.push(a.characterList[s]):r.push(a.characterList[s]);return{trapController:n,spriteFrame:e,lane:0,aliveCharacterList:o,deathCharacterList:r}},_createSingleTrap:function(t,e,i){var n=new i,o=t,r=[],s=[];return 0<=t&&t<a.characterList.length?s.push(a.characterList[t]):(o=c.getRandom(0,3),r.push(a.characterList[o])),{trapController:n,spriteFrame:e,lane:o,aliveCharacterList:r,deathCharacterList:s}}});cc._RF.pop()},{CommonUtils:"CommonUtils",MinigamePlayData:"MinigamePlayData",TrapFireballController:"TrapFireballController",TrapGakeController:"TrapGakeController",TrapIkeController:"TrapIkeController",TrapIwaController:"TrapIwaController"}],TrapView:[function(t,e,i){"use strict";cc._RF.push(e,"e128etOZlNKoZ8HCnivPzll","TrapView");var a=t("MinigameObjectView"),n=t("MinigamePlayData");cc.Class({extends:a,_node:null,initialize:function(t,e,i){this._node=new cc.Node,this._node.addComponent(cc.Sprite).spriteFrame=t;var a=i+100+n.offsetX-e*n.laneGapX;this.setPosition(cc.v2(a,0)),this.addChild(this._node)}});cc._RF.pop()},{MinigameObjectView:"MinigameObjectView",MinigamePlayData:"MinigamePlayData"}],TutorialApis:[function(t,e,i){"use strict";cc._RF.push(e,"7b520j6hklFtq+dJI5UYIFV","TutorialApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.TUTORIAL_GET_MASTER_DATA,path:"tutorial/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.TUTORIAL_UPDATE_STEP,path:"tutorial/updateTutorialStep",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],TutorialConst:[function(t,e,i){"use strict";cc._RF.push(e,"e20c4+RHHRBOIAArdRpTkhZ","TutorialConst"),e.exports={MAIN_STEP_ORIGIN:1,SUB_STEP_DISABLE:0,SUB_STEP_ORIGIN:1,TUTORIAL_BATTLE_DECK_ID:1,DEFAULT_USER_CHARACTER_COUNT:162,TUTORIAL_GACHA_ID:99,TUTORIAL_STAGE_ID:990101,TUTORIAL_ACTION_TYPE:{BUTTON:1,BATTLE_STATE:2},EXCEPTION_TUTORIAL_EVENT:{GACHA:{EVENT_ID:12,SUB_STEP:2},BATTLE_START:{EVENT_ID:8,SUB_STEP:4}},EXCEPTION_SCENE_NAME:{QUEST:"QuestScene",ADV:"AdvScene",BATTLE_LOAD:"battleLoading",BATTLE:"battle",GACHA_REPLAY_FIRST:"GachaReplayFirst",GACHA_REPLAY:"GachaReplay",GACHA:"GachaScene",GACHA_LOAD:"GachaLoadingScene",GACHA_ANIMATION:"GachaAnimationScene",LOGIN_BONUS:"LoginBonusScene"},TRIGGER_TYPE:{BATTLE_ACTION:1,BATTLE_STATE:2,POPUP:3},BATTLE_EVENT:{SKILL_GAUGE:"SkillGauge"},BATTLE_EVENT_TARGET:{PLAYER_UNIT:"PlayerUnit",ENEMY_UNIT:"EnemyUnit"}},cc._RF.pop()},{}],TutorialEventModel:[function(t,e,i){"use strict";cc._RF.push(e,"8c4261KpchMZ5Bl9zMVOCjW","TutorialEventModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getTutorialEventId:function(){if(this._isKeyFieldAvailable("tutorialEventId"))return this._data.tutorialEventId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: tutorialEventId")},getCompleteStep:function(){if(this._isKeyFieldAvailable("completeStep"))return this._data.completeStep;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: completeStep")},getCompleteSubStep:function(){if(this._isKeyFieldAvailable("completeSubStep"))return this._data.completeSubStep;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: completeSubStep")},getDescription:function(){if(this._isKeyFieldAvailable("description"))return this._data.description;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: description")},getActionType:function(){if(this._isKeyFieldAvailable("actionType"))return this._data.actionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: actionType")},getActionParam1:function(){if(this._isKeyFieldAvailable("actionParam1"))return this._data.actionParam1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: actionParam1")},getActionParam2:function(){if(this._isKeyFieldAvailable("actionParam2"))return this._data.actionParam2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: actionParam2")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],TutorialGameManager:[function(t,e,i){"use strict";cc._RF.push(e,"7e390SLSI1CyZsd4cEwF2u0","TutorialGameManager");var a=t("QuestGameManager"),n=t("BattleData"),o=t("GameConst"),r=cc.Class({extends:a,properties:{},ctor:function(){cc.log("TutorialGameManager ctor !!!!")},startGameManager:function(){cc.log("TutorialGameManager startGameManager!!");var t=new cc.Node("TutorialBattleModal");t.setContentSize(cc.winSize),t.zIndex=o.Z_ORDER.TUTORIAL_SUB_ROOT-1,t.active=!0,t.on("touchstart",function(t){t.stopPropagation()}),t.on("touchend",function(t){t.stopPropagation()}),t.on(cc.Node.EventType.MOUSE_WHEEL,function(t){t.stopPropagation()}),cc.director.getScene().getChildByName("Canvas").addChild(t),this._super()},showResult:function(t){this._super(t);var e=cc.director.getScene().getChildByName("Canvas").getChildByName("TutorialBattleModal");e&&e.destroy()},startTutorialAdv:function(){n.isQueueStop=!0},endTutorialAdv:function(){n.isQueueStop=!1,n.GM.effectQueue.nextQuery()}});e.exports=r,cc._RF.pop()},{BattleData:"BattleData",GameConst:"GameConst",QuestGameManager:"QuestGameManager"}],TutorialHowToPlayPopup:[function(t,e,i){"use strict";cc._RF.push(e,"6140d1WLpZGjJfGF/if5b5C","TutorialHowToPlayPopup");var a=t("HowToPlayPopup");cc.Class({extends:a,properties:{},openTutorialHowToPlayPopup:function(t,e,i){this.openHowToPlayPopup(t,e,i)}});cc._RF.pop()},{HowToPlayPopup:"HowToPlayPopup"}],TutorialMainStepModel:[function(t,e,i){"use strict";cc._RF.push(e,"bed53grPL1KYIi1Na/LWZHl","TutorialMainStepModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStep:function(){if(this._isKeyFieldAvailable("step"))return this._data.step;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: step")},getSceneName:function(){if(this._isKeyFieldAvailable("sceneName"))return this._data.sceneName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sceneName")},getViewName:function(){if(this._isKeyFieldAvailable("viewName"))return this._data.viewName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: viewName")},getViewParam:function(){if(this._isKeyFieldAvailable("viewParam"))return this._data.viewParam;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: viewParam")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],TutorialService:[function(t,e,i){"use strict";cc._RF.push(e,"a7df6YqJ1tAzYDIn+H0X3Xl","TutorialService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,updateTutorialStep:function(t,e){var i={tutorialStep:t};this._requestCallApi(n.TUTORIAL_UPDATE_STEP,i,function(t,i){return e(t?void 0:i)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],TutorialSubStepModel:[function(t,e,i){"use strict";cc._RF.push(e,"eb7662xGXJIzaXZxCFXwskj","TutorialSubStepModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStep:function(){if(this._isKeyFieldAvailable("step"))return this._data.step;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: step")},getSubStep:function(){if(this._isKeyFieldAvailable("subStep"))return this._data.subStep;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: subStep")},getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getTriggerName:function(){if(this._isKeyFieldAvailable("triggerName"))return this._data.triggerName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerName")},getTriggerType:function(){if(this._isKeyFieldAvailable("triggerType"))return this._data.triggerType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerType")},getTriggerParam:function(){if(this._isKeyFieldAvailable("triggerParam"))return this._data.triggerParam;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: triggerParam")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],TutorialUtils:[function(t,e,i){"use strict";cc._RF.push(e,"40b8dCfLAhKXZiqAQTt2PfA","TutorialUtils");var a=t("Singleton"),n=t("ResourceUtils"),o=t("QuestUtils"),r=t("ExtensionAdvUtils"),s=t("ExtensionAdvUtils"),c=t("BattleFunction"),l=t("BattleData"),u=t("StaticResourceConst"),h=t("LocalDataConst"),d=t("TutorialConst"),p=t("GameConst"),m=t("DeckConst"),g=t("SceneConst"),C=t("SingletonConst");function f(t){if(a.dao.TutorialMainStepMasters)return a.dao.TutorialMainStepMasters.find(function(e){return e.getStep()===t})}function E(t){if(a.dao.TutorialSubStepMasters)return a.dao.TutorialSubStepMasters.find(function(e){return e.getStep()===t&&e.getSubStep()===a.localData[h.TUTORIAL_SUB_STEP]})}function T(){return!!a.dao[a.USER]&&(a[C.ENVIRONMENT].getDebugTutorialSkip()||!f(a.dao[a.USER].getTutorialStep()))}function S(t){switch(t){case d.EXCEPTION_SCENE_NAME.ADV:case d.EXCEPTION_SCENE_NAME.BATTLE_LOAD:case d.EXCEPTION_SCENE_NAME.BATTLE:case d.EXCEPTION_SCENE_NAME.GACHA_LOAD:case d.EXCEPTION_SCENE_NAME.GACHA_ANIMATION:return!0}return!1}function R(t,e){return 1===a.localData[h.TUTORIAL_SUB_STEP]&&e.getSceneName()===t.getCurrentSceneName()}function A(t){t&&t.node&&t.node.parent&&(t.playCallbackToTutorialEndBtn(),t.node.destroy())}function b(t,e){e.getViewName()?t.sceneParam='{"'+e.getViewName()+'":{'+e.getViewParam()+"}}":t.sceneParam=void 0}function M(t,e){a.TutorialService.updateTutorialStep(a.dao.TutorialMainStepMasters.length+1,function(){a.LoginBonusService.getLoginBonus(function(i){if(e&&e(),i.loginBonus){var a={LoginBonusSubRoot:{loginBonus:i.loginBonus}};t.pushScene(g.SCENE.FILE_NAME.LOGIN_BONUS,null,a,null)}else t.pushScene(g.SCENE.FILE_NAME.HOME)})})}function v(t){a.GachaService.getList(function(e){var i=a.dao.userGacha.find(function(t){return t.getGachaId()===d.TUTORIAL_GACHA_ID});if(i){var n=i.getButtons()[0];a.GachaService.play(n.gachaGroupId,n.gachaId,parseInt(n.buttonId),1,n.skuId,function(e){M(t)})}else M(t)})}function P(t,e,i,n,o){a.localData[h.TUTORIAL_SUB_STEP]=n.getSubStep()+1,l.GM&&l.GM.endTutorialAdv&&l.GM.endTutorialAdv(),E(i.getStep())?(A(e),o&&o()):f(i.getStep()+1)?(a.localData[h.TUTORIAL_SUB_STEP]=d.SUB_STEP_DISABLE,a.TutorialService.updateTutorialStep(i.getStep()+1,function(){A(e),o&&o()})):(A(e),M(t,o))}function I(t){return a.dao.StoryTutorialMasters.find(function(e){return e.getStoryId()===t}).getResourceId()}function y(t){var e=f(a.dao[a.USER].getTutorialStep());return!!e&&!!(e.getSceneName()!==d.EXCEPTION_SCENE_NAME.GACHA&&t.getCurrentSceneName()===d.EXCEPTION_SCENE_NAME.GACHA||t.getCurrentSceneName()===d.EXCEPTION_SCENE_NAME.GACHA_LOAD||(t.getCurrentSceneName()===d.EXCEPTION_SCENE_NAME.GACHA||t.getCurrentSceneName()===d.EXCEPTION_SCENE_NAME.GACHA_LOAD||t.getCurrentSceneName()===d.EXCEPTION_SCENE_NAME.GACHA_ANIMATION)&&a.localData[h.IS_EXIST_GACHA_SESSION])}function N(t,e){a.localData[h.TUTORIAL_SUB_STEP]=d.SUB_STEP_DISABLE,a.TutorialService.updateTutorialStep(t,function(){var t=cc.director.getScene().name===d.EXCEPTION_SCENE_NAME.ADV?"AdvGameRootBase":"GameRootBase";cc.director.getScene().getChildByName("Canvas").getComponent(t).pushScene(e,null,null,null)})}function B(t){var e=E(t);e&&s.startAdv(e.getStoryId(),a[C.ENVIRONMENT].getAdultFlg()?1:0,[r.createAdvTextInfo(e.getStoryId(),n.getFileNameTutorialScript(I(e.getStoryId())),n.getFileNameTutorialSynopsis(I(e.getStoryId())))],null,null,function(){N(t+1,"HomeScene")})}function L(t,e){a.QuestService.saveBattleTransaction(t,function(t){e&&e(t)})}function w(t,e,i){a.QuestService.endBattle(t,function(t){i&&i(t)})}function D(t,e){var i=JSON.parse('{"'+e.getViewName()+'":{'+e.getViewParam()+"}}"),n=parseInt(i.TutorialBattle.stageId),r=o.createUserStageFlatMap()[n];a.QuestService.startBattle(n,d.TUTORIAL_BATTLE_DECK_ID,!1,function(i){c.setQuestStartBattleData(r,i.stage,c.createSessionObjectData(i.session.sessionId,i.session.stageId,i.session.deckId,m.DECK_TYPE.QUEST),c.createBattleCallbacks(L,w,w,function(){l.isQueueStop=!1,N(e.getStep()+1,"HomeScene")})),a.soundManager.bgmStop();t.pushScene("battleLoading",void 0,{},void 0)})}function U(t,e){var i=_.find(a.dao.userQuests,function(t){return t.getStageId()===d.TUTORIAL_STAGE_ID});i&&i.getClearCount()<=0?a.DeckService.updateAll(m.DECK_TYPE.QUEST,p.DECK_ID_ORIGIN,[a.dao.userCharacters[0]],function(i){t.pushScene(e.getSceneName(),null,null,null)}):N(a.dao[a.USER].getTutorialStep()+1,"HomeScene")}function F(t,e){a.GachaService.getList(function(e){a.dao.userGacha.find(function(t){return t.getGachaId()===d.TUTORIAL_GACHA_ID})?t.pushScene(d.EXCEPTION_SCENE_NAME.GACHA,null,null,null):N(a.dao[a.USER].getTutorialStep()+1,"HomeScene")})}function O(t,e){a.localData[h.IS_EXIST_GACHA_SESSION]?(a.localData[h.IS_EXIST_GACHA_SESSION]=!1,t.pushScene("GachaScene",null,{GachaTopSubRoot:{selectGachaId:0,isLoadSession:!0}},null)):N(a.dao[a.USER].getTutorialStep()+1,"HomeScene")}function k(t){var e=f(a.dao[a.USER].getTutorialStep()),i=E(e.getStep()),o=cc.director.getScene().getChildByName("Canvas").getComponent("GameRootBase"),c=s.createTutorial(o,i.getStoryId(),a[C.ENVIRONMENT].getAdultFlg()?1:0,[r.createAdvTextInfo(i.getStoryId(),n.getFileNameTutorialScript(I(i.getStoryId())),n.getFileNameTutorialSynopsis(I(i.getStoryId())))],a.dao[a.USER].getUserName(),null,function(a){P(o,c,e,i,t)})}e.exports={isTutorialEnded:T,isTutorialTransition:function(t){return!(a[C.ENVIRONMENT].getDebugTutorialSkip()||!a.dao[a.USER]||T()||y(t)||a.localData[h.TUTORIAL_SUB_STEP]>d.SUB_STEP_DISABLE)},isTutorialAdvByPopup:function(t){if(!a.dao[a.USER])return!1;var e=f(a.dao[a.USER].getTutorialStep());if(!e)return!1;var i=E(e.getStep());return!!i&&i.getTriggerType()===d.TRIGGER_TYPE.POPUP&&i.getTriggerName()===t},isTutorialAdvByIngameEvent:function(t){var e=f(a.dao[a.USER].getTutorialStep());if(!e)return!1;var i=E(e.getStep());if(!i)return!1;switch(i.getTriggerType()){case d.TRIGGER_TYPE.BATTLE_ACTION:return i.getTriggerName()===t;case d.TRIGGER_TYPE.BATTLE_STATE:return l[i.getTriggerName()]===i.getTriggerParam();default:return!1}},isTutorialScene:function(){if(!a.dao[a.USER])return!1;if(!f(a.dao[a.USER].getTutorialStep()))return!1;switch(cc.director.getScene().name){case g.SCENE.FILE_NAME.FIRST_LOGIN:case g.SCENE.FILE_NAME.FIRST_LOGIN_AFTER:case g.SCENE.FILE_NAME.RESOURCE_DOWNLOAD:case g.SCENE.FILE_NAME.TITLE:case g.SCENE.FILE_NAME.BATTLE:case g.SCENE.FILE_NAME.GACHA_LOAD:case g.SCENE.FILE_NAME.GACHA_ANIMATION:case g.SCENE.FILE_NAME.ADV:return!1}return!0},isTutorialGachaReplayFirst:function(){if(!a.dao[a.USER])return!1;var t=f(a.dao[a.USER].getTutorialStep());return!!t&&cc.director.getScene().name===d.EXCEPTION_SCENE_NAME.GACHA_ANIMATION&&t.getSceneName()===d.EXCEPTION_SCENE_NAME.GACHA_REPLAY_FIRST},initTutorialForRoot:function(t){if(!a[C.ENVIRONMENT].getDebugTutorialSkip()&&a.dao[a.USER]&&!S(t.getCurrentSceneName())){var e=f(a.dao[a.USER].getTutorialStep());if(e){if(R(t,e))b(t,e);else if(a.localData[h.TUTORIAL_SUB_STEP]<=d.SUB_STEP_DISABLE)return;var i=E(e.getStep());if(i)var o=s.createTutorial(t,i.getStoryId(),a[C.ENVIRONMENT].getAdultFlg()?1:0,[r.createAdvTextInfo(i.getStoryId(),n.getFileNameTutorialScript(I(i.getStoryId())),n.getFileNameTutorialSynopsis(I(i.getStoryId())))],a.dao[a.USER].getUserName(),null,function(a){P(t,o,e,i)})}}},initTutorialForTransition:function(t){var e=f(a.dao[a.USER].getTutorialStep());if(e)switch(a.localData[h.TUTORIAL_SUB_STEP]=d.SUB_STEP_ORIGIN,e.getSceneName()){case d.EXCEPTION_SCENE_NAME.GACHA_REPLAY_FIRST:case d.EXCEPTION_SCENE_NAME.GACHA_REPLAY:O(t);break;case d.EXCEPTION_SCENE_NAME.ADV:B(e.getStep());break;case d.EXCEPTION_SCENE_NAME.BATTLE:D(t,e);break;case d.EXCEPTION_SCENE_NAME.QUEST:U(t,e);break;case d.EXCEPTION_SCENE_NAME.GACHA:F(t);break;case d.EXCEPTION_SCENE_NAME.LOGIN_BONUS:v(t);break;default:t.pushScene(e.getSceneName(),null,null,null)}else v(t)},openTutorialHowToPlayPopup:function(t,e,i){a[C.ENVIRONMENT].getDebugTutorialSkip()||cc.instantiate(n.getResource(u.HOW_TO_PLAY_POPUP_PREFAB_PATH)).getComponent("TutorialHowToPlayPopup").openTutorialHowToPlayPopup(t,e,i)},startTutorialAdv:k,startBattleTutorialAdv:function(t){l.isQueueStop=!0,k(t)}},cc._RF.pop()},{BattleData:"BattleData",BattleFunction:"BattleFunction",DeckConst:"DeckConst",ExtensionAdvUtils:"ExtensionAdvUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst",StaticResourceConst:"StaticResourceConst",TutorialConst:"TutorialConst"}],UIHeaderCurrencyThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"36d4d0OmvpJP7UkolfUA8CD","UIHeaderCurrencyThumbnail");var a=t("Singleton"),n=t("CommonButton"),o=t("CommonUtils"),r=t("ItemUtils"),s=t("ResourceUtils"),c=t("GameConst");t("ItemConst");cc.Class({extends:cc.Component,properties:{currencySprite:cc.Sprite,currencyNameLabel:cc.Label,currencyNumLabel:cc.Label,currencyBtn:n},_currencyItemId:0,_currencyBtnEventCallBack:null,initUIHeaderCurrencyThumbnail:function(t,e){this._currencyItemId=parseInt(t),this._currencyBtnEventCallBack=e,this._setCurrency(),this._setCurrencyBtn()},_setCurrency:function(){switch(this.currencySprite.node.active=!1,this.currencyNameLabel.node.active=!1,void 0===this._currencyItemId&&(this._currencyItemId=c.ITEM_ID_GOLD),this._currencyItemId){case c.ITEM_ID_FREE_GEM:case c.ITEM_ID_PAID_GEM:this.currencySprite.node.active=!0,this.currencyNumLabel.string=o.convertToCommaDelimited(a.dao[a.USER].getGem());break;default:this.currencySprite.node.active=!0,this.currencySprite.node.scale=.26,s.addSprite(this.currencySprite,s.getFileNameItemImage(this._currencyItemId)),this.currencyNumLabel.string=o.convertToCommaDelimited(r.getUserItemCount(this._currencyItemId))}},_setCurrencyBtn:function(){this._currencyItemId!==c.ITEM_ID_GOLD&&this._currencyBtnEventCallBack?this.currencyBtn.setTapEvent(this.currencyBtnEvent.bind(this)):this.currencyBtn.node.active=!1},currencyBtnEvent:function(){switch(this._currencyItemId){case c.ITEM_ID_FREE_GEM:case c.ITEM_ID_PAID_GEM:return void cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase").transitionShopSceneByUIHeader();default:return this._currencyBtnEventCallBack?this._currencyBtnEventCallBack():cc.error("\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002")}}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",ResourceUtils:"ResourceUtils",Singleton:"Singleton"}],UIHeader:[function(t,e,i){"use strict";cc._RF.push(e,"8b03ag9U15JCpa85h2CjeLZ","UIHeader");var a=t("Singleton"),n=t("CommonUtils"),o=t("CommonButton"),r=t("UIHomeButton"),s=t("UIRankButton"),c=t("BPProgressView"),l=t("GameConst"),u=t("DeckConst"),h=t("PopupUtils"),d=(t("ItemConst"),t("ItemUtils")),p=(n=t("CommonUtils"),t("ResourceUtils")),m=t("LocalDataConst"),g=t("StaticResourceConst"),C=t("SceneConst"),f=t("TutorialUtils");cc.Class({extends:cc.Component,properties:{homeButton:r,rankButton:s,titleParent:cc.Node,userStatsParent:cc.Node,userPointStatsParent:cc.Node,extendedCurrencyParent:cc.Node,titleLabel:cc.Label,homeButtonParent:cc.Node,switchCharacterShowModeButton:o,selectCharacterButton:o,apLabel:cc.Label,apProgressBar:cc.ProgressBar,apProgressMaxAnimation:cc.Animation,apRecoveryBtn:o,apRemainLabel:cc.Label,bpProgressView:c,currencyNameLabel:cc.Label,currencyNumLabel:cc.Label,currencySprite:cc.Sprite,currencyBtn:o,gemLabel:cc.Label,gemPurchaseBtn:o,furnitureButton:o,howToPlayButton:o,helpButton:o,menuButton:o,menuPopup:cc.Prefab,currencyThumbnail:cc.Prefab},_userBasicData:null,_iViewStamina:0,_currencyItemId:0,_currencyBtnEventCallBack:null,_switchCharacterShowModeCallBack:null,_currentCurrencyInfoArray:null,_apRecoveryPopup:null,_root:null,onLoad:function(){this._root=cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase"),this._setRecoveryEvent(),this._setSwitchCharacterShowModeBtn(),this._setSelectCharacterBtn(),this._setApRecoveryBtn(),this._setMenuBtn(),this._setCurrencyBtn(),this._setGemPurchaseBtn(),this._setFurnitureBtn(),this._setHowToPlayBtn(),this._setHelpBtn(),this.redraw()},redraw:function(){this._userBasicData=a.dao[a.USER],this._currentCurrencyInfoArray?this.setCurrencyInfo(this._currentCurrencyInfoArray):this._setCurrency(),this.gemLabel.string=n.convertToCommaDelimited(this._userBasicData.getGem());var t=this._userBasicData.getCurrentStaminaInfo();this._setStamina(t.currentStamina),this._setStaminaRemainSec(t.staminaRemainSec),this.updateApProgressBar(),this._switchApProgressBarAnimation(),this.bpProgressView.redraw();var e=cc.director.getScene().name;e===C.SCENE.FILE_NAME.HOME?(this.hideTitle(),this.homeButtonParent.active=!0,this.homeButton.node.active=!1,this.rankButton.node.active=!0,this._redrawSelectCharacterBtn()):(this.showTitle(),this.homeButtonParent.active=!1,this.homeButton.node.active=!0,this.rankButton.node.active=!1,this.setTitle(C.SCENE.NAME[e])),this._redrawHelpBtn(e)},updateApProgressBar:function(){var t=a.dao.userBasicData,e=t.getCurrentStaminaInfo().currentStamina/t.getMaxStamina();this.apProgressBar.progress=e<1?e:1},_switchApProgressBarAnimation:function(){1===this.apProgressBar.progress?this.apProgressMaxAnimation.play():this.apProgressMaxAnimation.stop()},setTitle:function(t){this.titleLabel.string=t},showTitle:function(){this.titleParent.active=!0},hideTitle:function(){this.titleParent.active=!1},showUserStats:function(){this.userStatsParent.active=!0},hideUserStats:function(){this.userStatsParent.active=!1},hideUserPointStats:function(){this.userPointStatsParent.active=!1},showBpProgressView:function(){this.bpProgressView.node.active=!0},hideBpProgressView:function(){this.bpProgressView.node.active=!1},showExtendedCurrency:function(){this.extendedCurrencyParent.active=!0},hideExtendedCurrency:function(){this.extendedCurrencyParent.active=!1},removeExtendedCurrencyChildren:function(){this.extendedCurrencyParent.destroyAllChildren()},_setRecoveryEvent:function(){var t=cc.sequence(cc.delayTime(1),cc.callFunc(this._autoRecovery.bind(this))),e=cc.repeatForever(t);this.node.runAction(e)},_autoRecovery:function(){var t=this._userBasicData.getCurrentStaminaInfo();this._setStaminaRemainSec(t.staminaRemainSec),this._iViewStamina<=t.currentStamina&&(this._setStamina(t.currentStamina),this.updateApProgressBar()),this.bpProgressView.redraw()},_setStamina:function(t){this._iViewStamina=t,this.apLabel.string=t+"/"+this._userBasicData.getMaxStamina()},_setStaminaRemainSec:function(t){var e=t%60,i=("00"+Math.floor(t/60)).slice(-2),a=("00"+e).slice(-2);this.apRemainLabel.string="\u3042\u3068 "+i+":"+a},_setSwitchCharacterShowModeBtn:function(){this.switchCharacterShowModeButton.setTapEvent(function(){this._switchCharacterShowModeCallBack&&this._switchCharacterShowModeCallBack(),this.switchCharacterShowModeButton.switchBtnImage(n.loadLocalStorage(m.LOCAL_STORAGE_KEY.MY_PAGE_BACKGROUND,!1,m.LOCAL_STORAGE_GET_TYPE.BOOLEAN))}.bind(this))},setVisibleSwitchCharacterShowModeBtn:function(t){this.switchCharacterShowModeButton.node.active=t,this.switchCharacterShowModeButton.switchBtnImage(n.loadLocalStorage(m.LOCAL_STORAGE_KEY.MY_PAGE_BACKGROUND,!1,m.LOCAL_STORAGE_GET_TYPE.BOOLEAN))},setCallbackToSelectCharacterBtn:function(t){this._callbackToSelectCharacter=t},_setSelectCharacterBtn:function(){this._redrawSelectCharacterBtn(),this.selectCharacterButton.setTapEvent(this._onTapSelectCharacter.bind(this))},_isFavoriteRoom:function(){var t=a.dao[a.USER].userData.getPartner();return!(!t||0===t.isDisplayRoom||0===t.partnerId)},_redrawSelectCharacterBtn:function(){this.selectCharacterButton.switchBtnImage(this._isFavoriteRoom())},_onTapSelectCharacter:function(){this.selectCharacterButton.setTouchEnable(!1),a.CharacterService.changePartner([a.dao[a.USER].getPartnerId(u.DECK_TYPE.QUEST)],this._isFavoriteRoom()?0:1,function(t){this._callbackToSelectCharacter&&this._callbackToSelectCharacter(t)}.bind(this))},setCallbackToFurnitureBtn:function(t){this.furnitureButton.setTapEvent(t,o.SE_NAME.SELECT),this.furnitureButton.node.active=!0},_setFurnitureBtn:function(){this.furnitureButton.node.active=!1},_setHowToPlayBtn:function(){var t=_.find(a.dao.UserHowToPlayMasters,function(t){return t.getSceneName()===cc.director.getScene().name});t?(this.howToPlayButton.node.active=!0,this.howToPlayButton.setTapEvent(function(){cc.instantiate(p.getResource(g.NEWS_POPUP_PREFAB_PATH)).getComponent("NewsPopup").openNewsPopup(l.NEWS_TAB.HOW_TO_PLAY,t.getPage())},o.SE_NAME.SELECT)):this.howToPlayButton.node.active=!1},_setHelpBtn:function(){var t=this._createHowToPlayData();this.helpButton.setTapEvent(function(){h.openHowToPlayPopup(t.helpImagePathArray,t.helpDescriptionTextArray)}),!n.loadLocalStorage(m.LOCAL_STORAGE_KEY.TUTORIAL_HELP_READ+this._convertSceneNameWithTutorialHelp(cc.director.getScene().name),!1,m.LOCAL_STORAGE_GET_TYPE.BOOLEAN)&&this._isSceneWithHowToPlay(cc.director.getScene().name)&&f.isTutorialEnded()&&f.openTutorialHowToPlayPopup(t.helpImagePathArray,t.helpDescriptionTextArray,function(){n.saveLocalStorage(m.LOCAL_STORAGE_KEY.TUTORIAL_HELP_READ+this._convertSceneNameWithTutorialHelp(cc.director.getScene().name),!0)}.bind(this))},_redrawHelpBtn:function(t){this.helpButton.node.active=this._isSceneWithHowToPlay(t)},_isSceneWithHowToPlay:function(t){return!!_.find(a.dao.UserHelpMasters,function(e){return e.getSceneName()===t})},_convertSceneNameWithTutorialHelp:function(t){switch(t){case C.SCENE.FILE_NAME.PROMOTE_CHARACTER_DETAIL:return C.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT}return t},_createHowToPlayData:function(){var t=[],e=[],i=cc.director.getScene().name,o=_.filter(a.dao.UserHelpMasters,function(t){return t.getSceneName()===i});return o.sort(function(t,e){return n.sortFunc(parseInt(t.getOrder()),parseInt(e.getOrder()))}),_.forEach(o,function(a){var n=p.getFileNameHelp(i,a.getFileName());t.push(n),e.push(a.getDescriptionText())}),{helpImagePathArray:t,helpDescriptionTextArray:e}},_setApRecoveryBtn:function(){this.apRecoveryBtn.setTapEvent(function(){if(this._iViewStamina>=l.MAX_USER_AP)return h.openSimpleMessageWindow("\u3059\u3067\u306bAP\u306f\u6700\u5927\u72b6\u614b\u3067\u3059");var t=n.getRoot();this._closeApRecoveryPopup(),this._apRecoveryPopup=cc.instantiate(p.getResource(g.AP_RECOVERY_POPUP_PREFAB_PATH)).getComponent("ApRecoveryPopup"),this._apRecoveryPopup.openApRecoveryPopup(t.requestUseRecoveryItem.bind(t)),this.redraw()}.bind(this))},_closeApRecoveryPopup:function(){this._apRecoveryPopup&&(this._apRecoveryPopup.close(),this._apRecoveryPopup=null)},_setCurrency:function(){switch(this.currencySprite.node.active=!1,this.currencyNameLabel.node.active=!1,void 0===this._currencyItemId&&(this._currencyItemId=l.ITEM_ID_GOLD),this._currencyItemId){case l.ITEM_ID_GOLD:case l.ITEM_ID_PVP:case l.ITEM_ID_TOWER:case l.ITEM_ID_RAID:this.currencySprite.node.active=!0,p.addSprite(this.currencySprite,p.getFileNameItemImage(this._currencyItemId));break;default:this.currencyNameLabel.node.active=!0,this.currencyNameLabel.string=d.getItemMaster(this._currencyItemId).getName()}this.currencyNumLabel.string=n.convertToCommaDelimited(d.getUserItemCount(this._currencyItemId))},setCurrencyItemId:function(t){this._currencyItemId=t},_setCurrencyBtn:function(){void 0===this._currencyItemId&&(this._currencyItemId=l.ITEM_ID_GOLD),this._currencyItemId===l.ITEM_ID_GOLD?this.currencyBtn.node.active=!1:(this.currencyBtn.node.active=!0,this.currencyBtn.setTapEvent(this.currencyBtnEvent.bind(this)))},currencyBtnEvent:function(){if(this._currencyBtnEventCallBack)return this._currencyBtnEventCallBack()},setCurrencyBtnEvent:function(t){this._currencyBtnEventCallBack=t},_setGemPurchaseBtn:function(){this.gemPurchaseBtn.setTapEvent(function(){cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase").transitionShopSceneByUIHeader()})},_setMenuBtn:function(){this.menuButton.setTapEvent(this._openMenuPopupView.bind(this))},_openMenuPopupView:function(){cc.instantiate(this.menuPopup).getComponent("MenuPopup").openMenuPopup(this._root)},setSwitchCharacterShowModeCallBack:function(t){this._switchCharacterShowModeCallBack=t},setCurrencyInfo:function(t){this.hideUserStats(),this.removeExtendedCurrencyChildren(),this._currentCurrencyInfoArray=t,t&&t instanceof Array&&t.forEach(function(t){this._addCurrencyThumbnail(t.itemId,t.callback)}.bind(this)),this.showExtendedCurrency()},_addCurrencyThumbnail:function(t,e){var i=cc.instantiate(this.currencyThumbnail).getComponent("UIHeaderCurrencyThumbnail");i.initUIHeaderCurrencyThumbnail(t,e),this.extendedCurrencyParent.addChild(i.node)}}),cc._RF.pop()},{BPProgressView:"BPProgressView",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DeckConst:"DeckConst",GameConst:"GameConst",ItemConst:"ItemConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",TutorialUtils:"TutorialUtils",UIHomeButton:"UIHomeButton",UIRankButton:"UIRankButton"}],UIHomeButton:[function(t,e,i){"use strict";cc._RF.push(e,"0cb77FpFg1JjrhIrVTrJx9c","UIHomeButton");var a=t("CommonButton");t("MemoryManager"),t("BattleConstants");cc.Class({extends:cc.Component,properties:{homeBtn:a,effectNode:cc.Node},onLoad:function(){this.homeBtn.setTapEvent(this._tapEvent.bind(this)),this.homeBtn.setOverEvent(function(){this.effectNode.active=!0}.bind(this),function(){this.effectNode.active=!1}.bind(this))},_tapEvent:function(){"HomeScene"!==cc.director.getScene().name&&(cc.log("MemoryManager start release UIHomeButton..."),cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase").clearScene(),cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase").pushScene("HomeScene",null,null,null,!0))}}),cc._RF.pop()},{BattleConstants:"BattleConstants",CommonButton:"CommonButton",MemoryManager:"MemoryManager"}],UIRankButton:[function(t,e,i){"use strict";cc._RF.push(e,"ae746bRbFhFpJZlRBus46Wl","UIRankButton");var a=t("Singleton"),n=t("CommonButton"),o=t("MissionUtils");cc.Class({extends:cc.Component,properties:{profileBtn:n,rankLabel:cc.Label,expGaugeSprite:cc.Sprite,effectNode:cc.Node},onLoad:function(){this.profileBtn.setTapEvent(this._hideUI.bind(this)),this._setRank(),this._setExpGauge(),this.profileBtn.setOverEvent(function(){this.effectNode.active=!0}.bind(this),function(){this.effectNode.active=!1}.bind(this))},_setRank:function(){var t=a.dao.userBasicData;this.rankLabel.string=t.getLevel()},_setExpGauge:function(){var t=a.dao.userBasicData;this.expGaugeSprite.fillRange=.5+.5*t.getNextLevelExpRate()},_isIgnoreUI:function(t){return"ModalLayer"===t.name},_hideUI:function(){var t,e=cc.director.getScene().getChildByName("Canvas");for(t=0;t<e.children.length;t++)this._isIgnoreUI(e.children[t])||(e.children[t].active=!1);var i=e.getChildByName("SubRootParent");for(t=0;t<i.children.length;t++)i.children[t].active=!1;var a=i.getChildByName("MyPageCharaGroup");if(a)for(t=0;t<a.children.length;t++)a.children[t].active=!1;this._activateTargetNode(e.getChildByName("Main Camera")),this._activateTargetNode(e.getChildByName("Background")),this._activateTargetNode(i),a&&(this._activateTargetNode(a),this._activateTargetNode(a.getChildByName("character_pos"))),this._activateTargetNode(e.getChildByName("ParticleFront")),this._activateTargetNode(e.getChildByName("ParticleBack")),this._activateTargetNode(e.getChildByName("TopBandBlack")),this._activateTargetNode(e.getChildByName("BottomBandBlack")),this._activateTargetNode(e.getChildByName("LeftBandBlack")),this._activateTargetNode(e.getChildByName("RightBandBlack"));var n=new cc.Node("TouchNode");n.setContentSize(cc.winSize),cc.director.getScene().getChildByName("Canvas").addChild(n),n.on("touchstart",function(t){t.stopPropagation()}),n.on("touchend",function(t){this._activateUI(),t.stopPropagation(),n.destroy()}.bind(this))},_activateUI:function(){var t,e=cc.director.getScene().getChildByName("Canvas");for(t=0;t<e.children.length;t++)this._isIgnoreUI(e.children[t])||(e.children[t].active=!0);var i=e.getChildByName("SubRootParent");for(t=0;t<i.children.length;t++)i.children[t].active=!0;var a=i.getChildByName("MyPageCharaGroup");if(a)for(t=0;t<a.children.length;t++)a.children[t].active=!0;var n=i.getChildByName("MyPageBtnGroup").panelMissionBtn;n&&(n.active=!o.isPanelMissionComplete()),cc.director.getScene().getChildByName("Canvas").getComponent("OutGameRootBase").callSceneStackListener()},_activateTargetNode:function(t){t&&(t.active=!0)}}),cc._RF.pop()},{CommonButton:"CommonButton",MissionUtils:"MissionUtils",Singleton:"Singleton"}],UISide:[function(t,e,i){"use strict";cc._RF.push(e,"a949a/XxYtFKbnlzOjb/lnL","UISide");t("MemoryManager");var a=t("CommonButton"),n=(t("PopupUtils"),t("ViewUtils")),o=(t("WindowBase"),t("Singleton"),t("DevelopmentUtils"),t("CommonUtils")),r=(t("MissionUtils"),t("PictureBookUtils"),t("NoticeBadgeCheckUtils")),s=t("GameConst"),c=t("SceneConst"),l=(t("BattleConstants"),{POSITION:cc.v2(64,26),SCALE:cc.v2(1,1)});cc.Class({extends:cc.Component,properties:{sideButtonArray:[a]},onLoad:function(){this.initSideButton()},initSideButton:function(){for(var t=cc.director.getScene().name,e=0;e<this.sideButtonArray.length;e++){var i=this.sideButtonArray[e],a=s.SIDE_BUTTON[Object.keys(s.SIDE_BUTTON)[e]];i.showDevelopmentText(a,10,10),this._setSideBtnEvent(i,a,t),this._setNoticeBadge(i,a)}},_setSideBtnEvent:function(t,e,i){t.switchBtnImage(this._isCurrentScene(e,i)),t.setTapEvent(function(){this._transitionEvent(e)}.bind(this)),t.setOverEvent(function(){},function(){})},_isCurrentScene:function(t,e){switch(t){case s.SIDE_BUTTON.QUEST:return this._isQuestScene(e);case s.SIDE_BUTTON.DECK:return this._isDeckScene(e);case s.SIDE_BUTTON.GACHA:return this._isGachaScene(e);case s.SIDE_BUTTON.PROMOTE:return this._isPromoteScene(e);case s.SIDE_BUTTON.ROOM:return this._isRoomScene(e);case s.SIDE_BUTTON.MISSION:return this._isMissionScene(e);case s.SIDE_BUTTON.EQUIPMENT:return this._isEquipmentScene(e)}return!1},_isQuestScene:function(t){switch(t){case c.SCENE.FILE_NAME.QUEST:case c.SCENE.FILE_NAME.NORMAL_QUEST:case c.SCENE.FILE_NAME.WEEK:case c.SCENE.FILE_NAME.EVENT:case c.SCENE.FILE_NAME.TOWER:case c.SCENE.FILE_NAME.RAID:case c.SCENE.FILE_NAME.PVP:return!0}return!1},_isDeckScene:function(t){switch(t){case c.SCENE.FILE_NAME.DECK:return!0}return!1},_isGachaScene:function(t){switch(t){case c.SCENE.FILE_NAME.GACHA:case c.SCENE.FILE_NAME.GACHA_ANIMATION:return!0}return!1},_isPromoteScene:function(t){switch(t){case c.SCENE.FILE_NAME.PROMOTE_CHARACTER_SELECT:case c.SCENE.FILE_NAME.PROMOTE_CHARACTER_DETAIL:return!0}return!1},_isRoomScene:function(t){switch(t){case c.SCENE.FILE_NAME.ROOM:case c.SCENE.FILE_NAME.ROOM_CHARACTER:return!0}return!1},_isMissionScene:function(t){switch(t){case c.SCENE.FILE_NAME.MISSION:return!0}return!1},_isEquipmentScene:function(t){switch(t){case c.SCENE.FILE_NAME.EQUIPMENT:return!0}return!1},_transitionEvent:function(t){var e=o.getRoot();t!==e.getCurrentSceneName()&&cc.log("MemoryManager start release UISlide._transitionEvent..."),e.clearScene(),e.pushScene(t,c.SCENE.FILE_NAME.HOME,null,null,!0)},_setNoticeBadge:function(t,e){switch(e){case s.SIDE_BUTTON.QUEST:this._setNoticeBadgeForQuest(t.node);break;case s.SIDE_BUTTON.PROMOTE:this._setNoticeBadgeForPromote(t.node);break;case s.SIDE_BUTTON.EQUIPMENT:this._setNoticeBadgeForEquipment(t.node);break;case s.SIDE_BUTTON.GACHA:this._setNoticeBadgeForGacha(t.node);break;case s.SIDE_BUTTON.MISSION:this._setNoticeBadgeForMission(t.node);break;case s.SIDE_BUTTON.ROOM:this._setNoticeBageForRoom(t.node)}},_setNoticeBadgeForQuest:function(t){(r.hasNewEventQuest()||r.hasUnclearedBeginerQuest()||r.hasPvPChallengeCount()||r.hasWeekUnlockCount()||r.hasTowerChallengerCount())&&n.addNoticeBadge(t,l.POSITION,l.SCALE)},_setNoticeBadgeForPromote:function(t){(r.hasSellMaterial()||r.hasPromotableCharacter())&&n.addNoticeBadge(t,l.POSITION,l.SCALE)},_setNoticeBadgeForGacha:function(t){r.hasGachaTicket()&&n.addNoticeBadge(t,l.POSITION,l.SCALE)},_setNoticeBadgeForEquipment:function(t){r.hasExceedableEquipment()&&n.addNoticeBadge(t,l.POSITION,l.SCALE)},_setNoticeBadgeForMission:function(t){r.hasReceivableMission()&&n.addNoticeBadge(t,l.POSITION,l.SCALE)},_setNoticeBageForRoom:function(t){r.hasNewReleasedRoomStory()&&n.addNoticeBadge(t,l.POSITION,l.SCALE)}});cc._RF.pop()},{BattleConstants:"BattleConstants",CommonButton:"CommonButton",CommonUtils:"CommonUtils",DevelopmentUtils:"DevelopmentUtils",GameConst:"GameConst",MemoryManager:"MemoryManager",MissionUtils:"MissionUtils",NoticeBadgeCheckUtils:"NoticeBadgeCheckUtils",PictureBookUtils:"PictureBookUtils",PopupUtils:"PopupUtils",SceneConst:"SceneConst",Singleton:"Singleton",ViewUtils:"ViewUtils",WindowBase:"WindowBase"}],UnisonCutinView:[function(t,e,i){"use strict";cc._RF.push(e,"876bfG785xJy4Hs5Ft7VqVt","UnisonCutinView");cc.Class({extends:cc.Component,properties:{spriteStand:cc.Sprite}});cc._RF.pop()},{}],UnlockEffectConst:[function(t,e,i){"use strict";cc._RF.push(e,"c69d0eurLZPhqIfxUwUYjxq","UnlockEffectConst");cc.Class({statics:{TRIGGER_PREFIX_NAME:{EXTRA_QUEST:"ExtraQuest_",NORMAL_WORLD:"NormalWorld_",QUEST_AREA:"QuestArea_",RAID_BOSS:"RaidBoss_",CHARACTER_EQUIPMENT:"CharacterEquipment_",EQUIPMENT_ABILITY:"EquipmentAbility_"}}});cc._RF.pop()},{}],UnlockEffectUtils:[function(t,e,i){"use strict";cc._RF.push(e,"54c35Rab9FFnZWqBUjdEPrA","UnlockEffectUtils");var a=t("Singleton"),n=t("CommonUtils"),o=t("ResourceUtils"),r=t("StaticResourceConst"),s=t("GameConst"),c=t("UnlockEffectConst");function l(t,e,i){u(t,e,i)}function u(t,e,i){e.active=!1,e.parent.addChild(t.node),t.node.setPosition(e.getPosition()),t.node.scale=e.scale,t.on("finished",function(e){if(t.node.destroy(),i)return i()}),t.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){t.play()})))}e.exports={playUnLockEffectAnimationNormal:function(t,e){l(cc.instantiate(o.getResource(r.UNLOCK_EFFECT_PREFAB_PATH)).getComponent(cc.Animation),t,e)},playUnLockEffectAnimationWhite:function(t,e){l(cc.instantiate(o.getResource(r.UNLOCK_EFFECT_WHITE_PREFAB_PATH)).getComponent(cc.Animation),t,e)},saveUnLockEffectForExtraQuest:function(t,e){if(!(t.getCategory()!==s.WORLD_CATEGORY.NORMAL&&t.getCategory()!==s.WORLD_CATEGORY.EVENT||t.getAreaDifficult()===s.QUEST_DIFFICULT.NORMAL.EX||e.length>=a.dao.userQuests.length)){var i=_.filter(a.dao.userQuests,function(e){return e.getReleaseStageId()===t.getStageId()});_.forEach(i,function(t){t.getAreaDifficult()===s.QUEST_DIFFICULT.NORMAL.EX&&n.saveLocalStorage(c.TRIGGER_PREFIX_NAME.EXTRA_QUEST+t.getWorldId(),!0)})}},saveUnLockEffectForNormalWorld:function(t,e){if(t.getCategory()===s.WORLD_CATEGORY.NORMAL&&!(e.length>=a.dao.userQuests.length)){var i=_.filter(a.dao.userQuests,function(e){return e.getReleaseStageId()===t.getStageId()});_.forEach(i,function(e){e.getWorldId()!==t.getWorldId()&&n.saveLocalStorage(c.TRIGGER_PREFIX_NAME.NORMAL_WORLD+e.getWorldId(),!0)})}},saveUnLockEffectForArea:function(t,e){if(!(e.length>=a.dao.userQuests.length)){var i=_.filter(a.dao.userQuests,function(e){return e.getReleaseStageId()===t.getStageId()});_.forEach(i,function(e){e.getAreaId()!==t.getAreaId()&&n.saveLocalStorage(c.TRIGGER_PREFIX_NAME.QUEST_AREA+e.getWorldId(),e.getAreaId())})}},saveUnLockEffectForRaidBoss:function(t,e){if(!(e.length>=a.dao.userQuests.length)){var i=_.filter(a.dao.userQuests,function(e){return e.getReleaseStageId()===t.getStageId()});(i=_.filter(i,function(t){return _.find(a.dao.RaidBattleMasters,function(e){return t.getStageId()===e.getStageId()})||_.find(a.dao.StoryEventMasters,function(e){return t.getStageId()===e.getStageId()})})).length<=0||n.saveLocalStorage(c.TRIGGER_PREFIX_NAME.RAID_BOSS+i[0].getAreaId(),i.length-1)}},saveUnlockEffectForCharacterEquipment:function(t,e){for(var i=0;i<t.getCharacterEquipmentInfoArray().length;i+=1)!t.getCharacterEquipmentInfoArray()[i].isReleased&&e.getCharacterEquipmentInfoArray()[i].isReleased&&n.saveLocalStorage(c.TRIGGER_PREFIX_NAME.CHARACTER_EQUIPMENT+t.getCharacterCd()+"_"+t.getCharacterEquipmentInfoArray()[i].position,!0)}},cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",StaticResourceConst:"StaticResourceConst",UnlockEffectConst:"UnlockEffectConst"}],UserApis:[function(t,e,i){"use strict";cc._RF.push(e,"ff135jyuRtAAZ0GPFWx66kL","UserApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.USER_GET_CLIENT_VERSION,path:"user/getClientVersion",method:"GET"}),a.RESTClient.graft({name:n.LOGIN,path:"user/login",method:"POST"}),a.RESTClient.graft({name:n.INITIAL_USER_DATA,path:"user/initialUserData",method:"POST"}),a.RESTClient.graft({name:n.USER_GET_MASTER_DATA,path:"user/getMasterData",method:"GET",type:"binary"}),a.RESTClient.graft({name:n.GET_USER_DATA,path:"user/getUserData",method:"POST"}),a.RESTClient.graft({name:n.USER_UPDATE_USERNAME,path:"user/updateUserName",method:"POST"}),a.RESTClient.graft({name:n.USER_UPDATE_SETTING,path:"user/updateSetting",method:"POST"}),a.RESTClient.graft({name:n.USER_RECOVERY_STAMINA,path:"user/recoveryStamina",method:"POST"}),a.RESTClient.graft({name:n.USER_RECOVERY_BATTLE_POINT,path:"user/recoveryBattlePoint",method:"POST"}),a.RESTClient.graft({name:n.USER_UPDATE_USER_TEXT,path:"user/updateUserText",method:"POST"}),a.RESTClient.graft({name:n.USER_UPDATE_PLAYER_TYPE,path:"user/updatePlayerType",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],UserBasicInfoModel:[function(t,e,i){"use strict";cc._RF.push(e,"fe2cd57whtAR7WUjF16ddT/","UserBasicInfoModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");cc.Class({extends:a,getIsBgmMute:function(){if(this._isKeyFieldAvailable("isBgmMute"))return this._data.isBgmMute;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isBgmMute")},getIsSeMute:function(){if(this._isKeyFieldAvailable("isSeMute"))return this._data.isSeMute;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isSeMute")},getIsVoiceMute:function(){if(this._isKeyFieldAvailable("isVoiceMute"))return this._data.isVoiceMute;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isVoiceMute")},getIsSkillAuto:function(){if(this._isKeyFieldAvailable("isSkillAuto"))return this._data.isSkillAuto;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isSkillAuto")},getStaminaValue:function(){if(this._isKeyFieldAvailable("staminaValue"))return this._data.staminaValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: staminaValue")},getCharacterMaxCount:function(){if(this._isKeyFieldAvailable("characterMaxCount"))return this._data.characterMaxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterMaxCount")},getItemMaxCount:function(){if(this._isKeyFieldAvailable("itemMaxCount"))return this._data.itemMaxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemMaxCount")},getDefaultDeckId:function(){if(this._isKeyFieldAvailable("defaultDeckId"))return this._data.defaultDeckId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: defaultDeckId")},getSystemDate:function(){if(this._isKeyFieldAvailable("systemDate"))return this._data.systemDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: systemDate")},getVoiceVolume:function(){if(this._isKeyFieldAvailable("voiceVolume"))return this._data.voiceVolume;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: voiceVolume")},getFreeGem:function(){if(this._isKeyFieldAvailable("freeGem"))return this._data.freeGem;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: freeGem")},getEquipmentMaxCount:function(){if(this._isKeyFieldAvailable("equipmentMaxCount"))return this._data.equipmentMaxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentMaxCount")},getIsEnabled:function(){if(this._isKeyFieldAvailable("isEnabled"))return this._data.isEnabled;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isEnabled")},getUserCd:function(){if(this._isKeyFieldAvailable("userCd"))return this._data.userCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userCd")},getBattleSpeed:function(){if(this._isKeyFieldAvailable("battleSpeed"))return this._data.battleSpeed;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: battleSpeed")},getSeVolume:function(){if(this._isKeyFieldAvailable("seVolume"))return this._data.seVolume;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: seVolume")},getStaminaBonus:function(){if(this._isKeyFieldAvailable("staminaBonus"))return this._data.staminaBonus;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: staminaBonus")},getPaidGem:function(){if(this._isKeyFieldAvailable("paidGem"))return this._data.paidGem;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: paidGem")},getBgmVolume:function(){if(this._isKeyFieldAvailable("bgmVolume"))return this._data.bgmVolume;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: bgmVolume")},getDisplayId:function(){if(this._isKeyFieldAvailable("displayId"))return this._data.displayId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: displayId")},getUserName:function(){if(this._isKeyFieldAvailable("userName"))return this._data.userName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userName")},getUserNameTextId:function(){if(this._isKeyFieldAvailable("userNameTextId"))return this._data.userNameTextId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userNameTextId")},getUserNameStatus:function(){if(this._isKeyFieldAvailable("userNameStatus"))return this._data.userNameStatus;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userNameStatus")},getPartner:function(){if(this._isKeyFieldAvailable("partner"))return this._data.partner;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: partner")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getStaminaRecoveryDate:function(){if(this._isKeyFieldAvailable("staminaRecoveryDate"))return this._data.staminaRecoveryDate},getExp:function(){if(this._isKeyFieldAvailable("exp"))return this._data.exp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exp")},getRegisterDate:function(){if(this._isKeyFieldAvailable("registerDate"))return this._data.registerDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: registerDate")},getStaminaRemainSec:function(){if(this._isKeyFieldAvailable("staminaRemainSec"))return this._data.staminaRemainSec;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: staminaRemainSec")},getUserText:function(){if(this._isKeyFieldAvailable("userText"))return this._data.userText;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userText")},getPlayerType:function(){if(this._isKeyFieldAvailable("playerType"))return this._data.playerType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: playerType")},getRoomCharacterMaxCount:function(){if(this._isKeyFieldAvailable("roomCharacterMaxCount"))return this._data.roomCharacterMaxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: roomCharacterMaxCount")},getBattlePointValue:function(){if(this._isKeyFieldAvailable("battlePointValue"))return this._data.battlePointValue;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: battlePointValue")},getBattlePointBonus:function(){if(this._isKeyFieldAvailable("battlePointBonus"))return this._data.battlePointBonus;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: battlePointBonus")},getBattlePointRemainSec:function(){if(this._isKeyFieldAvailable("battlePointRemainSec"))return this._data.battlePointRemainSec;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: battlePointRemainSec")},getBattlePointRecoveryDate:function(){if(this._isKeyFieldAvailable("battlePointRecoveryDate"))return this._data.battlePointRecoveryDate},getTutorialStep:function(){if(this._isKeyFieldAvailable("tutorialStep"))return this._data.tutorialStep;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: tutorialStep")},getTutorialEndDate:function(){if(this._isKeyFieldAvailable("tutorialEndDate"))return this._data.tutorialEndDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: tutorialEndDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserBoostModel:[function(t,e,i){"use strict";cc._RF.push(e,"bea2fiQwyZERLSdvx8DIv2H","UserBoostModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getBoostType:function(){if(this._isKeyFieldAvailable("boostType"))return this._data.boostType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: boostType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getParameter:function(){if(this._isKeyFieldAvailable("parameter"))return this._data.parameter;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: parameter")},getEndDate:function(){if(this._isKeyFieldAvailable("endDate"))return this._data.endDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: endDate")},getStartDate:function(){if(this._isKeyFieldAvailable("startDate"))return this._data.startDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: startDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserBuffHelpModel:[function(t,e,i){"use strict";cc._RF.push(e,"361c6WKZtZPjoDivCGPneI2","UserBuffHelpModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getName:function(){if(this._isKeyFieldAvailable("name"))return this._data.name;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: name")},getText:function(){if(this._isKeyFieldAvailable("text"))return this._data.text;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: text")},getFileName:function(){if(this._isKeyFieldAvailable("fileName"))return this._data.fileName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fileName")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"b74b3Tc0y9NF5xSjhNCBKy2","UserCharacterModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterCd:function(){if(this._isKeyFieldAvailable("characterCd"))return this._data.characterCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterCd")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getExp:function(){if(this._isKeyFieldAvailable("exp"))return this._data.exp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exp")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getSkillLevel:function(){if(this._isKeyFieldAvailable("skillLevel"))return this._data.skillLevel;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: skillLevel")},getAbilityLevel1:function(){if(this._isKeyFieldAvailable("abilityLevel1"))return this._data.abilityLevel1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityLevel1")},getAbilityLevel2:function(){if(this._isKeyFieldAvailable("abilityLevel2"))return this._data.abilityLevel2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityLevel2")},getAbilityLevel3:function(){if(this._isKeyFieldAvailable("abilityLevel3"))return this._data.abilityLevel3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: abilityLevel3")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")},getExceedLimitExp:function(){if(this._isKeyFieldAvailable("exceedLimitExp"))return this._data.exceedLimitExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimitExp")},getIsProtect:function(){if(this._isKeyFieldAvailable("isProtect"))return this._data.isProtect;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isProtect")},getRegisterDate:function(){if(this._isKeyFieldAvailable("registerDate"))return this._data.registerDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: registerDate")},getEquipmentWeaponCds:function(){if(this._isKeyFieldAvailable("equipmentWeaponCds"))return this._data.equipmentWeaponCds;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentWeaponCds")},getEquipmentProtectorCds:function(){if(this._isKeyFieldAvailable("equipmentProtectorCds"))return this._data.equipmentProtectorCds;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentProtectorCds")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserDataApi:[function(t,e,i){"use strict";cc._RF.push(e,"88a32BK6NdBbqPj4I4c3HuN","UserDataApi");var a=t("ApiConstants");e.exports={CHARACTER:a.CHARACTER_GET_USER_DATA,MISSION:a.MISSION_GET_USER_DATA,SHOP:a.SHOP_GET_USER_DATA,STORY:a.STORY_GET_USER_DATA,EQUIPMENT:a.EQUIPMENT_GET_USER_DATA,DECK:a.DECK_GET_USER_DATA,ITEM:a.ITEM_GET_USER_DATA,QUEST:a.QUEST_GET_USER_DATA,ROOM:a.ROOM_GET_USER_DATA,PVP:a.PVP_GET_USER_DATA,TOWER:a.TOWER_GET_USER_DATA,PICTURE_BOOK:a.PICTURE_BOOK_GET_USER_DATA,GACHA:a.GACHA_GET_LIST,EVENT:a.EVENT_GET_USER_DATA,MINIGAME:a.MINIGAME_GET_USER_DATA},cc._RF.pop()},{ApiConstants:"ApiConstants"}],UserDataConstants:[function(t,e,i){"use strict";cc._RF.push(e,"2880d6sfDFOWagcD3Ah7Eyx","UserDataConstants"),e.exports={DATA_TYPE:{CHARACTER:"CHARACTER",MISSION:"MISSION",SHOP:"SHOP",STORY:"STORY",EQUIPMENT:"EQUIPMENT",DECK:"DECK",ITEM:"ITEM",QUEST:"QUEST",ROOM:"ROOM",PVP:"PVP",TOWER:"TOWER",PICTURE_BOOK:"PICTURE_BOOK",EVENT:"EVENT",MINIGAME:"minigame"},DATA_KEY:{CHARACTER:"characters",UPDATECHARACTER:"updateCharacters",ADDCHARACTER:"addCharacters",MISSION:"missions",EQUIPMENT:"equipments",UPDATEEQUIPMENT:"updateEquipments",ADDEQUIPMENT:"addEquipments",DECK:"decks",QUEST:"quests",BATTLE_SESSION:"battleSession",ITEM:"items",USER:"user",USER_BOOST:"boosts",ROOM:"room",ROOM_LAYOUT:"roomLayouts",FURNITURE:"furniture",PVP:"pvp",RAID:"raid",TOWER_SESSION:"towerSession",PICTURE_BOOK_BASE:"pictureBookBase",PICTURE_BOOK_DETAIL:"pictureBookDetail",SHOP:"purchaseHistories",EXCHANGE:"exchangeHistories",STORY:"stories",GACHA:"gacha",MINIGAME:"minigame",EVENT:"eventItems",WAREHOUSE_CHARACTER:"warehouseCharacters",UPDATEWAREHOUSE_CHARACTER:"updateWarehouseCharacters",ADDWAREHOUSE_CHARACTER:"addWarehouseCharacters",WAREHOUSE_EQUIPMENT:"warehouseEquipments",UPDATEWAREHOUSE_EQUIPMENT:"updateWarehouseEquipments",ADDWAREHOUSE_EQUIPMENT:"addWarehouseEquipments",WAREHOUSE_MATERIAL:"warehouseMaterials",UPDATEWAREHOUSE_MATERIAL:"updateWarehouseMaterials",ADDWAREHOUSE_MATERIAL:"addWarehouseMaterials"},DATA_MODEL:{CHARACTER:"CharacterModel",MISSION:"MissionModel",EQUIPMENT:"EquipmentModel",DECK:"DeckModel",QUEST:"QuestModel",BATTLE_SESSION:"BattleSessionModel",ITEM:"ItemModel",USER:"UserModel",USER_BOOST:"BoostModel",ROOM_LAYOUT:"UserRoomLayoutModel",FURNITURE:"FurnitureModel",ROOM:"RoomModel",SHOP:"UserPurchaseHistoryModel",EXCHANGE:"UserExchangeHistoryModel",STORY:"StoryModel",PVP:"PvPModel",RAID:"RaidModel",TOWER_SESSION:"TowerSessionModel",PICTURE_BOOK_BASE:"PictureBookBaseModel",PICTURE_BOOK_DETAIL:"PictureBookDetailModel",GACHA:"UserGachaModel",EVENT:"UserEventItemModel",WAREHOUSE_CHARACTER:"WarehouseCharacterModel",WAREHOUSE_EQUIPMENT:"WarehouseEquipmentModel",WAREHOUSE_MATERIAL:"WarehouseMaterialModel",MINIGAME:"UserMinigameModel"}},cc._RF.pop()},{}],UserDataLoadSettings:[function(t,e,i){"use strict";cc._RF.push(e,"dfa73WtpbRGUp8JcX59BbXo","UserDataLoadSettings");var a=t("UserDataConstants");e.exports={MISSION:[{key:a.DATA_KEY.MISSION,name:"userMissions",model:a.DATA_MODEL.MISSION,isArray:!0}],SHOP:[{key:a.DATA_KEY.SHOP,name:"userPurchaseHistories",model:a.DATA_MODEL.SHOP,isArray:!0},{key:a.DATA_KEY.EXCHANGE,name:"userExchangeHistories",model:a.DATA_MODEL.EXCHANGE,isArray:!0}],STORY:[{key:a.DATA_KEY.STORY,name:"userStories",model:a.DATA_MODEL.STORY,isArray:!0}],CHARACTER:[{key:a.DATA_KEY.CHARACTER,name:"userCharacters",model:a.DATA_MODEL.CHARACTER,isArray:!0},{key:a.DATA_KEY.UPDATECHARACTER,name:"userCharacters",model:a.DATA_MODEL.CHARACTER,isArray:!0,kind:"update",cd:"CharacterCd"},{key:a.DATA_KEY.ADDCHARACTER,name:"userCharacters",model:a.DATA_MODEL.CHARACTER,isArray:!0,kind:"add",cd:"CharacterCd"}],EQUIPMENT:[{key:a.DATA_KEY.EQUIPMENT,name:"userEquipments",model:a.DATA_MODEL.EQUIPMENT,isArray:!0},{key:a.DATA_KEY.UPDATEEQUIPMENT,name:"userEquipments",model:a.DATA_MODEL.EQUIPMENT,isArray:!0,kind:"update",cd:"EquipmentCd"},{key:a.DATA_KEY.ADDEQUIPMENT,name:"userEquipments",model:a.DATA_MODEL.EQUIPMENT,isArray:!0,kind:"add",cd:"EquipmentCd"}],ITEM:[{key:a.DATA_KEY.ITEM,name:"userItems",model:a.DATA_MODEL.ITEM,isArray:!0}],QUEST:[{key:a.DATA_KEY.QUEST,name:"userQuests",model:a.DATA_MODEL.QUEST,isArray:!0},{key:a.DATA_KEY.BATTLE_SESSION,name:"battleSession",model:a.DATA_MODEL.BATTLE_SESSION,isArray:!1}],DECK:[{key:a.DATA_KEY.DECK,name:"userDecks",model:a.DATA_MODEL.DECK,isArray:!0}],USER:[{key:a.DATA_KEY.USER,name:"userBasicData",model:a.DATA_MODEL.USER,isArray:!1},{key:a.DATA_KEY.USER_BOOST,name:"userBoosts",model:a.DATA_MODEL.USER_BOOST,isArray:!0}],ROOM:[{key:a.DATA_KEY.ROOM,name:"userRoom",model:a.DATA_MODEL.ROOM,isArray:!1},{key:a.DATA_KEY.ROOM_LAYOUT,name:"userRoomLayouts",model:a.DATA_MODEL.ROOM_LAYOUT,isArray:!0},{key:a.DATA_KEY.FURNITURE,name:"userFurniture",model:a.DATA_MODEL.FURNITURE,isArray:!0}],PVP:[{key:a.DATA_KEY.PVP,name:"userPvP",model:a.DATA_MODEL.PVP,isArray:!1}],RAID:[{key:a.DATA_KEY.RAID,name:"userRaid",model:a.DATA_MODEL.RAID,isArray:!1}],TOWER:[{key:a.DATA_KEY.TOWER_SESSION,name:"towerSession",model:a.DATA_MODEL.TOWER_SESSION,isArray:!1}],PICTURE_BOOK:[{key:a.DATA_KEY.PICTURE_BOOK_BASE,name:"pictureBookBase",model:a.DATA_MODEL.PICTURE_BOOK_BASE,isArray:!0},{key:a.DATA_KEY.PICTURE_BOOK_DETAIL,name:"pictureBookDetail",model:a.DATA_MODEL.PICTURE_BOOK_DETAIL,isArray:!0}],GACHA:[{key:a.DATA_KEY.GACHA,name:"userGacha",model:a.DATA_MODEL.GACHA,isArray:!0}],EVENT:[{key:a.DATA_KEY.EVENT,name:"userEventItem",model:a.DATA_MODEL.EVENT,isArray:!0}],WAREHOUSE:[{key:a.DATA_KEY.WAREHOUSE_CHARACTER,name:"warehouseCharacters",model:a.DATA_MODEL.WAREHOUSE_CHARACTER,isArray:!0},{key:a.DATA_KEY.UPDATEWAREHOUSE_CHARACTER,name:"warehouseCharacters",model:a.DATA_MODEL.WAREHOUSE_CHARACTER,isArray:!0,kind:"update",cd:"CharacterCd"},{key:a.DATA_KEY.ADDWAREHOUSE_CHARACTER,name:"warehouseCharacters",model:a.DATA_MODEL.WAREHOUSE_CHARACTER,isArray:!0,kind:"add",cd:"CharacterCd"},{key:a.DATA_KEY.WAREHOUSE_EQUIPMENT,name:"warehouseEquipments",model:a.DATA_MODEL.WAREHOUSE_EQUIPMENT,isArray:!0},{key:a.DATA_KEY.UPDATEWAREHOUSE_EQUIPMENT,name:"warehouseEquipments",model:a.DATA_MODEL.WAREHOUSE_EQUIPMENT,isArray:!0,kind:"update",cd:"EquipmentCd"},{key:a.DATA_KEY.ADDWAREHOUSE_EQUIPMENT,name:"warehouseEquipments",model:a.DATA_MODEL.WAREHOUSE_EQUIPMENT,isArray:!0,kind:"add",cd:"EquipmentCd"},{key:a.DATA_KEY.WAREHOUSE_MATERIAL,name:"warehouseMaterials",model:a.DATA_MODEL.WAREHOUSE_MATERIAL,isArray:!0},{key:a.DATA_KEY.UPDATEWAREHOUSE_MATERIAL,name:"warehouseMaterials",model:a.DATA_MODEL.WAREHOUSE_MATERIAL,isArray:!0,kind:"update",cd:"MaterialCd"},{key:a.DATA_KEY.ADDWAREHOUSE_MATERIAL,name:"warehouseMaterials",model:a.DATA_MODEL.WAREHOUSE_MATERIAL,isArray:!0,kind:"add",cd:"MaterialCd"}],MINIGAME:[{key:a.DATA_KEY.MINIGAME,name:"userMinigame",model:a.DATA_MODEL.MINIGAME,isArray:!1}]},cc._RF.pop()},{UserDataConstants:"UserDataConstants"}],UserDeckModel:[function(t,e,i){"use strict";cc._RF.push(e,"cfec2eItR9HdpSfWjuf68bx","UserDeckModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getPosition:function(){if(this._isKeyFieldAvailable("position"))return this._data.position;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: position")},getDeckId:function(){if(this._isKeyFieldAvailable("deckId"))return this._data.deckId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: deckId")},getDeckType:function(){if(this._isKeyFieldAvailable("deckType"))return this._data.deckType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: deckType")},getRoleType:function(){if(this._isKeyFieldAvailable("roleType"))return this._data.roleType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: roleType")},getCharacterCd:function(){if(this._isKeyFieldAvailable("characterCd"))return this._data.characterCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterCd")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserEquipmentModel:[function(t,e,i){"use strict";cc._RF.push(e,"6d6cbs+Tb9OOZ1PRU95CjFD","UserEquipmentModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getIsProtect:function(){if(this._isKeyFieldAvailable("isProtect"))return this._data.isProtect;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isProtect")},getRegisterDate:function(){if(this._isKeyFieldAvailable("registerDate"))return this._data.registerDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: registerDate")},getEquipmentId:function(){if(this._isKeyFieldAvailable("equipmentId"))return this._data.equipmentId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentId")},getEquipmentCd:function(){if(this._isKeyFieldAvailable("equipmentCd"))return this._data.equipmentCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: equipmentCd")},getLevel:function(){if(this._isKeyFieldAvailable("level"))return this._data.level;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: level")},getExp:function(){if(this._isKeyFieldAvailable("exp"))return this._data.exp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exp")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserEventItemModel:[function(t,e,i){"use strict";cc._RF.push(e,"e6a44JHTndAQanH3B+nmKNj","UserEventItemModel");var a=t("MasterDatabase");cc.Class({extends:a,getEventId:function(){if(this._isKeyFieldAvailable("eventId"))return this._data.eventId;Error.ModelPropertyNotFoundError("object field is invalid :: eventId")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;Error.ModelPropertyNotFoundError("object field is invalid :: itemType")},getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;Error.ModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;Error.ModelPropertyNotFoundError("object field is invalid :: count")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase"}],UserExchangeHistoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"eb434cioEtOeL24u/fugz/L","UserExchangeHistoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getTodayQuantity:function(){if(this._isKeyFieldAvailable("todayQuantity"))return this._data.todayQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: todayQuantity")},getExchangeId:function(){if(this._isKeyFieldAvailable("exchangeId"))return this._data.exchangeId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exchangeId")},getTotalQuantity:function(){if(this._isKeyFieldAvailable("totalQuantity"))return this._data.totalQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: totalQuantity")},getWeeklyQuantity:function(){if(this._isKeyFieldAvailable("weeklyQuantity"))return this._data.weeklyQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: weeklyQuantity")},getMonthlyQuantity:function(){if(this._isKeyFieldAvailable("monthlyQuantity"))return this._data.monthlyQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: monthlyQuantity")},getListId:function(){if(this._isKeyFieldAvailable("listId"))return this._data.listId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: listId")},getLastExchangeDate:function(){if(this._isKeyFieldAvailable("lastExchangeDate"))return this._data.lastExchangeDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lastExchangeDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserFurnitureModel:[function(t,e,i){"use strict";cc._RF.push(e,"89155Y4hbhCEKau8ahRVo1c","UserFurnitureModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getFurnitureId:function(){if(this._isKeyFieldAvailable("furnitureId"))return this._data.furnitureId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureId")},getFurnitureCd:function(){if(this._isKeyFieldAvailable("furnitureCd"))return this._data.furnitureCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureCd")},getFurnitureCategory:function(){if(this._isKeyFieldAvailable("furnitureCategory"))return this._data.furnitureCategory;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureCategory")},getIsBuyFurniture:function(){if(this._isKeyFieldAvailable("isBuyFurniture"))return this._data.isBuyFurniture;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isBuyFurniture")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserGachaModel:[function(t,e,i){"use strict";cc._RF.push(e,"b7146r1Wo9KCJSzuIlG/EdU","UserGachaModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getToDate:function(){if(this._isKeyFieldAvailable("toDate"))return this._data.toDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: toDate")},getGachaText:function(){if(this._isKeyFieldAvailable("gachaText"))return this._data.gachaText;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaText")},getWeekType:function(){if(this._isKeyFieldAvailable("weekType"))return this._data.weekType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: weekType")},getGachaName:function(){if(this._isKeyFieldAvailable("gachaName"))return this._data.gachaName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaName")},getButtons:function(){if(this._isKeyFieldAvailable("buttons"))return this._data.buttons;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: buttons")},getBanners:function(){if(this._isKeyFieldAvailable("banners"))return this._data.banners;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: banners")},getFromDate:function(){if(this._isKeyFieldAvailable("fromDate"))return this._data.fromDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fromDate")},getGachaType:function(){if(this._isKeyFieldAvailable("gachaType"))return this._data.gachaType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaType")},getGachaId:function(){if(this._isKeyFieldAvailable("gachaId"))return this._data.gachaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: gachaId")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getConditionType:function(){if(this._isKeyFieldAvailable("conditionType"))return this._data.conditionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionType")},getConditionFrom:function(){if(this._isKeyFieldAvailable("conditionFrom"))return this._data.conditionFrom;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionFrom")},getConditionTo:function(){if(this._isKeyFieldAvailable("conditionTo"))return this._data.conditionTo;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionTo")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserHelpModel:[function(t,e,i){"use strict";cc._RF.push(e,"8bce9d+7u1OLKZ6Fa9bYZJE","UserHelpModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSceneName:function(){if(this._isKeyFieldAvailable("sceneName"))return this._data.sceneName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sceneName")},getOrder:function(){if(this._isKeyFieldAvailable("order"))return this._data.order;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: order")},getFileName:function(){if(this._isKeyFieldAvailable("fileName"))return this._data.fileName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: fileName")},getDescriptionText:function(){if(this._isKeyFieldAvailable("descriptionText"))return this._data.descriptionText;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: descriptionText")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserHowToPlayModel:[function(t,e,i){"use strict";cc._RF.push(e,"e4041YBxDdLy6pqrJf4IQqS","UserHowToPlayModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");cc.Class({extends:a,getSceneName:function(){if(this._isKeyFieldAvailable("sceneName"))return this._data.sceneName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sceneName")},getPage:function(){if(this._isKeyFieldAvailable("page"))return this._data.page;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: page")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserItemModel:[function(t,e,i){"use strict";cc._RF.push(e,"7d269riZ0BC76s3fu5095p4","UserItemModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getItemId:function(){if(this._isKeyFieldAvailable("itemId"))return this._data.itemId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: count")},getItemType:function(){if(this._isKeyFieldAvailable("itemType"))return this._data.itemType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: itemType")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserMainModel:[function(t,e,i){"use strict";cc._RF.push(e,"ad7018/BphPIIw1egPGOx5v","UserMainModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getUserLevel:function(){if(this._isKeyFieldAvailable("userLevel"))return this._data.userLevel;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userLevel")},getTotalExp:function(){if(this._isKeyFieldAvailable("totalExp"))return this._data.totalExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: totalExp")},getNextLevelExp:function(){if(this._isKeyFieldAvailable("nextLevelExp"))return this._data.nextLevelExp;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: nextLevelExp")},getMaxStamina:function(){if(this._isKeyFieldAvailable("maxStamina"))return this._data.maxStamina;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxStamina")},getMaxBattlePoint:function(){if(this._isKeyFieldAvailable("maxBattlePoint"))return this._data.maxBattlePoint;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxBattlePoint")},getMaxFriend:function(){if(this._isKeyFieldAvailable("maxFriend"))return this._data.maxFriend;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxFriend")},getMaxExpeditionDeck:function(){if(this._isKeyFieldAvailable("maxExpeditionDeck"))return this._data.maxExpeditionDeck;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxExpeditionDeck")},getMaxTowerDeck:function(){if(this._isKeyFieldAvailable("maxTowerDeck"))return this._data.maxTowerDeck;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxTowerDeck")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserMinigameModel:[function(t,e,i){"use strict";cc._RF.push(e,"f082a75UEhEoohg7ElPGxco","UserMinigameModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getTotalPlayCount:function(){if(this._isKeyFieldAvailable("totalPlayCount"))return this._data.totalPlayCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: totalPlayCount")},getLastDate:function(){if(this._isKeyFieldAvailable("lastDate"))return this._data.lastDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lastDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserMissionModel:[function(t,e,i){"use strict";cc._RF.push(e,"1bf0cj+rR9PbJZ35U1cPyoo","UserMissionModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getClearCount:function(){if(this._isKeyFieldAvailable("clearCount"))return this._data.clearCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: clearCount")},getMissionCd:function(){if(this._isKeyFieldAvailable("missionCd"))return this._data.missionCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionCd")},getMissionGroupId:function(){if(this._isKeyFieldAvailable("missionGroupId"))return this._data.missionGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionGroupId")},getMissionId:function(){if(this._isKeyFieldAvailable("missionId"))return this._data.missionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionId")},getMissionType:function(){if(this._isKeyFieldAvailable("missionType"))return this._data.missionType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: missionType")},getReceiveCount:function(){if(this._isKeyFieldAvailable("receiveCount"))return this._data.receiveCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: receiveCount")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserModel:[function(t,e,i){"use strict";cc._RF.push(e,"80746RKtUFAw4VsoEbKTUj0","UserModel");var a=t("UserBasicInfoModel"),n=t("Singleton"),o=t("TimeUtils"),r=t("DeckUtils"),s=t("GameConst"),c=t("DeckConst"),l=t("SingletonConst");cc.Class({userData:void 0,_userMainMaster:void 0,systemDate:void 0,ctor:function(){var t=arguments[0];this.userData=new a(t),this._userMainMaster=null;var e=this.userData.getSystemDate();this.systemDate=o.createMoment(e)},getUserMainMaster:function(){return this._userMainMaster||(this._userMainMaster=n.dao.UserMainMasters.find(function(t){return t.getUserLevel()===this.userData.getLevel()}.bind(this))),this._userMainMaster},getUserCd:function(){return this.userData.getUserCd()},getUserName:function(){return this.userData.getUserName()},getUserNameTextId:function(){return this.userData.getUserNameTextId()},getUserNameStatus:function(){return n[l.ENVIRONMENT].getDebugInspection()?s.INSPECTION_STATUS_TYPE.OK:this.userData.getUserNameStatus()},getLevel:function(){return this.userData.getLevel()},getGem:function(){return this.userData.getFreeGem()+this.userData.getPaidGem()},getFreeGem:function(){return this.userData.getFreeGem()},getPaidGem:function(){return this.userData.getPaidGem()},getSeVolume:function(){return this.userData.getSeVolume()/100},getBgmVolume:function(){return this.userData.getBgmVolume()/100},getVoiceVolume:function(){return this.userData.getVoiceVolume()/100},getPartnerId:function(t){var e=this.userData.getPartner().partnerId;if(!e&&t){var i=r.getDeckArrayByDeckTypes([t]);if(i.length>0)return i[0].deck[c.DECK_LEADER_POSITION][c.ROLE_TYPE.MAIN].getCharacterId()}return e},isPartnerCharacter:function(t){return this.getPartnerId()===t},getExp:function(){return this.userData.getExp()},getNextLevelExp:function(){return this.getUserMainMaster().getNextLevelExp()},getNextLevelExpRate:function(){return(this.getExp()-this.getTotalExp())/this.getNextLevelExp()},getTotalExp:function(){return this.getUserMainMaster().getTotalExp()},getMaxStamina:function(){return this.getUserMainMaster().getMaxStamina()},getMaxBattlePoint:function(){return this.getUserMainMaster().getMaxBattlePoint()},getItemMaxCount:function(){return this.userData.getItemMaxCount()},getSystemDate:function(){return this.systemDate},getUserText:function(){return this.userData.getUserText()},getPlayerType:function(){return this.userData.getPlayerType()},getBattleSpeed:function(){return this.userData.getBattleSpeed()},getUserMaxLevel:function(){for(var t=n.dao.UserMainMasters,e=0,i=0;i<t.length;i++){var a=t[i].getUserLevel();a>e&&(e=a)}return e},getIsBgmMute:function(){return this.userData.getIsBgmMute()},getIsSeMute:function(){return this.userData.getIsSeMute()},getIsVoiceMute:function(){return this.userData.getIsVoiceMute()},getIsSkillAuto:function(){return this.userData.getIsSkillAuto()},getRoomCharacterMaxCount:function(){return this.userData.getRoomCharacterMaxCount()},getMaxExpeditionDeck:function(){return this.getUserMainMaster().getMaxExpeditionDeck()},getMaxTowerDeck:function(){return this.getUserMainMaster().getMaxTowerDeck()},getCharacterMaxCount:function(){return this.userData.getCharacterMaxCount()},getEquipmentMaxCount:function(){return this.userData.getEquipmentMaxCount()},getStaminaValue:function(){return this.userData.getStaminaValue()},_createStaminaInfo:function(t,e,i,a,n,r){var s=t;s||(s="20180101000000");var c=o.createMoment(s),l=o.createMoment(o.getNowDateTime());c.valueOf()>=l.valueOf()&&(c=l);var u=l.valueOf()-c.valueOf(),h=(u+=1e3*a)/(1e3*r),d=parseInt(h),p=parseInt(r-r*h%r),m=d+e;return m>=n?(m=n,p=0):p===r&&(p=0),{currentValue:m+=parseInt(i),remainSec:p}},getCurrentStaminaInfo:function(){var t=this._createStaminaInfo(this.userData.getStaminaRecoveryDate(),this.userData.getStaminaValue(),this.userData.getStaminaBonus(),this.userData.getStaminaRemainSec(),this.getUserMainMaster().getMaxStamina(),180);return{currentStamina:t.currentValue,staminaRemainSec:t.remainSec}},getCurrentBattlePointInfo:function(){return this._createStaminaInfo(this.userData.getBattlePointRecoveryDate(),this.userData.getBattlePointValue(),this.userData.getBattlePointBonus(),this.userData.getBattlePointRemainSec(),this.getUserMainMaster().getMaxBattlePoint(),300)},getRegisterDate:function(){return this.userData.getRegisterDate()?this.userData.getRegisterDate():"20191201000000"},getTutorialStep:function(){return this.userData.getTutorialStep()},getTutorialEndDate:function(){return this.userData.getTutorialEndDate()}});cc._RF.pop()},{DeckConst:"DeckConst",DeckUtils:"DeckUtils",GameConst:"GameConst",Singleton:"Singleton",SingletonConst:"SingletonConst",TimeUtils:"TimeUtils",UserBasicInfoModel:"UserBasicInfoModel"}],UserPictureBookBaseModel:[function(t,e,i){"use strict";cc._RF.push(e,"c5e35X3+MpJ1oblwpfezJnT","UserPictureBookBaseModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getCharacterGroupId:function(){if(this._isKeyFieldAvailable("characterGroupId"))return this._data.characterGroupId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterGroupId")},getRoomSelectCharacterId:function(){if(this._isKeyFieldAvailable("roomSelectCharacterId"))return this._data.roomSelectCharacterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: roomSelectCharacterId")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserPictureBookDetailModel:[function(t,e,i){"use strict";cc._RF.push(e,"1ca26GJ6NVBwKZ9tlfs6EVm","UserPictureBookDetailModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getFriendship:function(){if(this._isKeyFieldAvailable("friendship"))return this._data.friendship;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: friendship")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterId")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserProgressModel:[function(t,e,i){"use strict";cc._RF.push(e,"4adebofDbpDOaCgYvtQBeu8","UserProgressModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getProgressType:function(){if(this._isKeyFieldAvailable("progressType"))return this._data.progressType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: progressType")},getProgressGroup:function(){if(this._isKeyFieldAvailable("progressGroup"))return this._data.progressGroup;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: progressGroup")},getIndex:function(){if(this._isKeyFieldAvailable("index"))return this._data.index;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: index")},getConditionId:function(){if(this._isKeyFieldAvailable("conditionId"))return this._data.conditionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionId")},getConditionParam:function(){if(this._isKeyFieldAvailable("conditionParam"))return this._data.conditionParam;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: conditionParam")},getReleaseTargetParam:function(){if(this._isKeyFieldAvailable("releaseTargetParam"))return this._data.releaseTargetParam;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: releaseTargetParam")},getUserNoticeType:function(){if(this._isKeyFieldAvailable("userNoticeType"))return this._data.userNoticeType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userNoticeType")},getUserNoticeText:function(){if(this._isKeyFieldAvailable("userNoticeText"))return this._data.userNoticeText;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userNoticeText")},getDescription:function(){if(this._isKeyFieldAvailable("description"))return this._data.description;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: description")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserProgressUtils:[function(t,e,i){"use strict";cc._RF.push(e,"320cavnGRxOYoSFcN7ESi9+","UserProgressUtils");var a=t("Singleton"),n="eventHelp_";e.exports={isUnreadEventHelp:function(t){if(a.localData[n+t])return!1;var e=_.find(a.dao.EventMainMasters,function(e){return e.getEventId()===t});if(!e)return!1;var i=_.filter(a.dao.userQuests,function(t){return t.getWorldId()===e.getWorldId()});return!(i.length<=0||_.some(i,function(t){return t.getPlayCount()>0}))},setReadEventHelp:function(t){a.localData[n+t]=!0}},cc._RF.pop()},{Singleton:"Singleton"}],UserPurchaseHistoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"a0a99/d11VFTIVU0MXgQlWU","UserPurchaseHistoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getTodayQuantity:function(){if(this._isKeyFieldAvailable("todayQuantity"))return this._data.todayQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: todayQuantity")},getTotalQuantity:function(){if(this._isKeyFieldAvailable("totalQuantity"))return this._data.totalQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: totalQuantity")},getShopId:function(){if(this._isKeyFieldAvailable("shopId"))return this._data.shopId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: shopId")},getMonthlyQuantity:function(){if(this._isKeyFieldAvailable("monthlyQuantity"))return this._data.monthlyQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: monthlyQuantity")},getReplenishmentDaysQuantity:function(){if(this._isKeyFieldAvailable("replenishmentDaysQuantity"))return this._data.replenishmentDaysQuantity;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: replenishmentDaysQuantity")},getListId:function(){if(this._isKeyFieldAvailable("listId"))return this._data.listId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: listId")},getLastPurchaseDate:function(){if(this._isKeyFieldAvailable("lastPurchaseDate"))return this._data.lastPurchaseDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lastPurchaseDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserPvPModel:[function(t,e,i){"use strict";cc._RF.push(e,"ed3e5r+rxxJMYWAslp8qzU6","UserPvPModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getPoint:function(){if(this._isKeyFieldAvailable("point"))return this._data.point;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: point")},getSeason:function(){if(this._isKeyFieldAvailable("season"))return this._data.season;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: season")},getLastUpdateDate:function(){if(this._isKeyFieldAvailable("lastUpdateDate"))return this._data.lastUpdateDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: lastUpdateDate")},getStamina:function(){if(this._isKeyFieldAvailable("stamina"))return this._data.stamina;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stamina")},getLastRecoveryDate:function(){if(this._isKeyFieldAvailable("lastRecoveryDate"))return this._data.lastRecoveryDate},getUpdateCount:function(){if(this._isKeyFieldAvailable("updateCount"))return this._data.updateCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: updateCount")},getWinCount:function(){if(this._isKeyFieldAvailable("winCount"))return this._data.winCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: winCount")},getPvpClass:function(){if(this._isKeyFieldAvailable("pvpClass"))return this._data.pvpClass;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: pvpClass")},getMaxScore:function(){if(this._isKeyFieldAvailable("maxScore"))return this._data.maxScore;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: maxScore")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserQuestModel:[function(t,e,i){"use strict";cc._RF.push(e,"08b08yNT6dJ15I+mFodIUg/","UserQuestModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getIsClearMission2:function(){if(this._isKeyFieldAvailable("isClearMission2"))return this._data.isClearMission2;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isClearMission2")},getIsClearMission3:function(){if(this._isKeyFieldAvailable("isClearMission3"))return this._data.isClearMission3;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isClearMission3")},getIsClearMission1:function(){if(this._isKeyFieldAvailable("isClearMission1"))return this._data.isClearMission1;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isClearMission1")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: stageId")},getPlayCount:function(){if(this._isKeyFieldAvailable("playCount"))return this._data.playCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: playCount")},getClearCount:function(){if(this._isKeyFieldAvailable("clearCount"))return this._data.clearCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: clearCount")},getLastPlayDate:function(){return this._isKeyFieldAvailable("lastPlayDate")?this._data.lastPlayDate:null},getLastSkipDate:function(){return this._isKeyFieldAvailable("lastSkipDate")?this._data.lastSkipDate:null},getTodaySkipCount:function(){if(this._isKeyFieldAvailable("todaySkipCount"))return this._data.todaySkipCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: todaySkipCount")},getTodayPlayCount:function(){if(this._isKeyFieldAvailable("todayPlayCount"))return this._data.todayPlayCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: todayPlayCount")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserRaidModel:[function(t,e,i){"use strict";cc._RF.push(e,"d2606FgXXJH0av/Fpt3mSLo","UserRaidModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getEntryRaidBattleSessions:function(){if(this._isKeyFieldAvailable("entryRaidBattleSessions"))return this._data.entryRaidBattleSessions;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: entryRaidBattleSessions")},getPublicRaidBattleSessions:function(){if(this._isKeyFieldAvailable("publicRaidBattleSessions"))return this._data.publicRaidBattleSessions;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: publicRaidBattleSessions")},getNextRescueEnableDateList:function(){if(this._isKeyFieldAvailable("nextRescueEnableDateList"))return this._data.nextRescueEnableDateList;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: nextRescueEnableDateList")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserRenamePopup:[function(t,e,i){"use strict";cc._RF.push(e,"c192acB4yNMzKaJr8RS4/0g","UserRenamePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("Singleton"),r=t("PopupUtils");cc.Class({extends:a,properties:{userNameEditBox:cc.EditBox,executeBtn:n,cancelBtn:n,middleExecuteBtn:n},_root:null,onLoad:function(){this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),n.SE_NAME.CANCEL),this.middleExecuteBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},_callbackToExecute:null,openUserRenamePopup:function(t,e,i){this._callbackToExecute=t,this.setCloseCallBack(e),this.userNameEditBox.string=o.dao[o.USER].getUserName(),this.userNameEditBox.placeholder=o.dao[o.USER].getUserName(),this.setDisableOutRangeTap(i),i?(this.executeBtn.node.active=!1,this.cancelBtn.node.active=!1,this.middleExecuteBtn.node.active=!0):(this.executeBtn.node.active=!0,this.cancelBtn.node.active=!0,this.middleExecuteBtn.node.active=!1),this.open()},_onTapExecuteBtn:function(){this.userNameEditBox.string.length>0?(this._callbackToExecute&&this._callbackToExecute(this.userNameEditBox.string),this.close()):r.openSimpleMessageWindow("\u30e6\u30fc\u30b6\u30fc\u540d\u306f1\u6587\u5b57\u4ee5\u4e0a12\u6587\u5b57\u4ee5\u5185\u3067\u3059\u3002")},_onTapCancelBtn:function(){this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",PopupUtils:"PopupUtils",Singleton:"Singleton"}],UserRoomLayoutModel:[function(t,e,i){"use strict";cc._RF.push(e,"69f03KbgMZPSqI5T61+GrtX","UserRoomLayoutModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getLayoutId:function(){if(this._isKeyFieldAvailable("layoutId"))return this._data.layoutId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: layoutId")},getLayoutName:function(){if(this._isKeyFieldAvailable("layoutName"))return this._data.layoutName;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: layoutName")},getFurnitureList:function(){if(this._isKeyFieldAvailable("furnitureList"))return this._data.furnitureList;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureList")},getCharacterList:function(){if(this._isKeyFieldAvailable("characterList"))return this._data.characterList;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterList")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserRoomModel:[function(t,e,i){"use strict";cc._RF.push(e,"676fbqq87pFF45cgzu7nY7j","UserRoomModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getFurnitureList:function(){if(this._isKeyFieldAvailable("furnitureList"))return this._data.furnitureList;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: furnitureList")},getCharacterList:function(){if(this._isKeyFieldAvailable("characterList"))return this._data.characterList;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: characterList")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserService:[function(t,e,i){"use strict";cc._RF.push(e,"94dfavatzRPbb4YTx+QBmLW","UserService");var a=t("BaseService"),n=t("ApiConstants"),o=t("Singleton"),r=t("GameConst"),s=t("PopupUtils"),c=t("LocalDataConst"),l=t("DmmAndroidJsToJava");cc.Class({extends:a,updateUserNameInspection:function(t){cc.log("updateUserNameInspection");var e=o.dao.userBasicData;this._requestText(r.INSPECTION_TYPE.GET,e.getUserName(),e.getUserNameTextId(),e.getUserNameStatus(),function(i){if(cc.log(i),!i||i.status===r.INSPECTION_STATUS_TYPE.ERROR)return this.updateUserName(e.getUserName(),t);var a={userName:e.getUserName(),userNameTextId:i.textId,userNameStatus:i.status};this._requestCallApi(n.USER_UPDATE_USERNAME,a,function(e,i){return t(e?void 0:i)})}.bind(this))},updateUserName:function(t,e){cc.log("updateUserName"),this._requestText(r.INSPECTION_TYPE.UPDATE,t,void 0,void 0,function(i){cc.log(i);var a={userName:t,userNameTextId:i.textId,userNameStatus:i.status};this._requestCallApi(n.USER_UPDATE_USERNAME,a,function(t,i){return e(t?void 0:i)})}.bind(this))},checkUserNameStatus:function(t){var e=o.dao.userBasicData;if(e.getUserNameStatus()!==r.INSPECTION_STATUS_TYPE.DELETE&&e.getUserNameStatus()!==r.INSPECTION_STATUS_TYPE.NG)return t();s.openSystemPopup("\u78ba\u8a8d","\u5165\u529b\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u540d\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\n\u518d\u5ea6\u3001\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002","",!1,function(){s.openUserRenamePopup(t,void 0,!0)},void 0)},updateSetting:function(t,e,i,a,o,r,s,c,l){var u={bgmVolume:t=parseInt(100*t),seVolume:e=parseInt(100*e),voiceVolume:i=parseInt(100*i),isSeMute:a,isBgmMute:o,isVoiceMute:r,battleSpeed:s,isSkillAuto:c};this._requestCallApi(n.USER_UPDATE_SETTING,u,function(t,e){return l(t?void 0:e)})},recoveryStamina:function(t,e){var i={count:t};this._requestCallApi(n.USER_RECOVERY_STAMINA,i,function(t,i){return e(t?void 0:i)})},recoveryBattlePoint:function(t){this._requestCallApi(n.USER_RECOVERY_BATTLE_POINT,{},function(e,i){return e?t(void 0):(cc.log(i),t(i))})},updateUserText:function(t,e){var i={userText:t};this._requestCallApi(n.USER_UPDATE_USER_TEXT,i,function(t,i){return e(t?void 0:i)})},updatePlayerType:function(t,e){var i={playerType:t};this._requestCallApi(n.USER_UPDATE_PLAYER_TYPE,i,function(t,i){return e(t?void 0:i)})},getClientVersion:function(t){var e={};l.getDmmAndroidLoginInfo(function(i){o.localData[c.USER_VERSION].apkVersion=i.appVersionName,this._requestCallApi(n.USER_GET_CLIENT_VERSION,e,function(e,i){return e?(cc.error(e),t(void 0)):t(i)})}.bind(this))}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService",DmmAndroidJsToJava:"DmmAndroidJsToJava",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",Singleton:"Singleton"}],UserShopHistoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"94128Q3hJtKa5VuX68c/3xS","UserShopHistoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getUserCd:function(){if(this._isKeyFieldAvailable("userCd"))return this._data.userCd;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: userCd")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserStoryModel:[function(t,e,i){"use strict";cc._RF.push(e,"9ce423GLyxO/ZqswWy/PFwK","UserStoryModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getStoryId:function(){if(this._isKeyFieldAvailable("storyId"))return this._data.storyId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: storyId")},getIsRead:function(){if(this._isKeyFieldAvailable("isRead"))return this._data.isRead;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: isRead")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserTowerSessionModel:[function(t,e,i){"use strict";cc._RF.push(e,"ea22603sn1Jq7xDxkFAv7zn","UserTowerSessionModel");var a=t("MasterDatabase"),n=t("Singleton"),o=t("SingletonConst");n[o.ERROR_MANAGER],cc.Class({extends:a,getSessionId:function(){if(this._isKeyFieldAvailable("sessionId"))return this._data.sessionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: sessionId")},getTowerSelectCount:function(){if(this._isKeyFieldAvailable("towerSelectCount"))return this._data.towerSelectCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: towerSelectCount")},getTowerSelectMaxCount:function(){if(this._isKeyFieldAvailable("towerSelectMaxCount"))return this._data.towerSelectMaxCount;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: towerSelectMaxCount")},getTowerSelectDate:function(){if(this._isKeyFieldAvailable("towerSelectDate"))return this._data.towerSelectDate;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: towerSelectDate")},getAreaId:function(){if(this._isKeyFieldAvailable("areaId"))return this._data.areaId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: areaId")},getBattleSessionId:function(){if(this._isKeyFieldAvailable("battleSessionId"))return this._data.battleSessionId;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: battleSessionId")},getStageId:function(){if(this._isKeyFieldAvailable("stageId"))return this._data.stageId},getDeckId:function(){if(this._isKeyFieldAvailable("deckId"))return this._data.deckId},getDeckType:function(){if(this._isKeyFieldAvailable("deckType"))return this._data.deckType;n[o.ERROR_MANAGER].throwModelPropertyNotFoundError("object field is invalid :: deckType")},getContinueData:function(){if(this._isKeyFieldAvailable("continueData"))return this._data.continueData}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserUtils:[function(t,e,i){"use strict";cc._RF.push(e,"798abEIqilNC6Vlciu98+/i","UserUtils");var a=t("Singleton"),n=t("TimeUtils"),o=t("CommonUtils"),r=t("QuestUtils"),s=t("PopupUtils"),c=t("GameConst"),l=t("SingletonConst"),u=t("LocalDataConst"),h=t("SceneConst"),d=cc.Enum({BOOT:h.SCENE.FILE_NAME.BOOT,TEST:h.SCENE.FILE_NAME.TEST,TITLE:h.SCENE.FILE_NAME.TITLE,DEBUG:h.SCENE.FILE_NAME.DEBUG,MAINTENANCE:h.SCENE.FILE_NAME.MAINTENANCE,LOGIN_BONUS:h.SCENE.FILE_NAME.LOGIN_BONUS,DUMMY_LOGIN:h.SCENE.FILE_NAME.DUMMY_LOGIN,PVP_START_ANIM:h.SCENE.FILE_NAME.PVP_START_ANIM,BATTLE_LOADING:h.SCENE.FILE_NAME.BATTLE_LOADING,SET_TEST_BATTLE:h.SCENE.FILE_NAME.SET_TEST_BATTLE});function p(){var t={},e=a.dao.UserProgressMasters;for(var i in e){var n=e[i].getProgressType(),o=e[i].getProgressGroup();t[n]||(t[n]={}),t[n][o]||(t[n][o]=[]),t[n][o].push(e[i])}return t}function m(t){var e={isReleased:!0,description:""};t=o.sortModels(t,[{getterName:"getIndex",order:"asc"}]);var i=r.createUserStageFlatMap();for(var a in t)i[t[a].getConditionId()]?parseInt(t[a].getConditionParam())>i[t[a].getConditionId()].getClearCount()&&(e.isReleased=!1,e.description=t[a].getDescription()):(e.isReleased=!1,e.description=t[a].getDescription());return e}function g(){return _.filter(a.dao.UserProgressMasters,function(t){switch(t.getUserNoticeType()){case c.USER_NOTICE_TYPE.MESSAGE:case c.USER_NOTICE_TYPE.POPUP:case c.USER_NOTICE_TYPE.POPUP_TRANSITION:return!0;default:return!1}})}function C(t,e){var i=e[t.getConditionId()];return!!i&&(!(i.getClearCount()<parseInt(t.getConditionParam()))&&!a.localData[u.USER_PROGRESS_NOTIFIED+t.getReleaseTargetParam()])}function f(t){var e;for(var i in e=t||cc.director.getScene().name,d)if(e===d[i])return!1;return!0}function E(t){switch(t.getProgressType()){case c.USER_PROGRESS.TYPE.SCENE:return{sendSceneName:t.getReleaseTargetParam()};case c.USER_PROGRESS.TYPE.USER_GUID:var e=t.getReleaseTargetParam().split("__");return{sendSceneName:e[0],sendViewParam:e[1]?JSON.parse(e[1]):void 0};default:return{sendSceneName:"HomeScene"}}}e.exports={getMaxStaminaByLevel:function(t){var e=a.dao.UserMainMasters.find(function(e){return e.getUserLevel()===t});return e?e.getMaxStamina():0},getMaxBpByLevel:function(t){var e=a.dao.UserMainMasters.find(function(e){return e.getUserLevel()===t});return e?e.getMaxBattlePoint():0},getNavigatorCharacterId:function(){var t=r.createUserStageFlatMap(),e=p()[c.USER_PROGRESS.TYPE.NAVIGATOR][c.USER_PROGRESS.NAVIGATOR_GROUP.STAGE];if(a[l.ENVIRONMENT].getDebugContentsRelease())return parseInt(_.maxBy(e,function(t){return t.getIndex()}).getReleaseTargetParam());var i=e.filter(function(e){return!!t[e.getConditionId()]&&parseInt(e.getConditionParam())<=t[e.getConditionId()].getClearCount()});if(i.length>0)return parseInt(_.maxBy(i,function(t){return t.getIndex()}).getReleaseTargetParam());var n=a.dao.UserProgressMasters.find(function(t){return t.getProgressType()===c.USER_PROGRESS.TYPE.NAVIGATOR&&t.getProgressGroup()===c.USER_PROGRESS.NAVIGATOR_GROUP.NON});return n?parseInt(n.getReleaseTargetParam()):-1},getUserSceneProgressInfo:function(t){var e=p()[c.USER_PROGRESS.TYPE.SCENE][c.USER_PROGRESS.SCENE_GROUP.STAGE].filter(function(e){return t===e.getReleaseTargetParam()});return e.length>0?m(e):null},checkOpenCondition:function(t,e,i){if(t===c.OPEN_CONDITION_TYPE.NON)return!0;var o=a.dao.userBasicData;if(t===c.OPEN_CONDITION_TYPE.RANK){var r=o.getLevel();return r>=e&&r<=i}if(t===c.OPEN_CONDITION_TYPE.REGISTER_DATE){var s=n.addMinute(o.getTutorialEndDate(),e),l=n.addMinute(o.getTutorialEndDate(),i);return n.isRangeOfDate(s,l)}return!1},initializeUserProgressNotice:function(){var t=g(),e=r.createUserStageFlatMap();t=_.filter(t,function(t){return C(t,e)}),_.forEach(t,function(t){a.localData[u.USER_PROGRESS_NOTIFIED+t.getReleaseTargetParam()]=!0})},getUserProgressNotice:function(){var t=g(),e=r.createUserStageFlatMap();return _.find(t,function(t){return C(t,e)})},drawUserProgressNotice:function(t,e){if(f(t.getCurrentSceneName())&&e)switch(a.localData[u.USER_PROGRESS_NOTIFIED+e.getReleaseTargetParam()]=!0,e.getUserNoticeType()){case c.USER_NOTICE_TYPE.MESSAGE:return s.openSimpleMessageWindow(e.getUserNoticeText());case c.USER_NOTICE_TYPE.POPUP:return s.openCommonPopupOk("\u6a5f\u80fd\u89e3\u653e",e.getUserNoticeText(),"",!1,function(){},"OK",!0);case c.USER_NOTICE_TYPE.POPUP_TRANSITION:var i=E(e);return s.openCommonPopupOk("\u6a5f\u80fd\u89e3\u653e",e.getUserNoticeText(),"",!1,function(){t.pushScene(i.sendSceneName,t.getCurrentSceneName(),i.sendViewParam,t.getCurrentSceneParam())},"\u78ba\u8a8d\u3059\u308b",!0)}}},cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",SceneConst:"SceneConst",Singleton:"Singleton",SingletonConst:"SingletonConst",TimeUtils:"TimeUtils"}],UserWarehouseCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"cf5069ALZdBjrZMYksV9fdq","UserWarehouseCharacterModel");var a=t("MasterDatabase"),n=t("Singleton")[t("SingletonConst").ERROR_MANAGER];cc.Class({extends:a,getCharacterCd:function(){if(this._isKeyFieldAvailable("characterCd"))return this._data.characterCd;n.throwModelPropertyNotFoundError("object field is invalid :: characterCd")},getCharacterId:function(){if(this._isKeyFieldAvailable("characterId"))return this._data.characterId;n.throwModelPropertyNotFoundError("object field is invalid :: characterId")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n.throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n.throwModelPropertyNotFoundError("object field is invalid :: count")},getUpdateDate:function(){if(this._isKeyFieldAvailable("updateDate"))return this._data.updateDate;n.throwModelPropertyNotFoundError("object field is invalid :: updateDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserWarehouseEquipmentModel:[function(t,e,i){"use strict";cc._RF.push(e,"929b6sAFJpGQZiGImGnLbg9","UserWarehouseEquipmentModel");var a=t("MasterDatabase"),n=t("Singleton")[t("SingletonConst").ERROR_MANAGER];cc.Class({extends:a,getEquipmentCd:function(){if(this._isKeyFieldAvailable("equipmentCd"))return this._data.equipmentCd;n.throwModelPropertyNotFoundError("object field is invalid :: equipmentCd")},getEquipmentId:function(){if(this._isKeyFieldAvailable("equipmentId"))return this._data.equipmentId;n.throwModelPropertyNotFoundError("object field is invalid :: equipmentId")},getExceedLimit:function(){if(this._isKeyFieldAvailable("exceedLimit"))return this._data.exceedLimit;n.throwModelPropertyNotFoundError("object field is invalid :: exceedLimit")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n.throwModelPropertyNotFoundError("object field is invalid :: count")},getUpdateDate:function(){if(this._isKeyFieldAvailable("updateDate"))return this._data.updateDate;n.throwModelPropertyNotFoundError("object field is invalid :: updateDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],UserWarehouseMaterialModel:[function(t,e,i){"use strict";cc._RF.push(e,"05ff1QfMlRL2axOBmC+0Yez","UserWarehouseMaterialModel");var a=t("MasterDatabase"),n=t("Singleton")[t("SingletonConst").ERROR_MANAGER];cc.Class({extends:a,getMaterialCd:function(){if(this._isKeyFieldAvailable("materialCd"))return this._data.materialCd;n.throwModelPropertyNotFoundError("object field is invalid :: materialCd")},getMaterialId:function(){if(this._isKeyFieldAvailable("materialId"))return this._data.materialId;n.throwModelPropertyNotFoundError("object field is invalid :: materialId")},getCount:function(){if(this._isKeyFieldAvailable("count"))return this._data.count;n.throwModelPropertyNotFoundError("object field is invalid :: count")},getCategory:function(){if(this._isKeyFieldAvailable("category"))return this._data.category;n.throwModelPropertyNotFoundError("object field is invalid :: category")},getUpdateDate:function(){if(this._isKeyFieldAvailable("updateDate"))return this._data.updateDate;n.throwModelPropertyNotFoundError("object field is invalid :: updateDate")}});cc._RF.pop()},{MasterDatabase:"MasterDatabase",Singleton:"Singleton",SingletonConst:"SingletonConst"}],VariableTabViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"3f885yragBN44oJmilg9tWD","VariableTabViewBase");var a=t("TabViewBase");cc.Class({extends:a,properties:{tabButtonCenterPrefab:cc.Prefab,tabButtonLeftPrefab:cc.Prefab,tabButtonRightPrefab:cc.Prefab,tabsNode:cc.Node},_root:null,initVariableTabViewBase:function(t,e){this._root=t,this.windowNode.zIndex=0,this._setTabButtonArray(e),this.initTabViewBase()},getTabButtonPrefab:function(t,e){return 0===t?this.tabButtonLeftPrefab:t>=e-1?this.tabButtonRightPrefab:this.tabButtonCenterPrefab},_initTabBtnArray:function(){if(this.tabBtnArray){for(var t=0;t<this.tabBtnArray.length;t+=1)this.tabBtnArray[t].node.destroy();this.tabBtnArray=[]}},_setTabButtonArray:function(t){this._initTabBtnArray();for(var e=0;e<t.length;e+=1)this.tabBtnArray.push(t[e]),this.tabsNode.addChild(t[e].node);this.tabsNode.opacity=0,this.tabsNode.runAction(cc.fadeIn(.1))}});cc._RF.pop()},{TabViewBase:"TabViewBase"}],ViewUtils:[function(t,e,i){"use strict";cc._RF.push(e,"0e2dcl+JwxFGpoibj119Zgt","ViewUtils");var a=t("GameConst"),n=t("ResourceUtils"),o=t("StaticResourceConst");function r(t,e,i,a){var r=new cc.Node(t).addComponent(cc.Sprite);return r.spriteFrame=n.getResource(o.SIMPLE_TEX_PATH),r.node.color=cc.color(0,0,0),r.node.position=e,r.node.width=i.x,r.node.height=i.y,r.node.anchorX=a.x,r.node.anchorY=a.y,r.node}function s(t){var e=new cc.Node(t);return e.setContentSize(1280,720),e.zIndex=255,e.active=!0,e.on("touchstart",function(t){t.stopPropagation()}),e.on("touchend",function(t){t.stopPropagation()}),e}function c(t,e,i,a,n){return t?e.slice(0,i)+a+n+e.slice(i,e.length):e}function l(t){return void 0===t||null===t}function u(t,e){return!isNaN(t)||!isNaN(e)||"."===t||"."===e}function h(t,e,i){return t.length>0&&e.indexOf(t,i)!==i}function d(t,e){return t!==e}function p(t,e,i){return isNaN(e)&&"."!==e||!isNaN(i)||"."===i?!isNaN(e)||"."===e||isNaN(i)&&"."!==i||(t-=1):t+=1,t}function m(t){t.type=1,t.resizeMode=0,t.startAxis=0,t.affectedByScale=!0}e.exports={addEdgeBand:function(t){var e=cc.winSize;t.addChild(r("BandNodeTop",cc.v2(0,.5*e.height),cc.v2(e.width,2*e.height),cc.v2(.5,0)),a.Z_ORDER.BAND),t.addChild(r("BandNodeBottom",cc.v2(0,-.5*e.height),cc.v2(e.width,2*e.height),cc.v2(.5,1)),a.Z_ORDER.BAND),t.addChild(r("BandNodeLeft",cc.v2(-.5*e.width,0),cc.v2(2*e.width,1.4*e.height),cc.v2(1,.5)),a.Z_ORDER.BAND),t.addChild(r("BandNodeRight",cc.v2(.5*e.width,0),cc.v2(2*e.width,1.4*e.height),cc.v2(0,.5)),a.Z_ORDER.BAND)},addModalLayer:function(){var t=cc.director.getScene().getChildByName("Canvas");if(t.getChildByName("ModalLayer"))t.getChildByName("ModalLayer").active=!0;else{var e=s("ModalLayer"),i=cc.instantiate(n.getResource(o.LOADING_SIMPLE_PREFAB_PATH));e.addChild(i),t.addChild(e)}},addPaymentWaitLayer:function(){var t=cc.director.getScene().getChildByName("Canvas");if(!t.getChildByName("PaymentWaitLayer")){var e=s("PaymentWaitLayer"),i=cc.instantiate(n.getResource(o.LOADING_PAYMENT_WAIT_PREFAB_PATH));e.addChild(i),t.addChild(e)}},removeModalLayer:function(){cc.director.getScene().getChildByName("Canvas").getChildByName("ModalLayer")&&(cc.director.getScene().getChildByName("Canvas").getChildByName("ModalLayer").active=!1)},removePaymentWaitLayer:function(){cc.director.getScene().getChildByName("Canvas").getChildByName("PaymentWaitLayer")&&cc.director.getScene().getChildByName("Canvas").getChildByName("PaymentWaitLayer").destroy()},addNoticeBadge:function(t,e,i){var a=t.getChildByName("cmn_badge");a?a.active=!0:(a=t.getChildByName("lbl_badge"))?a.active=!0:(a=t.getChildByName("NoticeBadge"))?a.active=!0:((a=cc.instantiate(n.getResource(o.COMMON_BADGE_PREFAB_PATH))).name="NoticeBadge",a.position=e,a.scale=i,t.addChild(a))},hideNoticeBadge:function(t){var e=t.getChildByName("cmn_badge");e?e.active=!1:(e=t.getChildByName("lbl_badge"))?e.active=!1:(e=t.getChildByName("NoticeBadge"))&&(e.active=!1)},createSerifWindow:function(){return cc.instantiate(n.getResource(o.BALLOON_PREFAB_PATH)).getComponent("SerifBalloon")},createCharacterStandView:function(){return cc.instantiate(n.getResource(o.CHARACTER_STAND_VIEW_PREFAB_PATH)).getComponent("CharacterStandView")},getParamChangeColor:function(t,e){return t<e?a.COLOR_STATE.PLUS:t>e?a.COLOR_STATE.MINUS:a.COLOR_STATE.NORMAL},insertDiffTag:function(t,e,i,a,n,o){for(var r="",s=0,m=!1,_=e,g=0;g<e.length;g+=1){if(l(t[s])){_=c(!m,_,g+_.length-e.length,a,n),m=!0,r="";break}u(t[s],e[g])?(r+=e[g],s=p(s,t[s],e[g])):h(r,t,g-r.length)?(_=c(!m,_=c(!m,_,g-r.length+_.length-e.length,a,n),g+_.length-e.length,o,i),r="",d(t[s],e[g])&&(_=c(!m,_,g+_.length-e.length,a,n),m=!0)):d(t[s],e[g])?(_=c(!m,_,g+_.length-e.length,a,n),m=!0,r=""):(_=c(m,_,g+_.length-e.length,o,i),m=!1,r=""),s+=1}return i+_+o+a},setEquallySpacedHorizontalLayout:function(t,e,i){if(t&&!(t.node.childrenCount<=0)){m(t),!e|e<=0&&(e=t.node.width),!i|i<=0&&(i=.1);var a=t.node.children.reduce(function(t,e){return t+e.width},0),n=t.node.childrenCount,o=i;if(e>0)if(a>=e-i*n){var r=(e-i*n)/a;t.node.children.forEach(function(t){t.scaleX=r})}else o=(e-a)/(n+1);t.paddingLeft=o,t.paddingRight=o,t.spacingX=o,t.updateLayout()}}},cc._RF.pop()},{GameConst:"GameConst",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],WarehouseApis:[function(t,e,i){"use strict";cc._RF.push(e,"72117HGKQxLiqwwrkDdApQ9","WarehouseApis");var a=t("RESTClient"),n=t("ApiConstants");a.RESTClient.graft({name:n.WAREHOUSE_CHARACTER_COUNT,path:"warehouse/getCharacterCount",method:"POST"}),a.RESTClient.graft({name:n.WAREHOUSE_CHARACTER_LIST,path:"warehouse/getCharacterList",method:"POST"}),a.RESTClient.graft({name:n.WAREHOUSE_EQUIPMENT_COUNT,path:"warehouse/getEquipmentCount",method:"POST"}),a.RESTClient.graft({name:n.WAREHOUSE_EQUIPMENT_LIST,path:"warehouse/getEquipmentList",method:"POST"}),a.RESTClient.graft({name:n.WAREHOUSE_MATERIAL_COUNT,path:"warehouse/getMaterialCount",method:"POST"}),a.RESTClient.graft({name:n.WAREHOUSE_MATERIAL_LIST,path:"warehouse/getMaterialList",method:"POST"}),a.RESTClient.graft({name:n.WAREHOUSE_TAKE,path:"warehouse/takeWarehouse",method:"POST"}),cc._RF.pop()},{ApiConstants:"ApiConstants",RESTClient:"RESTClient"}],WarehouseCharacterModel:[function(t,e,i){"use strict";cc._RF.push(e,"ac7418xS6dNR5sTs5A/cuny","WarehouseCharacterModel");var a=t("UserWarehouseCharacterModel"),n=t("Singleton"),o=t("ItemConst"),r=t("WarehouseConst");cc.Class({ctor:function(){var t=arguments[0];this.userData=new a(t)},getMainMaster:function(){return this._mainMaster||(this._mainMaster=n.dao.CharacterMainMasters.find(function(t){return t.getCharacterId()===this.userData.getCharacterId()}.bind(this))),this._mainMaster},getLevelMaster:function(){if(!this._levelMaster){var t=this.getMainMaster().getExpType();this._levelMaster=n.dao.CharacterLevelMasters.find(function(e){return e.getExpType()===t&&1===e.getLevel()})}return this._levelMaster},getCharacterCd:function(){return this.userData.getCharacterCd()},getCharacterId:function(){return this.userData.getCharacterId()},getCharacterGroupId:function(){return this.getMainMaster().getCharacterGroupId()},getExceedLimit:function(){return this.userData.getExceedLimit()},getCount:function(){return this.userData.getCount()},getUpdateDate:function(){return this.userData.getUpdateDate()},getCharacterType:function(){return this.getMainMaster().getCharacterType()},getAttribute:function(){return this.getMainMaster().getAttribute()},getName:function(){return this.getMainMaster().getName()},getShortName:function(){return this.getMainMaster().getShortName()},getText:function(){return this.getMainMaster().getText()},getShortText:function(){return this.getMainMaster().getShortText()},getRarity:function(){return this.getMainMaster().getRarity()},getItemType:function(){return o.ITEM_TYPE.CHARACTER},getSalePrice:function(){return this.getLevelMaster().getSalePrice()},getCategory:function(){return r.MATERIAL_CATEGORY.CHARACTER},getWarehouseType:function(){return r.WAREHOUSE_STORAGE_TYPE.CHARACTER}});cc._RF.pop()},{ItemConst:"ItemConst",Singleton:"Singleton",UserWarehouseCharacterModel:"UserWarehouseCharacterModel",WarehouseConst:"WarehouseConst"}],WarehouseCharacterStorageListView:[function(t,e,i){"use strict";cc._RF.push(e,"4e969nDgMNLJochTMPCLsAM","WarehouseCharacterStorageListView");var a=t("CommonUtils"),n=t("ResourceUtils"),o=t("WarehouseUtils"),r=t("WarehouseListViewBase"),s=t("GameConst"),c=t("LocalDataConst"),l=t("ResourceConst"),u=t("WarehouseConst");cc.Class({extends:r,properties:{},initListView:function(t){this.matrixPageView.setCallBackToConvertSortText(o.convertSortTypeToTextForMaterial),this.matrixPageView.setCallBackToCreateSortConditions(o.createSortConditionsForCharacter),this.matrixPageView.setCallBackToCreateFilterConditions(o.createFilterConditionsForCharacter),this.matrixPageView.setSortParam(this._getCurrentSortType(),this._getCurrentSortOrder()),this.matrixPageView.setFilterCheckList(t.getCurrentStorageCharacterFilterCheckList()),this.matrixPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilter.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this._super(t)},_callbackToCreateThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("CharacterMatrixThumbnail")).resetCharacterMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail"),i.initCharacterMatrixThumbnail(t.getMainMaster(),t.getExceedLimit(),void 0,void 0),i.setBottomParams("x",t.getCount()),i.node},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(n.getResource(l.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_CHARACTER_WAREHOUSE)).getComponent("SortFilterPopup")},_getCurrentSortType:function(){return a.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_CHARACTER,u.WAREHOUSE_STORAGE_CHARACTER_SORT_TYPE.UPDATING,c.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrder:function(){return a.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_CHARACTER,s.SORT_ORDER.ASC,c.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_callbackToSortAndFilter:function(t,e,i){a.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_CHARACTER,t),a.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_CHARACTER,e),this._root.setCurrentStorageCharacterFilterCheckList(i)}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",WarehouseConst:"WarehouseConst",WarehouseListViewBase:"WarehouseListViewBase",WarehouseUtils:"WarehouseUtils"}],WarehouseConst:[function(t,e,i){"use strict";cc._RF.push(e,"85ec0vNCQNKE6m42Nwrr8k1","WarehouseConst");cc.Class({statics:{TAB_CATEGORY:cc.Enum({CONSUMEITEM:0,MATERIAL:1,EQUIPMENT:2,RECIPE:3}),CONTENT_SIZE_X:1e3,WAREHOUSE_STORAGE_TYPE:cc.Enum({CHARACTER:1,EQUIPMENT:2,MATERIAL:3}),MATERIAL_CATEGORY:cc.Enum({CHARACTER:1,EQUIPMENT:2}),MAX_TAKE_COUNT:20,WAREHOUSE_STORAGE_CHARACTER_PROPERTY_NAME:"WarehouseStorageCharacterFilter",WAREHOUSE_STORAGE_CHARACTER_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9}),WAREHOUSE_STORAGE_CHARACTER_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4"},WAREHOUSE_STORAGE_CHARACTER_FILTER_GROUP_END:{ATTRIBUTE:5,RARITY:9},WAREHOUSE_STORAGE_EQUIPMENT_PROPERTY_NAME:"WarehouseStorageCharacterFilter",WAREHOUSE_STORAGE_EQUIPMENT_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9}),WAREHOUSE_STORAGE_EQUIPMENT_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4"},WAREHOUSE_STORAGE_EQUIPMENT_FILTER_GROUP_END:{ATTRIBUTE:5,RARITY:9},WAREHOUSE_STORAGE_MATERIAL_PROPERTY_NAME:"WarehouseStorageMaterialFilter",WAREHOUSE_FILTER_TYPE:cc.Enum({ATTRIBUTE_FIRE:0,ATTRIBUTE_WATER:1,ATTRIBUTE_WIND:2,ATTRIBUTE_THUNDER:3,ATTRIBUTE_LIGHT:4,ATTRIBUTE_DARK:5,RARITY_1:6,RARITY_2:7,RARITY_3:8,RARITY_4:9,CATEGORY_CHARACTER:10,CATEGORY_EQUIPMENT:11}),WAREHOUSE_STORAGE_MATERIAL_FILTER_FUNC_NAME:{ATTRIBUTE_FIRE:"getFilterFlgByAttributeFire",ATTRIBUTE_WATER:"getFilterFlgByAttributeWater",ATTRIBUTE_WIND:"getFilterFlgByAttributeWind",ATTRIBUTE_THUNDER:"getFilterFlgByAttributeThunder",ATTRIBUTE_LIGHT:"getFilterFlgByAttributeLight",ATTRIBUTE_DARK:"getFilterFlgByAttributeDark",RARITY_1:"getFilterFlgByRarity1",RARITY_2:"getFilterFlgByRarity2",RARITY_3:"getFilterFlgByRarity3",RARITY_4:"getFilterFlgByRarity4",CATEGORY_CHARACTER:"getFilterFlgByCategoryCharacter",CATEGORY_EQUIPMENT:"getFilterFlgByCategoryEquipment"},WAREHOUSE_STORAGE_MATERIAL_FILTER_GROUP_END:{ATTRIBUTE:5,RARITY:9,CATEGORY:11},WAREHOUSE_STORAGE_CHARACTER_SORT_TYPE:cc.Enum({UPDATING:0,NUMBER:1,ATTRIBUTE:2,RARITY:3}),WAREHOUSE_STORAGE_CHARACTER_SORT_PROPERTY_NAME:{UPDATING:"getUpdateDate",NUMBER:"getCharacterId",ATTRIBUTE:"getAttribute",RARITY:"getRarity"},WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE:cc.Enum({UPDATING:0,NUMBER:1,ATTRIBUTE:2,RARITY:3}),WAREHOUSE_STORAGE_EQUIPMENT_SORT_PROPERTY_NAME:{UPDATING:"getUpdateDate",NUMBER:"getEquipmentId",ATTRIBUTE:"getAttribute",RARITY:"getRarity"},WAREHOUSE_STORAGE_SORT_TYPE:cc.Enum({UPDATING:0,NUMBER:1,ATTRIBUTE:2,RARITY:3}),WAREHOUSE_STORAGE_SORT_PROPERTY_NAME:{UPDATING:"getUpdateDate",NUMBER:"getMaterialId",ATTRIBUTE:"getAttribute",RARITY:"getRarity"}}});cc._RF.pop()},{}],WarehouseConsumeItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"e5c93LXVUJKIbbmRVamDUFi","WarehouseConsumeItemListView");t("ItemConst");var a=t("WarehouseItemListViewBase");cc.Class({extends:a,properties:{}});cc._RF.pop()},{ItemConst:"ItemConst",WarehouseItemListViewBase:"WarehouseItemListViewBase"}],WarehouseConvertUtils:[function(t,e,i){"use strict";cc._RF.push(e,"78fda0Db75FwJu4LetG1lnP","WarehouseConvertUtils");var a=t("CharacterModel"),n=t("EquipmentModel"),o=t("Singleton"),r=t("ItemConst"),s=(t("CharacterConst"),t("WarehouseConst"));function c(t,e,i){return{characterCd:i,characterId:t.getCharacterId(),exp:0,level:1,exceedLimit:t.getExceedLimit(),skillLevel:1,abilityLevel1:1,abilityLevel2:1,abilityLevel3:1}}function l(t,e,i,a){switch(t){case s.WAREHOUSE_STORAGE_TYPE.CHARACTER:return _.find(o.dao.warehouseCharacters,function(t){return t.getCharacterId()===i});case s.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:return _.find(o.dao.warehouseEquipments,function(t){return t.getEquipmentId()===i&&t.getExceedLimit()===a});default:return _.find(o.dao.warehouseMaterials,function(t){return t.getItemType()===e&&t.getMaterialId()===i})}}function u(t,e,i){return{equipmentCd:i,equipmentId:t.getEquipmentId(),exp:0,level:1,exceedLimit:t.getExceedLimit()}}e.exports={convertWarehouseModelsToCharacters:function(t,e){var i=[],n=[];switch(t){case s.WAREHOUSE_STORAGE_TYPE.CHARACTER:n=_.filter(o.dao.warehouseCharacters,function(t){return t.getCount()>0&&t.getCharacterType()===e});break;default:n=_.filter(o.dao.warehouseMaterials,function(t){return t.getCount()>0&&t.getItemType()===r.ITEM_TYPE.CHARACTER&&t.getMaterialType()===e})}for(var l=0;l<n.length;l+=1)for(var u=0;u<n[l].getCount();u+=1)i.push(new a(c(n[l],0,l+"_"+u)));return i},convertWarehouseModelCountInfoArrayToCharacters:function(t,e){for(var i=[],n=0;n<t.length;n+=1)for(var o=0;o<t[n].count;o+=1)i.push(new a(c(t[n].model,0,n+"_"+o)));return i},convertCharactersToWarehouseModelCountInfoArray:function(t,e){var i,a=_.groupBy(t,function(t){return t.getCharacterId()}),n=[];return _.forEach(a,function(t,a){(i=l(e,r.ITEM_TYPE.CHARACTER,parseInt(a)))&&n.push({model:i,count:t.length})}),n},convertWarehouseModelsToEquipments:function(t,e){var i=[],a=[];switch(t){case s.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:Array.isArray(o.dao.warehouseEquipments)&&(a=o.dao.warehouseEquipments);break;default:Array.isArray(o.dao.warehouseMaterials)&&(a=_.filter(o.dao.warehouseMaterials,function(t){return t.getCount()>0&&t.getItemType()===r.ITEM_TYPE.EQUIPMENT&&t.getMaterialType()===e}))}for(var c=0;c<a.length;c+=1)for(var l=0;l<a[c].getCount();l+=1)i.push(new n(u(a[c],0,c+"_"+l)));return i},convertWarehouseModelCountInfoArrayToEquipments:function(t,e){for(var i=[],a=0;a<t.length;a+=1)for(var o=0;o<t[a].count;o+=1)i.push(new n(u(t[a].model,0,a+"_"+o)));return i},convertEquipmentsToWarehouseModelCountInfoArray:function(t,e){var i,a=_.groupBy(t,function(t){return t.getEquipmentId()+"#"+t.getExceedLimit()}),n=[];return _.forEach(a,function(t,a){var o=a.split("#")[0],s=a.split("#")[1];(i=l(e,r.ITEM_TYPE.EQUIPMENT,parseInt(o),parseInt(s)))&&n.push({model:i,count:t.length})}),n}},cc._RF.pop()},{CharacterConst:"CharacterConst",CharacterModel:"CharacterModel",EquipmentModel:"EquipmentModel",ItemConst:"ItemConst",Singleton:"Singleton",WarehouseConst:"WarehouseConst"}],WarehouseEquipmentListView:[function(t,e,i){"use strict";cc._RF.push(e,"f84013upVtKN4TjZHT6OKXx","WarehouseEquipmentListView");var a=t("CommonUtils"),n=t("ResourceUtils"),o=t("WarehouseListViewBase"),r=t("GameConst"),s=t("LocalDataConst"),c=(t("EquipmentConst"),t("EquipmentSortConst")),l=t("EquipmentFilterConst"),u=t("ResourceConst");cc.Class({extends:o,properties:{},initListView:function(t){this.matrixPageView.setCallBackToConvertSortText(this._convertToSortTypeToText.bind(this)),this.matrixPageView.setCallBackToCreateSortConditions(this._callbackToCreateSortConditions.bind(this)),this.matrixPageView.setCallBackToCreateFilterConditions(this._callbackToCreateFilterConditions.bind(this)),this.matrixPageView.setSortParam(this._getCurrentSortType(),this._getCurrentSortOrder()),this.matrixPageView.setFilterCheckList(t.getCurrentEquipmentFilterCheckList()),this.matrixPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilter.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this._super(t)},_callbackToCreateThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("EquipmentMatrixThumbnail")).resetEquipmentMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),i.initEquipmentMatrixThumbnail(t.master.getEquipmentId(),t.master.getAttribute(),0,void 0),i.setParameter("x",t.userModelArray.length),i.node},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(n.getResource(u.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_WAREHOUSE)).getComponent("SortFilterPopup")},_convertToSortTypeToText:function(t){switch(t){case c.WAREHOUSE_SORT_TYPE.NUMBER:return"\u88c5\u5099No\u9806";case c.WAREHOUSE_SORT_TYPE.ATTRIBUTE:return"\u5c5e\u6027\u9806";case c.WAREHOUSE_SORT_TYPE.RARITY:return"\u30ec\u30a2\u5ea6\u9806"}return""},_getCurrentSortType:function(){return a.loadLocalStorage(s.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_EQUIPMENT,c.WAREHOUSE_SORT_TYPE.NUMBER,s.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrder:function(){return a.loadLocalStorage(s.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_EQUIPMENT,r.SORT_ORDER.ASC,s.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({propertyName:c.WAREHOUSE_SORT_PROPERTY_NAME[Object.keys(c.WAREHOUSE_SORT_TYPE)[t]],order:e}),i.push({propertyName:"master",getterName:"getEquipmentId"}),i},_callbackToCreateFilterConditions:function(t){for(var e=[],i=l.WAREHOUSE_PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:l.WAREHOUSE_FILTER_FUNC_NAME[Object.keys(l.WAREHOUSE_FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(l.WAREHOUSE_FILTER_GROUP_END).indexOf(t)>=0},_callbackToSortAndFilter:function(t,e,i){a.saveLocalStorage(s.LOCAL_STORAGE_KEY.SORT_TYPE_EQUIPMENT,t),a.saveLocalStorage(s.LOCAL_STORAGE_KEY.SORT_ORDER_EQUIPMENT,e),this._root.setCurrentEquipmentFilterCheckList(i)}});cc._RF.pop()},{CommonUtils:"CommonUtils",EquipmentConst:"EquipmentConst",EquipmentFilterConst:"EquipmentFilterConst",EquipmentSortConst:"EquipmentSortConst",GameConst:"GameConst",LocalDataConst:"LocalDataConst",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",WarehouseListViewBase:"WarehouseListViewBase"}],WarehouseEquipmentModel:[function(t,e,i){"use strict";cc._RF.push(e,"50a09bOp7lBJ7ZmmvOk4GOG","WarehouseEquipmentModel");var a=t("UserWarehouseEquipmentModel"),n=t("Singleton"),o=t("EquipmentConst"),r=t("ItemConst"),s=t("WarehouseConst");cc.Class({ctor:function(){var t=arguments[0];this.userData=new a(t)},getMainMaster:function(){return this._mainMaster||(this._mainMaster=n.dao.EquipmentMainMasters.find(function(t){return t.getEquipmentId()===this.userData.getEquipmentId()}.bind(this))),this._mainMaster},getLevelMaster:function(){if(!this._levelMaster){this._levelMaster=n.dao.EquipmentLevelMasters.find(function(t){return t.getExpType()===this.getRarity()&&1===t.getLevel()}.bind(this))}return this._levelMaster},getEquipmentCd:function(){return this.userData.getEquipmentCd()},getEquipmentId:function(){return this.userData.getEquipmentId()},getExceedLimit:function(){return this.userData.getExceedLimit()},getCount:function(){return this.userData.getCount()},getUpdateDate:function(){return this.userData.getUpdateDate()},getAttribute:function(){return this.getMainMaster().getAttribute()},getName:function(){return this.getMainMaster().getName()},getShortName:function(){return this.getMainMaster().getName()},getText:function(){return this.getMainMaster().getText()},getRarity:function(){return Math.min(this.getMainMaster().getRarity()+this.getExceedLimit(),o.RARITY.SSR)},getItemType:function(){return r.ITEM_TYPE.EQUIPMENT},getSalePrice:function(){return this.getLevelMaster().getSalePrice()},getCategory:function(){return s.MATERIAL_CATEGORY.EQUIPMENT},getWarehouseType:function(){return s.WAREHOUSE_STORAGE_TYPE.EQUIPMENT}});cc._RF.pop()},{EquipmentConst:"EquipmentConst",ItemConst:"ItemConst",Singleton:"Singleton",UserWarehouseEquipmentModel:"UserWarehouseEquipmentModel",WarehouseConst:"WarehouseConst"}],WarehouseEquipmentStorageListView:[function(t,e,i){"use strict";cc._RF.push(e,"4eabflQ9EFLPJNqLOpa0AAS","WarehouseEquipmentStorageListView");var a=t("CommonUtils"),n=t("ResourceUtils"),o=t("WarehouseListViewBase"),r=t("GameConst"),s=t("LocalDataConst"),c=t("ResourceConst"),l=t("WarehouseConst");cc.Class({extends:o,properties:{},initListView:function(t){this.matrixPageView.setCallBackToConvertSortText(this._convertToSortTypeToText.bind(this)),this.matrixPageView.setCallBackToCreateSortConditions(this._callbackToCreateSortConditions.bind(this)),this.matrixPageView.setCallBackToCreateFilterConditions(this._callbackToCreateFilterConditions.bind(this)),this.matrixPageView.setSortParam(this._getCurrentSortType(),this._getCurrentSortOrder()),this.matrixPageView.setFilterCheckList(t.getCurrentStorageEquipmentFilterCheckList()),this.matrixPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilter.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this._super(t)},_callbackToCreateThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("EquipmentMatrixThumbnail")).resetEquipmentMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),i.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),void 0),i.setParameter("x",t.getCount()),i.node},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(n.getResource(c.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_EQUIPMENT_WAREHOUSE)).getComponent("SortFilterPopup")},_convertToSortTypeToText:function(t){switch(t){case l.WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE.UPDATING:return"\u66f4\u65b0\u9806";case l.WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE.NUMBER:return"No\u9806";case l.WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE.ATTRIBUTE:return"\u5c5e\u6027\u9806";case l.WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE.RARITY:return"\u30ec\u30a2\u5ea6\u9806"}return""},_getCurrentSortType:function(){return a.loadLocalStorage(s.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_EQUIPMENT,l.WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE.UPDATING,s.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrder:function(){return a.loadLocalStorage(s.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_EQUIPMENT,r.SORT_ORDER.ASC,s.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_callbackToCreateSortConditions:function(t,e){var i=[];return i.push({getterName:l.WAREHOUSE_STORAGE_EQUIPMENT_SORT_PROPERTY_NAME[Object.keys(l.WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE)[t]],order:e}),i.push({getterName:"getEquipmentId"}),i.push({getterName:"getExceedLimit"}),i},_callbackToCreateFilterConditions:function(t){for(var e=[],i=l.WAREHOUSE_STORAGE_EQUIPMENT_PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:l.WAREHOUSE_STORAGE_EQUIPMENT_FILTER_FUNC_NAME[Object.keys(l.WAREHOUSE_STORAGE_EQUIPMENT_FILTER_TYPE)[o]]}),this._isGroupEnd(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},_isGroupEnd:function(t){return Object.values(l.WAREHOUSE_STORAGE_EQUIPMENT_FILTER_GROUP_END).indexOf(t)>=0},_callbackToSortAndFilter:function(t,e,i){a.saveLocalStorage(s.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_EQUIPMENT,t),a.saveLocalStorage(s.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_EQUIPMENT,e),this._root.setCurrentStorageEquipmentFilterCheckList(i)}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",WarehouseConst:"WarehouseConst",WarehouseListViewBase:"WarehouseListViewBase"}],WarehouseGiftItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"88fa1gAhexElIK21RvRpMf3","WarehouseGiftItemListView");t("ItemConst");var a=t("WarehouseItemListViewBase");cc.Class({extends:a,properties:{}});cc._RF.pop()},{ItemConst:"ItemConst",WarehouseItemListViewBase:"WarehouseItemListViewBase"}],WarehouseItemDropStageListView:[function(t,e,i){"use strict";cc._RF.push(e,"1b8d2NBCR5CTKJGsQnRwP2k","WarehouseItemDropStageListView");var a=t("ListViewBase"),n=t("CommonScrollView"),o=t("WarehouseUtils"),r=t("QuestUtils");cc.Class({extends:a,properties:{scrollView:n},_callbackToStageThumbnail:null,initWarehouseItemDropStageListView:function(t,e,i){this._callbackToStageThumbnail=i,this._setContent(o.getStageMasterArrayByDropItemId(t,e),r.createReleaseUserStageFlatMap())},_setContent:function(t,e){this.thumbnailParentNode.destroyAllChildren();for(var i=0;i<t.length;i+=1){var a=cc.instantiate(this.thumbnailPrefab).getComponent("WarehouseItemDropStageThumbnail");a.initWarehouseItemDropStageThumbnail(t[i],e[t[i].getStageId()],this._onTapThumbnail.bind(this)),this.thumbnailParentNode.addChild(a.node),this.thumbnailParentNode.childrenCount<=1&&(a.switchSelectedImage(!0),this._callbackToStageThumbnail(t[i]))}this.scrollView.scrollToPercentVertical(1,0)},_resetAllBackEffect:function(){var t=this.thumbnailParentNode.getComponentsInChildren("WarehouseItemDropStageThumbnail");for(var e in t)t[e].switchSelectedImage(!1)},_onTapThumbnail:function(t){this._resetAllBackEffect(),this._callbackToStageThumbnail(t)}});cc._RF.pop()},{CommonScrollView:"CommonScrollView",ListViewBase:"ListViewBase",QuestUtils:"QuestUtils",WarehouseUtils:"WarehouseUtils"}],WarehouseItemDropStageThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"aaa2frvhSFJb4cCqfVWth/y","WarehouseItemDropStageThumbnail");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,backEffectNode:cc.Node},initWarehouseItemDropStageThumbnail:function(t,e,i){this.backEffectNode.active=!1,this.thumbnailParentNode.destroyAllChildren();var a=cc.instantiate(this.thumbnailPrefab).getComponent("QuestStageThumbnail");a.initQuestStageThumbnail(t,e,function(){i(t),this.switchSelectedImage(!0)}.bind(this)),this.thumbnailParentNode.addChild(a.node)},switchSelectedImage:function(t){this.backEffectNode.active=t}});cc._RF.pop()},{}],WarehouseItemListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"2a3c95r8bpC3ol/tvv6XmT3","WarehouseItemListViewBase");var a=t("ResourceUtils"),n=t("WarehouseListViewBase");cc.Class({extends:n,properties:{},_callbackToCreateThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("ItemMatrixThumbnail")).resetItemMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("ItemMatrixThumbnail"),i.setMainImage(a.getFileNameItemThumbnail(t.getItemId())),i.setDenomCount("x",t.getCount()),i.node}});cc._RF.pop()},{ResourceUtils:"ResourceUtils",WarehouseListViewBase:"WarehouseListViewBase"}],WarehouseItemSellConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"64eae5bcV5BRoy+7ovBBSlN","WarehouseItemSellConfirmPopup");var a=t("PopupBase"),n=t("CommonCountView"),o=t("CommonButton"),r=t("ResourceUtils"),s=t("ItemUtils"),c=t("CommonUtils"),l=t("GameConst"),u=t("StaticResourceConst");cc.Class({extends:a,properties:{topItemNameLabel:cc.Label,topSellCountLabel:cc.Label,thumbnailParentNode:cc.Node,hasItemNameLabel:cc.Label,hasItemCountBeforeLabel:cc.Label,hasItemCountAfterLabel:cc.Label,commonCounter:n,getCurrencyNameLabel:cc.Label,getCurrencyBaseLabel:cc.Label,getCurrencyCountLabel:cc.Label,getCurrencyTotalLabel:cc.Label,hasCurrencyNameLabel:cc.Label,hasCurrencyBeforeLabel:cc.Label,hasCurrencyAfterLabel:cc.Label,cancelBtn:o,executeBtn:o},_sellCount:0,_userItemModel:null,_userCurrencyItemMainMaster:null,_userCurrencyItemCount:0,_callbackToExecute:null,onLoad:function(){this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this),o.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this))},openWarehouseItemSellConfirmPopup:function(t,e){this._sellCount=1,this._userItemModel=t,this._userCurrencyItemMainMaster=s.getItemMaster(l.ITEM_ID_GOLD),this._userCurrencyItemCount=s.getUserItemCount(l.ITEM_ID_GOLD),this._callbackToExecute=e,this._initWarehouseItemSellConfirmPopup(),this.open()},_initWarehouseItemSellConfirmPopup:function(){this._initTopLabels(),this._initItemDetail(),this._initGetCountLabels(),this._initHasCountLabels(),this._initCountView()},_initTopLabels:function(){this.topItemNameLabel.string=this._userItemModel.getName(),this.topSellCountLabel.string=c.convertToCommaDelimited(this._sellCount)},_initItemDetail:function(){var t=cc.instantiate(r.getResource(u.ITEM_MATRIX_THUMBNAIL_PREFAB_PATH)).getComponent("ItemMatrixThumbnail");t.setMainImage(r.getFileNameItemThumbnail(this._userItemModel.getItemId())),this.thumbnailParentNode.addChild(t.node),this.hasItemNameLabel.string=this._userItemModel.getName(),this.hasItemCountBeforeLabel.string=c.convertToCommaDelimited(this._userItemModel.getCount()),this.hasItemCountAfterLabel.string=c.convertToCommaDelimited(this._userItemModel.getCount()-this._sellCount)},_initGetCountLabels:function(){this.getCurrencyNameLabel.string="\u7372\u5f97["+this._userCurrencyItemMainMaster.getName()+"]",this.getCurrencyBaseLabel.string=c.convertToCommaDelimited(this._userItemModel.getSalePrice()),this.getCurrencyCountLabel.string=c.convertToCommaDelimited(this._sellCount),this.getCurrencyTotalLabel.string=c.convertToCommaDelimited(this._calcAdditionalCurrency())},_initHasCountLabels:function(){this.hasCurrencyNameLabel.string="\u6240\u6301["+this._userCurrencyItemMainMaster.getName()+"]",this.hasCurrencyBeforeLabel.string=c.convertToCommaDelimited(this._userCurrencyItemCount),this.hasCurrencyAfterLabel.string=c.convertToCommaDelimited(this._calcTotalCurrency())},_initCountView:function(){this.commonCounter.initCommonCountView(this._drawLabels.bind(this),1,this._userItemModel.getCount(),1)},_drawLabels:function(t){this._sellCount=t,this.topSellCountLabel.string=c.convertToCommaDelimited(this._sellCount),this.getCurrencyCountLabel.string=c.convertToCommaDelimited(this._sellCount),this.hasItemCountAfterLabel.string=c.convertToCommaDelimited(this._userItemModel.getCount()-this._sellCount),this.getCurrencyTotalLabel.string=c.convertToCommaDelimited(this._calcAdditionalCurrency()),this.hasCurrencyAfterLabel.string=c.convertToCommaDelimited(this._calcTotalCurrency())},_calcAdditionalCurrency:function(){return this._userItemModel.getSalePrice()*this._sellCount},_calcTotalCurrency:function(){return this._userCurrencyItemCount+this._calcAdditionalCurrency()},_onTapCancelBtn:function(){this.close()},_onTapExecuteBtn:function(){this._callbackToExecute&&this._callbackToExecute(this._userItemModel,this._sellCount)}});cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",ResourceUtils:"ResourceUtils",StaticResourceConst:"StaticResourceConst"}],WarehouseItemSellPopup:[function(t,e,i){"use strict";cc._RF.push(e,"a7fcea+TYRGL7y5Tm5MtMpt","WarehouseItemSellPopup");var a=t("PopupBase"),n=t("ItemUtils"),o=t("GameConst"),r=t("CommonButton"),s=t("CommonUtils");cc.Class({extends:a,properties:{topItemNameLabel:cc.Label,topSellCountLabel:cc.Label,topCurrencyNameLabel:cc.Label,topCurrencyCountLabel:cc.Label,midItemNameLabel:cc.Label,midItemCountBeforeLabel:cc.Label,midItemCountAfterLabel:cc.Label,mitCurrencyNameLabel:cc.Label,mitCurrencyCountBeforeLabel:cc.Label,mitCurrencyCountAfterLabel:cc.Label,okBtn:r},_callbackToClose:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openWarehouseItemSellPopup:function(t,e,i){this._callbackToClose=i,this._initWarehouseItemSellPopup(t,e),this.open()},_initWarehouseItemSellPopup:function(t,e){var i=n.getItemMaster(t),a=n.getUserItemCount(t),r=n.getItemMaster(o.ITEM_ID_GOLD),c=n.getUserItemCount(o.ITEM_ID_GOLD);this.topItemNameLabel.string="["+i.getName()+"]",this.topSellCountLabel.string=s.convertToCommaDelimited(e),this.topCurrencyNameLabel.string="["+r.getName()+"]",this.topCurrencyCountLabel.string=s.convertToCommaDelimited(this._calcAdditionalCurrency(i.getSalePrice(),e)),this.midItemNameLabel.string="["+i.getName()+"]",this.midItemCountBeforeLabel.string=s.convertToCommaDelimited(a+e),this.midItemCountAfterLabel.string=s.convertToCommaDelimited(a),this.mitCurrencyNameLabel.string="\u6240\u6301["+r.getName()+"]",this.mitCurrencyCountBeforeLabel.string=s.convertToCommaDelimited(parseInt(c-this._calcAdditionalCurrency(i.getSalePrice(),e))),this.mitCurrencyCountAfterLabel.string=s.convertToCommaDelimited(c)},_calcAdditionalCurrency:function(t,e){return t*e},_onTapOkBtn:function(){this._callbackToClose&&this._callbackToClose(),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase"}],WarehouseListViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"65c5aTSs+FGV6Hd59fJreX/","WarehouseListViewBase");var a=t("ListViewBase"),n=t("MatrixSingleSelectPageView"),o=(t("ItemConst"),t("ResourceUtils"),t("WarehouseSelectSideViewBase"));cc.Class({extends:a,properties:{matrixPageView:n,warehouseSelectSideView:o},resetListView:function(){this.node.active=!1,this.thumbnailParentNode.active=!1,this.matrixPageView.node.active=!1,this.warehouseSelectSideView.node.active=!1},initListView:function(t){this.matrixPageView.setCallBackToThumbnail(this._callbackToThumbnail.bind(this)),this._super(t),this.matrixPageView.node.active=!0,this.warehouseSelectSideView.node.active=!0},_setListContent:function(t){this.matrixPageView.initMatrixPageView(t.getWarehouseUserItemModelMap()[t.getSelectedTab()],t.getWarehouseUserItemModelMap()[t.getSelectedTab()].length,this._callbackToCreateThumbnailNode.bind(this)),this.warehouseSelectSideView.initWarehouseSelectSideView(t,this.matrixPageView.getCallBackToThumbnail())},_callbackToThumbnail:function(t,e){this._resetActiveThumbnails(),t.setSelectedNodeActive(!0),this.warehouseSelectSideView.drawWarehouseSelectSideView(e,t)},_resetActiveThumbnails:function(){var t=this.matrixPageView.content.getComponentsInChildren("MatrixThumbnailBase");for(var e in t)t[e].setSelectedNodeActive(!1)}});cc._RF.pop()},{ItemConst:"ItemConst",ListViewBase:"ListViewBase",MatrixSingleSelectPageView:"MatrixSingleSelectPageView",ResourceUtils:"ResourceUtils",WarehouseSelectSideViewBase:"WarehouseSelectSideViewBase"}],WarehouseMaterialMatrixThumbnail:[function(t,e,i){"use strict";cc._RF.push(e,"48c2c9kUvFELrbuXK45uGEE","WarehouseMaterialMatrixThumbnail");var a=t("CommonButton"),n=t("ResourceUtils"),o=t("WarehouseConst"),r=t("MatrixThumbnailBase");cc.Class({extends:r,properties:{characterMainBaseNode:cc.Node,characterMainImageSprite:cc.Sprite,characterRarityImageSprite:cc.Sprite,characterAttributeImageSprite:cc.Sprite,characterAttributeFrameImageSprite:cc.Sprite,equipmentMainBaseNode:cc.Node,equipmentMainImageSprite:cc.Sprite,equipmentRarityImageSprite:cc.Sprite,equipmentAttributeImageSprite:cc.Sprite,equipmentAttributeFrameImageSprite:cc.Sprite,paramNode:cc.Node,paramPrefixLabel:cc.Label,paramValueLabel:cc.Label,isSelectedNode:cc.Node,selectedOrderNode:cc.Node,selectedOrderLabel:cc.Label,plainNode:cc.Node,emptyNode:cc.Node,grayDispNode:cc.Node,popVeilNode:cc.Node,popAnim:cc.Animation,thumbnailBtn:a},initWarehouseMaterialMatrixThumbnail:function(t,e,i,a){this.characterMainBaseNode.active=!1,this.equipmentMainBaseNode.active=!1,a===o.MATERIAL_CATEGORY.CHARACTER?(n.addSprite(this.characterMainImageSprite,n.getFileNameCharacterThumbnail(t),void 0,void 0),isNaN(i)||n.addSprite(this.characterRarityImageSprite,n.getFileNameRarityCharacterFrame(i),void 0,void 0),!isNaN(e)&&e>0&&(n.addSprite(this.characterAttributeImageSprite,n.getFileNameAttributeIcon(e),void 0,void 0),n.addSprite(this.characterAttributeFrameImageSprite,n.getFileNameRarityRing(isNaN(i)?0:i),void 0,void 0)),this.characterMainBaseNode.active=!0):(i=isNaN(i)?0:i,n.addSprite(this.equipmentMainImageSprite,n.getFileNameEquipmentThumbNail(t),void 0,void 0),n.addSprite(this.equipmentRarityImageSprite,n.getFileNameRarityEquipmentFrame(i),void 0,void 0),isNaN(e)||(n.addSprite(this.equipmentAttributeImageSprite,n.getFileNameAttributeIcon(e),void 0,void 0),n.addSprite(this.equipmentAttributeFrameImageSprite,n.getFileNameRarityRing(i),void 0,void 0)),this.equipmentMainBaseNode.active=!0)},resetWarehouseMaterialMatrixThumbnail:function(){this.characterMainImageSprite.spriteFrame=null,this.characterRarityImageSprite.spriteFrame=null,this.characterAttributeImageSprite.spriteFrame=null,this.characterAttributeFrameImageSprite.spriteFrame=null,this.equipmentMainImageSprite.spriteFrame=null,this.equipmentRarityImageSprite.spriteFrame=null,this.equipmentAttributeImageSprite.spriteFrame=null,this.equipmentAttributeFrameImageSprite.spriteFrame=null,this.setSelectedNodeActive(!1),this.setSelectedOrder(0),this.setSelectedOrder(-1)},setParameter:function(t,e){this.paramNode.active=!0,this.paramPrefixLabel.string=t+"",this.paramValueLabel.string=e+""},setCallbackToThumbnailBtn:function(t){this.thumbnailBtn.setTapEvent(t,"")},switchEmptyNodeActive:function(t){this.emptyNode.active=t,this.characterMainBaseNode.active=!t,this.equipmentMainBaseNode.active=!t},switchPlainNodeActive:function(t){this.plainNode.active=t,this.characterMainBaseNode.active=!t,this.equipmentMainBaseNode.active=!t},setActive:function(t){this.grayDispNode.active=!t},setSelectedNodeActive:function(t){this.isSelectedNode.active=t},setSelectedOrder:function(t){var e=parseInt(t)>0;this.setSelectedNodeActive(e),this.selectedOrderNode.active=e,this.selectedOrderLabel.string=t},playPopAnim:function(t){this.popVeilNode.active=!0,this.popAnim.play(),t&&this.popAnim.on("finished",function(e,i){if(i.name===this.popAnim.getClips()[0].name)return t()},this)}});cc._RF.pop()},{CommonButton:"CommonButton",MatrixThumbnailBase:"MatrixThumbnailBase",ResourceUtils:"ResourceUtils",WarehouseConst:"WarehouseConst"}],WarehouseMaterialModel:[function(t,e,i){"use strict";cc._RF.push(e,"00befQZcCpBiK5y6sxTlBQ0","WarehouseMaterialModel");var a=t("UserWarehouseMaterialModel"),n=t("WarehouseConst"),o=t("Singleton"),r=t("ItemConst");cc.Class({ctor:function(){var t=arguments[0];this.userData=new a(t)},getMainMaster:function(){return this._mainMaster||(this.userData.getCategory()===n.MATERIAL_CATEGORY.CHARACTER?this._mainMaster=o.dao.CharacterMainMasters.find(function(t){return t.getCharacterId()===this.userData.getMaterialId()}.bind(this)):this._mainMaster=o.dao.EquipmentMainMasters.find(function(t){return t.getEquipmentId()===this.userData.getMaterialId()}.bind(this))),this._mainMaster},getLevelMaster:function(){if(!this._levelMaster){if(this.userData.getCategory()===n.MATERIAL_CATEGORY.CHARACTER){var t=this.getMainMaster().getExpType();this._levelMaster=o.dao.CharacterLevelMasters.find(function(e){return e.getExpType()===t&&1===e.getLevel()})}else this._levelMaster=o.dao.EquipmentLevelMasters.find(function(t){return t.getExpType()===this.getRarity()&&1===t.getLevel()}.bind(this))}return this._levelMaster},getMaterialCd:function(){return this.userData.getMaterialCd()},getCharacterCd:function(){return this.userData.getMaterialCd()},getEquipmentCd:function(){return this.userData.getMaterialCd()},getMaterialId:function(){return this.userData.getMaterialId()},getCharacterId:function(){return this.userData.getMaterialId()},getEquipmentId:function(){return this.userData.getMaterialId()},getCount:function(){return this.userData.getCount()},getCategory:function(){return this.userData.getCategory()},getUpdateDate:function(){return this.userData.getUpdateDate()},getAttribute:function(){return this.getMainMaster().getAttribute()},getName:function(){return this.getMainMaster().getName()},getShortName:function(){return this.userData.getCategory()===n.MATERIAL_CATEGORY.CHARACTER?this.getMainMaster().getShortName():this.getMainMaster().getName()},getText:function(){return this.getMainMaster().getText()},getRarity:function(){return this.getMainMaster().getRarity()},getExceedLimit:function(){return 0},getItemType:function(){return this.userData.getCategory()===n.MATERIAL_CATEGORY.CHARACTER?r.ITEM_TYPE.CHARACTER:r.ITEM_TYPE.EQUIPMENT},getMaterialType:function(){return this.userData.getCategory()===n.MATERIAL_CATEGORY.CHARACTER?this.getMainMaster().getCharacterType():this.getMainMaster().getEquipmentType()},getSalePrice:function(){return this.getLevelMaster().getSalePrice()},getWarehouseType:function(){return n.WAREHOUSE_STORAGE_TYPE.MATERIAL}});cc._RF.pop()},{ItemConst:"ItemConst",Singleton:"Singleton",UserWarehouseMaterialModel:"UserWarehouseMaterialModel",WarehouseConst:"WarehouseConst"}],WarehouseMaterialStorageListView:[function(t,e,i){"use strict";cc._RF.push(e,"f855cm9c8NLkp3Bd4ZWh44E","WarehouseMaterialStorageListView");var a=t("CommonUtils"),n=t("ResourceUtils"),o=t("WarehouseUtils"),r=t("WarehouseListViewBase"),s=t("GameConst"),c=t("LocalDataConst"),l=t("ResourceConst"),u=t("WarehouseConst");cc.Class({extends:r,properties:{},initListView:function(t){this.matrixPageView.setCallBackToConvertSortText(o.convertSortTypeToTextForMaterial),this.matrixPageView.setCallBackToCreateSortConditions(o.createSortConditionsForMaterial),this.matrixPageView.setCallBackToCreateFilterConditions(o.createFilterConditionsForMaterial),this.matrixPageView.setSortParam(this._getCurrentSortType(),this._getCurrentSortOrder()),this.matrixPageView.setFilterCheckList(t.getCurrentStorageMaterialFilterCheckList()),this.matrixPageView.setCallBackToSortAndFilter(this._callbackToSortAndFilter.bind(this)),this.matrixPageView.setCallBackToCreateSortFilterPopup(this._callbackToCreateSortFilterPopup.bind(this)),this._super(t)},_callbackToCreateThumbnailNode:function(t,e){var i;return e?(i=e.getComponentInChildren("WarehouseMaterialMatrixThumbnail")).resetWarehouseMaterialMatrixThumbnail():i=cc.instantiate(this.thumbnailPrefab).getComponent("WarehouseMaterialMatrixThumbnail"),i.initWarehouseMaterialMatrixThumbnail(t.getMaterialId(),t.getAttribute(),t.getRarity(),t.getCategory()),i.setParameter("x",t.getCount()),i.node},_callbackToCreateSortFilterPopup:function(){return cc.instantiate(n.getResource(l.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_MATERIAL_WAREHOUSE)).getComponent("SortFilterPopup")},_getCurrentSortType:function(){return a.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_MATERIAL,u.WAREHOUSE_STORAGE_SORT_TYPE.UPDATING,c.LOCAL_STORAGE_GET_TYPE.INTEGER)},_getCurrentSortOrder:function(){return a.loadLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_MATERIAL,s.SORT_ORDER.ASC,c.LOCAL_STORAGE_GET_TYPE.BOOLEAN)},_callbackToSortAndFilter:function(t,e,i){a.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_TYPE_WAREHOUSE_STORAGE_MATERIAL,t),a.saveLocalStorage(c.LOCAL_STORAGE_KEY.SORT_ORDER_WAREHOUSE_STORAGE_MATERIAL,e),this._root.setCurrentStorageMaterialFilterCheckList(i)}});cc._RF.pop()},{CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",WarehouseConst:"WarehouseConst",WarehouseListViewBase:"WarehouseListViewBase",WarehouseUtils:"WarehouseUtils"}],WarehouseOtherItemListView:[function(t,e,i){"use strict";cc._RF.push(e,"4dffe3m551HArDHBC+Xgjvd","WarehouseOtherItemListView");t("ItemConst");var a=t("WarehouseItemListViewBase");cc.Class({extends:a,properties:{}});cc._RF.pop()},{ItemConst:"ItemConst",WarehouseItemListViewBase:"WarehouseItemListViewBase"}],WarehouseQuestSearchPopup:[function(t,e,i){"use strict";cc._RF.push(e,"76399rhWb1HL4jIFquXyaln","WarehouseQuestSearchPopup");var a=t("PopupBase"),n=t("WarehouseItemDropStageListView"),o=t("CommonButton"),r=(t("ResourceUtils"),t("PopupUtils")),s=t("QuestUtils");cc.Class({extends:a,properties:{thumbnailParentNode:cc.Node,itemNameLabel:cc.Label,itemDescriptionLabel:cc.Label,closeBtn:o,executeBtn:o,warehouseItemDropStageListView:n},_selectedStageMaster:null,_callbackToExecute:null,onLoad:function(){this.closeBtn.setTapEvent(this._onTapCloseBtn.bind(this),o.SE_NAME.CANCEL),this.executeBtn.setTapEvent(this._onTapExecuteBtn.bind(this)),this.executeBtn.node.active=!1},openWarehouseQuestSearchPopup:function(t,e,i,a,n,o){this._callbackToExecute=o,this._initWarehouseQuestSearchPopup(i,a,n),this.open(function(){this.warehouseItemDropStageListView.initWarehouseItemDropStageListView(t,e,this._callbackToStageThumbnail.bind(this))}.bind(this))},_initWarehouseQuestSearchPopup:function(t,e,i){this._initMatrixThumbnail(i),this.itemNameLabel.string=t,this.itemDescriptionLabel.string=e},_initMatrixThumbnail:function(t){var e=cc.instantiate(t);e.setPosition(cc.v2(0,0)),this.thumbnailParentNode.addChild(e)},_callbackToStageThumbnail:function(t){this._selectedStageMaster=t,this.executeBtn.node.active=!0},_onTapCloseBtn:function(){this.close()},_onTapExecuteBtn:function(){s.createReleaseUserStageFlatMap()[this._selectedStageMaster.getStageId()]?(this.close(),this._callbackToExecute(this._selectedStageMaster.getStageId())):r.openCommonPopupOk("\u66dc\u65e5\u78ba\u8a8d","\u66dc\u65e5\u30af\u30a8\u30b9\u30c8\u958b\u653e\u671f\u9593\u5916\u3067\u3059\u3002")}});cc._RF.pop()},{CommonButton:"CommonButton",PopupBase:"PopupBase",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceUtils:"ResourceUtils",WarehouseItemDropStageListView:"WarehouseItemDropStageListView"}],WarehouseRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"8c6b84Se3pKJL4w8JonRgfX","WarehouseRootUtils"),e.exports={openWarehouseSelectSubRoot:function(t,e){cc.log("openWarehouseSelectSubRoot"),cc.log(e),t.warehouseSelectSubRoot||(t.warehouseSelectSubRoot=cc.instantiate(t.warehouseSelectSubRootPrefab).getComponent("WarehouseSelectSubRoot"),t.subRootParent.addChild(t.warehouseSelectSubRoot.node)),t.setSelectedTab(e.tabIndex),t.warehouseSelectSubRoot.initWarehouseSelectSubRoot(t,t.getSelectedTab())},closeWarehouseSelectSubRoot:function(t,e){cc.log("closeWarehouseSelectSubRoot"),cc.log(e),t.warehouseSelectSubRoot&&(t.warehouseSelectSubRoot.node.destroy(),t.warehouseSelectSubRoot=null)}},cc._RF.pop()},{}],WarehouseRoot:[function(t,e,i){"use strict";cc._RF.push(e,"9ddf1oUjLxFAJ9XPVbOjsZ8","WarehouseRoot");var a=t("OutGameRootBase"),n=t("ItemUtils"),o=t("Singleton"),r=(t("TimeUtils"),t("PopupUtils")),s=t("QuestRootUtils"),c=t("WarehouseViewSetting"),l=t("LocalDataConst"),u=t("ResourceConst"),h=(t("EventQuestConst"),t("GameConst"),t("WarehouseConst"));cc.Class({extends:a,properties:{warehouseSelectSubRootPrefab:cc.Prefab,warehouseItemSellConfirmPopupPrefab:cc.Prefab,warehouseItemSellPopupPrefab:cc.Prefab,warehouseQuestSearchPopupPrefab:cc.Prefab,warehouseThumbnailTextPopupPrefab:cc.Prefab,warehouseStorageSellConfirmPopupPrefab:cc.Prefab,warehouseStorageSellCompletePopupPrefab:cc.Prefab},_selectedTab:0,_warehouseUserItemModelMap:null,_warehouseItemSellConfirmPopup:null,_warehouseItemSellPopup:null,_warehouseQuestSearchPopup:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,c.WAREHOUSE_SETTING)},reload:function(){this._warehouseUserItemModelMap=n.createWarehouseUserItemModelMap()},redraw:function(){this.warehouseSelectSubRoot&&this.warehouseSelectSubRoot.initWarehouseSelectSubRoot(this,this._selectedTab),this.redrawUIHeader()},initData:function(){this.reload()},initResource:function(){this.requestRes(u.SORT_FILTER_POPUP_PREFAB_PATH.EQUIPMENT_WAREHOUSE,cc.Prefab),this.requestRes(u.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_CHARACTER_WAREHOUSE,cc.Prefab),this.requestRes(u.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_EQUIPMENT_WAREHOUSE,cc.Prefab),this.requestRes(u.SORT_FILTER_POPUP_PREFAB_PATH.STORAGE_MATERIAL_WAREHOUSE,cc.Prefab)},initialize:function(){this.initOutGameRootBase();this._initOpenFirstView({WarehouseSelectSubRoot:{tabIndex:0}})},openWarehouseItemSellConfirmPopup:function(t){this.closeWarehouseItemSellConfirmPopup(),this._warehouseItemSellConfirmPopup=cc.instantiate(this.warehouseItemSellConfirmPopupPrefab).getComponent("WarehouseItemSellConfirmPopup"),this._warehouseItemSellConfirmPopup.openWarehouseItemSellConfirmPopup(t,this._requestItemSell.bind(this))},closeWarehouseItemSellConfirmPopup:function(){this._warehouseItemSellConfirmPopup&&(this._warehouseItemSellConfirmPopup.close(),this._warehouseItemSellConfirmPopup=null)},openWarehouseItemSellPopup:function(t,e,i){this.closeWarehouseItemSellPopup(),this._warehouseItemSellPopup=cc.instantiate(this.warehouseItemSellPopupPrefab).getComponent("WarehouseItemSellPopup"),this._warehouseItemSellPopup.openWarehouseItemSellPopup(t,e,i)},closeWarehouseItemSellPopup:function(){this._warehouseItemSellPopup&&(this._warehouseItemSellPopup.close(),this._warehouseItemSellPopup=null)},openWarehouseQuestSearchPopup:function(t,e,i,a,n){this.closeWarehouseQuestSearchPopup(),this._warehouseQuestSearchPopup=cc.instantiate(this.warehouseQuestSearchPopupPrefab).getComponent("WarehouseQuestSearchPopup"),this._warehouseQuestSearchPopup.openWarehouseQuestSearchPopup(t,e,i,a,n,this.transitionQuestScene.bind(this))},closeWarehouseQuestSearchPopup:function(){this._warehouseQuestSearchPopup&&(this._warehouseQuestSearchPopup.close(),this._warehouseQuestSearchPopup=null)},openTakeWarehouseConfirmPopup:function(t,e,i,a,n,o){this.closeTakeWarehouseConfirmPopup(),this._takeWarehouseConfirmPopup=cc.instantiate(this.warehouseThumbnailTextPopupPrefab).getComponent("ThumbnailTextPopup"),this._takeWarehouseConfirmPopup.openThumbnailTextPopup(t,"\u53d6\u308a\u51fa\u3057\u78ba\u8a8d","\u5009\u5eab\u304b\u3089"+e+"\u53d6\u308a\u51fa\u3057\u307e\u3059\u304b\uff1f",function(){this._requestTakeWarehouse(i,a,n,o)}.bind(this),function(){},"\u53d6\u308a\u51fa\u3059","\u30ad\u30e3\u30f3\u30bb\u30eb")},closeTakeWarehouseConfirmPopup:function(){this._takeWarehouseConfirmPopup&&(this._takeWarehouseConfirmPopup.close(),this._takeWarehouseConfirmPopup=null)},openStorageSellConfirmPopup:function(t,e,i,a){this.closeStorageSellConfirmPopup(),this._sellStorageConfirmPopup=cc.instantiate(this.warehouseStorageSellConfirmPopupPrefab).getComponent("WarehouseStorageSellConfirmPopup"),this._sellStorageConfirmPopup.openWarehouseStorageSellConfirmPopup(t,e,i,function(){this._requestSellWarehouse(e,i,a)}.bind(this))},closeStorageSellConfirmPopup:function(){this._sellStorageConfirmPopup&&(this._sellStorageConfirmPopup.close(),this._sellStorageConfirmPopup=null)},openStorageSellCompletePopup:function(t,e,i,a){this.closeStorageSellCompletePopup(),this._sellStorageCompletePopup=cc.instantiate(this.warehouseStorageSellCompletePopupPrefab).getComponent("WarehouseStorageSellCompletePopup"),this._sellStorageCompletePopup.openWarehouseStorageSellCompletePopup(t,e,i,a)},closeStorageSellCompletePopup:function(){this._sellStorageCompletePopup&&(this._sellStorageCompletePopup.close(),this._sellStorageCompletePopup=null)},transitionForUseTicketScene:function(t,e){this.pushScene(t,this.getCurrentSceneName(),e,this.createPreViewParam())},transitionForShopScene:function(t){var e={ShopSelectSubRoot:{shopCategory:_.find(o.dao.ShopMainMasters,function(e){return e.getShopId()===t}).getCategory()}};this.pushScene("ShopScene",this.getCurrentSceneName(),e,this.createPreViewParam())},transitionQuestScene:function(t){var e=s.createBattleStartTransitionParams(t);if(!e)return r.openSimpleMessageWindow("\u30af\u30a8\u30b9\u30c8\u958b\u50ac\u671f\u9593\u5916\u3067\u3059\u3002");var i=this.createPreViewParam();this.pushScene(e.sceneName,this.getCurrentSceneName(),e.viewParam,i)},createPreViewParam:function(){var t={};return this.warehouseSelectSubRoot&&(t.WarehouseSelectSubRoot={tabIndex:this.getSelectedTab()}),t},_requestItemSell:function(t,e){o.ItemService.sell([t.getItemId()],[e],function(){this.closeWarehouseItemSellConfirmPopup(),this.openWarehouseItemSellPopup(t.getItemId(),e,function(){this.closeWarehouseItemSellPopup(),this.reload(),this.redraw()}.bind(this))}.bind(this))},_requestTakeWarehouse:function(t,e,i,a){o.WarehouseService.takeWarehouse(t,e,i,a)},_requestSellWarehouse:function(t,e,i){var a=this._getWarehouseModelCode(t),n=t.getWarehouseType();t.getCategory()===h.MATERIAL_CATEGORY.CHARACTER?o.CharacterService.sellWarehouse(a,e,n,i):o.EquipmentService.sellWarehouse(a,e,n,i)},_getWarehouseModelCode:function(t){switch(t.getWarehouseType()){case h.WAREHOUSE_STORAGE_TYPE.CHARACTER:return t.getCharacterCd();case h.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:return t.getEquipmentCd();case h.WAREHOUSE_STORAGE_TYPE.MATERIAL:return t.getMaterialCd()}return""},getWarehouseUserItemModelMap:function(){return this._warehouseUserItemModelMap},setSelectedTab:function(t){this._selectedTab=parseInt(t)},getSelectedTab:function(t){return this._selectedTab},setCurrentEquipmentFilterCheckList:function(t){o.localData[l.FILTER.TEN.WAREHOUSE_EQUIPMENT]=t.slice()},getCurrentEquipmentFilterCheckList:function(){return o.localData[l.FILTER.TEN.WAREHOUSE_EQUIPMENT]},setCurrentStorageCharacterFilterCheckList:function(t){o.localData[l.FILTER.TEN.WAREHOUSE_STORAGE_CHARACTER]=t.slice()},getCurrentStorageCharacterFilterCheckList:function(){return o.localData[l.FILTER.TEN.WAREHOUSE_STORAGE_CHARACTER]},setCurrentStorageEquipmentFilterCheckList:function(t){o.localData[l.FILTER.TEN.WAREHOUSE_STORAGE_EQUIPMENT]=t.slice()},getCurrentStorageEquipmentFilterCheckList:function(){return o.localData[l.FILTER.TEN.WAREHOUSE_STORAGE_EQUIPMENT]},setCurrentStorageMaterialFilterCheckList:function(t){o.localData[l.FILTER.TWELVE.WAREHOUSE_STORAGE_MATERIAL]=t.slice()},getCurrentStorageMaterialFilterCheckList:function(){return o.localData[l.FILTER.TWELVE.WAREHOUSE_STORAGE_MATERIAL]}});cc._RF.pop()},{EventQuestConst:"EventQuestConst",GameConst:"GameConst",ItemUtils:"ItemUtils",LocalDataConst:"LocalDataConst",OutGameRootBase:"OutGameRootBase",PopupUtils:"PopupUtils",QuestRootUtils:"QuestRootUtils",ResourceConst:"ResourceConst",Singleton:"Singleton",TimeUtils:"TimeUtils",WarehouseConst:"WarehouseConst",WarehouseViewSetting:"WarehouseViewSetting"}],WarehouseSelectCharacterStorageSideView:[function(t,e,i){"use strict";cc._RF.push(e,"bd1c0FqlQVHy7wWgYGbY7qJ","WarehouseSelectCharacterStorageSideView");var a=t("CommonButton"),n=t("Singleton"),o=t("WarehouseSelectSideViewBase"),r=t("CommonCountView"),s=t("WarehouseUtils"),c=t("PopupUtils"),l=t("CharacterUtils"),u=t("CommonUtils"),h=t("WarehouseConst");cc.Class({extends:o,properties:{itemDescriptionLabel:cc.Label,commonCountView:r,totalCurrencyLabel:cc.Label,takeBtn:a,sellBtn:a},_characterModel:null,_listViewSelectThumbnail:null,_callbackThumbnail:null,onLoad:function(){this._super(),this.takeBtn.setTapEvent(this._onTapTakeBtn.bind(this),void 0),this.takeBtn.switchBtnImage(!1),this.takeBtn.setTouchEnable(!1),this.sellBtn.setTapEvent(this._onTapSellBtn.bind(this),void 0),this.sellBtn.switchBtnImage(!1),this.sellBtn.setTouchEnable(!1),this._setActiveButtons(!1)},initWarehouseSelectSideView:function(t,e){this._super(t),this.itemDescriptionLabel.string="-",this.commonCountView.initCommonCountView(void 0,0,0,0),this._characterModel=null,this.takeBtn.switchBtnImage(!1),this.takeBtn.setTouchEnable(!1),this.sellBtn.switchBtnImage(!1),this.sellBtn.setTouchEnable(!1),this._setActiveButtons(!1),this.totalCurrencyLabel.string="0",this._callbackThumbnail=e},drawWarehouseSelectSideView:function(t,e){this._characterModel=t,this._listViewSelectThumbnail=e,this._drawMatrixThumbnail(t),this.itemNameLabel.string=t.getName(),this.itemDescriptionLabel.string=t.getShortText();var i=Math.min(t.getCount(),h.MAX_TAKE_COUNT);this.commonCountView.initCommonCountView(this._redrawCountView.bind(this),1,i,1),this._redrawCountView(this.commonCountView.getCountNum()),this._setActiveButtons(!0),this.takeBtn.setTouchEnable(!0),this.sellBtn.switchBtnImage(!0),this.sellBtn.setTouchEnable(!0)},_redrawCountView:function(t){this.takeBtn.switchBtnImage(this._getRemainCharacterTakeCount()>=t),this.totalCurrencyLabel.string=u.convertToCommaDelimited(this._characterModel.getSalePrice()*t)},_getRemainCharacterTakeCount:function(){var t=n.dao[n.USER].userData.getCharacterMaxCount()-l.getPlayableUserCharacterModelArray().length;return Math.max(t,0)},_drawMatrixThumbnail:function(t){this._thumbnail||(this._thumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("CharacterMatrixThumbnail"),this.thumbnailParentNode.addChild(this._thumbnail.node)),t?(this._thumbnail.initDisablePlainMatrixThumbnail(),this._thumbnail.resetCharacterMatrixThumbnail(),this._thumbnail.initCharacterMatrixThumbnail(t.getMainMaster(),t.getExceedLimit(),void 0,void 0),this._thumbnail.setBottomParams("x",t.getCount())):this._thumbnail.initPlainMatrixThumbnail()},_setActiveButtons:function(t){this._characterModel&&s.getStageMasterArrayByDropItemId(this._characterModel.getCharacterId(),this._characterModel.getItemType()).length>0?this._setActiveSearchBtn(t):this._setActiveSearchBtn(!1)},_onTapSearcheBtn:function(){s.getStageMasterArrayByDropItemId(this._characterModel.getCharacterId(),this._characterModel.getItemType()).length>0&&this._root.openWarehouseQuestSearchPopup(this._characterModel.getCharacterId(),this._characterModel.getItemType(),this._characterModel.getName(),this._characterModel.getShortText(),this._thumbnail.node)},_onTapTakeBtn:function(){if(s.checkWarehouseTakeCharacterStorageByUserItemsCondition())if(this._getRemainCharacterTakeCount()<this.commonCountView.getCountNum())c.openSimpleMessageWindow("\u53d7\u3051\u53d6\u308c\u308b\u30e6\u30cb\u30c3\u30c8\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002");else{var t=this._characterModel.getName()+"\u3092\n"+this.commonCountView.getCountNum()+"\u500b",e=cc.instantiate(this._thumbnail.node).getComponent("CharacterMatrixThumbnail");e.setBottomParams("x",this.commonCountView.getCountNum()),this._root.openTakeWarehouseConfirmPopup(e.node,t,h.WAREHOUSE_STORAGE_TYPE.CHARACTER,this._characterModel.getCharacterCd(),this.commonCountView.getCountNum(),function(){c.openCommonPopupOk("","\u53d6\u308a\u51fa\u3057\u307e\u3057\u305f",void 0,!1,void 0,void 0,!1),this._root.reload();var t=this._root.getWarehouseUserItemModelMap()[this._root.getSelectedTab()],e=_.find(t,function(t){return t.getCharacterCd()===this._characterModel.getCharacterCd()}.bind(this));if(e){var i=this._listViewSelectThumbnail;i.setCallbackToThumbnailBtn(function(){this._callbackThumbnail&&this._callbackThumbnail(i,e)}.bind(this)),this._listViewSelectThumbnail.setBottomParams("x",e.getCount()),this.drawWarehouseSelectSideView(e,this._listViewSelectThumbnail)}else this._root.redraw()}.bind(this))}},_onTapSellBtn:function(){var t=cc.instantiate(this._thumbnail.node).getComponent("CharacterMatrixThumbnail");t.setBottomParams("x",this.commonCountView.getCountNum()),this._root.openStorageSellConfirmPopup(t.node,this._characterModel,this.commonCountView.getCountNum(),function(){var t=cc.instantiate(this._thumbnail.node).getComponent("CharacterMatrixThumbnail");t.setBottomParams("x",this.commonCountView.getCountNum()),this._root.openStorageSellCompletePopup(t.node,this._characterModel,this.commonCountView.getCountNum(),void 0),this._root.reload(),this._root.redrawUIHeader();var e=this._root.getWarehouseUserItemModelMap()[this._root.getSelectedTab()],i=_.find(e,function(t){return t.getCharacterCd()===this._characterModel.getCharacterCd()}.bind(this));if(i){var a=this._listViewSelectThumbnail;a.setCallbackToThumbnailBtn(function(){this._callbackThumbnail&&this._callbackThumbnail(a,i)}.bind(this)),this._listViewSelectThumbnail.setBottomParams("x",i.getCount()),this.drawWarehouseSelectSideView(i,this._listViewSelectThumbnail)}else this._root.redraw()}.bind(this))}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",PopupUtils:"PopupUtils",Singleton:"Singleton",WarehouseConst:"WarehouseConst",WarehouseSelectSideViewBase:"WarehouseSelectSideViewBase",WarehouseUtils:"WarehouseUtils"}],WarehouseSelectEquipmentSideView:[function(t,e,i){"use strict";cc._RF.push(e,"a0bb7bwjh1MF5bHb765yuw6","WarehouseSelectEquipmentSideView");var a=t("WarehouseSelectSideViewBase"),n=t("BattleParameterView"),o=(t("ResourceUtils"),t("EquipmentUtils")),r=t("WarehouseUtils"),s=t("GameConst"),c=t("ItemConst"),l=t("EquipmentConst");cc.Class({extends:a,properties:{levelLabel:cc.Label,normalAbilityRichText:cc.RichText,boostAbilityRichText:cc.RichText,parameterView:n},_equipmentInfo:null,_equipmentEffectInfoMap:null,initWarehouseSelectSideView:function(t){this._super(t),this._equipmentInfo=null,this._drawParameter(null),this._drawAbility(null)},drawWarehouseSelectSideView:function(t){this._equipmentInfo=t,this.itemNameLabel.string=t.master.getName(),this._drawMatrixThumbnail(t),this._drawParameter(t),this._drawAbility(t),this._setActiveButtons(!0)},_drawMatrixThumbnail:function(t){this._thumbnail||(this._thumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.thumbnailParentNode.addChild(this._thumbnail.node)),t?(this._thumbnail.switchEmptyNodeActive(!1),this._thumbnail.initEquipmentMatrixThumbnail(t.master.getEquipmentId(),t.master.getAttribute(),0,void 0)):this._thumbnail.switchEmptyNodeActive(!0)},_drawParameter:function(t){t?(this.levelLabel.string=t.master.getMaxLevel4(),this.parameterView.initBattleParameterView(t.master.getMaxHp4(),t.master.getMaxAtk4(),t.master.getMaxDef4())):(this.levelLabel.string="-",this.parameterView.resetBattleParameterView("-"))},_drawAbility:function(t){t?(this._equipmentEffectInfoMap=o.createEquipmentEffectInfoMapByEquipmentId(t.master.getEquipmentId()),this.normalAbilityRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+s.RICH_TEXT_TAG_STATE.NORMAL.START+this._equipmentEffectInfoMap[c.EQUIPMENT_BOOST_TYPE.NORMAL][l.RARITY.SSR].effectTextArray.join("\n")+s.RICH_TEXT_TAG_STATE.NORMAL.END,this.boostAbilityRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000"+s.RICH_TEXT_TAG_STATE.NORMAL.START+this._equipmentEffectInfoMap[c.EQUIPMENT_BOOST_TYPE.BOOST][l.RARITY.SSR].effectTextArray.join("\n")+s.RICH_TEXT_TAG_STATE.NORMAL.END):(this.normalAbilityRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000-",this.boostAbilityRichText.string="\u3000\u3000\u3000\u3000\u3000\u3000\u3000-")},_setActiveButtons:function(t){this._equipmentInfo?this._setActiveSearchBtn(t&&r.getStageMasterArrayByDropItemId(this._equipmentInfo.master.getEquipmentId(),this._equipmentInfo.itemType).length>0):this._setActiveSearchBtn(t)},_onTapSearcheBtn:function(){this._root.openWarehouseQuestSearchPopup(this._equipmentInfo.master.getEquipmentId(),this._equipmentInfo.itemType,this._equipmentInfo.master.getName(),this._equipmentEffectInfoMap[c.EQUIPMENT_BOOST_TYPE.NORMAL][l.RARITY.SSR].effectTextArray.join("\n"),this._thumbnail.node)}});cc._RF.pop()},{BattleParameterView:"BattleParameterView",EquipmentConst:"EquipmentConst",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",ResourceUtils:"ResourceUtils",WarehouseSelectSideViewBase:"WarehouseSelectSideViewBase",WarehouseUtils:"WarehouseUtils"}],WarehouseSelectEquipmentStorageSideView:[function(t,e,i){"use strict";cc._RF.push(e,"7ccfd4e/b5JjJfVaKn5qK8I","WarehouseSelectEquipmentStorageSideView");var a=t("CommonButton"),n=t("Singleton"),o=t("WarehouseSelectSideViewBase"),r=t("CommonCountView"),s=t("WarehouseUtils"),c=t("PopupUtils"),l=t("EquipmentUtils"),u=t("CommonUtils"),h=t("WarehouseConst");cc.Class({extends:o,properties:{itemDescriptionLabel:cc.Label,commonCountView:r,totalCurrencyLabel:cc.Label,takeBtn:a,sellBtn:a},_equipmentModel:null,_listViewSelectThumbnail:null,_callbackThumbnail:null,onLoad:function(){this._super(),this.takeBtn.setTapEvent(this._onTapTakeBtn.bind(this),void 0),this.takeBtn.switchBtnImage(!1),this.takeBtn.setTouchEnable(!1),this.sellBtn.setTapEvent(this._onTapSellBtn.bind(this),void 0),this.sellBtn.switchBtnImage(!1),this.sellBtn.setTouchEnable(!1),this._setActiveButtons(!1)},initWarehouseSelectSideView:function(t,e){this._super(t),this.itemDescriptionLabel.string="-",this.commonCountView.initCommonCountView(void 0,0,0,0),this._equipmentModel=null,this.takeBtn.switchBtnImage(!1),this.takeBtn.setTouchEnable(!1),this.sellBtn.switchBtnImage(!1),this.sellBtn.setTouchEnable(!1),this._setActiveButtons(!1),this.totalCurrencyLabel.string="0",this._callbackThumbnail=e},drawWarehouseSelectSideView:function(t,e){this._equipmentModel=t,this._listViewSelectThumbnail=e,this._drawMatrixThumbnail(t),this.itemNameLabel.string=t.getName(),this.itemDescriptionLabel.string=t.getText();var i=Math.min(t.getCount(),h.MAX_TAKE_COUNT);this.commonCountView.initCommonCountView(this._redrawCountView.bind(this),1,i,1),this._redrawCountView(this.commonCountView.getCountNum()),this._setActiveButtons(!0),this.takeBtn.setTouchEnable(!0),this.sellBtn.switchBtnImage(!0),this.sellBtn.setTouchEnable(!0)},_redrawCountView:function(t){this.takeBtn.switchBtnImage(this._getRemainEquipmentTakeCount()>=t),this.totalCurrencyLabel.string=u.convertToCommaDelimited(this._equipmentModel.getSalePrice()*t)},_getRemainEquipmentTakeCount:function(){var t=n.dao[n.USER].userData.getEquipmentMaxCount()-l.getPlayableUserEquipmentModelArray().length;return Math.max(t,0)},_drawMatrixThumbnail:function(t){this._thumbnail||(this._thumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("EquipmentMatrixThumbnail"),this.thumbnailParentNode.addChild(this._thumbnail.node)),t?(this._thumbnail.switchEmptyNodeActive(!1),this._thumbnail.resetEquipmentMatrixThumbnail(),this._thumbnail.initEquipmentMatrixThumbnail(t.getEquipmentId(),t.getAttribute(),t.getRarity(),void 0),this._thumbnail.setParameter("x",t.getCount())):this._thumbnail.switchEmptyNodeActive(!0)},_setActiveButtons:function(t){this._equipmentModel&&s.getStageMasterArrayByDropItemId(this._equipmentModel.getEquipmentId(),this._equipmentModel.getItemType()).length>0?this._setActiveSearchBtn(t):this._setActiveSearchBtn(!1)},_onTapSearcheBtn:function(){s.getStageMasterArrayByDropItemId(this._equipmentModel.getEquipmentId(),this._equipmentModel.getItemType()).length>0&&this._root.openWarehouseQuestSearchPopup(this._equipmentModel.getEquipmentId(),this._equipmentModel.getItemType(),this._equipmentModel.getName(),this._equipmentModel.getText(),this._thumbnail.node)},_onTapTakeBtn:function(){if(s.checkWarehouseTakeEquipmentStorageByUserItemsCondition())if(this._getRemainEquipmentTakeCount()<this.commonCountView.getCountNum())c.openSimpleMessageWindow("\u53d7\u3051\u53d6\u308c\u308b\u88c5\u5099\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002");else{var t=this._equipmentModel.getName()+"\u3092\n"+this.commonCountView.getCountNum()+"\u500b",e=cc.instantiate(this._thumbnail.node).getComponent("EquipmentMatrixThumbnail");e.setParameter("x",this.commonCountView.getCountNum()),this._root.openTakeWarehouseConfirmPopup(e.node,t,h.WAREHOUSE_STORAGE_TYPE.EQUIPMENT,this._equipmentModel.getEquipmentCd(),this.commonCountView.getCountNum(),function(){c.openCommonPopupOk("","\u53d6\u308a\u51fa\u3057\u307e\u3057\u305f",void 0,!1,void 0,void 0,!1),this._root.reload();var t=this._root.getWarehouseUserItemModelMap()[this._root.getSelectedTab()],e=_.find(t,function(t){return t.getEquipmentCd()===this._equipmentModel.getEquipmentCd()}.bind(this));if(e){var i=this._listViewSelectThumbnail;i.setCallbackToThumbnailBtn(function(){this._callbackThumbnail&&this._callbackThumbnail(i,e)}.bind(this)),this._listViewSelectThumbnail.setParameter("x",e.getCount()),this.drawWarehouseSelectSideView(e,this._listViewSelectThumbnail)}else this._root.redraw()}.bind(this))}},_onTapSellBtn:function(){var t=cc.instantiate(this._thumbnail.node).getComponent("EquipmentMatrixThumbnail");t.setParameter("x",this.commonCountView.getCountNum()),this._root.openStorageSellConfirmPopup(t.node,this._equipmentModel,this.commonCountView.getCountNum(),function(){var t=cc.instantiate(this._thumbnail.node).getComponent("EquipmentMatrixThumbnail");t.setParameter("x",this.commonCountView.getCountNum()),this._root.openStorageSellCompletePopup(t.node,this._equipmentModel,this.commonCountView.getCountNum(),void 0),this._root.reload(),this._root.redrawUIHeader();var e=this._root.getWarehouseUserItemModelMap()[this._root.getSelectedTab()],i=_.find(e,function(t){return t.getEquipmentCd()===this._equipmentModel.getEquipmentCd()}.bind(this));if(i){var a=this._listViewSelectThumbnail;a.setCallbackToThumbnailBtn(function(){this._callbackThumbnail&&this._callbackThumbnail(a,i)}.bind(this)),this._listViewSelectThumbnail.setParameter("x",i.getCount()),this.drawWarehouseSelectSideView(i,this._listViewSelectThumbnail)}else this._root.redraw()}.bind(this))}});cc._RF.pop()},{CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",PopupUtils:"PopupUtils",Singleton:"Singleton",WarehouseConst:"WarehouseConst",WarehouseSelectSideViewBase:"WarehouseSelectSideViewBase",WarehouseUtils:"WarehouseUtils"}],WarehouseSelectItemSideView:[function(t,e,i){"use strict";cc._RF.push(e,"5915f2iYOhBiqh6pGLTp2rx","WarehouseSelectItemSideView");var a=t("CommonButton"),n=t("WarehouseSelectSideViewBase"),o=t("ResourceUtils"),r=t("WarehouseUtils"),s=t("ShopUtils"),c=t("PopupUtils");cc.Class({extends:n,properties:{itemDescriptionLabel:cc.Label,transitionLabel:cc.Label,transitionBtn:a,sellPriceLabel:cc.Label,sellBtn:a},_userItemModel:null,_shopDetailMaster:null,onLoad:function(){this._super(),this.transitionBtn.setTapEvent(this._onTapTransitionBtn.bind(this)),this.sellBtn.setTapEvent(this._onTapSellBtn.bind(this))},initWarehouseSelectSideView:function(t){this._super(t),this.itemDescriptionLabel.string="-",this.sellPriceLabel.string="0",this.transitionBtn.node.parent.active=!1},drawWarehouseSelectSideView:function(t){this._userItemModel=t,this._userItemModel?this._shopDetailMaster=s.getShopDetailMasterByItemId(this._userItemModel.getItemType(),this._userItemModel.getItemId()):this._shopDetailMaster=null,this._drawMatrixThumbnail(t),this.itemNameLabel.string=t.getName(),this.itemDescriptionLabel.string=t.getText(),this.sellPriceLabel.string=t.getSalePrice(),this._setActiveButtons(!0),this.transitionBtn.node.parent.active=!!r.getWarehouseItemTransitionSceneName(this._userItemModel.getItemType(),this._userItemModel.getItemId()),this.transitionLabel.string=r.getWarehouseItemTransitionText(this._userItemModel.getItemType())},_drawMatrixThumbnail:function(t){this._thumbnail||(this._thumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("ItemMatrixThumbnail"),this.thumbnailParentNode.addChild(this._thumbnail.node)),t?(this._thumbnail.switchEmptyNodeActive(!1),this._thumbnail.setMainImage(o.getFileNameItemThumbnail(t.getItemId())),this._thumbnail.setDenomCount("x",t.getCount())):this._thumbnail.switchEmptyNodeActive(!0)},_setActiveButtons:function(t){this._userItemModel?(this.sellBtn.switchBtnImage(t&&this._userItemModel.getCount()>0),this.sellBtn.setTouchEnable(t&&this._userItemModel.getCount()>0),r.getStageMasterArrayByDropItemId(this._userItemModel.getItemId(),this._userItemModel.getItemType()).length>0||this._shopDetailMaster?this._setActiveSearchBtn(t):this._setActiveSearchBtn(!1)):(this.sellBtn.switchBtnImage(t),this.sellBtn.setTouchEnable(t),this._setActiveSearchBtn(t))},_onTapTransitionBtn:function(){this._root.transitionForUseTicketScene(r.getWarehouseItemTransitionSceneName(this._userItemModel.getItemType(),this._userItemModel.getItemId()),r.getWarehouseItemTransitionParam(this._userItemModel.getItemType(),this._userItemModel.getItemId()))},_onTapSellBtn:function(){this._root.openWarehouseItemSellConfirmPopup(this._userItemModel)},_onTapSearcheBtn:function(){r.getStageMasterArrayByDropItemId(this._userItemModel.getItemId(),this._userItemModel.getItemType()).length>0?this._root.openWarehouseQuestSearchPopup(this._userItemModel.getItemId(),this._userItemModel.getItemType(),this._userItemModel.getName(),this._userItemModel.getText(),this._thumbnail.node):this._shopDetailMaster&&c.openCommonPopupYesNo("\u30b7\u30e7\u30c3\u30d7\u78ba\u8a8d","\u30b7\u30e7\u30c3\u30d7\u3078\u8cfc\u5165\u3057\u306b\u884c\u304d\u307e\u3059\u304b\uff1f","",!1,function(){this._root.transitionForShopScene(this._shopDetailMaster.getShopId())}.bind(this),function(){},"\u306f\u3044","\u3044\u3044\u3048")}});cc._RF.pop()},{CommonButton:"CommonButton",PopupUtils:"PopupUtils",ResourceUtils:"ResourceUtils",ShopUtils:"ShopUtils",WarehouseSelectSideViewBase:"WarehouseSelectSideViewBase",WarehouseUtils:"WarehouseUtils"}],WarehouseSelectMaterialStorageSideView:[function(t,e,i){"use strict";cc._RF.push(e,"866bbelXA9NyL0WnkFPaQ0m","WarehouseSelectMaterialStorageSideView");var a=t("CommonButton"),n=t("WarehouseSelectSideViewBase"),o=t("CommonCountView"),r=t("WarehouseUtils"),s=t("PopupUtils"),c=t("CharacterUtils"),l=t("EquipmentUtils"),u=t("CommonUtils"),h=t("GameConst"),d=t("WarehouseConst");cc.Class({extends:n,properties:{itemDescriptionLabel:cc.Label,commonCountView:o,totalCurrencyLabel:cc.Label,takeBtn:a,sellBtn:a},_materialModel:null,_listViewSelectThumbnail:null,_callbackThumbnail:null,onLoad:function(){this._super(),this.takeBtn.setTapEvent(this._onTapTakeBtn.bind(this),void 0),this.takeBtn.switchBtnImage(!1),this.takeBtn.setTouchEnable(!1),this.sellBtn.setTapEvent(this._onTapSellBtn.bind(this),void 0),this.sellBtn.switchBtnImage(!1),this.sellBtn.setTouchEnable(!1),this._setActiveButtons(!1)},initWarehouseSelectSideView:function(t,e){this._super(t),this.itemDescriptionLabel.string="-",this.commonCountView.initCommonCountView(void 0,0,0,0),this._materialModel=null,this.takeBtn.switchBtnImage(!1),this.takeBtn.setTouchEnable(!1),this.sellBtn.switchBtnImage(!1),this.sellBtn.setTouchEnable(!1),this._setActiveButtons(!1),this.totalCurrencyLabel.string="0",this._callbackThumbnail=e},drawWarehouseSelectSideView:function(t,e){this._materialModel=t,this._listViewSelectThumbnail=e,this._drawMatrixThumbnail(t),this.itemNameLabel.string=t.getName(),this.itemDescriptionLabel.string=t.getText();var i=Math.min(t.getCount(),d.MAX_TAKE_COUNT);this.commonCountView.initCommonCountView(this._redrawCountView.bind(this),1,i,1),this._redrawCountView(this.commonCountView.getCountNum()),this._setActiveButtons(!0),this.takeBtn.setTouchEnable(!0),this.sellBtn.switchBtnImage(!0),this.sellBtn.setTouchEnable(!0)},_redrawCountView:function(t){this.takeBtn.switchBtnImage(this._getRemainMaterialTakeCount(this._materialModel.getCategory())>=t),this.totalCurrencyLabel.string=u.convertToCommaDelimited(this._materialModel.getSalePrice()*t)},_getRemainMaterialTakeCount:function(t){var e;return e=t===d.MATERIAL_CATEGORY.CHARACTER?h.MAX_MATERIAL_COUNT-c.getNonPlayableUserCharacterModelArray().length:h.MAX_MATERIAL_COUNT-l.getNonPlayableUserEquipmentModelArray().length,Math.max(e,0)},_drawMatrixThumbnail:function(t){this._thumbnail||(this._thumbnail=cc.instantiate(this.thumbnailPrefab).getComponent("WarehouseMaterialMatrixThumbnail"),this.thumbnailParentNode.addChild(this._thumbnail.node)),t?(this._thumbnail.switchEmptyNodeActive(!1),this._thumbnail.resetWarehouseMaterialMatrixThumbnail(),this._thumbnail.initWarehouseMaterialMatrixThumbnail(t.getMaterialId(),t.getAttribute(),t.getRarity(),t.getCategory()),this._thumbnail.setParameter("x",t.getCount())):this._thumbnail.switchEmptyNodeActive(!0)},_setActiveButtons:function(t){this._materialModel&&r.getStageMasterArrayByDropItemId(this._materialModel.getMaterialId(),this._materialModel.getItemType()).length>0?this._setActiveSearchBtn(t):this._setActiveSearchBtn(!1)},_onTapSearcheBtn:function(){r.getStageMasterArrayByDropItemId(this._materialModel.getMaterialId(),this._materialModel.getItemType()).length>0&&this._root.openWarehouseQuestSearchPopup(this._materialModel.getMaterialId(),this._materialModel.getItemType(),this._materialModel.getName(),this._materialModel.getText(),this._thumbnail.node)},_onTapTakeBtn:function(){if(r.checkWarehouseTakeMaterialStorageByUserItemsCondition(this._materialModel.getCategory()))if(this._getRemainMaterialTakeCount(this._materialModel.getCategory())<this.commonCountView.getCountNum())this._materialModel.getCategory()===d.MATERIAL_CATEGORY.CHARACTER?s.openSimpleMessageWindow("\u53d7\u3051\u53d6\u308c\u308b\u30e6\u30cb\u30c3\u30c8\u7d20\u6750\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"):s.openSimpleMessageWindow("\u53d7\u3051\u53d6\u308c\u308b\u88c5\u5099\u7d20\u6750\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002");else{var t=this._materialModel.getName()+"\u3092\n"+this.commonCountView.getCountNum()+"\u500b",e=cc.instantiate(this._thumbnail.node).getComponent("WarehouseMaterialMatrixThumbnail");e.setParameter("x",this.commonCountView.getCountNum()),this._root.openTakeWarehouseConfirmPopup(e.node,t,d.WAREHOUSE_STORAGE_TYPE.MATERIAL,this._materialModel.getMaterialCd(),this.commonCountView.getCountNum(),function(){s.openCommonPopupOk("","\u53d6\u308a\u51fa\u3057\u307e\u3057\u305f",void 0,!1,void 0,void 0,!1),this._root.reload();var t=this._root.getWarehouseUserItemModelMap()[this._root.getSelectedTab()],e=_.find(t,function(t){return t.getMaterialCd()===this._materialModel.getMaterialCd()}.bind(this));if(e){var i=this._listViewSelectThumbnail;i.setCallbackToThumbnailBtn(function(){this._callbackThumbnail&&this._callbackThumbnail(i,e)}.bind(this)),this._listViewSelectThumbnail.setParameter("x",e.getCount()),this.drawWarehouseSelectSideView(e,this._listViewSelectThumbnail)}else this._root.redraw()}.bind(this))}},_onTapSellBtn:function(){var t=cc.instantiate(this._thumbnail.node).getComponent("WarehouseMaterialMatrixThumbnail");t.setParameter("x",this.commonCountView.getCountNum()),this._root.openStorageSellConfirmPopup(t.node,this._materialModel,this.commonCountView.getCountNum(),function(){var t=cc.instantiate(this._thumbnail.node).getComponent("WarehouseMaterialMatrixThumbnail");t.setParameter("x",this.commonCountView.getCountNum()),this._root.openStorageSellCompletePopup(t.node,this._materialModel,this.commonCountView.getCountNum(),void 0),this._root.reload(),this._root.redrawUIHeader();var e=this._root.getWarehouseUserItemModelMap()[this._root.getSelectedTab()],i=_.find(e,function(t){return t.getMaterialCd()===this._materialModel.getMaterialCd()}.bind(this));if(i){var a=this._listViewSelectThumbnail;a.setCallbackToThumbnailBtn(function(){this._callbackThumbnail&&this._callbackThumbnail(a,i)}.bind(this)),this._listViewSelectThumbnail.setParameter("x",i.getCount()),this.drawWarehouseSelectSideView(i,this._listViewSelectThumbnail)}else this._root.redraw()}.bind(this))}});cc._RF.pop()},{CharacterUtils:"CharacterUtils",CommonButton:"CommonButton",CommonCountView:"CommonCountView",CommonUtils:"CommonUtils",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",PopupUtils:"PopupUtils",WarehouseConst:"WarehouseConst",WarehouseSelectSideViewBase:"WarehouseSelectSideViewBase",WarehouseUtils:"WarehouseUtils"}],WarehouseSelectSideViewBase:[function(t,e,i){"use strict";cc._RF.push(e,"4ebbfaJTGRJJrn/LfHTX4RR","WarehouseSelectSideViewBase");var a=t("CommonButton");cc.Class({extends:cc.Component,properties:{thumbnailPrefab:cc.Prefab,thumbnailParentNode:cc.Node,itemNameLabel:cc.Label,searchBtn:a},_root:null,_thumbnail:null,onLoad:function(){this.searchBtn.setTapEvent(this._onTapSearcheBtn.bind(this))},initWarehouseSelectSideView:function(t){this._root=t,this._drawMatrixThumbnail(null),this.itemNameLabel.string="-",this._setActiveButtons(!1)},_setActiveSearchBtn:function(t){this.searchBtn.switchBtnImage(t),this.searchBtn.setTouchEnable(t)},drawWarehouseSelectSideView:function(t){cc.error("drawWarehouseSelectSideView() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_drawMatrixThumbnail:function(t){cc.error("_drawMatrixThumbnail() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_setActiveButtons:function(t){cc.error("_setActiveButtons() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")},_onTapSearcheBtn:function(){cc.error("_onTapTransitionBtn() \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u304f\u3060\u3055\u3044")}});cc._RF.pop()},{CommonButton:"CommonButton"}],WarehouseSelectSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"9962c8vgB5Fo43vV6xC8sI6","WarehouseSelectSubRoot");var a=t("WarehouseSelectTabView");cc.Class({extends:cc.Component,properties:{warehouseSelectTabView:a},initWarehouseSelectSubRoot:function(t,e){this.warehouseSelectTabView.initWarehouseSelectTabView(t,e)}});cc._RF.pop()},{WarehouseSelectTabView:"WarehouseSelectTabView"}],WarehouseSelectTabView:[function(t,e,i){"use strict";cc._RF.push(e,"adb76U94lBMgahyE2nQN/kC","WarehouseSelectTabView");var a=t("TabViewBase"),n=t("WarehouseListViewBase");cc.Class({extends:a,properties:{warehouseItemLiseViewArray:[n]},_root:null,initWarehouseSelectTabView:function(t,e){this._root=t,this.initTabViewBase(),this._setCurrentTab(e),this._activateTab(this.getCurrentTab())},_tabEvent:function(t,e,i){this._activateTab(e)},_resetTab:function(){for(var t in this.tabBtnArray)this.tabBtnArray[t].switchBtnImage(!1)},_activateTab:function(t){this._root.setSelectedTab(t),this._resetTab(),this.tabBtnArray[t].switchBtnImage(!0),this._switchTabContent(t)},_switchTabContent:function(t){this._resetListView(),this.warehouseItemLiseViewArray[t].initListView(this._root)},_resetListView:function(){for(var t in this.warehouseItemLiseViewArray)this.warehouseItemLiseViewArray[t].resetListView()}});cc._RF.pop()},{TabViewBase:"TabViewBase",WarehouseListViewBase:"WarehouseListViewBase"}],WarehouseService:[function(t,e,i){"use strict";cc._RF.push(e,"0bc68Mu+n1G5JavkHjcUA2o","WarehouseService");var a=t("BaseService"),n=t("ApiConstants");cc.Class({extends:a,getMaterialCount:function(t){this._requestCallApi(n.WAREHOUSE_MATERIAL_COUNT,{},function(e,i){return t(e?void 0:i)})},getMaterialList:function(t,e){var i={index:t};this._requestCallApi(n.WAREHOUSE_MATERIAL_LIST,i,function(t,i){return e(t?void 0:i)})},getCharacterCount:function(t){this._requestCallApi(n.WAREHOUSE_CHARACTER_COUNT,{},function(e,i){return t(e?void 0:i)})},getCharacterList:function(t,e){var i={index:t};this._requestCallApi(n.WAREHOUSE_CHARACTER_LIST,i,function(t,i){return e(t?void 0:i)})},getEquipmentCount:function(t){this._requestCallApi(n.WAREHOUSE_EQUIPMENT_COUNT,{},function(e,i){return t(e?void 0:i)})},getEquipmentList:function(t,e){var i={index:t};this._requestCallApi(n.WAREHOUSE_EQUIPMENT_LIST,i,function(t,i){return e(t?void 0:i)})},takeWarehouse:function(t,e,i,a){var o={warehouseType:t,code:e,count:i};this._requestCallApi(n.WAREHOUSE_TAKE,o,function(t,e){return a(t?void 0:e)})}});cc._RF.pop()},{ApiConstants:"ApiConstants",BaseService:"BaseService"}],WarehouseStorageSellCompletePopup:[function(t,e,i){"use strict";cc._RF.push(e,"d66b2ij8HlKkrvKeGJxejqd","WarehouseStorageSellCompletePopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=t("ItemUtils"),s=t("GameConst"),c=t("WarehouseConst");cc.Class({extends:a,properties:{topItemNameLabel:cc.Label,topSellCountLabel:cc.Label,topCurrencyNameLabel:cc.Label,topCurrencyCountLabel:cc.Label,thumbnailParentNode:cc.Node,midItemNameLabel:cc.Label,midItemCountBeforeLabel:cc.Label,midItemCountAfterLabel:cc.Label,mitCurrencyNameLabel:cc.Label,mitCurrencyCountBeforeLabel:cc.Label,mitCurrencyCountAfterLabel:cc.Label,okBtn:n},_callbackToOk:null,onLoad:function(){this.okBtn.setTapEvent(this._onTapOkBtn.bind(this))},openWarehouseStorageSellCompletePopup:function(t,e,i,a){this._callbackToOk=a,this._initThumbnail(t),this._initWarehouseStorageSellCompletePopup(e,i),this.open()},_initThumbnail:function(t){t.position=cc.v2(0,0),t.anchorX=.5,t.anchorY=.5,this.thumbnailParentNode.addChild(t)},_initWarehouseStorageSellCompletePopup:function(t,e){var i=r.getItemMaster(s.ITEM_ID_GOLD),a=r.getUserItemCount(s.ITEM_ID_GOLD);this.topItemNameLabel.string="["+t.getShortName()+"]",this.topSellCountLabel.string=o.convertToCommaDelimited(e),this.topCurrencyNameLabel.string="["+i.getName()+"]",this.topCurrencyCountLabel.string=o.convertToCommaDelimited(this._calcAdditionalCurrency(t.getSalePrice(),e));var n="";switch(t.getWarehouseType()){case c.WAREHOUSE_STORAGE_TYPE.CHARACTER:n="\u30e6\u30cb\u30c3\u30c8";break;case c.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:n="\u88c5\u5099";break;case c.WAREHOUSE_STORAGE_TYPE.MATERIAL:n="\u7d20\u6750"}this.midItemNameLabel.string=n+"["+t.getName()+"]",this.midItemCountBeforeLabel.string=o.convertToCommaDelimited(t.getCount()),this.midItemCountAfterLabel.string=o.convertToCommaDelimited(t.getCount()-e),this.mitCurrencyNameLabel.string="\u6240\u6301["+i.getName()+"]",this.mitCurrencyCountBeforeLabel.string=o.convertToCommaDelimited(parseInt(a-this._calcAdditionalCurrency(t.getSalePrice(),e))),this.mitCurrencyCountAfterLabel.string=o.convertToCommaDelimited(a)},_calcAdditionalCurrency:function(t,e){return t*e},_onTapOkBtn:function(){this._callbackToOk&&this._callbackToOk(),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",WarehouseConst:"WarehouseConst"}],WarehouseStorageSellConfirmPopup:[function(t,e,i){"use strict";cc._RF.push(e,"54da2WXkLBFIr6FkmdMzL3/","WarehouseStorageSellConfirmPopup");var a=t("PopupBase"),n=t("CommonButton"),o=t("CommonUtils"),r=t("ItemUtils"),s=t("GameConst"),c=t("WarehouseConst");cc.Class({extends:a,properties:{topItemNameLabel:cc.Label,topSellCountLabel:cc.Label,topCurrencyNameLabel:cc.Label,topCurrencyCountLabel:cc.Label,thumbnailParentNode:cc.Node,midItemNameLabel:cc.Label,midItemCountBeforeLabel:cc.Label,midItemCountAfterLabel:cc.Label,mitCurrencyNameLabel:cc.Label,mitCurrencyCountBeforeLabel:cc.Label,mitCurrencyCountAfterLabel:cc.Label,cancelBtn:n,sellBtn:n},_callbackToSell:null,onLoad:function(){this.cancelBtn.setTapEvent(this._onTapCancelBtn.bind(this)),this.sellBtn.setTapEvent(this._onTapSellBtn.bind(this))},openWarehouseStorageSellConfirmPopup:function(t,e,i,a){this._callbackToSell=a,this._initThumbnail(t),this._initWarehouseStorageSellConfirmPopup(e,i),this.open()},_initThumbnail:function(t){t.position=cc.v2(0,0),t.anchorX=.5,t.anchorY=.5,this.thumbnailParentNode.addChild(t)},_initWarehouseStorageSellConfirmPopup:function(t,e){var i=r.getItemMaster(s.ITEM_ID_GOLD),a=r.getUserItemCount(s.ITEM_ID_GOLD);this.topItemNameLabel.string="["+t.getShortName()+"]",this.topSellCountLabel.string=o.convertToCommaDelimited(e),this.topCurrencyNameLabel.string="["+i.getName()+"]",this.topCurrencyCountLabel.string=o.convertToCommaDelimited(this._calcAdditionalCurrency(t.getSalePrice(),e));var n="";switch(t.getWarehouseType()){case c.WAREHOUSE_STORAGE_TYPE.CHARACTER:n="\u30e6\u30cb\u30c3\u30c8";break;case c.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:n="\u88c5\u5099";break;case c.WAREHOUSE_STORAGE_TYPE.MATERIAL:n="\u7d20\u6750"}this.midItemNameLabel.string=n+"["+t.getName()+"]",this.midItemCountBeforeLabel.string=o.convertToCommaDelimited(t.getCount()),this.midItemCountAfterLabel.string=o.convertToCommaDelimited(t.getCount()-e),this.mitCurrencyNameLabel.string="\u6240\u6301["+i.getName()+"]",this.mitCurrencyCountBeforeLabel.string=o.convertToCommaDelimited(a),this.mitCurrencyCountAfterLabel.string=o.convertToCommaDelimited(parseInt(a+this._calcAdditionalCurrency(t.getSalePrice(),e)))},_calcAdditionalCurrency:function(t,e){return t*e},_onTapCancelBtn:function(){this.close()},_onTapSellBtn:function(){this._callbackToSell&&this._callbackToSell(),this.close()}});cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",ItemUtils:"ItemUtils",PopupBase:"PopupBase",WarehouseConst:"WarehouseConst"}],WarehouseUtils:[function(t,e,i){"use strict";cc._RF.push(e,"eabf2lL3adDTpB1Vf3jRQS2","WarehouseUtils");var a=t("Singleton"),n=t("ItemConst"),o=t("SceneConst"),r=t("GameConst"),s=t("WarehouseConst"),c=t("QuestUtils"),l=t("PopupUtils"),u=t("CharacterUtils"),h=t("EquipmentUtils"),d=t("EquipmentConst");function p(t){switch(t){case n.RAID_GACHA_TICKET:return o.SCENE.FILE_NAME.RAID_GACHA;default:return o.SCENE.FILE_NAME.GACHA}}function m(t){switch(t){case n.NORMAL_QUEST_SKIP_TICKET:return o.SCENE.FILE_NAME.NORMAL_QUEST;default:return""}}function g(t){switch(t){case n.NORMAL_QUEST_SKIP_TICKET:default:return}}function C(){var t={},e=a.dao.EquipmentExceedLimitMasters;for(var i in e){var n=e[i].getExceedLimitType();t[n]||(t[n]={});var o=e[i].getRarity();t[n][o]||(t[n][o]={});var r=e[i].getMaterialRarity();t[n][o][r]=e[i]}return t}function f(t){return Object.values(s.WAREHOUSE_STORAGE_MATERIAL_FILTER_GROUP_END).indexOf(t)>=0}function E(t){return Object.values(s.WAREHOUSE_STORAGE_CHARACTER_FILTER_GROUP_END).indexOf(t)>=0}function T(t){return Object.values(s.WAREHOUSE_STORAGE_EQUIPMENT_FILTER_GROUP_END).indexOf(t)>=0}e.exports={getWarehouseItemTransitionSceneName:function(t,e){switch(t){case n.ITEM_TYPE.GACHA_TICKET:case n.ITEM_TYPE.ANOTHER_GACHA_TICKET:return p(e);case n.ITEM_TYPE.SKIP_TICKET:return m(e);default:return""}},getWarehouseItemTransitionParam:function(t,e){switch(t){case n.ITEM_TYPE.GACHA_TICKET:case n.ITEM_TYPE.ANOTHER_GACHA_TICKET:return;case n.ITEM_TYPE.SKIP_TICKET:return g(e);default:return}},getWarehouseItemTransitionText:function(t){switch(t){case n.ITEM_TYPE.GACHA_TICKET:case n.ITEM_TYPE.ANOTHER_GACHA_TICKET:return"\u30ac\u30c1\u30e3\u3092\u5f15\u304d\u306b\u884c\u304f";case n.ITEM_TYPE.SKIP_TICKET:return"\u30af\u30a8\u30b9\u30c8\u3078\u884c\u304f";default:return"\u30a2\u30a4\u30c6\u30e0\u3092\u4f7f\u7528\u3059\u308b"}},getStageMasterArrayByDropItemId:function(t,e){var i=a.dao.QuestDropMasters.filter(function(i){return i.getItemId()===t&&i.getItemType()===e}),n=c.createReleaseUserStageFlatMap();return a.dao.QuestStageMasters.filter(function(t){return!!n[t.getStageId()]&&!!i.find(function(e){return e.getStageId()===t.getStageId()})})},checkWarehouseTakeCharacterStorageByUserItemsCondition:function(){return!(u.getPlayableUserCharacterModelArray().length>=a.dao[a.USER].userData.getCharacterMaxCount()&&(l.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),1))},checkWarehouseTakeEquipmentStorageByUserItemsCondition:function(){return!(h.getPlayableUserEquipmentModelArray().length>=a.dao[a.USER].userData.getEquipmentMaxCount()&&(l.openSimpleMessageWindow("\u88c5\u5099\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),1))},checkWarehouseTakeMaterialStorageByUserItemsCondition:function(t){return t===s.MATERIAL_CATEGORY.CHARACTER&&u.getNonPlayableUserCharacterModelArray().length>=r.MAX_MATERIAL_COUNT?(l.openSimpleMessageWindow("\u30e6\u30cb\u30c3\u30c8\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),!1):!(t===s.MATERIAL_CATEGORY.EQUIPMENT&&h.getNonPlayableUserEquipmentModelArray().length>=r.MAX_MATERIAL_COUNT&&(l.openSimpleMessageWindow("\u88c5\u5099\u7528\u7d20\u6750\u304c\u6240\u6301\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002"),1))},getEquipmentExceedLimitMaterials:function(t,e){var i=C();switch(e){case s.WAREHOUSE_STORAGE_TYPE.EQUIPMENT:if(Array.isArray(a.dao.warehouseEquipments))return _.filter(a.dao.warehouseEquipments,function(e){return e.getCount()>0&&e.getEquipmentId()===t.getEquipmentId()&&i[t.getExceedLimitType()][t.getRarity()][e.getRarity()]});break;default:if(Array.isArray(a.dao.warehouseMaterials))return _.filter(a.dao.warehouseMaterials,function(e){var a=Math.min(e.getRarity()+e.getExceedLimit(),d.RARITY.SSR);return e.getCount()>0&&e.getMaterialType()===n.EQUIPMENT_TYPE.EXCEED_LIMIT_MATERIAL&&i[t.getExceedLimitType()][t.getRarity()][a]})}return[]},convertSortTypeToTextForMaterial:function(t){switch(t){case s.WAREHOUSE_STORAGE_SORT_TYPE.UPDATING:return"\u66f4\u65b0\u9806";case s.WAREHOUSE_STORAGE_SORT_TYPE.NUMBER:return"No\u9806";case s.WAREHOUSE_STORAGE_SORT_TYPE.ATTRIBUTE:return"\u5c5e\u6027\u9806";case s.WAREHOUSE_STORAGE_SORT_TYPE.RARITY:return"\u30ec\u30a2\u5ea6\u9806"}return""},createSortConditionsForMaterial:function(t,e){var i=[];return i.push({getterName:s.WAREHOUSE_STORAGE_SORT_PROPERTY_NAME[Object.keys(s.WAREHOUSE_STORAGE_SORT_TYPE)[t]],order:e}),i.push({getterName:"getMaterialId"}),i},createFilterConditionsForMaterial:function(t){for(var e=[],i=s.WAREHOUSE_STORAGE_MATERIAL_PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:s.WAREHOUSE_STORAGE_MATERIAL_FILTER_FUNC_NAME[Object.keys(s.WAREHOUSE_FILTER_TYPE)[o]]}),f(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},createSortConditionsForCharacter:function(t,e){var i=[];return i.push({getterName:s.WAREHOUSE_STORAGE_CHARACTER_SORT_PROPERTY_NAME[Object.keys(s.WAREHOUSE_STORAGE_CHARACTER_SORT_TYPE)[t]],order:e}),i.push({getterName:"getCharacterId"}),i.push({getterName:"getExceedLimit"}),i},createFilterConditionsForCharacter:function(t){for(var e=[],i=s.WAREHOUSE_STORAGE_CHARACTER_PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:s.WAREHOUSE_STORAGE_CHARACTER_FILTER_FUNC_NAME[Object.keys(s.WAREHOUSE_STORAGE_CHARACTER_FILTER_TYPE)[o]]}),E(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e},createSortConditionsForEquipment:function(t,e){var i=[];return i.push({getterName:s.WAREHOUSE_STORAGE_EQUIPMENT_SORT_PROPERTY_NAME[Object.keys(s.WAREHOUSE_STORAGE_EQUIPMENT_SORT_TYPE)[t]],order:e}),i.push({getterName:"getEquipmentId"}),i.push({getterName:"getExceedLimit"}),i},createFilterConditionsForEquipment:function(t){for(var e=[],i=s.WAREHOUSE_STORAGE_EQUIPMENT_PROPERTY_NAME,a=!0,n=[],o=0;o<t.length;o+=1)t[o]?a=!1:n.push({propertyName:i,getterName:s.WAREHOUSE_STORAGE_EQUIPMENT_FILTER_FUNC_NAME[Object.keys(s.WAREHOUSE_STORAGE_EQUIPMENT_FILTER_TYPE)[o]]}),T(o)&&(a||(e=e.concat(n)),a=!0,n=[]);return e}},cc._RF.pop()},{CharacterUtils:"CharacterUtils",EquipmentConst:"EquipmentConst",EquipmentUtils:"EquipmentUtils",GameConst:"GameConst",ItemConst:"ItemConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",SceneConst:"SceneConst",Singleton:"Singleton",WarehouseConst:"WarehouseConst"}],WarehouseViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"1f2aeMCxdhMNLeTvntaJCDX","WarehouseViewSetting");var a=t("WarehouseRootUtils");e.exports={WAREHOUSE_SETTING:{WarehouseSelectSubRoot:{open:a.openWarehouseSelectSubRoot,close:a.closeWarehouseSelectSubRoot}}},cc._RF.pop()},{WarehouseRootUtils:"WarehouseRootUtils"}],WeekRootUtils:[function(t,e,i){"use strict";cc._RF.push(e,"e3da1+/7TZB/5H9sxN2IgFV","WeekRootUtils");var a=t("Singleton"),n=t("QuestUtils"),o=t("GameConst"),r=t("WeekTopSubRoot"),s=t("BattleStartConfirmSubRoot");e.exports={openWeekTopSubRoot:function(t,e){cc.log("openWeekTopSubRoot"),cc.log(e);var i=n.getUserWorldArrayByWorldCategory(o.WORLD_CATEGORY.WEEK)[0].getWorldId();t.setListViewParam(i,e.areaId,e.stageId,t.selectDifficult),void 0===t.weekTopSubRoot||null===t.weekTopSubRoot?(t.weekTopSubRoot=cc.instantiate(t.weekTopSubRootPrefab).getComponent(r),t.subRootParent.addChild(t.weekTopSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),t.weekTopSubRoot.initWeekTopSubRoot(t,e.areaId)},closeWeekTopSubRoot:function(t,e){cc.log("closeWeekTopSubRoot"),cc.log(e),t.weekTopSubRoot&&(t.weekTopSubRoot.node.destroy(),t.weekTopSubRoot=null)},openBattleStartConfirmSubRoot:function(t,e){cc.log("openBattleStartConfirmSubRoot"),cc.log(e);var i=parseInt(e.stageId,10);t.setListViewParam(t.selectWorldId,t.selectAreaId,e.stageId,t.selectDifficult);for(var n=0;n<a.dao.userQuests.length;n++)if(a.dao.userQuests[n].userData._data.stageId===i){t.openStageQuestModel=a.dao.userQuests[n];break}void 0===t.battleStartConfirmSubRoot||null===t.battleStartConfirmSubRoot?(t.battleStartConfirmSubRoot=cc.instantiate(t.battleStartConfirmSubRootPrefab).getComponent(s),t.battleStartConfirmSubRoot.initBattleStartConfirmSubRoot(t,t.openStageQuestModel),t.subRootParent.addChild(t.battleStartConfirmSubRoot.node)):cc.log("View\u304c\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002")},closeBattleStartConfirmSubRoot:function(t,e){cc.log("closeBattleStartConfirmSubRoot"),cc.log(e),t.battleStartConfirmSubRoot&&(t.battleStartConfirmSubRoot.node.destroy(),t.battleStartConfirmSubRoot=null)}},cc._RF.pop()},{BattleStartConfirmSubRoot:"BattleStartConfirmSubRoot",GameConst:"GameConst",QuestUtils:"QuestUtils",Singleton:"Singleton",WeekTopSubRoot:"WeekTopSubRoot"}],WeekRoot:[function(t,e,i){"use strict";cc._RF.push(e,"1efdfy2aStCf5HpNrTcqLrh","WeekRoot");var a=t("QuestRootBase"),n=(t("Singleton"),t("LocalDataConst"),t("QuestUtils")),o=t("SceneConst"),r=(t("ResourceUtils"),t("ResourceConst"),t("WeekViewSetting"));cc.Class({extends:a,properties:{weekTopSubRootPrefab:cc.Prefab,questFreeUnlockPopupPrefab:cc.Prefab,questItemUnlockPopupPrefab:cc.Prefab},weekTopSubRoot:null,_questFreeUnlockPopup:null,_questItemUnlockPopup:null,callSceneTargetListener:function(t){this.callSceneTargetListenerBase(t,r.WEEK_SETTING)},initialize:function(){this._initOpenFirstView({WeekTopSubRoot:{}})},createPreViewParam:function(){var t={};return this.weekTopSubRoot&&(t.WeekTopSubRoot=this.getListViewParam()),this.battleStartConfirmSubRoot&&(t.BattleStartConfirmSubRoot=this.getListViewParam()),t},pushStageScrollView:function(t){var e={WeekTopSubRoot:{worldId:this.selectWorldId,areaId:t}},i={WeekTopSubRoot:{worldId:this.selectWorldId}};this.pushScene(this.getCurrentSceneName(),this.getCurrentSceneName(),e,i)},pushBattleStartConfirmSubRoot:function(t,e){var i={BattleStartConfirmSubRoot:{stageId:t}},a={WeekTopSubRoot:{worldId:n.getAreaMasterByAreaId(e).getWorldId(),areaId:e}};t&&e?(cc.log(this.getCurrentSceneName()),this.pushScene(o.SCENE.FILE_NAME.WEEK,this.getCurrentSceneName(),i,a)):cc.error("stageId\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")},questRootPopClose:function(){this.popScene()},openQuestFreeUnlockPopup:function(t,e,i,a,n,o){this.closeQuestFreeUnlockPopup(),this._questFreeUnlockPopup=cc.instantiate(this.questFreeUnlockPopupPrefab).getComponent("QuestFreeUnlockPopup"),this._questFreeUnlockPopup.openQuestFreeUnlockPopup(this,t,e,i,a,n,o)},closeQuestFreeUnlockPopup:function(){this._questFreeUnlockPopup&&(this._questFreeUnlockPopup.close(),this._questFreeUnlockPopup=null)},openQuestItemUnlockPopup:function(t,e,i,a,n,o){this.closeQuestItemUnlockPopup(),this._questItemUnlockPopup=cc.instantiate(this.questItemUnlockPopupPrefab).getComponent("QuestItemUnlockPopup"),this._questItemUnlockPopup.openQuestItemUnlockPopup(this,t,e,i,a,n)},closeQuestItemUnlockPopup:function(){this._questItemUnlockPopup&&(this._questItemUnlockPopup.close(),this._questItemUnlockPopup=null)}}),cc._RF.pop()},{LocalDataConst:"LocalDataConst",QuestRootBase:"QuestRootBase",QuestUtils:"QuestUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",SceneConst:"SceneConst",Singleton:"Singleton",WeekViewSetting:"WeekViewSetting"}],WeekTopSubRoot:[function(t,e,i){"use strict";cc._RF.push(e,"ef468ImsAhKe77LtNKDsPmw","WeekTopSubRoot");var a=t("QuestAreaStageSelectSubRoot"),n=t("AreaWeekThumbnailView"),o=t("QuestUtils"),r=(t("DeckUtils"),t("Singleton"),t("LocalDataConst"),t("CharacterUtils"),t("ViewUtils")),s=t("GameConst");cc.Class({extends:a,properties:{questAreaStageViewPrefab:cc.Prefab,areaWeekThumbnailViewPrefab:cc.Prefab},_selectedAreaId:0,initWeekTopSubRoot:function(t,e){this._root=t,this._selectedWorldId=o.getUserWorldArrayByWorldCategory(s.WORLD_CATEGORY.WEEK)[0].getWorldId(),this._selectedAreaId=e,this._root.selectDifficult=s.QUEST_DIFFICULT.NORMAL.NORMAL,this._questNormalExTabView||(this._questNormalExTabView=cc.instantiate(this.questNormalExTabViewPrefab).getComponent("QuestNormalExTabView"),this.node.addChild(this._questNormalExTabView.node));var i=o.getUserQuestDifficultMapByWorldId(this._selectedWorldId,s.QUEST_DIFFICULT.NORMAL.EX),a=Object.keys(i).length>0,n=o.isAreaDifficultByWorldId(this._selectedWorldId,s.QUEST_DIFFICULT.NORMAL.EX);this._questNormalExTabView.initQuestNormalExTabView(t,n,a),this._questUserMap=o.getUserQuestMapByWorldId(this._selectedWorldId),this._initCharacterStandView(),this._reloadCharacterStandImage(),this._serifBalloon||(this._serifBalloon=r.createSerifWindow(),this.serifWindowPos.addChild(this._serifBalloon.node)),this._reloadSerifBalloon(),this._root.redrawBackGround(this._selectedWorldId)},initAreaScrollView:function(t){t||(t=s.QUEST_DIFFICULT.NORMAL.NORMAL),this._questNormalExTabView.initAreaScrollView(this._root,o.getUserQuestDifficultMapByWorldId(this._selectedWorldId,t),"\u30af\u30a8\u30b9\u30c8\u9078\u629e",this._createAreaWeekThumbnail.bind(this))},initStageScrollView:function(t,e){e||(e=s.QUEST_DIFFICULT.NORMAL.NORMAL);var i=o.getAreaMasterByAreaId(t);this._questNormalExTabView.initStageScrollView(this._root,t,o.getUserQuestDifficultMapByWorldId(this._selectedWorldId,e),i.getName())},_createAreaWeekThumbnail:function(t,e){var i=cc.instantiate(this.areaWeekThumbnailViewPrefab).getComponent(n);return i.initAreaWeekThumbnailView(this._root,e,t.getAreaId(),t),i.node}}),cc._RF.pop()},{AreaWeekThumbnailView:"AreaWeekThumbnailView",CharacterUtils:"CharacterUtils",DeckUtils:"DeckUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",QuestAreaStageSelectSubRoot:"QuestAreaStageSelectSubRoot",QuestUtils:"QuestUtils",Singleton:"Singleton",ViewUtils:"ViewUtils"}],WeekViewSetting:[function(t,e,i){"use strict";cc._RF.push(e,"c5b28/DWW5LyJ+osON9A1ZJ","WeekViewSetting");var a=t("WeekRootUtils");e.exports={WEEK_SETTING:{WeekTopSubRoot:{open:a.openWeekTopSubRoot,close:a.closeWeekTopSubRoot},BattleStartConfirmSubRoot:{open:a.openBattleStartConfirmSubRoot,close:a.closeBattleStartConfirmSubRoot}}},cc._RF.pop()},{WeekRootUtils:"WeekRootUtils"}],WindowBase:[function(t,e,i){"use strict";cc._RF.push(e,"ed1996zHvpINoDMkTlveqyT","WindowBase");cc.Class({extends:cc.Component,properties:{windowNode:cc.Node},_openWindowBase:function(){this.node.active=!0},_closeWindowBase:function(){this.node.destroy()},open:function(){this._openWindowBase()},close:function(){this._closeWindowBase()}});cc._RF.pop()},{}],WorldPageScrollView:[function(t,e,i){"use strict";cc._RF.push(e,"3a703r5kxdN3KAb7BISpBoA","WorldPageScrollView");var a=t("CommonButton"),n=t("QuestUtils"),o=t("WorldThumbnailView"),r=t("RollView");cc.Class({extends:r,properties:{worldSelectLeftBtn:a,worldSelectRightBtn:a,unrollContent:cc.Node,worldThumbnailViewPrefab:cc.Prefab},_worldScrollViewArray:null,_worldIdArray:null,_userWorldIdArray:null,_worldMasterMap:null,_userWorldMasterMap:null,_root:null,_worldView:null,_bWorldViewState:!1,initWorldPageScrollView:function(t,e,i,a){this._root=t,this._worldSelectLeftBtn(),this._worldSelectRightBtn(),this._worldView=e,this._worldIdArray=i,this._userWorldIdArray=a,this._worldScrollViewArray=[],this._bWorldViewState=!0,this._initWorldThumbnailArray(t)},_initWorldThumbnailArray:function(t){this._worldScrollViewArray=[],this._worldMasterMap={},this._userWorldMasterMap={},this._worldIdArray.forEach(function(t){this._worldMasterMap[t]=n.getWorldMasterByWorldId(t)}.bind(this)),this._userWorldIdArray.forEach(function(t){this._userWorldMasterMap[t]=n.getWorldMasterByWorldId(t)}.bind(this)),this._getVisibleWorldIdCount()>=5?this._createRollView(t):(this._createNoRollView(t),this.worldSelectLeftBtn.node.active=!1,this.worldSelectRightBtn.node.active=!1),this.setLoopRollChangeCallFunc(function(){this.worldSelectRightBtn.node.active=!0,this.worldSelectLeftBtn.node.active=!0,this.getSelectedNo()<=0?this.worldSelectLeftBtn.node.active=!1:this.getSelectedNo()>=this.content.childrenCount&&(this.worldSelectRightBtn.node.active=!1)}.bind(this))},_getVisibleWorldIdCount:function(){var t=0;return t=this._userWorldIdArray.length,this._userWorldIdArray.length<this._worldIdArray.length&&(t+=1),t},_touchEndEvent:function(t){var e=this.node.convertToNodeSpace(t.getStartLocation()),i=this.node.convertToNodeSpace(t.getLocation());this._bSwipeRight=i.x-e.x>0;for(var a=0;a<this._worldScrollViewArray.length;a+=1)this._worldScrollViewArray[a].node.stopAllActions(),this._worldScrollViewArray[a].node.runAction(cc.scaleTo(.2,1))},_adjustContent:function(){var t=this.pagingWidth*(this.content.childrenCount-1),e=parseInt(this._viewX)%this.pagingWidth,i=!1;if(0-this._viewX>this.pagingWidth?i=!0:this._viewX-t>this.pagingWidth&&(i=!0),i||0!==e)if(this._viewX>t)this._viewX+=.06*(t-this._viewX);else if(this._viewX<0)this._viewX+=.06*(0-this._viewX);else{(this._bSwipeRight?this.pagingWidth-e<this.pagingWidth/4:e>=this.pagingWidth/4)?this._viewX+=(this.pagingWidth-e)/4:this._viewX-=e/4}},_createWorldThumbnailView:function(t,e,i){var a=cc.instantiate(this.worldThumbnailViewPrefab).getComponent(o);return this._worldScrollViewArray.push(a),a.initWorldThumbnailView(t,this,e,i,this._worldScrollViewArray.length),a.node},_createRollView:function(t){for(var e=null,i=0,a=0;a<this._userWorldIdArray.length;a+=1)i=this._userWorldIdArray[a],e=this._createWorldThumbnailView(t,this._userWorldMasterMap[i],!0),this.content.addChild(e);this._userWorldIdArray.length<this._worldIdArray.length&&(i=this._worldIdArray[this._userWorldIdArray.length],e=this._createWorldThumbnailView(t,this._worldMasterMap[i],!1),this.content.addChild(e))},_createNoRollView:function(t){var e=null,i=0;if(this._worldIdArray.length>this._userWorldIdArray.length){this._userWorldIdArray.length;for(var a=0;a<this._userWorldIdArray.length;a+=1)i=this._userWorldIdArray[a],e=this._createWorldThumbnailView(t,this._userWorldMasterMap[i],!0),this.unrollContent.addChild(e);this._userWorldIdArray.length<this._worldIdArray.length&&(i=this._worldIdArray[this._userWorldIdArray.length],e=this._createWorldThumbnailView(t,this._worldMasterMap[i],!1),this.unrollContent.addChild(e))}else for(a=0;a<this._userWorldIdArray.length;a+=1)i=this._userWorldIdArray[a],e=this._createWorldThumbnailView(t,this._userWorldMasterMap[i],!0),this.unrollContent.addChild(e)},_worldSelectLeftBtn:function(){this.worldSelectLeftBtn.setTapEvent(function(){this.moveToLeft()}.bind(this),a.SE_NAME.COUNT)},_worldSelectRightBtn:function(){this.worldSelectRightBtn.setTapEvent(function(){this.moveToRight()}.bind(this),a.SE_NAME.COUNT)},initTags:function(){for(var t=0;t<this._worldScrollViewArray.length;t+=1)this._worldScrollViewArray[t].initTags()}}),cc._RF.pop()},{CommonButton:"CommonButton",QuestUtils:"QuestUtils",RollView:"RollView",WorldThumbnailView:"WorldThumbnailView"}],WorldThumbnailView:[function(t,e,i){"use strict";cc._RF.push(e,"0feb80uKN1MIZgtcUrCw22v","WorldThumbnailView");var a=t("Singleton"),n=t("ResourceUtils"),o=t("CommonButton"),r=t("PopupUtils"),s=t("QuestUtils"),c=t("CommonUtils"),l=t("UnlockEffectUtils"),u=(t("ResourceConst"),t("GameConst")),h=t("UnlockEffectConst"),d=t("LocalDataConst");cc.Class({extends:cc.Component,properties:{worldNumberLabel:cc.Label,worldNameLabel:cc.Label,lockLayerNode:cc.Node,lockIconNode:cc.Node,worldSelectButton:o,worldSprite:cc.Sprite,newNode:cc.Node,completeNode:cc.Node,campaignNode:cc.Node,messageWindow:cc.Prefab,progressCount:cc.Label},_root:null,_worldScrollView:null,_worldMaster:null,_worldNumber:null,initWorldThumbnailView:function(t,e,i,a,o){this._root=t,this._worldScrollView=e,this._worldMaster=i,this._worldNumber=o,this.worldNumberLabel.string="\u7b2c"+o+"\u7ae0",this.worldNameLabel.string=i.getName(),this._setButtonEvent(a),c.loadLocalStorage(h.TRIGGER_PREFIX_NAME.NORMAL_WORLD+i.getWorldId(),!1,d.LOCAL_STORAGE_GET_TYPE.BOOLEAN)?(c.removeLocalStorage(h.TRIGGER_PREFIX_NAME.NORMAL_WORLD+i.getWorldId()),this.lockLayerNode.active=a,l.playUnLockEffectAnimationNormal(this.lockIconNode,function(){this.lockLayerNode.active=!a}.bind(this))):this.lockLayerNode.active=!a,n.addSprite(this.worldSprite,n.getFileNameWorldThumbnail(i.getWorldId()))},_setButtonEvent:function(t){t?this.worldSelectButton.setTapEvent(function(){this._root.setSelectedWorldId(this._worldMaster.getWorldId()),this._root.pushQuestAreaStageSelectSubRoot()}.bind(this)):this.worldSelectButton.setTapEvent(function(){r.openSimpleMessageWindow("\u7b2c"+(this._worldNumber-1)+"\u7ae0\u30af\u30ea\u30a2\u3067\u958b\u653e\u3055\u308c\u307e\u3059\u3002"),this.node.runAction(cc.scaleTo(.2,1))}.bind(this)),this.worldSelectButton.setTouchStartEvent(function(){this.node.runAction(cc.scaleTo(.2,.95))}.bind(this)),this.worldSelectButton.setTouchCancelEvent(function(){this.node.runAction(cc.scaleTo(.2,1))}.bind(this))},initTags:function(){this._initCampaignTag(),this._initNewTag(),this._initCompleteTag(),this._initProgressCountTag()},_initCampaignTag:function(){this._isWorldCampaign()?this.campaignNode.active=!0:this.campaignNode.active=!1},_isWorldCampaign:function(){var t=this._worldMaster.getWorldId();return!!s.getCampaignMasterArray().find(function(e){var i=!!e.getTargetIds().split(",").find(function(e){return parseInt(s.getAreaMasterByAreaId(parseInt(e)).getWorldId())===t});return 2===e.getTargetType()&&i&&e.getCampaignType()<6})},_initNewTag:function(){this.newNode.active=!1,this.lockLayerNode.active||this._isNewWorld()&&(this.newNode.active=!0)},_isNewWorld:function(){for(var t=this._worldMaster.getWorldId(),e=a.dao[a.USER_QUEST].filter(function(e){return e.getQuestStageMaster().getWorldId()===t}),i=0;i<e.length;i+=1){if(!s.getStageStatus(e[i]).newLabel)return!1}return!0},_initCompleteTag:function(){this.completeNode.active=!1,this.lockLayerNode.active||this._isCompleteWorld()&&(this.completeNode.active=!0)},_isCompleteWorld:function(){for(var t=this._worldMaster.getWorldId(),e=a.dao[a.USER_QUEST].filter(function(e){return e.getQuestStageMaster().getWorldId()===t}),i=0;i<e.length;i+=1){if(!s.getStageStatus(e[i]).completeLabel)return!1}return!0},_initProgressCountTag:function(){this.progressCount.node.parent.active=!1,this.lockLayerNode.active||(this._setProgressCount(),this.progressCount.node.parent.active=!0)},_setProgressCount:function(){var t=this._worldMaster.getWorldId(),e=u.QUEST_DIFFICULT.NORMAL.NORMAL,i=s.getStageCountByWorldIdAndDifficult(t,e),a=s.getUserStageClearCountByWorldIdAndDifficult(t,e);this.progressCount.string="\u9032\u884c\u5ea6 "+a+"/"+i}}),cc._RF.pop()},{CommonButton:"CommonButton",CommonUtils:"CommonUtils",GameConst:"GameConst",LocalDataConst:"LocalDataConst",PopupUtils:"PopupUtils",QuestUtils:"QuestUtils",ResourceConst:"ResourceConst",ResourceUtils:"ResourceUtils",Singleton:"Singleton",UnlockEffectConst:"UnlockEffectConst",UnlockEffectUtils:"UnlockEffectUtils"}],WrapAsyncFileLoad:[function(t,e,i){"use strict";cc._RF.push(e,"eecbdB0/QFEKab6FzrsZdCB","WrapAsyncFileLoad");var a=t("AsyncFileLoader"),n=cc.Class({async:null,filePath:"",encodeFlg:!1,errorMessage:"",isSkipped:!1,ctor:function(){this._super(),this.encodeFlg=!1,this.isSkipped=!1,this.async=null},loadFile:function(t,e){0==arguments.length&&(t=this.filePath,e=this.encodeFlg),CCLog("WrapAsyncFileLoad.loadFile path="+t),this.encodeFlg=e,this.filePath=t;var i=this.getFullpath(t);this.async=new AsyncFileLoad,this.async.loadFile(i,t,this)},getFullpath:function(t){VersionInfoList.shared().getVersion(F_CDN);var e=DOWNLOAD_PATH;return"res/"==t.substring(0,4)?t:e+t},isFinished:function(){return!!this.isSkipped||!!this.async&&this.async.isFinished()},isError:function(){return!this.isSkipped&&(!!this.async&&(!!this.isConnect()&&this.async.isError()))},retry:function(){var t=this.getFullpath(this.filePath);this.abort(),this.async=new a,this.async.loadFile(t,this.filePath,this)},isConnect:function(){return!!this.async&&this.async.isConnect()},isImage:function(){return this.async.isImage()},getFilepath:function(){return this.filePath},abort:function(){},setFilePath:function(t){this.filePath=t},setEncodeFlg:function(t){this.encodeFlg=t},getEncodeFlg:function(){return this.encodeFlg},connectionDidFinishLoading:function(){var t,e=this.async.getLength();this.getData();t=new String,this.encodeFlg&&(t=FileCrypt.shared().encode(t,e));var i=CommonUtils.getFileName(this.filePath);this.writeFile(i,t,e)},connectionDidFailWithError:function(t){this.errorMessage=t},writeFile:function(t,e,i){},getErrorMessage:function(){return this.errorMessage},getData:function(){return this.async.getData()}});e.exports=n,cc._RF.pop()},{AsyncFileLoader:"AsyncFileLoader"}],buffNumberShow:[function(t,e,i){"use strict";cc._RF.push(e,"bac4753FglHDaB1G6LjDRV5","buffNumberShow");var a=t("EffectEnd");cc.Class({extends:a,properties:{firstSpineNode:cc.Node,mainAnim:cc.Animation,endInvoked:!1},onDestroy:function(){!this.endInvoked&&this.endAction&&this.doEffectEnd()},init:function(t,e,i,a){var n=this.node.getComponentsInChildren(cc.Animation);for(var o in n){n[o].defaultClip.speed=e}var r=this.node.getComponentsInChildren(sp.Skeleton);for(var o in r){r[o].timeScale=e}if(this.mainAnim.play(),i){var s=[];s.push(cc.delayTime(i)),s.push(cc.callFunc(this.doEffectEnd,this));var c=cc.sequence(s);this.node.runAction(c)}this.endAction=a},firstSpineOn:function(){this.firstSpineNode.active=!0},doEffectEnd:function(){!this.endInvoked&&this.endAction&&(this.endInvoked=!0,this.endAction())}}),cc._RF.pop()},{EffectEnd:"EffectEnd"}],damageShow:[function(t,e,i){"use strict";cc._RF.push(e,"a92f4tT3GdIcKmwwbIrqg/0","damageShow"),cc.Class({extends:cc.Component,properties:{endAction:{default:null},damageNumLayoutNode:cc.Node,numSprites:[cc.Sprite],damageShowAnim:cc.Animation,damageTextNode:cc.Node,ailmentNode:cc.Node},reuse:function(t){this.pool=t},init:function(t,e,i,a,n,o,r){for(var s=[],c=Math.pow(10,this.numSprites.length-1),l=t,u=!1;c>0;){var h=parseInt(l/c),d=l%c;u?s.push(h):h>0&&(s.push(h),u=!0),l=d,c=parseInt(c/10)}this.damageNumLayoutNode.setAnchorPoint(n);for(var p=0;p<s.length;p++){this.numSprites[p].spriteFrame=e[s[p]],this.numSprites[p].node.parent.active=!0,this.numSprites[p].node.active=!0;var m=this._createJumpAnimation(this.numSprites[p].node,p,s.length);this.numSprites[p].node.runAction(m)}r(),this.damageTextNode.setAnchorPoint(n),this.damageTextNode.setPosition(a),this.damageTextNode.getComponent(cc.Sprite).spriteFrame=i,this.damageTextNode.getComponent(cc.Animation).play()},_createJumpAnimation:function(t,e,i){var a=cc.delayTime(.05*e),n=cc.fadeIn(0),o=cc.jumpTo(.2,0,0,20,1),r=cc.jumpTo(.1,0,0,10,1),s=cc.delayTime(.2*(i-e)),c=cc.fadeOut(.1);return cc.sequence(a,n,o,r,s,c)},doEffectEnd:function(){void 0!=this.pool&&this.pool.put(this.node),void 0!==this.endAction&&this.endAction()}}),cc._RF.pop()},{}],healShow:[function(t,e,i){"use strict";cc._RF.push(e,"f77b6mkpSJHSbVCIRiIzIlI","healShow"),cc.Class({extends:cc.Component,properties:{endAction:{default:null},numLayoutNode:cc.Node,numSprites:[cc.Sprite],healShowAnim:cc.Animation},init:function(t,e,i,a,n){for(var o=[],r=Math.pow(10,this.numSprites.length-1),s=t,c=!1;r>0;){var l=parseInt(s/r),u=s%r;c?o.push(l):l>0&&(o.push(l),c=!0),s=u,r=parseInt(r/10)}this.numLayoutNode.setAnchorPoint(i);for(var h=0;h<o.length;h++){this.numSprites[h].spriteFrame=e[o[h]],this.numSprites[h].node.parent.active=!0,this.numSprites[h].node.active=!0;var d=this._createJumpAnimation(this.numSprites[h].node,h,o.length);this.numSprites[h].node.runAction(d)}n()},_createJumpAnimation:function(t,e,i){var a=cc.delayTime(.05*e),n=cc.fadeIn(0),o=cc.jumpTo(.2,0,0,20,1),r=cc.jumpTo(.1,0,0,10,1),s=cc.delayTime(.2*(i-e)),c=cc.fadeOut(.1);return cc.sequence(a,n,o,r,s,c)},doEffectEnd:function(){void 0!==this.pool&&this.pool.put(this.node),void 0!==this.endAction&&this.endAction()}}),cc._RF.pop()},{}],shaderCode_GaussBlurs:[function(t,e,i){"use strict";cc._RF.push(e,"e7f2bdtmPJBzrvSlxEMasdz","shaderCode_GaussBlurs");e.exports={blurs_vert:"\n    attribute vec4 a_position;\n    attribute vec2 a_texCoord;\n    attribute vec4 a_color;\n    varying vec2 v_texCoord;\n    varying vec4 v_fragmentColor;\n    void main()\n    {\n        gl_Position = CC_PMatrix * a_position;\n        v_fragmentColor = a_color;\n        v_texCoord = a_texCoord;\n    }\n    ",blurs_frag:"\n    #ifdef GL_ES\n    precision mediump float;\n    #endif\n    uniform float bluramount;\n    varying vec2 v_texCoord;\n    vec4 draw(vec2 uv) {\n    return texture2D(CC_Texture0,uv).rgba; \n    }\n    float grid(float var, float size) {\n    return floor(var*size)/size;\n    }\n    float rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n    }\n    void mainImage( out vec4 fragColor, in vec2 fragCoord )\n    {\n    vec2 uv = v_texCoord.xy;\n    vec4 blurred_image = vec4(0.);\n    #define repeats 5.\n    for (float i = 0.; i < repeats; i++) { \n    vec2 q = vec2(cos(degrees((i/repeats)*360.)),sin(degrees((i/repeats)*360.))) * (rand(vec2(i,uv.x+uv.y))+bluramount); \n    vec2 uv2 = uv+(q*bluramount);\n    blurred_image += draw(uv2)/2.;\n    q = vec2(cos(degrees((i/repeats)*360.)),sin(degrees((i/repeats)*360.))) * (rand(vec2(i+2.,uv.x+uv.y+24.))+bluramount); \n    uv2 = uv+(q*bluramount);\n    blurred_image += draw(uv2)/2.;\n    }\n    blurred_image /= repeats;\n    fragColor = vec4(blurred_image);\n    }\n    void main()\n    {\n    mainImage(gl_FragColor, gl_FragCoord.xy);\n    }\n    "},cc._RF.pop()},{}],skillShow:[function(t,e,i){"use strict";cc._RF.push(e,"4d903LkTXNB8IxJG0vdzFQO","skillShow"),cc.Class({extends:cc.Component,properties:{endAction:{default:null},skillText:cc.Label},reuse:function(t){this.pool=t},init:function(t,e){e(),this.endAction=null,this.skillText.string=t,this.node.getComponent(cc.Animation).play()},doEffectEnd:function(){void 0!==this.pool&&this.pool.put(this.node)}}),cc._RF.pop()},{}],spineImportTest:[function(t,e,i){"use strict";cc._RF.push(e,"9f63buZHGZG0aGB3T+9GaZU","spineImportTest"),cc.Class({extends:cc.Component,properties:{skeleton:sp.Skeleton},start:function(){null!=this.skeleton&&(this.skeleton.setCompleteListener(function(t,e){var i=t.animation?t.animation.name:"";cc.log("[track %s][animation %s] complete: %s",t.trackIndex,i,e)}),this.skeleton.setEventListener(function(t,e){var i=t.animation?t.animation.name:"";cc.log("[track %s][animation %s] event: %s, %s, %s, %s",t.trackIndex,i,e.data.name,e.intValue,e.floatValue,e.stringValue)}))},update:function(t){}}),cc._RF.pop()},{}],unisonShow:[function(t,e,i){"use strict";cc._RF.push(e,"c46ec2gwu1KybJiXi0pNPcN","unisonShow"),cc.Class({extends:cc.Component,properties:{main_ani:cc.Animation,unit1_sprites:[cc.Sprite],unit2_sprites:[cc.Sprite],endAction:{default:null}},init:function(t,e,i){for(var a in this.endAction=i,this.unit1_sprites){this.unit1_sprites[a].spriteFrame=new cc.SpriteFrame(t.cutinTextureResource)}for(var a in this.unit2_sprites){this.unit2_sprites[a].spriteFrame=new cc.SpriteFrame(t.supportCutinTextureResource)}var n=this.node.getComponentsInChildren(cc.Animation);for(var a in n){n[a].defaultClip.speed=e}this.main_ani.on("finished",function(t){null!==this.endAction&&this.endAction(),this.node.destroy()}.bind(this),this),this.main_ani.play()}}),cc._RF.pop()},{}],"use_v2.1.x_cc.Action":[function(t,e,i){"use strict";cc._RF.push(e,"c0e8ds9ygZCqaOuWa1o0K5U","use_v2.1.x_cc.Action"),cc.macro.ROTATE_ACTION_CCW=!0,cc._RF.pop()},{}]},{},["Command","CommandAnimation","CommandBg","CommandBgOff","CommandCharacter","CommandCharacterOff","CommandClickWait","CommandElseIf","CommandEndIf","CommandEndWait","CommandFadeInBlack","CommandFadeInWhite","CommandFadeOutBlack","CommandFadeOutWhite","CommandFlash","CommandIf","CommandImageConfig","CommandMask","CommandMessage","CommandName","CommandPlayBgm","CommandPlayMovie","CommandPlayMovieOff","CommandPlaySe","CommandPlayVoice","CommandSelect","CommandShake","CommandSlideInBlack","CommandSlideOutBlack","CommandSpine","CommandSpineOff","CommandSprite","CommandSpriteAtlas","CommandSpriteOff","CommandStopBgm","CommandStopSe","CommandStopVoice","CommandVal","CommandWait","CommandWindowUI","AdvCommandTypeList","AdvCommandTypeResourceList","AdvConstants","AdvData","AdvRichText","AdvText","AdvManager","AdvRoot","AdvSubRootBase","TemplateAdvSubRoot","AdvSingleton","AdvSoundManager","AdvCommonButton","AdvCommonScrollView","AdvGameRootBase","AdvPopupBase","AdvSoundSettingView","AdvTimeUtils","AdvWindowBase","AdvGameConst","AdvLocalDataConst","AdvSceneConst","AdvSingletonConst","AdvStaticResourceConst","AdvUtils","MessageView","AdvLogMessageThumbnail","AdvSelectThumbnail","AdvConfigPopup","AdvLogPopup","use_v2.1.x_cc.Action","Game","CommandRoomBg","CommandTutorial","AdvCustomConstants","CustomCommandTypeList","CustomCommandTypeResourceList","ExtensionAdvRoot","AdvSubRoot","ExtensionAdvUtils","D1AdvLogMessageThumbnail","D1AdvSelectThumbnail","D1AdvConfigPopup","D1AdvLogPopup","D1MessageView","AnimationEventComponent","AnimationUtils","CircleRollView","CommonCountView","CommonPageView","CommonPopup","CommonScrollLabel","CommonScrollView","CommonUtils","CommonWholeView","CommonWindow","DevelopmentUtils","ErrorCode","GameRootBase","HotUpdate","ListPageView","LoopRollView","NoticeViewBase","OutGameRootBase","PageButton","PageButtonView","PageViewBase","PopupBase","PopupUtils","ResourceUtils","RollView","SimpleMessagePopup","SortButton","SoundSettingView","TabViewBase","TimeUtils","WindowBase","ApiConstants","CharacterConst","DeckConst","EnvironmentConst","EquipmentConst","GachaAnimationConst","GameConst","ItemConst","LocalDataConst","QuestConst","QuestionnaireConst","RaidConst","ResourceConst","SceneConst","SingletonConst","StaticResourceConst","StoryConst","CharacterFilterConst","CharacterGroupFilterConst","EquipmentFilterConst","PictureBookDetailFilterConst","MasterDataApi","MasterDataConstants","MasterDataLoadKeys","CharacterSortConst","DeckSortConst","EquipmentSortConst","PictureBookDetailSortConst","UserDataApi","UserDataConstants","UserDataLoadSettings","AutoSelectConfirmPopup","BPProgressView","BackButton","CharacterStandView","ListViewBase","MatrixView","MovieController","NoticeBadgeCheckUtils","SDCharacterViewBase","SerifBalloon","SimpleNoticeWithClearGaugeView","SimpleNoticeWithClearStampView","TabButton","TapEffectManager","UIHeader","UIHomeButton","UIRankButton","UISide","VariableTabViewBase","ViewUtils","LoadProgressView","LoadSimpleView","MatrixConfig","MatrixMultipleSelectCountUpPageView","MatrixMultipleSelectPageView","MatrixPageViewBase","MatrixSingleSelectPageView","ApRecoveryPopup","BpRecoveryPopup","FilterPopup","HowToPlayPopup","MenuPopup","ModelDetailPopup","NewsPopup","RecommendedMaterialSelectPopup","ResultRibbonPopup","SerialCodePopup","SimplePopup","SortFilterPopup","SortFilterTabView","ThumbnailTextPopup","ItemSourceConst","ItemSourceListPopup","ItemSourceListView","ItemSourceThumbnail","ItemSourceUtils","AllResourceDownloadConfirmPopup","MenuSettingConfigView","MenuSettingPopup","MenuSettingQualityView","MenuSettingTabView","MenuSettingViewBase","ItemNoticeWindow","SimplePrefabArrowView","SimplePrefabViewBase","CharacterMatrixThumbnail","DeckMatrixThumbnail","EnemyMatrixThumbnail","EquipmentMatrixThumbnail","ItemMatrixThumbnail","LoginBonusMatrixThumbnail","MatrixThumbnail","MatrixThumbnailBase","MatrixThumbnailUtils","QuestSkipResultDropItemThumbnail","ResultMatrixThumbnail","SimpleThumbnail","UIHeaderCurrencyThumbnail","WarehouseMaterialMatrixThumbnail","UnlockEffectConst","UnlockEffectUtils","AuthApis","AuthService","OAuth","CommonNumber","ResourceManager","CommonButton","MasterDatabase","DmmAndroidJsToJava","Http","HttpStatus","NetworkReachability","NetworkUtils","RESTClient","PaymentApis","PaymentManager","PaymentService","BaseService","ServiceManager","Async","Environment","ErrorManager","EventManager","FixedTimeScheduler","NoticeManager","TextApis","TextManager","BattleData","BattleConstants","EnumTypes","ShaderController","shaderCode_GaussBlurs","ActionController","BaseGameManager","EquipmentController","SetTestBattleManager","SkillController","ArenaGameManager","QuestGameManager","RaidGameManager","TowerGameManager","TutorialGameManager","BackgroundController","BackgroundView","MinigameConstants","MinigamePlayData","MinigameObjectView","MiniCharacterController","MiniCharacterData","MiniCharacterView","TrapController","TrapView","TrapFireballController","TrapFireballView","TrapGakeController","TrapIkeController","TrapIwaController","TrapIwaView","MinigameManager","TrapManager","MinigameRoot","MinigameCharacterSelectSubRoot","MinigameCutinSubRoot","MinigameResultSubRoot","MinigameRootUtils","ArenaPlayerUnit","BattleAbility","BattleAction","BattleBossUnit","BattleChara","BattleDeckUnit","BattleEquipment","BattleMonsterModel","BattleMonsterUnit","BattleNormalAttack","BattlePlayerUnit","BattleQuest","BattleSkill","BattleUnit","Buff","GameLoop","RaidBattleBossUnit","TowerBattleBossUnit","TowerBattleMonsterUnit","TowerBattlePlayerUnit","BattlePlayerUnitByJson","ArenaRankUpPopup","ArenaResultSubRoot","BattlePausePopup","BattleResultSubRoot","PvPStartAnimSubRoot","RaidResultSubRoot","ResultRankUpPopup","TowerResultSubRoot","GameEffectQueue","SetTestBattleBtnOBJ","AbilityController","BattleFunction","BattleResult","CommonFunction","BattleDataLoader","BattleEffectThumbnail","BattleEventController","BattleInfoDeckUnit","BattleLoadRoot","BattleSkillAbilityThumbnail","BattleThumbnail","BuffEffectView","CameraController","EffectEnd","SpineEventInterpreter","skillShow","unisonShow","PvPStartAnimGameRoot","PvPStartAnimPlayerInfoView","buffNumberShow","damageShow","healShow","ArenaPoolManager","PoolManager","ArenaResultRankGaugeView","QuestResultExpGaugeView","RaidResultDamageView","RaidResultExpGaugeView","ResultCharacterExpView","ResultDropItemWindow","ResultEventPointWindow","ResultPlayerRankView","ResultSubMissionDetailPopup","ResultSubMissionStarView","SubMissionThumbnailView","ArenaGameRoot","GameRoot","QuestGameRoot","AbilityCutinMessageView","AbilityCutinView","ArenaUIManager","BattleUIManager","RaidBattleUIManager","SkillCutinMessageView","SkillCutinView","UnisonCutinView","BattlePauseHelpView","BattlePauseInfoEnemyView","BattlePauseInfoPlayerView","BattlePauseInfoViewBase","BattlePauseSettingView","BattlePauseTabView","BattlePauseViewBase","BuffHelpThumbnail","BaseUnitCtrl","BossUnitCtrl","MonsterAvatarCtrl","MonsterUnitCtrl","PlayerUnitCtrl","PvPEnemyUnitCtrl","BattleSessionModel","BoostModel","CharacterModel","DeckModel","EquipmentModel","FurnitureModel","ItemModel","MissionModel","PictureBookBaseModel","PictureBookDetailModel","PvPModel","QuestModel","RaidModel","RoomFurnitureModel","RoomModel","StoryModel","TowerSessionModel","UserModel","WarehouseCharacterModel","WarehouseEquipmentModel","WarehouseMaterialModel","PvPCharacterModel","PvPDeckModel","PvPEquipmentModel","PvPPictureBookDetailModel","CampaignModel","CharacterAbilityEffectModel","CharacterAbilityGroupModel","CharacterAbilityMainModel","CharacterAbilityUpModel","CharacterContentsModel","CharacterExceedLimitModel","CharacterFavoriteModel","CharacterGroupModel","CharacterLevelModel","CharacterMainModel","CharacterMaterialModel","CharacterNormalAttackModel","CharacterSkillEffectModel","CharacterSkillMainModel","CharacterSkillUpModel","CharacterSkillUpRateModel","CharacterTextModel","DmmModel","EquipmentEffectModel","EquipmentExceedLimitModel","EquipmentLevelModel","EquipmentMainModel","EquipmentMaterialModel","ErrorModel","EventBoostCharacterModel","EventBoostEffectModel","EventCharacterModel","EventHelpModel","EventItemModel","EventMainModel","EventPointRewardModel","ExchangeItemDetailModel","ExchangeMainModel","ExchangePointDetailModel","FurnitureCategoryModel","FurnitureCollectModel","FurnitureCostModel","FurnitureMainModel","FurnitureStoryModel","FurnitureTypeModel","GachaCautionModel","GachaContentsModel","GachaDiscountModel","GachaFixGroupModel","GachaLineupModel","GachaMainModel","GachaOddsModel","GachaPresentGroupModel","GachaStepModel","InitCharacterModel","InitEquipmentModel","InitItemModel","ItemApRecoveryGemModel","ItemCategoryModel","ItemMainModel","ItemQuestLockModel","ItemRecipeModel","ItemSelectModel","ItemSetModel","LoadingCharacterModel","LoadingMainModel","LoadingTipsModel","LoginBonusModel","LoginPackMainModel","LoginPackRewardModel","LoginRewardModel","MinigameCharacterMainModel","MinigameCharacterTextModel","MinigameMainModel","MissionDetailModel","MissionMainModel","MissionRewardModel","MyPageBannerModel","MyPageEventModel","MyPageMainModel","MyPageNewsModel","PresentMessageModel","PvPClassModel","PvPClassRewardModel","PvPMainModel","QuestAchieveModel","QuestAreaModel","QuestDropModel","QuestEventPointModel","QuestStageModel","QuestWorldModel","RaidBattleModel","RaidBattleTypeModel","RaidRewardGroupModel","RaidRewardModel","RoomCharacterFrameModel","RoomMainModel","ShopDetailModel","ShopMainModel","StoryCategoryModel","StoryEventModel","StoryGroupModel","StoryOtherModel","StoryPictureBookModel","StoryQuestModel","StoryRoomModel","StoryTutorialModel","StoryVoiceModel","TowerMainModel","TowerRewardGroupModel","TowerRewardModel","TutorialEventModel","TutorialMainStepModel","TutorialSubStepModel","UserBuffHelpModel","UserHelpModel","UserHowToPlayModel","UserMainModel","UserProgressModel","UserBasicInfoModel","UserBoostModel","UserCharacterModel","UserDeckModel","UserEquipmentModel","UserEventItemModel","UserExchangeHistoryModel","UserFurnitureModel","UserGachaModel","UserItemModel","UserMinigameModel","UserMissionModel","UserPictureBookBaseModel","UserPictureBookDetailModel","UserPurchaseHistoryModel","UserPvPModel","UserQuestModel","UserRaidModel","UserRoomLayoutModel","UserRoomModel","UserShopHistoryModel","UserStoryModel","UserTowerSessionModel","UserWarehouseCharacterModel","UserWarehouseEquipmentModel","UserWarehouseMaterialModel","CampaignUtils","CharacterAbilityUtils","CharacterEquipmentUtils","CharacterParameterUtils","CharacterSkillUtils","CharacterUtils","DeckAutoUtils","DeckUtils","EquipmentUtils","EventUtils","ExchangeUtils","FilterUtils","FurnitureUtils","HistoryUtils","ItemUtils","LoadingUtils","MissionUtils","PictureBookUtils","PresentUtils","PvPUtils","QuestConditionUtils","QuestUtils","RaidUtils","RoomUtils","ShopUtils","StoryUtils","TowerUtils","UserProgressUtils","UserUtils","WarehouseConvertUtils","WarehouseUtils","BootRoot","DummyLogin","LocalStartRoot","StartRoot","ResourceDownloadRoot","RestoreBattleRoot","DeckViewSetting","DeckRoot","DeckRootBase","DeckCharacterSelectSubRoot","DeckSelectSubRoot","DeckRootUtils","AutoDeckEditPopup","DeckBattleParameterView","DeckCharacterDetailPopup","DeckCharacterDetailStatusView","DeckCharacterSelectSideView","DeckSwapReleaseCharacterPopup","DeckSwapSelectCharacterPopup","DeckTypeSwitchView","EquipmentAllRemoveConfirmPopup","DeckTabSimpleView","DeckTabView","DeckTabViewBase","DeckWithGaugeTabSimpleView","DeckUnitListSimpleView","DeckUnitListView","DeckUnitListViewBase","DeckUnitListWithGaugeSimpleView","CharacterEquipmentListView","DeckUnitEquipmentListView","DeckUnitSimpleThumbnail","DeckUnitSupportThumbnail","DeckUnitThumbnail","DeckUnitThumbnailBase","DeckUnitWithGaugeSimpleThumbnail","EquipmentViewSetting","EquipmentRoot","EquipmentAlertPopup","EquipmentDetailPopup","EquipmentExceedLimitCompletePopup","EquipmentExceedLimitConfirmPopup","EquipmentFortifyCompletePopup","EquipmentFortifyConfirmPopup","EquipmentSelectSubRoot","EquipmentSellCompletePopup","EquipmentSellConfirmPopup","EquipmentRootUtils","EquipmentSelectTabView","EquipmentDetailTabView","EquipmentDetailExceedLimitListView","EquipmentDetailExceedLimitThumbnail","EquipmentDetailStatusView","EquipmentDetailViewBase","EquipmentExceedLimitAbilityThumbnail","EquipmentExceedLimitConfirmMaterialView","EquipmentExceedLimitDifferenceView","EquipmentListViewBase","EquipmentProtectSelectListView","EquipmentListWithSideViewBase","EquipmentSelectSideViewBase","EquipmentExceedLimitMaterialSelectSideView","EquipmentFortifyMaterialSelectSideView","EquipmentMultipleSelectSideViewBase","EquipmentSellSelectSideView","EquipmentExceedLimitProgressView","EquipmentFortifyProgressView","EquipmentProgressSimpleView","EquipmentExceedLimitTargetSelectSideView","EquipmentFortifyTargetSelectSideView","EquipmentSingleSelectSideViewBase","EquipmentAbilityListView","EquipmentSelectSideCharacterStatusView","EquipmentSelectSideEquipmentAbilityThumbnail","EquipmentSelectSideEquipmentStatusView","EquipmentExceedLimitMaterialSelectListView","EquipmentFortifyMaterialSelectListView","EquipmentMultipleSelectListWithSideViewBase","EquipmentSellSelectListView","EquipmentExceedLimitTargetSelectListView","EquipmentFortifyTargetSelectListView","EquipmentSingleSelectListWithSideViewBase","EventQuestConst","EventQuestViewSetting","EventRegularQuestViewSetting","EventQuestRoot","EventQuestRootBase","EventRegularQuestRoot","EventQuestStageSelectSubRoot","EventQuestTopSubRoot","EventQuestTopSubRootBase","EventRegularQuestEquipmentBattleStartConfirmSubRoot","EventRegularQuestTopSubRoot","EventQuestFrameThumbnailBase","EventQuestItemFrameThumbnail","EventQuestPointFrameThumbnail","EventQuestPointRewardListThumbnail","EventRegularQuestAdventWarStageThumbnail","EventRegularQuestEquipmentThumbnail","EventQuestRootUtils","EventRegularQuestRootUtils","EventQuestDifficultyUnlockPopup","EventQuestHowToPlayPopup","EventQuestNormalExTabView","EventQuestPointRewardListPopup","EventRegularQuestAdventWarStageListView","EventRegularQuestEquipmentAutoDetailPopup","EventRegularQuestEquipmentItemUnlockPopup","EventRegularQuestEquipmentListView","ExchangeConst","ExchangeViewSetting","ExchangeRoot","ExchangeCurrencyShortagePopup","ExchangeItemConfirmPopup","ExchangeItemEventItemConfirmPopup","ExchangeItemEventItemPopup","ExchangeItemListConfirmPopup","ExchangeItemListDetailPopup","ExchangeItemListPopup","ExchangeItemShortagePopup","ExchangeItemSingleConfirmPopup","ExchangeItemSinglePopup","ExchangeSubRoot","CurrencyThumbnail","ExchangeItemDetailThumbnail","ExchangeItemThumbnail","ExchangeItemWideThumbnail","ExchangeTabButton","PointCurrencyThumbnail","ExchangeRootUtils","ExchangeListSwitchView","ExchangeListView","ExchangeListViewBase","ExchangeTabView","FirstLoginViewSetting","TutorialConst","FirstLoginAfterRoot","FirstLoginRoot","FirstLoginSubRoot","TutorialHowToPlayPopup","FirstLoginRootUtils","TutorialUtils","GachaConst","GachaViewSetting","GachaRoot","GachaCharacterDetailPopup","GachaPlayConfirmPopup","GachaPrecautionsPopup","GachaProvisionRatePopup","GachaTopSubRoot","GachaTicketPlayConfirmPopup","GachaRootUtils","GachaCharacterDetailPopupStatusView","GachaCharacterDetailStatusAbilityListView","GachaCharacterDetailStatusAppendListViewBase","GachaCharacterDetailStatusSkillListView","GachaCharacterDetailStatusTabView","GachaCharacterSummaryView","GachaCurrencyItemThumbnail","GachaCurrencyThumbnail","GachaNormalLogoView","GachaNormalRollView","GachaNormalStillView","GachaPlayBtnView","GachaPlayBtnViewBase","GachaPrecautionsTabView","GachaProbablityRollView","GachaProvisionRateMenuThumbnail","GachaProvisionRateScrollView","GachaProvisionRateScrollViewCharacterRateThumbnail","GachaProvisionRateScrollViewRarityThumbnail","GachaRollViewBase","GachaSideBannerThumbnail","GachaStepUpPlayBtnView","GachaStepUpRollView","GachaStepUpStillView","GachaViewBase","GachaTicketRollView","GachaAnimationViewSetting","GachaAnimationRoot","GachaAnimationCharacterDetailPopup","GachaAnimationSubRoot","GachaRewardReceivePopup","GachaAnimationRootUtils","GachaAnimationRollView","GachaAnimationView","GachaCardLayoutHorizontalView","GachaCardThumbnail","GachaCharacterCardThumbnail","GachaResultBtnViewBase","GachaResultCardView","GachaResultNormalBtnView","GachaResultStepUpBtnView","GachaResultTicketBtnView","GachaLoadingRoot","LoginBonusConst","LoginBonusViewSetting","LoginBonusRoot","LoginBonusSubRoot","LoginBonusUtils","LoginBonusNormalRibbon","LoginBonusNormalView","LoginBonusReceivedPopup","LoginBonusSdCharacterView","LoginBonusSerifView","LoginBonusSpecialTotalThumbnail","LoginBonusSpecialView","LoginBonusVariableNormalView","LoginBonusViewBase","MaintenanceViewSetting","MaintenanceRoot","MaintenanceSubRoot","MaintenanceRootUtils","MissionConst","MissionViewSetting","MissionRoot","MissionResultAllPopup","MissionResultPopup","MissionTabView","MissionRootUtils","MissionBackButton","MissionEventHeaderThumbnailView","MissionThumbnailView","MissionDetailEventTopView","MissionDetailNormalTopView","MissionDetailTabButton","MissionDetailTopViewBase","MissionDetailEventListView","MissionDetailEventTabView","MissionScrollView","HomeConst","HomeViewSetting","HomeRoot","MyPageNewsPopup","PanelMissionPopup","PanelMissionRewardConfirmPopup","HomeRootUtils","BannerBtnView","BannerRollView","BannerView","MyPageCharacterView","MyPageEventQuestBannerView","MyPageEventQuestThumbnail","MyPageMainView","MyPageNewsMainContentView","MyPageNewsSideBannerBandView","MyPageNewsSideBannerThumbnail","PanelMissionListView","PanelMissionTabView","PanelMissionAchievementThumbnail","PanelMissionTabButton","PanelMissionThumbnail","PanelMissionThumbnailBase","NormalQuestViewSetting","NoramlQuestRoot","NormalQuestRootUtils","PresentBoxViewSetting","PresentConst","PresentBoxRoot","PresentBoxSubRoot","PresentConfirmSimplePopup","PresentRandomReceiveCompletePopup","PresentBoxRootUtils","PresentConfirmSimpleListPopup","PresentReceiveDetailThumbnail","PresentScrollView","PresentThumbnailView","ProfileViewSetting","ProfileRoot","ProfileSubRoot","UserRenamePopup","ProfileRootUtils","ProfileCharacterView","ProfileView","PromoteCharacterDetailViewSetting","PromoteCharacterSelectViewSetting","PromoteCharacterDetailRoot","PromoteCharacterRootBase","PromoteCharacterSelectRoot","PromoteCharacterAbilityFortifyCompletePopup","PromoteCharacterDetailPopup","PromoteCharacterDetailSubRoot","PromoteCharacterEquipmentSelectPopup","PromoteCharacterEquipmentSelectSubRoot","PromoteCharacterExceedLimitCompletePopup","PromoteCharacterExceedLimitMaterialSelectSubRoot","PromoteCharacterFortifyCompletePopup","PromoteCharacterFortifyMaterialSelectSubRoot","PromoteCharacterMaterialItemDetailPopup","PromoteCharacterMaterialSelectSubRoot","PromoteCharacterSelectSubRoot","PromoteCharacterSellCompletePopup","PromoteCharacterSellConfirmPopup","PromoteCharacterSkillFortifyCompletePopup","PromoteCharacterSkillFortifyMaterialSelectSubRoot","PromoteEquipmentSwapPopup","SkillAbilitySimplePopup","PromoteCharacterAbilityFortifyConfirmPopup","PromoteCharacterConfirmPopupBase","PromoteCharacterExceedLimitConfirmPopup","PromoteCharacterFortifyConfirmPopup","PromoteCharacterSkillFortifyConfirmPopup","PromoteCharacterDetailRootUtils","PromoteCharacterSelectRootUtils","AlertPopup","PromoteCharacterAlertPopup","PromoteCharacterDetailImageView","PromoteCharacterDetailTopTabView","PromoteCharacterMaterialSelectSideView","PromoteCharacterSelectTabView","PromoteCharacterAbilityFortifyThumbnail","PromoteCharacterDetailAppendView","PromoteCharacterSkillFortifyThumbnail","BattleParameterView","CharacterExceedLimitIconThumbnail","CharacterExceedLimitProgressView","CharacterLevelProgressView","CharacterLevelView","PromoteCharacterDetailStatusParamViewBase","PromoteCharacterDetailStatusUpMaterialListView","PromoteCharacterDetailStatusUpMaterialThumbnail","PromoteCharacterDetailStatusViewBase","TotalBattleParameterView","PromoteCharacterDetailExceedLimitView","PromoteCharacterDetailNextReleaseAppendListView","PromoteCharacterDetailReleaseAppendListView","PromoteCharacterDetailFortifyAppendListView","PromoteCharacterDetailFortifyAppendThumbnail","PromoteCharacterDetailPopupStatusView","PromoteCharacterDetailStatusAppendListViewBase","PromoteCharacterDetailStatusAppendThumbnailBase","PromoteCharacterDetailStatusSkillAbilityThumbnail","PromoteCharacterDetailStatusTabView","PromoteCharacterDetailStatusAbilityListView","PromoteCharacterDetailStatusAbilityView","PromoteCharacterDetailPopupStatusEquipmentListView","PromoteCharacterDetailStatusEquipmentLargeThumbnail","PromoteCharacterDetailStatusEquipmentListView","PromoteCharacterDetailStatusEquipmentThumbnail","PromoteCharacterDetailStatusView"," PromoteCharacterDetailStatusExceedLimitView","CharacterExceedLimitCharacterMaterialView","CharacterExceedLimitItemMaterialView","CharacterExceedLimitMaterialTabView","CharacterExceedLimitMaterialViewBase","PromoteCharacterDetailStatusFortifyLevelView","PromoteCharacterDetailStatusFortifyMaterialListView","PromoteCharacterDetailStatusFortifyMaterialTabView","PromoteCharacterDetailStatusFortifyView","PromoteCharacterDetailStatusSkillListView","PromoteCharacterDetailStatusSkillMaterialListView","PromoteCharacterDetailStatusSkillView","PromoteCharacterEquipmentSelectListView","PromoteCharacterExceedLimitMaterialSelectListView","PromoteCharacterFortifyMaterialSelectListView","PromoteCharacterProtectSelectListView","PromoteCharacterSelectListViewBase","PromoteCharacterSellSelectListView","PromoteCharacterSkillFortifyMaterialSelectListView","PromoteCharacterTargetSelectListView","PromoteCharacterEquipmentSelectSideView","PromoteCharacterExceedLimitMaterialSelectSideView","PromoteCharacterFortifyMaterialSelectSideView","PromoteCharacterSellSelectSideView","PromoteCharacterSkillFortifyMaterialSelectSideView","PromoteCharacterTargetSelectSideView","MaterialCharacterInfoView","PromoteCharacterExceedLimitMaterialSelectSideListView","PromoteCharacterSimpleAppendListView","PromoteCharacterSimpleAppendThumbnail","PromoteCharacterSelectPopupTabView","PvPViewSetting","PvPRoot","PvPBattleStartConfirmSubRoot","PvPDeckSelectSubRoot","PvPTopSubRoot","PvPRootUtils","PvPBattlePlayerDetailView","PvPPlayerStatusView","PvPTopTabView","PvPBattlePlayerListView","PvPClassListView","PvPListViewBase","PvPClassThumbnail","PvPBattlePlayerThumbnail","PvPPlayerThumbnail","PvPPlayerThumbnailBase","PvPRankingPlayerThumbnail","QuestViewSetting","QuestRoot","QuestRootBase","BattleStartConfirmSubRoot","BattleStartConfirmSubRootBase","QuestAreaStageSelectSubRoot","QuestDropInfoPopup","QuestEnemyInfoPopup","QuestEventSelectSubRoot","QuestTopSubRoot","QuestWorldSelectSubRoot","QuestRootUtils","AreaThumbnailView","AutoDetailPopup","AutoDisplayWindow","AutoEndPopup","AutoStopDropItemListView","AutoStopPopup","QuestEventBannerThumbnail","QuestEventListView","QuestListSwitchView","QuestNormalExTabView","QuestSkipCharacterAnimationView","QuestSkipListThumbnail","QuestSkipResultPopup","QuestSkipResultRankUpPopup","QuestStageThumbnail","QuestSubMissionPopup","RankUpPopupBase","SkipDetailPopup","WorldPageScrollView","WorldThumbnailView","QuestListViewBase","QuestAreaListViewBase","QuestAreaNormalListView","QuestAreaWeekListView","QuestStageEventListView","QuestStageListViewBase","QuestStageNormalListView","QuestStageWeekListView","QuestionnaireViewSetting","QuestionnaireRoot","QuestionnaireInputConfirmPopup","QuestionnaireSubRoot","QuestionnaireRootUtils","QuestionnaireAnswerButtonThumbnail","QuestionnaireInputThumbnail","QuestionnaireListView","QuestionnaireRadioButton","QuestionnaireTabButton","QuestionnaireTabView","QuestionnaireTitleThumbnail","RaidViewSetting","RaidRoot","RaidBattleSelectSubRoot","RaidBattleStartConfirmSubRoot","RaidQuestSelectSubRoot","RaidResultPopup","RaidSendRescueConfirmPopup","RaidTopSubRoot","RaidBattleDetailConfirmPopup","RaidBattleDetailPopupBase","RaidResultWinPopup","RaidRootUtils","RaidBattleAppearView","RaidBattleSelectTabView","RaidQuestListView","RaidQuestStageThumbnail","RaidQuestStoryThumbnail","RaidQuestThumbnailBase","RaidRankingPlayerThumbnail","EntryRaidBattleListView","FinishedRaidBattleListView","PublicRaidBattleListView","RaidBattleListViewBase","RaidBattleThumbnail","RaidGachaResultViewSetting","RaidGachaViewSetting","RaidGachaResultRoot","RaidGachaRoot","RaidGachaRootBase","RaidGachaDescriptionPopup","RaidGachaLineupPopup","RaidGachaPlayCountConfirmPopup","RaidGachaResetConfirmPopup","RaidGachaResultSubRoot","RaidGachaTopSubRoot","RaidGachaResultRootUtils","RaidGachaRootUtils","RaidGachaLineupRewardHeaderThumbnail","RaidGachaLineupRewardThumbnail","RaidGachaLineupTabButton","RaidGachaLineupTabView","RaidGachaLineupView","RaidGachaResultListView","RoomCharacterViewSetting","RoomConst","RoomViewSetting","RoomCharacterRoot","RoomRoot","RoomRootBase","RoomCardDetailSubRoot","RoomCardEpisodeSubRoot","RoomCharacterSkinSelectSubRoot","RoomCharacterSubRoot","RoomFurnitureBuyConfirmPopup","RoomFurnitureEpisodeSubRoot","RoomFurnitureReleaseConfirmPopup","RoomFurnitureSelectConfirmPopup","RoomFurnitureSelectSubRoot","RoomHowToGetFurniturePopup","RoomPictureBookDetailContentsConfirmPopup","RoomReleaseFurnitureEpisodePopup","RoomTopSubRoot","RoomSlideSubRootBase","RoomCharacterRootUtils","RoomRootUtils","RoomCharacterCardThumbnail","RoomCharacterContentSimpleThumbnail","RoomCharacterContentThumbnail","RoomEpisodeContentsThumbnail","RoomEpisodeThumbnail","RoomHowToGetFurnitureThumbnail","RoomCardDetailContentThumbnail","RoomCardDetailContentsListView","RoomCardDetailFriendshipPresentThumbnail","RoomCardDetailFriendshipPresentsListView","RoomCardDetailFriendshipView","RoomCardDetailImageView","RoomCardDetailTopTabView","RoomCardDetailWholeView","RoomCardEpisodeListView","RoomCharacterFurnitureObjectView","RoomCharacterUIView","RoomWholeCharacterView","RoomWholeFurnitureView","RoomFurnitureEpisodeListView","RoomFurnitureDetailCharacterListView","RoomFurnitureDetailSelectWindow","RoomFurnitureDetailShopWindow","RoomFurnitureDetailWindowBase","RoomFurnitureListView","RoomFurnitureReleaseCharacterListView","RoomFurnitureTabView","RoomFurnitureThumbnail","FriendshipItemThumbnail","RoomTopCharacterGroupListView","ShopViewSetting","ShopRoot","ShopBoxExpansionConfirmPopup","ShopBoxExpansionPopup","ShopBoxExpansionPurchaseConfirmPopup","ShopItemListDetailPopup","ShopPurchaseCompletePopup","ShopPurchaseConfirmPopup","ShopSelectSubRoot","ShopSpecifiedCommercePopup","ShopTopSubRoot","ShopRootUtils","ShopItemThumbnail","ShopItemWideThumbnail","ShopPurchaseItemThumbnail","ShopSelectTabView","ShopTopThumbnail","ShopCampaignItemListView","ShopExpansionItemListView","ShopGemItemListView","ShopItemListViewBase","ShopNormalItemListView","ShopSetItemListView","StoryViewSetting","StoryRoot","StoryPlayConfirmPopup","StoryReleaseConditionPopup","StoryReleaseEventConditionPopup","StorySubRoot","StoryRootUtils","StoryListSwitchView","StoryThumbnail","StoryAreaListView","StoryCategoryListView","StoryGroupListView","StoryListViewBase","StoryWorldListView","StoryPlayEventListView","StoryPlayListViewBase","StoryPlayStageListView","StoryPlayTutorialListView","TitleAnimation","TitleRoot","QualitySettingPopup","TowerConst","TowerViewSetting","TowerRoot","TowerBattleStartConfirmSubRoot","TowerDeckSelectSubRoot","TowerRewardInfoPopup","TowerRewardReceivePopup","TowerStageSelectSubRoot","TowerStartingConfirmPopup","TowerTopSubRoot","TowerRootUtils","TowerAreaSelectView","TowerAreaThumbnail","TowerAutoDisplayOutgameWindow","TowerAutoDisplayWindow","TowerBGView","TowerChestWholeView","TowerDeckThumbnailView","TowerFloorListView","TowerItemWideThumbnail","TowerStageCharacterView","TowerStageCursorView","TowerStageFocusView","TowerStageListView","TowerStageSimpleView","TowerStageThumbnail","TowerStepThumbnail","TowerStepThumbnailBase","WarehouseConst","WarehouseViewSetting","WarehouseRoot","WarehouseItemSellConfirmPopup","WarehouseItemSellPopup","WarehouseQuestSearchPopup","WarehouseSelectSubRoot","WarehouseStorageSellCompletePopup","WarehouseStorageSellConfirmPopup","WarehouseRootUtils","WarehouseItemDropStageListView","WarehouseItemDropStageThumbnail","WarehouseSelectTabView","WarehouseCharacterStorageListView","WarehouseConsumeItemListView","WarehouseEquipmentListView","WarehouseEquipmentStorageListView","WarehouseGiftItemListView","WarehouseItemListViewBase","WarehouseListViewBase","WarehouseMaterialStorageListView","WarehouseOtherItemListView","WarehouseSelectCharacterStorageSideView","WarehouseSelectEquipmentSideView","WarehouseSelectEquipmentStorageSideView","WarehouseSelectItemSideView","WarehouseSelectMaterialStorageSideView","WarehouseSelectSideViewBase","WeekViewSetting","WeekRoot","WeekTopSubRoot","WeekRootUtils","AreaWeekThumbnailView","QuestFreeUnlockPopup","QuestItemUnlockPopup","ApplicationServiceManager","CampaignApis","CampaignService","CharacterApis","CharacterService","DeckApis","DeckService","EquipmentApis","EquipmentService","EventApis","EventService","GachaApis","GachaService","ItemApis","ItemService","LoginBonusApis","LoginBonusService","LoginPackApis","LoginPackService","MinigameApis","MinigameService","MissionApis","MissionService","MyPageApis","MyPageService","PictureBookService","PicturebookApis","PresentApis","PresentService","PvPApis","PvPService","QuestApis","QuestService","QuestionnaireApis","QuestionnaireService","RaidApis","RaidService","RoomApis","RoomService","ShopApis","ShopService","StoryApis","StoryService","TowerApis","TowerService","TutorialApis","TutorialService","UserApis","UserService","WarehouseApis","WarehouseService","LoadProgressCharacterView","LoadProgressTipsView","LoadingCharacterView","LoadingTipsView","Singleton","SoundManager","AsyncFileLoader","DownManifestManager","FileLoader","FileLoaderConsts","FileLoaderManager","GenerateMd5","MemoryManager","ResLeakChecker","ResLoader","WrapAsyncFileLoad","DebugRoot","spineImportTest"]);